--- 
slug: gcp_rt_cloudrun_revision_change
eventname: google.cloud.run.v1.Revisions.DeleteRevision
title: google.cloud.run.v1.Revisions.DeleteRevision
sidebar_label: google.cloud.run.v1.Revisions.DeleteRevision
---
                       
### Event Information

#### Meaning

- The google.cloud.run.v1.Revisions.DeleteRevision event in GCP for CloudRun indicates that a revision of a Cloud Run service has been deleted.
- This event is triggered when a user or an automated process deletes a specific revision of a Cloud Run service.
- The event provides information about the deleted revision, such as its name, service name, and the project ID it belongs to.

### Remediation

#### Using Console

- Example: If security is impacted with google.cloud.run.v1.Revisions.DeleteRevision in GCP for CloudRun, it means that an unauthorized user or process has the ability to delete a revision of a CloudRun service. This can lead to potential data loss or disruption of service.

- Remediation Steps using GCP Console:
  1. Access the GCP Console and navigate to the CloudRun service that needs to be secured.
  2. Click on the "Permissions" tab to manage access control for the service.
  3. Review the existing roles and permissions assigned to users or service accounts.
  4. Identify any users or service accounts that have the "roles/run.revisions.delete" permission.
  5. Remove the "roles/run.revisions.delete" permission from any unauthorized users or service accounts.
  6. Consider implementing the principle of least privilege by granting only necessary permissions to users or service accounts.
  7. Regularly review and audit the access control settings to ensure ongoing security and compliance.

#### Using CLI

- Example: If security is impacted with `google.cloud.run.v1.Revisions.DeleteRevision` in GCP CloudRun, it means that an unauthorized user or process has the ability to delete a revision of a CloudRun service. This can lead to potential data loss or disruption of the application.

- Remediation steps for GCP CloudRun using GCP CLI:
  1. Identify the user or process that has the ability to perform the `google.cloud.run.v1.Revisions.DeleteRevision` action. This can be done by reviewing the IAM roles and permissions assigned to the user or service account.
  2. Remove the unnecessary or excessive permissions from the user or service account to limit their ability to delete revisions. This can be done by modifying the IAM policy associated with the user or service account.
  3. Regularly review and audit the IAM policies to ensure that only authorized users or processes have the necessary permissions to perform critical actions like deleting revisions.

CLI commands:
- To list the IAM policy for a CloudRun service:
  ```
  gcloud run services describe SERVICE_NAME --format="json" | jq '.metadata.name' | xargs -I {} gcloud run services get-iam-policy {} --format="json"
  ```

- To remove a specific permission from a user or service account:
  ```
  gcloud projects remove-iam-policy-binding PROJECT_ID --member="user:USER_EMAIL" --role="roles/run.revisions.delete"
  ```

- To add a specific permission to a user or service account:
  ```
  gcloud projects add-iam-policy-binding PROJECT_ID --member="user:USER_EMAIL" --role="roles/run.revisions.delete"
  ```

Note: Replace `SERVICE_NAME` with the actual name of the CloudRun service, `PROJECT_ID` with the GCP project ID, and `USER_EMAIL` with the email address of the user or service account.

#### Using Python

1. Impact on Security: The `google.cloud.run.v1.Revisions.DeleteRevision` event in GCP CloudRun allows the deletion of a specific revision of a CloudRun service. If security is impacted, an attacker could potentially delete a critical revision, leading to service disruption or unauthorized access.

2. Remediation Steps: To remediate this security impact, you can implement the following steps using Python and the GCP CloudRun API:

   a. Implement Access Controls: Ensure that only authorized users or service accounts have the necessary permissions to delete revisions. You can use the `google-cloud-iam` library in Python to manage IAM policies and grant appropriate roles to users or service accounts.

   ```python
   from google.cloud import iam

   def grant_delete_revision_permission(service_account_email, project_id, location, service_name):
       client = iam.IAMClient()
       policy = client.get_policy(request={"resource": f"projects/{project_id}/locations/{location}/services/{service_name}"})
       binding = next((b for b in policy.bindings if b.role == "roles/run.revisions.delete"), None)
       if binding:
           binding.members.append(service_account_email)
       else:
           binding = iam.Policy.Binding(
               role="roles/run.revisions.delete",
               members=[service_account_email]
           )
           policy.bindings.append(binding)
       client.set_policy(request={"resource": f"projects/{project_id}/locations/{location}/services/{service_name}", "policy": policy})
   ```

   b. Enable Audit Logging: Enable audit logging for CloudRun services to capture any deletion events. You can use the `google-cloud-logging` library in Python to configure and retrieve logs.

   ```python
   from google.cloud import logging_v2

   def enable_audit_logging(project_id, location, service_name):
       client = logging_v2.LoggingServiceV2Client()
       log_name = f"projects/{project_id}/logs/run.googleapis.com%2Frevision_delete"
       sink_name = f"projects/{project_id}/sinks/{service_name}-audit-logs"
       filter_expr = f'resource.type="cloud_run_revision" AND protoPayload.methodName="google.cloud.run.v1.Revisions.DeleteRevision" AND resource.labels.service_name="{service_name}"'
       sink = logging_v2.LogSink(
           name=sink_name,
           destination=log_name,
           filter=filter_expr
       )
       client.create_sink(request={"parent": f"projects/{project_id}", "sink": sink})
   ```

   c. Monitor and Alert: Set up monitoring and alerting mechanisms to detect any unusual deletion activities or patterns. You can use the `google-cloud-monitoring` library in Python to create custom metrics and set up alerts.

   ```python
   from google.cloud import monitoring_v3

   def create_custom_metric(project_id, metric_type, metric_kind, value_type, display_name):
       client = monitoring_v3.MetricServiceClient()
       project_name = f"projects/{project_id}"
       descriptor = monitoring_v3.types.MetricDescriptor()
       descriptor.type = metric_type
       descriptor.metric_kind = metric_kind
       descriptor.value_type = value_type
       descriptor.display_name = display_name
       client.create_metric_descriptor(name=project_name, metric_descriptor=descriptor)
   ```

   These steps will help mitigate the security impact of the `google.cloud.run.v1.Revisions.DeleteRevision` event in GCP CloudRun by implementing access controls, enabling audit logging, and setting up monitoring and alerting mechanisms.


 