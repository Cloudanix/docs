--- 
slug: gcp_rt_vpc_network_changes
eventname: v1.compute.networks.insert
title: v1.compute.networks.insert
sidebar_label: v1.compute.networks.insert
---
                       
### Event Information

- The v1.compute.networks.insert event in GCP for Compute refers to the creation of a new network in the Compute Engine service.
- This event indicates that a user or an automated process has initiated the creation of a new network within the GCP project.
- The event can be used to track network creation activities and monitor the overall network infrastructure in GCP Compute Engine.


### Examples

1. Unauthorized network access: If security is impacted with v1.compute.networks.insert in GCP for Compute, it could potentially allow unauthorized users to create new networks, leading to a higher risk of network breaches and unauthorized access to resources within the network.

2. Network misconfiguration: The use of v1.compute.networks.insert in GCP for Compute without proper security controls can result in misconfigured networks. This can lead to unintended exposure of sensitive data or services to the public internet, increasing the risk of data breaches or unauthorized access.

3. Resource exhaustion: If security is impacted with v1.compute.networks.insert in GCP for Compute, it could potentially allow malicious actors to create a large number of networks, leading to resource exhaustion. This can result in performance degradation or denial of service for legitimate users, impacting the availability and reliability of the infrastructure.

### Remediation

#### Using Console

1. Unauthorized network access:
- Step 1: Access the GCP Console and navigate to the Compute Engine section.
- Step 2: Select the "Networks" option from the left-hand menu.
- Step 3: Review the existing networks and ensure that only authorized networks are present.
- Step 4: If any unauthorized networks are found, select the network and click on the "Delete" button to remove it.
- Step 5: Regularly monitor the network activity and set up alerts or notifications for any unauthorized network creation attempts.

2. Network misconfiguration:
- Step 1: Access the GCP Console and navigate to the Compute Engine section.
- Step 2: Select the "Networks" option from the left-hand menu.
- Step 3: Review the existing networks and their configurations.
- Step 4: Ensure that proper firewall rules, network segmentation, and access controls are in place.
- Step 5: If any misconfigurations are identified, modify the network settings accordingly and validate the changes.

3. Resource exhaustion:
- Step 1: Access the GCP Console and navigate to the Compute Engine section.
- Step 2: Select the "Networks" option from the left-hand menu.
- Step 3: Review the existing networks and their resource utilization.
- Step 4: Implement proper monitoring and resource management practices to identify any abnormal network creation patterns.
- Step 5: Set up automated alerts or notifications to detect and mitigate any resource exhaustion attempts.

#### Using CLI

1. Unauthorized network access:
- Identify and revoke any unnecessary IAM roles or permissions that grant the `compute.networks.insert` capability to unauthorized users.
- Implement strict IAM policies to limit the ability to create new networks only to authorized individuals or service accounts.
- Regularly monitor and audit network activity to detect any unauthorized network creations.

2. Network misconfiguration:
- Implement a standardized network configuration template that includes proper security controls, such as firewall rules, network segmentation, and access controls.
- Regularly review and validate network configurations to ensure they align with the desired security posture.
- Utilize network security tools and services provided by GCP, such as VPC Service Controls, to enforce network security best practices.

3. Resource exhaustion:
- Implement resource quotas and limits to prevent excessive network creations.
- Monitor network creation activities and set up alerts to detect any abnormal or suspicious behavior.
- Utilize automation and scripting to enforce resource management policies and prevent unauthorized or excessive network creations.

CLI commands for GCP Compute using GCP CLI:
1. Unauthorized network access:
- To revoke IAM roles or permissions: `gcloud projects remove-iam-policy-binding [PROJECT_ID] --member=[MEMBER] --role=[ROLE]`
- To manage IAM policies: `gcloud projects set-iam-policy [PROJECT_ID] [POLICY_FILE]`

2. Network misconfiguration:
- To create a network with proper security controls: `gcloud compute networks create [NETWORK_NAME] --subnet-mode=[SUBNET_MODE] --project=[PROJECT_ID]`
- To configure firewall rules: `gcloud compute firewall-rules create [FIREWALL_RULE_NAME] --network=[NETWORK_NAME] --allow=[ALLOWED_PROTOCOLS] --source-ranges=[SOURCE_RANGES] --project=[PROJECT_ID]`

3. Resource exhaustion:
- To set resource quotas and limits: `gcloud compute project-info add-metadata --metadata [KEY]=[VALUE]`
- To monitor network creation activities: `gcloud logging read "resource.type=gce_networks AND protoPayload.methodName=compute.networks.insert" --project=[PROJECT_ID]`

#### Using Python

1. Unauthorized network access:
- Implement proper authentication and authorization mechanisms to ensure that only authorized users have the permission to create new networks.
- Regularly review and update firewall rules and access controls to restrict network access to only necessary entities.

2. Network misconfiguration:
- Utilize infrastructure-as-code tools like Terraform or Deployment Manager to define and manage network configurations. This ensures consistency and reduces the risk of misconfigurations.
- Implement automated testing and validation processes to verify network configurations before deployment.

3. Resource exhaustion:
- Implement rate limiting or quota restrictions to prevent excessive network creation requests.
- Monitor network usage and set up alerts to detect any abnormal network creation activities.
- Implement auto-scaling or resource management policies to dynamically allocate resources based on demand and prevent resource exhaustion.

Example Python script for creating a network in GCP Compute using the `google-cloud-sdk` library:

```python
from google.cloud import compute_v1

def create_network(project_id, network_name):
    client = compute_v1.NetworksClient()

    network_body = {
        "name": network_name,
        "autoCreateSubnetworks": False
    }

    operation = client.insert(project=project_id, network_resource=network_body)
    operation.result()

    print(f"Network '{network_name}' created successfully.")

# Usage
project_id = "your-project-id"
network_name = "your-network-name"

create_network(project_id, network_name)
```

Note: Make sure to authenticate the script with appropriate credentials and have the necessary permissions to create networks in the specified project.


 