--- 
slug: gcp_rt_vpc_httpsproxy_changes
eventname: v1.compute.targetHttpsProxies.delete
title: v1.compute.targetHttpsProxies.delete
sidebar_label: v1.compute.targetHttpsProxies.delete
---
                       
### Event Information

1. The v1.compute.targetHttpsProxies.delete event in GCP for Compute indicates that a target HTTPS proxy has been deleted.
2. This event signifies that the target HTTPS proxy, which is responsible for forwarding HTTPS traffic to a backend service, has been removed from the GCP environment.
3. It is important to note that deleting a target HTTPS proxy will result in the termination of any existing connections and the removal of associated configurations.


### Examples

- Unauthorized deletion of target HTTPS proxies: If security is impacted with v1.compute.targetHttpsProxies.delete in GCP, it could potentially allow unauthorized individuals to delete target HTTPS proxies. This could lead to disruption of traffic routing and potential denial of service attacks.

- Misconfiguration of access controls: If security is impacted, it could be due to misconfiguration of access controls for the v1.compute.targetHttpsProxies.delete API. This could result in unauthorized users gaining access to the API and being able to delete target HTTPS proxies without proper authorization.

- Lack of audit trail: If security is impacted, it could be due to a lack of proper logging and auditing mechanisms for the v1.compute.targetHttpsProxies.delete API. This could make it difficult to track and investigate any unauthorized deletions, hindering incident response and forensic analysis.

### Remediation

#### Using Console

To remediate the unauthorized deletion of target HTTPS proxies in GCP Compute using the GCP console, you can follow these step-by-step instructions:

1. Review and update access controls:
   - Access the GCP console and navigate to the IAM & Admin section.
   - Identify the roles and permissions assigned to users or service accounts that have access to the v1.compute.targetHttpsProxies.delete API.
   - Ensure that only authorized individuals or service accounts have the necessary permissions to delete target HTTPS proxies.
   - Remove any unnecessary or overly permissive access rights to minimize the risk of unauthorized deletions.

2. Enable audit logging:
   - Access the GCP console and navigate to the Logging section.
   - Enable audit logging for the v1.compute.targetHttpsProxies.delete API.
   - Configure the logging to capture relevant information such as the user or service account performing the deletion, the timestamp, and any additional details that can aid in incident investigation.
   - Regularly review the audit logs to detect any suspicious or unauthorized deletion activities.

3. Implement monitoring and alerts:
   - Access the GCP console and navigate to the Monitoring section.
   - Set up monitoring and alerts for the v1.compute.targetHttpsProxies.delete API.
   - Define thresholds or conditions that trigger an alert when unusual or unauthorized deletion activities are detected.
   - Configure the alerts to notify the appropriate personnel or teams responsible for incident response, allowing them to take immediate action in case of any unauthorized deletions.

By following these steps, you can mitigate the risk of unauthorized deletion of target HTTPS proxies in GCP Compute and enhance the security of your infrastructure.

#### Using CLI

To remediate the unauthorized deletion of target HTTPS proxies in GCP Compute using GCP CLI commands, you can follow these steps:

1. Review and update access controls: Ensure that the access controls for the v1.compute.targetHttpsProxies.delete API are properly configured. Use the `gcloud compute target-https-proxies get-iam-policy` command to view the current IAM policy for the target HTTPS proxy. Update the policy using the `gcloud compute target-https-proxies set-iam-policy` command to restrict access to authorized individuals or roles only.

2. Enable audit logging: Enable audit logging for the v1.compute.targetHttpsProxies.delete API to create an audit trail of all API activities. Use the `gcloud logging sinks create` command to create a sink that exports logs to a Cloud Storage bucket or BigQuery dataset. Then, use the `gcloud compute target-https-proxies update` command to enable logging for the target HTTPS proxy.

3. Monitor and analyze logs: Regularly monitor and analyze the logs generated by the audit logging feature. Use the `gcloud logging read` command to retrieve logs related to the v1.compute.targetHttpsProxies.delete API. Look for any suspicious or unauthorized deletion activities and take appropriate actions based on the findings.

Note: The specific CLI commands may vary depending on your GCP project setup and configuration. Make sure to refer to the official GCP documentation for the most up-to-date and accurate commands.

#### Using Python

To remediate the unauthorized deletion of target HTTPS proxies in GCP Compute using Python scripts, you can take the following steps:

1. Implement proper access controls: Review and update the access controls for the v1.compute.targetHttpsProxies.delete API to ensure that only authorized users or roles have the necessary permissions to delete target HTTPS proxies. This can be done using the Google Cloud IAM (Identity and Access Management) API. Here's an example Python script to update IAM policies:

```python
from google.cloud import iam

def update_iam_policy(project_id, target_proxy_name):
    client = iam.IAMClient()
    policy = client.get_policy(request={"resource": f"projects/{project_id}"})
    
    # Update the policy to grant or revoke necessary permissions for the target proxy
    # For example, you can add or remove bindings for specific roles or users
    
    updated_policy = client.set_policy(
        request={
            "resource": f"projects/{project_id}",
            "policy": policy,
        }
    )
```

2. Enable audit logging: Enable audit logging for the v1.compute.targetHttpsProxies.delete API to ensure that all API calls are logged and can be reviewed for any unauthorized deletions. This can be done using the Google Cloud Logging API. Here's an example Python script to enable audit logging:

```python
from google.cloud import logging_v2

def enable_audit_logging(project_id, target_proxy_name):
    client = logging_v2.LoggingServiceV2Client()
    log_name = f"projects/{project_id}/logs/{target_proxy_name}-audit-log"
    
    # Create a log sink to export logs to a desired destination (e.g., Cloud Storage, BigQuery)
    # For example, you can create a log sink to export logs to a Cloud Storage bucket
    
    sink = client.create_sink(
        request={
            "parent": f"projects/{project_id}",
            "sink": {
                "name": log_name,
                "destination": "storage.googleapis.com/[BUCKET_NAME]",
                "filter": f'resource.type="gce_target_https_proxies" AND log_name="projects/{project_id}/logs/cloudaudit.googleapis.com%2Factivity"',
            },
        }
    )
```

3. Implement monitoring and alerting: Set up monitoring and alerting mechanisms to detect any suspicious or unauthorized deletions of target HTTPS proxies. This can be done using the Google Cloud Monitoring API. Here's an example Python script to create a monitoring policy:

```python
from google.cloud import monitoring_v3

def create_monitoring_policy(project_id, target_proxy_name):
    client = monitoring_v3.MetricServiceClient()
    policy_name = f"projects/{project_id}/alertPolicies/{target_proxy_name}-policy"
    
    # Create a monitoring policy to define conditions and actions for alerting
    # For example, you can set up a policy to trigger an alert when the deletion count exceeds a certain threshold
    
    policy = client.create_alert_policy(
        request={
            "name": policy_name,
            "alert_policy": {
                "display_name": f"{target_proxy_name} Deletion Alert",
                "conditions": [
                    {
                        "display_name": "Target Proxy Deletion Count",
                        "condition_threshold": {
                            "filter": f'resource.type="gce_target_https_proxies" AND log_name="projects/{project_id}/logs/cloudaudit.googleapis.com%2Factivity" AND protoPayload.methodName="v1.compute.targetHttpsProxies.delete"',
                            "comparison": "COMPARISON_GT",
                            "threshold_value": 0,
                            "duration": {"seconds": 300},
                        },
                    }
                ],
                "notification_channels": ["projects/{project_id}/notificationChannels/[CHANNEL_ID]"],
            },
        }
    )
```

These steps will help mitigate the risk of unauthorized deletion of target HTTPS proxies in GCP Compute and provide better security controls, auditability, and monitoring capabilities.


 