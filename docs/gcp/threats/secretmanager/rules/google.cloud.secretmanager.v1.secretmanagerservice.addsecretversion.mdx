--- 
slug: gcp_rt_secretmanager_add_secret_version
eventname: google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion
title: google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion
sidebar_label: google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion
---
                       
### Event Information

- The google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion event in GCP for SecretManager signifies the addition of a new version to a secret in Secret Manager.
- This event indicates that a new version of a secret has been created, which can be used to store sensitive information such as API keys, passwords, or certificates securely.
- The event provides visibility into the lifecycle of secrets, allowing administrators to track when new versions are added and monitor any changes made to the secret over time.


### Examples

1. Insufficient access controls: One potential security impact of using the `google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion` API in GCP's Secret Manager is the possibility of insufficient access controls. If proper permissions and roles are not assigned to users or service accounts, unauthorized individuals may be able to add secret versions, potentially exposing sensitive information.

2. Insecure secret storage: Another security concern could arise if the secret versions added through this API are not securely stored. It is crucial to ensure that the secrets are encrypted at rest and in transit, and that appropriate key management practices are followed to protect the confidentiality and integrity of the secrets.

3. Lack of auditing and monitoring: The `AddSecretVersion` API call may impact security if there is a lack of proper auditing and monitoring mechanisms in place. Without comprehensive logging and monitoring, it becomes difficult to detect any unauthorized or malicious activity related to secret version additions, making it harder to identify and respond to potential security incidents.

### Remediation

#### Using Console

To remediate the security concerns related to GCP Secret Manager using the GCP console, you can follow these steps:

1. Insufficient access controls:
   - Review and update the permissions and roles assigned to users and service accounts accessing the Secret Manager.
   - Ensure that the principle of least privilege is followed, granting only the necessary permissions required for secret management.
   - Regularly audit and review the access controls to identify and remove any unnecessary or excessive permissions.

2. Insecure secret storage:
   - Enable encryption at rest for the Secret Manager service. This ensures that the secrets are stored securely and cannot be accessed by unauthorized individuals.
   - Implement encryption in transit by using HTTPS for all API calls to protect the confidentiality of the secrets during transmission.
   - Follow best practices for key management, such as using strong encryption keys and regularly rotating them.

3. Lack of auditing and monitoring:
   - Enable logging and monitoring for the Secret Manager service. This allows you to track and analyze activities related to secret version additions.
   - Configure alerts and notifications for any suspicious or unauthorized activities.
   - Regularly review the logs and monitor for any anomalies or security incidents, taking appropriate actions when necessary.

#### Using CLI

1. To remediate insufficient access controls in GCP's Secret Manager, you can follow these steps using GCP CLI commands:

- Grant appropriate permissions and roles to users or service accounts using the `gcloud` command:
  ```
  gcloud secrets add-iam-policy-binding [SECRET_NAME] \
  --member=[MEMBER] \
  --role=[ROLE]
  ```

- Replace `[SECRET_NAME]` with the name of the secret you want to modify access controls for.
- Replace `[MEMBER]` with the email address or service account of the user you want to grant access to.
- Replace `[ROLE]` with the desired role, such as `roles/secretmanager.secretAccessor` for read access or `roles/secretmanager.secretVersionAdder` for write access.

2. To remediate insecure secret storage in GCP's Secret Manager, you can ensure proper encryption and key management using the following CLI commands:

- Enable encryption at rest for the secret:
  ```
  gcloud secrets update [SECRET_NAME] \
  --replication-policy=automatic \
  --location=[LOCATION] \
  --add-labels=[KEY]=[VALUE]
  ```

- Replace `[SECRET_NAME]` with the name of the secret you want to enable encryption for.
- Replace `[LOCATION]` with the desired location for storing the secret.
- Replace `[KEY]` and `[VALUE]` with the labels you want to add for better key management.

3. To address the lack of auditing and monitoring in GCP's Secret Manager, you can set up logging and monitoring using the following CLI commands:

- Enable Secret Manager API:
  ```
  gcloud services enable secretmanager.googleapis.com
  ```

- Configure logs to be sent to Cloud Logging:
  ```
  gcloud secrets update [SECRET_NAME] \
  --log-based-acl=group:[GROUP_EMAIL]:[LOGGING_PERMISSION]
  ```

- Replace `[SECRET_NAME]` with the name of the secret you want to configure logging for.
- Replace `[GROUP_EMAIL]` with the email address of the group you want to grant logging permission to.
- Replace `[LOGGING_PERMISSION]` with the desired logging permission, such as `READ` or `WRITE`.

These CLI commands will help remediate the mentioned security concerns in GCP's Secret Manager by implementing proper access controls, secure secret storage, and auditing mechanisms.

#### Using Python

1. Insufficient access controls:
- Ensure that proper permissions and roles are assigned to users or service accounts using the `google.cloud.secretmanager.v1.SecretManagerService.AddSecretVersion` API.
- Implement a least privilege principle by granting only the necessary permissions required for adding secret versions.
- Regularly review and update access controls to ensure that only authorized individuals have the ability to add secret versions.

2. Insecure secret storage:
- Encrypt the secrets at rest using Google Cloud's Key Management Service (KMS) or other encryption mechanisms.
- Implement secure transit encryption by using HTTPS or other secure communication protocols when interacting with the Secret Manager API.
- Follow best practices for key management, such as rotating encryption keys and securely storing and managing key material.

3. Lack of auditing and monitoring:
- Enable Cloud Audit Logs for Secret Manager to capture API activity and changes to secret versions.
- Set up alerts and notifications to proactively monitor for any suspicious or unauthorized activity related to secret version additions.
- Utilize Cloud Monitoring or third-party monitoring tools to monitor and analyze logs for any security-related events or anomalies.


 