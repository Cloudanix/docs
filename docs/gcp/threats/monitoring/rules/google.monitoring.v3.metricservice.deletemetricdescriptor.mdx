--- 
slug: gcp_rt_monitoring_metricdescriptor_changes
eventname: google.monitoring.v3.MetricService.DeleteMetricDescriptor
title: google.monitoring.v3.MetricService.DeleteMetricDescriptor
sidebar_label: google.monitoring.v3.MetricService.DeleteMetricDescriptor
---
                       
### Event Information

#### Meaning

1. The google.monitoring.v3.MetricService.DeleteMetricDescriptor event in GCP for Monitoring indicates that a metric descriptor has been deleted.
2. This event signifies that a specific metric, which defines the characteristics and properties of a metric, has been removed from the Monitoring service.
3. The event can be used to track changes and updates to the metric descriptors in order to maintain an accurate and up-to-date monitoring configuration.

### Remediation

#### Using Console

- Example: If security is impacted with google.monitoring.v3.MetricService.DeleteMetricDescriptor in GCP Monitoring, it means that an unauthorized user or entity has the ability to delete metric descriptors, which can lead to data loss or disruption of monitoring capabilities.

- Remediation steps using GCP console:
  1. Identify and verify the impacted user or entity by reviewing the audit logs and access controls in the GCP console.
  2. Remove the unauthorized access by revoking the necessary permissions or disabling the user or entity's access to the GCP Monitoring service.
  3. Implement additional security measures such as enabling audit logging, setting up alerts for suspicious activities, and regularly reviewing access controls to prevent similar security incidents in the future.

#### Using CLI

- Example: If security is impacted with `google.monitoring.v3.MetricService.DeleteMetricDescriptor` in GCP Monitoring, it means that an unauthorized user or process has the ability to delete metric descriptors, which can lead to data loss or disruption of monitoring capabilities.

- Remediation steps using GCP CLI:
  1. Identify the impacted metric descriptor by listing all metric descriptors in the project:
     ```
     gcloud monitoring metric-descriptors list --project=[PROJECT_ID]
     ```
  2. Review the list of metric descriptors and identify any unauthorized or suspicious descriptors.
  3. Restrict the permissions for the affected metric descriptor by removing the `roles/monitoring.metricDescriptors.delete` role from unauthorized users or service accounts:
     ```
     gcloud projects remove-iam-policy-binding [PROJECT_ID] --member=[MEMBER] --role=roles/monitoring.metricDescriptors.delete
     ```
     Replace `[PROJECT_ID]` with your GCP project ID and `[MEMBER]` with the email address or service account ID of the unauthorized user or service account.

Note: It is important to regularly review and audit the permissions assigned to metric descriptors to ensure that only authorized entities have the ability to delete them.

#### Using Python

Example of security impact: If an unauthorized user gains access to the `google.monitoring.v3.MetricService.DeleteMetricDescriptor` permission in GCP Monitoring, they can delete metric descriptors, which are used to define custom metrics. This can lead to the loss of important monitoring data and disrupt the monitoring capabilities of the system.

Remediation steps for GCP Monitoring using Python:

1. Implement proper access controls: Ensure that only authorized users or service accounts have the necessary permissions to delete metric descriptors. Follow the principle of least privilege and grant permissions only to the required entities.

2. Enable audit logging: Enable audit logging for GCP Monitoring API calls, including the `DeleteMetricDescriptor` operation. This will help in tracking any unauthorized or suspicious activities related to metric descriptor deletion.

3. Implement monitoring and alerting: Set up monitoring and alerting for changes to metric descriptors. This can be done using the Cloud Monitoring API and Cloud Pub/Sub. By monitoring changes to metric descriptors, you can quickly identify any unexpected deletions and take appropriate actions.

Python script for enabling audit logging for GCP Monitoring API calls:

```python
from google.cloud import logging_v2

def enable_audit_logging(project_id):
    client = logging_v2.LoggingServiceV2Client()
    parent = f"projects/{project_id}"
    sink_name = f"{parent}/sinks/audit-logs-sink"

    # Create a sink to export audit logs to Cloud Storage
    sink = {
        "name": sink_name,
        "destination": "storage.googleapis.com/[YOUR_BUCKET_NAME]",
        "filter": 'logName:"logs/cloudaudit.googleapis.com"',
        "output_version_format": "V2",
    }
    client.create_sink(parent, sink)

    # Bind the sink to the GCP Monitoring API logs
    client.update_sink(sink_name, sink, unique_writer_identity=True)

    print("Audit logging enabled for GCP Monitoring API calls.")

# Usage
enable_audit_logging("your-project-id")
```

Note: Replace `[YOUR_BUCKET_NAME]` with the name of your Cloud Storage bucket where you want to export the audit logs.

Please note that the provided script is a basic example and may require additional configuration and error handling based on your specific requirements and environment.


 