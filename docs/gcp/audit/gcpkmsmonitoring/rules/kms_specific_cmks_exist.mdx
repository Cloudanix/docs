---
slug: kms_specific_cmks_exist
title: Check For The Existence of Specific KMS CMKs
sidebar_label: Check For The Existence of Specific KMS CMKs
---

### More Info:

Ensure that a specific list of KMS CMKs are available for use in your AWS account in order to meet the security and compliance requirements of the organization.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to Google Cloud Console: Open your web browser, navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google account that has the necessary permissions to view KMS resources.

2. Select your project: From the top bar, click on the dropdown menu next to "Google Cloud Platform" and select the project where you want to check for the existence of specific KMS CMKs.

3. Navigate to KMS: On the left-hand side menu, scroll down and click on "Security" to expand the options. Then click on "Key Management" to navigate to the KMS section.

4. Check for specific KMS CMKs: In the KMS section, you will see a list of all the Key Rings and the associated CryptoKeys (CMKs). You can search for specific KMS CMKs by their names in the search bar. If the specific KMS CMK exists, it will be displayed in the list.

#### Using CLI

1. First, you need to install and configure the Google Cloud SDK on your local system. You can download it from the official Google Cloud website and follow the instructions to install it. Once installed, you can authenticate your Google Cloud account by running the following command in your terminal:

   ```
   gcloud auth login
   ```

2. After successful authentication, you can list all the projects associated with your account by running the following command:

   ```
   gcloud projects list
   ```

3. Choose the project where you want to check for the existence of specific KMS CMKs. Set the project by running the following command:

   ```
   gcloud config set project [PROJECT_ID]
   ```

   Replace `[PROJECT_ID]` with your actual project ID.

4. Now, you can list all the KMS CMKs in the selected project by running the following command:

   ```
   gcloud kms keyrings list --location global
   ```

   This command will list all the keyrings and their associated keys in the global location. If you have keys in other locations, replace `global` with your actual location.

   To check for a specific KMS CMK, you can filter the output of the above command by piping it to the `grep` command as follows:

   ```
   gcloud kms keyrings list --location global | grep [KEY_NAME]
   ```

   Replace `[KEY_NAME]` with the name of the key you are looking for. If the key exists, the command will return its details. If not, the command will return nothing.

#### Using Python

1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new KMS client:
```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

def check_kms_key_existence(key_alias):
    kms_client = boto3.client('kms')
```

2. Use the `list_aliases` method to retrieve all the KMS key aliases within your AWS account:
```python
    try:
        response = kms_client.list_aliases()
    except ClientError as e:
        print(f"Unexpected error: {e}")
        return False
```

3. Iterate over the list of key aliases and check if the specific KMS CMK alias exists:
```python
    for alias in response['Aliases']:
        if alias['AliasName'] == key_alias:
            print(f"Key alias {key_alias} exists.")
            return True
```

4. If the specific KMS CMK alias does not exist, print a message and return False:
```python
    print(f"Key alias {key_alias} does not exist.")
    return False
```

The complete function would look like this:
```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

def check_kms_key_existence(key_alias):
    kms_client = boto3.client('kms')
    try:
        response = kms_client.list_aliases()
    except ClientError as e:
        print(f"Unexpected error: {e}")
        return False
    for alias in response['Aliases']:
        if alias['AliasName'] == key_alias:
            print(f"Key alias {key_alias} exists.")
            return True
    print(f"Key alias {key_alias} does not exist.")
    return False
```
You can call this function with the alias of the key you want to check:
```python
check_kms_key_existence('alias/my-key')
```
This script will print a message and return True if the key exists, and False otherwise.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of checking for the existence of specific KMS CMKs in GCP using GCP console, follow these steps:

1. Open the Google Cloud Console and select the project that you want to work on.

2. In the navigation menu, select "Security" and then select "Security Health Analytics".

3. Under "Security Health Analytics", select "Findings".

4. In the search bar, enter "KMS" and select "KMS Key Ring Has No Rotation Policy".

5. This will show you a list of all the KMS key rings that have no rotation policy.

6. For each key ring that has no rotation policy, click on the key ring name to open it.

7. In the key ring page, click on the "Edit" button.

8. Under "Rotation Interval", select the desired rotation interval from the drop-down menu.

9. Click on "Save" to save the changes.

10. Repeat steps 6-9 for all the key rings that have no rotation policy.

By following these steps, you will remediate the misconfiguration of checking for the existence of specific KMS CMKs in GCP using GCP console.

#### Using CLI

To remediate the misconfiguration of checking for the existence of specific KMS CMKs in GCP using GCP CLI, you can follow the below steps:

1. Open the Google Cloud Shell or any terminal window where you have installed the GCP CLI and authenticate with your GCP account using the following command:
   
   ```
   gcloud auth login
   ```
   
2. Check the list of all the available key rings in the project using the following command:

   ```
   gcloud kms keyrings list --location=global
   ```

3. Identify the specific key ring that contains the CMKs that you want to check for existence.

4. Check the list of all the available Crypto Keys in the identified key ring using the following command:

   ```
   gcloud kms keys list --location=global --keyring=<keyring-name>
   ```

   Replace `<keyring-name>` with the name of the identified key ring.

5. Identify the specific CMK that you want to check for existence.

6. Check the existence of the identified CMK using the following command:

   ```
   gcloud kms keys describe <key-name> --location=global --keyring=<keyring-name>
   ```

   Replace `<key-name>` with the name of the identified CMK and `<keyring-name>` with the name of the identified key ring.

7. If the command returns an error message stating that the key does not exist, then the CMK does not exist. In this case, you can create the CMK using the following command:

   ```
   gcloud kms keys create <key-name> --location=global --keyring=<keyring-name> --purpose=<purpose>
   ```

   Replace `<key-name>` with the name of the CMK that you want to create, `<keyring-name>` with the name of the identified key ring, and `<purpose>` with the purpose of the CMK (e.g. `encryption`).

   Note: You need to have the necessary IAM permissions to create a new CMK.

8. If the command returns the details of the CMK, then the CMK exists and no further action is required.

By following these steps, you can remediate the misconfiguration of checking for the existence of specific KMS CMKs in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration of checking for the existence of specific KMS CMKs in GCP using python, you can follow the below steps:

1. Import the necessary modules:

```
from google.cloud import kms_v1
from google.oauth2 import service_account
```

2. Set up the credentials for authentication:

```
credentials = service_account.Credentials.from_service_account_file('<path_to_service_account_file>')
```

3. Create a client object for the Key Management Service:

```
client = kms_v1.KeyManagementServiceClient(credentials=credentials)
```

4. Define the name of the keyring and the key to check for existence:

```
keyring_name = 'my-keyring'
key_name = 'my-key'
```

5. Use the client object to check for the existence of the key:

```
parent = client.key_ring_path('<project_id>', '<location>', keyring_name)
key_full_name = client.crypto_key_path_path('<project_id>', '<location>', keyring_name, key_name)

try:
    client.get_crypto_key(key_full_name)
    print(f'Key {key_full_name} exists.')
except:
    print(f'Key {key_full_name} does not exist.')
```

6. Replace `<path_to_service_account_file>`, `<project_id>`, `<location>`, `<keyring_name>`, and `<key_name>` with the appropriate values for your GCP environment.

7. Run the script to check for the existence of the specified KMS CMKs, and remediate any that do not exist.




</Tab>
</Tabs>