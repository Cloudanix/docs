---
slug: sql_system_event_log_enabled
title: Cloud Sql System Event Audit Logging Should Be Enabled
sidebar_label: Cloud Sql System Event Audit Logging Should Be Enabled
---

### More Info:

Ensure that Cloud SQL System Event Audit Logging is configured properly across all projects.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, SOC2, NISTCSF, PCIDSS, CISGCP, CBP, HIPAA, ISO27001



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to Logging: From the left-hand side menu, select "Logging" under the "Stackdriver" section. This will open the "Logs Viewer" page.

3. Filter Logs: In the "Logs Viewer" page, you can filter the logs based on the resource type. To check for Cloud SQL system event audit logging, select "Cloud SQL Database" as the resource type from the drop-down menu.

4. Check Audit Logs: After selecting the resource type, check the logs for any system events. If system event audit logging is enabled, you should be able to see logs related to system events. If you don't see any system event logs, it means that system event audit logging is not enabled.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI: You need to have the Google Cloud SDK installed on your local machine and be authenticated with the necessary permissions to access the Cloud SQL instances.

2. List all the Cloud SQL instances: Use the following command to list all the Cloud SQL instances in your project.

   ```
   gcloud sql instances list
   ```

3. Get the details of each Cloud SQL instance: For each instance listed in the previous step, use the following command to get the details of the instance. Replace `[INSTANCE_NAME]` with the name of your instance.

   ```
   gcloud sql instances describe [INSTANCE_NAME]
   ```

4. Check the `settings.databaseFlags` field: In the output of the previous command, look for the `settings.databaseFlags` field. If the `log_checkpoints` and `log_connections` flags are not set to `on`, then the Cloud SQL System Event Audit Logging is not enabled.

#### Using Python

To check if Cloud SQL System Event Audit Logging is enabled in Google Cloud Platform (GCP) using Python scripts, you can follow these steps:

1. **Install Google Cloud SDK and Python Client for Cloud Logging:**
   Before you start, make sure you have Google Cloud SDK and Python Client for Cloud Logging installed on your system. You can install the Python client using pip:
   ```
   pip install google-cloud-logging
   ```

2. **Set up Authentication:**
   You need to authenticate your SDK with GCP. You can do this by setting the environment variable `GOOGLE_APPLICATION_CREDENTIALS` to the path of your service account key JSON file.
   ```
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/service-account-file.json"
   ```

3. **Use Python Client for Cloud Logging:**
   Use the Python client for Cloud Logging to fetch the logs. Here is a sample script to fetch the logs:

   ```python
   from google.cloud import logging

   # Instantiates a client
   logging_client = logging.Client()

   # The name of the log to read from
   log_name = 'log-id'  # replace 'log-id' with your log id

   # Retrieves a Cloud Logging handler based on the environment
   # you're running the script in.
   logger = logging_client.logger(log_name)

   # Retrieves the Cloud Logging handler for the root logger and sets the
   # severity level to WARNING.
   handler = logging_client.get_default_handler()
   cloud_logger = logging.getLogger("cloudLogger")
   cloud_logger.setLevel(logging.WARNING)
   cloud_logger.addHandler(handler)

   # Calls the Cloud Logging handler's emit() method to log a simple text entry.
   cloud_logger.warning('this is a warning message')
   ```

4. **Check for Cloud SQL System Event Audit Logging:**
   In the logs fetched, check if the Cloud SQL System Event Audit Logging is enabled. If the logs contain entries related to Cloud SQL System events, it means the logging is enabled. If not, it's disabled.

Please note that the actual Python script may vary based on your specific requirements and configurations.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Cloud SQL System Event Audit Logging Should Be Enabled" in GCP using GCP console, you can follow the below steps:

1. Open the GCP Console and navigate to the Cloud SQL instances page.

2. Select the instance for which you want to enable audit logging.

3. Click on the "Edit" button at the top of the page.

4. Scroll down to the "Data Access" section and click on "Advanced Configuration".

5. Under "Audit Configuration", select the checkbox for "System Event Audit Logs".

6. Click on the "Save" button at the bottom of the page to apply the changes.

7. Verify that the audit logging is enabled by checking the "Audit Logs" tab in the Cloud SQL instance details page.

By following these steps, you can remediate the misconfiguration "Cloud SQL System Event Audit Logging Should Be Enabled" in GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Cloud SQL System Event Audit Logging Should Be Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the Cloud Shell in the GCP console.

2. Run the following command to update the Cloud SQL instance to enable system event audit logging:

```
gcloud sql instances patch [INSTANCE_NAME] --database-flags log_system_events=on
```

Note: Replace [INSTANCE_NAME] with the name of your Cloud SQL instance.

3. After executing the command, verify that the system event audit logging is enabled by running the following command:

```
gcloud sql instances describe [INSTANCE_NAME]
```

4. In the output, check the value of the "databaseFlags" field. It should contain "log_system_events: on" indicating that the system event audit logging is enabled.

By following the above steps, you can remediate the misconfiguration "Cloud SQL System Event Audit Logging Should Be Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cloud SQL system event audit logging should be enabled" in GCP using Python, you can follow the below steps:

1. First, you need to authenticate and authorize the application to access the GCP project. You can do this by following the instructions in the Google Cloud documentation.

2. Once you have authenticated and authorized the application, you need to import the required libraries in your Python code. You will need the following libraries:

```
from googleapiclient.discovery import build
from google.oauth2 import service_account
```

3. Next, you need to create a service account key for the GCP project. You can do this by following the instructions in the Google Cloud documentation.

4. Once you have created the service account key, you need to download the key and save it in a secure location.

5. In your Python code, you can use the service account key to authenticate and authorize the application to access the GCP project. You can do this by using the following code:

```
credentials = service_account.Credentials.from_service_account_file(
    'path/to/service_account_key.json')
service = build('sqladmin', 'v1beta4', credentials=credentials)
```

6. After you have authenticated and authorized the application, you can use the `service` object to retrieve the configuration of the Cloud SQL instance. You can do this by using the following code:

```
project_id = 'your_project_id'
instance_name = 'your_instance_name'

instance = service.instances().get(project=project_id, instance=instance_name).execute()
```

7. Once you have retrieved the configuration of the Cloud SQL instance, you can check if system event audit logging is enabled. You can do this by checking the value of the `settings.settingsVersion` field in the `instance` object. If the value is `2`, then system event audit logging is enabled. If the value is `1`, then system event audit logging is not enabled.

```
if instance['settings']['settingsVersion'] == '1':
    # Enable system event audit logging
else:
    # System event audit logging is already enabled
```

8. To enable system event audit logging, you need to update the configuration of the Cloud SQL instance. You can do this by using the following code:

```
instance['settings']['settingsVersion'] = '2'

update_request = service.instances().update(project=project_id, instance=instance_name, body=instance)
update_request.execute()
```

9. After you have updated the configuration of the Cloud SQL instance, you can verify that system event audit logging is enabled by checking the value of the `settings.settingsVersion` field in the `instance` object.

```
if instance['settings']['settingsVersion'] == '2':
    # System event audit logging is enabled
else:
    # Failed to enable system event audit logging
```

By following these steps, you can remediate the misconfiguration "Cloud SQL system event audit logging should be enabled" in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/sql/docs/mysql/audit-logging#available-logs](https://cloud.google.com/sql/docs/mysql/audit-logging#available-logs) 


</Tab>
</Tabs>