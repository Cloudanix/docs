---
slug: cloud_audit_logging
title: Cloud Audit Logging Should Be Enabled
sidebar_label: Cloud Audit Logging Should Be Enabled
---

### More Info:

Ensure that Cloud Audit Logging is configured properly across all services and all users from a project.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISGCP, CBP, GDPR, NIST, HIPAA, ISO27001, SOC2, NISTCSF, PCIDSS, FedRAMP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to Google Cloud Console: Open your web browser, navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google Cloud credentials.

2. Select the Project: From the top menu, select the project for which you want to check the Cloud Audit Logging configuration.

3. Navigate to Logging: On the left side menu, click on "Navigation Menu" (three horizontal lines on the top left corner), scroll down and click on "Logging" under the "Operations" section.

4. Check Audit Logs: In the Logging section, click on "Logs Explorer". In the "Logs Explorer" page, under the "Log Name" filter, select "cloudaudit.googleapis.com/activity" or "cloudaudit.googleapis.com/data_access" or "cloudaudit.googleapis.com/system_event". If logs are present, it means Cloud Audit Logging is enabled. If no logs are present, it indicates that Cloud Audit Logging may not be enabled.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions for your specific operating system.

2. Authenticate your Google Cloud account by running the following command in your terminal:
   ```
   gcloud auth login
   ```
   Follow the prompts to log in with your Google Cloud account.

3. List all the projects in your Google Cloud account by running the following command:
   ```
   gcloud projects list
   ```
   This will return a list of all the projects in your account, along with their project IDs.

4. Check the status of Cloud Audit Logging for each project by running the following command for each project ID:
   ```
   gcloud logging sinks list --project=[PROJECT_ID]
   ```
   Replace `[PROJECT_ID]` with the ID of the project you want to check. This command will return a list of all the logging sinks in the project. If Cloud Audit Logging is enabled, you should see a sink with the name "cloudaudit.googleapis.com/activity". If you don't see this sink, then Cloud Audit Logging is not enabled for that project.

#### Using Python

1. **Import the necessary libraries**: The first step is to import the necessary libraries in your Python script. You will need the `google.cloud` library to interact with GCP services. If it's not installed, you can install it using pip: `pip install google-cloud-logging`.

    ```python
    from google.cloud import logging
    ```

2. **Initialize the Logging Client**: The next step is to initialize the logging client. This client will interact with the Logging service on GCP. You will need to authenticate with GCP, which you can do by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file.

    ```python
    client = logging.Client()
    ```

3. **Fetch the Audit Logs**: Now, you can fetch the audit logs. You can do this by calling the `list_entries` method on the logging client. This method returns a generator that yields all the log entries.

    ```python
    filter_str = 'logName:"logs/cloudaudit.googleapis.com"'
    entries = client.list_entries(filter_=filter_str)  # API call
    ```

4. **Check if Audit Logging is Enabled**: Finally, you can check if audit logging is enabled by checking if any audit logs are returned. If no logs are returned, then audit logging is not enabled.

    ```python
    if len(list(entries)) == 0:
        print("Cloud Audit Logging is not enabled.")
    else:
        print("Cloud Audit Logging is enabled.")
    ```

This script will print whether Cloud Audit Logging is enabled or not. If it's not enabled, you should enable it to ensure that you have visibility into the actions taken in your GCP environment.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Cloud Audit Logging Should Be Enabled" misconfiguration for GCP using the GCP console, follow the steps below:

1. Open the GCP Console and navigate to the project for which you want to enable audit logging.

2. Click on the "Navigation Menu" button in the top left corner of the console and select "Logging" under the "TOOLS" section.

3. In the Logging page, click on the "Log-based Metrics" tab.

4. Click on the "+ CREATE METRIC" button to create a new metric.

5. In the "Create a Metric" page, enter a name for the metric (e.g., "audit-logs"), select "Admin Activity" under the "Log" dropdown menu, and select "Global" under the "Resource type" dropdown menu.

6. Click on the "CREATE METRIC" button to create the metric.

7. Click on the "Create Sink" button to create a new sink.

8. In the "Create a Sink" page, enter a name for the sink (e.g., "audit-logs-sink"), select "BigQuery" under the "Sink Service" dropdown menu, and select the destination dataset and table where you want to store the audit logs.

9. Click on the "CREATE SINK" button to create the sink.

10. Click on the "View Sink" button to view the sink details.

11. In the sink details page, click on the "EDIT" button to edit the sink configuration.

12. In the "Edit a Sink" page, select "Include All Logs" under the "Filter" section and select the metric you created earlier under the "Log Metric" section.

13. Click on the "SAVE" button to save the sink configuration.

14. You have now enabled audit logging for your GCP project. The audit logs will be stored in the destination BigQuery table you specified in the sink configuration.

#### Using CLI

To remediate the misconfiguration "Cloud Audit Logging should be enabled" for GCP using GCP CLI, follow the below steps:

1. Open the Cloud Shell in the GCP console or install the GCP CLI on your local machine.

2. Run the following command to enable Cloud Audit Logging for all services in your project:

```
gcloud logging project-config set \
    audit_configs: \
    - service: allServices \
      audit_log_configs: \
      - log_type: ADMIN_READ \
        exempted_members: \
        - user:example-user@domain.com \
        - group:example-group@domain.com \
        - domain:example.com \
      - log_type: DATA_READ \
      - log_type: DATA_WRITE \
```

3. Replace the exempted_members field with the email addresses or domains of the users or groups that should be exempt from audit logging.

4. Run the following command to verify that Cloud Audit Logging is enabled:

```
gcloud logging project-config describe
```

5. Check the output for the following line:

```
"cloudAuditLogsEnabled": true
```

If the value is true, then Cloud Audit Logging is enabled for your project.

By following these steps, you can successfully remediate the misconfiguration "Cloud Audit Logging should be enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cloud Audit Logging Should Be Enabled" for GCP using Python, you can follow the below steps:

1. Import the required libraries:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials
```

2. Authenticate and create a client object:

```python
credentials = GoogleCredentials.get_application_default()
service = discovery.build('logging', 'v2', credentials=credentials)
```

3. Create a sink object for the logs to be collected:

```python
sink_name = 'my-sink'
destination_uri = 'storage.googleapis.com/my-bucket'
filter = 'logName:syslog'
sink = {
    'name': sink_name,
    'destination': destination_uri,
    'filter': filter
}
```

4. Check if the sink already exists:

```python
sinks = service.sinks().list(project='my-project-id').execute()
if sink_name in [s['name'] for s in sinks['sinks']]:
    print(f"Sink {sink_name} already exists.")
else:
    # Create the sink
    service.sinks().create(
        body=sink,
        parent=f"projects/my-project-id"
    ).execute()
    print(f"Sink {sink_name} created.")
```

5. Enable audit logging for the project:

```python
service.projects().updateAuditConfig(
    body={
        'auditConfig': {
            'service': 'allServices',
            'auditLogConfigs': [{
                'logName': 'projects/my-project-id/logs/cloudaudit.googleapis.com',
                'exemptedMembers': [],
                'ignoreChildExemptions': True,
                'enabled': True
            }]
        }
    },
    resource='projects/my-project-id'
).execute()
```

This will enable audit logging for the GCP project and create a sink to collect the logs in a specified bucket. You can modify the sink name, destination URI, and filter as per your requirement.




</Tab>
</Tabs>