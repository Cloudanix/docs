---
slug: vpc_firewall_rule_logging
title: Firewall Change Log Alerts Should Be Enabled
sidebar_label: Firewall Change Log Alerts Should Be Enabled
---

### More Info:

Ensures that logging and log alerts exist for firewall rule changes.

### Risk Level

Low

### Address

Security

### Compliance Standards

CISGCP, CBP, HIPAA, ISO27001, HITRUST, SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to Logging: From the main navigation menu, click on "Logging" under the "Operations" section. This will take you to the Cloud Logging page.

3. Check for Firewall Change Log Alerts: On the Cloud Logging page, look for the "Logs Router" section. Here, you should see a list of all the logs that are being collected and where they are being sent. Look for any logs that are related to firewall changes. If these logs are not being collected or sent to an appropriate destination (like a monitoring or alerting system), then this is a misconfiguration.

4. Verify Alert Configuration: If Firewall Change Log Alerts are enabled, they should be configured to send an alert whenever a change is made to the firewall. You can check this by looking at the details of the log configuration. If there is no alert set up for firewall changes, or if the alert is not configured correctly, then this is a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK: The Google Cloud SDK includes the gcloud command-line tool, which is necessary to interact with GCP services. You can install it by following the instructions provided by Google Cloud. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all the projects: Use the command `gcloud projects list` to get a list of all the projects in your GCP account. Note down the PROJECT_ID of the project you want to check.

3. Check the logging sinks: Use the command `gcloud logging sinks list --project=PROJECT_ID` to list all the logging sinks in the project. Look for a sink that exports logs to a destination where alerts can be created (like Pub/Sub, Cloud Storage, or BigQuery).

4. Check the filter of the sink: If a sink is found, check its filter using the command `gcloud logging sinks describe SINK_NAME --project=PROJECT_ID`. The filter should include "logName:logs/cloudaudit.googleapis.com%2Factivity AND protoPayload.methodName:(vpc.firewalls.insert OR vpc.firewalls.update OR vpc.firewalls.patch OR vpc.firewalls.delete)" to ensure that firewall change logs are being captured.

If the filter does not include the above, it means that Firewall Change Log Alerts are not enabled in Logging.

#### Using Python

1. **AWS**

To check if CloudTrail is enabled in AWS, you can use the Boto3 library in Python. Here is a sample script:

```python
import boto3

def check_cloudtrail():
    client = boto3.client('cloudtrail')
    response = client.describe_trails()
    for trail in response['trailList']:
        if trail['IsLogging']:
            print(f"CloudTrail {trail['Name']} is enabled.")
        else:
            print(f"CloudTrail {trail['Name']} is not enabled.")

check_cloudtrail()
```

2. **Azure**

To check if Azure Activity Log Alerts are enabled, you can use the Azure SDK for Python. Here is a sample script:

```python
from azure.mgmt.monitor import MonitorManagementClient
from azure.identity import DefaultAzureCredential

def check_activity_log_alerts():
    credential = DefaultAzureCredential()
    subscription_id = 'your-subscription-id'
    client = MonitorManagementClient(credential, subscription_id)
    activity_log_alerts = client.activity_log_alerts.list()
    for alert in activity_log_alerts:
        print(f"Activity Log Alert {alert.name} is enabled.")

check_activity_log_alerts()
```

3. **GCP**

To check if Logging is enabled in GCP, you can use the google-cloud-logging library in Python. Here is a sample script:

```python
from google.cloud import logging

def check_logging():
    client = logging.Client()
    for metric in client.list_metrics():
        print(f"Logging metric {metric.name} is enabled.")

check_logging()
```

Please replace 'your-subscription-id' with your actual Azure subscription ID. Also, ensure that you have the necessary permissions and have configured your environment correctly to use these scripts.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Firewall Change Log Alerts Should Be Enabled" for GCP using GCP console, follow the below steps:

1. Login to your GCP console.
2. Navigate to the Security Command Center.
3. Click on the "Security Health Analytics" option from the left-hand menu.
4. Click on the "Firewall rules" option.
5. Select the project for which you want to enable Firewall Change Log Alerts.
6. Click on the "Edit" button.
7. Scroll down to the "Logging" section and enable the "Firewall Change Log" option.
8. Click on the "Save" button to save the changes.

By following the above steps, you have successfully enabled the Firewall Change Log Alerts for the selected project in GCP. This will help you to track any changes made to the firewall rules and take necessary actions in case of any unauthorized changes.

#### Using CLI

To remediate the misconfiguration "Firewall Change Log Alerts Should Be Enabled" for GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in the GCP Console.
2. Run the following command to enable firewall log exports:

```
gcloud logging sinks create firewall_logs_sink storage.googleapis.com/[BUCKET_NAME] --log-filter="resource.type=gce_firewall_rule AND protoPayload.methodName=compute.firewalls.patch AND protoPayload.serviceData.rule.direction=INGRESS" --include-children --organization=[ORGANIZATION_ID] --project=[PROJECT_ID]
```

Replace `[BUCKET_NAME]` with the name of the GCS bucket where you want to store the logs, `[ORGANIZATION_ID]` with the ID of your GCP organization, and `[PROJECT_ID]` with the ID of the GCP project where you want to enable the firewall log exports.

3. Run the following command to grant the `Logs Writer` role to the `cloud-logs@google.com` service account:

```
gcloud projects add-iam-policy-binding [PROJECT_ID] --member="serviceAccount:cloud-logs@google.com" --role="roles/logging.logWriter"
```

Replace `[PROJECT_ID]` with the ID of the GCP project where you enabled the firewall log exports.

4. Run the following command to create a firewall rule to allow traffic from the `cloud-logs@google.com` service account:

```
gcloud compute firewall-rules create allow-cloud-logs --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=tcp:22 --source-service-account=cloud-logs@google.com --target-tags=allow-cloud-logs
```

5. Run the following command to add the `allow-cloud-logs` tag to the instances where you want to allow traffic from the `cloud-logs@google.com` service account:

```
gcloud compute instances add-tags [INSTANCE_NAME] --tags=allow-cloud-logs --zone=[ZONE]
```

Replace `[INSTANCE_NAME]` with the name of the instance where you want to allow traffic from the `cloud-logs@google.com` service account, and `[ZONE]` with the zone where the instance is located.

By following these steps, you will enable firewall log exports and allow the `cloud-logs@google.com` service account to access the logs.

#### Using Python

To remediate the misconfiguration "Firewall Change Log Alerts Should Be Enabled" in GCP using Python, you can follow the below steps:

Step 1: Install the necessary libraries

```
pip install google-cloud-logging google-auth
```

Step 2: Authenticate with GCP

```
from google.oauth2 import service_account
from google.cloud import logging_v2

credentials = service_account.Credentials.from_service_account_file(
    '/path/to/your/credentials.json')
client = logging_v2.LoggingServiceV2Client(credentials=credentials)
```

Step 3: Create a log sink

```
from google.cloud.logging_v2.types import LogSink

sink_name = "firewall-change-log-alerts"
destination_uri = "pubsub://projects/{project_id}/topics/{topic_name}"
filter_ = "logName=projects/{project_id}/logs/compute.googleapis.com%2Ffirewall"
sink = LogSink(
    name=sink_name,
    destination=destination_uri,
    filter=filter_,
    include_children=True
)
parent = f"projects/{project_id}"
client.create_sink(parent=parent, sink=sink)
```

Step 4: Verify the log sink

```
sinks = client.list_sinks(parent=f"projects/{project_id}")
for sink in sinks:
    if sink.name == sink_name:
        print("Log sink created successfully")
        break
else:
    print("Log sink creation failed")
```

After running these steps, the log sink for Firewall Change Log Alerts will be created successfully in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/logging/docs/logs-based-metrics/](https://cloud.google.com/logging/docs/logs-based-metrics/) 


</Tab>
</Tabs>