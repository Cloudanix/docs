---
slug: cdn_global_backend_services_failover_policy_enabled
title: Cloud CDN Global Backend Services Failover Policy Should Be Enabled
sidebar_label: Cloud CDN Global Backend Services Failover Policy Should Be Enabled
---

### More Info:

Ensure Cloud CDN global backend services have failover policy enabled.

### Risk Level

High

### Address

Operational Maturity, Performance Efficiency, Reliability, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to Cloud CDN: From the main dashboard of the Google Cloud Console, click on the navigation menu (three horizontal lines) located at the top-left corner of the page. Scroll down and click on "Network Services", then select "Cloud CDN".

3. Check Backend Services: In the Cloud CDN page, click on the "Backend services" tab. This will display a list of all the backend services associated with your Cloud CDN.

4. Check Failover Policy: For each backend service, click on its name to view its details. Look for the "Failover policy" section. If the Failover policy is not enabled, it means that the Cloud CDN Global Backend Services Failover Policy is not enabled for that particular backend service. Repeat this step for all the backend services listed in your Cloud CDN.
</Accordion>

<Accordion title='Using CLI'>
1. Install and authenticate the Google Cloud SDK: Before you can use the Google Cloud CLI, you need to install it on your local machine and authenticate it with your Google Cloud account. You can download the SDK from the official Google Cloud website and follow the instructions to install it. Once installed, you can authenticate it by running the command `gcloud auth login` and following the prompts.

2. List all the backend services: Once you have the Google Cloud SDK installed and authenticated, you can list all the backend services in your project by running the command `gcloud compute backend-services list`. This will return a list of all the backend services in your project, along with their details.

3. Check the failover policy for each backend service: For each backend service in your project, you can check the failover policy by running the command `gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global`. Replace `[BACKEND_SERVICE_NAME]` with the name of the backend service you want to check. This will return the details of the backend service, including its failover policy.

4. Check the output: If the failover policy is enabled, the output of the previous command will include a section titled `failoverPolicy`. If this section is not present, the failover policy is not enabled for that backend service.
</Accordion>

<Accordion title='Using Python'>
To check if the Cloud CDN Global Backend Services Failover Policy is enabled in CDN using Python scripts, you can follow these steps:

1. **Install Google Cloud SDK and Python Client for Google Cloud CDN:**
   Before you start, make sure you have installed the Google Cloud SDK and Python Client for Google Cloud CDN. You can install the Python client using pip:
   ```
   pip install --upgrade google-cloud-cdn
   ```

2. **Authentication:**
   Authenticate your SDK using service account key file. You can set the environment variable 'GOOGLE_APPLICATION_CREDENTIALS' to the path of the JSON file that contains your service account key. This variable only applies to your current shell session, so if you open a new session, set the variable again.
   ```python
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"]="/path/to/keyfile.json"
   ```

3. **List all Backend Services:**
   Use the `list()` method of the `BackendServiceClient` class to list all the backend services in your project. This method returns an iterable of all backend services.
   ```python
   from google.cloud import compute_v1

   def list_backend_services():
       client = compute_v1.BackendServicesClient()
       project = 'my-project'  # replace with your project ID

       backend_services = client.list(project=project)
       for backend_service in backend_services:
           print(backend_service)
   ```

4. **Check Failover Policy:**
   For each backend service, check if the failover policy is enabled. The failover policy is represented by the `failoverPolicy` attribute of the `BackendService` object. If this attribute is `None` or does not exist, the failover policy is not enabled.
   ```python
   def check_failover_policy(backend_service):
       failover_policy = backend_service.failover_policy
       if failover_policy is None:
           print(f"Failover policy is not enabled for {backend_service.name}")
       else:
           print(f"Failover policy is enabled for {backend_service.name}")
   ```

Please note that the above scripts are for illustrative purposes and may need to be adjusted based on your specific requirements and environment.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" in GCP, please follow the below steps:

1. Login to the GCP console (https://console.cloud.google.com/).
2. Go to the Cloud CDN page by navigating to the "Navigation menu > Network Services > Cloud CDN".
3. Select the CDN resource for which you want to enable the failover policy.
4. Under the "Backend configuration" section, click on the "Edit" button.
5. Scroll down to the "Failover policy" section and click on the "Add failover endpoint" button.
6. Enter the details of the failover endpoint, such as the IP address, port, and protocol.
7. Click on the "Save" button to save the changes.

With these steps, you have successfully enabled the failover policy for the selected CDN resource in GCP.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the Google Cloud Console and select the project in which you want to remediate the misconfiguration.

2. Open the Cloud Shell by clicking on the icon on the top right corner of the console.

3. In the Cloud Shell, run the following command to list the existing backend services:

```
gcloud compute backend-services list
```

4. Identify the backend service that is associated with the Cloud CDN.

5. Run the following command to enable the failover policy for the identified backend service:

```
gcloud compute backend-services update [BACKEND_SERVICE_NAME] --global-backend-service --failover-policy=ENABLE
```

Replace [BACKEND_SERVICE_NAME] with the name of the identified backend service.

6. Verify that the failover policy is enabled by running the following command:

```
gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global
```

This command will display the details of the backend service, including the failover policy status.

By following these steps, you can remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using Python, follow the below steps:

Step 1: Import the required libraries and authenticate to GCP.

```
from google.oauth2 import service_account
from googleapiclient.discovery import build

# Set the credentials path for GCP
credentials = service_account.Credentials.from_service_account_file('credentials.json')

# Authenticate to GCP
service = build('compute', 'v1', credentials=credentials)
```

Step 2: Get the list of global backend services.

```
# Get the list of global backend services
backend_services = service.backendServices().list(project='your-project-id').execute()
```

Step 3: Loop through the backend services and check if the failover policy is enabled. If not, enable it.

```
for backend_service in backend_services['items']:
    # Check if failover policy is enabled
    if 'failoverPolicy' not in backend_service:
        # Enable failover policy
        backend_service['failoverPolicy'] = {
            'disableConnectionDrainOnFailover': False,
            'dropTrafficIfUnhealthy': False,
            'failoverRatio': 0.5,
            'status': 'ENABLED'
        }
        # Update the backend service with the failover policy
        service.backendServices().patch(project='your-project-id', backendService=backend_service['name'], body=backend_service).execute()
```

Step 4: Verify if the failover policy is enabled for all the global backend services.

```
# Get the list of global backend services after enabling failover policy
backend_services = service.backendServices().list(project='your-project-id').execute()

# Loop through the backend services and verify if failover policy is enabled
for backend_service in backend_services['items']:
    if 'failoverPolicy' not in backend_service:
        print(f"Failover policy is not enabled for {backend_service['name']}")
    else:
        print(f"Failover policy is enabled for {backend_service['name']}")
```

By following these steps, the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" can be remediated for GCP using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://cloud.google.com/cdn/docs/overview](https://cloud.google.com/cdn/docs/overview) 

