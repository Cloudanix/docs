---
slug: cdn_global_backend_services_failover_policy_enabled
title: Cloud CDN Global Backend Services Failover Policy Should Be Enabled
sidebar_label: Cloud CDN Global Backend Services Failover Policy Should Be Enabled
---

### More Info:

Ensure Cloud CDN global backend services have failover policy enabled.

### Risk Level

High

### Address

Operational Maturity, Performance Efficiency, Reliability, Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account that has the necessary permissions to access the GCP resources.

2. Navigate to Cloud CDN: From the main navigation menu, click on "Networking" and then select "Cloud CDN". This will take you to the Cloud CDN dashboard where you can see all the CDN resources associated with your GCP account.

3. Check Backend Services: In the Cloud CDN dashboard, look for the "Backend services" section. This section lists all the backend services associated with your Cloud CDN. Click on the name of the backend service that you want to check.

4. Check Failover Policy: In the backend service details page, look for the "Failover policy" section. If the failover policy is enabled, you will see details about the failover configuration. If it's not enabled, the section will be empty or will show a message indicating that the failover policy is not enabled.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your GCP account using the following command. This will open a new window in your web browser asking you to log in to your Google Cloud account.
   ```
   gcloud auth login
   ```

3. Set your project ID to the project you want to check. Replace 'your-project-id' with the ID of your project.
   ```
   gcloud config set project your-project-id
   ```

4. Run the following command to list all the backend services in your project and their failover policies. If the failover policy is not enabled, it means there is a misconfiguration.
   ```
   gcloud compute backend-services list --format="table(name, failoverPolicy)"
   ```
   This command will return a table with the names of all backend services and their failover policies. If the failover policy is not enabled for a service, it will be listed as 'None'.

#### Using Python

To check if the Cloud CDN Global Backend Services Failover Policy is enabled in Google Cloud Platform (GCP) using Python scripts, you can use the Google Cloud Client Library for Python. Here are the steps:

1. **Install the Google Cloud Client Library for Python:**
   You can install it using pip:
   ```
   pip install --upgrade google-cloud-compute
   ```

2. **Set up authentication:**
   Before you can interact with GCP services, you need to authenticate your client. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file.
   ```
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"]="/path/to/your/service-account-file.json"
   ```

3. **Initialize the Compute Engine client:**
   You can initialize the client as follows:
   ```
   from google.cloud import compute_v1
   client = compute_v1.BackendServicesClient()
   ```

4. **Check the failover policy for each backend service:**
   You can list all backend services and check the failover policy for each one. If the failover policy is not enabled, the `failoverPolicy` field will be `None`.
   ```
   project = 'your-project-id'
   for backend_service in client.list(project=project):
       if backend_service.failover_policy is None:
           print(f"Backend service {backend_service.name} does not have a failover policy enabled.")
   ```

This script will print the names of all backend services that do not have a failover policy enabled. If no such services are found, it will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" in GCP, please follow the below steps:

1. Login to the GCP console (https://console.cloud.google.com/).
2. Go to the Cloud CDN page by navigating to the "Navigation menu > Network Services > Cloud CDN".
3. Select the CDN resource for which you want to enable the failover policy.
4. Under the "Backend configuration" section, click on the "Edit" button.
5. Scroll down to the "Failover policy" section and click on the "Add failover endpoint" button.
6. Enter the details of the failover endpoint, such as the IP address, port, and protocol.
7. Click on the "Save" button to save the changes.

With these steps, you have successfully enabled the failover policy for the selected CDN resource in GCP.

#### Using CLI

To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the Google Cloud Console and select the project in which you want to remediate the misconfiguration.

2. Open the Cloud Shell by clicking on the icon on the top right corner of the console.

3. In the Cloud Shell, run the following command to list the existing backend services:

```
gcloud compute backend-services list
```

4. Identify the backend service that is associated with the Cloud CDN.

5. Run the following command to enable the failover policy for the identified backend service:

```
gcloud compute backend-services update [BACKEND_SERVICE_NAME] --global-backend-service --failover-policy=ENABLE
```

Replace [BACKEND_SERVICE_NAME] with the name of the identified backend service.

6. Verify that the failover policy is enabled by running the following command:

```
gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global
```

This command will display the details of the backend service, including the failover policy status.

By following these steps, you can remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" for GCP using Python, follow the below steps:

Step 1: Import the required libraries and authenticate to GCP.

```
from google.oauth2 import service_account
from googleapiclient.discovery import build

# Set the credentials path for GCP
credentials = service_account.Credentials.from_service_account_file('credentials.json')

# Authenticate to GCP
service = build('compute', 'v1', credentials=credentials)
```

Step 2: Get the list of global backend services.

```
# Get the list of global backend services
backend_services = service.backendServices().list(project='your-project-id').execute()
```

Step 3: Loop through the backend services and check if the failover policy is enabled. If not, enable it.

```
for backend_service in backend_services['items']:
    # Check if failover policy is enabled
    if 'failoverPolicy' not in backend_service:
        # Enable failover policy
        backend_service['failoverPolicy'] = {
            'disableConnectionDrainOnFailover': False,
            'dropTrafficIfUnhealthy': False,
            'failoverRatio': 0.5,
            'status': 'ENABLED'
        }
        # Update the backend service with the failover policy
        service.backendServices().patch(project='your-project-id', backendService=backend_service['name'], body=backend_service).execute()
```

Step 4: Verify if the failover policy is enabled for all the global backend services.

```
# Get the list of global backend services after enabling failover policy
backend_services = service.backendServices().list(project='your-project-id').execute()

# Loop through the backend services and verify if failover policy is enabled
for backend_service in backend_services['items']:
    if 'failoverPolicy' not in backend_service:
        print(f"Failover policy is not enabled for {backend_service['name']}")
    else:
        print(f"Failover policy is enabled for {backend_service['name']}")
```

By following these steps, the misconfiguration "Cloud CDN Global Backend Services Failover Policy Should Be Enabled" can be remediated for GCP using Python.


### Additional Reading:

- [https://cloud.google.com/cdn/docs/overview](https://cloud.google.com/cdn/docs/overview) 


</Tab>
</Tabs>