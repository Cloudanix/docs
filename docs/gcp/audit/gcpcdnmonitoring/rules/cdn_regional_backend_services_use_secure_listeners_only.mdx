---
slug: cdn_regional_backend_services_use_secure_listeners_only
title: Cloud CDN Regional Backend Services Should Use Secure Listeners Only
sidebar_label: Cloud CDN Regional Backend Services Should Use Secure Listeners Only
---

### More Info:

Cloud CDN regional backend services should use only the secure listeners. A listener is a process that checks for connection requests, using the protocol and port that you configure.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to Cloud CDN: From the main navigation menu, select "Networking" and then "Cloud CDN". This will take you to the Cloud CDN dashboard where you can view all your CDN configurations.

3. Check Backend Services: In the Cloud CDN dashboard, you will see a list of all your backend services. Click on the name of the backend service you want to inspect. This will open the backend service details page.

4. Inspect Listener Configuration: In the backend service details page, look for the "Frontend configuration" section. Here, you should see the protocol used by the listener (HTTP or HTTPS). If the protocol is HTTP, then the backend service is not using secure listeners. If the protocol is HTTPS, then the backend service is using secure listeners.
</Accordion>

<Accordion title='Using CLI'>
1. Install and authenticate the Google Cloud SDK CLI: You need to install the Google Cloud SDK on your local machine and authenticate it with your GCP account. You can do this by running the following commands:

   ```
   curl https://sdk.cloud.google.com | bash
   exec -l $SHELL
   gcloud init
   ```

2. List all the backend services: Once you have authenticated the Google Cloud SDK, you can list all the backend services in your project by running the following command:

   ```
   gcloud compute backend-services list
   ```

3. Get the details of each backend service: For each backend service, you can get its details by running the following command:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME]
   ```

   Replace `[BACKEND_SERVICE_NAME]` with the name of your backend service.

4. Check the protocol of the backend service: In the output of the previous command, look for the `protocol` field. If the protocol is not HTTPS, then the backend service is not using a secure listener.
</Accordion>

<Accordion title='Using Python'>
To check if Cloud CDN Regional Backend Services are using secure listeners only, you can use Google Cloud SDK (gcloud) or Google Cloud Client Libraries (Python). Here are the steps:

1. **Setup Google Cloud SDK and Authenticate:**
   Before you can interact with GCP resources, you need to authenticate your SDK. Use the following command to authenticate:
   ```
   gcloud auth login
   ```
   This will open a new browser window for you to log in to your Google account. Once logged in, your SDK will be authenticated to use the resources.

2. **Install Google Cloud Client Libraries:**
   You can install the Google Cloud Client Libraries for Python using pip. Use the following command to install:
   ```
   pip install --upgrade google-cloud-storage
   ```

3. **List all Backend Services:**
   Use the following Python script to list all backend services:
   ```python
   from google.cloud import storage

   def list_buckets():
       storage_client = storage.Client()
       buckets = storage_client.list_buckets()

       for bucket in buckets:
           print(bucket.name)

   list_buckets()
   ```
   This script will list all the buckets in your GCP project.

4. **Check for Secure Listeners:**
   Now, for each backend service, you need to check if it's using secure listeners only. You can do this by checking the protocol of the backend service. If the protocol is not HTTPS, then it's not using secure listeners. Here is a Python script to do this:
   ```python
   from google.cloud import compute_v1

   def check_backend_services():
       client = compute_v1.BackendServicesClient()
       project = 'my-project'  # replace with your project ID

       for backend_service in client.list(project=project):
           if backend_service.protocol != compute_v1.BackendService.Protocol.HTTPS:
               print(f"Backend service {backend_service.name} is not using secure listeners.")

   check_backend_services()
   ```
   This script will print the names of all backend services that are not using secure listeners.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the "Cloud CDN Regional Backend Services Should Use Secure Listeners Only" misconfiguration in GCP using the GCP console, please follow the below steps:

1. Open the Google Cloud Console and select the project in which the Cloud CDN has been configured.
2. In the left-hand side menu, click on "Cloud CDN".
3. In the Cloud CDN dashboard, click on the name of the CDN you want to modify.
4. In the CDN details page, click on the "Backend configuration" tab.
5. In the "Backend configuration" tab, click on the "Edit" button.
6. In the "Edit backend configuration" page, scroll down to the "Backend service" section.
7. In the "Backend service" section, click on the "Edit" button.
8. In the "Edit backend service" page, scroll down to the "Protocol" section.
9. In the "Protocol" section, select "HTTPS" from the drop-down list.
10. In the same section, select the "Port number" as per your requirement.
11. Click on the "Save" button to save the changes.
12. Repeat steps 5-11 for all the backend services used by the CDN.

By following the above steps, you have successfully remediated the "Cloud CDN Regional Backend Services Should Use Secure Listeners Only" misconfiguration in GCP using the GCP console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cloud CDN Regional Backend Services Should Use Secure Listeners Only" for GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell in your GCP console.

2. Run the following command to list all the backend services in your project:

   ```
   gcloud compute backend-services list
   ```

3. Identify the backend service that needs to be remediated and note down its name.

4. Run the following command to update the backend service and enable secure listeners:

   ```
   gcloud compute backend-services update <BACKEND_SERVICE_NAME> --enable-cdn --protocol HTTPS --global
   ```

   Replace `<BACKEND_SERVICE_NAME>` with the actual name of the backend service that needs to be remediated.

5. Verify the configuration by running the following command:

   ```
   gcloud compute backend-services describe <BACKEND_SERVICE_NAME> --global
   ```

   This command will display the details of the backend service, including the protocol and port used for the secure listener.

6. Repeat the above steps for all the backend services in your project that need to be remediated.

By following the above steps, you can remediate the misconfiguration "Cloud CDN Regional Backend Services Should Use Secure Listeners Only" for GCP using GCP CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Cloud CDN Regional Backend Services Should Use Secure Listeners Only" for GCP using Python, you can follow the below steps:

1. Import the required libraries:

```
from googleapiclient.discovery import build
from google.oauth2 import service_account
```

2. Set up the authentication using a service account:

```
credentials = service_account.Credentials.from_service_account_file(
    'path/to/service_account.json')
```

3. Build the Cloud CDN API client:

```
cdn = build('cdn', 'v1', credentials=credentials)
```

4. Get the list of backend services using the `projects().global().backendServices().list()` method:

```
backend_services = cdn.projects().global().backendServices().list(
    project='your-project-id').execute()
```

5. Loop through each backend service and check if it has a secure listener:

```
for backend_service in backend_services['items']:
    if '443' not in backend_service['port']:
        # Update the backend service to use a secure listener
        backend_service['port'].append('443')
        cdn.projects().global().backendServices().update(
            project='your-project-id',
            backendService=backend_service['name'],
            body=backend_service).execute()
```

6. Save the changes and exit the script.

Note: This script assumes that you have the necessary permissions to modify backend services in your GCP project.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://cloud.google.com/cdn/docs/setting-up-cdn-with-ex-backend-internet-neg](https://cloud.google.com/cdn/docs/setting-up-cdn-with-ex-backend-internet-neg) 

