---
slug: cdn_global_backend_services_cdn_enabled
title: Cloud CDN Global Backend Services CDN Should Be Enabled
sidebar_label: Cloud CDN Global Backend Services CDN Should Be Enabled
---

### More Info:

Ensure Cloud CDN global backend services have CDN enabled.

### Risk Level

High

### Address

Operational Maturity, Performance Efficiency, Reliability, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to the Load Balancing page: From the main navigation menu, click on the "Networking" option, then select "Load balancing" from the dropdown menu. This will take you to the Load Balancing page where you can view all your load balancers.

3. Check the Backend Services: On the Load Balancing page, click on the name of the load balancer you want to check. This will take you to the load balancer's details page. Here, click on the "Backend services & backend buckets" tab to view the backend services associated with the load balancer.

4. Check the CDN Status: For each backend service, check the "Cloud CDN" column. If the status is "Off", then the Cloud CDN is not enabled for that backend service. If the status is "On", then the Cloud CDN is enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your CLI with your Google Cloud account by running the following command:
   ```
   gcloud auth login
   ```
   Follow the prompts to log in with your Google account.

3. List all the backend services in your project by running the following command:
   ```
   gcloud compute backend-services list
   ```
   This will display a list of all backend services in your project.

4. For each backend service, check if the Cloud CDN is enabled by running the following command:
   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global
   ```
   Replace `[BACKEND_SERVICE_NAME]` with the name of your backend service. If the Cloud CDN is enabled, the `enableCDN` field in the output will be set to `true`. If it's not enabled, the field will be set to `false` or it won't be present in the output.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing your Python script, you need to install the necessary libraries. For this task, you will need the `google-cloud-storage` library. You can install it using pip:

```bash
pip install google-cloud-storage
```

2. Authenticate with GCP: Before you can interact with GCP resources, you need to authenticate. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key JSON file:

```bash
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/service-account-file.json"
```

3. Write the Python script: Now you can write a Python script that checks whether Cloud CDN is enabled for all global backend services. Here's a basic example:

```python
from google.cloud import storage

def check_cdn_enabled():
    client = storage.Client()
    buckets = client.list_buckets()

    for bucket in buckets:
        bucket_metadata = bucket.get_bucket(bucket.name)
        if 'cdnConfig' in bucket_metadata:
            cdn_config = bucket_metadata['cdnConfig']
            if not cdn_config['enabled']:
                print(f'CDN is not enabled for bucket: {bucket.name}')
        else:
            print(f'CDN is not configured for bucket: {bucket.name}')

if __name__ == '__main__':
    check_cdn_enabled()
```

This script lists all the buckets in your GCP project and checks whether Cloud CDN is enabled for each one. If Cloud CDN is not enabled or not configured for a bucket, it prints a message.

4. Run the Python script: Finally, you can run your Python script using the Python interpreter:

```bash
python check_cdn_enabled.py
```

This will print a message for each bucket where Cloud CDN is not enabled or not configured.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of "Cloud CDN Global Backend Services CDN Should Be Enabled" for GCP using GCP console, follow the below steps:

1. Open the Google Cloud Console and select the project where the misconfiguration exists.
2. In the left navigation menu, click on "Network services" and then select "Cloud CDN".
3. On the Cloud CDN page, click on the "Create" button.
4. In the "Create a new Cloud CDN" page, select the backend service that you want to enable CDN for.
5. Under the "Cache Key Policy" section, select "Include Host" and "Include Protocol".
6. Under the "Backend Buckets" section, select the backend bucket that you want to use as a source for the CDN.
7. Under the "Frontend Configurations" section, select the protocol and port that you want to use for the CDN.
8. Click on the "Create" button to create the CDN.

Once the CDN is created, it will take some time to propagate across all the CDN edge locations. You can verify the status of the CDN by checking the "Status" column on the Cloud CDN page.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cloud CDN Global Backend Services CDN Should Be Enabled" in GCP using GCP CLI, you can follow the below steps:

Step 1: Open the GCP console and navigate to the Cloud Console.

Step 2: Click on the Navigation menu and select "Cloud CDN".

Step 3: Select the "Global Backend Services" tab.

Step 4: Choose the backend service that you want to enable CDN for.

Step 5: Click on the "Edit" button on the top of the page.

Step 6: Scroll down to the "Cloud CDN" section.

Step 7: Toggle the button to enable the Cloud CDN.

Step 8: Click on the "Save" button to save the changes.

Step 9: Verify the changes by checking the status of the Cloud CDN.

You can also use the GCP CLI to enable the Cloud CDN for a backend service. Here are the steps:

Step 1: Open the GCP CLI and authenticate using your credentials.

Step 2: Run the following command to enable the Cloud CDN for a backend service:

```
gcloud compute backend-services update [BACKEND_SERVICE_NAME] --enable-cdn
```

Replace [BACKEND_SERVICE_NAME] with the name of your backend service.

Step 3: Verify the changes by checking the status of the Cloud CDN.

By following these steps, you can remediate the misconfiguration "Cloud CDN Global Backend Services CDN Should Be Enabled" in GCP using GCP CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Cloud CDN Global Backend Services CDN not being enabled in GCP using Python, you can follow the below steps:

1. First, you need to enable the Cloud CDN API in your GCP project. You can do this by navigating to the Cloud Console, selecting your project, and then navigating to APIs & Services > Dashboard. From there, click on "Enable APIs and Services" and search for "Cloud CDN API". Enable the API and wait for it to be enabled.

2. Once the API is enabled, you can use the Google Cloud Client Library for Python to programmatically create a backend service with Cloud CDN enabled. Install the library by running the following command in your terminal:

```python
pip install --upgrade google-cloud-storage
```

3. Next, you need to create a backend service using the Cloud CDN API. You can use the following Python code to create a backend service:

```python
from google.cloud import compute_v1

def create_backend_service(project_id, backend_service_name):
    client = compute_v1.BackendServicesClient()
    project = f"projects/{project_id}"
    backend_service_resource = {
        "name": backend_service_name,
        "cdn_policy": {
            "cache_key_policy": {
                "include_protocol": True,
                "include_query_string": True,
                "query_string_blacklist": ["*"]
            }
        }
    }
    response = client.insert(project=project, backend_service_resource=backend_service_resource)
    print(f"Backend service created: {response}")
```

4. Finally, you can call the `create_backend_service` function with your GCP project ID and the name of your new backend service:

```python
project_id = "your-project-id"
backend_service_name = "your-backend-service-name"
create_backend_service(project_id, backend_service_name)
```

This will create a new backend service with Cloud CDN enabled, and you can use it to serve content from your GCP project.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://cloud.google.com/cdn/docs/using-cdn](https://cloud.google.com/cdn/docs/using-cdn) 

