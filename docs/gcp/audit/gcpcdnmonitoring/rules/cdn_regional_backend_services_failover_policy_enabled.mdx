---
slug: cdn_regional_backend_services_failover_policy_enabled
title: Cloud CDN Regional Backend Services Failover Policy Should Be Enabled
sidebar_label: Cloud CDN Regional Backend Services Failover Policy Should Be Enabled
---

### More Info:

Ensure Cloud CDN regional backend services have failover policy enabled.

### Risk Level

High

### Address

Operational Maturity, Performance Efficiency, Reliability, Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to Cloud CDN: From the main dashboard of the Google Cloud Platform Console, click on the navigation menu (three horizontal lines) located at the top left corner of the page. Scroll down and click on "Network Services", then select "Cloud CDN".

3. Check Backend Services: In the Cloud CDN page, click on the "Backend services" tab. This will display a list of all the backend services associated with your Cloud CDN.

4. Check Failover Policy: For each backend service, check the "Failover policy" column. If the failover policy is not enabled (i.e., it is set to "None" or "Disabled"), then this is a misconfiguration. The failover policy should be enabled to ensure high availability and resilience of your applications.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Once the SDK is installed and configured, open your terminal or command prompt and use the following command to list all the backend services in your project:

   ```
   gcloud compute backend-services list
   ```

3. For each backend service, use the following command to describe its details:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME]
   ```
   Replace `[BACKEND_SERVICE_NAME]` with the name of your backend service.

4. In the output of the above command, look for the `failoverPolicy` field. If this field is not present or if it's set to `DISABLED`, then the Regional Backend Services Failover Policy is not enabled.

#### Using Python

To check if the Cloud CDN Regional Backend Services Failover Policy is enabled in CDN using Python scripts, you can follow these steps:

1. **Install Google Cloud SDK and Python Client for Google Cloud CDN:**
   Before you start, make sure you have installed the Google Cloud SDK and Python Client for Google Cloud CDN. You can install the Python client using pip:
   ```
   pip install --upgrade google-cloud-cdn
   ```

2. **Authentication:**
   Authenticate your SDK using service account key file. You can set the environment variable 'GOOGLE_APPLICATION_CREDENTIALS' to the path of the JSON file that contains your service account key. This variable only applies to your current shell session. If you want the variable to apply to future shell sessions, add the export statement to your shell profile file.
   ```
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/keyfile.json"
   ```

3. **List all Backend Services:**
   Use the `compute_backend_services` client to list all backend services. Here is a sample script:
   ```python
   from google.cloud import compute_v1

   def list_backend_services():
       client = compute_v1.BackendServicesClient()
       project = 'my-project'  # replace with your project ID

       response = client.list(project=project)
       for backend_service in response:
           print(backend_service)

   list_backend_services()
   ```

4. **Check Failover Policy:**
   For each backend service, check if the failover policy is enabled. The failover policy is enabled if the `failover_ratio` is greater than 0. Here is a sample script:
   ```python
   from google.cloud import compute_v1

   def check_failover_policy():
       client = compute_v1.BackendServicesClient()
       project = 'my-project'  # replace with your project ID

       response = client.list(project=project)
       for backend_service in response:
           if backend_service.failover_policy.failover_ratio > 0:
               print(f"Failover policy is enabled for {backend_service.name}")
           else:
               print(f"Failover policy is not enabled for {backend_service.name}")

   check_failover_policy()
   ```
   This script will print the names of all backend services and whether the failover policy is enabled for each one.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Cloud CDN Regional Backend Services Failover Policy Should Be Enabled" for GCP using GCP console, please follow the below steps:

1. Open the GCP console and navigate to the Cloud CDN page.
2. Select the CDN endpoint you want to remediate.
3. Click on the "Edit" button at the top of the page.
4. Scroll down to the "Backend services" section and click on the "Edit" button next to it.
5. Click on the "Advanced" tab.
6. Under "Failover policy", select the "Enabled" option.
7. Click on the "Save" button to save the changes.

By enabling the failover policy, the CDN endpoint will automatically switch to a backup backend service if the primary service becomes unavailable. This will ensure that your users continue to have access to your content even in the event of a backend service failure.

#### Using CLI

To remediate the misconfiguration "Cloud CDN Regional Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the GCP Cloud Shell in the GCP Console.

2. Run the following command to enable the failover policy for the regional backend services in Cloud CDN:

   ```
   gcloud compute backend-services update [BACKEND_SERVICE_NAME] --failover-policy=ALL_OR_FAIL
   ```

   Replace `[BACKEND_SERVICE_NAME]` with the name of the backend service that you want to update.

3. Verify that the failover policy has been enabled by running the following command:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME] | grep failoverPolicy
   ```

   This command should output the failover policy for the backend service.

   Note: If the output shows that the failover policy is not enabled, you may need to wait a few minutes for the changes to propagate.

4. Repeat steps 2 and 3 for all the regional backend services in Cloud CDN.

   Note: You can list all the regional backend services in Cloud CDN by running the following command:

   ```
   gcloud compute backend-services list --filter="loadBalancingScheme=EXTERNAL && protocol=HTTP && backends.service=cdn-backend"
   ```

   This command lists all the regional backend services that are used by Cloud CDN. Replace `cdn-backend` with the name of the backend service that you want to filter.

By following these steps, you can remediate the misconfiguration "Cloud CDN Regional Backend Services Failover Policy Should Be Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cloud CDN Regional Backend Services Failover Policy Should Be Enabled" in GCP using Python, follow these steps:

1. Import the necessary libraries:

```python
from googleapiclient.discovery import build
from google.oauth2 import service_account
```

2. Set up credentials:

```python
credentials = service_account.Credentials.from_service_account_file(
    'path/to/service_account.json')
```

3. Create a client object for the Cloud CDN API:

```python
cdn = build('cdn', 'v1beta2', credentials=credentials)
```

4. Get the list of existing backend services:

```python
project_id = 'your-project-id'
backend_services = cdn.projects().backendServices().list(project=project_id).execute()
```

5. For each backend service, check if the failover policy is enabled. If not, enable it:

```python
for backend_service in backend_services['items']:
    backend_service_name = backend_service['name']
    backend_service_region = backend_service['region']
    backend_service_config = cdn.projects().backendServices().get(project=project_id, backendService=backend_service_name).execute()
    if 'failoverPolicy' not in backend_service_config:
        failover_policy = {
            'disableConnectionDrainOnFailover': False,
            'dropTrafficIfUnhealthy': False,
            'failoverRatio': 0.5
        }
        cdn.projects().backendServices().patch(project=project_id, backendService=backend_service_name, body={'failoverPolicy': failover_policy}).execute()
```

6. Verify that the failover policy has been enabled for all backend services.

This code will enable the failover policy for all backend services in your GCP project. You can run this code periodically to ensure that the failover policy remains enabled for all backend services.


### Additional Reading:

- [https://cloud.google.com/cdn/docs/overview](https://cloud.google.com/cdn/docs/overview) 


</Tab>
</Tabs>