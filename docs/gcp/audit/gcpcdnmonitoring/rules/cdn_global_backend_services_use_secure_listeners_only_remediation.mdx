

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to Cloud CDN: From the left-hand side menu, select "Networking" and then "Cloud CDN". This will display a list of all the Cloud CDN resources associated with your account.

3. Check Backend Services: For each of the listed Cloud CDN resources, click on the name to open its details. Look for the "Backend services" section. This section lists all the backend services associated with the selected Cloud CDN resource.

4. Verify Secure Listeners: For each backend service, check the "Protocol" column. If the protocol is not HTTPS, then the backend service is not using secure listeners. Repeat this process for all backend services associated with all Cloud CDN resources.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI: You need to install the Google Cloud SDK on your local machine. After installation, authenticate the SDK to your Google Cloud account using the command `gcloud auth login`. This will open a new browser window where you can log in to your Google account.

2. List all the backend services: Use the following command to list all the backend services in your project:

    ```
    gcloud compute backend-services list --global
    ```

    This command will return a list of all the global backend services in your project.

3. Get the details of each backend service: For each backend service, use the following command to get its details:

    ```
    gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global
    ```

    Replace `[BACKEND_SERVICE_NAME]` with the name of your backend service. This command will return the details of the specified backend service.

4. Check the protocol of the backend service: In the details of the backend service, look for the `protocol` field. If the protocol is `HTTP`, then the backend service is not using a secure listener. If the protocol is `HTTPS` or `HTTP2`, then the backend service is using a secure listener.

#### Using Python

1. Install Google Cloud SDK and Python Client for Google Cloud CDN: Before you start, make sure you have installed Google Cloud SDK and authenticated it with your GCP account. Also, install the Python Client for Google Cloud CDN using pip:

   ```
   pip install --upgrade google-cloud-cdn
   ```

2. Import the necessary libraries and initialize the client:

   ```python
   from google.cloud import cdn
   client = cdn.CdnServiceClient()
   ```

3. Fetch all the backend services and check if they are using secure listeners:

   ```python
   project = 'projects/{}'.format('your-project-id')
   backends = client.list_backends(project=project)

   for backend in backends:
       if backend.protocol != 'HTTPS':
           print('Backend service {} is not using secure listeners'.format(backend.name))
   ```

4. The above script will print the names of all backend services that are not using HTTPS. If no such services are found, it means all your backend services are using secure listeners. If any services are found, you need to update their configurations to use HTTPS.

Remember to replace 'your-project-id' with your actual project ID.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Cloud CDN Global Backend Services Should Use Secure Listeners Only" in GCP using GCP console, you can follow the below steps:

1. Open the GCP console and navigate to the Cloud CDN page.

2. Select the Global Backend Services option from the left-hand menu.

3. Select the backend service that you want to configure for secure listeners.

4. Click on the Edit button at the top of the page.

5. Scroll down to the Protocol section and select HTTPS from the drop-down menu.

6. In the Certificate section, select the SSL certificate that you want to use for the secure listener.

7. Click on the Save button to save the changes.

8. Verify that the secure listener is configured correctly by testing the connection to the backend service using HTTPS.

By following these steps, you can successfully remediate the misconfiguration "Cloud CDN Global Backend Services Should Use Secure Listeners Only" in GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Cloud CDN Global Backend Services Should Use Secure Listeners Only" for GCP using GCP CLI, follow these steps:

1. Open the Google Cloud Console and select the project where the misconfiguration exists.

2. Open the Cloud Shell by clicking on the icon located at the top right corner of the console.

3. In the Cloud Shell, run the following command to list all the global backend services:

```
gcloud compute backend-services list
```

4. Identify the global backend service that needs to be remediated and note its name.

5. Run the following command to update the global backend service to use secure listeners only:

```
gcloud compute backend-services update <BACKEND_SERVICE_NAME> --global --enable-cdn-ssl
```

Replace `<BACKEND_SERVICE_NAME>` with the name of the global backend service identified in step 4.

6. Verify that the global backend service has been updated to use secure listeners only by running the following command:

```
gcloud compute backend-services describe <BACKEND_SERVICE_NAME> --global
```

This command will display the details of the global backend service, including its configuration.

7. Repeat steps 4-6 for all the global backend services that need to be remediated.

By following these steps, you can remediate the misconfiguration "Cloud CDN Global Backend Services Should Use Secure Listeners Only" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cloud CDN Global Backend Services Should Use Secure Listeners Only" for GCP using Python, you can follow these steps:

1. Import the necessary libraries:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials
```

2. Authenticate and create a client object:

```python
credentials = GoogleCredentials.get_application_default()
service = discovery.build('compute', 'v1', credentials=credentials)
```

3. Get the list of backend services:

```python
project = 'your-project-id'
zone = 'your-zone'
request = service.backendServices().list(project=project, zone=zone)
response = request.execute()
backend_services = response['items']
```

4. Iterate through the list of backend services and update the backend service to use secure listeners only:

```python
for backend_service in backend_services:
    backend_service_name = backend_service['name']
    backend_service_url_map = backend_service['backends'][0]['group']
    request = service.backendServices().get(project=project, backendService=backend_service_name, zone=zone)
    response = request.execute()
    backend_service = response
    if 'sslSettings' not in backend_service:
        backend_service['sslSettings'] = {}
    backend_service['sslSettings']['sslCertificates'] = []
    backend_service['sslSettings']['customCertificateHeaders'] = []
    backend_service['sslSettings']['backendServiceProtocol'] = 'HTTPS'
    request = service.backendServices().update(project=project, backendService=backend_service_name, body=backend_service, zone=zone)
    response = request.execute()
    print(f"Backend service {backend_service_name} updated to use secure listeners only.")
```

This code will update all the backend services in the specified project and zone to use secure listeners only.


</Tab>
</Tabs>