---
slug: cdn_regional_backend_services_logging_enabled
title: Cloud CDN Regional Backend Services Should Have Logging Enabled
sidebar_label: Cloud CDN Regional Backend Services Should Have Logging Enabled
---

### More Info:

Cloud CDN regional backend services should have request logging enabled. Logging requests to Cloud CDN endpoints is a helpful way of detecting and investigating potential attacks.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

GDPR, HITRUST, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to Cloud CDN: From the main navigation menu, select "Networking" and then "Cloud CDN". This will take you to the Cloud CDN dashboard where you can view all your CDN configurations.

3. Check Backend Services: In the Cloud CDN dashboard, you will see a list of all your backend services. Click on the name of the backend service you want to check. This will open the backend service details page.

4. Check Logging Status: In the backend service details page, look for the "Logging" section. If logging is enabled, you will see "Logging: On". If it is not enabled, you will see "Logging: Off". This indicates that the Cloud CDN Regional Backend Service does not have logging enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download it from the official Google Cloud website and follow the instructions to install and initialize it.

2. List all the backend services: Use the following command to list all the backend services in your project:

   ```
   gcloud compute backend-services list
   ```

   This command will return a list of all backend services along with their details.

3. Get the details of a specific backend service: To check the logging status of a specific backend service, you need to get its details using the following command:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME]
   ```

   Replace [BACKEND_SERVICE_NAME] with the name of your backend service. This command will return the details of the specified backend service.

4. Check the logging status: In the output of the previous command, look for the "enableCDN" and "logConfig" fields. If "enableCDN" is set to true and "logConfig" is set to "enable: false" or is not present, then logging is not enabled for that backend service.
</Accordion>

<Accordion title='Using Python'>
To check if Cloud CDN Regional Backend Services have logging enabled in Google Cloud Platform (GCP) using Python scripts, you can use the Google Cloud Client Library for Python. Here are the steps:

1. **Install the Google Cloud Client Library for Python:**
   You can install it using pip:
   ```
   pip install --upgrade google-cloud-storage
   ```

2. **Set up authentication:**
   Before you can interact with GCP services, you need to authenticate your client. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key JSON file.
   ```
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"]="/path/to/your/service-account-file.json"
   ```

3. **Initialize the Cloud Storage client:**
   Once you've authenticated your client, you can initialize the Cloud Storage client.
   ```
   from google.cloud import storage
   client = storage.Client()
   ```

4. **Check if logging is enabled for each backend service:**
   You can iterate over all the backend services in your project and check if logging is enabled for each one. If the `logging` field is `None`, then logging is not enabled.
   ```
   def check_logging_enabled():
       for bucket in client.list_buckets():
           bucket_logging = bucket.get_logging()
           if bucket_logging is None:
               print(f"Logging is not enabled for bucket: {bucket.name}")
           else:
               print(f"Logging is enabled for bucket: {bucket.name}")

   check_logging_enabled()
   ```
   This script will print the names of all the buckets in your project and whether logging is enabled for each one.

Please note that this script only checks for logging at the bucket level. If you have specific backend services within your buckets, you may need to modify the script to check for logging at the service level.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of "Cloud CDN Regional Backend Services Should Have Logging Enabled" for GCP using the GCP console, follow the below steps:

1. Open the Google Cloud Console and navigate to the Cloud CDN page.
2. Select the name of the CDN that you want to remediate.
3. In the left-hand menu, select the "Backend services" option.
4. Click on the name of the backend service that you want to remediate.
5. In the backend service page, scroll down to the "Cloud Logging" section.
6. Click on the "Add Log Sink" button.
7. In the "Create Sink" page, enter a name for the log sink.
8. In the "Sink Service" section, select "Cloud Logging".
9. In the "Sink Destination" section, select the destination where you want to send the logs.
10. In the "Filter" section, specify the filter criteria for the logs that you want to send to the destination.
11. Click on the "Create" button to create the log sink.

Once the log sink is created, all the logs generated by the backend service will be sent to the specified destination. This will remediate the misconfiguration of "Cloud CDN Regional Backend Services Should Have Logging Enabled" for GCP.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cloud CDN Regional Backend Services Should Have Logging Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the Google Cloud SDK Shell and connect to your GCP project using the command:

   `gcloud init`

2. Enable the Cloud CDN API using the command:

   `gcloud services enable compute.googleapis.com`

3. Create a logging sink using the command:

   `gcloud logging sinks create [SINK_NAME] storage.googleapis.com/[BUCKET_NAME] --log-filter='resource.type="http_load_balancer" AND resource.labels.forwarding_rule_name="[FORWARDING_RULE_NAME]"'`

   Replace `[SINK_NAME]` with a name for your logging sink, `[BUCKET_NAME]` with the name of the GCP storage bucket where you want to store the logs, and `[FORWARDING_RULE_NAME]` with the name of the forwarding rule associated with the regional backend service.

4. Grant the `logging.logWriter` IAM role to the Cloud Logging service account using the command:

   `gcloud projects add-iam-policy-binding [PROJECT_ID] --member='serviceAccount:[SINK_NAME]@[PROJECT_ID].iam.gserviceaccount.com' --role='roles/logging.logWriter'`

   Replace `[PROJECT_ID]` with your GCP project ID and `[SINK_NAME]` with the name of your logging sink.

5. Update the regional backend service to enable logging using the command:

   `gcloud compute backend-services update [BACKEND_SERVICE_NAME] --enable-cdn-logging --cdn-logging-sink=[SINK_NAME]`

   Replace `[BACKEND_SERVICE_NAME]` with the name of the regional backend service and `[SINK_NAME]` with the name of the logging sink created in step 3.

6. Verify that logging is enabled for the regional backend service by checking the logs in the GCP storage bucket specified in step 3.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Cloud CDN Regional Backend Services Should Have Logging Enabled" for GCP using Python, you can follow the below steps:

Step 1: Import the necessary libraries

```
from googleapiclient.discovery import build
from google.oauth2 import service_account
```

Step 2: Set up the authentication credentials

```
credentials = service_account.Credentials.from_service_account_file('<path_to_service_account_file>')
project_id = '<your_project_id>'
```

Step 3: Create a function to enable logging for the backend service

```
def enable_backend_service_logging(service_name, backend_service_name):
    service = build('compute', 'v1', credentials=credentials)
    backend_service = service.backendServices().get(project=project_id, backendService=backend_service_name).execute()
    backend_service['logConfig'] = {
        'enable': True,
        'sampleRate': 1.0
    }
    response = service.backendServices().update(project=project_id, backendService=backend_service_name, body=backend_service).execute()
    print(f'Logging enabled for backend service {backend_service_name}')
```

Step 4: Call the function with the appropriate parameters

```
enable_backend_service_logging('compute', '<backend_service_name>')
```

Note: Replace `<path_to_service_account_file>`, `<your_project_id>`, and `<backend_service_name>` with the appropriate values.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://cloud.google.com/cdn/docs/logging](https://cloud.google.com/cdn/docs/logging) 

