---
slug: function_has_dlq_configured
title: Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions
sidebar_label: Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions
---

### More Info:

The DLQ should be configured for cloud function topic's subscriptions

### Risk Level

Low

### Address

Reliability', Performance Efficiency, Security

### Compliance Standards

HIPAA, SOC2, PCIDSS, NIST


### Triage and Remediation
<Tabs>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step by step instructions to remediate the cloud misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using GCP console:

1. Open the Google Cloud Console and navigate to the Cloud Functions section.

2. Select the function that needs to be remediated and click on its name to open its details.

3. In the details page, click on the "Triggers" tab and select the Pub/Sub trigger that needs to be remediated.

4. Scroll down to the "Advanced" section and click on the "Edit" button.

5. In the "Edit trigger" dialog box, scroll down to the "Retry settings" section.

6. Enable the "Dead-letter topic" option and select the Pub/Sub topic that will receive the failed messages.

7. Optionally, you can also set the maximum number of retries and the minimum backoff duration before the message is sent to the dead-letter topic.

8. Click on the "Save" button to save the changes.

9. Repeat the above steps for all the Pub/Sub triggers that need to be remediated.

By following these steps, you will be able to remediate the cloud misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using GCP console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using GCP CLI, follow the below steps:

1. Open the Cloud Shell in the GCP Console.

2. Set the environment variables for the project ID and region where the Cloud Function is deployed. Replace `[PROJECT_ID]` and `[REGION]` with the appropriate values.

```
export PROJECT_ID=[PROJECT_ID]
export REGION=[REGION]
```

3. List all the Pub/Sub subscriptions in the project by running the following command:

```
gcloud pubsub subscriptions list --project $PROJECT_ID
```

4. Identify the subscription that is associated with the Cloud Function that needs to be remediated.

5. Enable the dead-letter topic for the subscription by running the following command:

```
gcloud pubsub subscriptions update [SUBSCRIPTION_NAME] --project $PROJECT_ID --dead-letter-topic=[DEAD_LETTER_TOPIC] --dead-letter-topic-project=[DEAD_LETTER_TOPIC_PROJECT]
```

Replace `[SUBSCRIPTION_NAME]` with the name of the subscription identified in Step 4. Replace `[DEAD_LETTER_TOPIC]` and `[DEAD_LETTER_TOPIC_PROJECT]` with the name of the dead-letter topic and the project ID where the dead-letter topic is located, respectively.

6. Verify that the dead-letter topic is enabled for the subscription by running the following command:

```
gcloud pubsub subscriptions describe [SUBSCRIPTION_NAME] --project $PROJECT_ID --format="value(deadLetterPolicy.deadLetterTopic)"
```

Replace `[SUBSCRIPTION_NAME]` with the name of the subscription identified in Step 4.

7. Repeat the above steps for all the Pub/Sub subscriptions that are associated with the Cloud Function.

By following the above steps, you can remediate the misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using GCP CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using Python, you can follow the below steps:

1. Identify the Cloud Functions that are using Pub/Sub subscriptions. You can use the GCP Console or the Cloud SDK command `gcloud functions list` to list all the Cloud Functions in your project.

2. For each Cloud Function that is using Pub/Sub subscription, check if it has a Dead Letter Queue configured. You can use the Cloud SDK command `gcloud functions event-types list` to list all the event types for a Cloud Function. If the event type is `google.pubsub.topic.publish`, then the Cloud Function is using Pub/Sub subscription.

3. If the Cloud Function is using Pub/Sub subscription, check if it has a Dead Letter Queue configured. You can use the Cloud SDK command `gcloud functions describe <function-name>` to get the details of a Cloud Function. Look for the `deadLetterPolicy` field in the output. If it is not present or is empty, then the Cloud Function does not have a Dead Letter Queue configured.

4. To configure a Dead Letter Queue for the Cloud Function, you can use the Cloud SDK command `gcloud functions deploy <function-name> --update-labels dead-letter-topic=<dead-letter-topic>`. Replace `<function-name>` with the name of the Cloud Function and `<dead-letter-topic>` with the name of the Pub/Sub topic where you want to send the dead-letter messages.

5. After deploying the Cloud Function with the Dead Letter Queue configuration, you can use the Cloud SDK command `gcloud functions describe <function-name>` to verify that the `deadLetterPolicy` field is set correctly.

By following these steps, you can remediate the misconfiguration "Cloud Functions Should Have Dead Letter Queue Configured For Pub/Sub Subscriptions" for GCP using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://cloud.google.com/pubsub/docs/samples/pubsub-dead-letter-create-subscription](https://cloud.google.com/pubsub/docs/samples/pubsub-dead-letter-create-subscription) 

