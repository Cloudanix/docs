---
slug: k8_cluster_master_global_access
title: Cluster Master Endpoint Should Not Be Global
sidebar_label: Cluster Master Endpoint Should Not Be Global
---

### More Info:

Ensure that the endpoint of cluster master in not public

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. Here, you will find a list of all your Kubernetes clusters.

3. Click on the name of the cluster you want to inspect. This will take you to the cluster's details page.

4. In the details page, look for the "Master endpoint" section. If the IP address listed is a public IP address, then the cluster master endpoint is global. If it's a private IP address, then it's not global.

#### Using CLI

1. Install and configure Google Cloud SDK on your local machine. This will provide you with the necessary command-line tools to interact with resources hosted on Google Cloud Platform (GCP). You can download it from the official Google Cloud website and install it following the instructions provided.

2. Once the SDK is installed, authenticate your GCP account using the following command:
   ```
   gcloud auth login
   ```
   This will open a new window in your web browser asking you to log in with your Google account. Once you've logged in, you can close the window and return to the command line.

3. Set your project ID to the project you want to check. Replace `your_project_id` with your actual project ID.
   ```
   gcloud config set project your_project_id
   ```

4. Now, you can list all the Kubernetes clusters in your project and check their master authorized networks configurations. The following command will list all clusters along with their details:
   ```
   gcloud container clusters list --format='table(name, endpoint, locations, masterAuthorizedNetworksConfig.cidrBlocks.scope)'
   ```
   In the output, check the `masterAuthorizedNetworksConfig.cidrBlocks.scope` field. If it is set to `global`, then the cluster master endpoint is global.

#### Using Python

1. Install the necessary Python libraries: You will need the Kubernetes Python client to interact with the Kubernetes API. You can install it using pip:

```python
pip install kubernetes
```

2. Import the necessary modules and configure the Kubernetes client:

```python
from kubernetes import client, config

# Load the kube config from the default location (i.e., ~/.kube/config)
config.load_kube_config()
```

3. Create a function to check the master endpoint:

```python
def check_master_endpoint():
    v1 = client.CoreV1Api()
    services = v1.list_service_for_all_namespaces(watch=False)
    for service in services.items:
        if service.metadata.name == 'kubernetes':
            if service.spec.type == 'LoadBalancer':
                print("Master endpoint is global")
            else:
                print("Master endpoint is not global")
```

4. Call the function to check the master endpoint:

```python
check_master_endpoint()
```

This script will check if the Kubernetes master endpoint is exposed globally by checking if the Kubernetes service is of type 'LoadBalancer'. If it is, it means that the master endpoint is global, which is a misconfiguration. If it's not, then the master endpoint is not global.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Cluster Master Endpoint Should Not Be Global" for GCP using GCP console, follow the below steps:

1. Go to the Google Kubernetes Engine (GKE) console.
2. Select the cluster for which you want to remediate the misconfiguration.
3. Click on the "Edit" button on the top of the page.
4. Scroll down to the "Endpoint" section.
5. Under the "Master endpoint" section, select the "Regional" option.
6. Select the region where your cluster is located.
7. Click on the "Save" button to apply the changes.

Once you have completed these steps, your cluster master endpoint will no longer be global and will be limited to the selected region. This will help to reduce the attack surface and improve the security of your GKE cluster.

#### Using CLI

To remediate the misconfiguration "Cluster Master Endpoint Should Not Be Global" for GCP using GCP CLI, follow the below steps:

1. Open the Google Cloud Console and navigate to the Kubernetes Engine.

2. Select the cluster that you want to remediate.

3. Click on the "Edit" button at the top of the page.

4. Scroll down to the "Master endpoint" section.

5. Click on the "Customize" button next to the "Master endpoint" field.

6. Select "Regional" from the dropdown menu.

7. Choose the region where you want to create the endpoint.

8. Click on the "Save" button.

9. Verify that the endpoint has been updated to the regional endpoint by running the following command in the GCP CLI:

```
gcloud container clusters describe [CLUSTER_NAME] --zone [ZONE]
```

Replace [CLUSTER_NAME] and [ZONE] with your cluster name and zone respectively.

10. Ensure that the endpoint is not global by running the following command:

```
gcloud container clusters describe [CLUSTER_NAME] --zone [ZONE] | grep endpoint
```

If the endpoint is not global, you will see the regional endpoint in the output.

By following these steps, you will remediate the misconfiguration "Cluster Master Endpoint Should Not Be Global" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Cluster Master Endpoint Should Not Be Global" for GCP using Python, you can follow the below steps:

Step 1: Install the necessary libraries

```
!pip install google-cloud-container
```

Step 2: Import the necessary libraries

```python
from google.cloud import container_v1
from google.oauth2 import service_account
```

Step 3: Set up the credentials for authentication

```python
credentials = service_account.Credentials.from_service_account_file('path/to/your/credentials.json')
```

Step 4: Create a client object for the Container API

```python
client = container_v1.ClusterManagerClient(credentials=credentials)
```

Step 5: Get the cluster details

```python
project_id = 'your-project-id'
zone = 'your-zone'
cluster_id = 'your-cluster-id'

cluster = client.get_cluster(project_id, zone, cluster_id)
```

Step 6: Check if the master endpoint is global

```python
if cluster.endpoint == 'global':
    cluster.endpoint = 'regional'
    update_request = container_v1.types.UpdateClusterRequest(cluster=cluster, update_mask={'paths':['endpoint']})
    operation = client.update_cluster(update_request)
    operation.result()
```

Step 7: Verify if the master endpoint is updated to regional

```python
updated_cluster = client.get_cluster(project_id, zone, cluster_id)
print(f"Master endpoint is now {updated_cluster.endpoint}")
```

By following these steps, you can remediate the misconfiguration "Cluster Master Endpoint Should Not Be Global" for GCP using Python.


### Additional Reading:

- [https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters](https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters) 


</Tab>
</Tabs>