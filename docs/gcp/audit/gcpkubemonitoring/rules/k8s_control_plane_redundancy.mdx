---
slug: k8s_control_plane_redundancy
title: Enable Regional Redundancy For Maximum Availability
sidebar_label: Enable Regional Redundancy For Maximum Availability
---

### More Info:

GKE cluster should be regional for maximum availability of control plane during upgrades and zonal outages

### Risk Level

High

### Address

Security, Reliability, Operational Excellence, Performance Efficiency

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. Here, you will find a list of all your Kubernetes clusters.

3. Click on the specific Kubernetes cluster for which you want to check the regional redundancy.

4. In the cluster details page, look for the "Location type" field. If the location type is set to "Zonal", it means that the cluster is not regionally redundant. If it is set to "Regional", it means that the cluster is regionally redundant.

5. Additionally, you can check the "Locations" field. If multiple zones are listed, it indicates that the cluster is regionally redundant. If only one zone is listed, it indicates that the cluster is not regionally redundant.

#### Using CLI

1. First, you need to install and configure Google Cloud SDK (if not already done). You can download it from the official Google Cloud website and follow the instructions to install it. Once installed, authenticate it with your Google Cloud account using the command: 
```
gcloud auth login
```

2. After setting up the Google Cloud SDK, you can list all the running clusters in your project with the following command:
```
gcloud container clusters list
```
This command will display all the clusters along with their details like name, location, master version, etc.

3. To check if regional redundancy is enabled for a specific cluster, you need to check the location of the cluster. If the location is a region (like us-central1), then regional redundancy is enabled. If the location is a zone (like us-central1-a), then regional redundancy is not enabled. You can get the location of a cluster with the following command:
```
gcloud container clusters describe [CLUSTER_NAME] --format='value(location)'
```
Replace [CLUSTER_NAME] with the name of your cluster.

4. To check the regional redundancy for all clusters, you can use a loop in the shell script. Here is an example:
```
for cluster in $(gcloud container clusters list --format='value(name)'); do
  location=$(gcloud container clusters describe $cluster --format='value(location)')
  if [[ $location == *-*-* ]]; then
    echo "Cluster $cluster does not have regional redundancy enabled. Location: $location"
  else
    echo "Cluster $cluster has regional redundancy enabled. Location: $location"
  fi
done
```
This script will list all the clusters and their regional redundancy status.

#### Using Python

To check if regional redundancy is enabled for maximum availability in Kubernetes, you can use the Kubernetes Python client. Here are the steps:

1. **Install the Kubernetes Python Client:**
   You can install the Kubernetes Python client using pip:
   ```
   pip install kubernetes
   ```
2. **Configure Access to the Kubernetes Cluster:**
   You need to configure your access to the Kubernetes cluster. If you're running the script from a machine that's outside the cluster, you'll need to provide the path to your kubeconfig file:
   ```python
   from kubernetes import client, config

   config.load_kube_config('/path/to/your/kubeconfig/file')
   ```
   If you're running the script from within the cluster (e.g., from a pod), you can use the following code to configure access:
   ```python
   from kubernetes import client, config

   config.load_incluster_config()
   ```
3. **Get the List of Nodes:**
   You can get the list of nodes in the cluster using the `list_node` method of the `CoreV1Api` class:
   ```python
   from kubernetes import client, config

   config.load_kube_config('/path/to/your/kubeconfig/file')

   v1 = client.CoreV1Api()
   print("Listing nodes with their info:")
   ret = v1.list_node(pretty=True)
   for i in ret.items:
       print("%s\t%s\t%s" % (i.status.node_info.kubelet_version, i.metadata.name, i.status.node_info.os_image))
   ```
4. **Check the Regions of the Nodes:**
   To check if regional redundancy is enabled, you need to check if the nodes are spread across multiple regions. This information is usually available in the labels of the nodes. However, the exact label can vary depending on the cloud provider. For example, on GCP, the label is `failure-domain.beta.kubernetes.io/region`. You can check the labels of the nodes as follows:
   ```python
   from kubernetes import client, config

   config.load_kube_config('/path/to/your/kubeconfig/file')

   v1 = client.CoreV1Api()
   print("Listing nodes with their info:")
   ret = v1.list_node(pretty=True)
   regions = set()
   for i in ret.items:
       region = i.metadata.labels.get('failure-domain.beta.kubernetes.io/region')
       if region:
           regions.add(region)

   if len(regions) > 1:
       print("Regional redundancy is enabled.")
   else:
       print("Regional redundancy is not enabled.")
   ```
   This script checks if there are nodes in more than one region. If there are, it prints that regional redundancy is enabled. Otherwise, it prints that regional redundancy is not enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To enable regional redundancy for maximum availability in GCP, follow these step-by-step instructions:

1. Open the GCP Console and select the project where you want to enable regional redundancy.

2. Go to the Cloud Storage section of the console.

3. Select the bucket for which you want to enable regional redundancy.

4. Click on the "Edit bucket" button at the top of the page.

5. Scroll down to the "Location" section of the page.

6. Select "Regional" from the dropdown menu.

7. Choose the region where you want to store your data.

8. Click on the "Save" button at the bottom of the page.

9. Wait for the changes to take effect. This may take some time depending on the amount of data you have stored in your bucket.

Once you have completed these steps, your bucket will be configured for regional redundancy, which means that your data will be stored in multiple locations within the same region for maximum availability.

#### Using CLI

To enable regional redundancy for maximum availability in GCP, follow these steps using GCP CLI:

1. Open the Google Cloud Console and select the project that contains the resources you want to configure.

2. Open the Cloud Shell by clicking on the "Activate Cloud Shell" button on the top right corner of the console.

3. Run the following command to enable regional redundancy for Cloud Storage:

   ```
   gsutil versioning set on gs://[BUCKET_NAME]
   ```
   Replace [BUCKET_NAME] with the name of the bucket you want to enable regional redundancy for.

4. Run the following command to enable regional redundancy for Cloud SQL:

   ```
   gcloud sql instances patch [INSTANCE_NAME] --availability-type REGIONAL
   ```
   Replace [INSTANCE_NAME] with the name of the Cloud SQL instance you want to enable regional redundancy for.

5. Run the following command to enable regional redundancy for Compute Engine:

   ```
   gcloud compute instances create [INSTANCE_NAME] --zone [ZONE] --create-disk=auto-delete=yes,boot=yes,mode=rw,name=[DISK_NAME],replica-zones=[ZONE_1],[ZONE_2],type=pd-ssd
   ```
   Replace [INSTANCE_NAME] with the name of the Compute Engine instance you want to enable regional redundancy for. Replace [ZONE] with the primary zone for the instance. Replace [DISK_NAME] with the name of the boot disk for the instance. Replace [ZONE_1] and [ZONE_2] with the two additional zones you want to replicate the instance to.

By following these steps, you can enable regional redundancy for maximum availability in GCP.

#### Using Python

To enable regional redundancy for maximum availability in GCP using Python, you can follow these steps:

1. Import the necessary libraries:

```
from google.cloud import storage
```

2. Create a client object for the storage bucket:

```
client = storage.Client()
```

3. Get the bucket object:

```
bucket = client.get_bucket('your-bucket-name')
```

4. Set the location type to regional:

```
bucket.location_type = 'regional'
```

5. Set the location to the desired region:

```
bucket.location = 'your-region'
```

6. Update the bucket:

```
bucket.update()
```

7. Confirm that the bucket is now using regional redundancy by checking the bucket's location type:

```
print(bucket.location_type)
```

This should output "REGIONAL", indicating that the bucket is now using regional redundancy.

Note: Replace "your-bucket-name" and "your-region" with the actual name of your bucket and the desired region, respectively.




</Tab>
</Tabs>