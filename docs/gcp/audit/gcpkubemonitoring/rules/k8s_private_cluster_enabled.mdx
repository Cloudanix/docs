---
slug: k8s_private_cluster_enabled
title: Private Cluster Should Be Enabled
sidebar_label: Private Cluster Should Be Enabled
---

### More Info:

Ensures private cluster is enabled for all Kubernetes clusters. Kubernetes private clusters only have internal ip ranges, which ensures that their workloads are isolated from the public internet.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. You can do this by clicking on the hamburger menu on the top left corner, then select "Kubernetes Engine" from the drop-down menu.

3. In the Kubernetes Engine page, you will see a list of all your Kubernetes clusters. Click on the name of the cluster you want to inspect.

4. In the cluster details page, look for the "Private cluster" field under the "Cluster details" section. If the field is set to "Disabled", then the private cluster is not enabled. If it's set to "Enabled", then the private cluster is enabled.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to install it. Once installed, authenticate your Google Cloud account by running the following command in your terminal:

   ```
   gcloud auth login
   ```

2. Set your default project to the project you want to check for misconfigurations. Replace `PROJECT_ID` with your actual project ID:

   ```
   gcloud config set project PROJECT_ID
   ```

3. List all the Kubernetes clusters in your project by running the following command:

   ```
   gcloud container clusters list
   ```

4. For each cluster, check if the private cluster is enabled by running the following command. Replace `CLUSTER_NAME` and `ZONE` with your actual cluster name and zone:

   ```
   gcloud container clusters describe CLUSTER_NAME --zone=ZONE --format='value(privateClusterConfig.enablePrivateNodes)'
   ```

   If the output of this command is `true`, then the private cluster is enabled. If the output is `false` or the command returns nothing, then the private cluster is not enabled.

#### Using Python

1. Install the necessary Python libraries:
   You will need the Kubernetes Python client library to interact with the Kubernetes API. You can install it using pip:
   ```
   pip install kubernetes
   ```

2. Import the necessary modules and configure the Kubernetes client:
   You will need to import the Kubernetes client and configure it to connect to your cluster. Here is an example of how to do this:

   ```python
   from kubernetes import client, config

   # Load the kube config from the default location
   config.load_kube_config()
   ```

3. Get the list of clusters:
   You can use the `list_cluster` method of the `ContainerV1Api` class to get the list of clusters. Here is an example:

   ```python
   v1 = client.CoreV1Api()
   print("Listing clusters with their info:")
   for cluster in v1.list_cluster().items:
       print("%s\t%s\t%s" % (cluster.metadata.name, cluster.status.phase, cluster.spec.private_cluster_config))
   ```

4. Check if the private cluster is enabled:
   You can check if the private cluster is enabled by checking the `enable_private_nodes` attribute of the `private_cluster_config` object. Here is an example:

   ```python
   for cluster in v1.list_cluster().items:
       if cluster.spec.private_cluster_config and cluster.spec.private_cluster_config.enable_private_nodes:
           print("Private cluster is enabled for cluster %s" % cluster.metadata.name)
       else:
           print("Private cluster is not enabled for cluster %s" % cluster.metadata.name)
   ```

This script will print out the names of all clusters and whether or not the private cluster is enabled for each one.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Private Cluster Should Be Enabled" misconfiguration in GCP using the GCP console, follow these steps:

1. Open the GCP Console and navigate to the Kubernetes Engine page.
2. Select the cluster that you want to remediate and click on the "Edit" button.
3. Scroll down to the "Networking" section and click on "Show advanced options".
4. Under "Private cluster", select the checkbox for "Enable private endpoint".
5. Optionally, you can also enable "Private nodes" and "Private endpoint with DNS zone".
6. Click on "Save" to apply the changes.

By enabling private endpoint in GCP Kubernetes Engine, you are ensuring that your cluster is only accessible from a private IP address range and not from the public internet. This will help to protect your cluster from unauthorized access and potential security threats.

#### Using CLI

To remediate the misconfiguration "Private Cluster Should Be Enabled" for GCP using GCP CLI, follow the below steps:

1. Open the GCP Console and navigate to the Google Kubernetes Engine (GKE) cluster that needs to be remediated.

2. Open the Cloud Shell by clicking on the icon on the top right corner of the console.

3. In the Cloud Shell, run the following command to enable private cluster:

```
gcloud container clusters update [CLUSTER_NAME] --enable-private-nodes --master-ipv4-cidr [MASTER_CIDR] --enable-private-endpoint
```

Replace `[CLUSTER_NAME]` with the name of the GKE cluster that needs to be remediated and `[MASTER_CIDR]` with the IP range for the master node.

4. If you want to enable private nodes for an existing cluster, run the following command:

```
gcloud container clusters update [CLUSTER_NAME] --enable-private-nodes
```

5. If you want to enable private endpoint for an existing cluster, run the following command:

```
gcloud container clusters update [CLUSTER_NAME] --enable-private-endpoint
```

6. Verify that the private endpoint is enabled by running the following command:

```
gcloud container clusters describe [CLUSTER_NAME] --format='get(privateClusterConfig.enablePrivateEndpoint)'
```

The output should be `true`.

7. Verify that private nodes are enabled by running the following command:

```
gcloud container clusters describe [CLUSTER_NAME] --format='get(privateClusterConfig.enablePrivateNodes)'
```

The output should be `true`.

By following the above steps, you can remediate the misconfiguration "Private Cluster Should Be Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration of "Private Cluster Should Be Enabled" in GCP using Python, you can follow the below steps:

1. Import the necessary libraries:

```python
from google.cloud import container_v1
from google.oauth2 import service_account
```

2. Set up the credentials for authentication:

```python
credentials = service_account.Credentials.from_service_account_file('path/to/service_account.json')
```

3. Initialize the client for GCP Container API:

```python
client = container_v1.ClusterManagerClient(credentials=credentials)
```

4. Get the current state of the cluster:

```python
cluster = client.get_cluster('projects/{project_id}/locations/{zone}/clusters/{cluster_name}')
```

5. Check if the cluster is private:

```python
if cluster.private_cluster_config.enable_private_nodes:
    print('Cluster is already private')
else:
    print('Cluster is not private')
```

6. If the cluster is not private, enable private cluster:

```python
cluster.private_cluster_config.enable_private_nodes = True
update_request = container_v1.UpdateClusterRequest(cluster=cluster, update_mask={'paths': ['private_cluster_config.enable_private_nodes']})
operation = client.update_cluster(update_request)
```

7. Wait for the operation to complete:

```python
operation.result()
```

By following these steps, you can remediate the misconfiguration of "Private Cluster Should Be Enabled" in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters](https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters) 


</Tab>
</Tabs>