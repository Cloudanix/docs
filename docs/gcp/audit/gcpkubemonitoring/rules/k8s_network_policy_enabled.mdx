---
slug: k8s_network_policy_enabled
title: Network Policy Should Be Enabled
sidebar_label: Network Policy Should Be Enabled
---

### More Info:

Ensures all Kubernetes clusters have network policy enabled. Kubernetes network policy creates isolation between cluster pods, this creates a more secure environment with only specified connections allowed.

### Risk Level

Medium

### Address

Security

### Compliance Standards

NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. You can do this by clicking on the hamburger menu on the top left corner, then select "Kubernetes Engine".

3. In the Kubernetes Engine section, you will see a list of all your Kubernetes clusters. Click on the name of the cluster you want to inspect.

4. In the cluster details page, navigate to the "Networking" section. Here, you can see the network policies applied to the cluster. If no network policy is applied, it means the Network Policy is not enabled.

#### Using CLI

1. Install and configure Google Cloud SDK on your local machine. This will provide you with the necessary command-line tools to interact with resources hosted on Google Cloud Platform (GCP). You can download it from the official Google Cloud website and install it following the instructions provided.

2. Authenticate your SDK with GCP. Open your terminal and run the following command:
   ```
   gcloud auth login
   ```
   Follow the prompts to authenticate your SDK with your GCP account.

3. Set your project ID to the project you want to check. Replace `YOUR_PROJECT_ID` with your actual project ID in the following command:
   ```
   gcloud config set project YOUR_PROJECT_ID
   ```

4. Now, you can check the network policies of your Kubernetes clusters. Run the following command to list all the clusters in your project:
   ```
   gcloud container clusters list
   ```
   Then, for each cluster, run the following command to get its description, which includes its network policies. Replace `CLUSTER_NAME` and `ZONE` with the actual name and zone of your cluster:
   ```
   gcloud container clusters describe CLUSTER_NAME --zone=ZONE
   ```
   In the output, look for the `networkPolicy` field. If the `enabled` field under it is set to `false`, then the network policy is not enabled for that cluster.

#### Using Python

1. Install the necessary Python libraries: You will need the Kubernetes Python client to interact with the Kubernetes API. You can install it using pip:

```python
pip install kubernetes
```

2. Import the necessary modules and configure the client: You will need to import the Kubernetes client and configure it to connect to your Kubernetes cluster. Here is an example:

```python
from kubernetes import client, config

# Load the kube config from the default location
config.load_kube_config()
```

3. Query the Kubernetes API for Network Policies: You can use the Kubernetes client to query the API for Network Policies. Here is an example:

```python
from kubernetes.client import V1NetworkPolicyList

def list_network_policies():
    api_instance = client.NetworkingV1Api()
    network_policies = api_instance.list_network_policy_for_all_namespaces()
    return network_policies

network_policies = list_network_policies()
```

4. Check if Network Policies are enabled: You can check if Network Policies are enabled by checking if the list of Network Policies is empty. If it is, then Network Policies are not enabled. Here is an example:

```python
def check_network_policies(network_policies):
    if len(network_policies.items) == 0:
        print("Network Policies are not enabled")
    else:
        print("Network Policies are enabled")

check_network_policies(network_policies)
```

This script will print "Network Policies are not enabled" if there are no Network Policies, and "Network Policies are enabled" if there are.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of "Network Policy Should Be Enabled" in GCP using GCP console, please follow the below steps:

1. Login to your GCP console.
2. Navigate to the VPC Network page.
3. Click on the VPC network that you want to remediate.
4. Click on the Firewall rules tab.
5. Click on the Create Firewall Rule button.
6. Enter a name for the firewall rule.
7. In the Targets section, select the network that you want to apply the firewall rule to.
8. In the Source filter section, select the IP ranges that you want to allow or block.
9. In the Protocols and ports section, specify the protocols and ports that you want to allow or block.
10. In the Action section, select the action that you want to take on the traffic that matches the firewall rule.
11. Click on the Create button to create the firewall rule.

By following the above steps, you will be able to remediate the misconfiguration of "Network Policy Should Be Enabled" in GCP using GCP console.

#### Using CLI

To remediate the "Network Policy Should Be Enabled" misconfiguration in GCP using GCP CLI, follow the below steps:

1. Open the GCP Cloud Shell from the GCP console.
2. Run the following command to enable the Network Policy for the default network in your GCP project:
   ```
   gcloud compute networks update default --update-policy=ENABLE_NETWORK_POLICY
   ```
3. This command will update the default network with the Network Policy enabled.

Once the Network Policy is enabled, you can create and apply the necessary firewall rules to control traffic between your VM instances. You can also create a custom network with the Network Policy enabled and use it for your VM instances.

#### Using Python

To remediate the misconfiguration "Network Policy Should Be Enabled" in GCP using Python, you can follow the below steps:

1. Import the required libraries:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials
```

2. Set the project ID and the zone where the cluster is located:

```python
project_id = 'your-project-id'
zone = 'us-central1-a'
```

3. Get the credentials to access the GCP API:

```python
credentials = GoogleCredentials.get_application_default()
```

4. Create a client object for the Kubernetes API:

```python
container_api = discovery.build('container', 'v1', credentials=credentials)
```

5. Get the list of clusters in the project:

```python
clusters = container_api.projects().zones().clusters().list(projectId=project_id, zone=zone).execute()
```

6. Loop through the clusters and enable network policy:

```python
for cluster in clusters['clusters']:
    # Get the cluster name
    cluster_name = cluster['name']
    
    # Get the current cluster configuration
    cluster_config = container_api.projects().zones().clusters().get(projectId=project_id, zone=zone, clusterId=cluster_name).execute()
    
    # Check if network policy is already enabled
    if cluster_config['networkPolicy']['enabled']:
        print(f"Network policy is already enabled for cluster {cluster_name}")
    else:
        # Enable network policy
        cluster_config['networkPolicy']['enabled'] = True
        
        # Update the cluster configuration
        update_op = container_api.projects().zones().clusters().update(projectId=project_id, zone=zone, clusterId=cluster_name, body=cluster_config).execute()
        
        print(f"Network policy is enabled for cluster {cluster_name}")
```

This code will loop through all the clusters in the specified project and zone, and enable network policy for each cluster that does not already have it enabled.


### Additional Reading:

- [https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy](https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy) 


</Tab>
</Tabs>