---
slug: k8s_node_pool_multi_zone
title: Node Pools Should Be Regional For High Availability
sidebar_label: Node Pools Should Be Regional For High Availability
---

### More Info:

GKE node pools should be regional (multiple zones) for maximum nodes availability during zonal outages

### Risk Level

High

### Address

Security, Reliability, Operational Excellence, Performance Efficiency

### Compliance Standards

HIPAA, NIST, HITRUST, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. You can do this by clicking on the navigation menu (three horizontal lines on the top left corner), then scroll down and click on "Kubernetes Engine".

3. In the Kubernetes Engine section, you will see a list of your Kubernetes clusters. Click on the name of the cluster you want to inspect.

4. In the cluster details page, look for the "Node Pools" section. Here, you can see the configuration of your node pools. If the node pool is regional, it will be indicated here. If it's not, then it's a misconfiguration.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your GCP account using the following command. This will open a new window in your web browser asking you to log in to your Google Cloud account.
   ```
   gcloud auth login
   ```

3. Set your project ID to the project you want to check. Replace `your-project-id` with your actual project ID.
   ```
   gcloud config set project your-project-id
   ```

4. Run the following command to list all the Kubernetes clusters in your project. This command will show you the details of each cluster, including whether it's regional or zonal.
   ```
   gcloud container clusters list
   ```
   In the output, check the `LOCATION` column. If the location is a specific zone (e.g., us-central1-a), then the node pool is zonal. If the location is a region (e.g., us-central1), then the node pool is regional.

#### Using Python

1. Install the necessary Python libraries:
   You will need the Google Cloud SDK and the Kubernetes Python client. You can install these using pip:

   ```python
   pip install --upgrade google-cloud-sdk
   pip install kubernetes
   ```

2. Authenticate with Google Cloud:
   Before you can interact with GCP, you need to authenticate. You can do this using the `google.auth` library:

   ```python
   from google.auth import compute_engine
   credentials = compute_engine.Credentials()
   ```

3. Connect to the Kubernetes API:
   Use the `kubernetes.client` library to connect to the Kubernetes API:

   ```python
   from kubernetes import client, config

   # Load the kube config from the file
   config.load_kube_config()

   # Create an instance of the API class
   api_instance = client.CoreV1Api()
   ```

4. Check the Node Pools:
   You can now use the `list_node_pool` method to get a list of all node pools in a cluster. You can then check the `locations` field of each node pool to see if it is regional:

   ```python
   from google.cloud import container_v1

   client = container_v1.ClusterManagerClient(credentials=credentials)
   parent = client.project_location_cluster_path('[PROJECT]', '[LOCATION]', '[CLUSTER]')

   response = client.list_node_pools(parent)

   for node_pool in response.node_pools:
       if len(node_pool.locations) == 1:
           print(f"Node pool {node_pool.name} is not regional")
   ```

   This script will print out the names of all node pools that are not regional. If a node pool is regional, it will have more than one location.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Node Pools Should Be Regional For High Availability" in GCP using GCP console, follow the below steps:

1. Login to the GCP console.

2. Navigate to the Kubernetes Engine section.

3. Select the cluster that has the misconfigured node pool.

4. Click on the "Nodes" tab on the left-hand side.

5. Select the node pool that needs to be remediated.

6. Click the "Edit" button at the top of the page.

7. Under the "Location" section, select "Regional" from the drop-down menu.

8. Choose the region where you want to create the node pool.

9. Click "Save" to apply the changes.

10. Wait for the node pool to be created in the selected region.

11. Once the node pool is created, verify that the nodes are running and healthy.

By following these steps, you will have successfully remediated the misconfiguration "Node Pools Should Be Regional For High Availability" in GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Node Pools Should Be Regional For High Availability" for GCP using GCP CLI, follow the below steps:

1. First, check the current status of your node pool using the following command:
```
gcloud container node-pools describe [NODE_POOL_NAME] --cluster=[CLUSTER_NAME] --zone=[ZONE_NAME]
```
Replace `[NODE_POOL_NAME]`, `[CLUSTER_NAME]` and `[ZONE_NAME]` with your own values.

2. If the node pool is not regional, create a new regional node pool using the following command:
```
gcloud container node-pools create [NEW_NODE_POOL_NAME] --cluster=[CLUSTER_NAME] --num-nodes=[NUMBER_OF_NODES] --region=[REGION_NAME]
```
Replace `[NEW_NODE_POOL_NAME]`, `[CLUSTER_NAME]`, `[NUMBER_OF_NODES]` and `[REGION_NAME]` with your own values.

3. Verify that the new node pool has been created successfully using the following command:
```
gcloud container node-pools list --cluster=[CLUSTER_NAME] --region=[REGION_NAME]
```
Replace `[CLUSTER_NAME]` and `[REGION_NAME]` with your own values.

4. Once the new node pool is created and verified, you can delete the old node pool using the following command:
```
gcloud container node-pools delete [OLD_NODE_POOL_NAME] --cluster=[CLUSTER_NAME] --zone=[ZONE_NAME]
```
Replace `[OLD_NODE_POOL_NAME]`, `[CLUSTER_NAME]` and `[ZONE_NAME]` with your own values.

5. Verify that the old node pool has been deleted successfully using the following command:
```
gcloud container node-pools list --cluster=[CLUSTER_NAME] --zone=[ZONE_NAME]
```
Replace `[CLUSTER_NAME]` and `[ZONE_NAME]` with your own values.

By following these steps, you can remediate the misconfiguration "Node Pools Should Be Regional For High Availability" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Node Pools Should Be Regional For High Availability" for GCP using Python, you can follow the below steps:

Step 1: Import the required libraries and authenticate to GCP using service account credentials.

```
from google.oauth2 import service_account
from google.cloud import container_v1

credentials = service_account.Credentials.from_service_account_file(
    'path/to/service_account.json')
client = container_v1.ClusterManagerClient(credentials=credentials)
```

Step 2: Get the list of node pools in the cluster that are not regional.

```
project_id = 'your-project-id'
zone = 'your-zone'
cluster_id = 'your-cluster-id'

cluster = client.get_cluster(project_id, zone, cluster_id)
for node_pool in cluster.node_pools:
    if node_pool.locations[0] != zone:
        print(f"Node pool {node_pool.name} is not regional.")
```

Step 3: Delete the non-regional node pools and create new regional node pools.

```
# Delete non-regional node pools
for node_pool in cluster.node_pools:
    if node_pool.locations[0] != zone:
        client.delete_node_pool(project_id, zone, cluster_id, node_pool.name)

# Create new regional node pools
node_pool = {
    'name': 'your-node-pool-name',
    'config': {
        'machine_type': 'your-machine-type',
        'disk_size_gb': 100,
    },
    'initial_node_count': 1,
    'locations': ['your-zone'],
}
response = client.create_node_pool(project_id, zone, cluster_id, node_pool)
```

Note: Replace 'your-project-id', 'your-zone', 'your-cluster-id', 'your-node-pool-name', 'your-machine-type' and '100' with your actual values. 

These steps will remediate the misconfiguration "Node Pools Should Be Regional For High Availability" for GCP using Python.




</Tab>
</Tabs>