---
slug: k8s_version_management_using_release_channels
title: Ensure Clusters Use Stable Release Channels
sidebar_label: Ensure Clusters Use Stable Release Channels
---

### More Info:

Subscribe to the Regular or Stable Release Channel to automate version upgrades to the GKE cluster and to reduce version management complexity to the number of features and level of stability required.

### Risk Level

Medium

### Address

Security, Reliability, Operational Excellence, Best Practice

### Compliance Standards

CISGKE



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the Kubernetes Engine section. You can do this by clicking on the hamburger menu on the top left corner, then select "Kubernetes Engine" from the drop-down menu.

3. Once you're in the Kubernetes Engine section, you will see a list of all your Kubernetes clusters. Click on the name of the cluster you want to inspect.

4. In the cluster details page, look for the "Release channel" field. This field indicates the release channel that the cluster is currently using. If the cluster is using the Stable release channel, it will be indicated here. If not, then the cluster is not using a stable release channel, indicating a misconfiguration.

#### Using CLI

1. Install and configure Google Cloud SDK on your local machine. This will provide you with the necessary command-line tools to interact with GCP resources. You can download it from the official Google Cloud website and install it following the instructions provided.

2. Authenticate your SDK with GCP. You can do this by running the following command in your terminal:
   ```
   gcloud auth login
   ```
   Follow the instructions in the terminal to log in with your Google account.

3. Set your project ID to the project you want to check. Replace `your-project-id` with the ID of your project:
   ```
   gcloud config set project your-project-id
   ```

4. Run the following command to list all the clusters in your project and their release channels:
   ```
   gcloud container clusters list --format='table(name, location, releaseChannel.channel)'
   ```
   This command will return a table with the names of your clusters, their locations, and their release channels. If the release channel of a cluster is not set to a stable release, then it is a misconfiguration.

#### Using Python

To check if Kubernetes clusters are using stable release channels in Google Cloud Platform (GCP), you can use the Google Cloud SDK (gcloud) or the Google Cloud Client Library for Python. Here are the steps:

1. **Install the Google Cloud SDK and Python Client Library:**
   Before you can run any commands or scripts, you need to install the Google Cloud SDK and the Python client library. You can do this by running the following commands in your terminal:

   ```bash
   # Install Google Cloud SDK
   pip install --upgrade google-cloud-sdk

   # Install Google Cloud Client Library for Python
   pip install --upgrade google-cloud
   ```

2. **Authenticate with Google Cloud:**
   You need to authenticate with Google Cloud before you can interact with your resources. You can do this by running the following command in your terminal:

   ```bash
   gcloud auth login
   ```

   Follow the prompts to log in with your Google Cloud account.

3. **List all Kubernetes Clusters:**
   You can list all your Kubernetes clusters by running the following command in your terminal:

   ```bash
   gcloud container clusters list
   ```

   This will return a list of all your clusters, along with their details.

4. **Check the Release Channel of Each Cluster:**
   You can check the release channel of each cluster using the Python client library. Here is a sample script:

   ```python
   from google.cloud import container_v1

   def check_clusters():
       client = container_v1.ClusterManagerClient()
       project_id = 'your-project-id'
       zone = 'your-zone'

       response = client.list_clusters(project_id, zone)

       for cluster in response.clusters:
           print(f'Cluster: {cluster.name}')
           print(f'Release Channel: {cluster.release_channel.channel}')

   check_clusters()
   ```

   Replace 'your-project-id' and 'your-zone' with your actual project ID and zone. This script will print the name and release channel of each cluster. If the release channel is not 'STABLE', then the cluster is not using a stable release channel.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Ensure Clusters Use Stable Release Channels" for GCP using GCP console, follow the below steps:

1. Open the GCP console and navigate to the Kubernetes Engine page.

2. Select the cluster that you want to remediate.

3. Click on the "Edit" button at the top of the page.

4. In the "Cluster version and upgrade settings" section, select "Stable channel" from the "Release channel" drop-down menu.

5. Click on the "Save" button to apply the changes.

6. Repeat the above steps for all the clusters in your GCP environment.

By following the above steps, you have successfully remediated the misconfiguration "Ensure Clusters Use Stable Release Channels" for GCP using GCP console.

#### Using CLI

To remediate the issue of ensuring clusters use stable release channels in GCP using GCP CLI, follow the below steps:

Step 1: Open the Cloud Shell

Step 2: Run the following command to set the project ID:

```
gcloud config set project [PROJECT_ID]
```

Step 3: Verify that you have the Kubernetes Engine API enabled for your project by running the following command:

```
gcloud services list --enabled | grep container.googleapis.com
```

Step 4: Run the following command to get the current release channel of the cluster:

```
gcloud container clusters describe [CLUSTER_NAME] --zone [ZONE] | grep releaseChannel
```

Step 5: Run the following command to update the release channel to stable:

```
gcloud container clusters update [CLUSTER_NAME] --zone [ZONE] --update-addons=HorizontalPodAutoscaling,HttpLoadBalancing --release-channel=stable
```

Step 6: Verify that the release channel has been updated by running the following command:

```
gcloud container clusters describe [CLUSTER_NAME] --zone [ZONE] | grep releaseChannel
```

This should remediate the issue of ensuring clusters use stable release channels in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Ensure Clusters Use Stable Release Channels" in GCP using Python, you can follow the below steps:

1. First, you need to install the `google-cloud-container` library using the following command:

   ```
   pip install google-cloud-container
   ```

2. Next, you need to authenticate with GCP using your service account key. You can use the following code to authenticate:

   ```python
   from google.oauth2 import service_account

   credentials = service_account.Credentials.from_service_account_file(
       'path/to/service_account_key.json')
   ```

3. Once you are authenticated, you can use the `google.cloud.container_v1.ClusterManagerClient` class to get the list of clusters in your GCP project. You can use the following code to get the list of clusters:

   ```python
   from google.cloud import container_v1

   client = container_v1.ClusterManagerClient(credentials=credentials)
   project_id = 'your-project-id'

   clusters = client.list_clusters(project_id)
   ```

4. After getting the list of clusters, you can check if each cluster is using the stable release channel or not. If any cluster is not using the stable release channel, you can update the cluster to use the stable release channel. You can use the following code to update the cluster:

   ```python
   for cluster in clusters:
       if cluster.release_channel != 'STABLE':
           cluster.release_channel = 'STABLE'
           update_request = container_v1.UpdateClusterRequest(
               project_id=project_id,
               zone=cluster.zone,
               cluster_id=cluster.name,
               update=cluster,
               name=cluster.name)
           response = client.update_cluster(update_request)
   ```

5. Finally, you can verify that all the clusters are now using the stable release channel by running the code in step 3 again.

By following the above steps, you can remediate the misconfiguration "Ensure Clusters Use Stable Release Channels" in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels](https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels) 


</Tab>
</Tabs>