---
slug: dns_managed_zone_use_secure_algorithm
title: GCP DNS Managed Zones Should Use Secure Algorithm
sidebar_label: GCP DNS Managed Zones Should Use Secure Algorithm
---

### More Info:

Ensure that Cloud DNS Managed Zones use secure algorithm for encryption.

### Risk Level

High

### Address

Security

### Compliance Standards

SOC2, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to Google Cloud Console: Open your web browser and navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google Cloud credentials.

2. Navigate to Network Services: Once you're logged in, select the project you want to check from the drop-down menu at the top of the page. Then, on the left-hand side navigation menu, click on "Network Services" and then "Cloud DNS".

3. Check Managed Zones: In the Cloud DNS page, you will see a list of your DNS managed zones. Click on the name of the managed zone you want to check.

4. Verify DNSSEC: In the managed zone details page, look for the "DNSSEC" section. If the DNSSEC is set to "Off" or if it's using an insecure algorithm, then it's a misconfiguration. The secure algorithms that should be used are RSASHA1, RSASHA256, RSASHA512, or ECDSAP256SHA256.

#### Using CLI

1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine. You can download it from the official Google Cloud website. After installation, authenticate your account using the command `gcloud auth login`.

2. List all DNS managed zones: Use the following command to list all the DNS managed zones in your GCP project:

   ```
   gcloud dns managed-zones list --project=[PROJECT_ID]
   ```
   Replace `[PROJECT_ID]` with your actual GCP project ID.

3. Get DNSSEC details: For each managed zone, use the following command to get the DNSSEC details:

   ```
   gcloud dns managed-zones describe [ZONE_NAME] --project=[PROJECT_ID]
   ```
   Replace `[ZONE_NAME]` with the name of each managed zone and `[PROJECT_ID]` with your actual GCP project ID. Look for the `dnssecConfig` field in the output. This field contains the DNSSEC configuration for the managed zone.

4. Check the algorithm: In the `dnssecConfig` field, check the `defaultKeySpecs` list. Each item in this list represents a DNSSEC key. Look for the `algorithm` field in each key. If the algorithm is not `rsasha256` or `rsasha512`, then the managed zone is not using a secure algorithm.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. You can install the Google Cloud SDK and the Google Auth, Google Auth Oauthlib, Google Auth HTTPLib2, Google API Client, and DNS Python libraries using pip.

```python
pip install --upgrade google-cloud-sdk google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client dnspython
```

2. Authenticate your GCP account: You need to authenticate your GCP account using the service account key. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key.

```python
import os
os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = '/path/to/your/service-account-key.json'
```

3. Connect to the DNS service: Now, you can connect to the DNS service using the `build` function from the `googleapiclient.discovery` module.

```python
from googleapiclient.discovery import build
service = build('dns', 'v1')
```

4. Check the DNSSEC configuration: You can now check the DNSSEC configuration of all managed zones in your project. If the `dnssecConfig.state` is not 'on' or the `dnssecConfig.defaultKeySpecs.algorithm` is not 'rsasha256' or 'rsasha512', then the managed zone is not using a secure algorithm.

```python
project = 'your-project-id'  # replace with your project id
request = service.managedZones().list(project=project)
response = request.execute()

for managed_zone in response['managedZones']:
    dnssec_config = managed_zone['dnssecConfig']
    if dnssec_config['state'] != 'on':
        print(f"Managed zone {managed_zone['name']} does not have DNSSEC enabled.")
    elif dnssec_config['defaultKeySpecs'][0]['algorithm'] not in ['rsasha256', 'rsasha512']:
        print(f"Managed zone {managed_zone['name']} is not using a secure algorithm.")
```

This script will print the names of all managed zones that are not using a secure algorithm.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "GCP DNS Managed Zones Should Use Secure Algorithm" for GCP using GCP console, follow these steps:

1. Open the GCP console and select the project where the DNS Managed Zone is located.

2. In the left-hand navigation menu, click on "Network services" and select "Cloud DNS".

3. In the Cloud DNS dashboard, select the DNS Managed Zone that needs to be remediated.

4. Click on the "Edit" button at the top of the page.

5. In the "Zone details" section, select the "Advanced" tab.

6. In the "DNSSEC" section, select the "Enable DNSSEC" checkbox.

7. Select the "Algorithm" dropdown and choose a secure algorithm such as "RSASHA256".

8. Click on the "Save" button at the bottom of the page to save the changes.

9. Verify that the DNS Managed Zone is now using a secure algorithm by checking the "DNSSEC" section of the "Zone details" page.

By following these steps, you have successfully remediated the misconfiguration "GCP DNS Managed Zones Should Use Secure Algorithm" for GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "GCP DNS Managed Zones Should Use Secure Algorithm" for GCP using GCP CLI, follow the steps given below:

1. Open the GCP Cloud Shell by clicking on the Activate Cloud Shell icon on the top right corner of the GCP Console.

2. Run the following command to list all the DNS managed zones in your GCP project:

```
gcloud dns managed-zones list
```

3. Identify the DNS managed zone that is using an insecure algorithm.

4. Run the following command to update the DNS managed zone to use a secure algorithm:

```
gcloud dns managed-zones update [ZONE_NAME] --dnssec-algorithm=RSASHA256
```

Make sure to replace [ZONE_NAME] with the name of the DNS managed zone that you want to update.

5. Verify that the DNS managed zone is updated to use a secure algorithm by running the following command:

```
gcloud dns managed-zones describe [ZONE_NAME] | grep -i algorithm
```

Make sure that the output shows the algorithm as "RSASHA256".

By following these steps, you can remediate the misconfiguration "GCP DNS Managed Zones Should Use Secure Algorithm" for GCP using GCP CLI.

#### Using Python

To remediate the GCP DNS Managed Zones Should Use Secure Algorithm misconfiguration, follow these steps:

1. Install the Google Cloud SDK by following the instructions at https://cloud.google.com/sdk/docs/install.

2. Set up authentication for the Google Cloud SDK by running `gcloud auth login` and following the instructions.

3. Install the `google-cloud-dns` Python library by running `pip install google-cloud-dns`.

4. Write a Python script to update the DNS managed zones to use a secure algorithm. Here's an example script:

```python
from google.cloud import dns

# Set the project ID and managed zone name
project_id = 'your-project-id'
zone_name = 'your-zone-name'

# Create a DNS client
client = dns.Client(project=project_id)

# Get the managed zone
zone = client.zone(zone_name)

# Update the DNSSEC algorithm
zone.dnssec_config.algorithm = 'rsasha256'

# Update the managed zone
zone.update()

print('Managed zone updated successfully.')
```

Replace `your-project-id` and `your-zone-name` with your actual project ID and managed zone name.

5. Run the Python script by running `python script.py`.

This will update the DNS managed zone to use a secure algorithm (in this case, `rsasha256`). Repeat this process for all other DNS managed zones in your GCP project.


### Additional Reading:

- [https://cloud.google.com/dns/docs/dnssec-advanced](https://cloud.google.com/dns/docs/dnssec-advanced) 


</Tab>
</Tabs>