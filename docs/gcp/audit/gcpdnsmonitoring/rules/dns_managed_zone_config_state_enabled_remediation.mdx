

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to the DNS Managed Zones: From the GCP Console dashboard, select the project you want to inspect. Then, on the left-side menu, click on "Network Services" and then "Cloud DNS". This will take you to the DNS Managed Zones page.

3. Check the Config State: On the DNS Managed Zones page, you will see a list of all your DNS Managed Zones. Each zone will have a column labeled "Config State". This column should display "On" for each zone. If it displays "Off", then the DNS Managed Zone is misconfigured.

4. Verify across all DNS Managed Zones: Repeat the above step for all DNS Managed Zones in your project. If any zone's Config State is "Off", then you have detected a misconfiguration.

#### Using CLI

1. First, you need to install and configure the Google Cloud SDK (gcloud CLI) on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Once the Google Cloud SDK is installed and configured, open your terminal or command prompt and run the following command to list all the DNS managed zones in your GCP project:

   ```
   gcloud dns managed-zones list --project=[PROJECT_ID]
   ```
   Replace `[PROJECT_ID]` with your actual Google Cloud project ID.

3. To check the configuration state of each DNS managed zone, run the following command:

   ```
   gcloud dns managed-zones describe [ZONE_NAME] --project=[PROJECT_ID]
   ```
   Replace `[ZONE_NAME]` with the name of the DNS managed zone you want to check, and `[PROJECT_ID]` with your actual Google Cloud project ID.

4. In the output of the above command, look for the `dnssecConfig` field. If the `state` field under `dnssecConfig` is set to `on`, then the DNSSEC is enabled for that DNS managed zone. If it's set to `off`, then the DNSSEC is disabled.

#### Using Python

1. Install Google Cloud SDK and Python Client for Google Cloud DNS: Before you can start writing Python scripts to interact with Google Cloud DNS, you need to install the Google Cloud SDK and the Python client library for Google Cloud DNS. You can install the SDK by following the instructions on the Google Cloud SDK page. The Python client library can be installed using pip:

   ```
   pip install --upgrade google-cloud-dns
   ```

2. Authenticate your application: To interact with Google Cloud DNS, your application needs to be authenticated. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file. This file can be downloaded from the Google Cloud Console.

   ```
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"]="/path/to/your/service-account-file.json"
   ```

3. Write a Python script to list all managed zones: You can use the `list()` method of the `Client` class in the `google.cloud.dns` module to list all managed zones in your project. Here is a sample script:

   ```python
   from google.cloud import dns

   def list_managed_zones():
       client = dns.Client()
       zones = client.list_zones()
       for zone in zones:
           print(zone.name)
   ```

4. Check the config state of each managed zone: To check the config state of each managed zone, you can use the `dnssec_config` attribute of the `Zone` class in the `google.cloud.dns` module. This attribute returns a `DnssecConfig` object, which has a `state` attribute that indicates the config state of the managed zone. Here is a sample script:

   ```python
   from google.cloud import dns

   def check_config_state():
       client = dns.Client()
       zones = client.list_zones()
       for zone in zones:
           if zone.dnssec_config.state != 'on':
               print(f"The DNSSEC config state of the managed zone {zone.name} is not 'on'.")
   ```

This script will print the names of all managed zones whose DNSSEC config state is not 'on'.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "GCP DNS Managed Zones Should Config State Should Be On" in GCP using the GCP console, follow these steps:

1. Log in to the GCP console and select the project where the DNS Managed Zones configuration needs to be remediated.

2. Navigate to the "DNS" page from the left-hand menu.

3. Select the "Managed Zones" tab from the top menu.

4. Identify the Managed Zones with the "Config State" set to "Off".

5. Click on the name of each Managed Zone with the "Config State" set to "Off".

6. Click on the "Edit" button at the top of the Managed Zone page.

7. Scroll down to the "Advanced" section.

8. Toggle the "Config State" switch to "On".

9. Click on the "Save" button at the bottom of the page.

10. Repeat steps 5-9 for each Managed Zone with the "Config State" set to "Off".

By following these steps, you can remediate the misconfiguration "GCP DNS Managed Zones Should Config State Should Be On" in GCP using the GCP console.

#### Using CLI

To remediate the misconfiguration of GCP DNS Managed Zones Config State being off, you can follow the below steps using GCP CLI:

1. Open the Cloud Shell in GCP Console.

2. Run the following command to list all the managed zones in your project:

   ```
   gcloud dns managed-zones list
   ```

3. Identify the managed zone that has "config-state" set to "off".

4. Run the following command to update the "config-state" of the identified managed zone to "on":

   ```
   gcloud dns managed-zones update [MANAGED_ZONE_NAME] --config-state=on
   ```

   Replace [MANAGED_ZONE_NAME] with the actual name of the managed zone.

5. Verify that the "config-state" of the managed zone has been updated by running the following command:

   ```
   gcloud dns managed-zones describe [MANAGED_ZONE_NAME]
   ```

   This command should return the details of the managed zone, including the updated "config-state" value.

By following the above steps, you can remediate the misconfiguration of GCP DNS Managed Zones Config State being off.

#### Using Python

To remediate the GCP DNS Managed Zones Config State issue using Python, you can use the Google Cloud DNS API client library. Here are the step-by-step instructions:

1. Install the `google-cloud-dns` Python package using pip:

```
pip install google-cloud-dns
```

2. Authenticate with the Google Cloud Platform by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file:

```
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service_account_key.json
```

3. Import the necessary modules:

```
from google.cloud import dns
from google.oauth2 import service_account
```

4. Create a `dns.Client` object using the service account credentials:

```
credentials = service_account.Credentials.from_service_account_file('/path/to/service_account_key.json')
client = dns.Client(project='your-project-id', credentials=credentials)
```

5. Retrieve the list of Managed Zones:

```
zones = client.list_zones()
```

6. For each zone, check if the `config` property is set to `on`. If it's not, update the zone's `config` property using the `client.update_zone()` method:

```
for zone in zones:
    if zone.config != 'on':
        zone.config = 'on'
        client.update_zone(zone)
```

7. Your code should look like this:

```
from google.cloud import dns
from google.oauth2 import service_account

credentials = service_account.Credentials.from_service_account_file('/path/to/service_account_key.json')
client = dns.Client(project='your-project-id', credentials=credentials)

zones = client.list_zones()

for zone in zones:
    if zone.config != 'on':
        zone.config = 'on'
        client.update_zone(zone)
```

This code will remediate the GCP DNS Managed Zones Config State issue by setting the `config` property to `on` for all Managed Zones in your project.


</Tab>
</Tabs>