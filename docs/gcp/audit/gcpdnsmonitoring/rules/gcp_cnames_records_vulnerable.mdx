---
slug: gcp_cnames_records_vulnerable
title: GCP CName Records Vulnerable
sidebar_label: GCP CName Records Vulnerable
---

### More Info:

Ensure GCP CName records are not vulnerable.

### Risk Level

Critical

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Console: Navigate to your web browser and enter the URL console.cloud.google.com. Enter your Google Cloud credentials to log in.

2. Navigate to Cloud DNS: Once you are logged in, go to the navigation menu (three horizontal lines on the top left corner), scroll down and click on 'Network Services'. In the dropdown menu, click on 'Cloud DNS'.

3. Select DNS Zone: You will see a list of your DNS zones. Click on the DNS zone where you want to check the CName records.

4. Check CName Records: In the DNS zone details page, you will see a list of all the DNS records. Look for any CName records. If the CName record is pointing to an external domain that you do not control, it is vulnerable.

#### Using CLI

1. Install and authenticate Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and follow the instructions to install it. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all DNS managed zones: Use the following command to list all the DNS managed zones in your GCP project:

   ```
   gcloud dns managed-zones list
   ```

   This command will return a list of all the DNS managed zones in your project. Note down the name of the managed zone you want to check.

3. List all DNS records: Use the following command to list all the DNS records in the managed zone:

   ```
   gcloud dns record-sets list --zone=[ZONE_NAME]
   ```

   Replace `[ZONE_NAME]` with the name of the managed zone you noted down in the previous step. This command will return a list of all the DNS records in the managed zone.

4. Check for CNAME records: In the list of DNS records, look for any CNAME records. If a CNAME record is pointing to an external domain that you do not control, it could be vulnerable to subdomain takeover.

#### Using Python

1. Install the necessary Python libraries: Before you can start, you need to install the Google Cloud DNS Python client library. You can do this using pip:

   ```bash
   pip install --upgrade google-cloud-dns
   ```

2. Authenticate your application: To interact with the Google Cloud DNS API, you need to authenticate your application. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key file:

   ```bash
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/service-account-file.json"
   ```

3. Write a Python script to list all DNS records: You can use the Google Cloud DNS client library to list all DNS records in a zone. Here's a simple script that does this:

   ```python
   from google.cloud import dns

   client = dns.Client()
   zone = client.zone('your-zone-name')

   records = zone.list_resource_record_sets()

   for record in records:
       print(record)
   ```

   This script will print all DNS records in the specified zone. You can modify it to only print CNAME records by checking the `record_type` attribute of each record:

   ```python
   from google.cloud import dns

   client = dns.Client()
   zone = client.zone('your-zone-name')

   records = zone.list_resource_record_sets()

   for record in records:
       if record.record_type == 'CNAME':
           print(record)
   ```

4. Analyze the output: The script will print all CNAME records in the specified zone. You can analyze these records to check for vulnerabilities. For example, you might look for CNAME records that point to external domains that you don't control. This could indicate a subdomain takeover vulnerability.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the CName Records vulnerability in GCP DNS using the GCP console, follow these step-by-step instructions:

1. Log in to the GCP console (https://console.cloud.google.com) using your credentials.

2. Navigate to the "DNS" page by selecting the appropriate project from the project dropdown menu and clicking on "DNS" under the "Network services" section.

3. On the "DNS" page, you will see a list of managed zones. Click on the name of the zone where the CName Record vulnerability exists.

4. In the zone details, you will find a list of DNS records. Locate the CName record that needs to be remediated.

5. Click on the three vertical dots at the end of the CName record row and select "Edit".

6. In the edit record dialog box, you will see the existing configuration of the CName record. Modify the CName record to point to a valid and secure target. It is recommended to use an A record instead of a CName record whenever possible.

7. After making the necessary changes, click on the "Save" button to save the modified CName record.

8. Verify that the CName record has been successfully updated and is pointing to the desired target.

9. Repeat the above steps for any other CName records that need to be remediated.

By following these steps, you will be able to remediate the CName Records vulnerability in GCP DNS using the GCP console.

#### Using CLI

To remediate the CName Records vulnerability in GCP DNS using GCP CLI, follow these step-by-step instructions:

1. Install and set up the GCP CLI:
   - Download and install the Cloud SDK from the official Google Cloud website.
   - Open a terminal or command prompt and authenticate with your GCP account using the `gcloud auth login` command.
   - Set your project ID as the default project using the `gcloud config set project [PROJECT_ID]` command.

2. Identify the vulnerable CName Records:
   - Use the following command to list all the DNS managed zones in your project:
     ```
     gcloud dns managed-zones list
     ```
   - Identify the managed zone that contains the vulnerable CName Records.

3. Remove the vulnerable CName Records:
   - Replace `[MANAGED_ZONE_NAME]` with the name of the vulnerable managed zone in the following command:
     ```
     gcloud dns record-sets transaction start --zone=[MANAGED_ZONE_NAME]
     ```
   - Remove the vulnerable CName Records using the following command:
     ```
     gcloud dns record-sets transaction remove --zone=[MANAGED_ZONE_NAME] --name=[CNAME_RECORD_NAME] --type=CNAME --ttl=[TTL]
     ```
     Replace `[CNAME_RECORD_NAME]` with the name of the vulnerable CName record and `[TTL]` with the desired Time To Live value.
   - Execute the following command to apply the changes and commit the transaction:
     ```
     gcloud dns record-sets transaction execute --zone=[MANAGED_ZONE_NAME]
     ```

4. Verify the changes:
   - Use the following command to verify that the vulnerable CName Records have been removed:
     ```
     gcloud dns record-sets list --zone=[MANAGED_ZONE_NAME]
     ```
   - Ensure that the vulnerable CName Records are no longer listed.

By following these steps, you can remediate the CName Records vulnerability in GCP DNS using GCP CLI.

#### Using Python

To remediate the CName Records vulnerability in GCP DNS using Python, follow these step-by-step instructions:

1. Install the required dependencies:
   - Install the `google-cloud-dns` library by running the following command:
     ```
     pip install google-cloud-dns
     ```
   - Make sure you have the Google Cloud SDK installed and authenticated with your GCP account.

2. Import the necessary modules in your Python script:
   ```python
   from google.cloud import dns
   ```

3. Authenticate with your GCP account by setting the environment variable `GOOGLE_APPLICATION_CREDENTIALS` to the path of your service account key file:
   ```python
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "/path/to/service-account-key.json"
   ```

4. Create a DNS client:
   ```python
   client = dns.Client()
   ```

5. Retrieve the existing CName records:
   ```python
   zone_name = "your-zone-name"
   zone = client.zone(zone_name)
   existing_records = zone.list_resource_record_sets()
   ```

6. Filter and delete the vulnerable CName records:
   ```python
   vulnerable_records = [record for record in existing_records if record.record_type == "CNAME"]
   for record in vulnerable_records:
       zone.delete_record_set(record)
   ```

7. Apply the changes to the DNS zone:
   ```python
   changes = zone.changes()
   for record in vulnerable_records:
       changes.delete_record_set(record)
   changes.create()
   ```

8. Confirm the changes:
   ```python
   changes = zone.changes()
   changes.wait_for_change_to_apply()
   ```

By following these steps, you will be able to remediate the CName Records vulnerability in GCP DNS using Python. Make sure to replace `your-zone-name` with the actual name of your DNS zone and provide the path to your service account key file.


</Tab>
</Tabs>