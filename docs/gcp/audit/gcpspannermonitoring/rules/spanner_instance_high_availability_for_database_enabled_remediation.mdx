

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account that has the necessary permissions to access GCP resources.

2. Navigate to Spanner Instances: From the GCP Console dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "Spanner" under the "STORAGE" section. This will take you to the "Spanner Instances" page.

3. Check Spanner Instance Configuration: On the "Spanner Instances" page, you will see a list of all your Spanner instances. Click on the name of the Spanner instance you want to check. This will take you to the instance details page. Here, under the "Configuration" section, you can see the configuration details of the instance. 

4. Verify High Availability: Check the "Nodes" and "Multi-region configuration" fields. A highly available Spanner database should have multiple nodes and should be configured for multi-region. If the "Nodes" field is less than 3 or if the "Multi-region configuration" field is not enabled, then the Spanner database is not highly available.

#### Using CLI

1. First, you need to install and configure the Google Cloud SDK (gcloud) on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Once the SDK is installed and configured, you can list all the Spanner instances in your project by running the following command in your terminal:

   ```
   gcloud spanner instances list
   ```

   This command will return a list of all Spanner instances along with their configurations.

3. To check the configuration of a specific Spanner instance, use the following command:

   ```
   gcloud spanner instances describe [INSTANCE_ID]
   ```

   Replace `[INSTANCE_ID]` with the ID of the Spanner instance you want to check. This command will return detailed information about the instance, including its configuration.

4. In the output of the above command, look for the `config` field. This field indicates the configuration of the Spanner instance. If the value of this field is `regional`, it means the Spanner instance is not highly available. If the value is `multi-regional`, it means the Spanner instance is highly available.

#### Using Python

1. Install Google Cloud SDK and Python Client for Cloud Spanner: Before you start, make sure you have installed the Google Cloud SDK and authenticated it with your Google Cloud account. Also, install the Python Client for Cloud Spanner using pip:

   ```
   pip install --upgrade google-cloud-spanner
   ```

2. Import the necessary libraries and set up the Spanner client: You will need to import the `google.cloud.spanner` library and create a Spanner client using your project ID.

   ```python
   from google.cloud import spanner

   # Instantiate a client.
   spanner_client = spanner.Client()
   ```

3. Get the instance and database details: Use the Spanner client to get the details of the Spanner instance and database. You can then check the configuration of the database.

   ```python
   instance_id = 'your-instance-id'
   database_id = 'your-database-id'

   # Get instance.
   instance = spanner_client.instance(instance_id)

   # Get database.
   database = instance.database(database_id)

   # Print the configuration of the database.
   print('Database ID: {}'.format(database.database_id))
   print('Instance ID: {}'.format(database.instance.instance_id))
   print('Number of nodes: {}'.format(instance.node_count))
   ```

4. Check the high availability of the database: The high availability of a Spanner database is determined by the number of nodes it has. A database should have at least 3 nodes to be considered highly available. You can check this using the `node_count` attribute of the instance.

   ```python
   if instance.node_count < 3:
       print('The Spanner database is not highly available.')
   else:
       print('The Spanner database is highly available.')
   ```

This script will print whether the Spanner database is highly available or not based on the number of nodes it has.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Spanner Database not being highly available on GCP, you can follow the below steps:

1. Open the GCP Console and navigate to the Spanner instance that needs to be remediated.

2. Click on the instance name to open the instance details.

3. Under the "Instance Configuration" section, click on "Edit".

4. In the "Edit Instance Configuration" window, scroll down to the "High Availability" section.

5. Select the "Regional" option to enable regional availability for the Spanner instance.

6. Choose the desired region for the Spanner instance from the drop-down menu.

7. Click on "Save" to apply the changes.

8. Once the changes are saved, the Spanner instance will be highly available across the selected region.

Note: Enabling regional availability will increase the cost of the Spanner instance as it will require additional resources to maintain high availability.

#### Using CLI

To remediate the misconfiguration of Spanner Database not being highly available in GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell in the GCP console.

2. Run the following command to check the current configuration of Spanner Database:

   ```
   gcloud spanner instances describe [INSTANCE_NAME] --project=[PROJECT_ID]
   ```

   Replace `[INSTANCE_NAME]` with the name of the Spanner Database instance and `[PROJECT_ID]` with the ID of the GCP project.

3. Check the value of the `availabilityConfig` field in the output of the above command. If the value is `REGIONAL`, then the instance is highly available. If the value is `ZONAL`, then the instance is not highly available.

4. To make the instance highly available, run the following command:

   ```
   gcloud spanner instances update [INSTANCE_NAME] --project=[PROJECT_ID] --availability-type=REGIONAL
   ```

   Replace `[INSTANCE_NAME]` with the name of the Spanner Database instance and `[PROJECT_ID]` with the ID of the GCP project.

5. After running the above command, the instance will be updated to be highly available. You can check the configuration again by running the command in step 2.

Note: Making the instance highly available may incur additional costs.

#### Using Python

To remediate the misconfiguration of Spanner Database not being highly available in GCP, you can follow these steps using Python:

1. Check the current configuration of the Spanner Database:
```
from google.cloud import spanner

# Create a Spanner client object.
spanner_client = spanner.Client()

# Get a reference to the instance.
instance = spanner_client.instance('your-instance-id')

# Get a reference to the database.
database = instance.database('your-database-id')

# Check if the database is highly available.
if database.is_highly_available():
    print('The database is highly available.')
else:
    print('The database is not highly available.')
```

2. If the database is not highly available, update the configuration to make it highly available:
```
from google.cloud import spanner

# Create a Spanner client object.
spanner_client = spanner.Client()

# Get a reference to the instance.
instance = spanner_client.instance('your-instance-id')

# Get a reference to the database.
database = instance.database('your-database-id')

# Update the configuration to make the database highly available.
database.update_ha(enable=True)

# Check if the database is now highly available.
if database.is_highly_available():
    print('The database is now highly available.')
else:
    print('The database is still not highly available.')
```

3. Verify that the database is now highly available by checking the database configuration:
```
from google.cloud import spanner

# Create a Spanner client object.
spanner_client = spanner.Client()

# Get a reference to the instance.
instance = spanner_client.instance('your-instance-id')

# Get a reference to the database.
database = instance.database('your-database-id')

# Check if the database is highly available.
if database.is_highly_available():
    print('The database is highly available.')
else:
    print('The database is not highly available.')
```

By following these steps, you can remediate the misconfiguration of Spanner Database not being highly available in GCP using Python.


</Tab>
</Tabs>