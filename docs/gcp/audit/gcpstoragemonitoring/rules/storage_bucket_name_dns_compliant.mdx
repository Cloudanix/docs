---
slug: storage_bucket_name_dns_compliant
title: Buckets Should Have DNS Compliant Names
sidebar_label: Buckets Should Have DNS Compliant Names
---

### More Info:

Ensure that cloud Storage buckets following a DNS-compliant naming scheme, which avoid the use of a period i.e. "."

### Risk Level

Low

### Address

Operational Maturity, Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) Console: Navigate to the GCP Console (console.cloud.google.com) and sign in with your Google account. If you don't have an account, you'll need to create one.

2. Navigate to the Cloud Storage: From the GCP Console dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "Storage" under the "Storage" section.

3. View the list of buckets: You will be taken to the "Browser" page where you can see a list of all your Cloud Storage buckets. The bucket names are listed under the "Name" column.

4. Check for DNS compliance: Bucket names must follow DNS naming conventions. They must contain only lowercase letters, numbers, dashes (-), and dots (.). They must start and end with a number or letter and cannot contain underscores (_). Check each bucket name in the list to ensure it follows these rules. If a bucket name does not follow these rules, it is not DNS compliant.

#### Using CLI

1. Install and configure the Google Cloud SDK on your local machine. This will allow you to interact with your GCP resources using the command line interface (CLI). You can do this by following the instructions provided in the official GCP documentation.

2. Once the SDK is installed and configured, open your terminal and use the following command to list all the buckets in your GCP project:

   ```
   gsutil ls
   ```
   This command will return a list of all the buckets in your project.

3. To check if a bucket name is DNS compliant, you can use a Python script. Here is a simple script that checks if a bucket name is DNS compliant:

   ```python
   import re

   def is_dns_compliant(bucket_name):
       pattern = r"(?!-)[a-z0-9-]{1,63}(?<!-)$"
       return re.fullmatch(pattern, bucket_name) is not None

   bucket_name = "your-bucket-name"  # replace with your bucket name
   print(is_dns_compliant(bucket_name))
   ```
   This script uses a regular expression to check if the bucket name is DNS compliant. The bucket name must be between 1 and 63 characters long, can contain lowercase letters, numbers, and hyphens, and cannot start or end with a hyphen.

4. Run the Python script for each bucket name returned by the `gsutil ls` command. If the script returns `False` for a bucket name, it means that the bucket name is not DNS compliant.

#### Using Python

1. Import the necessary libraries: You will need the `boto3` library for AWS, `azure-storage-blob` for Azure, and `google-cloud-storage` for GCP. These libraries allow you to interact with the respective cloud services using Python.

```python
import boto3
from azure.storage.blob import BlobServiceClient
from google.cloud import storage
```

2. Connect to the cloud service: You will need to authenticate and create a client to interact with the cloud service. This usually involves providing your access keys or service account credentials.

```python
# AWS
s3 = boto3.resource('s3')

# Azure
blob_service_client = BlobServiceClient.from_connection_string("your_connection_string")

# GCP
client = storage.Client.from_service_account_json('path/to/keyfile.json')
```

3. List all buckets: You can use the client to list all the buckets in your account.

```python
# AWS
for bucket in s3.buckets.all():
    print(bucket.name)

# Azure
all_containers = blob_service_client.list_containers()
for container in all_containers:
    print(container.name)

# GCP
for bucket in client.list_buckets():
    print(bucket.name)
```

4. Check if the bucket names are DNS compliant: DNS compliant names must be at least 3 and no more than 63 characters long. They must be a series of one or more labels, separated by a period, where each label must start and end with a lowercase letter or a number and can contain dashes. You can use a regular expression to check this.

```python
import re

def is_dns_compliant(name):
    if len(name) < 3 or len(name) > 63:
        return False
    if name[-1] == '.' or name[0] == '.':
        return False
    allowed = re.compile("(?!-)[A-Z\d-]{1,63}(?<!-)$", re.IGNORECASE)
    return all(allowed.match(x) for x in name.split("."))

# AWS
for bucket in s3.buckets.all():
    if not is_dns_compliant(bucket.name):
        print(f"Bucket {bucket.name} is not DNS compliant")

# Azure
all_containers = blob_service_client.list_containers()
for container in all_containers:
    if not is_dns_compliant(container.name):
        print(f"Container {container.name} is not DNS compliant")

# GCP
for bucket in client.list_buckets():
    if not is_dns_compliant(bucket.name):
        print(f"Bucket {bucket.name} is not DNS compliant")
```

This script will print out the names of all buckets that are not DNS compliant.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate this misconfiguration in GCP using the GCP console:

1. Open the GCP Console and select the project where the bucket is located.
2. Navigate to the Cloud Storage section from the left-hand menu.
3. Select the bucket that you want to remediate.
4. Click on the "Edit bucket details" button at the top of the page.
5. In the "Name" field, enter a DNS-compliant name for the bucket. The name should only contain lowercase letters, numbers, and hyphens, and should start and end with a letter or number.
6. Click the "Save" button to save the changes.

Once you have completed these steps, the bucket will have a DNS-compliant name and the misconfiguration will be remediated.

#### Using CLI

To remediate the misconfiguration "Buckets Should Have DNS Compliant Names" in GCP using GCP CLI, please follow the below steps:

1. Open the Cloud Shell in your GCP Console.

2. Run the following command to list all the buckets in your project:

```bash
gsutil ls
```

3. Identify the bucket that has a non-DNS compliant name.

4. Run the following command to rename the bucket with a DNS compliant name:

```bash
gsutil mv gs://<old-bucket-name> gs://<new-bucket-name>
```

Note: Replace `<old-bucket-name>` with the non-DNS compliant bucket name and `<new-bucket-name>` with a DNS compliant bucket name.

5. Verify that the bucket has been renamed successfully by running the following command:

```bash
gsutil ls
```

6. Repeat the above steps for all the non-DNS compliant buckets in your project.

By following these steps, you can remediate the misconfiguration "Buckets Should Have DNS Compliant Names" in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Buckets Should Have DNS Compliant Names" in GCP using Python, follow these steps:

1. Install the Google Cloud Storage Python library using the following command:

```python
!pip install google-cloud-storage
```

2. Create a Python script to check the bucket name and modify it if necessary. Here's an example script:

```python
from google.cloud import storage

def remediate_bucket_name(bucket_name):
    """
    Check if the bucket name is DNS compliant and modify it if necessary.
    """
    if not bucket_name.islower():
        # Convert bucket name to lowercase
        bucket_name = bucket_name.lower()
        
    if not bucket_name.isalnum():
        # Replace non-alphanumeric characters with hyphens
        bucket_name = bucket_name.replace('_', '-')
        bucket_name = re.sub(r'[^a-zA-Z0-9-]+', '', bucket_name)
        
    if bucket_name.startswith('-') or bucket_name.endswith('-'):
        # Remove leading or trailing hyphens
        bucket_name = bucket_name.strip('-')
        
    if len(bucket_name) < 3 or len(bucket_name) > 63:
        # Bucket name must be between 3 and 63 characters long
        bucket_name = bucket_name[:63]
        bucket_name = bucket_name.strip('-')
        
    return bucket_name

# Replace <BUCKET_NAME> with the name of your bucket
bucket_name = "<BUCKET_NAME>"

# Create a client object
client = storage.Client()

# Get the bucket object
bucket = client.get_bucket(bucket_name)

# Get the current bucket name
current_name = bucket.name

# Check if the current name is DNS compliant
if current_name != remediate_bucket_name(current_name):
    # Modify the bucket name
    new_name = remediate_bucket_name(current_name)
    bucket.rename(new_name)
    print(f"Bucket name has been changed from {current_name} to {new_name}.")
else:
    print("Bucket name is DNS compliant.")
```

3. Replace `<BUCKET_NAME>` with the name of your bucket in the script.

4. Run the script and it will check if the bucket name is DNS compliant. If it is not compliant, the script will modify the bucket name to make it compliant. If the bucket name is already compliant, the script will print a message saying so.

Note: It is important to test the script thoroughly before running it in a production environment. Also, you should ensure that the bucket name is not already being used by another bucket in your GCP project.




</Tab>
</Tabs>