---
slug: lb_global_backend_services_logging_enabled
title: Load Balancer Global Backend Services Should Have Logging Enabled
sidebar_label: Load Balancer Global Backend Services Should Have Logging Enabled
---

### More Info:

Load balancers global backend services should have request logging enabled. Logging requests to Load Balancer endpoints is a helpful way of detecting and investigating potential attacks.

### Risk Level

Medium

### Address

Security, Operational Maturity

### Compliance Standards

SOC2, GDPR, HITRUST, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to Google Cloud Console: Open your web browser and navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google Cloud account.

2. Navigate to Load Balancing: From the main dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "Network Services", then select "Load balancing".

3. Select Backend Services: In the Load balancing page, click on the "Backend services" tab. This will display a list of all the backend services associated with your load balancers.

4. Check Logging Status: For each backend service, click on its name to view its details. Scroll down to the "Logs" section. If logging is enabled, you will see "Enable Cloud Logging" and "Enable Cloud Monitoring" toggled on. If these are not enabled, then logging is not enabled for that backend service. Repeat this process for each backend service to check their logging status.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your GCP account using the following command. This will open a new window in your web browser asking you to log in to your Google Cloud account.
   ```
   gcloud auth login
   ```

3. Set your project ID to the project you want to check. Replace `your-project-id` with your actual project ID.
   ```
   gcloud config set project your-project-id
   ```

4. Run the following command to list all the global backend services and check if logging is enabled or not. The `--format` flag is used to only output the necessary information.
   ```
   gcloud compute backend-services list --global --format="table(name,logConfig.enable)"
   ```
   This command will output a table with the names of all global backend services and a boolean value indicating whether logging is enabled or not. If the value is `False`, then logging is not enabled for that backend service.

#### Using Python

1. Install Google Cloud SDK and Python Client for Google Cloud Load Balancing:
   You need to install the Google Cloud SDK and Python Client for Google Cloud Load Balancing to interact with the GCP services. You can install them using pip (Python package installer).

   ```bash
   pip install --upgrade google-cloud-sdk
   pip install --upgrade google-cloud-loadbalancer
   ```

2. Authenticate your SDK:
   Before you can start accessing the GCP services, you need to authenticate your SDK. You can do this by setting the environment variable `GOOGLE_APPLICATION_CREDENTIALS` to the path of your service account key JSON file.

   ```bash
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/service-account-file.json"
   ```

3. Write a Python script to list all the global backend services and check if logging is enabled:
   You can use the `google.cloud.loadbalancer` Python client to list all the global backend services and check if logging is enabled. Here is a sample script:

   ```python
   from google.cloud import loadbalancer

   def check_logging_enabled():
       client = loadbalancer.BackendServicesClient()
       project_id = 'your-project-id'  # replace with your project id

       # list all global backend services
       backend_services = client.list(project_id, 'global')

       for backend_service in backend_services:
           # check if logging is enabled
           if not backend_service.log_config.enable:
               print(f'Logging is not enabled for {backend_service.name}')

   if __name__ == '__main__':
       check_logging_enabled()
   ```

4. Run the Python script:
   You can run the Python script using the Python interpreter. The script will print the names of all the global backend services where logging is not enabled.

   ```bash
   python check_logging.py
   ```

Please note that the Python Client for Google Cloud Load Balancing is currently in alpha and its interface might change in future versions. Also, you need to replace 'your-project-id' with your actual project id in the Python script.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Load Balancer Global Backend Services not having logging enabled in GCP, you can follow the below steps using the GCP console:

1. Open the GCP console and navigate to the Load balancing section.
2. Select the Load Balancer for which you want to enable logging.
3. Click on the Edit button on the top of the Load Balancer details page.
4. Scroll down to the Backend configuration section and click on the pencil icon next to the Global backend configuration.
5. In the Global backend configuration settings, scroll down to the Logging section and click on the toggle button to enable logging.
6. Select the appropriate log type from the drop-down menu.
7. Click on the Save button to save the changes.

After following these steps, the Load Balancer Global Backend Services will have logging enabled, and you will be able to view the logs for the Load Balancer in the Logging section of the GCP console.

#### Using CLI

To remediate the Load Balancer Global Backend Services should have logging enabled in GCP, you can follow the below steps using GCP CLI:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to enable logging for the backend service:

   ```
   gcloud compute backend-services update [BACKEND_SERVICE_NAME] --global --enable-logging
   ```

   Replace `[BACKEND_SERVICE_NAME]` with the name of the backend service for which you want to enable logging.

3. Once the command is executed successfully, the logging will be enabled for the backend service.

4. You can verify the logging is enabled by running the following command:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --global | grep loggingEnabled
   ```

   This command should return the value `loggingEnabled: true`.

By following the above steps, you can remediate the Load Balancer Global Backend Services should have logging enabled misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration of Load Balancer Global Backend Services not having logging enabled in GCP using Python, follow the steps below:

1. Import the necessary libraries:
```
from googleapiclient.discovery import build
from google.oauth2 import service_account
```

2. Set up the credentials using the service account key file:
```
credentials = service_account.Credentials.from_service_account_file('<path_to_service_account_key_file>')
```

3. Create a service object for the Compute Engine API:
```
service = build('compute', 'v1', credentials=credentials)
```

4. Get the project ID:
```
project_id = '<your_project_id>'
```

5. Get the list of all the backend services:
```
backend_services = service.backendServices().list(project=project_id).execute()
```

6. Loop through the backend services and enable logging for each one:
```
for backend_service in backend_services['items']:
    backend_service_name = backend_service['name']
    backend_service_url = f'/compute/v1/projects/{project_id}/global/backendServices/{backend_service_name}'
    
    # Get the current backend service configuration
    backend_service_config = service.backendServices().get(project=project_id, backendService=backend_service_name).execute()
    
    # Check if logging is already enabled
    if 'loadBalancingScheme' in backend_service_config and 'logConfig' in backend_service_config['loadBalancingScheme']:
        print(f"Logging is already enabled for backend service {backend_service_name}")
    else:
        # Enable logging
        backend_service_config['loadBalancingScheme']['logConfig'] = {'enable': True}
        request = service.backendServices().update(project=project_id, backendService=backend_service_name, body=backend_service_config)
        request.execute()
        print(f"Logging has been enabled for backend service {backend_service_name}")
```

7. Run the script and verify that logging has been enabled for all the backend services.

Note: Make sure that the service account used has the necessary permissions to modify the backend services.


### Additional Reading:

- [https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring](https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring) 
- [https://cloud.google.com/load-balancing/docs/l7-internal/monitoring](https://cloud.google.com/load-balancing/docs/l7-internal/monitoring) 


</Tab>
</Tabs>