---
slug: lb_regional_backend_services_logging_enabled
title: Load Balancer Regional Backend Services Should Have Logging Enabled
sidebar_label: Load Balancer Regional Backend Services Should Have Logging Enabled
---

### More Info:

Load balancers regional backend services should have request logging enabled. Logging requests to Load Balancer endpoints is a helpful way of detecting and investigating potential attacks.

### Risk Level

Medium

### Address

Security, Operational Maturity

### Compliance Standards

SOC2, GDPR, HITRUST, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Google Cloud Console: Open your web browser, navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google Cloud account.

2. Select your project: From the project drop-down (top bar), select the project that contains the load balancer you want to inspect.

3. Navigate to Load Balancing: On the left-side menu, click on "Networking" and then "Load balancing". This will display a list of all the load balancers configured in your selected project.

4. Check Logging Status: Click on the name of the load balancer you want to inspect. In the load balancer's details page, look for the "Backend services" section. Click on the name of the backend service. In the backend service's details page, look for the "Cloud Logging" section. If logging is enabled, you will see "Enabled" next to "Cloud Logging". If it's not enabled, you will see "Disabled".

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions for your specific operating system.

2. Authenticate your Google Cloud account by running the following command in your terminal:
   ```
   gcloud auth login
   ```
   Follow the prompts to log in with your Google account.

3. List all the regional backend services in your project by running the following command:
   ```
   gcloud compute backend-services list --filter="region:*"
   ```
   This command will return a list of all regional backend services in your project.

4. For each backend service, check if logging is enabled by running the following command:
   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --region [REGION] | grep "enableLogging"
   ```
   Replace `[BACKEND_SERVICE_NAME]` with the name of the backend service and `[REGION]` with the region of the backend service. This command will return the logging status of the backend service. If logging is not enabled, the command will return `enableLogging: false`.

#### Using Python

To check if Load Balancer Regional Backend Services have logging enabled in Google Cloud Platform (GCP) using Python scripts, follow the steps below:

1. **Set up Google Cloud SDK and Python Environment:**
   Before you start, make sure you have Google Cloud SDK installed and initialized in your system. Also, set up a Python environment with Google Cloud Client Libraries installed.

2. **Authentication:**
   Authenticate your SDK with GCP. You can use the command `gcloud auth application-default login` to authenticate via user account or `gcloud auth activate-service-account --key-file=KEY_FILE` for service account.

3. **Python Script to List Backend Services:**
   Use the Google Cloud Client Libraries to list all the regional backend services. Here is a sample script:

   ```python
   from google.cloud import compute_v1

   def list_backend_services(project_id, region):
       client = compute_v1.BackendServicesClient()
       region_name = f"projects/{project_id}/regions/{region}"
       return client.list(project=project_id, region=region_name)
   ```

4. **Python Script to Check Logging Status:**
   Iterate over the backend services and check the `logConfig.enable` field. If it's `False` or the `logConfig` field is not present, then logging is not enabled. Here is a sample script:

   ```python
   def check_logging_enabled(backend_services):
       for backend_service in backend_services:
           if not backend_service.log_config.enable:
               print(f"Logging is not enabled for {backend_service.name}")
   ```

   Call these functions with your project ID and region:

   ```python
   project_id = "your-project-id"
   region = "your-region"
   backend_services = list_backend_services(project_id, region)
   check_logging_enabled(backend_services)
   ```

This script will print the names of all the backend services where logging is not enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Load Balancer Regional Backend Services Should Have Logging Enabled" for GCP using GCP console, follow the steps below:

1. Go to the Google Cloud Console and select the project in which the load balancer is configured.

2. In the navigation menu, select "Network services" and then select "Load balancing".

3. Select the load balancer for which you want to enable logging.

4. Click on the "Backend services" tab.

5. Select the backend service for which you want to enable logging.

6. Click on the "Edit" button at the top of the page.

7. In the "Logging" section, select the checkbox next to "Enable logging".

8. Select the log type from the drop-down menu. You can choose from "Stackdriver Logging", "Cloud Storage", and "BigQuery".

9. Enter the destination details for the selected log type. For example, if you select "Cloud Storage", enter the bucket name and folder path.

10. Click on the "Save" button to save the changes.

Once you have completed these steps, the logging feature will be enabled for the selected backend service in the load balancer. You can repeat these steps for all the backend services in the load balancer to ensure that logging is enabled for all of them.

#### Using CLI

To remediate the misconfiguration "Load Balancer Regional Backend Services Should Have Logging Enabled" for GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell by clicking on the icon on the top right corner of the GCP console.

2. Run the below command to list all the backend services in your project:

   ```
   gcloud compute backend-services list
   ```

3. Identify the backend service for which you want to enable logging.

4. Run the below command to enable logging for the identified backend service:

   ```
   gcloud compute backend-services update [BACKEND_SERVICE_NAME] --enable-logging
   ```

   Replace [BACKEND_SERVICE_NAME] with the name of the backend service identified in step 3.

5. Verify that logging is enabled for the backend service by running the below command:

   ```
   gcloud compute backend-services describe [BACKEND_SERVICE_NAME] --format="get(loggingConfig)"
   ```

   This command should return the logging configuration for the backend service.

6. Repeat steps 3 to 5 for all the backend services in your project.

Enabling logging for backend services in GCP will help you to monitor and troubleshoot your load balancer and backend service traffic effectively.

#### Using Python

To remediate the misconfiguration of Load Balancer Regional Backend Services not having logging enabled in GCP using Python, follow the below steps:

Step 1: Import the necessary libraries and authenticate to GCP using service account credentials.

```python
from google.oauth2 import service_account
from googleapiclient.discovery import build

credentials = service_account.Credentials.from_service_account_file('/path/to/service_account.json')
compute = build('compute', 'v1', credentials=credentials)
```

Step 2: Get the list of regional backend services and their logging status.

```python
project = 'project-name'
region = 'region-name'

backend_services = compute.backendServices().list(project=project, region=region).execute()

for backend_service in backend_services['items']:
    backend_service_name = backend_service['name']
    logging_enabled = backend_service.get('logConfig', {}).get('enable')
    print(f"Backend Service Name: {backend_service_name}, Logging Enabled: {logging_enabled}")
```

Step 3: Enable logging for regional backend services that do not have it enabled.

```python
for backend_service in backend_services['items']:
    backend_service_name = backend_service['name']
    logging_enabled = backend_service.get('logConfig', {}).get('enable')
    if not logging_enabled:
        backend_service_body = {
            'logConfig': {
                'enable': True
            }
        }
        compute.backendServices().patch(project=project, region=region, backendService=backend_service_name, body=backend_service_body).execute()
        print(f"Enabled logging for Backend Service: {backend_service_name}")
```

This will enable logging for all the regional backend services that do not have it enabled in GCP.


### Additional Reading:

- [https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring](https://cloud.google.com/load-balancing/docs/https/https-logging-monitoring) 
- [https://cloud.google.com/load-balancing/docs/l7-internal/monitoring](https://cloud.google.com/load-balancing/docs/l7-internal/monitoring) 


</Tab>
</Tabs>