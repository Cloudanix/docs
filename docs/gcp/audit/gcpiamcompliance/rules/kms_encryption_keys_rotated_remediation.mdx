

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (https://console.cloud.google.com/) and sign in with your Google account that has the necessary permissions to view KMS settings.

2. Navigate to Cryptographic Keys: From the main dashboard of the Google Cloud Platform Console, click on the Navigation Menu (hamburger icon) located at the top left corner of the console. Scroll down and click on "Security" then select "Cryptographic Keys" under the Identity and Security section.

3. Select the Key Ring: On the Cryptographic Keys page, select the project and location from the drop-down menus at the top of the page. Then, click on the name of the key ring that contains the key you want to check.

4. Check Key Rotation: Once you've selected the key ring, you'll see a list of all the keys within that ring. Click on the name of the key you want to check. In the key details page, look for the "Rotation period" field. If the rotation period is set to "Never", the key is not being rotated. If there is a specific time period listed, that's how often the key is being rotated.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can do this by following the instructions provided by Google Cloud.

2. Once the SDK is installed and configured, you can list all the keys in a project by running the following command in your terminal:

   ```
   gcloud kms keys list --location global --keyring [KEYRING_NAME]
   ```

   Replace `[KEYRING_NAME]` with the name of your keyring.

3. To check the rotation period and next rotation time for a specific key, run the following command:

   ```
   gcloud kms keys versions describe [KEY_NAME] --location global --keyring [KEYRING_NAME]
   ```

   Replace `[KEY_NAME]` with the name of your key and `[KEYRING_NAME]` with the name of your keyring.

4. The output of the above command will include fields named `rotationPeriod` and `nextRotationTime`. If the `rotationPeriod` is not set to 90 days or less, or if the `nextRotationTime` is not in the future, then the key is not being rotated properly.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) in your environment. This can be done using pip:

   ```bash
   pip install boto3
   ```

2. Import the necessary libraries and initialize the client: In your Python script, you need to import the Boto3 library and initialize the IAM client.

   ```python
   import boto3
   import datetime

   client = boto3.client('kms')
   ```

3. List all KMS keys and check their rotation status: You can use the `list_keys` method to get all KMS keys and then use the `get_key_rotation_status` method to check if key rotation is enabled for each key.

   ```python
   def check_key_rotation():
       keys = client.list_keys()
       for key in keys['Keys']:
           rotation_status = client.get_key_rotation_status(KeyId=key['KeyId'])
           if not rotation_status['KeyRotationEnabled']:
               print(f"Key {key['KeyId']} does not have rotation enabled")

   check_key_rotation()
   ```

4. Schedule the script to run periodically: To ensure that you are regularly checking the rotation status of your KMS keys, you can schedule this script to run periodically. This can be done using a cron job on Unix-based systems or Task Scheduler on Windows. The frequency of the checks will depend on your specific requirements, but a common choice is to run the script once a day.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the KMS Encryption Keys Rotation issue in GCP using the GCP console:

1. Open the Google Cloud Console and select the project in which the KMS key is created.
2. In the left navigation menu, click on the "Security" option and select "Encryption keys" from the drop-down menu.
3. Select the KMS key for which you want to enable rotation.
4. Click on the "Edit" button at the top of the page.
5. In the "Edit key" dialog box, scroll down to the "Rotation" section.
6. Toggle the switch for "Automatic key rotation" to "On".
7. Set the "Rotation period" to a desired value. It is recommended to rotate the key once a year.
8. Click on the "Save" button to save the changes.

After completing these steps, the KMS key rotation will be enabled, and the key will be automatically rotated based on the rotation period set by you. This will help to ensure that your encryption keys are updated and secure.

#### Using CLI

To remediate the KMS Encryption Keys rotation issue in GCP using GCP CLI, you can follow the below steps:

1. Open the Google Cloud Console and select the project in which you want to remediate the issue.

2. Open the Cloud Shell by clicking on the icon located at the top right corner of the console.

3. Run the following command to list all the KMS encryption keys in your project:

```
gcloud kms keys list
```

4. Identify the key that needs to be rotated.

5. Run the following command to rotate the key:

```
gcloud kms keys rotate [KEY_NAME] --location [LOCATION] --keyring [KEYRING_NAME]
```

Replace [KEY_NAME], [LOCATION], and [KEYRING_NAME] with the actual values of the key that needs to be rotated.

6. Confirm the rotation by running the following command:

```
gcloud kms keys describe [KEY_NAME] --location [LOCATION] --keyring [KEYRING_NAME]
```

This command will display the details of the key, including the rotation period.

7. Repeat steps 5 and 6 for all the KMS encryption keys that need to be rotated.

By following these steps, you will be able to remediate the KMS Encryption Keys rotation issue in GCP using GCP CLI.

#### Using Python

To remediate this issue in GCP using Python, you can follow these steps:

1. Install the necessary libraries:

```
pip install google-cloud-kms google-auth
```

2. Authenticate with the GCP project:

```
from google.oauth2 import service_account

credentials = service_account.Credentials.from_service_account_file('path/to/service_account.json')
```

3. Retrieve the list of KMS keys in the project:

```
from google.cloud import kms_v1

client = kms_v1.KeyManagementServiceClient(credentials=credentials)
parent = client.key_ring_path(project_id, location_id, key_ring_id)

keys = client.list_crypto_keys(parent)
```

4. For each key, check the creation time and determine if it needs to be rotated:

```
from datetime import datetime, timedelta

for key in keys:
    create_time = datetime.strptime(key.create_time.strftime('%Y-%m-%d %H:%M:%S.%f'), '%Y-%m-%d %H:%M:%S.%f')
    if datetime.now() - create_time > timedelta(days=365):
        # Key needs to be rotated
        # Generate a new key version
        response = client.create_crypto_key_version(key.name)
```

5. Finally, delete the old key versions:

```
for key in keys:
    versions = client.list_crypto_key_versions(key.name)
    for version in versions:
        create_time = datetime.strptime(version.create_time.strftime('%Y-%m-%d %H:%M:%S.%f'), '%Y-%m-%d %H:%M:%S.%f')
        if datetime.now() - create_time > timedelta(days=365):
            # Delete the key version
            client.destroy_crypto_key_version(version.name)
```

Note: Replace `project_id`, `location_id`, and `key_ring_id` with the appropriate values for your GCP project. Also, make sure that the service account used for authentication has the necessary permissions to manage KMS keys.


</Tab>
</Tabs>