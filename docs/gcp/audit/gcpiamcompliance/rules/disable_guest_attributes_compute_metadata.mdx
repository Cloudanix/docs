---
slug: disable_guest_attributes_compute_metadata
title: Disable Guest Attributes of Compute Engine Metadata
sidebar_label: Disable Guest Attributes of Compute Engine Metadata
---

### More Info:

Ensure that "Disable Guest Attributes of Compute Engine Metadata" organization policy is enforced in order to disable Compute Engine API access to the guest attributes configured for the virtual machines instances that belong to your project, folder, or organization.

### Risk Level

Medium

### Address

Reliability, Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Google Cloud Console: Open your web browser, navigate to the Google Cloud Console (console.cloud.google.com), and sign in with your Google Cloud account.

2. Select your project: From the project drop-down (My First Project), select the project that contains the resources you want to check and click Open.

3. Navigate to the VM instances page: On the left side menu, click on "Compute Engine", then "VM instances". This will open a list of all your Compute Engine instances.

4. Check Guest Attributes: For each instance, click on the instance name to open its details page. Scroll down to the "Cloud API" section and look for "Guest Attributes". If "Guest Attributes" is enabled, it means that the instance is misconfigured. If it's disabled, then the instance is correctly configured.

#### Using CLI

1. First, you need to install and initialize the Google Cloud SDK if you haven't done so already. You can download it from the official Google Cloud website and follow the instructions provided.

2. Once the SDK is installed, open your terminal or command prompt and authenticate your Google Cloud account by running the following command:
   ```
   gcloud auth login
   ```
   Follow the instructions on the screen to log in to your account.

3. Now, you can list all the instances in your project by running the following command:
   ```
   gcloud compute instances list
   ```
   This command will return a list of all the instances in your project, along with their details.

4. To check the guest attributes of a specific instance, you can use the following command:
   ```
   gcloud compute instances get-guest-attributes [INSTANCE_NAME] --zone=[ZONE]
   ```
   Replace `[INSTANCE_NAME]` with the name of the instance you want to check and `[ZONE]` with the zone where the instance is located. If the guest attributes are disabled, this command will return an error message.

#### Using Python

To check if the Guest Attributes of Compute Engine Metadata are disabled in IAM using Python scripts, you can follow these steps:

1. **Set up Google Cloud SDK and Python Environment:**
   Before you start, make sure you have installed Google Cloud SDK and Python on your local machine. Also, you need to authenticate your account and set the project using the following commands:

   ```bash
   gcloud auth login
   gcloud config set project [PROJECT_ID]
   ```

2. **Install Required Python Libraries:**
   You need to install the `google-auth`, `google-auth-httplib2`, `google-auth-oauthlib`, `google-api-python-client`, and `oauthlib` Python libraries. You can install them using pip:

   ```bash
   pip install --upgrade google-auth google-auth-httplib2 google-auth-oauthlib google-api-python-client oauthlib
   ```

3. **Create a Python Script:**
   Create a Python script to check the guest attributes of Compute Engine Metadata. Here is a sample script:

   ```python
   from googleapiclient import discovery
   from google.oauth2 import service_account

   # Load the credentials
   credentials = service_account.Credentials.from_service_account_file(
       '[PATH_TO_YOUR_SERVICE_ACCOUNT_JSON_FILE]')

   # Build the service
   service = discovery.build('compute', 'v1', credentials=credentials)

   # Get the project ID
   project_id = '[YOUR_PROJECT_ID]'

   # List all instances
   request = service.instances().list(project=project_id, zone='[YOUR_ZONE]')
   response = request.execute()

   # Check the guest attributes
   for instance in response['items']:
       if 'metadata' in instance and 'items' in instance['metadata']:
           for item in instance['metadata']['items']:
               if item['key'] == 'guest-attributes' and item['value'] == 'TRUE':
                   print(f"Instance {instance['name']} has guest attributes enabled.")
   ```

4. **Run the Python Script:**
   Finally, run the Python script. If any instances have guest attributes enabled, it will print out their names. If no output is produced, it means that all instances have guest attributes disabled.

Please replace `[PATH_TO_YOUR_SERVICE_ACCOUNT_JSON_FILE]`, `[YOUR_PROJECT_ID]`, and `[YOUR_ZONE]` with your actual service account JSON file path, project ID, and zone respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of disabling the Guest Attributes of Compute Engine Metadata in GCP using the GCP console, follow these steps:

1. Open the GCP Console and select the project where the misconfiguration exists.
2. Navigate to the Compute Engine section from the left-hand menu.
3. Click on the instance where the Guest Attributes of Compute Engine Metadata needs to be enabled.
4. Click on the "Edit" button at the top of the page.
5. Scroll down to the "Cloud Metadata" section and click on "Add item".
6. In the "Key" field, enter "enable-guest-attributes".
7. In the "Value" field, enter "TRUE".
8. Click on the "Save" button at the bottom of the page to save the changes.

After completing these steps, the Guest Attributes of Compute Engine Metadata will be enabled for the instance, and the misconfiguration will be remediated.

#### Using CLI

To remediate the misconfiguration "Disable Guest Attributes of Compute Engine Metadata" for GCP using GCP CLI, you can follow the below steps:

Step 1: Open the Google Cloud Shell.

Step 2: Run the following command to disable guest attributes of Compute Engine Metadata:

```
gcloud compute instances add-metadata INSTANCE_NAME --metadata=google-compute-disable-guest-attributes=true
```

Note: Replace INSTANCE_NAME with the name of the instance for which you want to disable guest attributes of Compute Engine Metadata.

Step 3: Verify that the guest attributes of Compute Engine Metadata have been disabled by running the following command:

```
gcloud compute instances describe INSTANCE_NAME --format="get(metadata.items['google-compute-disable-guest-attributes'])"
```

Note: Replace INSTANCE_NAME with the name of the instance for which you have disabled guest attributes of Compute Engine Metadata.

If the output of the above command is "true", then it means that the guest attributes of Compute Engine Metadata have been successfully disabled.

#### Using Python

To remediate the misconfiguration of disabling guest attributes of Compute Engine Metadata in GCP using Python, you can follow the below steps:

Step 1: Set up the GCP SDK and authentication using the following command:

```
gcloud auth login
```

Step 2: Import the required libraries in Python:

```
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials
```

Step 3: Create a function to disable the guest attributes of Compute Engine Metadata:

```
def disable_guest_attributes(project_id, zone):
    credentials = GoogleCredentials.get_application_default()
    service = discovery.build('compute', 'v1', credentials=credentials)
    metadata = service.instances().get(project=project_id, zone=zone, instance='INSTANCE_NAME').execute()['metadata']
    items = metadata['items']
    for item in items:
        if item['key'] == 'enable-guest-attributes':
            item['value'] = 'FALSE'
    metadata['items'] = items
    service.instances().setMetadata(project=project_id, zone=zone, instance='INSTANCE_NAME', body=metadata).execute()
```

Step 4: Replace the project_id, zone, and INSTANCE_NAME with your GCP project ID, zone, and instance name respectively.

Step 5: Call the function to disable the guest attributes of Compute Engine Metadata:

```
disable_guest_attributes('PROJECT_ID', 'ZONE')
```

Note: Replace the PROJECT_ID and ZONE with your GCP project ID and zone respectively.

After executing the above code, the guest attributes of Compute Engine Metadata will be disabled for the specified instance.




</Tab>
</Tabs>