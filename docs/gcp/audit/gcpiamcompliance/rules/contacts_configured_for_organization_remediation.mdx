

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account that has the necessary permissions to view IAM settings.

2. Navigate to IAM & Admin: Once you're logged in, locate the navigation menu on the top left corner of the console. Click on it and scroll down to find "IAM & Admin". Click on it to open the IAM & Admin dashboard.

3. Access IAM settings: In the IAM & Admin dashboard, you will see several options. Click on "Settings" to access the IAM settings for your organization.

4. Check Essential Contacts: In the Settings page, scroll down to find the "Essential Contacts" section. Here, you can see if essential contacts have been configured for your organization. If there are any contacts listed, they are the essential contacts. If there are no contacts listed, then essential contacts have not been configured.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your CLI with your Google Cloud account by running the following command:
   ```
   gcloud auth login
   ```
   This will open a new browser window where you can log in with your Google Cloud account. After successful login, your CLI will be authenticated.

3. Set your active project to the project you want to check the Essential Contacts configuration for. You can do this by running the following command:
   ```
   gcloud config set project PROJECT_ID
   ```
   Replace `PROJECT_ID` with the ID of your project.

4. Now, you can list all the Essential Contacts for your project by running the following command:
   ```
   gcloud alpha essential-contacts contacts list --project=PROJECT_ID
   ```
   Replace `PROJECT_ID` with the ID of your project. This will list all the Essential Contacts for your project. If no contacts are listed, then Essential Contacts are not configured for your project.

#### Using Python

To check if essential contacts are configured for an organization in IAM using Python scripts, you can use the Google Cloud SDK (gcloud) or the Google Cloud Client Libraries. Here are the steps:

1. **Install Google Cloud SDK and Python Client Libraries:**
   Before you start, make sure you have installed the Google Cloud SDK and Python client libraries. You can install the SDK using the following command:
   ```
   curl https://sdk.cloud.google.com | bash
   ```
   And the Python client library using:
   ```
   pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
   ```

2. **Authenticate your SDK:**
   Authenticate your SDK to your GCP account using the following command:
   ```
   gcloud auth application-default login
   ```
   This will open a new browser window for you to log in to your GCP account.

3. **Use Python Script to Check Essential Contacts:**
   Use the following Python script to check if essential contacts are configured for your organization:

   ```python
   from googleapiclient import discovery
   from googleapiclient.errors import HttpError
   from google.oauth2 import service_account

   def list_contacts(project_id):
       """Lists all essential contacts for a project."""
       service = discovery.build('essentialcontacts', 'v1', cache_discovery=False)
       try:
           request = service.projects().contacts().list(parent='projects/{}'.format(project_id))
           response = request.execute()
           return response.get('contacts', [])
       except HttpError as error:
           print('An error occurred: {}'.format(error))

   def main():
       project_id = 'your-project-id'  # replace with your project id
       contacts = list_contacts(project_id)
       if not contacts:
           print('No essential contacts found for project {}'.format(project_id))
       else:
           for contact in contacts:
               print('Found contact: {}'.format(contact['email']))

   if __name__ == '__main__':
       main()
   ```
   Replace 'your-project-id' with your actual project id. This script will list all the essential contacts for your project.

4. **Interpret the Results:**
   If the script returns 'No essential contacts found for project', it means that there are no essential contacts configured for your organization. If it returns 'Found contact: [email]', it means that the email is configured as an essential contact for your organization.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Ensure Essential Contacts Configured For Organization" for GCP using GCP console, follow the steps given below:

1. Login to GCP console using your credentials.
2. Go to the Navigation menu and select "IAM & Admin".
3. Click on "Settings" from the left-hand side menu.
4. Scroll down to the "Essential Contacts" section and click on "Configure".
5. Click on "Add contact" and enter the email address of the contact person.
6. Select the contact type from the dropdown menu.
7. Click on "Add" to save the contact details.
8. Repeat steps 5 to 7 to add more contacts if required.
9. Once you have added all the essential contacts, click on "Save" to save the changes.

By following these steps, you have successfully remediated the misconfiguration "Ensure Essential Contacts Configured For Organization" for GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Ensure Essential Contacts Configured For Organization" for GCP using GCP CLI, you can follow the below steps:

1. Open the GCP Cloud Shell by clicking on the Activate Cloud Shell button on the top of the GCP Console.

2. Run the following command to list all the organizations in your GCP account:

   ```
   gcloud organizations list
   ```

3. Note down the organization ID of the organization for which you want to ensure essential contacts are configured.

4. Run the following command to ensure essential contacts are configured for the organization:

   ```
   gcloud alpha organizations update <ORGANIZATION_ID> --essential-contact-emails=<EMAIL_ADDRESS>
   ```

   Replace `<ORGANIZATION_ID>` with the organization ID you noted down in step 3 and `<EMAIL_ADDRESS>` with the email address of the essential contact(s) you want to configure.

   Note: You can configure multiple email addresses separated by commas.

5. Verify that the essential contact(s) have been configured for the organization by running the following command:

   ```
   gcloud alpha organizations describe <ORGANIZATION_ID> --format="value(essentialContacts)"
   ```

   This command will output the email address(es) of the essential contact(s) configured for the organization.

By following the above steps, you can remediate the misconfiguration "Ensure Essential Contacts Configured For Organization" for GCP using GCP CLI.

#### Using Python

To remediate the "Ensure Essential Contacts Configured For Organization" misconfiguration for GCP using Python, you can follow these steps:

1. Import the necessary libraries:

```python
from google.oauth2 import service_account
from googleapiclient.discovery import build
```

2. Set up authentication using a service account:

```python
credentials = service_account.Credentials.from_service_account_file('path/to/service_account.json')
```

3. Create a client object for the Organizations API:

```python
org_client = build('cloudresourcemanager', 'v1', credentials=credentials)
```

4. Get the current organization:

```python
org = org_client.organizations().get(name='organizations/your_org_id').execute()
```

5. Check if essential contacts are configured:

```python
if 'notificationSettings' in org and 'pubsubTopic' in org['notificationSettings']:
    print('Essential contacts are configured.')
else:
    print('Essential contacts are not configured.')
```

6. If essential contacts are not configured, configure them:

```python
topic_name = 'your_pubsub_topic_name'

notification_settings = {
    'pubsubTopic': f'projects/{project_id}/topics/{topic_name}',
    'cloudAuditLogsEnabled': True,
    'projectDeletionPolicy': 'ABANDON',
    'folderDeletionPolicy': 'ABANDON'
}

org_client.organizations().updateNotificationSettings(name=f'organizations/{org_id}', body=notification_settings).execute()

print('Essential contacts have been configured.')
```

Note: Replace `your_org_id`, `project_id`, `topic_name`, and `org_id` with the appropriate values for your organization. Also, make sure the service account has the necessary permissions to update organization settings.


</Tab>
</Tabs>