---
slug: service_account_managed_keys
title: Keys Should Be Managed By Google
sidebar_label: Keys Should Be Managed By Google
---

### More Info:

Service account keys should be managed by Google to ensure that they are as secure as possible, including key rotations and restrictions to the accessibility of the keys.

### Risk Level

High

### Address

Security

### Compliance Standards

CISGCP, CBP, HIPAA, ISO27001


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser and navigate to the Google Cloud Platform Console (console.cloud.google.com). Use your Google account credentials to sign in.

2. Navigate to IAM & Admin: Once you're logged in, locate the navigation menu on the left-hand side of the console. Click on the menu icon (three horizontal lines), then scroll down and click on "IAM & Admin".

3. View IAM Members: In the IAM & Admin page, click on "IAM" in the left-hand side menu. This will bring up a list of all IAM members and their roles. 

4. Check Keys: Look for any IAM members that have keys associated with them. If the keys are not managed by Google, they will be listed as "User-managed". Google-managed keys will be listed as "Google-managed".

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Once the Google Cloud SDK CLI is installed and configured, you can use the `gcloud` command to interact with your Google Cloud resources. 

3. To check if the keys are managed by Google in IAM, you can use the `gcloud iam service-accounts keys list` command. This command lists all the keys for a specific service account. Replace `[SERVICE_ACCOUNT_ID]` with your service account ID.

    ```
    gcloud iam service-accounts keys list --iam-account [SERVICE_ACCOUNT_ID]
    ```

4. The output of this command will show you a list of keys for the service account, including the key IDs, the creation dates, and the expiration dates. If the keys are managed by Google, they will have an expiration date. If they don't have an expiration date, it means they are user-managed keys.

#### Using Python

To check if keys are managed by Google in IAM using Python scripts, you can follow these steps:

1. **Install Google Cloud SDK and Python Client for IAM**:
   Before you start, make sure you have installed the Google Cloud SDK and the Python client for IAM. You can install the Python client for IAM using pip:
   ```
   pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
   ```

2. **Authenticate and Initialize the IAM Service**:
   Use the `google.oauth2` library to authenticate and initialize the IAM service. You will need to provide your service account key file for authentication.
   ```python
   from google.oauth2 import service_account
   from googleapiclient import discovery

   credentials = service_account.Credentials.from_service_account_file(
       '/path/to/keyfile.json')
   service = discovery.build('iam', 'v1', credentials=credentials)
   ```

3. **List All Service Accounts**:
   Use the `projects().serviceAccounts().list()` method to list all service accounts in your project. Replace `'my-project-id'` with your actual project ID.
   ```python
   request = service.projects().serviceAccounts().list(
       name='projects/my-project-id')
   response = request.execute()
   ```

4. **Check Keys Managed by Google**:
   For each service account, use the `projects().serviceAccounts().keys().list()` method to list all keys. Then, check the `keyType` field of each key. If the `keyType` is `SYSTEM_MANAGED`, the key is managed by Google.
   ```python
   for account in response['accounts']:
       request = service.projects().serviceAccounts().keys().list(
           name=account['name'])
       keys_response = request.execute()
       for key in keys_response['keys']:
           if key['keyType'] == 'SYSTEM_MANAGED':
               print(f"Key {key['name']} is managed by Google.")
           else:
               print(f"Key {key['name']} is not managed by Google.")
   ```
Please note that you need the necessary permissions to list service accounts and keys in your project.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Keys Should Be Managed By Google" in GCP, follow the below steps using GCP console:

1. Open the GCP Console and navigate to the project for which you want to remediate the misconfiguration.
2. Click on the "IAM & Admin" option in the left-hand menu.
3. Click on the "Service Accounts" tab.
4. Select the service account for which you want to remediate the misconfiguration.
5. Click on the "Edit" button at the top of the page.
6. Scroll down to the "Keys" section.
7. Click on the "Delete" button next to any existing keys that are not managed by Google.
8. Click on the "Create Key" button.
9. Select the "JSON" key type.
10. Click on the "Create" button.

By following these steps, you have now remediated the misconfiguration "Keys Should Be Managed By Google" in GCP by deleting any existing keys that are not managed by Google and creating a new key that is managed by Google.

#### Using CLI

The "Keys Should Be Managed By Google" misconfiguration in GCP means that there are service account keys being used that are not managed by Google. To remediate this issue, you can follow these steps using the GCP CLI:

1. Identify the service account keys that are not managed by Google:
```
gcloud iam service-accounts keys list --iam-account [SERVICE-ACCOUNT-EMAIL]
```
Note: Replace [SERVICE-ACCOUNT-EMAIL] with the email address of the service account that you want to check.

2. Delete the non-managed service account keys:
```
gcloud iam service-accounts keys delete [KEY-ID] --iam-account [SERVICE-ACCOUNT-EMAIL]
```
Note: Replace [KEY-ID] with the ID of the non-managed key and [SERVICE-ACCOUNT-EMAIL] with the email address of the service account that you want to delete the key from.

3. Enable automatic rotation of service account keys:
```
gcloud beta iam service-accounts keys create [KEY-NAME] --iam-account [SERVICE-ACCOUNT-EMAIL] --key-usage=sign-for-digital-signature --rotation-period=90d --next-rotation-time=60d
```
Note: Replace [KEY-NAME] with a name for the new key, [SERVICE-ACCOUNT-EMAIL] with the email address of the service account that you want to enable automatic rotation for, and adjust the rotation period and next rotation time to meet your requirements.

By following these steps, you can remediate the "Keys Should Be Managed By Google" misconfiguration in GCP using the GCP CLI.

#### Using Python

To remediate the "Keys Should Be Managed By Google" misconfiguration for GCP using Python, you can follow these steps:

1. Install the Google Cloud SDK and authenticate to your GCP project using the command `gcloud auth login`.

2. Install the `google-cloud-iam` Python library using the command `pip install google-cloud-iam`.

3. Write a Python script that uses the `google-cloud-iam` library to remove any non-Google-managed service account keys. Here's an example script:

```python
from google.cloud import iam

# Replace [PROJECT_ID] with your GCP project ID
client = iam.IAMClient(project="[PROJECT_ID]")

# Get a list of all service accounts in the project
accounts = client.list_service_accounts()

# Loop through each service account
for account in accounts:
    # Get a list of all keys for the service account
    keys = client.list_service_account_keys(account.name)

    # Loop through each key
    for key in keys:
        # Check if the key is user-managed
        if not key.key_origin.startswith("google"):
            # Delete the key
            client.delete_service_account_key(key.name)
```

4. Run the Python script using the command `python script.py`. This will remove any non-Google-managed service account keys in your GCP project.

Note: Before running the script, make sure to review and understand the impact of removing non-Google-managed service account keys in your GCP project.




</Tab>
</Tabs>