---
slug: enforce_uniform_bucket_level_access_at_org_level
title: Enforce Uniform Bucket-Level Access at Organization Level
sidebar_label: Enforce Uniform Bucket-Level Access at Organization Level
---

### More Info:

Ensure that "Enforce uniform bucket-level access" policy is enabled for your Google Cloud Platform (GCP) organization in order to enforce uniform bucket-level access for all Google Cloud Storage buckets available in your organization.

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

CISGCP, CBP, HIPAA, ISO27001


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to your Google Cloud Platform (GCP) console.

2. Navigate to the IAM & Admin page. You can do this by clicking on the navigation menu (three horizontal lines in the upper left-hand corner), then selecting "IAM & Admin".

3. In the IAM & Admin page, select "IAM" from the left-hand side menu. This will display a list of all the IAM roles in your organization.

4. Check the policies for each role to see if the "Enforce Uniform Bucket-Level Access" is enabled. This can be done by clicking on the role, then looking at the "Permissions" tab. If the "storage.buckets.getIamPolicy" permission is not listed, then Uniform Bucket-Level Access is not enforced at the organization level.

#### Using CLI

1. First, you need to install and initialize the Google Cloud SDK if you haven't done so already. You can download it from the official Google Cloud website and follow the instructions to install it. Once installed, you can initialize it using the following command:

   ```
   gcloud init
   ```

2. Once the SDK is installed and initialized, you can list all the buckets in your project using the following command:

   ```
   gsutil ls -p [PROJECT_ID]
   ```

   Replace `[PROJECT_ID]` with your actual project ID.

3. To check the Uniform Bucket-Level Access (UBLA) setting for each bucket, you can use the following command:

   ```
   gsutil iam get gs://[BUCKET_NAME]
   ```

   Replace `[BUCKET_NAME]` with the name of each bucket you want to check. This command will return the IAM policy for the bucket.

4. In the returned IAM policy, look for the `uniformBucketLevelAccess` field. If it's set to `true`, then UBLA is enabled for the bucket. If it's set to `false` or if the field is not present, then UBLA is not enabled.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing Python scripts to interact with GCP, you need to install the necessary libraries. You can do this by running the following command in your terminal:

```python
pip install google-cloud-storage
```

2. Import the necessary libraries and initialize the client: In your Python script, you need to import the necessary libraries and initialize the client. Here is how you can do it:

```python
from google.cloud import storage

def create_storage_client():
    return storage.Client()
```

3. Get the list of all buckets in the organization: You can get the list of all buckets in the organization by calling the `list_buckets` method on the client. Here is how you can do it:

```python
def list_all_buckets(storage_client):
    return storage_client.list_buckets()
```

4. Check if Uniform Bucket-Level Access is enabled: For each bucket, you can check if Uniform Bucket-Level Access is enabled by calling the `get_iam_policy` method on the bucket and checking the `uniform_bucket_level_access` attribute. Here is how you can do it:

```python
def check_uniform_bucket_level_access(bucket):
    policy = bucket.get_iam_policy(requested_policy_version=3)
    return policy.uniform_bucket_level_access.enabled
```

You can then use these functions in your script to check if Uniform Bucket-Level Access is enabled for all buckets in the organization. Here is a complete script:

```python
from google.cloud import storage

def create_storage_client():
    return storage.Client()

def list_all_buckets(storage_client):
    return storage_client.list_buckets()

def check_uniform_bucket_level_access(bucket):
    policy = bucket.get_iam_policy(requested_policy_version=3)
    return policy.uniform_bucket_level_access.enabled

def main():
    storage_client = create_storage_client()
    for bucket in list_all_buckets(storage_client):
        if not check_uniform_bucket_level_access(bucket):
            print(f'Bucket {bucket.name} does not have Uniform Bucket-Level Access enabled')

if __name__ == '__main__':
    main()
```

This script will print the names of all buckets that do not have Uniform Bucket-Level Access enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of not enforcing uniform bucket-level access at the organization level in GCP, you can follow these steps:

1. Open the Google Cloud Console and navigate to the Cloud Storage page.
2. Select the bucket for which you want to enforce uniform bucket-level access.
3. Click on the "Edit Bucket Permissions" button.
4. Under the "Uniform bucket-level access" section, select the "Enforced" option.
5. Click on the "Save" button to apply the changes.

Once you have enforced uniform bucket-level access at the organization level, all objects in the bucket will inherit the bucket's access control settings. This will help prevent accidental data leaks or unauthorized access to your data.

#### Using CLI

To remediate the misconfiguration "Enforce Uniform Bucket-Level Access at Organization Level" for GCP using GCP CLI, follow the below steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to set the organization policy constraint for enforcing uniform bucket-level access:

   ```
   gcloud resource-manager org-policies set-policy constraint/compute.requireUniformBucketLevelAccess \
   --project=[PROJECT_ID] \
   --policy-file=- <<EOF
   {
     "booleanPolicy": {
       "enforced": true
     }
   }
   EOF
   ```

   Note: Replace [PROJECT_ID] with the ID of the project in which the policy constraint should be set.

3. Verify that the policy constraint has been set by running the following command:

   ```
   gcloud resource-manager org-policies describe compute.requireUniformBucketLevelAccess \
   --project=[PROJECT_ID]
   ```

   Note: Replace [PROJECT_ID] with the ID of the project in which the policy constraint should be set.

4. Repeat the above steps for all the projects in the GCP organization to ensure that uniform bucket-level access is enforced across all the projects.

By following the above steps, you can remediate the misconfiguration "Enforce Uniform Bucket-Level Access at Organization Level" for GCP using GCP CLI.

#### Using Python

To remediate the "Enforce Uniform Bucket-Level Access at Organization Level" misconfiguration in GCP, you can use the following steps in Python:

1. Import the necessary libraries:
```
from google.cloud import storage
from google.oauth2 import service_account
```

2. Set up the credentials for your GCP account:
```
credentials = service_account.Credentials.from_service_account_file('<path_to_service_account_file>')
```

3. Initialize the storage client:
```
storage_client = storage.Client(project='<your_project_id>', credentials=credentials)
```

4. Get the list of all buckets in the project:
```
buckets = list(storage_client.list_buckets())
```

5. For each bucket, check if Uniform Bucket-Level Access is enabled:
```
for bucket in buckets:
    bucket_name = bucket.name
    bucket_obj = storage_client.bucket(bucket_name)
    bucket_policy = bucket_obj.get_iam_policy(requested_policy_version=3)
    if bucket_policy.uniform_bucket_level_access_enabled:
        print(f"Uniform Bucket-Level Access is already enabled for bucket {bucket_name}")
    else:
        print(f"Enabling Uniform Bucket-Level Access for bucket {bucket_name}")
        bucket_policy.uniform_bucket_level_access_enabled = True
        bucket_obj.set_iam_policy(bucket_policy)
```

6. Run the above script to enable Uniform Bucket-Level Access for all the buckets in the project.

Note: Make sure you have the necessary permissions to modify the IAM policies for the buckets.




</Tab>
</Tabs>