---
slug: open_all_ports
title: All Ports Should Not Be Open To Public
sidebar_label: All Ports Should Not Be Open To Public
---

### More Info:

Determines if all ports are open to the public.

### Risk Level

Critical

### Address

Security

### Compliance Standards

SOC2, NIST, PCIDSS, GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser and navigate to the Google Cloud Platform Console (console.cloud.google.com). Enter your login credentials to access your GCP account.

2. Navigate to VPC Network: Once you are logged in, click on the navigation menu (three horizontal lines) located at the top left corner of the console. Scroll down and click on "VPC Network" under the "Networking" section.

3. Check Firewall Rules: In the VPC Network page, click on "Firewall" from the left-hand side menu. This will display a list of all the firewall rules that are currently set up in your GCP environment.

4. Inspect Firewall Rules: For each firewall rule, check the "Source filter" and "Allowed protocols and ports" columns. If the source filter is set to "0.0.0.0/0" (which means all IP addresses) and the allowed protocols and ports include all ports, then this indicates that all ports are open to the public.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions for your specific operating system. Once installed, authenticate it using the command `gcloud auth login`.

2. List all the firewall rules in your GCP project using the following command: `gcloud compute firewall-rules list`. This command will return a list of all firewall rules, including their names, network, direction, priority, source ranges, allowed protocols and ports, and whether they are enabled or not.

3. To check if all ports are open to the public, you need to look at the 'source-ranges' and 'allowed' columns in the output. If the 'source-ranges' column contains '0.0.0.0/0', it means that the rule is open to all IP addresses, i.e., the public. If the 'allowed' column contains 'tcp:0-65535;udp:0-65535', it means that all ports are open.

4. To filter out the rules that have all ports open to the public, you can use the following command: `gcloud compute firewall-rules list --filter="sourceRanges=(0.0.0.0/0) AND allowed[].map().firewall_rule().contains('tcp:0-65535;udp:0-65535')"` This command will return only the rules that have all ports open to the public.

#### Using Python

1. AWS:
   - Use the boto3 library in Python to interact with AWS services. 
   ```python
   import boto3
   ec2 = boto3.resource('ec2')
   security_groups = ec2.security_groups.all()
   for group in security_groups:
       for permission in group.ip_permissions:
           for ip_range in permission['IpRanges']:
               if ip_range['CidrIp'] == '0.0.0.0/0':
                   print(f"Security Group: {group.group_name} has all ports open to the public")
   ```
   This script will print out the names of all security groups that have all ports open to the public.

2. Azure:
   - Use the azure-mgmt-network library in Python to interact with Azure Network services.
   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   network_client = NetworkManagementClient(credential, subscription_id)

   network_security_groups = network_client.network_security_groups.list_all()
   for nsg in network_security_groups:
       for rule in nsg.security_rules:
           if rule.destination_port_range == '*' and rule.source_address_prefix == '*':
               print(f"Network Security Group: {nsg.name} has all ports open to the public")
   ```
   This script will print out the names of all network security groups that have all ports open to the public.

3. GCP:
   - Use the google-cloud-securitycenter library in Python to interact with GCP Security Command Center.
   ```python
   from google.cloud import securitycenter_v1

   client = securitycenter_v1.SecurityCenterClient()

   organization_id = 'your-organization-id'
   all_sources = "{}/sources/-".format(client.organization_path(organization_id))

   findings = client.list_findings(all_sources)
   for finding in findings:
       if 'open_ports' in finding.finding_class:
           print(f"Asset: {finding.resource_name} has all ports open to the public")
   ```
   This script will print out the names of all assets that have all ports open to the public.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of having all ports open to the public in GCP, you can follow the below steps using the GCP console:

1. Open the Google Cloud Platform (GCP) Console and navigate to the project where the misconfiguration exists.
2. In the left-hand menu, click on "Compute Engine" and then click on "VM instances".
3. Select the instance that needs to be remediated.
4. Click on the "Edit" button at the top of the page.
5. Scroll down to the "Firewall" section and click on "Networking".
6. In the "Firewall rules" section, click on "default-allow-ssh".
7. In the "Protocols and ports" section, select "Specified protocols and ports" and enter "tcp:22" in the text box.
8. Click on "Save" to save the changes.

This will remediate the misconfiguration of having all ports open to the public by limiting access to only the SSH port (port 22).

#### Using CLI

To remediate the misconfiguration "All Ports Should Not Be Open To Public" in GCP using GCP CLI, follow these steps:

1. First, identify the project and the VM instance that has all ports open to the public. You can use the following command to list all the VM instances in the project:

   ```
   gcloud compute instances list
   ```

2. Once you have identified the VM instance, you can update its firewall rules to restrict access to only the required ports. You can use the following command to list all the firewall rules in the project:

   ```
   gcloud compute firewall-rules list
   ```

3. Identify the firewall rule that allows all ports to be open to the public. You can use the following command to describe the firewall rule:

   ```
   gcloud compute firewall-rules describe [FIREWALL_RULE_NAME]
   ```

4. Update the firewall rule to allow access only to the required ports. You can use the following command to update the firewall rule:

   ```
   gcloud compute firewall-rules update [FIREWALL_RULE_NAME] --allow [PORTS_TO_ALLOW]
   ```

   Replace `[FIREWALL_RULE_NAME]` with the name of the firewall rule that you want to update and `[PORTS_TO_ALLOW]` with the list of ports that you want to allow access to. For example, if you want to allow access only to ports 80 and 443, you can use the following command:

   ```
   gcloud compute firewall-rules update [FIREWALL_RULE_NAME] --allow tcp:80,tcp:443
   ```

5. Verify that the firewall rule has been updated by listing all the firewall rules again:

   ```
   gcloud compute firewall-rules list
   ```

   Ensure that the firewall rule that you updated has the correct ports allowed.

By following these steps, you can remediate the misconfiguration "All Ports Should Not Be Open To Public" in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "All Ports Should Not Be Open To Public" in GCP using Python, you can follow the below steps:

1. First, you need to identify the VM instances that have all ports open to public. You can use the GCP Python SDK to list all VM instances and their firewall rules.

2. Once you have identified the VM instances with the misconfiguration, you can use the GCP Python SDK to update the firewall rules and restrict the open ports. You can create a new firewall rule to allow only the required ports and protocols and delete the existing firewall rule that allows all ports.

Here is the sample Python code to remediate the misconfiguration "All Ports Should Not Be Open To Public" in GCP:

```
from google.cloud import compute_v1

# Create a compute client
client = compute_v1.InstancesClient()

# Get a list of all VM instances
project = 'your-project-id'
zone = 'us-central1-a'
instances = client.list(project=project, zone=zone)

# Loop through each instance and update the firewall rules
for instance in instances:
    # Get the current firewall rules for the instance
    firewall = client.get_firewall(project=project, firewall='default-allow-ssh')
    allowed = firewall.allowed

    # Create a new firewall rule to allow only required ports and protocols
    new_allowed = [
        compute_v1.FirewallAllPorts(
            IPProtocol='tcp',
            ports=['80', '443']  # Add the required ports here
        )
    ]

    # Update the firewall rule with the new allowed ports
    firewall.allowed = new_allowed
    client.update_firewall(project=project, firewall='default-allow-ssh', firewall_resource=firewall)

    # Delete the old firewall rule that allows all ports
    client.delete_firewall(project=project, firewall='default-allow-ssh')
```

Note: This code is just a sample and may need to be modified based on your specific requirements.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>