---
slug: open_netbios
title: NetBIOS Port Should Not Be Open
sidebar_label: NetBIOS Port Should Not Be Open
---

### More Info:

Determines if UDP port 137 or 138 for NetBIOS is open to the public

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, ISO27001, HIPAA, HITRUST, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to VPC Network: From the main navigation menu, click on "VPC Network" to access the VPC networks dashboard. Here, you can view all the VPC networks and their associated firewall rules.

3. Check Firewall Rules: Click on "Firewall" from the left-hand side menu. This will display a list of all the firewall rules associated with your VPC networks. Look for any rules that have "tcp:137", "tcp:138", or "tcp:139" in the "Protocols / ports" column. These are the ports associated with NetBIOS.

4. Verify Open Ports: If any of the firewall rules allow traffic on the NetBIOS ports (137-139), then NetBIOS is open on your network. This is a misconfiguration as these ports should not be open due to the security risks associated with NetBIOS.

#### Using CLI

1. Install and authenticate the Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and follow the instructions to install it. Once installed, you can authenticate it using the following command:

   ```
   gcloud auth login
   ```
   This command will open a new browser window where you can log in with your Google Cloud credentials.

2. List all the firewall rules: Once the SDK is authenticated, you can list all the firewall rules in your project using the following command:

   ```
   gcloud compute firewall-rules list
   ```
   This command will return a list of all the firewall rules in your project. Each rule will have a name, network, direction (INGRESS or EGRESS), priority, source ranges, allowed ports, and other details.

3. Filter the firewall rules: To check if the NetBIOS port is open, you need to filter the firewall rules for rules that allow traffic on the NetBIOS ports (ports 137-139 and 445). You can do this using the following command:

   ```
   gcloud compute firewall-rules list --filter="allowed:tcp:137-139 OR allowed:tcp:445"
   ```
   This command will return a list of all the firewall rules that allow traffic on the NetBIOS ports.

4. Review the results: If the above command returns any rules, it means that the NetBIOS port is open in your network. You should review these rules and determine if they are necessary for your application. If they are not, you should consider closing these ports to improve the security of your network.

#### Using Python

Detecting whether the NetBIOS port is open in a network can be done using Python scripts. Here are the steps:

1. **Import Required Libraries**: The first step is to import the required Python libraries. We will need the `socket` library for network-related tasks.

    ```python
    import socket
    ```

2. **Define Target and Port**: Next, define the target IP address and the port number for NetBIOS, which is typically port 139.

    ```python
    target_ip = "your_target_ip"
    port = 139  # NetBIOS port
    ```

3. **Create a Socket**: Create a socket object using the `socket.socket()` function. This function takes two parameters: the first parameter is the address family (AF_INET for IPv4) and the second parameter is the type of socket (SOCK_STREAM for TCP).

    ```python
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    ```

4. **Check the Port**: Use the `connect_ex()` method of the socket object to connect to the target IP address and port. This method returns 0 if the connection is successful (i.e., the port is open), and an error code otherwise.

    ```python
    result = sock.connect_ex((target_ip, port))
    if result == 0:
        print("Port {} is open".format(port))
    else:
        print("Port {} is closed".format(port))
    sock.close()
    ```

This script will check if the NetBIOS port (port 139) is open on the target IP address. If the port is open, it will print "Port 139 is open", otherwise it will print "Port 139 is closed".

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the NetBIOS port being open misconfiguration in GCP using GCP console, follow these steps:

1. Login to your GCP console.
2. Select the project where the misconfiguration exists.
3. Navigate to the Compute Engine section.
4. Select the VM instance where the misconfiguration exists.
5. Click on the "Edit" button at the top of the VM instance details page.
6. Scroll down to the "Firewall" section.
7. Click on "Add firewall rule".
8. Enter a name for the firewall rule.
9. Set the "Action on match" to "Deny".
10. Set the "Targets" to "All instances in the network".
11. In the "Source filter" section, select "IP ranges".
12. Enter the IP range that you want to block.
13. In the "Protocols and ports" section, select "Specified protocols and ports".
14. In the "Protocols and ports" field, enter "udp:137; udp:138; tcp:139; tcp:445" to block NetBIOS traffic.
15. Click on the "Create" button to save the firewall rule.

After completing these steps, the NetBIOS port will be blocked for the specified IP range on the selected VM instance.

#### Using CLI

To remediate the NetBIOS Port Should Not Be Open misconfiguration in GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in the GCP console.

2. Run the following command to list all the firewall rules in your project:
   
   ```
   gcloud compute firewall-rules list
   ```

3. Look for the firewall rule that allows traffic on port 139 or 445, which are the ports used by NetBIOS. Note the name of the firewall rule.

4. Run the following command to delete the firewall rule:
   
   ```
   gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]
   ```

   Replace `[FIREWALL_RULE_NAME]` with the name of the firewall rule that you noted in step 3.

5. Confirm that the firewall rule has been deleted by running the command in step 2 again.

6. Verify that the NetBIOS port is no longer open by running a port scan on your GCP instance from an external network.

By following these steps, you have successfully remediated the NetBIOS Port Should Not Be Open misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the NetBIOS Port Should Not Be Open misconfiguration in GCP using Python, you can follow these steps:

1. Use the `google-cloud-securitycenter` library to retrieve the list of assets that have open NetBIOS ports. You can use the following code snippet to achieve this:

```
from google.cloud import securitycenter

client = securitycenter.SecurityCenterClient()

# The organization ID to retrieve findings for
org_id = 'YOUR_ORGANIZATION_ID'

# The filter expression to find assets with open NetBIOS ports
filter_exp = (
    "security_marks.marks.netbios_open : true AND "
    f"resource_properties.project_id = {org_id}"
)

# Call the API to retrieve the findings
findings = client.list_findings(
    request={
        "parent": f"organizations/{org_id}",
        "filter": filter_exp,
    }
)
```

2. For each asset with an open NetBIOS port, use the `google-cloud-compute` library to update the firewall rule and close the port. You can use the following code snippet to achieve this:

```
from google.cloud import compute_v1

client = compute_v1.FirewallsClient()

# The name of the firewall rule to update
firewall_name = 'YOUR_FIREWALL_RULE_NAME'

# The name of the network to update the firewall rule for
network_name = 'YOUR_NETWORK_NAME'

# The name of the project that contains the network and firewall rule
project_name = 'YOUR_PROJECT_NAME'

# The IP range to close the NetBIOS port for
ip_range = '0.0.0.0/0'

# Call the API to update the firewall rule
firewall = client.get(f'projects/{project_name}/global/firewalls/{firewall_name}')
updated_firewall = compute_v1.Firewall(
    allowed=[rule for rule in firewall.allowed if rule.IPProtocol != 'udp' or rule.ports != ['137']],
    target_tags=firewall.target_tags,
    source_ranges=[range for range in firewall.source_ranges if range != ip_range],
    network=f'projects/{project_name}/global/networks/{network_name}'
)
operation = client.update(request={
    "firewall": updated_firewall,
    "updateMask": "allowed,targetTags,sourceRanges,network",
    "firewall": f"projects/{project_name}/global/firewalls/{firewall_name}"
})
```

Note that you may need to adjust the code snippets to fit your specific use case, such as changing the filter expression or updating the firewall rule with different parameters.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>