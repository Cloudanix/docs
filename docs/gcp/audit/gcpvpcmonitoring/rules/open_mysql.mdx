---
slug: open_mysql
title: MySQL Port Should Not Be Open
sidebar_label: MySQL Port Should Not Be Open
---

### More Info:

Determines if TCP port 4333 or 3306 for MySQL is open to the public

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, ISO27001, HIPAA, HITRUST, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to Google Cloud Console: First, you need to log in to your Google Cloud Console. You can do this by visiting console.cloud.google.com and entering your login credentials.

2. Navigate to VPC Network: Once you are logged in, navigate to the "VPC Network" section. You can do this by clicking on the navigation menu (three horizontal lines) in the top left corner, then clicking on "VPC Network".

3. Check Firewall Rules: In the VPC Network section, click on "Firewall". This will bring up a list of all the firewall rules that are currently in place for your network. Look for any rules that have "tcp:3306" (the default MySQL port) in the "Protocols/ports" column.

4. Verify Source IP Ranges: Check the "Source IP ranges" column for the rule that has "tcp:3306". If the source IP range is set to "0.0.0.0/0" (which means all IP addresses), then your MySQL port is open to the entire internet, which is a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions for your specific operating system. Once installed, authenticate it using the command:
   ```
   gcloud auth login
   ```
   This will open a new browser window where you can log in with your Google Cloud credentials.

2. List all the firewall rules in your GCP project. You can do this by running the following command:
   ```
   gcloud compute firewall-rules list
   ```
   This command will return a list of all firewall rules in your project, including their names, network, direction, priority, source ranges, allowed protocols and ports, and whether they are enabled or not.

3. Filter the list to find rules that allow traffic on MySQL port (3306). You can do this by piping the output of the previous command to a grep command like this:
   ```
   gcloud compute firewall-rules list | grep 'tcp:3306'
   ```
   This command will return only the rules that allow traffic on port 3306.

4. Review the output to identify any misconfigurations. If any rules are returned by the previous command, it means that the MySQL port is open in your network. Check the source ranges for these rules. If they include 0.0.0.0/0, it means that the port is open to the entire internet, which is a serious security risk.

#### Using Python

To detect if MySQL port is open in the network, you can use Python's socket module. Here are the steps:

1. Import the necessary modules:
```python
import socket
```

2. Create a function to check if the port is open:
```python
def check_port(ip, port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(5)
    try:
        sock.connect((ip, port))
        sock.shutdown(socket.SHUT_RDWR)
        return True
    except:
        return False
    finally:
        sock.close()
```

3. Call the function with the IP address and the port number of the MySQL server:
```python
ip = 'your_mysql_server_ip'
port = 3306
if check_port(ip, port):
    print(f'Port {port} is open on {ip}')
else:
    print(f'Port {port} is not open on {ip}')
```

4. Run the script. If the MySQL port (3306) is open, it will print "Port 3306 is open on your_mysql_server_ip". If it's not open, it will print "Port 3306 is not open on your_mysql_server_ip".

Please replace 'your_mysql_server_ip' with the actual IP address of your MySQL server. This script only checks if the port is open on the network level, it doesn't check if MySQL is actually running on that port.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the MySQL port open misconfiguration on GCP using the GCP console, please follow the below steps:

1. Log in to the GCP Console (https://console.cloud.google.com/).
2. Navigate to the GCP project that has the misconfigured MySQL port.
3. In the navigation menu, click on "Compute Engine".
4. Select the VM instance that has the open MySQL port.
5. Click on the "Edit" button at the top of the page.
6. Scroll down to the "Firewall" section and click on "Networking".
7. Under the "Firewall rules" section, click on "default-allow-mysql".
8. Click on the "Delete" button to remove the rule.
9. Click on the "Save" button at the bottom of the page to apply the changes.

By following the above steps, you have successfully remediated the MySQL port open misconfiguration on GCP.

#### Using CLI

To remediate the MySQL port being open on GCP using GCP CLI, follow these steps:

1. Open the GCP Console and go to the Cloud Shell.

2. Run the following command to list all the instances in your project:

`gcloud compute instances list`

3. Identify the instance that has the open MySQL port.

4. Run the following command to SSH into the instance:

`gcloud compute ssh [INSTANCE_NAME]`

Replace `[INSTANCE_NAME]` with the name of the instance that you identified in step 3.

5. Once you are logged in to the instance, run the following command to edit the `mysqld.cnf` file:

`sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf`

6. Look for the following line in the file:

`bind-address = 0.0.0.0`

7. Comment out this line by adding a `#` at the beginning of the line:

`# bind-address = 0.0.0.0`

8. Save the changes and exit the file.

9. Restart the MySQL service by running the following command:

`sudo service mysql restart`

10. Exit the SSH session by running the following command:

`exit`

With these steps, you have successfully remediated the MySQL port being open on your GCP instance using GCP CLI.

#### Using Python

To remediate the MySQL Port open misconfiguration in GCP using Python, you can follow the below steps:

1. Import the necessary libraries:

```python
from google.cloud import compute_v1
import google.auth
```

2. Authenticate and create a client object:

```python
creds, project = google.auth.default()
compute_client = compute_v1.ComputeClient(credentials=creds)
```

3. Define the project and zone where the instance is located:

```python
project = 'your-project-id'
zone = 'us-central1-a'
```

4. Define the instance name and the network tag associated with the instance:

```python
instance_name = 'your-instance-name'
network_tag = 'your-network-tag'
```

5. Get the instance details using the `get` method:

```python
instance = compute_client.instances().get(project=project, zone=zone, instance=instance_name).execute()
```

6. Check if the MySQL port is open by looking at the instance's network tags:

```python
if network_tag in instance['tags']['items']:
    if '3306' in instance['metadata']['items'][0]['value']:
        print('MySQL port is open')
```

7. If the MySQL port is open, remove it from the instance's metadata:

```python
metadata = instance['metadata']
items = metadata['items']
new_items = []
for item in items:
    if item['key'] == 'gce-container-declaration':
        container = json.loads(item['value'])
        ports = container['ports']
        new_ports = []
        for port in ports:
            if port['containerPort'] != 3306:
                new_ports.append(port)
        container['ports'] = new_ports
        item['value'] = json.dumps(container)
    new_items.append(item)
metadata['items'] = new_items
compute_client.instances().update(project=project, zone=zone, instance=instance_name, body={'metadata': metadata}).execute()
```

This will remove the MySQL port from the instance's metadata, effectively closing the port.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>