---
slug: open_cifs
title: CIFS Port Should Not Be Open
sidebar_label: CIFS Port Should Not Be Open
---

### More Info:

Determines if UDP port 445 for CIFS is open to the public

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, GDPR, SOC2, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to VPC Network: From the main navigation menu, click on "VPC Network" and then select "Firewall rules". This will display a list of all the firewall rules that are currently configured in your Google Cloud environment.

3. Check for Open CIFS Port: Look for any firewall rules that have "tcp:445" (the port used by CIFS) in the "Protocols / ports" column and "Allow" in the "Action" column. If such a rule exists, it means that the CIFS port is open.

4. Verify Source Range: Check the "Source IP ranges" column for the rule identified in the previous step. If the source range is set to "0.0.0.0/0", it means that the CIFS port is open to the entire internet, which is a serious security misconfiguration.

#### Using CLI

1. Install and authenticate Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and authenticate it using the command `gcloud auth login`.

2. List all firewall rules: Use the `gcloud compute firewall-rules list` command to list all the firewall rules in your GCP project. This command will return a list of all firewall rules, including their names, network, direction, priority, source ranges, allowed protocols and ports, and other details.

   ```
   gcloud compute firewall-rules list
   ```

3. Filter firewall rules for CIFS port: The CIFS protocol typically uses port 445. You can filter the list of firewall rules for this port using the `--filter` flag with the `gcloud compute firewall-rules list` command. The following command will return only the firewall rules that allow traffic on port 445:

   ```
   gcloud compute firewall-rules list --filter="allowed:445"
   ```

4. Check the source ranges: For each firewall rule that allows traffic on port 445, check the source ranges. If the source range is set to `0.0.0.0/0`, it means the CIFS port is open to the entire internet, which is a misconfiguration. You can check the source ranges in the output of the `gcloud compute firewall-rules list --filter="allowed:445"` command.

#### Using Python

1. Install necessary Python libraries:
   You will need the 'boto3' library for AWS, 'azure-mgmt-network' for Azure, and 'google-cloud-securitycenter' for GCP. You can install these libraries using pip:
   ```
   pip install boto3 azure-mgmt-network google-cloud-securitycenter
   ```
2. AWS:
   Use the 'boto3' library to list all security groups and check if any of them have the CIFS port open. Here is a sample script:
   ```python
   import boto3
   ec2 = boto3.resource('ec2')
   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           if permission['FromPort'] == 445 and permission['ToPort'] == 445:
               print(f"Security Group {security_group.id} has CIFS port open")
   ```
3. Azure:
   Use the 'azure-mgmt-network' library to list all network security groups and check if any of them have the CIFS port open. Here is a sample script:
   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   network_client = NetworkManagementClient(credential, subscription_id)

   for nsg in network_client.network_security_groups.list_all():
       for rule in nsg.security_rules:
           if rule.destination_port_range == '445':
               print(f"Network Security Group {nsg.id} has CIFS port open")
   ```
4. GCP:
   Use the 'google-cloud-securitycenter' library to list all firewall rules and check if any of them have the CIFS port open. Here is a sample script:
   ```python
   from google.cloud import securitycenter_v1

   client = securitycenter_v1.SecurityCenterClient()

   for result in client.list_assets(parent="organizations/your-organization-id"):
       for policy in client.get_iam_policy(resource_name=result.asset.name).bindings:
           if 'ports' in policy.condition.expression and '445' in policy.condition.expression:
               print(f"Asset {result.asset.name} has CIFS port open")
   ```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the CIFS Port Should Not Be Open misconfiguration for GCP using GCP console, follow these steps:

1. Log in to the GCP console.
2. Navigate to the Compute Engine section.
3. Select the VM instance that has the CIFS port open.
4. Click on the Edit button at the top of the page.
5. Scroll down to the Firewall section.
6. Find the rule that allows traffic on port 445 (CIFS).
7. Click on the trash can icon to delete the rule.
8. Click on the Save button at the bottom of the page.

Once you have completed these steps, the CIFS port will no longer be open on the VM instance, and the misconfiguration will be remediated.

#### Using CLI

The CIFS (Common Internet File System) port should not be open in order to prevent unauthorized access to your GCP resources. To remediate this misconfiguration for GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell by clicking on the terminal icon in the top right corner of the GCP Console.
2. Run the following command to list all the firewall rules in your project:

   ```
   gcloud compute firewall-rules list
   ```

3. Identify the firewall rule that allows traffic on port 445, which is the CIFS port. The rule name may vary depending on your configuration.
4. Run the following command to delete the firewall rule:

   ```
   gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]
   ```

   Replace [FIREWALL_RULE_NAME] with the name of the firewall rule that you identified in step 3.

5. Confirm the deletion by typing "Y" when prompted.
6. Verify that the firewall rule has been deleted by running the following command:

   ```
   gcloud compute firewall-rules list
   ```

   You should not see the deleted firewall rule in the list.

By following these steps, you have successfully remediated the misconfiguration of having the CIFS port open in your GCP project.

#### Using Python

To remediate the misconfiguration "CIFS Port Should Not Be Open" in GCP using Python, you can follow these steps:

1. Identify the VM instances that have CIFS port open: You can use the Google Cloud SDK command `gcloud` to list the VM instances and their firewall rules. Run the following command to list all the VM instances in your project:

   ```
   gcloud compute instances list
   ```

   You can then inspect each VM instance and check if it has any firewall rules that allow CIFS port (TCP port 445). You can use the following command to list the firewall rules for a VM instance:

   ```
   gcloud compute firewall-rules list --filter="targetTags=<instance-tag>"
   ```

   Replace `<instance-tag>` with the tag of the VM instance you want to inspect.

2. Remove the firewall rule that allows CIFS port: Once you have identified the firewall rule that allows CIFS port, you can remove it using the Google Cloud SDK command `gcloud`. Run the following command to delete a firewall rule:

   ```
   gcloud compute firewall-rules delete <firewall-rule-name>
   ```

   Replace `<firewall-rule-name>` with the name of the firewall rule you want to delete.

3. Automate the remediation process: You can use the Google Cloud SDK and Python to automate the remediation process for all the VM instances in your project. Here's an example Python script that lists all the firewall rules for all the VM instances in your project and deletes the ones that allow CIFS port:

   ```
   import subprocess

   # Get the list of VM instances
   instances = subprocess.check_output(['gcloud', 'compute', 'instances', 'list', '--format', 'json'])

   # Loop through each instance and its firewall rules
   for instance in instances:
       instance_name = instance['name']
       firewall_rules = subprocess.check_output(['gcloud', 'compute', 'firewall-rules', 'list', '--filter', f'targetTags={instance_name}', '--format', 'json'])
       for rule in firewall_rules:
           if rule['allowed'] and 'tcp' in rule['allowed'] and '445' in rule['allowed']['tcp']:
               # Delete the firewall rule that allows CIFS port
               subprocess.check_output(['gcloud', 'compute', 'firewall-rules', 'delete', rule['name']])
   ```

   You can customize this script to suit your specific needs, such as filtering VM instances by region or project.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>