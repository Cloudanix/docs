---
slug: open_rdp
title: RDP Port Should Not Be Open
sidebar_label: RDP Port Should Not Be Open
---

### More Info:

Determines if TCP port 3389 for RDP is open to the public

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, PCIDSS, ISO27001, HIPAA, CISGCP, CBP, HITRUST, GDPR, NISTCSF, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account.

2. Navigate to VPC Network: From the main dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner), scroll down and click on "VPC Network" under the "Networking" section.

3. Check Firewall Rules: In the VPC Network page, click on "Firewall rules" in the left-hand menu. This will display a list of all the firewall rules in your network.

4. Inspect Rules for RDP Port: Look for any rules that have "tcp:3389" (the RDP port) in the "Protocols / ports" column. If such a rule exists and its "Action on match" is set to "Allow", then the RDP port is open.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to install and authenticate.

2. Once you have the Google Cloud SDK CLI installed and authenticated, you can use the following command to list all the firewall rules in your project:

   ```
   gcloud compute firewall-rules list
   ```

3. To check if RDP port is open, you can filter the results for the RDP port (3389) using the following command:

   ```
   gcloud compute firewall-rules list --format="table(name, network, direction, priority, sourceRanges.list():label=SRC_RANGES, allowed[].map().firewall_rule().list():label=ALLOW, targetTags.list():label=TARGET_TAGS)" | grep '3389'
   ```

4. If the command returns any results, it means that the RDP port is open. The output will show the details of the firewall rule, including the name, network, direction, priority, source ranges, allowed protocols and ports, and target tags.

#### Using Python

Detecting whether the RDP port is open in a network can be done using Python scripts. Here are the steps:

1. **Import Required Libraries**: The first step is to import the required libraries. We will be using the `socket` library in Python to check if a port is open or not.

```python
import socket
```

2. **Define the Function**: Next, we define a function that will check if a port is open or not. This function will take the IP address and the port number as input and return whether the port is open or not.

```python
def check_port(ip, port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(10)
    try:
        sock.connect((ip, port))
        return True
    except:
        return False
```

3. **Check the RDP Port**: Now, we can use this function to check if the RDP port (3389) is open or not. Replace 'your_ip_address' with the IP address of your server.

```python
if check_port('your_ip_address', 3389):
    print("RDP port is open")
else:
    print("RDP port is not open")
```

4. **Iterate Over All IPs**: If you have multiple servers and you want to check the RDP port for all of them, you can put the above code in a loop and iterate over all the IP addresses.

Please note that this script only checks if the RDP port is open or not. It does not check if the RDP is properly configured or not. For that, you might need to use other tools or libraries.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the RDP port being open misconfiguration in GCP using the GCP console, please follow the below steps:

1. Login to the GCP console and navigate to the Compute Engine section.

2. Select the instance(s) for which you want to remediate the misconfiguration.

3. Click on the "Edit" button at the top of the page to edit the instance settings.

4. Scroll down to the "Firewall" section and click on "Edit" next to the default-allow-rdp rule.

5. In the "Protocols and ports" section, uncheck the box next to "RDP" to disable access to the RDP port.

6. Click on the "Save" button to save the changes.

7. Verify that the RDP port is no longer open by running a port scan on the instance(s).

That's it! By following the above steps, you have successfully remediated the misconfiguration of the RDP port being open in GCP.

#### Using CLI

To remediate the RDP Port should not be open misconfiguration on GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell console in your GCP project.

2. Check if the RDP port is open by running the following command:

   `gcloud compute firewall-rules list | grep RDP`

   This will list all the firewall rules that contain the keyword "RDP."

3. Identify the firewall rule that allows RDP traffic and note its name.

4. Delete the firewall rule that allows RDP traffic by running the following command:

   `gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]`

   Replace [FIREWALL_RULE_NAME] with the name of the firewall rule that allows RDP traffic.

5. Confirm the deletion of the firewall rule by running the following command:

   `gcloud compute firewall-rules list | grep RDP`

   This command should not return any results.

6. Verify that RDP port is closed by running the following command:

   `nmap -Pn -p 3389 [INSTANCE_IP_ADDRESS]`

   Replace [INSTANCE_IP_ADDRESS] with the IP address of the instance you want to check. This command will scan the instance for open ports and should not return any results for port 3389 (RDP).

7. Repeat steps 2-6 for all instances in your GCP project to ensure that RDP port is not open on any of them.

By following these steps, you can remediate the RDP Port should not be open misconfiguration on GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration of RDP port being open in GCP using Python, you can follow these steps:

1. First, you need to identify the instance(s) with the open RDP port. You can use the GCP Python SDK to retrieve a list of all instances in your project and filter them based on the open RDP port.

```python
from google.cloud import compute_v1

# Initialize the Compute Engine API client
compute_client = compute_v1.InstancesClient()

# Project ID for this request.
project = 'your-project-id'  

# List all instances in the project
instances = compute_client.list(project=project)

# Filter instances with open RDP port
rdp_instances = [i for i in instances if i.network_interfaces[0].access_configs[0].nat_ip_port_range == '3389']
```

2. Once you have identified the instances with the open RDP port, you can update their firewall rules to block incoming traffic on port 3389. You can use the GCP Python SDK to retrieve a list of all firewall rules in your project and update the rules that allow traffic on port 3389 to block the traffic instead.

```python
# List all firewall rules in the project
firewall_rules = compute_client.list_firewall_policies(project=project)

# Update the firewall rules to block incoming traffic on port 3389
for rule in firewall_rules:
    if rule.allowed[0].ports == ['3389']:
        rule.direction = 'DENY'
        rule.priority = 1000
        rule.denied = [{'IPProtocol': 'tcp', 'ports': ['3389']}]
        compute_client.update_firewall_policy(project=project, firewall_policy=rule)
```

3. Finally, you can verify that the RDP port is no longer open on the instances by checking their firewall rules.

```python
# Verify that the RDP port is closed on the instances
for instance in rdp_instances:
    firewall = compute_client.get_firewall_policy(project=project, firewall_policy='default-allow-rdp')
    if {'IPProtocol': 'tcp', 'ports': ['3389']} not in firewall.allowed:
        print(f"RDP port is closed on instance {instance.name}")
```

By following these steps, you can remediate the misconfiguration of RDP port being open in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>