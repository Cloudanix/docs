---
slug: open_oracle
title: Oracle Port Should Not Be Open
sidebar_label: Oracle Port Should Not Be Open
---

### More Info:

Determines if TCP port 1521 for Oracle is open to the public

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, HITRUST, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your preferred web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to VPC Network: From the main navigation menu, select "VPC Network" and then "Firewall rules". This will display a list of all the firewall rules that are currently configured in your Google Cloud environment.

3. Check for Oracle Port: Look for any firewall rules that have '1521' (the default port for Oracle) specified in the "ports and protocols" column. If such a rule exists, it means that the Oracle port is open.

4. Verify Source Range: Check the "Source IP ranges" column for the rule identified in the previous step. If the source range is set to '0.0.0.0/0' or '::/0', it means that the Oracle port is open to the entire internet, which is a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to install and authenticate.

2. Once you have the Google Cloud SDK CLI installed and authenticated, you can use the `gcloud` command to interact with your Google Cloud resources. 

3. To check if the Oracle port is open in your network, you can use the `gcloud compute firewall-rules list` command. This command will list all the firewall rules in your Google Cloud project. Look for any rules that have the Oracle port (usually 1521) in their allowed ports list. Here is the command:

   ```
   gcloud compute firewall-rules list --format="table(name, network, direction, priority, sourceRanges.list():label=SRC_RANGES, allowed[].map().firewall_rule().list():label=ALLOW, targetTags.list():label=TARGET_TAGS)"
   ```

4. Analyze the output of the command. If you see any firewall rules that allow traffic on the Oracle port (1521), then the Oracle port is open in your network. If you don't see any such rules, then the Oracle port is not open.

#### Using Python

1. Import the necessary libraries: You will need the 'boto3' library for AWS, 'azure-mgmt-network' for Azure, and 'google-cloud-securitycenter' for GCP. You will also need the 'socket' library to check the port status. 

```python
import boto3
import socket
from azure.mgmt.network import NetworkManagementClient
from google.cloud import securitycenter_v1
```

2. Define a function to check the port status: This function will take an IP address and a port number as input and return the status of the port (open or closed).

```python
def check_port(ip, port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(10)
    try:
        sock.connect((ip, port))
        return "Open"
    except:
        return "Closed"
    finally:
        sock.close()
```

3. For AWS, use the 'boto3' library to get a list of all security groups and their rules. Then, use the 'check_port' function to check the status of the Oracle port (1521) for each security group.

```python
ec2 = boto3.resource('ec2')
for security_group in ec2.security_groups.all():
    for permission in security_group.ip_permissions:
        for ip_range in permission['IpRanges']:
            status = check_port(ip_range['CidrIp'], 1521)
            if status == "Open":
                print(f"Oracle port is open in security group {security_group.id}")
```

4. For Azure, use the 'NetworkManagementClient' to get a list of all network security groups and their rules. Then, use the 'check_port' function to check the status of the Oracle port for each network security group.

```python
network_client = NetworkManagementClient(credentials, subscription_id)
for nsg in network_client.network_security_groups.list_all():
    for rule in nsg.security_rules:
        if rule.destination_port_range == '1521':
            status = check_port(rule.source_address_prefix, 1521)
            if status == "Open":
                print(f"Oracle port is open in network security group {nsg.id}")
```

5. For GCP, use the 'securitycenter_v1' library to get a list of all firewall rules. Then, use the 'check_port' function to check the status of the Oracle port for each firewall rule.

```python
client = securitycenter_v1.SecurityCenterClient()
organization_id = 'your-organization-id'
for firewall in client.list_assets(request={"parent": f"organizations/{organization_id}", "filter": "securityCenterProperties.resourceType=\"google.compute.Firewall\""}):
    for rule in firewall.asset.security_center_properties.additional_properties['allowed']:
        if 'ports' in rule and '1521' in rule['ports']:
            status = check_port(rule['IPProtocol'], 1521)
            if status == "Open":
                print(f"Oracle port is open in firewall {firewall.asset.name}")
```

Remember to replace 'your-organization-id' with your actual GCP organization ID.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the Oracle Port Should Not Be Open misconfiguration for GCP using GCP console, follow these steps:

1. Log in to the GCP console (https://console.cloud.google.com/).

2. Select the project that contains the affected resource.

3. In the navigation menu on the left-hand side, click on "Compute Engine" and then select "VM instances".

4. Locate the instance that has the open Oracle port and click on its name to open its details page.

5. Click on the "Edit" button at the top of the page to edit the instance settings.

6. Scroll down to the "Firewall" section and click on "Management, security, disks, networking, sole tenancy".

7. Under the "Firewall" section, click on "Network interfaces".

8. Click on "default" to expand the network interface settings.

9. In the "Firewall rules" section, locate the rule that allows traffic on the Oracle port (default is 1521).

10. Click on the trashcan icon next to the rule to delete it.

11. Click on the "Save" button at the bottom of the page to save the changes.

12. Verify that the Oracle port is no longer open by running a port scan or checking the instance's firewall rules.

By following these steps, you have successfully remediated the Oracle Port Should Not Be Open misconfiguration for GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Oracle Port Should Not Be Open" for GCP using GCP CLI, follow the below steps:

1. Open the GCP console and navigate to the GCP project where the misconfiguration exists.

2. Open the Cloud Shell by clicking on the icon on the top right corner of the console.

3. Run the following command to list all the firewall rules in the project:

```
gcloud compute firewall-rules list
```

4. Identify the firewall rule that allows access to the Oracle port. Note down the name of the firewall rule.

5. Run the following command to delete the firewall rule:

```
gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]
```

Replace [FIREWALL_RULE_NAME] with the name of the firewall rule identified in step 4.

6. Confirm the deletion by typing "Y" when prompted.

7. Verify that the firewall rule has been deleted by running the following command:

```
gcloud compute firewall-rules list
```

The output should not contain the firewall rule that was deleted in step 5.

By following these steps, you have successfully remediated the misconfiguration "Oracle Port Should Not Be Open" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Oracle Port Should Not Be Open" in GCP using Python, you can follow the below steps:

1. Identify the instances in your GCP project that have the Oracle port open. You can use the GCP Python SDK to get the list of instances and their network configuration.

2. For each instance with the Oracle port open, use the GCP Python SDK to update the firewall rule that allows traffic to the Oracle port. You can either delete the rule or modify it to allow traffic only from a specific IP address or range.

3. To delete the firewall rule, you can use the following Python code:

```python
from google.cloud import compute_v1

# Create a client object to interact with GCP
client = compute_v1.FirewallsClient()

# Define the name of the firewall rule to delete
firewall_rule_name = 'oracle-port'

# Delete the firewall rule
operation = client.delete(project='your-project-id', firewall=firewall_rule_name)
```

4. To modify the firewall rule to allow traffic only from a specific IP address or range, you can use the following Python code:

```python
from google.cloud import compute_v1

# Create a client object to interact with GCP
client = compute_v1.FirewallsClient()

# Define the name of the firewall rule to modify
firewall_rule_name = 'oracle-port'

# Define the new source IP range for the firewall rule
new_source_range = '10.0.0.0/24'

# Get the current firewall rule
firewall_rule = client.get(project='your-project-id', firewall=firewall_rule_name)

# Modify the firewall rule to allow traffic only from the new source IP range
firewall_rule.source_ranges = [new_source_range]
operation = client.update(project='your-project-id', firewall=firewall_rule_name, firewall_resource=firewall_rule)
```

Note: Replace 'your-project-id' with the actual ID of your GCP project, and 'oracle-port' with the name of the firewall rule that allows traffic to the Oracle port.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>