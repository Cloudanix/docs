---
slug: no_legacy_networks
title: Legacy Networks Should Not Be Used
sidebar_label: Legacy Networks Should Not Be Used
---

### More Info:

Ensure legacy networks do not exist for a project.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISGCP, CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Google Cloud Console: Open your web browser, navigate to the Google Cloud Console (console.cloud.google.com) and sign in with your Google Cloud credentials.

2. Select your project: From the project drop-down (My First Project), select the Google Cloud project where you want to check for legacy networks.

3. Navigate to VPC networks: From the main navigation menu, go to "VPC network" under the "Networking" section. This will open the "VPC networks" page where you can see all the networks associated with your selected project.

4. Check for Legacy Networks: In the "VPC networks" page, look for any networks with the type "Legacy". Legacy networks do not have any subnets and use IP range for network configuration, which is a sign of misconfiguration as they do not support many GCP features. If you find any such networks, it indicates that Legacy Networks are being used in your project, which is a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK: The Google Cloud SDK includes the gcloud command-line tool, which is necessary to interact with GCP services from your workstation. You can install it by following the instructions provided by Google Cloud. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all the networks in your project: Use the following command to list all the networks in your project. This will display a list of all networks, including legacy networks.

    ```
    gcloud compute networks list
    ```

3. Identify legacy networks: Legacy networks are identified by the range of IP addresses they use. In the output of the previous command, look for networks with a range of "10.0.0.0/8". These are legacy networks.

4. Check the mode of the network: Legacy networks are also identified by their mode. In the output of the previous command, look for networks with a mode of "Legacy". These are legacy networks.

Remember, using legacy networks is not recommended as they do not support many GCP features and have limitations on performance and flexibility. Always prefer to use auto mode or custom mode networks.

#### Using Python

To detect if Legacy Networks are being used in Google Cloud Platform (GCP) using Python scripts, you can follow these steps:

1. **Set up Google Cloud SDK and Python Environment:**
   Before you start, make sure you have Google Cloud SDK installed and initialized on your machine. Also, ensure that Python and necessary libraries like google-cloud-resource-manager and googleapiclient are installed.

2. **Authenticate your SDK:**
   Use the command `gcloud auth application-default login` to authenticate your SDK. This will open a new browser window for you to log in to your Google account. Once logged in, your SDK will be authenticated to use this account.

3. **List all Networks:**
   Use the Google Cloud Resource Manager Client to list all projects and then use the Google Compute API to list all networks in each project. Here is a sample script:

```python
from google.cloud import resource_manager
from googleapiclient import discovery

def list_networks(project_id):
    compute = discovery.build('compute', 'v1')
    request = compute.networks().list(project=project_id)
    while request is not None:
        response = request.execute()
        for network in response['items']:
            print('Network: {} (Project: {})'.format(network['name'], project_id))
        request = compute.networks().list_next(previous_request=request, previous_response=response)

def main():
    client = resource_manager.Client()
    for project in client.list_projects():
        list_networks(project.project_id)

if __name__ == "__main__":
    main()
```

4. **Check for Legacy Networks:**
   Legacy networks have a range of 10.0.0.0/8. So, you can modify the above script to check if any network has this range. If it does, it's a legacy network.

```python
from google.cloud import resource_manager
from googleapiclient import discovery

def list_networks(project_id):
    compute = discovery.build('compute', 'v1')
    request = compute.networks().list(project=project_id)
    while request is not None:
        response = request.execute()
        for network in response['items']:
            if 'IPv4Range' in network and network['IPv4Range'] == '10.0.0.0/8':
                print('Legacy Network: {} (Project: {})'.format(network['name'], project_id))
        request = compute.networks().list_next(previous_request=request, previous_response=response)

def main():
    client = resource_manager.Client()
    for project in client.list_projects():
        list_networks(project.project_id)

if __name__ == "__main__":
    main()
```

This script will print all legacy networks along with their project IDs.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Legacy Networks Should Not Be Used" in GCP using GCP console, follow the below steps:

1. Open the GCP console and go to the VPC networks page.
2. Select the legacy network that you want to remediate.
3. In the top menu, click "Delete".
4. Review the list of resources that will be deleted with the legacy network. If you are sure you want to delete the legacy network and all its resources, click "Delete".
5. Repeat this process for all legacy networks in your GCP project.

Alternatively, you can create a new VPC network and migrate your resources to it. To do so, follow the below steps:

1. Open the GCP console and go to the VPC networks page.
2. Click "Create VPC network".
3. Enter a name for the new VPC network.
4. Choose a subnet mode and specify the IP range for the new VPC network.
5. Click "Create".
6. Migrate your resources to the new VPC network by updating their network settings to use the new VPC network.

Note: Before deleting a legacy network, make sure that all resources that depend on it have been migrated to the new VPC network.

#### Using CLI

To remediate the "Legacy Networks Should Not Be Used" misconfiguration in GCP using GCP CLI, follow these steps:

1. Open the GCP Cloud Shell by clicking on the Activate Cloud Shell button on the top right corner of the GCP Console.
2. Run the following command to list all the VPC networks in your project:

   ```
   gcloud compute networks list
   ```

3. Identify the legacy network(s) in the list. Legacy networks are identified by the "LEGACY" network type.
4. Delete the legacy network(s) using the following command:

   ```
   gcloud compute networks delete [LEGACY_NETWORK_NAME]
   ```

   Replace [LEGACY_NETWORK_NAME] with the name of the legacy network you want to delete.

5. Confirm the deletion by typing "y" when prompted.

Note: Deleting a VPC network deletes all the subnets, routes, and firewall rules associated with the network. Therefore, make sure to review the network configuration and any dependencies before deleting it.

#### Using Python

To remediate the misconfiguration "Legacy Networks Should Not Be Used" in GCP using Python, you can follow the below steps:

Step 1: Install the required packages:
```
pip install google-cloud-compute
```

Step 2: Authenticate with GCP using the below command:
```
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/credentials.json
```

Step 3: Write a Python script to remediate the misconfiguration:
```python
from google.cloud import compute_v1

# Create a client object for Compute Engine API
compute_client = compute_v1.ComputeClient()

# Get the list of networks
networks = compute_client.networks().list(project="your-project-id", region="your-region").execute()

# Loop through the networks and check if any of them are legacy networks
for network in networks["items"]:
    if network["kind"] == "compute#network" and "legacy" in network["name"]:
        # If the network is a legacy network, delete it
        compute_client.networks().delete(project="your-project-id", network=network["name"]).execute()
        print("Legacy network {} has been deleted.".format(network["name"]))
```

Step 4: Replace "your-project-id" and "your-region" with your actual project ID and region where the legacy networks are located.

Step 5: Run the Python script to delete all the legacy networks in the specified project and region.

Note: Before deleting any network, make sure that it is not being used by any resources in your project.




</Tab>
</Tabs>