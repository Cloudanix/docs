---
slug: rsasha1_not_used_by_key_signing_key
title: RSASHA1 Should Not Be Used For Key Signing
sidebar_label: RSASHA1 Should Not Be Used For Key Signing
---

### More Info:

Ensure that RSASHA1 is not used for the key-signing key in Cloud DNS DNSSEC.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISGCP, CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to Google Cloud Console: Open your web browser and navigate to the Google Cloud Console (console.cloud.google.com). Sign in with your Google Cloud credentials.

2. Navigate to Cloud DNS: From the left-hand side menu, navigate to "Network Services" and then select "Cloud DNS".

3. Check DNSSEC Settings: In the Cloud DNS page, you will see a list of your DNS zones. Click on the DNS zone you want to inspect. In the DNSSEC section, check the algorithm used for key signing. If RSASHA1 is used, it indicates a misconfiguration.

4. Use Command Line Interface: Alternatively, you can use the gcloud command-line tool to inspect the DNSSEC settings. Run the following command: `gcloud dns managed-zones describe [ZONE_NAME]`. Replace `[ZONE_NAME]` with the name of your DNS zone. The output will show the DNSSEC settings for the zone. If the keySigningAlgorithm is set to "rsasha1", it indicates a misconfiguration.

#### Using CLI

1. Install and authenticate Google Cloud SDK: Before you can start using the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and follow the instructions to install it. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all DNS managed zones: Use the following command to list all the DNS managed zones in your GCP project. This will give you a list of all the DNS zones along with their details.
   ```
   gcloud dns managed-zones list
   ```
3. List DNSSEC keys: For each DNS managed zone, list the DNSSEC keys using the following command. Replace `[ZONE_NAME]` with the name of your DNS zone.
   ```
   gcloud dns dns-keys list --zone=[ZONE_NAME]
   ```
   This command will list all the DNSSEC keys for the specified zone along with their details including the algorithm used.

4. Check the algorithm: In the output of the above command, check the 'Algorithm' field for each key. If any key is using the 'rsasha1' algorithm, it means that RSASHA1 is being used for key signing in the network.

#### Using Python

Detecting RSASHA1 usage for key signing in a network involves scanning the DNSSEC configuration of your domain. Here's how you can do it using Python:

1. **Install Required Libraries**: You will need the `dnspython` library to interact with DNS in Python. You can install it using pip:
   ```bash
   pip install dnspython
   ```

2. **Create a Python Script to Fetch DNSSEC Records**: You can use the `dnspython` library to fetch DNSSEC records. Here's a simple script that fetches DNSKEY records:

   ```python
   import dns.resolver

   domain = 'example.com'  # replace with your domain
   dnskeys = dns.resolver.resolve(domain, 'DNSKEY')

   for rdata in dnskeys:
       print(rdata)
   ```

3. **Check for RSASHA1 Usage**: The DNSKEY records contain information about the algorithm used. RSASHA1 corresponds to algorithm number 5 or 7. Modify the script to check for these:

   ```python
   import dns.resolver

   domain = 'example.com'  # replace with your domain
   dnskeys = dns.resolver.resolve(domain, 'DNSKEY')

   for rdata in dnskeys:
       if rdata.algorithm in [5, 7]:
           print(f'RSASHA1 used in DNSKEY for {domain}')
   ```

4. **Automate the Process**: If you have multiple domains to check, you can put the above code in a function and call it for each domain:

   ```python
   import dns.resolver

   def check_rsasha1(domain):
       dnskeys = dns.resolver.resolve(domain, 'DNSKEY')

       for rdata in dnskeys:
           if rdata.algorithm in [5, 7]:
               print(f'RSASHA1 used in DNSKEY for {domain}')

   domains = ['example.com', 'example.net', 'example.org']  # replace with your domains
   for domain in domains:
       check_rsasha1(domain)
   ```

This script will print a message for each domain where RSASHA1 is used in a DNSKEY record.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the RSASHA1 should not be used for key signing issue on GCP, you can follow the below steps:

1. Open the Cloud Console and navigate to the Cloud DNS page.
2. Select the name of the managed zone for which you want to update the DNSSEC settings.
3. In the Security section, click on the Edit button.
4. In the Algorithms section, uncheck the RSASHA1 checkbox.
5. Click Save to update the DNSSEC settings.

By unchecking the RSASHA1 checkbox, you will ensure that the RSASHA1 algorithm is not used for key signing, which will remediate the issue.

#### Using CLI

To remediate the "RSASHA1 Should Not Be Used For Key Signing" misconfiguration in GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to list all the DNS managed zones in your project:
   ```
   gcloud dns managed-zones list
   ```

3. Choose the managed zone for which you want to remediate the misconfiguration and note down the `managed-zone-name`.

4. Run the following command to get the DNSSEC configuration for the chosen managed zone:
   ```
   gcloud dns managed-zones describe <managed-zone-name>
   ```

5. If the `state` field in the output shows `on`, then DNSSEC is enabled for the zone and you need to disable it.

6. Run the following command to disable DNSSEC for the chosen managed zone:
   ```
   gcloud dns managed-zones update <managed-zone-name> --dnssec-state off
   ```

7. Verify that the `state` field in the output of the `describe` command shows `off` to confirm that DNSSEC has been disabled for the managed zone.

By following these steps, you can remediate the "RSASHA1 Should Not Be Used For Key Signing" misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the RSASHA1 should not be used for key signing issue in GCP using Python, you can follow the below steps:

1. Install the Google Cloud DNS Python library using the following command:
```
pip install google-cloud-dns
```

2. Create a DNS client object using the following code:
```python
from google.cloud import dns

client = dns.Client()
```

3. Get the DNS zone using the following code:
```python
zone_name = 'example.com.'
zone = client.zone(zone_name)
```

4. Get the DNS records using the following code:
```python
records = zone.list_resource_record_sets()
```

5. Iterate over the records and check if any record uses the RSASHA1 algorithm for key signing. If found, update the record using the SHA256 algorithm using the following code:
```python
for record in records:
    if record.signature_algorithm == 'RSASHA1':
        record.signature_algorithm = 'RSASHA256'
        zone.update_record(record)
```

6. Once all the records have been updated, commit the changes using the following code:
```python
zone.commit()
```

By following these steps, you can remediate the RSASHA1 should not be used for key signing issue in GCP using Python.




</Tab>
</Tabs>