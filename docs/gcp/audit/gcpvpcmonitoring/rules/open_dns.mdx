---
slug: open_dns
title: DNS Port Should Not Be Open
sidebar_label: DNS Port Should Not Be Open
---

### More Info:

Determines if TCP or UDP port 53 for DNS is open to the public.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, GDPR, SOC2, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to VPC Network: From the main navigation menu, click on "VPC Network" and then select "Firewall rules". This will display a list of all the firewall rules that are currently configured in your Google Cloud environment.

3. Check for Open DNS Ports: Look for any firewall rules that have the "Target" set to "All instances in the network" and the "Source filter" set to "IP ranges". Then, check the "Protocols and ports" column to see if port 53 (the standard DNS port) is open. If it is, this could be a potential misconfiguration.

4. Verify the Source IP Ranges: If you find any rules with open DNS ports, check the "Source IP ranges" column. If it's set to "0.0.0.0/0", this means that the DNS port is open to the entire internet, which is a serious security risk.

#### Using CLI

1. Install and authenticate the Google Cloud SDK: The Google Cloud SDK includes the gcloud command-line tool, which is necessary to interact with your GCP resources. You can install it by following the instructions provided by Google Cloud. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all the firewall rules: Use the following command to list all the firewall rules in your GCP project. This will display a list of all firewall rules, including their associated network, source ranges, allowed ports, and more.

    ```
    gcloud compute firewall-rules list
    ```

3. Filter the firewall rules for DNS ports: DNS typically uses port 53. You can filter the list of firewall rules for any that allow traffic on port 53 using the following command:

    ```
    gcloud compute firewall-rules list --filter="allowed:53"
    ```

4. Review the output: The output of the above command will show you any firewall rules that allow traffic on port 53. If any such rules exist, it means that the DNS port is open. You should review these rules and determine if they are necessary for your application. If they are not, it may be a misconfiguration.

#### Using Python

Detecting if a DNS port is open in a network can be done using Python scripts. Here's how you can do it:

1. **Import Necessary Libraries**: The first step is to import the necessary Python libraries. We will be using the `socket` library for this task. The `socket` library in Python provides a way of using the Berkeley sockets API. It provides an interface to the underlying operating system socket implementations.

    ```python
    import socket
    ```

2. **Define the Target and Port**: Next, you need to define the target IP address and the port you want to check. In this case, the DNS port is 53.

    ```python
    target = "your_target_ip"
    port = 53
    ```

3. **Create a Socket and Connect**: Now, create a socket object and try to connect to the target IP address on the specified port. If the connection is successful, it means the port is open.

    ```python
    def check_port(target, port):
        try:
            # Create a socket object
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.settimeout(5)

            # Connect to the target IP and port
            s.connect((target, port))
            return True
        except:
            return False
    ```

4. **Check the Port**: Finally, call the function and print the result. If the function returns True, it means the DNS port is open. If it returns False, it means the DNS port is not open.

    ```python
    is_open = check_port(target, port)
    print(f"Port {port} is {'open' if is_open else 'not open'} on {target}")
    ```

This script will help you detect if the DNS port is open on a specific IP address. Please replace "your_target_ip" with the actual IP address you want to check.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the DNS Port Should Not Be Open misconfiguration in GCP using the GCP console, please follow the below steps:

1. Login to the GCP console.

2. Navigate to the VPC Network page by clicking on the hamburger menu in the top left corner and then selecting "VPC Network" under the "NETWORKING" section.

3. Select the VPC network that needs to be remediated.

4. Click on the "Firewall rules" tab.

5. Identify the firewall rule that is allowing DNS traffic.

6. Click on the edit button (pencil icon) for that firewall rule.

7. In the "Targets" section, select "Specified target tags" and remove the tag that allows DNS traffic.

8. In the "Protocols and ports" section, remove the port that allows DNS traffic.

9. Click on the "Save" button to save the changes.

10. Verify that the DNS port is no longer open by running a port scan on the instance.

By following the above steps, you can remediate the DNS Port Should Not Be Open misconfiguration in GCP using the GCP console.

#### Using CLI

To remediate the DNS Port Should Not Be Open misconfiguration in GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to list all the firewall rules in your project:

```
gcloud compute firewall-rules list
```

3. Identify the firewall rule that allows DNS traffic on all ports.

4. Run the following command to delete the firewall rule:

```
gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]
```

Replace [FIREWALL_RULE_NAME] with the name of the firewall rule that allows DNS traffic on all ports.

5. Confirm the deletion of the firewall rule by typing "Y" when prompted.

6. Run the following command to verify that the firewall rule has been deleted:

```
gcloud compute firewall-rules list
```

7. If the firewall rule still exists, repeat steps 4-6 until the firewall rule has been successfully deleted.

8. Verify that the DNS port is no longer open by running a port scan on your GCP instances from an external network.

By following these steps, you will have successfully remediated the DNS Port Should Not Be Open misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the DNS port open misconfiguration in GCP using Python, you can follow these steps:

1. First, you need to get the list of all the VM instances in your GCP project. You can use the `google-cloud-sdk` and `google-auth` Python packages to authenticate and access the GCP resources.

```python
from google.oauth2 import service_account
from googleapiclient.discovery import build

# Authenticate using a service account key file
credentials = service_account.Credentials.from_service_account_file(
    'path/to/service_account_key.json')

# Create a compute engine client
compute = build('compute', 'v1', credentials=credentials)

# List all VM instances in the project
project_id = 'your-project-id'
zones = ['us-central1-a', 'us-central1-b', 'us-central1-c']  # list of zones to check
instances = []
for zone in zones:
    result = compute.instances().list(project=project_id, zone=zone).execute()
    if 'items' in result:
        instances.extend(result['items'])
```

2. Next, for each VM instance, you need to check if the DNS port (port 53) is open. You can do this by checking the firewall rules associated with the instance.

```python
for instance in instances:
    instance_name = instance['name']
    instance_zone = instance['zone'].split('/')[-1]
    firewall_rules = compute.firewalls().list(project=project_id).execute()['items']
    for rule in firewall_rules:
        if 'allowed' in rule and rule['allowed'] and 'ports' in rule['allowed'][0]:
            if 'tcp:53' in rule['allowed'][0]['ports'] or 'udp:53' in rule['allowed'][0]['ports']:
                print(f"Instance {instance_name} in zone {instance_zone} has DNS port open")
```

3. If the DNS port is open for any instance, you can remove the firewall rule that allows the DNS traffic.

```python
for instance in instances:
    instance_name = instance['name']
    instance_zone = instance['zone'].split('/')[-1]
    firewall_rules = compute.firewalls().list(project=project_id).execute()['items']
    for rule in firewall_rules:
        if 'allowed' in rule and rule['allowed'] and 'ports' in rule['allowed'][0]:
            if 'tcp:53' in rule['allowed'][0]['ports'] or 'udp:53' in rule['allowed'][0]['ports']:
                print(f"Instance {instance_name} in zone {instance_zone} has DNS port open")
                rule_name = rule['name']
                print(f"Removing firewall rule {rule_name}")
                operation = compute.firewalls().delete(project=project_id, firewall=rule_name).execute()
                print(f"Firewall rule {rule_name} deleted")
```

Note: Make sure to test the script in a test environment before running it in production. Also, keep in mind that removing the firewall rule that allows DNS traffic may impact the functionality of your VM instances, so make sure to verify that the DNS traffic is not required before removing the rule.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>