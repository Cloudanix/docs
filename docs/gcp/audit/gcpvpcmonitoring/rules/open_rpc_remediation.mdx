

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account.

2. Navigate to VPC Network: From the main dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "VPC Network" under the "Networking" section.

3. Check Firewall Rules: In the VPC Network page, click on "Firewall rules" in the left-hand menu. This will display a list of all the firewall rules in your network.

4. Inspect Firewall Rules for Open RPC Ports: Look through the list of firewall rules for any that have the RPC port (typically port 111) open. This can be identified by checking the "Protocols / ports" column for each rule. If you see "tcp:111" or "udp:111", this indicates that the RPC port is open.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to install and authenticate.

2. Once you have the Google Cloud SDK CLI installed and authenticated, you can use the following command to list all the firewall rules in your GCP project:

   ```
   gcloud compute firewall-rules list
   ```
   This command will return a list of all the firewall rules in your project, including their names, network, direction, priority, source ranges, allowed protocols and ports, and whether they are enabled or not.

3. To check if the RPC port is open, you can filter the results by the port number. The default port for RPC is 135. Use the following command:

   ```
   gcloud compute firewall-rules list --filter="allowed:135"
   ```
   This command will return a list of all the firewall rules that allow traffic on port 135.

4. Review the output of the command. If any firewall rules are returned, this means that the RPC port is open in your network. If no rules are returned, this means that the RPC port is not open.

#### Using Python

1. Install necessary Python libraries:
   You will need the 'boto3' library for AWS, 'azure-mgmt-network' for Azure, and 'google-cloud-network-connectivity' for GCP. You can install these libraries using pip:
   ```
   pip install boto3 azure-mgmt-network google-cloud-network-connectivity
   ```
2. AWS:
   Use the 'boto3' library to list all security groups and check if the RPC port (usually port 135) is open.
   ```python
   import boto3
   ec2 = boto3.resource('ec2')
   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           if 'FromPort' in permission and permission['FromPort'] == 135:
               print(f"Security group {security_group.group_name} has RPC port open")
   ```
3. Azure:
   Use the 'azure-mgmt-network' library to list all network security groups and check if the RPC port is open.
   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential
   credential = DefaultAzureCredential()
   network_client = NetworkManagementClient(credential, '<subscription_id>')
   for nsg in network_client.network_security_groups.list_all():
       for rule in nsg.security_rules:
           if rule.destination_port_range == '135':
               print(f"Network security group {nsg.name} has RPC port open")
   ```
4. GCP:
   Use the 'google-cloud-network-connectivity' library to list all firewall rules and check if the RPC port is open.
   ```python
   from google.cloud import network_connectivity_v1
   client = network_connectivity_v1.NetworkConnectivityServiceClient()
   for firewall in client.list_firewall_policies():
       for rule in firewall.allowed:
           if 'ports' in rule and '135' in rule['ports']:
               print(f"Firewall policy {firewall.name} has RPC port open")
   ```

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step-by-step instructions to remediate the "RPC Port Should Not Be Open" misconfiguration in GCP using the GCP console:

1. Log in to the GCP console (console.cloud.google.com).
2. Navigate to the GCP project that has the misconfiguration.
3. In the left-hand menu, click on the "Compute Engine" option.
4. Click on the "VM instances" option to see a list of all the virtual machines in the project.
5. Identify the virtual machine that has the open RPC port.
6. Click on the name of the virtual machine to open its details page.
7. Click on the "Edit" button at the top of the page to edit the VM instance settings.
8. Scroll down to the "Firewall" section and click on "Network interfaces".
9. Under "Firewall rules", click on "default-allow-rpc".
10. Click the "Delete" button to remove the rule.
11. Click the "Save" button to save the changes.

This will remove the RPC port from being open on the virtual machine and remediate the misconfiguration.

#### Using CLI

To remediate the RPC Port Should Not Be Open misconfiguration on GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in your GCP console.
2. Run the following command to list all the firewall rules in your project:
   
   `gcloud compute firewall-rules list`

3. Identify the firewall rule that allows RPC traffic. You can identify it by looking at the `allowed` section of the rule and checking if it allows `tcp:135` or `tcp:49152-65535`.
4. Once you have identified the firewall rule, run the following command to delete it:
   
   `gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]`

   Replace [FIREWALL_RULE_NAME] with the name of the firewall rule you want to delete.

5. Confirm the deletion by typing `Y` when prompted.

6. Verify that the firewall rule has been deleted by running the following command:

   `gcloud compute firewall-rules list`

   The firewall rule that allowed RPC traffic should no longer be listed.

By following these steps, you have successfully remediated the RPC Port Should Not Be Open misconfiguration on GCP using GCP CLI.

#### Using Python

To remediate the RPC Port Should Not Be Open misconfiguration in GCP using Python, you can follow these steps:

1. First, you need to identify the project and the instance that has the open RPC port. You can use the GCP Python SDK to list all the instances and their firewall rules in the project.

```python
from google.cloud import compute_v1

compute = compute_v1.InstancesClient()

project = 'your-project-id'

zones = compute.zones().list(project=project).execute()

for zone in zones['items']:
    instances = compute.instances().list(project=project, zone=zone['name']).execute()
    for instance in instances['items']:
        print(f"Instance Name: {instance['name']}")
        firewall_rules = compute.firewalls().list(project=project).execute()
        for rule in firewall_rules['items']:
            if 'allowed' in rule and 'tcp' in rule['allowed']:
                for port in rule['allowed']['tcp']:
                    if port == '135':
                        print(f"Firewall Rule Name: {rule['name']}")
```

2. Once you have identified the instance and the firewall rule that has the open RPC port, you can use the GCP Python SDK to delete the firewall rule.

```python
firewall_rule_name = 'rpc-firewall-rule'

compute.firewalls().delete(project=project, firewall=firewall_rule_name).execute()
```

3. After deleting the firewall rule, you should verify that the RPC port is no longer open. You can use the GCP Python SDK to list the firewall rules again and verify that the RPC port is not allowed anymore.

```python
firewall_rules = compute.firewalls().list(project=project).execute()

for rule in firewall_rules['items']:
    if 'allowed' in rule and 'tcp' in rule['allowed']:
        for port in rule['allowed']['tcp']:
            if port == '135':
                print(f"Firewall Rule Name: {rule['name']} still allows RPC port")
``` 

Note: Make sure you have the appropriate permissions to manage instances and firewall rules in your GCP project.


</Tab>
</Tabs>