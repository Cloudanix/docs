---
slug: open_ftp
title: FTP Port Should Not Be Open
sidebar_label: FTP Port Should Not Be Open
---

### More Info:

Determines if TCP port 20 or 21 for FTP is open to the public.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, GDPR, SOC2, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to VPC Network: From the main navigation menu, click on "VPC Network" and then select "Firewall rules". This will display a list of all the firewall rules that are currently configured in your Google Cloud environment.

3. Check for FTP Port: Look for any firewall rules that have "tcp:20,tcp:21" (FTP ports) specified in the "Protocols / ports" column. If such a rule exists, it means that the FTP port is open.

4. Verify Source Range: Check the "Source IP ranges" column for the rule. If it's set to "0.0.0.0/0", it means that the FTP port is open to the entire internet, which is a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK: The Google Cloud SDK includes the gcloud command-line tool, which is necessary to interact with your GCP resources. You can install it by following the instructions provided by Google Cloud. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all the firewall rules: Use the `gcloud` command-line tool to list all the firewall rules in your project. The command to do this is `gcloud compute firewall-rules list`. This will return a list of all firewall rules, including their names, network, direction, priority, source ranges, allowed protocols and ports, and other details.

3. Filter the firewall rules: To check if the FTP port (port 21) is open, you need to filter the firewall rules for any rules that allow traffic on port 21. You can do this by piping the output of the previous command to the `grep` command, like this: `gcloud compute firewall-rules list | grep 'tcp:21'`. This will return any firewall rules that allow traffic on port 21.

4. Analyze the output: If the previous command returns any results, it means that the FTP port is open in your network. The output will include the details of the firewall rule, including its name, network, direction, priority, source ranges, and allowed protocols and ports. You can use this information to identify the misconfiguration and plan your remediation steps.

#### Using Python

1. Install necessary Python libraries:
   You will need the `boto3` library for AWS, `azure-mgmt-network` for Azure, and `google-cloud-network-connectivity` for GCP. You can install these libraries using pip:
   ```
   pip install boto3 azure-mgmt-network google-cloud-network-connectivity
   ```

2. AWS:
   Use the `boto3` library to list all security groups and check if any of them have FTP (port 21) open.
   ```python
   import boto3

   ec2 = boto3.resource('ec2')
   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           if 'FromPort' in permission and permission['FromPort'] == 21:
               print(f"Security group {security_group.id} has FTP port open")
   ```

3. Azure:
   Use the `azure-mgmt-network` library to list all network security groups and check if any of them have FTP (port 21) open.
   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   network_client = NetworkManagementClient(credential, subscription_id)

   for nsg in network_client.network_security_groups.list_all():
       for rule in nsg.security_rules:
           if rule.destination_port_range == '21':
               print(f"Network security group {nsg.id} has FTP port open")
   ```

4. GCP:
   GCP does not have a direct equivalent to AWS's security groups or Azure's network security groups. Instead, you would need to check the firewall rules for each VPC network. You can use the `google-cloud-network-connectivity` library to do this.
   ```python
   from google.cloud import network_connectivity_v1

   client = network_connectivity_v1.HubServiceClient()
   for hub in client.list_hubs():
       for spoke in client.list_spokes(hub.name):
           if spoke.linked_vpn_tunnel:
               print(f"Spoke {spoke.name} is linked to a VPN tunnel")
           elif spoke.linked_interconnect_attachment:
               print(f"Spoke {spoke.name} is linked to an interconnect attachment")
           elif spoke.linked_router_appliance_instances:
               print(f"Spoke {spoke.name} is linked to a router appliance instance")
   ```
   Note: This script only checks if a spoke is linked to a VPN tunnel, interconnect attachment, or router appliance instance. It does not check the firewall rules of these resources. You would need to use the respective APIs to check the firewall rules.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the FTP Port Should Not Be Open misconfiguration for GCP using the GCP console, follow these steps:

1. Open the Google Cloud Console and select the project where the misconfiguration is present.
2. Go to the Compute Engine section from the left-hand menu.
3. Select the VM instance where the FTP port is open.
4. Click on the Edit button at the top of the page.
5. Scroll down to the Firewall section and click on the "default-allow-ftp" rule.
6. Click on the "Edit" button next to the rule.
7. In the "Protocols and ports" section, uncheck the "tcp:21" option.
8. Click on the "Save" button to apply the changes.
9. Repeat steps 5-8 for any other FTP rules that are present.

By performing these steps, you have successfully remediated the misconfiguration by closing the FTP port on the GCP VM instance.

#### Using CLI

To remediate the FTP Port Should Not Be Open misconfiguration for GCP using GCP CLI, you can follow these steps:

1. Open the Google Cloud Console and navigate to the GCP project where the misconfiguration exists.

2. Open the Cloud Shell by clicking on the Cloud Shell icon in the top right corner of the console.

3. In the Cloud Shell, run the following command to list all the firewall rules in the project:

   ```
   gcloud compute firewall-rules list
   ```

4. Identify the firewall rule that allows FTP traffic to the instance. Note down the name of the firewall rule.

5. Run the following command to delete the firewall rule:

   ```
   gcloud compute firewall-rules delete [FIREWALL_RULE_NAME]
   ```

   Replace [FIREWALL_RULE_NAME] with the name of the firewall rule that you identified in step 4.

6. Confirm the deletion by entering `Y` when prompted.

7. Verify that the firewall rule has been deleted by running the following command:

   ```
   gcloud compute firewall-rules list
   ```

   The output should not include the firewall rule that you just deleted.

By following these steps, you have successfully remediated the FTP Port Should Not Be Open misconfiguration for GCP using GCP CLI.

#### Using Python

To remediate the FTP Port Should Not Be Open misconfiguration in GCP using Python, you can follow these steps:

1. First, you need to identify the project and the instance that has the open FTP port. You can use the `google-cloud-sdk` command-line tool to do this. Run the following command:

```
gcloud compute instances list
```

This will list all the instances in your project along with their metadata.

2. Once you have identified the instance, you need to connect to it using SSH. You can use the `gcloud compute ssh` command to do this. Run the following command:

```
gcloud compute ssh [INSTANCE_NAME]
```

Replace `[INSTANCE_NAME]` with the name of the instance you want to connect to.

3. Once you are connected to the instance, you need to check if the FTP port is open. You can use the `netstat` command to do this. Run the following command:

```
sudo netstat -tuln | grep :21
```

This will show you if the FTP port (port 21) is open or not.

4. If the FTP port is open, you need to close it. You can do this by modifying the instance's firewall rules. You can use the `google-cloud-sdk` command-line tool to do this. Run the following command:

```
gcloud compute firewall-rules update [FIREWALL_RULE_NAME] --source-ranges=[IP_RANGE] --direction=INGRESS --action=DENY --rules=tcp:21
```

Replace `[FIREWALL_RULE_NAME]` with the name of the firewall rule that allows traffic to port 21. Replace `[IP_RANGE]` with the IP range that is allowed to access the FTP port.

5. Finally, you need to verify that the FTP port is closed. You can do this by running the `netstat` command again:

```
sudo netstat -tuln | grep :21
```

This should not show any output, which means that the FTP port is closed.

By following these steps, you can remediate the FTP Port Should Not Be Open misconfiguration in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/using-firewalls](https://cloud.google.com/vpc/docs/using-firewalls) 


</Tab>
</Tabs>