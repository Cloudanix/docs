---
slug: default_vpc_in_use_interfaces
title: Interfaces With Default VPC
sidebar_label: Interfaces With Default VPC
---

### More Info:

Lists all the network interfaces resources from those instances that have default VPC in use.

### Risk Level

Low

### Address

Security

### Compliance Standards

CISGCP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to your Google Cloud Platform (GCP) console.

2. Navigate to the VPC network section. You can do this by clicking on the navigation menu (three horizontal lines on the top left corner), then select "VPC network" under the "Networking" section.

3. In the VPC network page, you will see a list of all your VPC networks. The default VPC network is named "default".

4. Check the interfaces associated with the default VPC. You can do this by clicking on the name of the default VPC network. In the VPC network details page, you can see all the subnets (interfaces) associated with the VPC. If there are any resources associated with these subnets, it means they are using the default VPC.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your GCP account using the following command. This will open a new window in your web browser asking you to log in with your Google account.
   ```
   gcloud auth login
   ```

3. Set your project ID to the project you want to check for misconfigurations. Replace 'your-project-id' with the ID of your project.
   ```
   gcloud config set project your-project-id
   ```

4. Run the following command to list all the network interfaces in your project. This will display a list of all the network interfaces along with their associated VPCs. If any of them are associated with the default VPC, it means they are misconfigured.
   ```
   gcloud compute instances list --format='table(name,networkInterfaces[].network)'
   ```
   If the output includes "default", it means that the instance is using the default VPC.

#### Using Python

1. **AWS:**

   You can use the boto3 library in Python to interact with AWS services. To check for interfaces with default VPC, you can use the following script:

   ```python
   import boto3

   ec2 = boto3.resource('ec2')
   default_vpc = [vpc for vpc in ec2.vpcs.all() if vpc.is_default]

   if default_vpc:
       for vpc in default_vpc:
           for subnet in vpc.subnets.all():
               for interface in subnet.network_interfaces.all():
                   print(f"Default VPC Interface: {interface.id}")
   ```

2. **Azure:**

   For Azure, you can use the Azure SDK for Python. Here's a script to check for interfaces with default VPC:

   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   network_client = NetworkManagementClient(credential, subscription_id)

   for vnet in network_client.virtual_networks.list_all():
       if 'default' in vnet.name:
           for subnet in network_client.subnets.list(resource_group_name=vnet.id.split('/')[4], virtual_network_name=vnet.name):
               for interface in network_client.network_interfaces.list_all():
                   if interface.ip_configurations[0].subnet.id == subnet.id:
                       print(f"Default VPC Interface: {interface.id}")
   ```

3. **GCP:**

   For GCP, you can use the google-cloud-sdk. Here's a script to check for interfaces with default VPC:

   ```python
   from google.cloud import compute_v1

   project = 'your-project-id'
   client = compute_v1.NetworksClient()

   for network in client.list(project=project):
       if 'default' in network.name:
           for subnet in client.subnetworks().list(project=project, region=network.region):
               for interface in client.network_interfaces().list(project=project, region=network.region):
                   if interface.subnetwork == subnet.id:
                       print(f"Default VPC Interface: {interface.id}")
   ```
   
Please replace 'your-subscription-id' and 'your-project-id' with your actual Azure subscription ID and GCP project ID respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step by step instructions to remediate the "Interfaces With Default VPC" misconfiguration in GCP using GCP console:

1. Open the GCP console and navigate to the VPC network page.
2. Select the default VPC network from the list of VPC networks.
3. Click on the "Edit" button at the top of the page.
4. Scroll down to the "Subnets" section and click on "Edit" next to the default subnet.
5. In the "Secondary IP ranges" section, click on "Add IP range".
6. Enter a new IP range that does not overlap with the existing IP range of the default subnet.
7. Click "Save" to save the changes.
8. Repeat steps 4-7 for any additional subnets in the default VPC network.
9. Once all subnets have been updated, click on the "Save" button at the bottom of the page to save the changes.

By following these steps, you have remediated the "Interfaces With Default VPC" misconfiguration in GCP by adding secondary IP ranges to the default subnets. This will prevent instances from being created with public IP addresses and ensure that all traffic is routed through the internal network.

#### Using CLI

The equivalent of a default VPC in GCP is a default network. To remediate the issue of interfaces with default VPC in GCP, you can follow these steps using GCP CLI:

1. List all the instances in the default network using the following command: 

   `gcloud compute instances list --filter="networkInterfaces.networkIP:10.128.0.0/9"`

   This command will list all the instances that are using the default network in GCP.

2. For each instance that is using the default network, create a new VPC network and move the instance to the new network. You can use the following command to create a new VPC network:

   `gcloud compute networks create [NEW_NETWORK_NAME] --subnet-mode=auto`

   Replace [NEW_NETWORK_NAME] with a name of your choice for the new network.

3. Once the new network is created, move the instance to the new network using the following command:

   `gcloud compute instances move [INSTANCE_NAME] --zone=[ZONE] --destination-network=[NEW_NETWORK_NAME]`

   Replace [INSTANCE_NAME] with the name of the instance that you want to move, [ZONE] with the zone where the instance is located, and [NEW_NETWORK_NAME] with the name of the new network that you created in step 2.

4. Verify that the instance has been moved to the new network using the following command:

   `gcloud compute instances describe [INSTANCE_NAME] --zone=[ZONE] | grep network`

   This command will display the network interface details for the instance. Verify that the network interface is now using the new network that you created in step 2.

5. Repeat steps 2-4 for all the instances that are using the default network.

By following the above steps, you can remediate the issue of interfaces with default VPC in GCP using GCP CLI.

#### Using Python

The equivalent of AWS's default VPC in GCP is the default network. The default network is a global resource that is automatically created when you create a new project in GCP. By default, all instances in a project are automatically connected to the default network unless you specify otherwise. 

To remediate the issue of instances with default network interfaces in GCP using Python, you can use the following steps:

1. Use the Google Cloud SDK to list all the instances in your project that are using the default network interface. You can do this by running the following command in your terminal:

   `gcloud compute instances list --filter="networkInterfaces.networkIP:10.128.0.0/9"`

   This command will list all the instances that are using the default network interface and have an IP address in the range of 10.128.0.0/9.

2. Use the Google Cloud SDK to create a new VPC network in your project. You can do this by running the following command in your terminal:

   `gcloud compute networks create [NETWORK_NAME] --subnet-mode=auto`

   Replace [NETWORK_NAME] with the name you want to give to your new VPC network.

3. Use the Google Cloud SDK to create a new subnet in your new VPC network. You can do this by running the following command in your terminal:

   `gcloud compute networks subnets create [SUBNET_NAME] --network=[NETWORK_NAME] --region=[REGION] --range=[CIDR_RANGE]`

   Replace [SUBNET_NAME] with the name you want to give to your new subnet, [NETWORK_NAME] with the name of the VPC network you created in step 2, [REGION] with the region where you want to create the subnet, and [CIDR_RANGE] with the IP address range you want to assign to the subnet.

4. Use the Google Cloud SDK to create a new instance template that uses the new VPC network interface. You can do this by running the following command in your terminal:

   `gcloud compute instance-templates create [TEMPLATE_NAME] --network=[NETWORK_NAME] --subnet=[SUBNET_NAME]`

   Replace [TEMPLATE_NAME] with the name you want to give to your new instance template, [NETWORK_NAME] with the name of the VPC network you created in step 2, and [SUBNET_NAME] with the name of the subnet you created in step 3.

5. Use the Google Cloud SDK to create new instances using the new instance template. You can do this by running the following command in your terminal:

   `gcloud compute instances create [INSTANCE_NAME] --source-instance-template=[TEMPLATE_NAME]`

   Replace [INSTANCE_NAME] with the name you want to give to your new instance and [TEMPLATE_NAME] with the name of the instance template you created in step 4.

6. Verify that the new instances are using the new VPC network interface by running the following command in your terminal:

   `gcloud compute instances list --filter="networkInterfaces.networkIP:[CIDR_RANGE]"`

   Replace [CIDR_RANGE] with the IP address range you assigned to the subnet in step 3.

By following these steps, you can remediate the issue of instances with default network interfaces in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/vpc/docs/vpc](https://cloud.google.com/vpc/docs/vpc) 


</Tab>
</Tabs>