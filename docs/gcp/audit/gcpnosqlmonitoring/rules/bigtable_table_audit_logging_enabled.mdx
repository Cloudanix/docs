---
slug: bigtable_table_audit_logging_enabled
title: Bigtable Tables Should Have Audit Logging Enabled
sidebar_label: Bigtable Tables Should Have Audit Logging Enabled
---

### More Info:

DATA_READ, DATA_WRITE and ADMIN_READ logs should be enabled on Cloud Bigtable tables

### Risk Level

Medium

### Address

Operational Maturity, Security

### Compliance Standards

HITRUST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, visit the Google Cloud Platform Console, and sign in with your Google account credentials.

2. Navigate to Bigtable Instances: From the main navigation menu, select "Bigtable" under the "STORAGE" section. This will take you to the "Bigtable instances" page where all your Bigtable instances are listed.

3. Select the Bigtable Instance: Click on the name of the Bigtable instance that you want to check for audit logging. This will take you to the "Instance details" page.

4. Check Audit Logging: On the "Instance details" page, click on the "AUDIT LOGS" tab. Here, you can see if audit logging is enabled or not. If there are logs present, then audit logging is enabled. If there are no logs, then audit logging is not enabled.

#### Using CLI

1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and follow the instructions to install it. Once installed, you can authenticate it using the command `gcloud auth login`.

2. List all Bigtable instances: Use the following command to list all the Bigtable instances in your project:

   ```
   gcloud bigtable instances list
   ```

   This command will return a list of all Bigtable instances along with their details.

3. Get the IAM policy for each Bigtable instance: For each Bigtable instance, you can get the IAM policy using the following command:

   ```
   gcloud bigtable instances get-iam-policy [INSTANCE_ID]
   ```

   Replace `[INSTANCE_ID]` with the ID of your Bigtable instance. This command will return the IAM policy for the specified Bigtable instance.

4. Check if audit logging is enabled: In the IAM policy, look for the `auditConfigs` section. If audit logging is enabled, you should see an entry for `allServices` with `auditLogConfigs` containing `logType: "DATA_READ"` and `logType: "DATA_WRITE"`. If these entries are not present, then audit logging is not enabled for the Bigtable instance.

#### Using Python

1. Install the necessary libraries: Before you start, you need to install the Google Cloud SDK and the Python client library for Google Cloud Bigtable. You can install these using pip:

   ```python
   pip install --upgrade google-cloud-bigtable
   ```

2. Import the necessary libraries and set up the client: You'll need to import the Bigtable client from the Google Cloud library, and then set up a client using your project ID and instance ID.

   ```python
   from google.cloud import bigtable
   client = bigtable.Client(project='my-project-id', admin=True)
   instance = client.instance('my-instance-id')
   ```

3. Get a list of all tables and check their audit logging status: You can get a list of all tables in your instance using the `list_tables()` method, and then check the audit logging status of each table using the `get_iam_policy()` method.

   ```python
   tables = instance.list_tables()
   for table in tables:
       policy = table.get_iam_policy()
       if 'cloudaudit.googleapis.com/activity' not in policy.bindings:
           print(f'Table {table.table_id} does not have audit logging enabled.')
   ```

4. The above script will print out the IDs of all tables that do not have audit logging enabled. If no tables are printed, that means all tables have audit logging enabled.

Please note that you need to replace 'my-project-id' and 'my-instance-id' with your actual project ID and instance ID. Also, you need to have the necessary permissions to view IAM policies and Bigtable instances.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate "Bigtable Tables Should Have Audit Logging Enabled" for GCP using GCP console, follow these steps:

1. Open the GCP Console and navigate to the Bigtable instance for which you want to enable audit logging.

2. Click on the "Edit" button on the top of the page.

3. In the "Edit instance" page, scroll down to the "Cloud audit logs" section and click on the "Add logging" button.

4. In the "Add logging" dialog box, select the "All Cloud Audit Logs" option and click on the "Save" button.

5. Once you have enabled audit logging for the Bigtable instance, you can view the logs in the Cloud Logging console.

Note: Enabling audit logging for Bigtable tables is a best practice recommended by Google to help you monitor and troubleshoot your Bigtable instances.

#### Using CLI

To remediate the misconfiguration of Bigtable Tables not having Audit Logging enabled in GCP using GCP CLI, follow the below steps:

1. Open the Cloud Shell in your GCP console.

2. Run the following command to enable audit logging for Bigtable Tables:

   ```
   gcloud beta bigtable tables set-iam-policy <instance-id> <table-id> \
   --policy-file=- <<EOF
   {
     "bindings": [
       {
         "role": "roles/bigtable.reader",
         "members": [
           "user:example-user@gmail.com"
         ]
       }
     ],
     "auditConfigs": [
       {
         "auditLogConfigs": [
           {
             "logType": "DATA_READ",
             "exemptedMembers": [
               "user:example-user@gmail.com"
             ]
           }
         ],
         "service": "bigtable.googleapis.com"
       }
     ]
   }
   EOF
   ```

   Replace `<instance-id>` and `<table-id>` with your specific instance and table IDs respectively.

3. This command will set an IAM policy for the specified Bigtable table and enable audit logging for the "DATA_READ" log type.

4. Verify that audit logging is enabled for the Bigtable table by running the following command:

   ```
   gcloud beta bigtable tables get-iam-policy <instance-id> <table-id> \
   --format=json | jq '.auditConfigs'
   ```

   This command will display the audit logging configurations for the specified table.

With these steps, you have successfully remediated the misconfiguration of Bigtable Tables not having Audit Logging enabled in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Bigtable Tables Should Have Audit Logging Enabled" for GCP using Python, follow the below steps:

Step 1: Import the necessary libraries and authenticate the user using the below code:

```
from google.cloud import bigtable
from google.oauth2 import service_account

credentials = service_account.Credentials.from_service_account_file('path/to/credentials.json')
client = bigtable.Client(project='project-id', credentials=credentials)
```

Step 2: List all the Bigtable instances in the project using the below code:

```
instances = client.list_instances()
for instance in instances:
    print(instance.name)
```

Step 3: Select the instance for which you want to enable audit logging and list all the tables in that instance using the below code:

```
instance = client.instance('instance-id')
tables = instance.list_tables()
for table in tables:
    print(table.name)
```

Step 4: Enable audit logging for all the tables in the selected instance using the below code:

```
instance = client.instance('instance-id')
tables = instance.list_tables()
for table in tables:
    table.set_iam_policy({
        'bindings': [{
            'role': 'roles/bigtable.reader',
            'members': ['user:email@example.com'],
        }],
        'auditConfigs': [{
            'auditLogConfigs': [{
                'logType': 'DATA_READ',
            }, {
                'logType': 'DATA_WRITE',
            }],
            'service': 'bigtable.googleapis.com',
        }],
    })
```

Note: Replace 'instance-id' with the actual ID of the instance for which you want to enable audit logging and replace 'user:email@example.com' with the email address of the user for whom you want to enable audit logging.

Step 5: Verify that audit logging is enabled for all the tables in the selected instance using the below code:

```
instance = client.instance('instance-id')
tables = instance.list_tables()
for table in tables:
    policy = table.get_iam_policy()
    print(policy)
```

This will print the IAM policy for each table, which should include the auditConfigs section with the logType and service specified.

By following the above steps, you can remediate the misconfiguration "Bigtable Tables Should Have Audit Logging Enabled" for GCP using Python.


### Additional Reading:

- [https://cloud.google.com/bigtable/docs/audit-logging](https://cloud.google.com/bigtable/docs/audit-logging) 


</Tab>
</Tabs>