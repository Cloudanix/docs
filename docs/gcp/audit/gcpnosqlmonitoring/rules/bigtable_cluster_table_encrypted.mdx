---
slug: bigtable_cluster_table_encrypted
title: Bigtable Cluster Tables Should Be Encrypted
sidebar_label: Bigtable Cluster Tables Should Be Encrypted
---

### More Info:

Ensure that Bigtable cluster tables are encrypted.

### Risk Level

High

### Address

Security

### Compliance Standards

SOC2, NIST, GDPR, ISO27001, HIPAA, HITRUST, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your preferred web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to Bigtable Instances: From the main navigation menu, select "Bigtable" under the "STORAGE" section. This will take you to the "Bigtable instances" page where you can see all your Bigtable instances.

3. Select the Bigtable Instance: Click on the name of the Bigtable instance that you want to check. This will take you to the "Instance details" page.

4. Check Encryption Settings: On the "Instance details" page, look for the "Encryption" section. If the "Encryption type" is set to "Google-managed key", then the Bigtable cluster tables are encrypted. If not, then the tables are not encrypted.

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions to set it up.

2. Authenticate your GCP account using the following command. This will open a new window in your web browser asking you to log in to your Google Cloud account.
   ```
   gcloud auth login
   ```
3. Set your project ID to the project you want to inspect. Replace 'your-project-id' with the ID of your project.
   ```
   gcloud config set project your-project-id
   ```
4. Run the following command to list all Bigtable instances in your project and their details, including whether or not they are encrypted.
   ```
   gcloud bigtable instances list --format="table[box](name,displayName,create_time.date('%Y-%m-%dT%H:%M:%S.%3NZ', 'UTC'),state,type,labels.list(separator=','))"
   ```
   In the output, look for the 'encryptionInfo' field. If the 'encryptionType' is set to 'GOOGLE_DEFAULT_ENCRYPTION', then the Bigtable cluster tables are encrypted with Google's default encryption. If it's set to 'CUSTOMER_MANAGED_ENCRYPTION', then the tables are encrypted with a customer-managed key. If the 'encryptionInfo' field is not present, then the tables are not encrypted.

#### Using Python

To check if Bigtable Cluster Tables are encrypted in NoSQL using Python scripts, you can follow these steps:

1. **Set up Google Cloud SDK and Python Environment:**
   Before you start, make sure you have installed and configured the Google Cloud SDK and Python environment on your local machine. You can download the SDK from the official Google Cloud website and install Python from the official Python website.

2. **Import Google Cloud Bigtable Client Library:**
   Import the Google Cloud Bigtable client library in your Python script. This library allows you to interact with Google Cloud Bigtable.

   ```python
   from google.cloud import bigtable
   ```

3. **Initialize Bigtable Client:**
   Initialize the Bigtable client with your project ID. This client will be used to interact with your Bigtable instance.

   ```python
   client = bigtable.Client(project='your-project-id', admin=True)
   ```

4. **Check Encryption Status:**
   Iterate over all tables in your Bigtable instance and check the encryption status of each table. If the encryption status is not 'Google-managed', then the table is not encrypted.

   ```python
   instance = client.instance('your-instance-id')
   for table in instance.list_tables():
       if not table.encryption_info:
           print(f'Table {table.table_id} is not encrypted.')
       else:
           for info in table.encryption_info:
               if info.encryption_type != bigtable.EncryptionType.GOOGLE_DEFAULT_ENCRYPTION:
                   print(f'Table {table.table_id} is not encrypted with Google-managed encryption.')
   ```

Please replace 'your-project-id' and 'your-instance-id' with your actual project ID and instance ID. This script will print the IDs of all tables that are not encrypted with Google-managed encryption.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Bigtable Cluster Tables Should Be Encrypted" for GCP using GCP console, follow the below steps:

1. Open the Google Cloud Console and navigate to the Bigtable instance that needs to be remediated.
2. Click on the name of the instance to open its details page.
3. In the left-hand menu, click on "Encryption".
4. Under "Encryption at rest", select "Customer-managed encryption keys (CMEK)".
5. Choose a key from the list of existing keys or create a new one by clicking on "Create a key".
6. If creating a new key, enter a name and select a location for the key.
7. Click "Create" to create the key.
8. Once a key is selected or created, click "Save" to enable encryption for the Bigtable instance.
9. Repeat these steps for each Bigtable instance that needs to be remediated.

By following these steps, you can enable encryption for Bigtable Cluster Tables on GCP using GCP console.

#### Using CLI

To remediate the misconfiguration "Bigtable Cluster Tables Should Be Encrypted" in GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to list all the Bigtable instances in the project:

```
gcloud bigtable instances list
```

3. Select the Bigtable instance for which you want to enable encryption.

4. Run the following command to enable encryption for the selected Bigtable instance:

```
gcloud beta bigtable instances update [INSTANCE_ID] --cluster [CLUSTER_ID] --encryption-at-rest-kms-key-name [KMS_KEY_NAME]
```

Replace the `[INSTANCE_ID]` with the ID of the Bigtable instance, `[CLUSTER_ID]` with the ID of the cluster, and `[KMS_KEY_NAME]` with the name of the KMS key to use for encryption.

5. Verify that encryption is enabled for the Bigtable cluster by running the following command:

```
gcloud beta bigtable clusters describe [CLUSTER_ID] --instance [INSTANCE_ID]
```

This command will display the cluster details, including the encryption configuration.

By following these steps, you can remediate the misconfiguration "Bigtable Cluster Tables Should Be Encrypted" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Bigtable Cluster Tables Should Be Encrypted" in GCP using Python, you can follow the below steps:

1. First, you need to install the required libraries. You can install the google-cloud-bigtable library using the following command:

```
pip install google-cloud-bigtable
```

2. Next, you need to create a client object for Bigtable. You can do this using the following code:

```python
from google.cloud import bigtable

# Create a client object for Bigtable
client = bigtable.Client(project='PROJECT_ID', admin=True)
```

Replace `PROJECT_ID` with your GCP project ID.

3. Once you have created the client object, you can get a list of all the Bigtable instances in your project using the following code:

```python
# Get a list of all the Bigtable instances in the project
instances = client.list_instances()
```

4. For each instance, you can get a list of all the tables and check if the tables are encrypted or not using the following code:

```python
# Loop through all the instances
for instance in instances:
    # Get a list of all the tables in the instance
    tables = instance.list_tables()
    # Loop through all the tables
    for table in tables:
        # Check if the table is encrypted or not
        if not table.encryption_type:
            # If the table is not encrypted, enable encryption
            table.encryption_type = 'GOOGLE_DEFAULT_ENCRYPTION'
            table.update()
```

5. Finally, you can save the changes by calling the `update()` method on the table object.

By following these steps, you can remediate the misconfiguration "Bigtable Cluster Tables Should Be Encrypted" for GCP using Python.


### Additional Reading:

- [https://cloud.google.com/bigtable/docs/cmek](https://cloud.google.com/bigtable/docs/cmek) 


</Tab>
</Tabs>