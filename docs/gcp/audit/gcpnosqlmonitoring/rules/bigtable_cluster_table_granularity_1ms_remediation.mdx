

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) Console: Navigate to the GCP console (console.cloud.google.com) and sign in with your Google account. If you don't have an account, you'll need to create one.

2. Navigate to Bigtable: Once you're logged in, click on the navigation menu (three horizontal lines in the top left corner), scroll down and click on "Bigtable". This will take you to the Bigtable service page.

3. Select the Bigtable Instance: On the Bigtable page, you'll see a list of all your Bigtable instances. Click on the instance that you want to check.

4. Check Timestamp Granularity: Once you've selected the instance, click on the "Tables" tab. Here, you'll see a list of all the tables in the instance. Click on the table you want to check, and look for the "Timestamp Granularity" setting. If it's set to 1ms, then the configuration is correct. If not, then there's a misconfiguration.

#### Using CLI

1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK. You can download it from the official Google Cloud website. After downloading, install it and authenticate it with your Google Cloud account using the command `gcloud auth login`.

2. List all Bigtable instances: Use the following command to list all the Bigtable instances in your project:

    ```
    gcloud bigtable instances list
    ```
   This command will return a list of all Bigtable instances along with their details.

3. Get the details of a specific Bigtable instance: To get the details of a specific Bigtable instance, use the following command:

    ```
    gcloud bigtable instances describe [INSTANCE_ID]
    ```
   Replace `[INSTANCE_ID]` with the ID of the Bigtable instance you want to check. This command will return the details of the specified Bigtable instance.

4. Check the timestamp granularity: In the output of the previous command, look for the `timestampGranularity` field. If the value of this field is not `MILLIS`, then the Bigtable cluster tables do not have timestamp granularity set to 1ms.

Please note that the Google Cloud CLI does not currently support checking the timestamp granularity of Bigtable cluster tables directly. You may need to use the Google Cloud Console or the Google Cloud Client Libraries to check this setting.

#### Using Python

1. Install Google Cloud SDK and Python Client for Google Bigtable: Before you start, make sure you have Google Cloud SDK and Python Client for Google Bigtable installed on your system. You can install the Python client using pip:

   ```bash
   pip install --upgrade google-cloud-bigtable
   ```

2. Import the necessary modules and set up the client: You will need to import the `google.cloud.bigtable` module and set up the client using your project ID and instance ID.

   ```python
   from google.cloud import bigtable
   client = bigtable.Client(project='my-project-id', admin=True)
   instance = client.instance('my-instance-id')
   ```

3. Get the list of tables and check the timestamp granularity: You can get the list of tables in your Bigtable instance using the `list_tables()` method. Then, for each table, you can check the timestamp granularity using the `table.time_granularity` attribute. If the granularity is not set to `bigtable.Table.TimestampGranularity.MILLIS`, then the table is misconfigured.

   ```python
   for table in instance.list_tables():
       if table.time_granularity != bigtable.Table.TimestampGranularity.MILLIS:
           print(f'Table {table.table_id} is misconfigured.')
   ```

4. Run the script: Finally, you can run the script to detect any misconfigurations. If any tables are misconfigured, their IDs will be printed to the console. If no tables are misconfigured, the script will not output anything.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Bigtable Cluster Tables should have timestamp granularity set to 1ms in GCP using GCP console, follow these steps:

1. Open the GCP console and navigate to the Cloud Bigtable section.

2. Select the Bigtable instance that you want to remediate.

3. In the left navigation pane, click on the "Tables" option.

4. Select the table that you want to remediate and click on the "Edit" button.

5. Scroll down to the "Column families" section and click on the column family that contains the timestamp column.

6. In the "Column family" settings, set the "Timestamp granularity" to "Milliseconds".

7. Click on the "Save" button to apply the changes.

8. Repeat steps 4-7 for all the tables in the Bigtable instance that have timestamp columns.

By following these steps, you will remediate the misconfiguration of Bigtable Cluster Tables should have timestamp granularity set to 1ms in GCP using GCP console.

#### Using CLI

To remediate the misconfiguration of Bigtable Cluster Tables having timestamp granularity set to 1ms in GCP using GCP CLI, follow these steps:

1. Open the terminal and ensure that you have the latest version of the Google Cloud SDK installed.

2. Authenticate yourself with the GCP CLI by running the following command:

```
gcloud auth login
```

3. Set the default project for the CLI by running the following command:

```
gcloud config set project PROJECT_ID
```

Replace `PROJECT_ID` with the ID of the project where your Bigtable Cluster is located.

4. Run the following command to update the timestamp granularity of your Bigtable Cluster:

```
gcloud bigtable clusters update CLUSTER_NAME --cluster-id=CLUSTER_ID --instance=INSTANCE_NAME --timestamp-granularity=ms
```

Replace `CLUSTER_NAME`, `CLUSTER_ID`, and `INSTANCE_NAME` with the respective names of your Bigtable Cluster, Cluster ID, and Instance.

5. Verify that the timestamp granularity has been set to 1ms by running the following command:

```
gcloud bigtable clusters describe CLUSTER_NAME --cluster-id=CLUSTER_ID --instance=INSTANCE_NAME
```

This command will display the details of your Bigtable Cluster, including the timestamp granularity.

By following these steps, you can remediate the misconfiguration of Bigtable Cluster Tables having timestamp granularity set to 1ms in GCP using GCP CLI.

#### Using Python

To remediate the Bigtable Cluster Tables Timestamp Granularity issue in GCP using Python, you can follow these steps:

1. Install the `google-cloud-bigtable` library using pip:

```
pip install google-cloud-bigtable
```

2. Import the required libraries:

```python
from google.cloud import bigtable
from google.cloud.bigtable import column_family
```

3. Create a `bigtable.Client` object and a `bigtable.Table` object:

```python
client = bigtable.Client(project=<project_id>, admin=True)
table = client.table('<instance_id>', '<table_id>')
```

4. Get the column family and update the timestamp granularity:

```python
column_family_id = '<column_family_id>'
column_family = column_family.ColumnFamily(column_granularity_millis=1)
table.column_family(column_family_id).modify_column_family(column_family)
```

5. Confirm that the column family has been updated:

```python
column_families = table.list_column_families()
for column_family_id, column_family in column_families.items():
    print('Column Family:', column_family_id)
    print('Timestamp Granularity:', column_family.column_granularity_millis)
```

This should remediate the Bigtable Cluster Tables Timestamp Granularity issue in GCP using Python.


</Tab>
</Tabs>