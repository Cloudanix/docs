---
slug: service_limits
title: Total Resources Should Be Under Per Account Limit
sidebar_label: Total Resources Should Be Under Per Account Limit
---

### More Info:

Determines if the number of resources is close to the per-account limit. Google limits accounts to certain numbers of resources. Exceeding those limits could prevent resources from launching.

### Risk Level

Low

### Address

Operational Maturity

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) Console: Open your web browser, navigate to the GCP Console (console.cloud.google.com) and sign in with your GCP account credentials.

2. Navigate to IAM & Admin: Once you are logged in, click on the navigation menu (three horizontal lines) located at the top left corner of the GCP Console. Scroll down and click on "IAM & Admin".

3. Check Quotas: In the IAM & Admin page, click on "Quotas". This will open a new page where you can see all the quotas for your GCP account. Quotas are the limits on resource usage set by Google Cloud. 

4. Review Compute Engine API Quotas: In the Quotas page, filter by "Compute Engine API" to see the quotas related to Compute Engine resources. Here, you can see the total resources used and the limit per account. If the used resources are close to or have reached the limit, it indicates a misconfiguration.

#### Using CLI

1. Install and authenticate Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can do this by running the following commands:

   ```
   curl https://sdk.cloud.google.com | bash
   exec -l $SHELL
   gcloud init
   ```

2. List all the compute instances: Once you have the Google Cloud SDK installed and authenticated, you can list all the compute instances in your project by running the following command:

   ```
   gcloud compute instances list
   ```

3. Count the total number of instances: The above command will return a list of all the compute instances in your project. You can count the total number of instances by piping the output to the `wc -l` command:

   ```
   gcloud compute instances list | wc -l
   ```

4. Compare with the limit: Finally, you need to compare the total number of instances with the per account limit. The limit varies depending on the type of account and the region, but you can check the current limit for your account by running the following command:

   ```
   gcloud compute project-info describe --project [YOUR_PROJECT_ID]
   ```

   Look for the `quotas` section in the output to find the current limit for compute instances. If the total number of instances is close to or exceeds the limit, you have a misconfiguration.

#### Using Python

1. AWS:
   - Install and configure AWS CLI and Boto3 Python SDK.
   - Use the following Python script to check the total resources under per account limit in EC2:

```python
import boto3

def check_ec2_limit():
    client = boto3.client('ec2')
    response = client.describe_account_attributes(AttributeNames=['max-instances'])
    print(response['AccountAttributes'][0]['AttributeValues'][0]['AttributeValue'])

check_ec2_limit()
```

2. Azure:
   - Install and configure Azure CLI and Azure Python SDK.
   - Use the following Python script to check the total resources under per account limit in Azure Compute:

```python
from azure.mgmt.compute import ComputeManagementClient
from azure.identity import DefaultAzureCredential

def check_azure_limit():
    credential = DefaultAzureCredential()
    subscription_id = 'your-subscription-id'
    compute_client = ComputeManagementClient(credential, subscription_id)
    usage = compute_client.usages.list('your-location')
    for usage in usage:
        print(usage)

check_azure_limit()
```

3. GCP:
   - Install and configure Google Cloud SDK and Google Cloud Python SDK.
   - Use the following Python script to check the total resources under per account limit in Compute Engine:

```python
from google.cloud import compute_v1

def check_gcp_limit():
    client = compute_v1.QuotasClient()
    project_id = 'your-project-id'
    region = 'your-region'
    response = client.list(project=project_id, region=region)
    for quota in response:
        print(quota)

check_gcp_limit()
```

Remember to replace 'your-subscription-id', 'your-location', 'your-project-id', and 'your-region' with your actual Azure subscription ID, Azure location, GCP project ID, and GCP region respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Total Resources Should Be Under Per Account Limit" misconfiguration for GCP using the GCP console, follow these steps:

1. Log in to the GCP console and navigate to the "IAM & Admin" section.

2. Click on "Quotas" in the left-hand menu.

3. In the "Quotas" page, select the quota that is causing the misconfiguration and click on the "Edit Quotas" button.

4. In the "Edit Quotas" page, adjust the quota to a value that is under the per account limit.

5. Click on the "Submit Request" button to submit the change request.

6. Wait for the change request to be reviewed and approved by Google. You can check the status of the request in the "Quotas" page.

7. Once the request is approved, the quota will be updated and the misconfiguration will be remediated.

Note: If the misconfiguration is caused by multiple quotas, you will need to repeat the above steps for each quota until all the quotas are under the per account limit.

#### Using CLI

To remediate the "Total Resources Should Be Under Per Account Limit" misconfiguration in GCP using GCP CLI, follow these steps:

1. Determine the current usage and limits of your GCP account using the following command:
```
gcloud compute project-info describe
```

2. Review the output of the command and identify the resource that is causing the account limit to be exceeded. For example, if the output shows that the number of VM instances exceeds the account limit, you will need to reduce the number of VM instances.

3. To reduce the number of VM instances, you can delete instances that are no longer needed using the following command:
```
gcloud compute instances delete INSTANCE_NAME
```
Replace `INSTANCE_NAME` with the name of the instance that you want to delete.

4. Alternatively, you can stop instances that are not currently in use using the following command:
```
gcloud compute instances stop INSTANCE_NAME
```
Replace `INSTANCE_NAME` with the name of the instance that you want to stop.

5. Repeat steps 3 and 4 until the number of VM instances is within the account limit.

6. Verify that the account limit is no longer being exceeded by running the following command:
```
gcloud compute project-info describe
```

7. Review the output of the command and ensure that the resource usage is within the account limit. If the limit is still being exceeded, repeat steps 3-6 until the limit is no longer exceeded.

By following these steps, you can remediate the "Total Resources Should Be Under Per Account Limit" misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Total Resources Should Be Under Per Account Limit" in GCP using Python, follow these steps:

1. Determine the current usage of resources in your GCP account by using the Cloud Resource Manager API. You can use the following Python code to get the current usage:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials

# Set up credentials
credentials = GoogleCredentials.get_application_default()

# Set up the Cloud Resource Manager API client
crm_client = discovery.build('cloudresourcemanager', 'v1', credentials=credentials)

# Get the current usage of resources
response = crm_client.projects().get(projectId='YOUR_PROJECT_ID').execute()
usage = response['projectNumber']
```

Replace `YOUR_PROJECT_ID` with the ID of your GCP project.

2. Determine the per account limit for the resources that you are using. You can find the per account limit for each resource in the GCP documentation.

3. Compare the current usage of resources with the per account limit. If the current usage exceeds the per account limit, you will need to take action to reduce the usage.

4. To reduce the usage of resources, you can perform the following actions:

- Delete unused resources: Identify any resources that are no longer needed and delete them.
- Resize resources: If you are using resources that have a size limit, such as disk space, you can resize them to reduce the usage.
- Use resource quotas: You can set quotas on your GCP resources to limit the usage. You can use the Cloud Resource Manager API to set quotas.

5. After you have taken action to reduce the usage of resources, re-run the code in step 1 to verify that the current usage is now under the per account limit.

Note: It's important to regularly monitor the usage of your GCP resources to ensure that you are not exceeding the per account limit.


### Additional Reading:



</Tab>
</Tabs>