---
slug: dataflow_job_enable_hotkey_logging_set
title: Dataflow Jobs Hotkey Logging Should Be Enabled
sidebar_label: Dataflow Jobs Hotkey Logging Should Be Enabled
---

### More Info:

Dataflow jobs hot key logging should be enabled

### Risk Level

Low

### Address

Operational Maturity, Reliability

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to Dataflow Jobs: From the main dashboard, click on the navigation menu (three horizontal lines) located at the top left corner of the page. Scroll down and click on "Dataflow" under the "BIG DATA" section. This will take you to the "Dataflow Jobs" page where you can see all your dataflow jobs.

3. Select a Dataflow Job: From the list of dataflow jobs, click on the name of the job you want to check. This will open the job details page.

4. Check Hotkey Logging: On the job details page, look for the "Job info" section. Under this section, check the "Hotkey logging" field. If it is set to "Enabled", then hotkey logging is enabled for the dataflow job. If it is set to "Disabled", then hotkey logging is not enabled for the dataflow job.

#### Using CLI

1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine. You can download it from the official Google Cloud website. After installation, authenticate your account using the command `gcloud auth login`.

2. List all the Dataflow jobs: Use the following command to list all the Dataflow jobs in your project:

   ```
   gcloud dataflow jobs list --region=<region-name>
   ```

   Replace `<region-name>` with the name of the region where your Dataflow jobs are running. This command will return a list of all Dataflow jobs along with their job IDs.

3. Get the details of each job: For each job ID returned in the previous step, use the following command to get the details of the job:

   ```
   gcloud dataflow jobs describe <job-id> --region=<region-name>
   ```

   Replace `<job-id>` with the ID of the job you want to inspect and `<region-name>` with the name of the region where the job is running. This command will return a detailed description of the job.

4. Check for hotkey logging: In the output of the previous command, look for the `hotKeyDetectionEnabled` field. If this field is set to `false`, then hotkey logging is not enabled for the job. If the field is not present, then the job is using the default setting, which is `false`.

#### Using Python

To check if Dataflow Jobs Hotkey Logging is enabled in Google Cloud Platform (GCP) Data Flow using Python scripts, you can use the Google Cloud Client Library for Python. Here are the steps:

1. **Set up the Google Cloud SDK and authenticate your GCP account:**

   Before you can interact with GCP resources using Python, you need to authenticate your account. You can do this by setting up the Google Cloud SDK and running the command `gcloud auth application-default login`.

2. **Install the Google Cloud Client Library for Python:**

   You can install the library using pip by running the command `pip install --upgrade google-cloud-dataflow`.

3. **Import the necessary libraries and initialize the Dataflow service:**

   In your Python script, you need to import the necessary libraries and initialize the Dataflow service. Here's an example:

   ```python
   from google.cloud import dataflow_v1b3 as dataflow

   dataflow_service = dataflow.DataflowV1b3Client()
   ```

4. **Check if Hotkey Logging is enabled for each Dataflow job:**

   You can list all Dataflow jobs and check if Hotkey Logging is enabled for each job. Here's an example:

   ```python
   project_id = 'your-project-id'
   location = 'your-location'

   request = dataflow_service.list_jobs_request(project_id, location=location)
   response = dataflow_service.list_jobs(request)

   for job in response.jobs:
       if 'hotKeyDetectionEnabled' in job.environment and job.environment['hotKeyDetectionEnabled']:
           print(f'Hotkey Logging is enabled for job {job.id}')
       else:
           print(f'Hotkey Logging is not enabled for job {job.id}')
   ```

   This script will print whether Hotkey Logging is enabled for each Dataflow job in the specified project and location.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Dataflow Jobs Hotkey Logging Should Be Enabled" for GCP using GCP console, you can follow the below steps:

1. Open the GCP console and navigate to the Dataflow section.

2. Select the Dataflow job for which you want to enable hotkey logging.

3. Click on the "Edit" button located on the top of the page.

4. Scroll down to the "Additional parameters" section.

5. In the "Additional parameters" section, add the following parameter:

--experiments=enable_hot_key_logging

6. Click on the "Save" button to save the changes.

7. Verify that the hotkey logging is enabled by checking the logs for the Dataflow job.

By following the above steps, you can remediate the misconfiguration "Dataflow Jobs Hotkey Logging Should Be Enabled" for GCP using GCP console.

#### Using CLI

To remediate the "Dataflow Jobs Hotkey Logging Should Be Enabled" misconfiguration in GCP using GCP CLI, you can follow these steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to enable hotkey logging for Dataflow jobs:
```
gcloud config set dataflow/logging_severity "INFO"
```

3. Run the following command to verify that hotkey logging is enabled:
```
gcloud config get-value dataflow/logging_severity
```

4. If the output of the above command is "INFO", then hotkey logging is enabled.

By following these steps, you can remediate the "Dataflow Jobs Hotkey Logging Should Be Enabled" misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the "Dataflow Jobs Hotkey Logging Should Be Enabled" misconfiguration in GCP using Python, you can follow these steps:

1. Import the necessary libraries:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials
```

2. Set up the credentials:

```python
credentials = GoogleCredentials.get_application_default()
service = discovery.build('logging', 'v2', credentials=credentials)
```

3. Define the project ID:

```python
project_id = 'your-project-id'
```

4. Define the log name:

```python
log_name = 'dataflow.googleapis.com%2Fjob_message'
```

5. Define the filter:

```python
filter_str = 'resource.type="dataflow_step" AND severity>=ERROR AND textPayload:"hotkey"'
```

6. Define the sink name:

```python
sink_name = 'hotkey-sink'
```

7. Check if the sink exists:

```python
sinks = service.sinks().list(projectId=project_id).execute()
if sink_name in [sink['name'] for sink in sinks['sinks']]:
    print(f"Sink {sink_name} already exists.")
else:
    print(f"Sink {sink_name} does not exist.")
```

8. If the sink does not exist, create it:

```python
if sink_name not in [sink['name'] for sink in sinks['sinks']]:
    sink = {
        'name': sink_name,
        'destination': f'bigquery.googleapis.com/projects/{project_id}/datasets/hotkey_sink',
        'filter': filter_str,
        'outputVersionFormat': 'V2'
    }
    service.sinks().create(projectId=project_id, body=sink).execute()
    print(f"Sink {sink_name} created.")
```

9. If the sink exists, update it:

```python
else:
    sink_uri = f"projects/{project_id}/sinks/{sink_name}"
    sink = service.sinks().get(sinkName=sink_uri).execute()
    if sink['filter'] == filter_str:
        print(f"Sink {sink_name} already has the correct filter.")
    else:
        sink['filter'] = filter_str
        service.sinks().update(sinkName=sink_uri, body=sink).execute()
        print(f"Sink {sink_name} updated.")
```

10. Verify that the sink has been created or updated:

```python
sinks = service.sinks().list(projectId=project_id).execute()
if sink_name in [sink['name'] for sink in sinks['sinks']]:
    sink_uri = f"projects/{project_id}/sinks/{sink_name}"
    sink = service.sinks().get(sinkName=sink_uri).execute()
    print(f"Sink {sink_name} has filter: {sink['filter']}")
else:
    print(f"Sink {sink_name} not found.")
```

These steps will create or update a sink in GCP that logs hotkeys for Dataflow jobs.




</Tab>
</Tabs>