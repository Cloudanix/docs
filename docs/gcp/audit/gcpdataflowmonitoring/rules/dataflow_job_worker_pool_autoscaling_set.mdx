---
slug: dataflow_job_worker_pool_autoscaling_set
title: Worker Pool Autoscaling Should Be Enabled
sidebar_label: Worker Pool Autoscaling Should Be Enabled
---

### More Info:

Ensure worker pool autoscaling is enabled

### Risk Level

Medium

### Address

Performance Efficiency, Operational Excellence, Reliability, Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (https://console.cloud.google.com/) and sign in with your Google account credentials.

2. Navigate to Dataflow Jobs: From the main dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "Dataflow" under the "Big Data" section. This will take you to the Dataflow Jobs page.

3. Select the Dataflow Job: On the Dataflow Jobs page, you will see a list of all your Dataflow jobs. Click on the name of the job you want to check for Worker Pool Autoscaling.

4. Check Autoscaling Settings: Once you've selected a job, you will be taken to the job details page. Here, look for the "Autoscaling" section. If Autoscaling is enabled, it will say "Autoscaling: Enabled". If it is not enabled, it will say "Autoscaling: Disabled".

#### Using CLI

1. Install and configure the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions provided there.

2. Once the SDK is installed and configured, open your terminal or command prompt and run the following command to list all the dataflow jobs in your project:

   ```
   gcloud dataflow jobs list --project=YOUR_PROJECT_ID
   ```
   Replace `YOUR_PROJECT_ID` with your actual Google Cloud project ID.

3. For each job listed, run the following command to get the details of the job:

   ```
   gcloud dataflow jobs describe JOB_ID --project=YOUR_PROJECT_ID
   ```
   Replace `JOB_ID` with the ID of the job you want to inspect and `YOUR_PROJECT_ID` with your actual Google Cloud project ID.

4. In the output of the above command, look for the `autoscalingSettings` field. If the `algorithm` field under `autoscalingSettings` is set to `NONE` or if the `autoscalingSettings` field is missing, then autoscaling is not enabled for that job.

#### Using Python

To check if Worker Pool Autoscaling is enabled in Google Cloud Dataflow using Python scripts, you can use the Google Cloud SDK (gcloud) or the Google Cloud Client Libraries. Here are the steps:

1. **Set up Google Cloud SDK and Python Environment:**
   First, you need to install and initialize the Google Cloud SDK on your local machine. Also, make sure Python is installed and set up properly. You can install the Google Cloud Client Libraries for Python using pip:

   ```bash
   pip install --upgrade google-cloud-dataflow
   ```

2. **Authenticate and Set Project:**
   Authenticate your SDK using the command `gcloud auth application-default login` and set your project using `gcloud config set project [PROJECT_ID]`.

3. **Python Script to List Dataflow Jobs:**
   Use the Dataflow client library to list all Dataflow jobs and their details. Here is a sample script:

   ```python
   from google.cloud import dataflow

   def list_jobs(project_id):
       client = dataflow.DataflowClient()
       jobs = client.list_jobs(project_id=project_id)
       for job in jobs:
           print(f"Job ID: {job.id}, Job Name: {job.name}, Autoscaling State: {job.autoscaling_state}")
   
   list_jobs("[PROJECT_ID]")
   ```

4. **Check Autoscaling State:**
   In the output of the above script, check the `autoscaling_state` of each job. If the `autoscaling_state` is `AUTOSCALING_STATE_NONE`, it means that autoscaling is not enabled for that job.

Please replace `[PROJECT_ID]` with your actual project ID. This script will list all the Dataflow jobs in the specified project along with their autoscaling state.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Worker Pool Autoscaling Should Be Enabled" in GCP using GCP console, follow these steps:

1. Open the GCP console and select the appropriate project.

2. Navigate to the Kubernetes Engine by selecting Kubernetes Engine from the left-hand side menu.

3. Select the cluster that needs to be remediated.

4. Click on the Edit button at the top of the page.

5. Scroll down to the Node Pools section and click on the node pool that needs remediation.

6. In the node pool settings, scroll down to the Autoscaling section.

7. Toggle the button next to "Enable autoscaling" to the "On" position.

8. Set the minimum and maximum number of nodes. It is recommended to set the minimum number of nodes to 1 and the maximum number of nodes based on the workload requirements.

9. Click on the Save button to apply the changes.

With these steps, the "Worker Pool Autoscaling Should Be Enabled" misconfiguration in GCP using GCP console has been remediated.

#### Using CLI

To remediate the misconfiguration "Worker Pool Autoscaling Should Be Enabled" for GCP using GCP CLI, you can follow the below steps:

1. Open the Cloud Shell in GCP Console.
2. Run the command `gcloud container clusters list` to list all the clusters available in your project.
3. Find the name of the cluster for which you want to enable the worker pool autoscaling.
4. Run the command `gcloud container clusters update CLUSTER_NAME --enable-autoscaling --min-nodes=1 --max-nodes=10 --num-nodes=3` to enable the worker pool autoscaling for the cluster.
   * Replace `CLUSTER_NAME` with the name of your cluster.
   * `--enable-autoscaling` enables the autoscaling feature.
   * `--min-nodes=1` sets the minimum number of nodes to 1.
   * `--max-nodes=10` sets the maximum number of nodes to 10.
   * `--num-nodes=3` sets the initial number of nodes to 3.
5. Verify the autoscaling feature is enabled by running the command `gcloud container clusters describe CLUSTER_NAME`.
6. Check the output of the above command and ensure that the `autoscaling` field is set to `enabled`.

These steps will enable the worker pool autoscaling for the specified cluster in GCP, and remediate the misconfiguration "Worker Pool Autoscaling Should Be Enabled".

#### Using Python

To remediate the misconfiguration "Worker Pool Autoscaling Should Be Enabled" for GCP using Python, you can follow the below steps:

1. First, you need to create an instance group for your worker nodes. You can use the following code to create an instance group:

```
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials

credentials = GoogleCredentials.get_application_default()
compute = discovery.build('compute', 'v1', credentials=credentials)

project = 'your-project-id'
zone = 'us-central1-a'
name = 'instance-group-name'
size = 3
image_response = compute.images().getFromFamily(
    project='ubuntu-os-cloud', family='ubuntu-1804-lts').execute()
source_disk_image = image_response['selfLink']
machine_type = "n1-standard-1"
config = {
    'name': name,
    'instanceTemplate': f"projects/{project}/global/instanceTemplates/instance-template-name",
    'targetSize': size,
    'autoHealingPolicies': [
        {
            "healthCheck": "projects/{project}/global/healthChecks/health-check-name",
            "initialDelaySec": 300,
            "autoHealingPolicyMode": "RECREATE_INSTANCE"
        }
    ]
}
request = compute.instanceGroupManagers().insert(
    project=project,
    zone=zone,
    body=config)
response = request.execute()
```

2. Next, you need to enable autoscaling for your instance group. You can use the following code to enable autoscaling:

```
autoscaler_config = {
    'name': 'autoscaler-name',
    'target': f"projects/{project}/zones/{zone}/instanceGroupManagers/{name}",
    'autoscalingPolicy': {
        'minNumReplicas': 1,
        'maxNumReplicas': 10,
        'coolDownPeriodSec': 60,
        'cpuUtilization': {
            'utilizationTarget': 0.6,
        }
    }
}
autoscaler_request = compute.autoscalers().insert(
    project=project,
    zone=zone,
    body=autoscaler_config)
autoscaler_response = autoscaler_request.execute()
```

3. Finally, you need to verify that autoscaling is enabled for your instance group. You can use the following code to check the status of your autoscaler:

```
autoscaler_name = 'autoscaler-name'
autoscaler_request = compute.autoscalers().get(
    project=project,
    zone=zone,
    autoscaler=autoscaler_name)
autoscaler_response = autoscaler_request.execute()
print(autoscaler_response)
```

This should remediate the misconfiguration "Worker Pool Autoscaling Should Be Enabled" for GCP using Python.




</Tab>
</Tabs>