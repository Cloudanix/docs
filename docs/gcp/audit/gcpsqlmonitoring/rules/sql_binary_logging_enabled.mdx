---
slug: sql_binary_logging_enabled
title: SQL Instances Should Have Binary Logging Enabled
sidebar_label: SQL Instances Should Have Binary Logging Enabled
---

### More Info:

Ensure that SQL Instances have Binary Logging Enabled that maintains all the Update statements of the Database to help in recovery.

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

HITRUST, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to SQL Instances: From the left-hand side menu, select "SQL" under the "Storage" section. This will display a list of all SQL instances in your GCP project.

3. Select the SQL Instance: Click on the name of the SQL instance you want to check for binary logging. This will open the instance details page.

4. Check Binary Logging Status: On the instance details page, scroll down to the "Flags" section. Look for the "log_bin" flag. If the flag is set to "ON", then binary logging is enabled. If it's set to "OFF" or if the flag is not present, then binary logging is not enabled for that SQL instance.

#### Using CLI

1. Install and configure Google Cloud SDK: Before you can use the GCP CLI, you need to install the Google Cloud SDK on your local machine. You can download it from the official Google Cloud website. After installation, authenticate your account using the command `gcloud auth login`.

2. List all SQL instances: Use the following command to list all SQL instances in your project:

   ```
   gcloud sql instances list
   ```

   This command will return a list of all SQL instances, including their instance ID, project ID, region, and other details.

3. Get the details of each SQL instance: For each SQL instance, use the following command to get its details:

   ```
   gcloud sql instances describe [INSTANCE_NAME]
   ```

   Replace `[INSTANCE_NAME]` with the name of your SQL instance. This command will return a detailed description of the SQL instance, including its configuration.

4. Check if binary logging is enabled: In the output of the previous command, look for the `settings` field. Under this field, check the `databaseFlags` field. If binary logging is enabled, you should see a flag named `log_bin` with a value of `ON`. If this flag is not present or its value is `OFF`, then binary logging is not enabled for this SQL instance.

#### Using Python

1. Install the necessary Python libraries: Before you can start, you need to install the Google Cloud SDK and the Python client library for Google Cloud SQL. You can do this using pip:

   ```bash
   pip install --upgrade google-cloud-sdk
   pip install --upgrade google-cloud-sql
   ```

2. Authenticate your SDK: Use the `gcloud auth application-default login` command to authenticate your SDK. This will open a new browser window where you can log in with your Google Cloud credentials.

3. Write a Python script to check for binary logging: The following script will list all your SQL instances and check if binary logging is enabled:

   ```python
   from google.cloud import sql
   from google.cloud.sql import instances

   # Create a client
   client = sql.SqlAdminServiceClient()

   # List all SQL instances
   for instance in client.list_instances(project='your-project-id'):
       # Get the instance details
       instance_details = instances.get(project='your-project-id', instance=instance.name)

       # Check if binary logging is enabled
       if not instance_details.settings.backupConfiguration.binaryLogEnabled:
           print(f"Binary logging is not enabled for instance {instance.name}")
   ```

4. Run the script: You can run the script using the Python interpreter. If any instances are found where binary logging is not enabled, they will be printed to the console.

   ```bash
   python check_binary_logging.py
   ```

Remember to replace 'your-project-id' with your actual Google Cloud project ID.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue "SQL Instances Should Have Binary Logging Enabled" for GCP using GCP console, you can follow the below steps:

1. Login to the Google Cloud Console.
2. In the Navigation menu, select "SQL" under the "DATABASES" section.
3. Select the instance for which you want to enable binary logging.
4. Click on the "Edit" button at the top of the page.
5. Scroll down to the "Configuration options" section.
6. Under the "Replication" tab, select "Enable binary logging".
7. Click on the "Save" button at the bottom of the page.

Once the above steps are completed, binary logging will be enabled for the selected SQL instance in GCP.

#### Using CLI

To remediate the misconfiguration "SQL Instances Should Have Binary Logging Enabled" for GCP using GCP CLI, please follow the below steps:

1. Open the Cloud Shell in GCP console.

2. Run the following command to list all the SQL instances in your project:

```
gcloud sql instances list
```

3. Identify the SQL instance for which you want to enable binary logging.

4. Run the following command to enable binary logging for the identified SQL instance:

```
gcloud sql instances patch INSTANCE_NAME --enable-bin-log
```

Replace `INSTANCE_NAME` with the name of the SQL instance for which you want to enable binary logging.

5. Verify that binary logging is enabled for the SQL instance by running the following command:

```
gcloud sql instances describe INSTANCE_NAME
```

This command will display the configuration details of the SQL instance, including the binary logging status.

6. Repeat the above steps for all the SQL instances in your project to ensure that binary logging is enabled for all of them.

By following these steps, you can remediate the misconfiguration "SQL Instances Should Have Binary Logging Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "SQL Instances Should Have Binary Logging Enabled" for GCP using Python, you can follow the below steps:

1. First, you need to enable binary logging for the Cloud SQL instance. You can use the Cloud SQL Admin API to enable binary logging. Use the following code to enable binary logging for the Cloud SQL instance:

```python
from googleapiclient import discovery
from oauth2client.client import GoogleCredentials

# Set the project ID and instance name
project_id = 'YOUR_PROJECT_ID'
instance_name = 'YOUR_INSTANCE_NAME'

# Authenticate and construct the service object
credentials = GoogleCredentials.get_application_default()
service = discovery.build('sqladmin', 'v1beta4', credentials=credentials)

# Enable binary logging for the Cloud SQL instance
request = service.instances().patch(
    project=project_id,
    instance=instance_name,
    body={
        'settings': {
            'settingsVersion': '1',
            'databaseFlags': [
                {
                    'name': 'binlog_enabled',
                    'value': 'on'
                }
            ]
        }
    }
)
response = request.execute()
```

2. Once you have enabled binary logging for the Cloud SQL instance, you need to verify that it has been enabled. You can use the following code to verify that binary logging has been enabled:

```python
# Get the Cloud SQL instance details
request = service.instances().get(
    project=project_id,
    instance=instance_name
)
response = request.execute()

# Check if binary logging is enabled
if 'databaseFlags' in response['settings']:
    for flag in response['settings']['databaseFlags']:
        if flag['name'] == 'binlog_enabled' and flag['value'] == 'on':
            print('Binary logging is enabled for the Cloud SQL instance.')
            break
else:
    print('Binary logging is not enabled for the Cloud SQL instance.')
```

3. Finally, you need to automate the remediation process so that it can be applied to multiple Cloud SQL instances. You can use the following code to retrieve a list of Cloud SQL instances and enable binary logging for each one:

```python
# Get a list of Cloud SQL instances
request = service.instances().list(project=project_id)
response = request.execute()

# Loop through each Cloud SQL instance and enable binary logging
for instance in response['items']:
    instance_name = instance['name']
    request = service.instances().patch(
        project=project_id,
        instance=instance_name,
        body={
            'settings': {
                'settingsVersion': '1',
                'databaseFlags': [
                    {
                        'name': 'binlog_enabled',
                        'value': 'on'
                    }
                ]
            }
        }
    )
    response = request.execute()
```

Note: Before executing the above code, make sure to replace `YOUR_PROJECT_ID` and `YOUR_INSTANCE_NAME` with your actual project ID and Cloud SQL instance name, respectively.




</Tab>
</Tabs>