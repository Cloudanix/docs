---
slug: sql_free_storage_space
title: SQL Instances should have Storage Auto Resize Enabled
sidebar_label: SQL Instances should have Storage Auto Resize Enabled
---

### More Info:

Ensure that SQL Instances are have storageAutoResize set to True

### Risk Level

Medium

### Address

Performance Efficiency

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your Google Cloud Platform (GCP) console.

2. Navigate to the SQL section: On the main dashboard, click on the hamburger menu (three horizontal lines) on the top left corner. Scroll down and click on "SQL" under the "Storage" section.

3. Once you are in the SQL section, you will see a list of all your SQL instances. Click on the instance you want to check.

4. In the instance details page, click on the "EDIT" button. Scroll down to the "Flags" section. Here, you should see a flag named "storage_auto_resize". If it is set to "ON", then Storage Auto Resize is enabled. If it is set to "OFF", then it is not enabled.

#### Using CLI

1. Install and authenticate Google Cloud SDK: Before you can start using the GCP CLI, you need to install the Google Cloud SDK on your local machine and authenticate it. You can download the SDK from the official Google Cloud website and follow the instructions to install it. After installation, authenticate the SDK using the command `gcloud auth login`.

2. List all SQL instances: Use the following command to list all SQL instances in your GCP project:

   ```
   gcloud sql instances list
   ```
   This command will return a list of all SQL instances along with their details.

3. Describe each SQL instance: For each SQL instance, use the following command to get detailed information about the instance:

   ```
   gcloud sql instances describe [INSTANCE_NAME]
   ```
   Replace `[INSTANCE_NAME]` with the name of your SQL instance. This command will return a JSON object with detailed information about the SQL instance.

4. Check if Storage Auto Resize is enabled: In the JSON object returned by the describe command, look for the `settings` field and then the `storageAutoResize` field. If the value of `storageAutoResize` is `true`, then Storage Auto Resize is enabled for the SQL instance. If the value is `false` or the field is not present, then Storage Auto Resize is not enabled.

#### Using Python

1. Install the necessary libraries: Before you start, you need to install the Google Cloud SDK and the Python client library for Google Cloud. You can do this using pip:

   ```bash
   pip install --upgrade google-cloud-sdk
   pip install --upgrade google-cloud-sql
   ```

2. Authenticate your SDK: You need to authenticate your Google Cloud SDK with your Google Cloud account. You can do this using the following command:

   ```bash
   gcloud auth application-default login
   ```

3. Write a Python script to list all SQL instances and check if Storage Auto Resize is enabled:

   ```python
   from google.cloud import sql
   client = sql.SqlAdminServiceClient()

   project_id = 'your-project-id'  # replace with your project id

   instances = client.list_instances(project_id)
   for instance in instances:
       settings = instance.settings
       if not settings.storage_auto_resize:
           print(f"Instance {instance.name} does not have Storage Auto Resize enabled.")
   ```

4. Run the script: You can run the script using the Python interpreter. The script will print the names of all SQL instances that do not have Storage Auto Resize enabled.

   ```bash
   python check_storage_auto_resize.py
   ```

Please replace 'your-project-id' with your actual project id. This script will list all the SQL instances which do not have Storage Auto Resize enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the SQL instance storage auto-resize misconfiguration in GCP:

1. Open the Google Cloud Console and navigate to the SQL instances page.
2. Select the SQL instance that needs to be remediated.
3. Click on the "Edit" button at the top of the page.
4. Scroll down to the "Storage" section and click on the "Edit" button next to "Storage autoresize".
5. Toggle the switch to the right to enable storage autoresize.
6. Set the maximum storage size limit, if required.
7. Click on the "Save" button at the bottom of the page to save the changes.

Once the above steps are completed, the SQL instance will have storage autoresize enabled and will automatically increase the storage capacity when required.

#### Using CLI

To remediate the misconfiguration "SQL Instances should have Storage Auto Resize Enabled" for GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell on the Google Cloud Platform Console.

2. Run the following command to list all the SQL instances in your project:

   ```
   gcloud sql instances list
   ```

3. Select the instance that you want to remediate and run the following command to enable storage auto resize for that instance:

   ```
   gcloud sql instances patch INSTANCE_NAME --enable-storage-autoresize
   ```

   Replace `INSTANCE_NAME` with the name of the instance that you want to remediate.

4. Verify that the storage auto resize is enabled for the instance by running the following command:

   ```
   gcloud sql instances describe INSTANCE_NAME | grep storageAutoResize
   ```

   Replace `INSTANCE_NAME` with the name of the instance that you remediated.

   If the output shows `storageAutoResize: true`, then the remediation was successful.

That's it! You have successfully remediated the misconfiguration "SQL Instances should have Storage Auto Resize Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "SQL Instances should have Storage Auto Resize Enabled" for GCP using Python, follow the steps below:

1. Install the `google-cloud-sql` library using pip:
```
pip install google-cloud-sql
```
2. Import the necessary modules:
```
from google.cloud import sql_v1beta4
from google.oauth2 import service_account
```
3. Set up the authentication by creating a service account and downloading the JSON key file. Then, create a `credentials` object using the JSON key file:
```
credentials = service_account.Credentials.from_service_account_file('/path/to/keyfile.json')
```
4. Create a `sql_v1beta4.CloudSqlClient` object using the `credentials` object:
```
client = sql_v1beta4.CloudSqlClient(credentials=credentials)
```
5. Get the list of SQL instances using the `list()` method of the `client.instances()` object:
```
instances = client.instances().list(project='my-project-id', location='us-central1-a').execute()
```
Replace `my-project-id` with your GCP project ID and `us-central1-a` with the location of your SQL instances.
6. Loop through the list of instances and check if the `settings.storageAutoResize` property is set to `True`. If not, enable it using the `patch()` method of the `client.instances()` object:
```
for instance in instances['items']:
    if not instance['settings']['storageAutoResize']:
        instance['settings']['storageAutoResize'] = True
        operation = client.instances().patch(project='my-project-id', instance=instance['name'], body=instance).execute()
        print(f"Enabled storage auto resize for instance {instance['name']}. Operation ID: {operation['name']}")
```
Replace `my-project-id` with your GCP project ID.

This code will enable storage auto resize for all SQL instances in the specified project and location that do not already have it enabled.




</Tab>
</Tabs>