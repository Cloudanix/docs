---
slug: database_ssl_enabled
title: Databases Should Have SSL
sidebar_label: Databases Should Have SSL
---

### More Info:

Ensures SQL databases have SSL enabled. Enabling SSL ensures that the sensitive data being transferred from the database is encrypted.

### Risk Level

High

### Address

Security

### Compliance Standards

CISGCP, CBP, HITRUST, NISTCSF, SOC2, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform web console and sign in with your Google account credentials.

2. Navigate to SQL Instances: From the main dashboard, click on the navigation menu (three horizontal lines in the upper left-hand corner). Scroll down and click on "SQL" under the "Storage" section. This will take you to the SQL instances page where you can see all your SQL databases.

3. Select the SQL Instance: Click on the name of the SQL instance you want to check. This will take you to the instance details page.

4. Check SSL Configuration: On the instance details page, click on the "Connections" tab. Here, you can see the SSL configuration for the selected SQL instance. If "SSL connections" is set to "Required", then SSL is enabled. If it is set to "Optional" or "Disabled", then SSL is not required for connections to the database, indicating a potential misconfiguration.

#### Using CLI

1. Install and configure Google Cloud SDK on your local machine. This will provide you with the necessary command-line tools to interact with resources hosted on Google Cloud Platform (GCP). You can install it using the following command:

   ```
   curl https://sdk.cloud.google.com | bash
   exec -l $SHELL
   gcloud init
   ```

2. Once the SDK is installed and configured, you can use the `gcloud` command-line tool to interact with GCP resources. To list all the SQL instances in your project, use the following command:

   ```
   gcloud sql instances list
   ```

3. To check the SSL configuration of a specific SQL instance, use the following command:

   ```
   gcloud sql instances describe [INSTANCE_NAME]
   ```

   Replace `[INSTANCE_NAME]` with the name of your SQL instance. This command will output a lot of information about the instance, including its SSL configuration.

4. To specifically check if SSL is enabled for the instance, you can filter the output of the previous command using the `grep` command:

   ```
   gcloud sql instances describe [INSTANCE_NAME] | grep ssl
   ```

   If SSL is enabled, this command will output a line that includes "ssl: true". If SSL is not enabled, this command will output a line that includes "ssl: false".

#### Using Python

1. **Import Required Libraries**: The first step is to import the required libraries. We will need the `boto3` library for AWS, `azure.mgmt.sql` for Azure, and `google.cloud.sql` for GCP. These libraries allow us to interact with the respective cloud services.

    ```python
    import boto3
    from azure.mgmt.sql import SqlManagementClient
    from google.cloud import sql
    ```

2. **Create a Client**: The next step is to create a client for the respective cloud service. This client will be used to interact with the cloud service.

    For AWS:
    ```python
    client = boto3.client('rds')
    ```

    For Azure:
    ```python
    credentials = ServicePrincipalCredentials(client_id='your_client_id', secret='your_secret', tenant='your_tenant_id')
    sql_client = SqlManagementClient(credentials, 'your_subscription_id')
    ```

    For GCP:
    ```python
    client = sql.SqlInstancesServiceClient()
    ```

3. **Fetch Database Instances**: Now, we fetch all the database instances and check if SSL is enabled or not.

    For AWS:
    ```python
    response = client.describe_db_instances()
    for instance in response['DBInstances']:
        if not instance['StorageEncrypted']:
            print(f"SSL is not enabled for {instance['DBInstanceIdentifier']}")
    ```

    For Azure:
    ```python
    for server in sql_client.servers.list():
        server_name = server.name
        for database in sql_client.databases.list_by_server('your_resource_group', server_name):
            if not database.ssl_enforcement == 'Enabled':
                print(f"SSL is not enabled for {database.name}")
    ```

    For GCP:
    ```python
    instances = client.list(parent='your_project_id')
    for instance in instances:
        settings = instance.settings
        if not settings.ip_configuration.require_ssl:
            print(f"SSL is not enabled for {instance.name}")
    ```

4. **Run the Script**: Finally, run the script. If there are any databases where SSL is not enabled, it will print out the name of the database. This way, you can easily detect if SSL is enabled for all databases or not.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Databases should have SSL" for GCP using GCP console, follow the below steps:

1. Open the GCP Console and navigate to the Cloud SQL Instances page.
2. Select the instance that you want to configure SSL for.
3. Click on the "Edit" button at the top of the page.
4. Scroll down to the "SSL" section and click on the "Show Configuration Options" button.
5. Select the option "Server-ca.pem" for "Server Certificate" and "Client-cert.pem" for "Client Certificate".
6. Click on the "Save" button to apply the changes.

After following the above steps, SSL will be enabled for the selected instance in GCP.

#### Using CLI

To remediate the misconfiguration "Databases Should Have SSL" for GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to list all the Cloud SQL instances in your project:

```
gcloud sql instances list
```

3. Identify the instance that needs to be remediated and note down its name.

4. Run the following command to enable SSL for the Cloud SQL instance:

```
gcloud sql instances patch [INSTANCE_NAME] --require-ssl
```

Replace [INSTANCE_NAME] with the name of your Cloud SQL instance.

5. Verify that SSL is enabled for the Cloud SQL instance by running the following command:

```
gcloud sql instances describe [INSTANCE_NAME] | grep requireSsl
```

Replace [INSTANCE_NAME] with the name of your Cloud SQL instance.

6. If the output of the above command shows "requireSsl: true", then SSL has been successfully enabled for the Cloud SQL instance.

7. Repeat the above steps for all the Cloud SQL instances in your project that need to have SSL enabled.

By following the above steps, you can remediate the misconfiguration "Databases Should Have SSL" for GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration of databases not having SSL in GCP using Python, you can follow the below steps:

1. First, connect to the Cloud SQL instance using the Cloud SQL Admin API and authenticate using the Google Application Default Credentials (ADC).

```python
from google.oauth2 import service_account
from googleapiclient.discovery import build
from googleapiclient.errors import HttpError

# Authenticate using ADC
credentials = service_account.Credentials.from_service_account_file(
    '/path/to/adc.json')

# Connect to Cloud SQL Admin API
service = build('sqladmin', 'v1beta4', credentials=credentials)
```

2. Next, retrieve the current instance settings using the `instances().get()` method.

```python
# Get current instance settings
instance = service.instances().get(project='my-project', instance='my-instance').execute()
```

3. Check if SSL is enabled for the instance. If not, enable it using the `settings().update()` method.

```python
# Check if SSL is enabled
if not instance['settings']['ipConfiguration']['requireSsl']:
    # Enable SSL
    instance['settings']['ipConfiguration']['requireSsl'] = True
    request = service.instances().update(project='my-project', instance='my-instance', body=instance)
    response = request.execute()
```

4. Finally, verify that SSL is enabled by checking the `requireSsl` property of the instance settings.

```python
# Verify SSL is enabled
if instance['settings']['ipConfiguration']['requireSsl']:
    print('SSL is enabled for the instance.')
else:
    print('Failed to enable SSL for the instance.')
```

By following the above steps, you can remediate the misconfiguration of databases not having SSL in GCP using Python.


### Additional Reading:

- [https://cloud.google.com/sql/docs/mysql/instance-settings](https://cloud.google.com/sql/docs/mysql/instance-settings) 


</Tab>
</Tabs>