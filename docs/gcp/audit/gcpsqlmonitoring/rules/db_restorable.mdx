---
slug: db_restorable
title: Point In Time Restore Should Be Enabled
sidebar_label: Point In Time Restore Should Be Enabled
---

### More Info:

Ensures SQL instances can be restored to a recent point. GCP will maintain a point to which the database can be restored. This point should not drift too far into the past, or else the risk of irrecoverable data loss may occur.

### Risk Level

High

### Address

Security, Reliability

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com) and sign in with your Google account credentials.

2. Navigate to SQL Instances: From the left-hand side menu, select "SQL" under the "Storage" section. This will display a list of all SQL instances in your GCP project.

3. Select the SQL Instance: Click on the name of the SQL instance for which you want to check if Point In Time Restore is enabled.

4. Check Backup Configuration: In the instance details page, navigate to the "Backups" section. Here, you can see if the "Automated backups" and "Point-in-time recovery" options are enabled. If they are enabled, you will see the status as "ON". If not, the status will be "OFF".

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI on your local machine. You can download it from the official Google Cloud website and follow the instructions for your specific operating system. Once installed, authenticate it using the following command:

   ```
   gcloud auth login
   ```

2. Set your project ID to the project you want to check. Replace `your-project-id` with your actual project ID:

   ```
   gcloud config set project your-project-id
   ```

3. List all the SQL instances in your project using the following command:

   ```
   gcloud sql instances list
   ```

4. For each instance, check if Point In Time Restore is enabled. Replace `your-instance-id` with your actual instance ID:

   ```
   gcloud sql instances describe your-instance-id
   ```

   In the output, look for the `backupConfiguration` section. If `enabled` is `true` and `binaryLogEnabled` is `true`, then Point In Time Restore is enabled. If not, then it is not enabled.

#### Using Python

To check if Point In Time Restore is enabled in SQL using Python scripts, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: If you haven't installed it yet, you can install it using pip:
   ```
   pip install azure-mgmt-sql
   ```
2. **Import Required Libraries**: Import the necessary libraries into your Python script:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.sql import SqlManagementClient
   ```
3. **Authenticate and Initialize**: Authenticate using Azure AD credentials and initialize the SQL Management Client:
   ```python
   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'  # replace with your Azure Subscription ID
   sql_client = SqlManagementClient(credential, subscription_id)
   ```
4. **Check Point In Time Restore**: Now, you can check if Point In Time Restore is enabled for each SQL server and database:
   ```python
   for server in sql_client.servers.list():
       for database in sql_client.databases.list(server.name):
           backup_short_term_retention_policy = sql_client.backup_short_term_retention_policies.get(server.name, database.name)
           if backup_short_term_retention_policy.retention_days < 7:
               print(f"Point In Time Restore is not enabled for database {database.name} in server {server.name}")
   ```
In this script, we are checking if the short term retention policy for backups is less than 7 days. If it is, it means Point In Time Restore may not be properly enabled, as it requires at least 7 days of backup to function correctly.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Point In Time Restore Should Be Enabled" misconfiguration in GCP using GCP console, please follow these steps:

1. Login to the GCP console (console.cloud.google.com).
2. Navigate to the Cloud SQL instances page.
3. Select the instance that you want to remediate.
4. Click on the Edit button at the top of the page.
5. Scroll down to the Backup section.
6. Under the Backup Configuration section, select the checkbox for Enable automatic backups.
7. Under the Backup Configuration section, select the checkbox for Enable point-in-time recovery.
8. Set the Backup retention period to the desired value.
9. Click on the Save button at the bottom of the page.

Once you have completed these steps, automatic backups and point-in-time recovery will be enabled for your Cloud SQL instance, and you will have remediated the "Point In Time Restore Should Be Enabled" misconfiguration.

#### Using CLI

To remediate the misconfiguration "Point In Time Restore Should Be Enabled" for GCP using GCP CLI, please follow the below steps:

1. Open the Cloud Shell in the GCP Console.

2. Run the following command to enable point-in-time recovery for all the Cloud SQL instances in the current project:

```
gcloud sql instances patch INSTANCE_NAME --backup-start-time 23:00 --backup-location REGION --enable-point-in-time-recovery
```

Replace INSTANCE_NAME with the name of your Cloud SQL instance and REGION with the region where your instance is located. The --backup-start-time flag specifies the time of day when automated backups should start, and the --enable-point-in-time-recovery flag enables point-in-time recovery.

3. Verify that point-in-time recovery is enabled for the instance by running the following command:

```
gcloud sql instances describe INSTANCE_NAME
```

The output should include the following line:

```
backupConfiguration:
  enabled: true
  pointInTimeRecoveryEnabled: true
```

This indicates that point-in-time recovery is enabled for the instance.

4. Repeat the above steps for all the Cloud SQL instances in your project.

By following the above steps, you should be able to remediate the misconfiguration "Point In Time Restore Should Be Enabled" for GCP using GCP CLI.

#### Using Python

To remediate the "Point In Time Restore Should Be Enabled" misconfiguration in GCP using Python, follow these steps:

1. Import the necessary libraries:

```
from google.cloud import bigquery
from google.cloud.bigquery import enums
from google.cloud.bigquery import table
```

2. Create a BigQuery client object:

```
client = bigquery.Client()
```

3. Get the dataset and table objects:

```
dataset_id = 'your_dataset_id'
table_id = 'your_table_id'
dataset_ref = client.dataset(dataset_id)
table_ref = dataset_ref.table(table_id)
```

4. Get the table metadata:

```
table = client.get_table(table_ref)
```

5. Check if the table has point-in-time recovery enabled:

```
if table.time_partitioning and table.time_partitioning.type == enums.TimePartitioningType.HOUR:
    print('Point-in-time recovery is enabled for the table.')
else:
    print('Point-in-time recovery is not enabled for the table.')
```

6. If point-in-time recovery is not enabled, enable it:

```
if not table.time_partitioning:
    table.time_partitioning = table.TimePartitioning(type_=enums.TimePartitioningType.HOUR)
else:
    table.time_partitioning.type_ = enums.TimePartitioningType.HOUR
table = client.update_table(table, ['time_partitioning'])
print('Point-in-time recovery has been enabled for the table.')
```

7. Verify that point-in-time recovery has been enabled:

```
table = client.get_table(table_ref)
if table.time_partitioning and table.time_partitioning.type == enums.TimePartitioningType.HOUR:
    print('Point-in-time recovery is now enabled for the table.')
else:
    print('Failed to enable point-in-time recovery for the table.')
```

This Python code will enable point-in-time recovery for a BigQuery table in GCP. You can modify it as per your specific requirements.


### Additional Reading:

- [https://cloud.google.com/sql/docs/mysql/instance-settings](https://cloud.google.com/sql/docs/mysql/instance-settings) 


</Tab>
</Tabs>