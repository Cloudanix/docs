---
slug: sql_log_checkpoints_flag
title: PostgreSQL Log Checkpoints Flag Should Be Disabled
sidebar_label: PostgreSQL Log Checkpoints Flag Should Be Disabled
---

### More Info:

Ensure that the log_checkpoints database flag for Cloud SQL PostgreSQL instance is set to on.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, navigate to the Google Cloud Platform Console (console.cloud.google.com), and sign in with your Google account credentials.

2. Navigate to SQL Instances: From the left-hand side menu, select "SQL" under the "Storage" section. This will display a list of all SQL instances in your GCP account.

3. Select the PostgreSQL Instance: From the list of SQL instances, select the PostgreSQL instance you want to check for the Log Checkpoints flag.

4. Check the Flag: Once you've selected the instance, navigate to the "Configuration" tab. Under the "Flags" section, look for the "log_checkpoints" flag. If this flag is enabled, it means that the PostgreSQL Log Checkpoints flag is not disabled.

#### Using CLI

1. First, you need to install and configure the Google Cloud SDK (gcloud CLI) on your local machine. You can download it from the official Google Cloud website and follow the instructions to install and authenticate it.

2. Once the gcloud CLI is installed and configured, you can list all the SQL instances in your GCP project by running the following command:

   ```
   gcloud sql instances list
   ```

   This command will return a list of all SQL instances along with their details.

3. To check the configuration of a specific SQL instance, you can use the following command:

   ```
   gcloud sql instances describe [INSTANCE_NAME]
   ```

   Replace `[INSTANCE_NAME]` with the name of your SQL instance. This command will return the configuration details of the specified SQL instance.

4. In the output of the above command, look for the `settings.databaseFlags` field. If the `log_checkpoints` flag is present and set to `on`, then the PostgreSQL Log Checkpoints flag is enabled. If the `log_checkpoints` flag is not present or set to `off`, then the PostgreSQL Log Checkpoints flag is disabled.

#### Using Python

To check if the PostgreSQL Log Checkpoints flag is disabled in SQL using Python scripts, you can follow these steps:

1. **Connect to PostgreSQL Database:**
   First, you need to connect to your PostgreSQL database. You can use the `psycopg2` library in Python to do this. Here is a sample script:

   ```python
   import psycopg2

   try:
       connection = psycopg2.connect(user="sysadmin",
                                      password="pynative@#29",
                                      host="127.0.0.1",
                                      port="5432",
                                      database="postgres_db")

       cursor = connection.cursor()
       # Print PostgreSQL Connection properties
       print(connection.get_dsn_parameters(), "\n")

   except (Exception, psycopg2.Error) as error:
       print("Error while connecting to PostgreSQL", error)
   ```

2. **Execute SQL Query:**
   After successfully connecting to the database, you can execute a SQL query to check the status of the Log Checkpoints flag. The SQL command to check the status of the Log Checkpoints flag is `SHOW log_checkpoints;`. Here is how you can do it in Python:

   ```python
   cursor.execute("SHOW log_checkpoints;")
   record = cursor.fetchone()
   print("You are connected to - ", record, "\n")
   ```

3. **Check the Status:**
   The `SHOW log_checkpoints;` command will return 'on' if the Log Checkpoints flag is enabled and 'off' if it is disabled. You can check the status in your Python script like this:

   ```python
   if record[0] == 'on':
       print("Log Checkpoints flag is enabled")
   else:
       print("Log Checkpoints flag is disabled")
   ```

4. **Close the Connection:**
   After checking the status, don't forget to close the database connection. You can do it like this:

   ```python
   if(connection):
       cursor.close()
       connection.close()
       print("PostgreSQL connection is closed")
   ```

Remember to replace the database connection parameters with your actual database parameters.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the PostgreSQL Log Checkpoints flag misconfiguration in GCP using the GCP console, follow these steps:

1. Open the GCP console and navigate to the Cloud SQL Instances page.

2. Select the instance that has the PostgreSQL database with the misconfiguration.

3. Click on the "Edit" button on the top of the page.

4. Scroll down to the "Flags" section and click on the "Add item" button.

5. In the "Name" field, enter "log_checkpoints" and in the "Value" field, enter "off".

6. Click on the "Save" button to save the changes.

7. Wait for a few minutes for the changes to take effect.

8. Verify that the PostgreSQL Log Checkpoints flag has been disabled by checking the PostgreSQL logs.

By following these steps, you will have successfully remediated the PostgreSQL Log Checkpoints flag misconfiguration in GCP using the GCP console.

#### Using CLI

To remediate the PostgreSQL Log Checkpoints Flag Should Be Disabled issue in GCP using GCP CLI, follow these steps:

1. Open the Cloud Shell in your GCP console.
2. Run the following command to list all the Cloud SQL instances in your project:
   ```
   gcloud sql instances list
   ```
3. Note down the instance name of the PostgreSQL instance that you want to remediate.
4. Run the following command to update the instance settings:
   ```
   gcloud sql instances patch [INSTANCE_NAME] --database-flags log_checkpoints=off
   ```
   Replace `[INSTANCE_NAME]` with the actual name of your PostgreSQL instance.
5. Wait for a few minutes for the instance settings to be updated.

After following these steps, the PostgreSQL Log Checkpoints Flag will be disabled for your GCP PostgreSQL instance, and the misconfiguration will be remediated.

#### Using Python

To remediate the PostgreSQL Log Checkpoints Flag Should Be Disabled misconfiguration for GCP using Python, you can follow these steps:

1. First, you need to authenticate to your GCP project using the `google-auth` and `google-auth-oauthlib` libraries. You can do this by running the following code:

```
from google.oauth2 import service_account
from google.auth.transport.requests import Request
from googleapiclient.discovery import build

# Replace [PATH_TO_SERVICE_ACCOUNT_KEY] with the path to your service account key file
credentials = service_account.Credentials.from_service_account_file('[PATH_TO_SERVICE_ACCOUNT_KEY]')
project_id = '[YOUR_PROJECT_ID]'

# Authenticate to the Cloud SQL Admin API
service = build('sqladmin', 'v1beta4', credentials=credentials)
```

2. Once you have authenticated, you can use the Cloud SQL Admin API to retrieve the configuration settings for your PostgreSQL instance. You can do this by running the following code:

```
# Replace [INSTANCE_NAME] with the name of your PostgreSQL instance
instance_name = '[INSTANCE_NAME]'

# Retrieve the current configuration settings for the instance
settings = service.instances().get(project=project_id, instance=instance_name).execute()['settings']
```

3. Next, you need to check if the `log_checkpoints` flag is enabled in the configuration settings. You can do this by running the following code:

```
# Check if the log_checkpoints flag is enabled
if 'log_checkpoints' in settings and settings['log_checkpoints'] == True:
    # Disable the log_checkpoints flag
    settings['log_checkpoints'] = False
```

4. Finally, you need to update the configuration settings for the PostgreSQL instance with the new flag settings. You can do this by running the following code:

```
# Update the configuration settings for the instance
request_body = {
    'settings': settings,
    'updateMask': 'settings'
}

# Send the update request to the Cloud SQL Admin API
response = service.instances().patch(project=project_id, instance=instance_name, body=request_body).execute()
```

With these steps, you should be able to remediate the PostgreSQL Log Checkpoints Flag Should Be Disabled misconfiguration for your GCP PostgreSQL instance using Python.




</Tab>
</Tabs>