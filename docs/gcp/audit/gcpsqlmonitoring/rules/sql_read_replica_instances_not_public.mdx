---
slug: sql_read_replica_instances_not_public
title: Read Replica Instances Should Not Be public
sidebar_label: Read Replica Instances Should Not Be public
---

### More Info:

Ensure that Read Replica Instances are not publicly accessible to prevent private data from being exposed.

### Risk Level

High

### Address

Security

### Compliance Standards

HITRUST, GDPR, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Google Cloud Platform Console: Open your web browser, visit the Google Cloud Platform (GCP) Console, and sign in with your Google account that has the necessary permissions to access GCP resources.

2. Navigate to SQL Instances: From the GCP Console dashboard, select the hamburger menu in the upper left-hand corner. Scroll down and click on "SQL" under the "Storage" section. This will take you to the "SQL" page where all your SQL instances are listed.

3. Select the SQL Instance: From the list of SQL instances, click on the name of the instance you want to check. This will take you to the "Instance details" page.

4. Check the Configuration: On the "Instance details" page, scroll down to the "Connectivity" section. Here, look for the "Public IP" setting. If there are any IP addresses listed under "Authorized networks", this means that the SQL instance is publicly accessible, indicating a misconfiguration.

#### Using CLI

1. Install and authenticate the Google Cloud SDK CLI: You need to have the Google Cloud SDK installed on your local machine. You can download it from the official Google Cloud website. After installation, authenticate the SDK using the command `gcloud auth login`. This will open a new browser window where you can log in with your Google account.

2. List all SQL instances: Use the `gcloud sql instances list` command to list all SQL instances in your project. This command will return a list of all SQL instances along with their details.

3. Describe each SQL instance: For each SQL instance, use the `gcloud sql instances describe [INSTANCE_NAME]` command to get detailed information about the instance. Replace `[INSTANCE_NAME]` with the name of your SQL instance.

4. Check the `ipConfiguration` field: In the output of the describe command, look for the `ipConfiguration` field. If the `authorizedNetworks` field under `ipConfiguration` contains `0.0.0.0/0`, it means that the SQL instance is publicly accessible. This is a misconfiguration as Read Replica Instances should not be public.

#### Using Python

To detect if Read Replica Instances are public in SQL using Python scripts, you can use the boto3 library for AWS, google-cloud-sdk for GCP, and azure-sdk-for-python for Azure. Here are the steps:

1. AWS:
   - Import the boto3 library in your Python script.
   - Create a session using your AWS credentials.
   - Use the `describe_db_instances()` function to get a list of all DB instances.
   - For each DB instance, check the `PubliclyAccessible` attribute. If it's true, the DB instance is publicly accessible.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)

rds = session.client('rds')
response = rds.describe_db_instances()

for instance in response['DBInstances']:
    if instance['PubliclyAccessible']:
        print(f"DB instance {instance['DBInstanceIdentifier']} is publicly accessible.")
```

2. GCP:
   - Import the google.cloud.sql library in your Python script.
   - Use the `list()` function to get a list of all SQL instances.
   - For each SQL instance, check the `settings.ipConfiguration.ipv4Enabled` attribute. If it's true, the SQL instance is publicly accessible.

```python
from google.cloud import sql

client = sql.SqlInstancesServiceClient()
instances = client.list(project='YOUR_PROJECT_ID')

for instance in instances:
    if instance.settings.ipConfiguration.ipv4Enabled:
        print(f"SQL instance {instance.name} is publicly accessible.")
```

3. Azure:
   - Import the azure.mgmt.sql library in your Python script.
   - Use the `servers.list()` function to get a list of all SQL servers.
   - For each SQL server, check the `public_network_access` attribute. If it's 'Enabled', the SQL server is publicly accessible.

```python
from azure.mgmt.sql import SqlManagementClient
from azure.identity import DefaultAzureCredential

credential = DefaultAzureCredential()
subscription_id = 'YOUR_SUBSCRIPTION_ID'

client = SqlManagementClient(credential, subscription_id)
servers = client.servers.list()

for server in servers:
    if server.public_network_access == 'Enabled':
        print(f"SQL server {server.name} is publicly accessible.")
```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "Read Replica Instances Should Not Be Public" for GCP using the GCP console:

1. Open the GCP Console and navigate to the Cloud SQL Instances page.
2. Click on the name of the Cloud SQL instance that has the public read replica.
3. In the left-hand menu, click on "Replicas".
4. Identify the public read replica instance and click on its name.
5. In the left-hand menu, click on "Connections".
6. Under "Authorized networks", click on the "Edit" button.
7. Remove any IP addresses or ranges that are not authorized to access the replica instance.
8. Click "Save" to save the changes.

Once you have completed these steps, the read replica instance will no longer be public and will only be accessible by authorized networks.

#### Using CLI

To remediate the misconfiguration "Read Replica Instances Should Not Be Public" in GCP using GCP CLI, you can follow the below steps:

1. Open the GCP Cloud Console and authenticate with your credentials.

2. Open the Cloud Shell by clicking on the icon in the top right corner of the console.

3. Run the following command to list all the read replica instances in your project:

   `gcloud sql instances list`

4. Identify the read replica instance that is public.

5. Run the following command to update the instance to not be public:

   `gcloud sql instances patch [INSTANCE_NAME] --no-assign-ip`

   Replace [INSTANCE_NAME] with the name of the instance you identified in step 4.

6. Verify that the instance is no longer public by running the following command:

   `gcloud sql instances describe [INSTANCE_NAME]`

   Replace [INSTANCE_NAME] with the name of the instance you identified in step 4.

   Look for the "ipAddresses" field in the output. If it says "None", then the instance is not public.

By following these steps, you can remediate the "Read Replica Instances Should Not Be Public" misconfiguration in GCP using GCP CLI.

#### Using Python

To remediate the misconfiguration "Read Replica Instances Should Not Be Public" for GCP using Python, you can follow the below steps:

1. First, you need to identify all the read replica instances that are public. You can use the GCP Python SDK to retrieve the list of all read replica instances and check if they are public or not. You can use the following code snippet to retrieve the list of all read replica instances:

```python
from google.cloud import bigquery

client = bigquery.Client()

# List all read replica instances
query = """
SELECT *
FROM `project_id.region`.INFORMATION_SCHEMA.REPLICA_INFO
WHERE ROLE = 'READ_REPLICA';
"""

query_job = client.query(query)

for row in query_job:
    print(row)
```

2. Once you have identified the public read replica instances, you can update their access controls to make them private. You can use the GCP Python SDK to update the instance's access controls and remove the public IP address. You can use the following code snippet to update the access control of a read replica instance:

```python
from google.cloud import compute_v1

compute_client = compute_v1.InstancesClient()

# Set instance access control to private
access_config = compute_v1.AccessConfig(name="External NAT", type_="ONE_TO_ONE_NAT")
network_interface = compute_v1.NetworkInterface(access_configs=[access_config])
instance = compute_v1.Instance(network_interfaces=[network_interface])

# Update the instance with new access control
project_id = 'my-project'
zone = 'us-central1-a'
instance_name = 'my-instance'

operation = compute_client.update_network_interface(
    project=project_id,
    zone=zone,
    instance=instance_name,
    network_interface=network_interface,
)

# Wait for the operation to complete
operation.result()
```

3. Finally, you can verify that the read replica instances are no longer public by checking their access controls. You can use the GCP Python SDK to retrieve the instance's access controls and verify that it is private. You can use the following code snippet to retrieve the access control of an instance:

```python
from google.cloud import compute_v1

compute_client = compute_v1.InstancesClient()

# Get instance access control
project_id = 'my-project'
zone = 'us-central1-a'
instance_name = 'my-instance'

instance = compute_client.get(project=project_id, zone=zone, instance=instance_name)
access_config = instance.network_interfaces[0].access_configs[0]

if access_config.type_ == "ONE_TO_ONE_NAT":
    print("Instance access control is private")
else:
    print("Instance access control is public")
```

By following these steps, you can remediate the misconfiguration "Read Replica Instances Should Not Be Public" for GCP using Python.




</Tab>
</Tabs>