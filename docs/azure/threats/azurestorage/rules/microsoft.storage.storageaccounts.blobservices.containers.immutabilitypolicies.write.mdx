--- 
slug: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
eventname: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
title: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
sidebar_label: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
---
                       
### Event Information

#### Meaning

1. The "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" event in AzureStorage refers to an event triggered when a write operation is performed on an immutability policy for a container in Azure Blob Storage.

2. This event indicates that a change has been made to the immutability policy settings of a specific container, such as enabling or disabling immutability, modifying retention periods, or updating legal hold settings.

3. Monitoring this event can help track any modifications made to the immutability policies of containers, ensuring compliance with data retention and legal requirements, and providing an audit trail of changes made to the immutability settings.

### Remediation

#### Using Console

- The security impact of Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write in Azure Storage is that it allows write access to immutability policies for containers. This means that an attacker with this permission could potentially modify or delete immutability policies, compromising the integrity and immutability of the data stored in the container.

To remediate this security issue for Azure Storage using the Azure console, you can follow these step-by-step instructions:

1. Sign in to the Azure portal (https://portal.azure.com) using your Azure account credentials.
2. Navigate to the Azure Storage account that you want to remediate.
3. In the left-hand menu, under the "Settings" section, click on "Access control (IAM)".
4. On the "Access control (IAM)" page, click on the "Add" button to add a new role assignment.
5. In the "Add role assignment" panel, select the appropriate role assignment scope (e.g., subscription, resource group, or specific resource).
6. In the "Role" dropdown, search for and select the "Storage Blob Data Contributor" role. This role provides read and write access to blob data, but does not grant permission to modify immutability policies.
7. In the "Assign access to" dropdown, select the appropriate user, group, or service principal to assign the role to.
8. Click on the "Save" button to save the role assignment.

By following these steps, you will remediate the security impact of Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write by assigning a role that does not have permission to modify immutability policies.

#### Using CLI

1. Impact on Security: The `Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write` permission in Azure Storage allows users to modify or delete immutability policies for containers. This can potentially impact security as it may allow unauthorized users to tamper with or delete critical data stored in the container.

2. Remediation Steps using Azure CLI: To remediate this security issue for Azure Storage using Azure CLI, you can follow these steps:

   a. Identify the affected storage account: Use the following command to list all the storage accounts in your Azure subscription:
   ```
   az storage account list
   ```

   b. Disable the `Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write` permission: Once you have identified the affected storage account, you can disable the write permission for immutability policies using the following command:
   ```
   az storage account update --name <storage_account_name> --resource-group <resource_group_name> --deny-permissions Microsoft.Storage.storageAccounts/blobServices/containers/immutabilityPolicies/write
   ```

   c. Verify the changes: After executing the above command, verify that the write permission for immutability policies has been successfully disabled by listing the access control list (ACL) for the container. You can use the following command:
   ```
   az storage container show --name <container_name> --account-name <storage_account_name> --account-key <storage_account_key>
   ```

   Note: Replace `<storage_account_name>`, `<resource_group_name>`, `<container_name>`, and `<storage_account_key>` with the actual values specific to your Azure environment.

Please ensure that you have the necessary permissions and access rights to execute these commands.

#### Using Python

1. Example of security impact: The `Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write` permission in Azure Storage allows users to modify or delete immutability policies for blob containers. If this permission is granted to unauthorized users or misconfigured, it can lead to potential security risks. For example, an attacker could modify or delete immutability policies, compromising the integrity and immutability of the data stored in the container.

2. Remediation steps using Python:
   - Install the `azure-storage-blob` Python package using pip: `pip install azure-storage-blob`
   - Use the Azure Storage Blob SDK for Python to manage access control and permissions for the Azure Storage account.
   - To remediate the security impact, you can revoke the `Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write` permission from unauthorized users or roles.
   - Here's an example Python script to revoke the permission for a specific user or role:

```python
from azure.storage.blob import BlobServiceClient, BlobContainerClient
from azure.identity import DefaultAzureCredential

# Create a BlobServiceClient using the DefaultAzureCredential
blob_service_client = BlobServiceClient(account_url="https://<your-storage-account-name>.blob.core.windows.net", credential=DefaultAzureCredential())

# Get the BlobContainerClient for the specific container
container_client = blob_service_client.get_container_client("<container-name>")

# Revoke the immutability policy write permission for a specific user or role
container_client.set_container_access_policy(signed_identifiers=[
    {
        'id': 'policy1',
        'access_policy': {
            'start': '<start-date>',
            'expiry': '<expiry-date>',
            'permission': 'rwdl'
        }
    }
])
```

Note: Replace `<your-storage-account-name>`, `<container-name>`, `<start-date>`, and `<expiry-date>` with the appropriate values for your Azure Storage account and container.

3. Ensure that the script is executed with appropriate permissions and credentials to access and modify the Azure Storage account. Regularly review and audit the access control settings to prevent unauthorized access and maintain the security of your Azure Storage resources.


 