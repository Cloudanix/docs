--- 
slug: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
eventname: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
title: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
sidebar_label: Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write
---
                       
### Event Information

1. The "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" event in Azure for Azure Storage refers to an event triggered when a write operation is performed on an immutability policy associated with a blob container.

2. This event indicates that a change has been made to the immutability policy settings of a specific blob container within an Azure Storage account.

3. It is important to monitor this event as it allows you to track any modifications or updates made to the immutability policies, which are crucial for ensuring data integrity and compliance in scenarios where data immutability is required, such as regulatory or legal requirements.


### Examples

1. Unauthorized write access: If security is impacted with the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission in Azure for Azure Storage, it could potentially allow unauthorized users or applications to write data to immutable containers. This can lead to data integrity issues and compromise the security of the storage account.

2. Data tampering: With the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission, an attacker could modify or tamper with the data stored in immutable containers. This can result in the loss of data integrity and trustworthiness, making it difficult to ensure the authenticity and reliability of the stored data.

3. Compliance violations: Azure Storage's immutability policies are often used to enforce data retention and compliance requirements. If security is impacted with the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission, it can potentially allow unauthorized modifications or deletions of immutable data, leading to compliance violations and potential legal consequences. It is crucial to ensure that only authorized entities have the necessary permissions to write to immutable containers to maintain data integrity and compliance.

### Remediation

#### Using Console

1. Unauthorized write access can be remediated in Azure Storage by following these steps:
   - Open the Azure portal and navigate to the Azure Storage account that needs to be secured.
   - Go to the "Access control (IAM)" section in the left-hand menu.
   - Click on the "Add" button to add a new role assignment.
   - In the "Add role assignment" window, select the appropriate role (e.g., "Storage Blob Data Contributor") that allows write access to immutable containers.
   - Specify the user, group, or application that needs the write access and click on the "Save" button.
   - Review the role assignment to ensure that only authorized entities have the necessary permissions to write to immutable containers.

2. To remediate data tampering in Azure Storage:
   - Enable the "Soft Delete" feature for the Azure Storage account. This feature allows you to recover deleted data within a specified retention period.
   - Implement Azure Blob Storage versioning to maintain a history of changes made to the data stored in immutable containers.
   - Regularly monitor and analyze access logs and audit logs to detect any unauthorized modifications or tampering attempts.
   - Implement Azure Monitor alerts to notify you of any suspicious activities or anomalies related to data tampering.

3. To prevent compliance violations in Azure Storage:
   - Implement Azure Storage Account Firewalls and Virtual Networks to restrict access to the storage account from specific trusted networks or IP ranges.
   - Enable Azure Storage Service Encryption to ensure that data at rest is encrypted and protected.
   - Regularly review and update the access control policies and permissions to ensure that only authorized entities have the necessary permissions to write to immutable containers.
   - Conduct regular compliance audits and assessments to ensure that the storage account meets the required compliance standards and regulations.

#### Using CLI

1. To remediate unauthorized write access in Azure Storage, you can use the Azure CLI command to revoke the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission for a specific user or application. 

```
az role assignment delete --assignee <user or application ID> --role "Storage Blob Data Contributor" --scope <storage account resource ID>
```

2. To prevent data tampering in Azure Storage, you can enable the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission only for trusted users or applications. This can be done using the Azure CLI command to grant the permission to a specific user or application.

```
az role assignment create --assignee <user or application ID> --role "Storage Blob Data Contributor" --scope <storage account resource ID>
```

3. To ensure compliance and prevent violations, you should regularly review and audit the permissions assigned to the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" role. You can use the Azure CLI command to list all role assignments for a storage account and identify any unauthorized assignments.

```
az role assignment list --role "Storage Blob Data Contributor" --scope <storage account resource ID>
```

By regularly monitoring and managing the permissions, you can mitigate the risk of unauthorized write access, data tampering, and compliance violations in Azure Storage.

#### Using Python

To remediate unauthorized write access, data tampering, and compliance violations in Azure Storage using Python scripts, you can utilize the Azure SDK for Python. Here are the steps you can follow:

1. Check and revoke unnecessary permissions:
   - Use the `azure.identity` library to authenticate with Azure Active Directory.
   - Use the `azure.mgmt.storage` library to interact with the Azure Storage service.
   - Retrieve the list of permissions for the storage account using the `blob_containers.list` method.
   - Identify any users or applications with the "Microsoft.Storage.storageAccounts.blobServices.containers.immutabilityPolicies.write" permission.
   - Revoke the permission using the `blob_containers.update` method.

2. Implement data integrity checks:
   - Use the `azure.storage.blob` library to interact with the Azure Blob Storage service.
   - Retrieve the data from the immutable containers using the `blob_client.download_blob` method.
   - Calculate the hash or checksum of the downloaded data.
   - Compare the calculated hash with the original hash stored elsewhere (e.g., in a database or metadata).
   - If the hashes do not match, it indicates data tampering.

3. Enforce compliance requirements:
   - Use the `azure.storage.blob` library to set up immutability policies for the containers.
   - Configure the immutability policies to prevent modifications or deletions for the desired retention period.
   - Ensure that only authorized entities have the necessary permissions to write to the immutable containers.
   - Regularly monitor and audit the permissions and immutability policies to detect any unauthorized changes.

Please note that the provided steps are high-level and may require customization based on your specific requirements and environment.


 