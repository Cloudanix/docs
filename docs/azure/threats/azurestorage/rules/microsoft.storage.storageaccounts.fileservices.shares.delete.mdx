--- 
slug: Microsoft.Storage.storageAccounts.fileServices.shares.delete
eventname: Microsoft.Storage.storageAccounts.fileServices.shares.delete
title: Microsoft.Storage.storageAccounts.fileServices.shares.delete
sidebar_label: Microsoft.Storage.storageAccounts.fileServices.shares.delete
---
                       
### Event Information

#### Meaning

1. The Microsoft.Storage.storageAccounts.fileServices.shares.delete event in AzureStorage refers to the deletion of a file share within a storage account in Azure.

2. This event indicates that a specific file share, along with all its contents, has been permanently removed from the storage account.

3. It is important to note that this event is irreversible, and once a file share is deleted, it cannot be recovered unless there are backups or snapshots available.

### Remediation

#### Using Console

- The security impact of the Microsoft.Storage.storageAccounts.fileServices.shares.delete event in AzureStorage is that it allows the deletion of file shares within a storage account, which can result in the loss of important data or disruption of services.
- To remediate this security impact in AzureStorage using the Azure console, follow these steps:
  1. Sign in to the Azure portal and navigate to the AzureStorage account that needs to be secured.
  2. Select the "File shares" option from the left-hand menu to view the list of file shares within the storage account.
  3. Identify the file share that needs to be protected and click on it to access its settings.
  4. In the file share settings, go to the "Access control (IAM)" tab.
  5. Click on the "+ Add" button to add a new role assignment.
  6. In the "Add role assignment" window, select the appropriate role (e.g., "Storage File Data SMB Share Contributor") that provides the necessary permissions for managing file shares without the ability to delete them.
  7. Specify the user, group, or service principal that should be assigned this role and click on the "Save" button.
  8. Repeat steps 5-7 for any other users or entities that require access to the file share.
  9. Once the role assignments are configured, ensure that the appropriate access controls and permissions are in place for the file share's content and data.
  10. Regularly review and audit the access control settings to ensure they align with the organization's security requirements and policies.

#### Using CLI

1. Impact on Security: The Microsoft.Storage.storageAccounts.fileServices.shares.delete action in Azure Storage allows a user to delete file shares within a storage account. If this action is misused or unauthorized, it can lead to the loss of critical data stored in the file shares, potentially impacting the security and availability of the Azure Storage resources.

2. Remediation Steps using Azure CLI: To remediate this security impact and restrict the ability to delete file shares in Azure Storage, you can follow these steps using Azure CLI:

   a. Identify the storage account: Use the following command to list all the storage accounts in your Azure subscription:
      ```
      az storage account list
      ```

   b. Update the storage account's access control: Once you have identified the storage account, use the following command to update the access control of the storage account and remove the delete permission for file shares:
      ```
      az storage account update --name <storage_account_name> --resource-group <resource_group_name> --bypass AzureServices --default-action Deny
      ```

   c. Verify the access control changes: Finally, verify that the access control changes have been applied successfully by listing the access policies of the storage account:
      ```
      az storage account show --name <storage_account_name> --resource-group <resource_group_name> --query "networkAcls"
      ```

   Note: Replace `<storage_account_name>` with the actual name of the storage account and `<resource_group_name>` with the name of the resource group where the storage account is located.

Please ensure that you have the necessary permissions and access to the Azure subscription and resource group to perform these actions.

#### Using Python

1. Example of security impact: If an unauthorized user gains access to delete file shares in Azure Storage, they can potentially delete critical data or disrupt business operations.

2. Remediation steps for Azure Storage using Python:
   - Implement RBAC (Role-Based Access Control) to ensure that only authorized users have the necessary permissions to delete file shares.
   - Regularly review and update access control policies to ensure that only the required individuals or groups have delete permissions.
   - Enable auditing and monitoring to track any suspicious activities related to file share deletion.

Python script example for RBAC implementation:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient
from azure.mgmt.authorization.models import RoleAssignmentCreateParameters

# Authenticate using DefaultAzureCredential or any other suitable method
credential = DefaultAzureCredential()

# Create an instance of the AuthorizationManagementClient
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Define the necessary parameters for the role assignment
role_assignment_params = RoleAssignmentCreateParameters(
    role_definition_id='/subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{role_definition_id}',
    principal_id='/subscriptions/{subscription_id}/providers/Microsoft.AzureActiveDirectory/users/{user_id}',
    scope='/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.Storage/storageAccounts/{storage_account}'
)

# Create the role assignment
authorization_client.role_assignments.create(scope, role_assignment_params)
```

Note: Replace the placeholders `{subscription_id}`, `{role_definition_id}`, `{user_id}`, `{resource_group}`, and `{storage_account}` with the appropriate values specific to your Azure environment.

Please note that the above script is just an example and may need to be modified based on your specific requirements and environment.


 