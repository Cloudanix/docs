--- 
slug: Microsoft.Storage.storageAccounts.queueServices.queues.delete
eventname: Microsoft.Storage.storageAccounts.queueServices.queues.delete
title: Microsoft.Storage.storageAccounts.queueServices.queues.delete
sidebar_label: Microsoft.Storage.storageAccounts.queueServices.queues.delete
---
                       
### Event Information

1. The Microsoft.Storage.storageAccounts.queueServices.queues.delete event in Azure for Azure Storage indicates that a queue has been deleted within a storage account.
2. This event is triggered when a user or an automated process initiates the deletion of a specific queue in Azure Storage.
3. It is important to note that this event does not provide information about the contents of the deleted queue, but rather focuses on the deletion action itself.


### Examples

1. Unauthorized deletion: If security is impacted with Microsoft.Storage.storageAccounts.queueServices.queues.delete in Azure for AzureStorage, one example could be unauthorized deletion of queues. This could occur if an attacker gains access to the necessary permissions or credentials and deletes queues without proper authorization. To mitigate this, it is important to implement strong access controls, regularly review and update permissions, and enable auditing and monitoring to detect any unauthorized deletion attempts.

2. Data loss: Another example of security impact could be accidental or malicious deletion of queues leading to data loss. If critical queues containing important messages or data are deleted, it can result in service disruptions, loss of valuable information, and potential compliance violations. To prevent this, it is crucial to have proper backup and disaster recovery mechanisms in place, such as regular backups, replication, and versioning of queues.

3. Denial of Service (DoS): A security impact of Microsoft.Storage.storageAccounts.queueServices.queues.delete in Azure for AzureStorage could be a potential Denial of Service (DoS) attack. An attacker could repeatedly delete queues, exhausting system resources and causing service disruptions for legitimate users. To mitigate this, it is important to implement rate limiting, throttling, and monitoring mechanisms to detect and mitigate any abnormal deletion patterns. Additionally, implementing network-level protections, such as Azure DDoS Protection, can help defend against DoS attacks.

### Remediation

#### Using Console

To remediate unauthorized deletion, data loss, and denial of service (DoS) related to Microsoft.Storage.storageAccounts.queueServices.queues.delete in Azure for AzureStorage, you can follow these step-by-step instructions using the Azure console:

1. Implement strong access controls:
   - Navigate to the Azure portal and open the Azure Storage account.
   - Go to the "Access control (IAM)" section.
   - Review and update the permissions assigned to users, groups, or applications.
   - Remove any unnecessary or excessive permissions.
   - Regularly review and update permissions to ensure only authorized individuals have access.

2. Enable auditing and monitoring:
   - In the Azure portal, go to the Azure Storage account.
   - Navigate to the "Monitoring" section.
   - Enable diagnostic settings to capture logs and metrics related to queue deletions.
   - Configure alerts or notifications to be triggered when unauthorized deletion attempts are detected.
   - Regularly monitor the logs and alerts to identify any suspicious activities.

3. Implement backup and disaster recovery mechanisms:
   - Utilize Azure Storage features like soft delete, versioning, or replication to protect against accidental or malicious queue deletions.
   - Enable soft delete to retain deleted queues for a specified period, allowing for recovery if needed.
   - Configure versioning to maintain multiple versions of queues, ensuring data can be restored in case of deletion.
   - Implement replication to replicate queues across different regions for redundancy and disaster recovery purposes.

By following these steps, you can mitigate the risks associated with unauthorized deletion, data loss, and DoS attacks in Azure Storage queues.

#### Using CLI

To remediate unauthorized deletion, data loss, and Denial of Service (DoS) impacts in Azure for AzureStorage using Azure CLI commands, you can follow these steps:

1. Unauthorized deletion:
- Use the Azure CLI command to set strong access controls for the storage account:
  `az storage account update --name <storage_account_name> --resource-group <resource_group_name> --default-action Deny`

- Regularly review and update permissions for the storage account and its associated resources.

- Enable auditing and monitoring for the storage account to detect any unauthorized deletion attempts:
  `az storage logging update --name <storage_account_name> --resource-group <resource_group_name> --services q --log delete --retention 7`

2. Data loss:
- Implement backup and disaster recovery mechanisms for the queues:
  - Enable soft delete for the storage account to retain deleted queues for a specified period:
    `az storage account update --name <storage_account_name> --resource-group <resource_group_name> --enable-queue-soft-delete true`
  - Configure replication options, such as geo-redundant storage, to ensure data redundancy and availability.

3. Denial of Service (DoS):
- Implement rate limiting for deletion requests to prevent excessive or suspicious activity:
  - Set a limit on the number of requests per second for the storage account:
    `az storage account update --name <storage_account_name> --resource-group <resource_group_name> --queue-service-properties defaultServiceVersion=2020-04-08 --queue-service-properties deleteRetentionPolicy.enabled=true --queue-service-properties deleteRetentionPolicy.days=7 --queue-service-properties cors.corsRules[0].allowedMethods DELETE --queue-service-properties cors.corsRules[0].maxAgeInSeconds 3600 --queue-service-properties cors.corsRules[0].allowedOrigins '*' --queue-service-properties cors.corsRules[0].allowedHeaders '*' --queue-service-properties cors.corsRules[0].exposedHeaders '*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-content-length' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-queue-type' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-meta-*' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-return-client-request-id' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-version' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-date' --queue-service-properties cors.corsRules[0].allowedHeaders 'x-ms-authorization' --queue-service-properties cors.corsRules[0].

#### Using Python

To remediate unauthorized deletion, data loss, and denial of service (DoS) risks in Azure Storage using Python scripts, you can utilize the Azure SDK for Python. Here are some example scripts:

1. Unauthorized deletion:
```python
from azure.identity import DefaultAzureCredential
from azure.storage.queue import QueueServiceClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()

# Create a QueueServiceClient
queue_service_client = QueueServiceClient(account_url="https://<storage-account-name>.queue.core.windows.net", credential=credential)

# Delete a queue
queue_service_client.delete_queue("<queue-name>")
```

2. Data loss:
```python
from azure.identity import DefaultAzureCredential
from azure.storage.queue import QueueServiceClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()

# Create a QueueServiceClient
queue_service_client = QueueServiceClient(account_url="https://<storage-account-name>.queue.core.windows.net", credential=credential)

# Create a backup of a queue
queue_service_client.create_queue("<backup-queue-name>")

# Restore a queue from backup
queue_service_client.create_queue("<restored-queue-name>")
```

3. Denial of Service (DoS):
```python
from azure.identity import DefaultAzureCredential
from azure.storage.queue import QueueServiceClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()

# Create a QueueServiceClient
queue_service_client = QueueServiceClient(account_url="https://<storage-account-name>.queue.core.windows.net", credential=credential)

# Implement rate limiting
queue_service_client._client._config.retry_policy.max_retries = 3

# Monitor and detect suspicious deletion requests
# Implement your own logic to monitor and detect excessive deletion requests
```

Please note that the above scripts are just examples and may need to be customized based on your specific requirements and environment.


 