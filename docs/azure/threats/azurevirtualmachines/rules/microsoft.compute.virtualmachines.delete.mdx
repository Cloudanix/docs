--- 
slug: Microsoft.Compute.virtualMachines.delete
eventname: Microsoft.Compute.virtualMachines.delete
title: Microsoft.Compute.virtualMachines.delete
sidebar_label: Microsoft.Compute.virtualMachines.delete
---
                       
### Event Information

#### Meaning

- The Microsoft.Compute.virtualMachines.delete event in Azure signifies the deletion of a virtual machine in the Azure environment.
- This event indicates that a specific virtual machine instance has been permanently removed from the Azure infrastructure.
- It is important to note that this event does not include any information about the reason for deletion or any associated resources that may have been affected.

### Remediation

#### Using Console

- Example: If security is impacted with Microsoft.Compute.virtualMachines.delete in Azure for Azure Virtual Machines, it means that an unauthorized user or process has the ability to delete virtual machines within the Azure environment. This can lead to data loss, service disruption, and potential security breaches.

- Remediation Steps using Azure Console:
  1. Access the Azure portal and navigate to the Azure Virtual Machines service.
  2. Select the virtual machine(s) that you want to protect from unauthorized deletion.
  3. Click on the "Access control (IAM)" tab in the left-hand menu.
  4. Click on the "+ Add" button to add a new role assignment.
  5. In the "Add role assignment" window, select the appropriate role (e.g., "Virtual Machine Contributor") from the "Role" dropdown menu.
  6. In the "Assign access to" field, search for and select the user or group that should have the ability to delete virtual machines.
  7. Click on the "Save" button to apply the role assignment.
  8. Repeat steps 4-7 for any additional users or groups that require the ability to delete virtual machines.
  9. Regularly review and audit the role assignments to ensure that only authorized users have the necessary permissions.

Note: It is important to follow the principle of least privilege when assigning roles and permissions to users or groups.

#### Using CLI

- Example: If security is impacted with `Microsoft.Compute.virtualMachines.delete` in Azure for `AzureVirtualMachines`, it means that an unauthorized user or process has the ability to delete virtual machines in the Azure environment. This can lead to data loss, service disruption, and potential security breaches.

- Remediation steps for AzureVirtualMachines using Azure CLI:
  1. Grant the necessary permissions: Ensure that only authorized users or processes have the permission to delete virtual machines. This can be achieved by assigning the appropriate RBAC (Role-Based Access Control) roles to the users or service principals. For example, the `Contributor` role can be assigned to allow users to manage virtual machines without the ability to delete them.
  2. Enable Azure Resource Locks: Implement Azure Resource Locks to prevent accidental deletion of virtual machines. Resource Locks can be applied at the resource group or individual resource level to restrict modifications, including deletion. For example, you can apply a `CanNotDelete` lock to the resource group containing the virtual machines.
  3. Monitor and audit: Implement monitoring and auditing mechanisms to detect any unauthorized deletion attempts. Azure Monitor and Azure Security Center can be used to track and analyze activities related to virtual machines, including deletions. Regularly review the logs and alerts to identify any suspicious activities and take appropriate actions.

CLI commands:
- Granting RBAC role:
  ```
  az role assignment create --assignee <principalId> --role "Contributor" --scope /subscriptions/<subscriptionId>/resourceGroups/<resourceGroupName>
  ```

- Applying Azure Resource Lock:
  ```
  az lock create --name <lockName> --lock-type CanNotDelete --resource-group <resourceGroupName> --resource <resourceName>
  ```

- Monitoring and auditing:
  ```
  az monitor activity-log list --resource-group <resourceGroupName> --resource-type Microsoft.Compute/virtualMachines --query "[?operationName.value=='Microsoft.Compute/virtualMachines/delete']"
  ```

#### Using Python

1. Example of security impact: If an unauthorized user gains access to the Microsoft.Compute.virtualMachines.delete permission in Azure, they can delete virtual machines without proper authorization. This can lead to data loss, service disruption, and potential security breaches.

2. Remediation for AzureVirtualMachines using Python:
   - Implement RBAC (Role-Based Access Control) to ensure that only authorized users have the Microsoft.Compute.virtualMachines.delete permission.
   - Regularly review and update access control policies to remove unnecessary or excessive permissions.
   - Monitor and log all delete operations on virtual machines to detect any unauthorized or suspicious activities.

Python script example for RBAC remediation:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient
from azure.mgmt.authorization.models import RoleAssignmentCreateParameters

def assign_role_to_user(resource_group, vm_name, user_principal_id, role_definition_id):
    credentials = DefaultAzureCredential()
    auth_client = AuthorizationManagementClient(credentials, subscription_id)

    role_assignment_params = RoleAssignmentCreateParameters(
        principal_id=user_principal_id,
        role_definition_id=role_definition_id,
        scope=f"/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.Compute/virtualMachines/{vm_name}"
    )

    auth_client.role_assignments.create(scope, role_assignment_params)

# Usage example
assign_role_to_user("my-resource-group", "my-vm", "user-principal-id", "role-definition-id")
```

Note: You need to replace the placeholders (`my-resource-group`, `my-vm`, `user-principal-id`, `role-definition-id`) with the actual values specific to your Azure environment.


 