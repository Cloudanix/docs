--- 
slug: Microsoft.Compute.snapshots.write
eventname: Microsoft.Compute.snapshots.write
title: Microsoft.Compute.snapshots.write
sidebar_label: Microsoft.Compute.snapshots.write
---
                       
### Event Information

#### Meaning

- The Microsoft.Compute.snapshots.write event in Azure for AzureVirtualMachines refers to the action of creating or updating a snapshot of a virtual machine disk.
- This event indicates that a user or an automated process has initiated the creation or modification of a snapshot for a virtual machine in Azure.
- Snapshots are point-in-time copies of virtual machine disks, which can be used for backup, disaster recovery, or creating new virtual machines from a known state.

### Remediation

#### Using Console

- Example: If security is impacted with Microsoft.Compute.snapshots.write in Azure for Azure Virtual Machines, it means that the permission to create snapshots of virtual machines is granted to unauthorized users or roles. This can potentially lead to unauthorized access or data leakage.

- Remediation Steps:
1. Sign in to the Azure portal (https://portal.azure.com) using your Azure account credentials.
2. Navigate to the Azure Virtual Machines service.
3. Select the virtual machine for which you want to remediate the security issue.
4. In the left-hand menu, click on "Access control (IAM)".
5. On the "Access control (IAM)" page, click on the "Add" button to add a new role assignment.
6. In the "Add role assignment" panel, select the appropriate role that should have the permission to create snapshots (e.g., "Virtual Machine Contributor").
7. In the "Assign access to" field, select the appropriate user, group, or service principal that should have the permission.
8. Click on the "Save" button to apply the role assignment.
9. Repeat steps 5-8 for any other users, groups, or service principals that should have the permission to create snapshots.
10. Review the existing role assignments to ensure that unauthorized users or roles do not have the "Microsoft.Compute.snapshots.write" permission.

Note: It is important to regularly review and manage the access control (IAM) settings for Azure Virtual Machines to ensure that only authorized users or roles have the necessary permissions.

#### Using CLI

- Example: If security is impacted with Microsoft.Compute.snapshots.write in Azure for Azure Virtual Machines, it means that the permission to create snapshots of virtual machines is granted to unauthorized users or roles. This can potentially lead to unauthorized access or data leakage.

- Remediation steps using Azure CLI:
  1. Identify the affected virtual machine: `az vm show --name <vm_name> --resource-group <resource_group_name>`
  2. Revoke the Microsoft.Compute.snapshots.write permission for unauthorized users or roles: `az role assignment delete --assignee <user_or_role_id> --scope <vm_resource_id> --role "Microsoft.Compute.snapshots.write"`
  3. Verify the permission has been revoked: `az role assignment list --scope <vm_resource_id> --query "[?roleDefinitionName=='Microsoft.Compute.snapshots.write']"`

Note: Replace `<vm_name>`, `<resource_group_name>`, `<user_or_role_id>`, and `<vm_resource_id>` with the actual values specific to your environment.

#### Using Python

Example of security impact: If the Microsoft.Compute.snapshots.write permission is granted to AzureVirtualMachines in Azure, it means that the virtual machines have the ability to create and write snapshots. This can potentially lead to security risks if unauthorized users gain access to the virtual machines and misuse this permission to create and store sensitive data in snapshots.

Remediation for AzureVirtualMachines using Python:

1. Identify affected virtual machines: Use the Azure SDK for Python (azure-mgmt-compute) to retrieve a list of virtual machines in the Azure subscription.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

credential = DefaultAzureCredential()
compute_client = ComputeManagementClient(credential, subscription_id)

virtual_machines = compute_client.virtual_machines.list_all()

for vm in virtual_machines:
    if 'Microsoft.Compute.snapshots.write' in vm.identity.role_assignments:
        print(f"Virtual machine {vm.name} has Microsoft.Compute.snapshots.write permission.")
```

2. Remove the permission: Use the Azure SDK for Python (azure-mgmt-authorization) to remove the Microsoft.Compute.snapshots.write permission from the affected virtual machines.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Assuming you have the resource ID of the virtual machine
resource_id = "/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.Compute/virtualMachines/{vm_name}"

role_assignment = authorization_client.role_assignments.list_for_resource(resource_id)

for assignment in role_assignment:
    if assignment.role_definition_id == 'Microsoft.Compute.snapshots.write':
        authorization_client.role_assignments.delete(resource_id, assignment.name)
```

3. Monitor and audit: Implement a monitoring and auditing solution to track any changes to the virtual machines' permissions and ensure that the Microsoft.Compute.snapshots.write permission is not re-granted without proper authorization.

Note: The above code snippets are just examples and may require modifications based on your specific requirements and environment setup.


 