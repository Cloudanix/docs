--- 
slug: Microsoft.Compute.images.delete
eventname: Microsoft.Compute.images.delete
title: Microsoft.Compute.images.delete
sidebar_label: Microsoft.Compute.images.delete
---
                       
### Event Information

- The Microsoft.Compute.images.delete event in Azure for AzureVirtualMachines refers to the deletion of a custom image that was previously created in Azure.
- This event indicates that a custom image, which is a snapshot of a virtual machine, has been permanently removed from the Azure environment.
- Deleting custom images helps to manage and optimize storage usage, as well as maintain a clean and organized image repository in Azure.


### Examples

1. Unauthorized deletion of images: If security is impacted with Microsoft.Compute.images.delete in Azure for AzureVirtualMachines, it could potentially lead to unauthorized deletion of images. This means that an attacker could delete critical images that are used to provision virtual machines, resulting in service disruption or loss of important data.

2. Image tampering: Another security impact could be image tampering. If an unauthorized user gains access to the Microsoft.Compute.images.delete operation, they could potentially modify or tamper with the images used for virtual machine provisioning. This could result in compromised instances being deployed, leading to potential data breaches or unauthorized access to sensitive information.

3. Denial of Service (DoS) attacks: The Microsoft.Compute.images.delete operation could also be exploited to launch Denial of Service (DoS) attacks. By repeatedly deleting images used for virtual machine provisioning, an attacker could disrupt the availability of the virtual machines, impacting the overall performance and availability of the Azure environment.

To mitigate these security impacts, it is important to implement proper access controls, such as role-based access control (RBAC), to restrict the permissions for the Microsoft.Compute.images.delete operation. Regular monitoring and auditing of image deletion activities should also be implemented to detect any unauthorized or suspicious activities. Additionally, backups and versioning of critical images should be maintained to ensure quick recovery in case of accidental or malicious deletion.

### Remediation

#### Using Console

To remediate unauthorized deletion of images, image tampering, and potential Denial of Service (DoS) attacks in Azure for AzureVirtualMachines, you can follow these step-by-step instructions:

1. Implement Role-Based Access Control (RBAC): 
   - Identify and assign appropriate RBAC roles to users and groups based on their responsibilities and access requirements.
   - Ensure that the Microsoft.Compute.images.delete permission is only granted to authorized personnel who require it for their specific tasks.
   - Regularly review and update RBAC assignments to ensure that permissions are granted on a need-to-know basis.

2. Enable Azure Resource Locks:
   - Utilize Azure Resource Locks to prevent accidental or unauthorized deletion of critical resources, such as images used for AzureVirtualMachines.
   - Apply the appropriate lock level (CanNotDelete or ReadOnly) to the images or resource groups containing the images to prevent deletion or modification by unauthorized users.
   - Regularly review and update resource locks as necessary to maintain the desired level of protection.

3. Enable Azure Monitor and Alerts:
   - Configure Azure Monitor to track and monitor activities related to image deletion and modification.
   - Set up alerts to notify administrators or security teams when suspicious or unauthorized actions are detected, such as unexpected deletions or modifications of images.
   - Define appropriate response procedures to investigate and mitigate any potential security incidents promptly.

By implementing RBAC, utilizing Azure Resource Locks, and enabling Azure Monitor and Alerts, you can significantly reduce the risk of unauthorized deletion of images, image tampering, and potential DoS attacks in Azure for AzureVirtualMachines.

#### Using CLI

To remediate unauthorized deletion of images, you can take the following steps in Azure for AzureVirtualMachines:

1. Limit access to the Microsoft.Compute.images.delete permission: Ensure that only authorized users or roles have this permission. Use Azure RBAC (Role-Based Access Control) to assign the permission to specific users or groups. You can use the following Azure CLI command to assign the permission to a user or group:

   ```
   az role assignment create --assignee <user or group ID> --role "Virtual Machine Image Contributor" --scope /subscriptions/<subscription ID>/resourceGroups/<resource group name>/providers/Microsoft.Compute/images/<image name>
   ```

2. Enable Azure Resource Locks: Apply a resource lock to critical images to prevent accidental or unauthorized deletion. Resource locks can be set at the subscription, resource group, or individual resource level. Use the following Azure CLI command to apply a lock to an image:

   ```
   az lock create --name <lock name> --lock-type CanNotDelete --resource <image resource ID>
   ```

3. Monitor and audit image deletion activities: Enable Azure Monitor and Azure Log Analytics to track and analyze image deletion events. Set up alerts and notifications to detect any unauthorized or suspicious activities related to image deletion. Regularly review the logs and audit trails to identify potential security incidents.

It is important to regularly review and update access controls, monitor activities, and follow security best practices to mitigate the risks associated with unauthorized deletion of images in Azure.

#### Using Python

To remediate unauthorized deletion of images in Azure for AzureVirtualMachines, you can take the following steps:

1. Implement Role-Based Access Control (RBAC): Ensure that proper RBAC roles and permissions are assigned to users and service principals. Limit the Microsoft.Compute.images.delete permission to only authorized individuals or groups who require it for their specific tasks.

2. Enable Azure Resource Manager (ARM) Locks: Use ARM locks to prevent accidental or unauthorized deletion of critical images. By applying a delete lock on the image resource, it will prevent any user, including those with the Microsoft.Compute.images.delete permission, from deleting the image.

3. Enable Azure Monitor and Alerts: Set up Azure Monitor to track and monitor image deletion activities. Configure alerts to notify administrators whenever an image is deleted, allowing for immediate investigation and response.

Here's an example Python script to implement an ARM lock on an image resource:

```python
from azure.mgmt.resource import ResourceManagementClient
from azure.mgmt.resource.resources.models import ManagementLockObject, LockLevel

# Authenticate and create a resource management client
resource_client = ResourceManagementClient(credentials, subscription_id)

# Define the resource ID of the image to be locked
image_resource_id = "/subscriptions/{subscription_id}/resourceGroups/{resource_group_name}/providers/Microsoft.Compute/images/{image_name}"

# Create a management lock object with delete lock level
lock = ManagementLockObject(level=LockLevel.CAN_NOT_DELETE)

# Apply the lock on the image resource
resource_client.management_locks.create_or_update_at_resource_level(
    lock_name="image-delete-lock",
    lock_parameters=lock,
    resource_group_name="{resource_group_name}",
    resource_provider_namespace="Microsoft.Compute",
    resource_type="images",
    resource_name="{image_name}"
)
```

Please note that you need to replace the placeholders (`{subscription_id}`, `{resource_group_name}`, `{image_name}`) with the actual values specific to your environment.


 