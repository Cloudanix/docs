--- 
slug: Microsoft.Compute.sshPublicKeys.write
eventname: Microsoft.Compute.sshPublicKeys.write
title: Microsoft.Compute.sshPublicKeys.write
sidebar_label: Microsoft.Compute.sshPublicKeys.write
---
                       
### Event Information

- The Microsoft.Compute.sshPublicKeys.write event in Azure for AzureVirtualMachines refers to an event where a user or process has written or updated the SSH public keys for a virtual machine in Azure.
- This event indicates that there has been a change in the SSH public keys associated with a virtual machine, which are used for authentication purposes when connecting to the virtual machine using SSH.
- It is important to monitor this event as it can help track any changes made to the SSH public keys, ensuring the security and integrity of the virtual machine's access control.


### Examples

1. Unauthorized access: If security is impacted with Microsoft.Compute.sshPublicKeys.write in Azure for Azure Virtual Machines, it could potentially allow unauthorized individuals to write or modify SSH public keys associated with virtual machines. This could lead to unauthorized access to the virtual machines, compromising the confidentiality and integrity of the data stored within them.

2. Privilege escalation: If an attacker gains the ability to write SSH public keys for Azure Virtual Machines, they could potentially escalate their privileges by adding their own public key to gain unauthorized access to the virtual machine instances. This could allow them to perform malicious activities, such as stealing sensitive data or launching further attacks within the environment.

3. Malicious code injection: If security is impacted with Microsoft.Compute.sshPublicKeys.write, an attacker could potentially inject malicious code into the SSH public keys, compromising the integrity of the virtual machine instances. This could lead to the execution of unauthorized commands or the installation of malware, further compromising the security of the environment.

### Remediation

#### Using Console

1. Unauthorized access:
- Step 1: Log in to the Azure portal using your credentials.
- Step 2: Navigate to the Azure Virtual Machines section.
- Step 3: Select the virtual machine for which you want to remediate unauthorized access.
- Step 4: Go to the "Settings" tab and click on "SSH public keys".
- Step 5: Review the existing SSH public keys and ensure that they are legitimate.
- Step 6: If any unauthorized SSH public keys are found, click on the "Delete" button next to them to remove them.
- Step 7: Consider enabling Azure Security Center and implementing recommendations to prevent unauthorized access in the future.

2. Privilege escalation:
- Step 1: Access the Azure portal using your credentials.
- Step 2: Navigate to the Azure Virtual Machines section.
- Step 3: Select the virtual machine that has the potential for privilege escalation.
- Step 4: Go to the "Settings" tab and click on "SSH public keys".
- Step 5: Review the existing SSH public keys and ensure that they are legitimate.
- Step 6: If any unauthorized SSH public keys are found, click on the "Delete" button next to them to remove them.
- Step 7: Consider implementing Azure RBAC (Role-Based Access Control) to restrict access and privileges within the Azure environment.

3. Key tampering:
- Step 1: Log in to the Azure portal using your credentials.
- Step 2: Navigate to the Azure Virtual Machines section.
- Step 3: Select the virtual machine that may have tampered SSH public keys.
- Step 4: Go to the "Settings" tab and click on "SSH public keys".
- Step 5: Review the existing SSH public keys and ensure that they have not been tampered with.
- Step 6: If any suspicious SSH public keys are found, click on the "Delete" button next to them to remove them.
- Step 7: Consider implementing Azure Security Center and enabling network security groups to detect and prevent key tampering in the future.

#### Using CLI

1. To remediate unauthorized access related to Microsoft.Compute.sshPublicKeys.write in Azure for Azure Virtual Machines, you can take the following steps using Azure CLI:

- Identify the affected virtual machine(s) by running the command:
  `az vm list --query "[?identity.type=='SystemAssigned']"`

- Disable SSH password authentication for the affected virtual machine(s) by running the command:
  `az vm update --name <vm-name> --resource-group <resource-group-name> --set osProfile.linuxConfiguration.disablePasswordAuthentication=true`

- Remove any unauthorized SSH public keys from the virtual machine(s) by running the command:
  `az vm update --name <vm-name> --resource-group <resource-group-name> --remove osProfile.linuxConfiguration.ssh.publicKeys --index <index-of-unauthorized-key>`

2. To remediate privilege escalation related to Microsoft.Compute.sshPublicKeys.write in Azure for Azure Virtual Machines, you can follow these steps using Azure CLI:

- Identify the affected virtual machine(s) by running the command:
  `az vm list --query "[?identity.type=='SystemAssigned']"`

- Remove any unauthorized SSH public keys from the virtual machine(s) by running the command:
  `az vm update --name <vm-name> --resource-group <resource-group-name> --remove osProfile.linuxConfiguration.ssh.publicKeys --index <index-of-unauthorized-key>`

- Monitor and review the Azure Activity Log and Azure Security Center for any suspicious activities or indicators of privilege escalation.

3. To remediate key tampering related to Microsoft.Compute.sshPublicKeys.write in Azure for Azure Virtual Machines, you can take the following steps using Azure CLI:

- Identify the affected virtual machine(s) by running the command:
  `az vm list --query "[?identity.type=='SystemAssigned']"`

- Remove any unauthorized SSH public keys from the virtual machine(s) by running the command:
  `az vm update --name <vm-name> --resource-group <resource-group-name> --remove osProfile.linuxConfiguration.ssh.publicKeys --index <index-of-unauthorized-key>`

- Regularly rotate SSH keys and ensure that only authorized individuals have access to the private keys. Monitor and review the Azure Activity Log and Azure Security Center for any suspicious activities or indicators of key tampering.

#### Using Python

To remediate unauthorized access, privilege escalation, and key tampering related to Microsoft.Compute.sshPublicKeys.write in Azure for Azure Virtual Machines, you can follow these steps using Python:

1. Unauthorized access:
   - Use Azure SDK for Python to retrieve a list of all virtual machines in the Azure environment.
   - For each virtual machine, check if any unauthorized SSH public keys are associated with it.
   - If unauthorized keys are found, remove them using the Azure SDK's API for managing SSH public keys.

2. Privilege escalation:
   - Use Azure SDK for Python to retrieve a list of all virtual machines in the Azure environment.
   - For each virtual machine, check if any unauthorized SSH public keys are associated with it.
   - If unauthorized keys are found, remove them using the Azure SDK's API for managing SSH public keys.
   - Implement strict access controls and RBAC (Role-Based Access Control) to prevent unauthorized users from modifying SSH public keys.

3. Key tampering:
   - Use Azure SDK for Python to retrieve a list of all virtual machines in the Azure environment.
   - For each virtual machine, compare the existing SSH public keys with a trusted list of keys.
   - If any keys are found to be tampered or modified, replace them with the trusted keys using the Azure SDK's API for managing SSH public keys.
   - Regularly monitor and audit SSH public keys associated with virtual machines to detect any tampering attempts.

Please note that the exact implementation of these steps may vary based on the specific Azure SDK version and the requirements of your environment.


 