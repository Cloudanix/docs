--- 
slug: Microsoft.Compute.disks.write
eventname: Microsoft.Compute.disks.write
title: Microsoft.Compute.disks.write
sidebar_label: Microsoft.Compute.disks.write
---
                       
### Event Information

- The Microsoft.Compute.disks.write event in Azure for AzureVirtualMachines refers to an event that is triggered when a write operation is performed on a disk attached to a virtual machine in Azure.
- This event indicates that data has been written to the disk, which could include activities such as creating, modifying, or deleting files on the disk.
- Monitoring and analyzing this event can provide insights into the disk activity of virtual machines, helping to track changes, identify potential issues, and ensure proper disk management in Azure environments.


### Examples

1. Unauthorized write access to Azure virtual machine disks: If security is impacted with Microsoft.Compute.disks.write, it could potentially allow unauthorized users or malicious actors to write data to the disks of Azure virtual machines. This could lead to data breaches, unauthorized access to sensitive information, or the introduction of malicious software into the virtual machine.

2. Data integrity and confidentiality risks: If security is compromised with Microsoft.Compute.disks.write, it could result in the loss of data integrity and confidentiality. Unauthorized write access to virtual machine disks could lead to the modification or deletion of critical data, compromising the integrity of the system. Additionally, sensitive data stored on the disks could be accessed or exfiltrated, leading to breaches of confidentiality.

3. Compliance violations: Security impacts with Microsoft.Compute.disks.write can also result in compliance violations. Depending on the industry and regulatory requirements, unauthorized write access to virtual machine disks may violate data protection and privacy regulations. This can lead to legal consequences, financial penalties, and reputational damage for organizations.

### Remediation

#### Using Console

To remediate unauthorized write access to Azure virtual machine disks, you can follow these steps using the Azure console:

1. Review and update access control: 
   - Identify the users or roles that have the Microsoft.Compute.disks.write permission.
   - Remove any unnecessary or unauthorized users or roles from having this permission.
   - Ensure that only trusted and authorized individuals or roles have write access to the virtual machine disks.

2. Enable disk encryption:
   - Implement Azure Disk Encryption to protect the data stored on the virtual machine disks.
   - This will help prevent unauthorized access to the data even if someone gains write access to the disks.
   - Follow the Azure documentation to enable disk encryption for Azure virtual machines.

3. Monitor and detect unauthorized access:
   - Set up monitoring and logging for Azure virtual machines to detect any unauthorized write access attempts.
   - Utilize Azure Monitor or Azure Security Center to receive alerts and notifications for any suspicious activities.
   - Regularly review the logs and investigate any potential security incidents to take appropriate actions.

By following these steps, you can mitigate the risks associated with unauthorized write access to Azure virtual machine disks, ensure data integrity and availability, and address compliance and regulatory concerns.

#### Using CLI

1. To remediate unauthorized write access to Azure virtual machine disks, you can use Azure RBAC (Role-Based Access Control) to restrict permissions and ensure only authorized users have write access to the disks. You can follow these steps using Azure CLI commands:

- Identify the affected virtual machine: `az vm show --name <vm_name> --resource-group <resource_group_name>`

- Remove the unauthorized write access role assignment: `az role assignment delete --assignee <user_or_group_id> --scope <disk_id>`

- Grant appropriate write access to authorized users: `az role assignment create --assignee <user_or_group_id> --role "Virtual Machine Contributor" --scope <disk_id>`

2. To mitigate data integrity and availability risks, you can enable Azure Backup for your virtual machine disks. This will provide regular backups and allow you to restore data in case of any modifications or deletions. Follow these steps using Azure CLI commands:

- Enable Azure Backup for the virtual machine: `az backup protection enable-for-vm --vm <vm_name> --resource-group <resource_group_name>`

- Configure backup policy and schedule: `az backup policy create --name <policy_name> --resource-group <resource_group_name> --backup-management-type AzureIaasVM --workload-type VM --retention-days <number_of_days>`

- Monitor backup status and perform restores if necessary: `az backup job list --resource-group <resource_group_name> --output table`

3. To address compliance and regulatory concerns, you should implement encryption at rest for the virtual machine disks. This will ensure that even if unauthorized write access occurs, the data remains protected. Use the following Azure CLI commands:

- Enable disk encryption for the virtual machine: `az vm encryption enable --name <vm_name> --resource-group <resource_group_name>`

- Monitor encryption status: `az vm encryption show --name <vm_name> --resource-group <resource_group_name>`

- Regularly review and update encryption keys and certificates to maintain compliance: `az keyvault key update --name <key_name> --vault-name <key_vault_name> --resource-group <resource_group_name>`

#### Using Python

To remediate unauthorized write access to Azure virtual machine disks, you can take the following steps using Python scripts:

1. Implement Role-Based Access Control (RBAC): Use the Azure SDK for Python to assign appropriate roles and permissions to users or service principals. Restrict the Microsoft.Compute.disks.write permission to only authorized individuals or groups. This can be achieved by creating a custom RBAC role or using built-in roles like "Contributor" or "Virtual Machine Contributor".

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Define the role assignment
role_assignment = {
    "properties": {
        "roleDefinitionId": "/subscriptions/{subscriptionId}/providers/Microsoft.Authorization/roleDefinitions/{roleDefinitionId}",
        "principalId": "{principalId}"
    }
}

# Create the role assignment
authorization_client.role_assignments.create(scope, role_assignment)
```

2. Enable Azure Disk Encryption: Encrypt the virtual machine disks to protect the data at rest. This can be done using the Azure SDK for Python by enabling Azure Disk Encryption for the virtual machines. This ensures that even if unauthorized write access occurs, the data remains encrypted and inaccessible.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
compute_client = ComputeManagementClient(credential, subscription_id)

# Enable Azure Disk Encryption for the virtual machine
compute_client.virtual_machines.enable_disk_encryption(resource_group_name, vm_name, disk_encryption_keyvault_id)
```

3. Implement Network Security Groups (NSGs): Configure NSGs to restrict inbound and outbound traffic to the virtual machines. This helps prevent unauthorized access and reduces the attack surface. Use the Azure SDK for Python to create and apply NSG rules to the virtual machine's network interface.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
network_client = NetworkManagementClient(credential, subscription_id)

# Create an NSG rule to allow necessary traffic
nsg_rule = {
    "properties": {
        "protocol": "Tcp",
        "sourcePortRange": "*",
        "destinationPortRange": "22",
        "sourceAddressPrefix": "*",
        "destinationAddressPrefix": "*",
        "access": "Allow",
        "priority": 100,
        "direction": "Inbound"
    }
}

# Create the NSG rule
network_client.security_rules.create_or_update(resource_group_name, nsg_name, rule_name, nsg_rule)
```

By implementing these measures, you can mitigate the risks associated with unauthorized write access to Azure virtual machine disks, ensure data integrity and availability, and address compliance and regulatory concerns.


 