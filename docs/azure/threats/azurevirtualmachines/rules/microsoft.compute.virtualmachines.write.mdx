--- 
slug: Microsoft.Compute.virtualMachines.write
eventname: Microsoft.Compute.virtualMachines.write
title: Microsoft.Compute.virtualMachines.write
sidebar_label: Microsoft.Compute.virtualMachines.write
---
                       
### Event Information

- The Microsoft.Compute.virtualMachines.write event in Azure for AzureVirtualMachines refers to the action of creating or updating a virtual machine in the Azure Compute service.
- This event is triggered when a user or an automated process initiates the creation or modification of a virtual machine configuration, such as changing the size, adding or removing disks, or updating the network settings.
- It is an important event to monitor as it indicates changes to the virtual machine infrastructure, which can impact the availability, performance, and security of the virtual machine and the applications running on it.


### Examples

1. Unauthorized creation of virtual machines: If security is impacted with Microsoft.Compute.virtualMachines.write permission, it could potentially allow unauthorized users to create virtual machines within the Azure environment. This can lead to the deployment of malicious or unauthorized resources, which can compromise the security of the entire infrastructure.

2. Data exfiltration: With the ability to write to virtual machines, an attacker could potentially gain access to sensitive data stored within the virtual machines. They could exfiltrate this data, leading to a data breach and potential compliance violations.

3. Resource exhaustion: If security is compromised and unauthorized users are able to create virtual machines, it can lead to resource exhaustion within the Azure environment. This can impact the performance and availability of legitimate resources, affecting the overall functionality of the infrastructure.

### Remediation

#### Using Console

1. Unauthorized creation of virtual machines: To remediate this issue, follow these steps:
   - Review and update the Azure RBAC (Role-Based Access Control) permissions for the affected user or group. Remove the Microsoft.Compute.virtualMachines.write permission if it is not necessary for their role.
   - Implement Azure Policy to enforce restrictions on virtual machine creation. You can create a policy that denies the creation of virtual machines unless specific conditions are met, such as the use of approved templates or the presence of specific tags.
   - Regularly monitor and audit virtual machine creation activities using Azure Monitor or Azure Security Center. Set up alerts to notify you of any unauthorized attempts to create virtual machines.

2. Modification of virtual machine configurations: To remediate this issue, take the following steps:
   - Review and update the Azure RBAC permissions for the affected user or group. Remove the Microsoft.Compute.virtualMachines.write permission if it is not required for their role.
   - Enable Azure Security Center's Just-In-Time VM Access feature to restrict access to virtual machine configurations. This feature allows you to define specific time windows and IP ranges for administrative access, reducing the attack surface.
   - Implement Azure Policy to enforce configuration baselines for virtual machines. This ensures that any unauthorized modifications are detected and remediated automatically.

3. Escalation of privileges: To remediate this issue, consider the following actions:
   - Review and update the Azure RBAC permissions for the affected user or group. Remove the Microsoft.Compute.virtualMachines.write permission if it is not necessary for their role.
   - Implement the principle of least privilege by assigning users or groups with only the necessary permissions to create and manage virtual machines.
   - Regularly review and monitor Azure AD sign-ins and audit logs to detect any suspicious activities or signs of privilege escalation. Enable Azure AD Privileged Identity Management (PIM) to enforce just-in-time access and periodic access reviews for privileged roles.

#### Using CLI

1. To remediate unauthorized creation of virtual machines in Azure using Azure CLI commands, you can:

- Identify and remove the unauthorized user's permissions by revoking the Microsoft.Compute.virtualMachines.write permission. Use the following command:
  `az role assignment delete --assignee <user or group principal ID> --role "Virtual Machine Contributor"`

- Implement Azure RBAC (Role-Based Access Control) to ensure that only authorized users have the necessary permissions to create virtual machines. Use the following command to assign the appropriate role to the user:
  `az role assignment create --assignee <user or group principal ID> --role "Virtual Machine Contributor" --scope /subscriptions/<subscription ID>/resourceGroups/<resource group name>`

2. To remediate modification of virtual machine configurations in Azure using Azure CLI commands, you can:

- Regularly monitor and audit virtual machine configurations to detect any unauthorized changes. Use the following command to retrieve the virtual machine configuration:
  `az vm show --name <virtual machine name> --resource-group <resource group name>`

- Implement Azure Policy to enforce compliance and prevent unauthorized modifications. Use the following command to create a policy assignment:
  `az policy assignment create --name <policy assignment name> --scope /subscriptions/<subscription ID>/resourceGroups/<resource group name> --policy <policy definition ID>`

3. To remediate escalation of privileges in Azure using Azure CLI commands, you can:

- Regularly review and audit role assignments to identify any unauthorized or excessive permissions. Use the following command to list role assignments:
  `az role assignment list --scope /subscriptions/<subscription ID>/resourceGroups/<resource group name>`

- Implement just-in-time (JIT) access control to limit the duration and scope of privileged access. Use the following command to enable JIT access for a virtual machine:
  `az vm update --name <virtual machine name> --resource-group <resource group name> --set identity.type="SystemAssigned" identity.role="Contributor"`

Note: Replace `<user or group principal ID>`, `<subscription ID>`, `<resource group name>`, `<virtual machine name>`, `<policy assignment name>`, and `<policy definition ID>` with the appropriate values specific to your Azure environment.

#### Using Python

To remediate unauthorized creation of virtual machines, you can:

1. Implement RBAC (Role-Based Access Control) policies: Ensure that only authorized users or roles have the Microsoft.Compute.virtualMachines.write permission. Regularly review and update these permissions to minimize the risk of unauthorized VM creation.

2. Enable Azure Policy: Utilize Azure Policy to enforce specific rules and conditions for VM creation. For example, you can create a policy that restricts VM creation to specific resource groups or limits the VM sizes that can be deployed.

3. Monitor and analyze activity logs: Continuously monitor and analyze Azure activity logs to detect any unauthorized VM creation attempts. Set up alerts or use Azure Monitor to proactively identify and respond to such events.

To remediate modification of virtual machine configurations, you can:

1. Implement Azure Security Center: Enable Azure Security Center to monitor and detect any unauthorized changes to virtual machine configurations. Security Center can provide recommendations and alerts for potential configuration vulnerabilities.

2. Utilize Azure Automation: Leverage Azure Automation to automate the enforcement of desired virtual machine configurations. By regularly checking and enforcing the desired state, any unauthorized modifications can be automatically reverted.

3. Enable Azure Disk Encryption: Enable Azure Disk Encryption to encrypt the virtual machine disks. This ensures that even if an attacker gains access to the VM, they won't be able to access the data without the encryption keys.

To remediate escalation of privileges, you can:

1. Implement just-in-time (JIT) access: Utilize Azure Security Center's JIT access feature to restrict the time window and scope of access for managing virtual machines. This reduces the attack surface and limits the potential for privilege escalation.

2. Regularly review and update RBAC permissions: Continuously review and update RBAC permissions to ensure that only authorized users or roles have the Microsoft.Compute.virtualMachines.write permission. Remove any unnecessary or unused permissions to minimize the risk of privilege escalation.

3. Enable Azure AD Privileged Identity Management (PIM): Utilize Azure AD PIM to enforce just-in-time access for privileged roles. This adds an additional layer of security by requiring approval and time-limited access for privileged actions, reducing the risk of unauthorized privilege escalation.


 