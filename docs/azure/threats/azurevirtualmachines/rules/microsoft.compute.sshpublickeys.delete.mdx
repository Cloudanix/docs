--- 
slug: Microsoft.Compute.sshPublicKeys.delete
eventname: Microsoft.Compute.sshPublicKeys.delete
title: Microsoft.Compute.sshPublicKeys.delete
sidebar_label: Microsoft.Compute.sshPublicKeys.delete
---
                       
### Event Information

- The Microsoft.Compute.sshPublicKeys.delete event in Azure for AzureVirtualMachines indicates that a SSH public key has been deleted for a virtual machine in Azure.
- This event signifies that the SSH access to the virtual machine has been modified, specifically in terms of removing a public key that was previously authorized for SSH access.
- It is important to monitor this event as it can help track any changes made to the SSH access configuration of Azure virtual machines, ensuring the security and access control of the environment.


### Examples

1. Unauthorized access: If security is impacted with Microsoft.Compute.sshPublicKeys.delete in Azure for AzureVirtualMachines, it could potentially allow unauthorized individuals to delete SSH public keys associated with virtual machines. This could lead to unauthorized access to the virtual machines, compromising the confidentiality and integrity of the data stored within them.

2. Disruption of access: Deleting SSH public keys can also result in a disruption of access to the virtual machines for legitimate users. If the keys are deleted accidentally or maliciously, users may no longer be able to establish secure SSH connections to the virtual machines, impacting their ability to manage and administer the resources effectively.

3. Compliance violations: Deleting SSH public keys without proper authorization or documentation can also lead to compliance violations. Many regulatory frameworks require organizations to maintain strict control over access to sensitive data and resources. If SSH public keys are deleted without proper audit trails or approvals, it can result in non-compliance and potential legal consequences.

### Remediation

#### Using Console

1. Unauthorized access:
- Step 1: Log in to the Azure portal using your credentials.
- Step 2: Navigate to the Azure Virtual Machines service.
- Step 3: Select the virtual machine for which you want to manage SSH public keys.
- Step 4: In the left-hand menu, click on "Settings" and then select "SSH public keys".
- Step 5: Review the list of SSH public keys associated with the virtual machine.
- Step 6: Identify any unauthorized or suspicious SSH public keys that need to be deleted.
- Step 7: Select the unauthorized SSH public key and click on the "Delete" button.
- Step 8: Confirm the deletion when prompted.
- Step 9: Regularly monitor and review the SSH public keys associated with your virtual machines to ensure that only authorized keys are present.

2. Disruption of access:
- Step 1: Log in to the Azure portal using your credentials.
- Step 2: Navigate to the Azure Virtual Machines service.
- Step 3: Select the virtual machine for which you want to manage SSH public keys.
- Step 4: In the left-hand menu, click on "Settings" and then select "SSH public keys".
- Step 5: Review the list of SSH public keys associated with the virtual machine.
- Step 6: Ensure that all necessary and authorized SSH public keys are present.
- Step 7: Avoid accidental deletion by double-checking before deleting any SSH public keys.
- Step 8: If a legitimate SSH public key has been accidentally deleted, recreate it and associate it with the virtual machine.

3. Compliance violations:
- Step 1: Establish a clear policy and procedure for managing SSH public keys in accordance with your organization's compliance requirements.
- Step 2: Implement access controls and permissions to ensure that only authorized individuals can manage SSH public keys.
- Step 3: Maintain an audit trail of all SSH public key management activities, including deletions, to demonstrate compliance with regulatory requirements.

#### Using CLI

1. To remediate unauthorized access related to Microsoft.Compute.sshPublicKeys.delete in Azure for AzureVirtualMachines, you can take the following steps:

- Implement strong access controls: Ensure that only authorized individuals have the necessary permissions to delete SSH public keys associated with virtual machines. Use Azure RBAC (Role-Based Access Control) to assign appropriate roles and permissions to users.

- Enable auditing and monitoring: Enable Azure Monitor and Azure Security Center to monitor and detect any unauthorized access attempts or changes to SSH public keys. Regularly review the audit logs to identify any suspicious activities.

- Implement backup and recovery mechanisms: Regularly backup the SSH public keys associated with virtual machines and store them securely. In case of accidental deletion, you can restore the keys from the backup to regain access.

2. To remediate the disruption of access caused by deleting SSH public keys in Azure for AzureVirtualMachines, you can follow these steps:

- Implement redundancy and failover mechanisms: Configure virtual machine scale sets or availability sets to ensure high availability of your virtual machines. This way, if one virtual machine becomes inaccessible due to deleted SSH public keys, the workload can be automatically shifted to another available virtual machine.

- Implement a backup authentication method: Configure alternative authentication methods such as password-based authentication or Azure AD integration alongside SSH public key authentication. This will provide an alternative way for legitimate users to access the virtual machines in case of SSH public key deletion.

- Regularly test and validate access: Conduct regular access testing to ensure that legitimate users can authenticate and access the virtual machines. This will help identify any access issues and allow for timely remediation.

3. To avoid compliance violations related to unauthorized deletion of SSH public keys in Azure for AzureVirtualMachines, consider the following measures:

- Implement access control policies: Define and enforce access control policies that align with your organization's compliance requirements. This includes ensuring that only authorized individuals can delete SSH public keys and maintaining proper documentation and approval processes.

- Enable audit logging and reporting: Enable Azure Monitor and Azure Security Center to capture detailed audit logs of all activities related to SSH public keys. Regularly review these logs to identify any unauthorized deletions and take appropriate actions.

- Conduct regular compliance assessments: Perform regular compliance assessments to ensure that your organization is adhering to the necessary compliance standards. This includes verifying that proper access controls and audit trails are in place for SSH public keys.

CLI commands:
- To assign RBAC roles for managing SSH public keys:
  `az role assignment create --role "Virtual Machine Contributor" --assignee <user or group> --scope /subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.Compute/virtualMachines/<virtual-machine-name>`

- To enable Azure Monitor for auditing SSH public key deletions:
  `az monitor diagnostic-settings create --name <diagnostic-settings-name> --resource /subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.Compute/virtualMachines/<virtual-machine-name> --logs '[{"category": "AuditEvent", "enabled": true}]'`

- To configure backup and recovery for SSH public keys:
  `az backup protection enable-for-vm --resource-group <resource-group> --vault-name <vault-name> --vm <virtual-machine-name> --policy-name <policy-name>`

Note: Replace the placeholders (<>) with the actual values specific to your environment.

#### Using Python

To remediate unauthorized access and disruption of access related to Microsoft.Compute.sshPublicKeys.delete in Azure for AzureVirtualMachines, you can follow these steps using Python scripts:

1. Implement access controls: Ensure that only authorized individuals have the necessary permissions to delete SSH public keys associated with virtual machines. This can be achieved by using Azure RBAC (Role-Based Access Control) to assign appropriate roles and permissions to users. You can use the `azure-mgmt-authorization` Python package to manage RBAC roles programmatically.

2. Enable auditing and monitoring: Implement auditing and monitoring mechanisms to track any changes made to SSH public keys. Azure provides Azure Monitor, which can be used to collect and analyze logs related to SSH key deletions. You can use the `azure-monitor` Python package to configure and retrieve logs programmatically.

3. Implement backup and recovery: Regularly backup SSH public keys associated with virtual machines to ensure that they can be restored in case of accidental or malicious deletion. You can use the Azure Key Vault service to securely store and manage SSH keys. The `azure-keyvault-secrets` Python package can be used to interact with Azure Key Vault programmatically.

Example Python script to delete SSH public keys for AzureVirtualMachines:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()

# Specify your Azure subscription ID
subscription_id = 'your_subscription_id'

# Specify the resource group and virtual machine name
resource_group_name = 'your_resource_group_name'
vm_name = 'your_virtual_machine_name'

# Create a ComputeManagementClient instance
compute_client = ComputeManagementClient(credential, subscription_id)

# Delete SSH public keys for the virtual machine
compute_client.virtual_machines.delete_ssh_public_key(
    resource_group_name,
    vm_name,
    ssh_public_key_name='your_ssh_public_key_name'
)
```

Note: Replace the placeholders (`your_subscription_id`, `your_resource_group_name`, `your_virtual_machine_name`, `your_ssh_public_key_name`) with the actual values specific to your Azure environment.


 