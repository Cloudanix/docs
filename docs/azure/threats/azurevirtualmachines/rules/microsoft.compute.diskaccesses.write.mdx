--- 
slug: Microsoft.Compute.diskAccesses.write
eventname: Microsoft.Compute.diskAccesses.write
title: Microsoft.Compute.diskAccesses.write
sidebar_label: Microsoft.Compute.diskAccesses.write
---
                       
### Event Information

- The Microsoft.Compute.diskAccesses.write event in Azure for AzureVirtualMachines refers to a write operation performed on a disk attached to a virtual machine in the Azure environment.
- This event indicates that data has been written to the disk, which could include activities such as creating or modifying files, installing software, or saving changes to a database.
- Monitoring and analyzing the Microsoft.Compute.diskAccesses.write event can provide insights into the disk usage patterns, performance, and potential issues related to write operations on Azure virtual machines.


### Examples

1. Unauthorized write access: If security is impacted with Microsoft.Compute.diskAccesses.write in Azure for AzureVirtualMachines, it could indicate that there is unauthorized write access to the virtual machine's disks. This could be a potential security breach, as it means someone has gained unauthorized access to the virtual machine and is able to modify or tamper with the data stored on the disks.

2. Malware or ransomware attack: Another example could be that the virtual machine has been compromised by malware or ransomware, which is causing unauthorized write access to the disks. This could result in data loss, data corruption, or even the encryption of the data on the disks, leading to potential financial and operational impacts.

3. Misconfiguration or mismanagement: A third example could be a misconfiguration or mismanagement of access controls or permissions within the Azure environment. This could allow unintended users or processes to have write access to the virtual machine's disks, potentially leading to unauthorized modifications or data breaches.

In all these cases, it is crucial to investigate and remediate the security impact promptly to prevent further damage and ensure the integrity and confidentiality of the data stored on the virtual machine's disks.

### Remediation

#### Using Console

To remediate unauthorized write access for AzureVirtualMachines in Azure using the Azure console, you can follow these steps:

1. Identify the source of unauthorized write access: 
   - Review the Azure Activity Log and Azure Security Center alerts to identify any suspicious activities or indicators of compromise.
   - Check the access control settings for the virtual machine and its associated disks to ensure that only authorized users or processes have write access.

2. Remove unauthorized access and mitigate the security breach:
   - Disable or remove any user accounts or processes that have unauthorized write access to the virtual machine's disks.
   - Change the passwords or access keys for the affected accounts to prevent further unauthorized access.
   - Consider restoring the virtual machine from a known good backup or snapshot to ensure the integrity of the data.

3. Strengthen security controls and prevent future incidents:
   - Review and update the access control settings for the virtual machine and its disks to ensure that only necessary permissions are granted.
   - Implement multi-factor authentication (MFA) for user accounts to add an extra layer of security.
   - Regularly monitor and review the Azure Security Center recommendations and apply any necessary security patches or updates to prevent vulnerabilities.

It is important to note that the specific steps may vary depending on the Azure services and configurations in your environment. It is recommended to consult Azure documentation and seek assistance from Azure support if needed.

#### Using CLI

To remediate unauthorized write access for AzureVirtualMachines in Azure using Azure CLI, you can follow these steps:

1. Identify the source of unauthorized write access:
   - Use Azure Monitor or Azure Security Center to analyze logs and identify any suspicious activities or access patterns.
   - Review the audit logs for the virtual machine and associated resources to determine the source of the unauthorized write access.

2. Secure the virtual machine and disks:
   - Change the administrative credentials for the virtual machine to prevent further unauthorized access.
   - Enable disk encryption to protect the data stored on the disks from unauthorized modifications.
   - Implement network security groups (NSGs) to restrict inbound and outbound traffic to the virtual machine, ensuring only necessary ports and protocols are allowed.

3. Review and update access controls:
   - Regularly review and update access controls and permissions for the virtual machine and associated resources.
   - Remove any unnecessary or unused user accounts or service principals that may have write access to the disks.
   - Implement just-in-time (JIT) access controls to limit the exposure of administrative access to the virtual machine.

CLI commands:
- To change administrative credentials: `az vm update -g <resource-group> -n <vm-name> --admin-username <new-username> --admin-password <new-password>`
- To enable disk encryption: `az vm encryption enable -g <resource-group> -n <vm-name> --disk-encryption-keyvault <keyvault-name> --key-encryption-keyvault <keyvault-name>`
- To configure NSGs: `az network nsg rule create -g <resource-group> --nsg-name <nsg-name> --name <rule-name> --priority <priority> --source-address-prefixes <source-address-prefixes> --destination-address-prefixes <destination-address-prefixes> --destination-port-ranges <destination-port-ranges> --access <access> --protocol <protocol>`

Note: Replace `<resource-group>`, `<vm-name>`, `<new-username>`, `<new-password>`, `<keyvault-name>`, `<nsg-name>`, `<rule-name>`, `<priority>`, `<source-address-prefixes>`, `<destination-address-prefixes>`, `<destination-port-ranges>`, `<access>`, and `<protocol>` with the appropriate values for your environment.

#### Using Python

To remediate unauthorized write access for AzureVirtualMachines in Azure, you can use the following steps:

1. Identify the source of unauthorized write access: 
   - Review the Azure Activity Logs and Azure Security Center alerts to identify any suspicious activities or indicators of compromise.
   - Use Azure Monitor to track disk write operations and identify any abnormal patterns or spikes in write activity.

2. Secure the virtual machine and disks:
   - Change all administrative passwords and ensure strong password policies are in place.
   - Enable disk encryption using Azure Disk Encryption to protect data at rest.
   - Implement network security groups (NSGs) to restrict inbound and outbound traffic to the virtual machine.
   - Regularly update and patch the virtual machine's operating system and software to mitigate vulnerabilities.

3. Review and update access controls:
   - Audit and review the access controls and permissions for the virtual machine and its disks.
   - Remove any unnecessary or unused user accounts or service principals.
   - Implement just-in-time (JIT) access controls to limit the exposure of administrative access.
   - Regularly review and update access control policies to ensure they align with the principle of least privilege.

Here is an example of a Python script that uses the Azure SDK for Python (azure-mgmt-compute) to implement some of the above steps:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
compute_client = ComputeManagementClient(credential, subscription_id)

# Step 1: Identify the source of unauthorized write access
# TODO: Implement code to review Azure Activity Logs and Security Center alerts

# Step 2: Secure the virtual machine and disks
# TODO: Implement code to change administrative passwords, enable disk encryption, and configure NSGs

# Step 3: Review and update access controls
# TODO: Implement code to audit and update access controls and permissions

# Additional steps: Update and patch the virtual machine
# TODO: Implement code to update and patch the virtual machine's operating system and software
```

Please note that the above script provides a starting point and may need to be customized based on your specific requirements and environment.


 