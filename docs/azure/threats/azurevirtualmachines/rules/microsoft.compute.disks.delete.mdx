--- 
slug: Microsoft.Compute.disks.delete
eventname: Microsoft.Compute.disks.delete
title: Microsoft.Compute.disks.delete
sidebar_label: Microsoft.Compute.disks.delete
---
                       
### Event Information

#### Meaning

None

### Remediation

#### Using Console

- Example: If security is impacted with Microsoft.Compute.disks.delete in Azure for Azure Virtual Machines, it means that an unauthorized user or process has the ability to delete disks associated with Azure Virtual Machines. This can lead to data loss, service disruption, and potential security breaches.

- Remediation Steps using Azure Console:
  1. Identify the affected Azure Virtual Machine: Go to the Azure portal and navigate to the Virtual Machines section.
  2. Review the access control settings: Check the role-based access control (RBAC) assignments for the affected Azure Virtual Machine. Ensure that only authorized users or groups have the necessary permissions to delete disks.
  3. Update RBAC permissions: If unauthorized users or groups have the necessary permissions, remove them from the RBAC assignments. If necessary, add additional RBAC assignments to restrict disk deletion to only authorized users or groups.

Note: It is recommended to regularly review and audit RBAC assignments to ensure that only authorized users have the necessary permissions to perform critical operations like disk deletion. Additionally, enabling Azure Disk Encryption and implementing backup and disaster recovery strategies can help mitigate the impact of disk deletion incidents.

#### Using CLI

- Example: If security is impacted with `Microsoft.Compute.disks.delete` in Azure for `AzureVirtualMachines`, it means that an unauthorized user or process has the ability to delete disks associated with virtual machines, which can lead to data loss or service disruption.

- Remediation steps using AZU CLI:
  1. Grant the necessary permissions: Ensure that only authorized users or processes have the permission to delete disks associated with virtual machines. This can be achieved by assigning the appropriate RBAC roles to the users or service principals. For example, the `Contributor` role can be assigned to allow disk deletion.
  2. Enable disk deletion audit logging: Enable audit logging for disk deletion operations to track any unauthorized or suspicious activities. This can be done by configuring Azure Monitor or Azure Sentinel to capture and analyze the relevant logs.
  3. Implement disk deletion protection: Enable disk deletion protection to prevent accidental or unauthorized deletion of disks. This can be achieved by enabling the soft delete feature for managed disks, which allows recovery of deleted disks within a specified retention period.

CLI commands:
- Granting RBAC role:
  ```
  az role assignment create --role "Contributor" --assignee <user or service principal ID> --scope <resource group or subscription ID>
  ```

- Enabling disk deletion audit logging:
  ```
  az monitor diagnostic-settings create --name <diagnostic settings name> --resource <virtual machine resource ID> --logs '[{"category": "DiskDeletionOperations", "enabled": true}]'
  ```

- Enabling disk deletion protection:
  ```
  az disk update --name <disk name> --resource-group <resource group name> --set properties.softDeleteEnabled=true
  ```

#### Using Python

Example of security impact: If an unauthorized user gains access to the Azure Virtual Machine (VM) and executes the `Microsoft.Compute.disks.delete` operation, they can delete the disks associated with the VM. This can result in data loss and disruption of services running on the VM.

Remediation for AZU AzureVirtualMachines using Python:

1. Implement RBAC (Role-Based Access Control): Ensure that only authorized users have the necessary permissions to perform disk deletion operations on Azure Virtual Machines. Assign the appropriate roles (e.g., Virtual Machine Contributor) to users or groups who require disk deletion capabilities.

2. Enable Azure Disk Encryption: By enabling Azure Disk Encryption, you can encrypt the VM disks at rest. This provides an additional layer of security and prevents unauthorized access to the disk data even if the disks are deleted.

3. Monitor and alert on disk deletion events: Implement monitoring and alerting mechanisms to detect and respond to disk deletion events. Azure Monitor can be used to create custom alerts based on specific criteria, such as the `Microsoft.Compute.disks.delete` operation. This allows you to quickly identify and mitigate any unauthorized disk deletion attempts.

Python script example for RBAC implementation:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()

# Create AuthorizationManagementClient
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Assign role to a user or group
authorization_client.role_assignments.create(
    scope="/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.Compute/virtualMachines/{vm_name}",
    role_definition_id="/subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{role_definition_id}",
    principal_id="{principal_id}"
)
```

Python script example for enabling Azure Disk Encryption:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()

# Create ComputeManagementClient
compute_client = ComputeManagementClient(credential, subscription_id)

# Enable Azure Disk Encryption for a VM
compute_client.virtual_machines.begin_enable_disk_encryption(
    resource_group_name="{resource_group}",
    vm_name="{vm_name}",
    disk_encryption_keyvault_id="/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.KeyVault/vaults/{key_vault_name}",
    key_encryption_keyvault_id="/subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.KeyVault/vaults/{key_vault_name}",
    disk_encryption_keyvault_url="{key_vault_url}"
).wait()
```

Please note that the provided Python scripts are simplified examples and may require additional modifications based on your specific environment and requirements.


 