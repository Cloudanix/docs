--- 
slug: Microsoft.AAD.domainServices.delete
eventname: Microsoft.AAD.domainServices.delete
title: Microsoft.AAD.domainServices.delete
sidebar_label: Microsoft.AAD.domainServices.delete
---
                       
### Event Information

- The Microsoft.AAD.domainServices.delete event in Azure for Azure Identity Management refers to the deletion of an Azure Active Directory (AAD) Domain Service.
- This event indicates that the AAD Domain Service, which provides managed domain services such as domain join, LDAP, and Kerberos authentication, has been deleted.
- The event signifies that any associated resources and configurations related to the AAD Domain Service have been removed, and any dependent services or applications may be affected.


### Examples

1. Unauthorized deletion of Azure Active Directory (AAD) domain services: If security is impacted with Microsoft.AAD.domainServices.delete in Azure for Azure Identity Management, it could potentially lead to unauthorized deletion of AAD domain services. This can result in the loss of critical user and group information, as well as the disruption of authentication and authorization processes within the Azure environment.

2. Compromise of user identities and access controls: The security impact of Microsoft.AAD.domainServices.delete can also manifest in the compromise of user identities and access controls. If an attacker gains unauthorized access to delete AAD domain services, they may be able to manipulate user identities, modify access permissions, and potentially gain elevated privileges within the Azure environment.

3. Disruption of dependent services and applications: Deleting AAD domain services can have a cascading effect on dependent services and applications within the Azure environment. This can lead to service disruptions, loss of data, and potential breaches if the impacted services rely on AAD for authentication and authorization. It is crucial to ensure proper backup and recovery mechanisms are in place to mitigate the security impact of such deletions.

### Remediation

#### Using Console

1. Unauthorized deletion of Azure Active Directory (AAD) domain services can be remediated by following these steps in the Azure console:

- Step 1: Access the Azure portal and navigate to the Azure Active Directory service.
- Step 2: Select the "Domain Services" option from the left-hand menu.
- Step 3: Identify the affected AAD domain service and click on it to access its settings.
- Step 4: In the domain service settings, go to the "Properties" tab.
- Step 5: Enable the "Delete" protection feature, which adds an additional layer of security to prevent unauthorized deletions.
- Step 6: Save the changes and ensure that the protection feature is enabled for the AAD domain service.

2. To mitigate the compromise of user identities and access controls in Azure Identity Management:

- Step 1: Access the Azure portal and navigate to the Azure Active Directory service.
- Step 2: Select the "Users" option from the left-hand menu.
- Step 3: Review the list of users and identify any suspicious or compromised accounts.
- Step 4: Disable or delete the compromised accounts to prevent further unauthorized access.
- Step 5: Implement multi-factor authentication (MFA) for all user accounts to add an extra layer of security.
- Step 6: Regularly review and update access controls and permissions to ensure that only authorized users have appropriate access.

3. To mitigate the disruption of dependent services and applications caused by the deletion of AAD domain services:

- Step 1: Identify all the services and applications that rely on AAD for authentication and authorization.
- Step 2: Implement a backup and recovery strategy for these services and applications to ensure data can be restored in case of disruptions.
- Step 3: Regularly test the backup and recovery mechanisms to ensure their effectiveness.
- Step 4: Implement redundancy and failover mechanisms for critical services to minimize the impact of disruptions.
- Step 5: Monitor the health and availability of dependent services and applications to detect any issues early on.
- Step 6: Implement proper access controls and permissions to prevent unauthorized modifications or deletions of AAD domain services.

#### Using CLI

1. To remediate unauthorized deletion of Azure Active Directory (AAD) domain services, you can take the following steps using Azure CLI:

- Monitor and audit AAD domain services: Regularly review the Azure Activity Log and Azure Monitor logs to identify any suspicious activities related to AAD domain services. Use the following command to retrieve the logs:
  ```
  az monitor activity-log list --resource-group <resource-group-name> --resource-type Microsoft.AAD/domainServices
  ```

- Implement RBAC and access controls: Ensure that proper Role-Based Access Control (RBAC) is in place to restrict the deletion of AAD domain services to authorized users only. Use the following command to assign RBAC roles:
  ```
  az role assignment create --assignee <user-or-group-id> --role <role-name> --scope <resource-id>
  ```

- Enable backup and recovery: Set up regular backups of AAD domain services to enable quick recovery in case of accidental or unauthorized deletions. Use the following command to configure backups:
  ```
  az aks update --resource-group <resource-group-name> --name <aad-domain-service-name> --backup-properties '{"enabled": true}'
  ```

2. To remediate the compromise of user identities and access controls due to unauthorized deletion of AAD domain services, you can take the following steps using Azure CLI:

- Reset compromised user identities: If user identities have been compromised, reset their passwords and enable multi-factor authentication (MFA) to enhance security. Use the following command to reset a user's password:
  ```
  az ad user update --id <user-id> --password <new-password>
  ```

- Review and restore access controls: Audit and restore access controls to ensure that unauthorized changes made to user permissions are reverted. Use the following command to review and restore access controls:
  ```
  az ad group owner list --group <group-id>
  az ad group owner add --group <group-id> --owner-object-id <owner-object-id>
  ```

- Monitor for suspicious activities: Continuously monitor user activities and access logs to detect any further unauthorized changes or suspicious behavior. Use the following command to retrieve user sign-in logs:
  ```
  az monitor activity-log list --resource-group <resource-group-name> --resource-type Microsoft.AAD/domainServices --filter "eventTimestamp ge <start-time> and eventTimestamp le <end-time> and operationName eq 'Microsoft.AAD/domainServices.delete'"
  ```

3. To remediate the disruption of dependent services and applications caused by the deletion of AAD domain services, you can take the following steps using Azure CLI:

- Restore AAD domain services from backup: If AAD domain services are deleted, restore them from the latest backup to minimize service disruptions. Use the following command to restore from backup:
  ```
  az aks update --resource-group <resource-group-name> --name <aad-domain-service-name> --backup-properties '{"restorePoint": "<restore-point-id>"}'
  ```

- Update dependent services and applications: Once AAD domain services are restored, update the configurations of dependent services and applications to point to the newly restored AAD domain services. This may involve updating connection strings, authentication settings, and access control configurations.

- Test and validate service functionality: After updating the configurations, thoroughly test and validate the functionality of dependent services and applications to ensure they are functioning correctly with the restored AAD domain services.

#### Using Python

1. To remediate unauthorized deletion of Azure Active Directory (AAD) domain services, you can implement the following steps using Python:

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.aad import AzureADManagementClient

# Set the Azure credentials
credential = DefaultAzureCredential()

# Set the Azure AD management client
aad_client = AzureADManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Retrieve the AAD domain services
domain_services = aad_client.domain_services.list()

# Implement proper access controls and permissions to prevent unauthorized deletion
# Ensure that only authorized users have the necessary permissions to delete AAD domain services

# Implement monitoring and alerting mechanisms to detect any unauthorized deletion attempts
# Utilize Azure Monitor or other monitoring tools to track and analyze AAD domain service activities

# Enable Azure AD Privileged Identity Management (PIM) to enforce just-in-time access and approval workflows for critical operations like deletion

# Regularly backup AAD domain services and implement a disaster recovery plan to restore the services in case of accidental or unauthorized deletion
```

2. To remediate the compromise of user identities and access controls due to unauthorized deletion of AAD domain services, you can take the following steps using Python:

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.aad import AzureADManagementClient

# Set the Azure credentials
credential = DefaultAzureCredential()

# Set the Azure AD management client
aad_client = AzureADManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Implement multi-factor authentication (MFA) for user identities to add an extra layer of security

# Regularly review and audit user identities and access controls to identify any unauthorized changes or suspicious activities

# Implement Azure AD Conditional Access policies to enforce specific access controls based on user, device, location, and other factors

# Enable Azure AD Identity Protection to detect and respond to potential identity compromises and risky user behaviors

# Implement role-based access control (RBAC) to ensure that users have the appropriate permissions and access levels based on their roles and responsibilities
```

3. To remediate the disruption of dependent services and applications caused by the deletion of AAD domain services, you can follow these steps using Python:

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.aad import AzureADManagementClient

# Set the Azure credentials
credential = DefaultAzureCredential()

# Set the Azure AD management client
aad_client = AzureADManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Implement proper dependency management and documentation to identify services and applications relying on AAD domain services

# Implement backup and recovery mechanisms for dependent services and applications to minimize data loss and service interruptions

# Implement redundancy and failover mechanisms for critical services to ensure high availability even in the event of AAD domain service disruptions

# Regularly test and validate the backup, recovery, and failover mechanisms to ensure their effectiveness

# Implement proper monitoring and alerting mechanisms to detect any service disruptions or anomalies caused by AAD domain service deletions
```

Please note that the provided Python scripts are just examples and may need to be customized based on your specific environment and requirements.


 