--- 
slug: Add service principal credentials
eventname: Add service principal credentials
title: Add service principal credentials
sidebar_label: Add service principal credentials
---
                       
### Event Information

1. The "Add service principal credentials" event in Azure Active Directory refers to the action of adding credentials (such as passwords or certificates) to a service principal object in Azure AD.
2. Service principals are used to authenticate and authorize applications and services to access Azure resources. By adding credentials to a service principal, you are providing it with the necessary authentication information to access resources on behalf of the application or service it represents.
3. This event is important for managing access control and security in Azure AD, as it allows you to grant specific permissions and control the level of access that a service principal has to Azure resources.


### Examples

1. Unauthorized access: If the service principal credentials are compromised or not properly secured, it can lead to unauthorized access to Azure resources. This can result in data breaches, unauthorized modifications, or even complete loss of control over the affected resources.

2. Privilege escalation: If the service principal credentials have excessive permissions or are misconfigured, it can lead to privilege escalation attacks. Attackers can exploit this to gain higher levels of access within the Azure environment, potentially compromising sensitive data or causing damage to the infrastructure.

3. Credential leakage: If the service principal credentials are inadvertently exposed or stored insecurely, it can lead to credential leakage. This can occur through misconfigured storage, insecure code repositories, or insecure communication channels. Once the credentials are leaked, attackers can use them to impersonate the service principal and gain unauthorized access to Azure resources.

### Remediation

#### Using Console

To remediate unauthorized access, privilege escalation, and credential leakage in Azure Active Directory using the Azure console, you can follow these steps:

1. Unauthorized access:
   - Rotate the compromised service principal credentials by generating new credentials.
   - Ensure that the new credentials are securely stored and not shared with unauthorized individuals.
   - Review and update the access control policies for the affected Azure resources to restrict access to only authorized users or roles.

2. Privilege escalation:
   - Review the permissions assigned to the service principal and remove any excessive or unnecessary permissions.
   - Implement the principle of least privilege by granting only the minimum required permissions to the service principal.
   - Regularly review and update the permissions assigned to the service principal to ensure they align with the principle of least privilege.

3. Credential leakage:
   - Conduct a thorough investigation to identify the source of the credential leakage.
   - Once identified, secure the storage, code repositories, or communication channels where the credentials were leaked.
   - Implement secure storage practices, such as encrypting the credentials at rest and in transit, and regularly monitor for any potential leaks or vulnerabilities.

Note: It is recommended to involve your organization's security team or a certified Azure professional to ensure proper remediation and adherence to security best practices.

#### Using CLI

1. Unauthorized access:
- Rotate the compromised service principal credentials immediately to prevent further unauthorized access. This can be done using the Azure CLI command: `az ad sp credential reset --name <service_principal_name> --password <new_password>`.
- Review and update the access permissions of the service principal to ensure that it only has the necessary privileges required for its intended purpose.
- Enable Azure AD Conditional Access policies to enforce multi-factor authentication and restrict access based on specific conditions, such as IP address or device.

2. Privilege escalation:
- Regularly review and audit the permissions assigned to service principals to identify any excessive privileges. Use the Azure CLI command: `az ad sp show --id <service_principal_id> --query 'appRoles'` to view the assigned app roles.
- Follow the principle of least privilege and ensure that service principals are only granted the minimum permissions required to perform their tasks.
- Implement Azure RBAC (Role-Based Access Control) to assign roles and permissions to service principals based on their specific responsibilities.

3. Credential leakage:
- Avoid storing service principal credentials in plain text or insecure locations. Instead, use Azure Key Vault to securely store and manage secrets. You can create a secret in Azure Key Vault using the Azure CLI command: `az keyvault secret set --vault-name <key_vault_name> --name <secret_name> --value <secret_value>`.
- Regularly scan code repositories and storage accounts for any exposed or insecurely stored service principal credentials. Use tools like Azure Security Center or Azure Advisor to identify and remediate such issues.
- Implement secure communication channels, such as HTTPS, for transmitting service principal credentials and avoid sending them over unencrypted protocols.

#### Using Python

1. Unauthorized access: To remediate unauthorized access due to compromised or insecure service principal credentials in Azure Active Directory, you can follow these steps:

   - Rotate the compromised credentials: Generate new credentials for the service principal and update them in all relevant configurations.
   - Implement strong security measures: Ensure that the new credentials are securely stored, such as using Azure Key Vault or a secure secrets management solution.
   - Monitor and audit access: Regularly review access logs and monitor for any suspicious activity related to the service principal. Enable Azure Active Directory's auditing and logging features to track and investigate any unauthorized access attempts.

2. Privilege escalation: To remediate privilege escalation risks associated with misconfigured or overly-permissioned service principal credentials in Azure, consider the following actions:

   - Review and adjust permissions: Conduct a thorough review of the service principal's permissions and remove any unnecessary or excessive privileges. Follow the principle of least privilege to ensure that the service principal only has the necessary permissions to perform its intended tasks.
   - Implement role-based access control (RBAC): Assign the service principal to appropriate RBAC roles with limited permissions based on its required functionality. Regularly review and update these roles as needed.
   - Enable multi-factor authentication (MFA): Enforce MFA for service principal authentication to add an extra layer of security and prevent unauthorized access.

3. Credential leakage: To remediate the risk of credential leakage for service principal credentials in Azure, consider the following measures:

   - Securely store credentials: Avoid hardcoding credentials in code or configuration files. Instead, use Azure Key Vault or a secure secrets management solution to store and retrieve the credentials securely.
   - Implement secure coding practices: Ensure that any code or scripts handling service principal credentials follow secure coding practices, such as avoiding logging or printing credentials and using secure communication channels.
   - Regularly scan for vulnerabilities: Conduct regular vulnerability scans and security assessments to identify any potential weaknesses in the storage or handling of service principal credentials. Address any identified vulnerabilities promptly.

Here's an example Python script to rotate the credentials of a service principal in Azure Active Directory:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()

# Specify your Azure subscription ID and service principal ID
subscription_id = "<your-subscription-id>"
service_principal_id = "<your-service-principal-id>"

# Create the authorization management client
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Generate new credentials for the service principal
new_credentials = authorization_client.service_principals.create_password_credentials(
    service_principal_id,
    password_credentials={
        "value": "<new-password>",
        "end_date": "<new-end-date>"
    }
)

# Update the service principal with the new credentials
authorization_client.service_principals.update(
    service_principal_id,
    password_credentials=[new_credentials]
)
```

Please note that this is a simplified example, and you may need to modify it based on your specific requirements and the Azure SDK version you are using.


 