--- 
slug: Remove policy from service principal
eventname: Remove policy from service principal
title: Remove policy from service principal
sidebar_label: Remove policy from service principal
---
                       
### Event Information

#### Meaning

- The "Remove policy from service principal" event in Azure Active Directory refers to the removal of a policy assignment from a service principal.
- A service principal is an identity that represents an application or service in Azure Active Directory, and policies are used to enforce security and compliance requirements.
- This event indicates that a policy that was previously assigned to a service principal has been removed, potentially impacting the access and permissions granted to the application or service.

### Remediation

#### Using Console

- Example: If the "Remove policy from service principal" action is performed in Azure Active Directory, it can potentially impact the security of the service principal by removing its access to certain resources or permissions.

To remediate this issue in Azure Active Directory using the Azure portal, follow these steps:

1. Sign in to the Azure portal (https://portal.azure.com) using your Azure credentials.
2. Navigate to the Azure Active Directory service.
3. In the left-hand menu, click on "Enterprise applications" to view the list of service principals.
4. Search for the affected service principal by name or filter the list to find it.
5. Select the service principal from the list to open its details.
6. In the service principal's overview page, click on "Properties" in the left-hand menu.
7. Scroll down to the "Managed application" section and click on "Managed application in local directory".
8. In the "Managed application" blade, click on "Permissions" in the left-hand menu.
9. Review the permissions that were removed and identify the ones that need to be restored.
10. Click on "Add a permission" to add back the necessary permissions.
11. Select the appropriate resource or API that the service principal requires access to.
12. Choose the required permissions for the service principal and click on "Add permissions".
13. Once the permissions are added, review and save the changes.
14. Verify that the service principal now has the necessary permissions restored.

Note: It is important to regularly review and monitor the permissions assigned to service principals in Azure Active Directory to ensure the security and compliance of your environment.

#### Using CLI

1. Impact of removing policy from service principal in Azure Active Directory:
   - Removing a policy from a service principal in Azure Active Directory can have a significant impact on security. It may result in unauthorized access to resources, increased risk of data breaches, and potential compromise of sensitive information.

2. Remediation for Azure Active Directory using Azure CLI:
   - To remediate the security impact of removing a policy from a service principal in Azure Active Directory, you can follow these steps using Azure CLI:

     1. Identify the affected service principal:
        ```
        az ad sp list --display-name <service_principal_name>
        ```

     2. Retrieve the object ID of the service principal:
        ```
        az ad sp show --id <service_principal_object_id> --query objectId --output tsv
        ```

     3. Add the required policy back to the service principal:
        ```
        az ad sp update --id <service_principal_object_id> --add oauth2Permissions <policy_json>
        ```

     Note: Replace `<service_principal_name>` with the name of the affected service principal, and `<service_principal_object_id>` with the object ID of the service principal. Also, `<policy_json>` should be replaced with the JSON representation of the policy you want to add.

3. Additional considerations:
   - It is crucial to regularly review and manage the policies assigned to service principals in Azure Active Directory to ensure proper security controls are in place. Implementing RBAC (Role-Based Access Control) and regularly monitoring access permissions can help prevent unauthorized changes and maintain a secure environment.

#### Using Python

1. Example of security impact: Removing a policy from a service principal in Azure Active Directory (Azure AD) can result in unauthorized access to resources or data. For instance, if a policy that restricts access to a specific resource group is removed from a service principal, any user or application associated with that service principal will gain unrestricted access to the resource group.

2. Remediation for Azure Active Directory using Python:
To remediate the security impact of removing a policy from a service principal in Azure AD using Python, you can use the Azure SDK for Python (azure-identity and azure-mgmt-authorization libraries). Here's an example script:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()

# Specify your Azure subscription ID and tenant ID
subscription_id = '<your-subscription-id>'
tenant_id = '<your-tenant-id>'

# Specify the service principal object ID and the policy name to be added
service_principal_object_id = '<service-principal-object-id>'
policy_name = '<policy-name>'

# Create the Authorization Management client
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Get the existing policies for the service principal
policies = authorization_client.role_assignments.list_for_principal(service_principal_object_id)

# Find the policy to be removed
policy_to_remove = next((p for p in policies if p.role_definition_name == policy_name), None)

# Remove the policy if found
if policy_to_remove:
    authorization_client.role_assignments.delete(policy_to_remove.name)
    print('Policy removed successfully.')
else:
    print('Policy not found.')

```

This script uses the Azure Identity library to authenticate using default credentials and the Azure Management Authorization library to interact with Azure AD. It retrieves the existing policies for the specified service principal, finds the policy to be removed based on its name, and deletes it if found.

Please note that you need to install the required Python libraries (`azure-identity` and `azure-mgmt-authorization`) before running the script. You can install them using pip:

```
pip install azure-identity azure-mgmt-authorization
```

Make sure to replace the placeholders (`<your-subscription-id>`, `<your-tenant-id>`, `<service-principal-object-id>`, and `<policy-name>`) with the actual values specific to your Azure environment.


 