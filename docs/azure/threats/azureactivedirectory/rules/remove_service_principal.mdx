--- 
slug: Remove service principal
eventname: Remove service principal
title: Remove service principal
sidebar_label: Remove service principal
---
                       
### Event Information

1. The "Remove service principal" event in Azure Active Directory refers to the removal of a service principal object, which represents an application or service that is registered in Azure AD.

2. This event typically occurs when an administrator or user deletes a service principal from the Azure AD tenant.

3. Removing a service principal can have implications for any applications or services that rely on it for authentication and authorization, so it is important to carefully consider the impact before performing this action.


### Examples

1. Unauthorized access: Removing a service principal without proper authorization can lead to unauthorized access to resources within Azure Active Directory. This can result in potential data breaches, unauthorized modifications, or misuse of sensitive information.

2. Disruption of services: If a service principal is removed without considering its dependencies, it can lead to disruption of services that rely on the principal for authentication or authorization. This can impact the availability and functionality of applications or services that are integrated with Azure Active Directory.

3. Compliance violations: Removing a service principal without following proper procedures and documentation can result in compliance violations. Organizations may have specific requirements or regulations that mandate the retention of service principals for auditing or security purposes. Failing to adhere to these requirements can lead to non-compliance and potential legal consequences.

### Remediation

#### Using Console

1. Unauthorized access:
- Identify the service principal that needs to be removed by reviewing the list of existing service principals in Azure Active Directory.
- Ensure that the removal of the service principal is authorized by following the organization's access control policies and procedures.
- Use the Azure portal to navigate to Azure Active Directory and select "App registrations" or "Enterprise applications" depending on the type of service principal.
- Locate the specific service principal and select it.
- In the service principal's overview page, click on "Delete" or "Remove" to initiate the removal process.
- Confirm the removal and verify that the service principal has been successfully deleted.

2. Disruption of services:
- Before removing a service principal, identify any applications or services that rely on it for authentication or authorization.
- Review the dependencies of the service principal to understand the potential impact of its removal.
- Communicate with the owners or administrators of the affected applications or services to ensure they are aware of the planned removal and can make necessary adjustments.
- Consider alternative authentication or authorization mechanisms for the affected applications or services, such as creating new service principals or using different identity providers.
- Once the dependencies have been addressed, follow the steps mentioned in the previous response to remove the service principal.

3. Compliance violations:
- Before removing a service principal, consult the organization's compliance policies and regulations to ensure that the removal is allowed.
- If retention of service principals is required for auditing or security purposes, document the justification for the removal and seek appropriate approvals.
- Maintain a record of the removal process, including the date, reason, and individuals involved, to demonstrate compliance with the organization's requirements.
- Consider implementing automated processes or controls to prevent unauthorized removal of service principals and ensure compliance with retention policies.
- Follow the steps mentioned in the first response to remove the service principal, ensuring that all necessary documentation and approvals are in place.

#### Using CLI

1. Unauthorized access: To remediate unauthorized access due to the removal of a service principal without proper authorization in Azure Active Directory, follow these steps using Azure CLI:

- Identify the service principal that needs to be removed: `az ad sp list --display-name <service_principal_name>`
- Revoke the service principal's credentials: `az ad sp credential reset --name <service_principal_name>`
- Remove the service principal: `az ad sp delete --id <service_principal_id>`

2. Disruption of services: To remediate the disruption of services caused by the removal of a service principal without considering its dependencies in Azure Active Directory, follow these steps using Azure CLI:

- Identify the service principal and its dependencies: `az ad sp show --id <service_principal_id> --query "appRoles[].allowedMemberTypes | [0]" --output tsv`
- Update the dependent services to use an alternative service principal or authentication method.
- Remove the service principal: `az ad sp delete --id <service_principal_id>`

3. Compliance violations: To remediate compliance violations caused by the removal of a service principal without following proper procedures and documentation in Azure Active Directory, follow these steps using Azure CLI:

- Review the compliance requirements and documentation specific to your organization.
- Determine if the service principal removal violates any compliance regulations.
- If necessary, restore the service principal from backups or recreate it following the proper procedures.
- Ensure that future service principal removals adhere to the compliance requirements and documentation.

#### Using Python

1. Unauthorized access: To remediate unauthorized access due to the removal of a service principal without proper authorization in Azure Active Directory, you can follow these steps using Python:

```python
from azure.identity import DefaultAzureCredential
from azure.graphrbac import GraphRbacManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
graph_client = GraphRbacManagementClient(credential, "<your-tenant-id>")

# Get the service principal by its object id
service_principal = graph_client.service_principals.get("<service-principal-object-id>")

# Remove the service principal
graph_client.service_principals.delete(service_principal.object_id)
```

2. Disruption of services: To remediate the disruption of services caused by the removal of a service principal without considering its dependencies, you can use the Azure CLI with Python:

```python
import subprocess

# Get the list of service principal dependencies
dependencies = subprocess.check_output(["az", "ad", "sp", "list", "--query", "[?appOwnerTenantId=='<your-tenant-id>'].{Name:displayName, ObjectId:objectId}"])

# Iterate over the dependencies and remove them
for dependency in dependencies:
    subprocess.call(["az", "ad", "sp", "delete", "--id", dependency["ObjectId"]])
```

3. Compliance violations: To remediate compliance violations caused by the removal of a service principal without following proper procedures and documentation, you can implement a governance framework using Azure Policy and Python:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.resource import ResourceManagementClient
from azure.mgmt.policyinsights import PolicyInsightsClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
resource_client = ResourceManagementClient(credential, "<your-subscription-id>")
policy_client = PolicyInsightsClient(credential, "<your-subscription-id>")

# Get the list of deleted service principals
deleted_service_principals = policy_client.policy_states.list_query_results(
    "<your-policy-definition-id>",
    filter="policyAssignmentId eq '<your-policy-assignment-id>' and resourceType eq 'Microsoft.Directory/servicePrincipals' and state eq 'Deleted'"
)

# Take appropriate actions to restore or document the deleted service principals
```

Note: Replace `<your-tenant-id>`, `<service-principal-object-id>`, `<your-subscription-id>`, `<your-policy-definition-id>`, and `<your-policy-assignment-id>` with the actual values specific to your environment.


 