--- 
slug: Remove app role assignment from service principal
eventname: Remove app role assignment from service principal
title: Remove app role assignment from service principal
sidebar_label: Remove app role assignment from service principal
---
                       
### Event Information

1. The "Remove app role assignment from service principal" event in Azure Active Directory refers to the removal of a specific app role assignment from a service principal.
2. This event indicates that a previously assigned app role has been revoked or removed from the service principal's permissions.
3. It is important to monitor and track these events to ensure that the appropriate access controls and permissions are maintained within the Azure Active Directory environment.


### Examples

None

### Remediation

#### Using Console

To remediate unauthorized access, data breaches, and compliance violations related to app role assignments in Azure Active Directory, you can follow these step-by-step instructions using the Azure console:

1. Identify the service principal: 
   - Navigate to the Azure Active Directory portal (https://portal.azure.com).
   - Go to "Azure Active Directory" > "Enterprise applications".
   - Search for the application or service principal that needs remediation.

2. Remove app role assignment:
   - Select the application or service principal from the list.
   - In the left-hand menu, click on "Properties".
   - Under "Managed application in local directory", click on "Remove".

3. Review and document changes:
   - Keep a record of the app role assignment removal, including the date, reason, and any relevant approvals.
   - Ensure that the removal aligns with your organization's security policies and compliance requirements.
   - Communicate the changes to relevant stakeholders and ensure they are aware of any potential impact.

Note: It is crucial to carefully evaluate the impact of removing app role assignments before taking any action. Consider involving your organization's security and compliance teams to ensure proper authorization and documentation throughout the process.

#### Using CLI

1. Unauthorized access: To remediate unauthorized access by removing the app role assignment from a service principal in Azure Active Directory using Azure CLI, you can use the following command:

```
az ad app role assignment delete --id <service_principal_id> --assignee <service_principal_id> --role <role_name>
```

Replace `<service_principal_id>` with the ID of the service principal and `<role_name>` with the name of the role that needs to be removed.

2. Data breaches: To remediate data breaches by ensuring proper app role assignments in Azure Active Directory using Azure CLI, you can use the following command to assign a role to a service principal:

```
az ad app role assignment create --id <service_principal_id> --assignee <service_principal_id> --role <role_name>
```

Replace `<service_principal_id>` with the ID of the service principal and `<role_name>` with the name of the role that needs to be assigned.

3. Compliance violations: To remediate compliance violations related to app role assignments in Azure Active Directory using Azure CLI, it is important to carefully manage and document any changes. You can use the following command to list all app role assignments:

```
az ad app role assignment list --id <service_principal_id>
```

Replace `<service_principal_id>` with the ID of the service principal. This command will provide a list of all app role assignments associated with the service principal, which can be used for documentation and compliance purposes.

#### Using Python

To remediate unauthorized access, data breaches, and compliance violations in Azure Active Directory using Python, you can utilize the Microsoft Graph API. Here are some Python scripts that can help you with the remediation process:

1. Removing app role assignment from a service principal:
```python
import requests
import json

# Define the necessary variables
tenant_id = '<your-tenant-id>'
client_id = '<your-client-id>'
client_secret = '<your-client-secret>'
service_principal_id = '<service-principal-id>'
app_role_id = '<app-role-id>'

# Get the access token
token_url = f'https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token'
token_data = {
    'grant_type': 'client_credentials',
    'client_id': client_id,
    'client_secret': client_secret,
    'scope': 'https://graph.microsoft.com/.default'
}
token_response = requests.post(token_url, data=token_data).json()
access_token = token_response['access_token']

# Remove the app role assignment
remove_assignment_url = f'https://graph.microsoft.com/v1.0/servicePrincipals/{service_principal_id}/appRoleAssignments/{app_role_id}'
headers = {
    'Authorization': f'Bearer {access_token}',
    'Content-Type': 'application/json'
}
response = requests.delete(remove_assignment_url, headers=headers)

# Check the response status
if response.status_code == 204:
    print('App role assignment removed successfully.')
else:
    print('Failed to remove app role assignment.')
```

2. Checking for data breaches:
```python
import requests
import json

# Define the necessary variables
tenant_id = '<your-tenant-id>'
client_id = '<your-client-id>'
client_secret = '<your-client-secret>'
service_principal_id = '<service-principal-id>'
data_to_check = '<data-to-check>'

# Get the access token
token_url = f'https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token'
token_data = {
    'grant_type': 'client_credentials',
    'client_id': client_id,
    'client_secret': client_secret,
    'scope': 'https://graph.microsoft.com/.default'
}
token_response = requests.post(token_url, data=token_data).json()
access_token = token_response['access_token']

# Check if the service principal has access to the data
check_access_url = f'https://graph.microsoft.com/v1.0/servicePrincipals/{service_principal_id}/checkMemberObjects'
headers = {
    'Authorization': f'Bearer {access_token}',
    'Content-Type': 'application/json'
}
data = {
    'ids': [data_to_check]
}
response = requests.post(check_access_url, headers=headers, data=json.dumps(data))

# Check the response status
if response.status_code == 200:
    result = response.json()
    if result['value'][0]['value']:
        print('Service principal has access to the data.')
    else:
        print('Service principal does not have access to the data.')
else:
    print('Failed to check data access.')
```

3. Managing app role assignments for compliance:
```python
import requests
import json

# Define the necessary variables
tenant_id = '<your-tenant-id>'
client_id = '<your-client-id>'
client_secret = '<your-client-secret>'
service_principal_id = '<service-principal-id>'
app_role_id = '<app-role-id>'
compliance_documentation = '<compliance-documentation>'

# Get the access token
token_url = f'https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token'
token_data = {
    'grant_type': 'client_credentials',
    'client_id': client_id,
    'client_secret': client_secret,
    'scope': 'https://graph.microsoft.com/.default'
}
token_response = requests.post(token_url, data=token_data).json()
access_token = token_response['access_token']

# Update the app role assignment with compliance documentation
update_assignment_url = f'https://graph.microsoft.com/v1.0/servicePrincipals/{service_principal_id}/appRoleAssignments/{app_role_id}'
headers = {
    'Authorization': f'Bearer {access_token}',
    'Content-Type': 'application/json'
}
data = {
    'documentation': compliance_documentation
}
response = requests.patch(update_assignment_url, headers=headers, data=json.dumps(data))

# Check the response status
if response.status_code == 200:
    print('App role assignment updated successfully.')
else:
    print('Failed to update app role assignment.')
```

Please note that you need to replace the placeholders (`<your-tenant-id>`, `<your-client-id>`, `<your-client-secret>`, `<service-principal-id>`, `<app-role-id>`, `<data-to-check>`, `<compliance-documentation>`) with the actual values specific to your Azure environment.


 