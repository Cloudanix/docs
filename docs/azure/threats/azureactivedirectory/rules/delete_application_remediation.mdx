
### Event Information

- The "Delete application" event in Azure Active Directory refers to the action of permanently removing an application registration from the Azure AD tenant.
- This event signifies that the application and its associated credentials, permissions, and configurations have been deleted and can no longer be accessed or used.
- It is important to note that deleting an application in Azure AD is an irreversible action, and it is recommended to carefully review and assess the impact before proceeding with this event.


### Examples

1. Unauthorized deletion: If security is impacted with the "Delete application" action in Azure Active Directory, one example could be an unauthorized user gaining access to the Azure portal and deleting an application without proper authorization. This could result in the loss of critical application data and potentially compromise the security of the organization.

2. Data exposure: Another example could be if an application is deleted without proper precautions, sensitive data associated with that application may be exposed. This could include user credentials, personal information, or any other sensitive data stored within the application.

3. Access control issues: Deleting an application without considering the impact on access control can also lead to security issues. For example, if an application is deleted without revoking access permissions for users or groups, those users may still have access to resources they should no longer have access to, potentially leading to unauthorized access and data breaches. It is important to ensure that access control is properly managed and revoked when an application is deleted.

### Remediation

#### Using Console

To remediate unauthorized deletion, data exposure, and access control issues in Azure Active Directory (AAD) using the Azure console, you can follow these steps:

1. Unauthorized deletion:
- Enable Azure AD audit logs: Go to the Azure portal, navigate to Azure Active Directory, and select "Audit logs" under the Monitoring section. Enable audit logging to track any changes made to applications.
- Set up alerts: Configure alerts to notify you when an application is deleted. You can use Azure Monitor or Azure Security Center to create custom alerts based on specific criteria, such as application deletion events.
- Implement RBAC: Use Role-Based Access Control (RBAC) to restrict access to the AAD portal. Assign appropriate roles and permissions to users, ensuring that only authorized individuals can delete applications.

2. Data exposure:
- Enable backup and recovery: Regularly back up your applications and their associated data. Azure provides various backup and recovery options, such as Azure Backup and Azure Site Recovery. Implement a backup strategy that aligns with your data retention and recovery requirements.
- Implement data classification and protection: Classify your data based on sensitivity and apply appropriate data protection measures, such as encryption and access controls. This ensures that even if an application is deleted, the sensitive data remains protected.

3. Access control issues:
- Review application dependencies: Before deleting an application, review its dependencies on other systems or services. Identify any potential access control gaps that may arise from the deletion. Ensure that appropriate access controls are in place for all integrated systems.
- Implement a change management process: Establish a change management process that includes a thorough review of the impact on access control before deleting any applications. This ensures that all stakeholders are involved in the decision-making process and potential security issues are addressed.

Note: The steps provided are general guidelines and may vary depending on your specific Azure environment and requirements. It is recommended to consult Azure documentation and best practices for detailed instructions.

#### Using CLI

1. Unauthorized deletion: To remediate unauthorized deletion of an application in Azure Active Directory (AAD), you can follow these steps using Azure CLI:

- Identify the deleted application using the `az ad app list` command.
- Restore the deleted application using the `az ad app restore --id <application_id>` command.
- Review and update the access control settings for the application to prevent unauthorized access in the future.

2. Data exposure: To remediate data exposure due to the deletion of an application without proper data backup or migration in Azure Active Directory (AAD), you can take the following actions using Azure CLI:

- Restore the deleted application using the `az ad app restore --id <application_id>` command.
- Ensure that proper data backup and migration processes are in place for critical applications.
- Regularly review and update the backup and migration strategies to align with the organization's data protection requirements.

3. Access control issues: To remediate access control issues caused by deleting an application in Azure Active Directory (AAD) without considering the impact on access control, you can use the following steps with Azure CLI:

- Restore the deleted application using the `az ad app restore --id <application_id>` command.
- Review and update the access control settings for the application, ensuring that all necessary integrations and dependencies are properly configured.
- Regularly audit and monitor access control settings to identify and address any potential security gaps or unauthorized access.

#### Using Python

To remediate unauthorized deletion, data exposure, and access control issues in Azure Active Directory (AAD), you can follow these steps:

1. Unauthorized deletion:
   - Implement multi-factor authentication (MFA) for all user accounts to prevent unauthorized access to the AAD portal.
   - Enable auditing and monitoring of AAD activities to detect any unauthorized deletion attempts.
   - Regularly review and update user roles and permissions to ensure only authorized users have access to delete applications.

2. Data exposure:
   - Regularly backup critical data stored within applications in AAD.
   - Implement a data retention policy to ensure data is not permanently deleted without proper backup or migration.
   - Consider using Azure Backup or other third-party backup solutions to automate the backup process.

3. Access control issues:
   - Before deleting an application, review its integration with other systems or services to identify potential access control gaps.
   - Update access control policies and permissions to ensure that deleting an application does not compromise the security of other resources.
   - Regularly review and audit access control settings to identify and remediate any misconfigurations or vulnerabilities.

Python script examples for Azure Active Directory using the `azure-identity` library:

1. Enable multi-factor authentication for a user:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, <subscription_id>)

user_id = "<user_id>"
user = authorization_client.users.get(<tenant_id>, user_id)
user.additional_properties["signInNames"] = [{"type": "emailAddress", "value": "<user_email>"}]
user.additional_properties["passwordProfile"] = {"password": "<user_password>", "forceChangePasswordNextLogin": False}
user.additional_properties["passwordPolicies"] = "DisablePasswordExpiration"
user.additional_properties["otherMails"] = ["<user_email>"]
user.additional_properties["signInNames"] = [{"type": "emailAddress", "value": "<user_email>"}]
user.additional_properties["strongAuthenticationMethods"] = [{"type": "email", "value": "<user_email>"}]

authorization_client.users.create_or_update(<tenant_id>, user_id, user)
```

2. Backup an application's data:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.recoveryservicesbackup import RecoveryServicesBackupClient

credential = DefaultAzureCredential()
backup_client = RecoveryServicesBackupClient(credential, <subscription_id>)

resource_group_name = "<resource_group_name>"
vault_name = "<vault_name>"
container_name = "<container_name>"
item_name = "<item_name>"

backup_client.backup_protected_items.trigger(<vault_name>, <container_name>, <item_name>, resource_group_name)
```

3. Review access control settings for an application:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, <subscription_id>)

application_id = "<application_id>"
role_assignments = authorization_client.role_assignments.list_for_principal(<tenant_id>, application_id)

for role_assignment in role_assignments:
    print(f"Role Assignment: {role_assignment.name}, Role Definition: {role_assignment.role_definition_id}")
```

Please note that the provided Python scripts are just examples and may require additional modifications based on your specific requirements and environment.

