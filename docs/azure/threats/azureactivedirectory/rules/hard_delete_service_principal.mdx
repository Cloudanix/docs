--- 
slug: Hard delete service principal
eventname: Hard delete service principal
title: Hard delete service principal
sidebar_label: Hard delete service principal
---
                       
### Event Information

- The Hard delete service principal event in Azure Active Directory refers to the permanent removal of a service principal object from the directory.
- This event occurs when a service principal is deleted using the "Remove-AzureADServicePrincipal" or similar command in Azure AD PowerShell or Azure CLI.
- Hard deleting a service principal means that it cannot be restored or recovered, and all associated permissions and access granted to the service principal are permanently revoked.


### Examples

1. Loss of access control: When a service principal is hard deleted in Azure Active Directory, any associated access permissions and role assignments will be permanently removed. This can result in a loss of access control, as users or applications that relied on the service principal for authentication or authorization may no longer have the necessary permissions to perform their intended actions.

2. Disruption of integrations: Service principals are often used to establish trust relationships between different Azure services or external applications. If a service principal is hard deleted, any integrations or workflows that relied on this trust relationship may be disrupted. This can lead to failures or errors in the affected systems, potentially impacting the overall functionality and availability of the application or service.

3. Audit and compliance challenges: Hard deleting a service principal can make it difficult to track and audit the actions performed by the associated application or user. This can pose challenges in meeting regulatory compliance requirements, as there may be a lack of visibility into the activities performed by the deleted service principal. It is important to have proper documentation and logging mechanisms in place to mitigate these challenges and ensure compliance with security standards.

### Remediation

#### Using Console

1. To remediate the loss of access control caused by hard deleting a service principal in Azure Active Directory, follow these steps:

- Identify the affected users or applications that relied on the deleted service principal for authentication or authorization.
- Create a new service principal with the necessary permissions and role assignments.
- Update the affected users or applications to use the new service principal for authentication or authorization.

2. To remediate the disruption of integrations caused by hard deleting a service principal in Azure Active Directory, follow these steps:

- Identify the integrations or workflows that relied on the trust relationship with the deleted service principal.
- Update the affected integrations or workflows to use a new service principal or establish a new trust relationship.
- Test the updated integrations or workflows to ensure they are functioning correctly.

3. To remediate the audit and compliance challenges caused by hard deleting a service principal in Azure Active Directory, follow these steps:

- Implement proper documentation and logging mechanisms to track and audit the actions performed by service principals.
- Regularly review and monitor the logs to ensure compliance with regulatory requirements.
- Consider implementing additional security measures, such as multi-factor authentication, to enhance the security and accountability of service principals.

#### Using CLI

1. To remediate the loss of access control due to a hard-deleted service principal in Azure Active Directory, you can restore the service principal using the Azure CLI. First, identify the Object ID of the deleted service principal using the following command:

```
az ad sp list --display-name <service_principal_name>
```

Once you have the Object ID, you can restore the service principal using the following command:

```
az ad sp restore --id <object_id>
```

2. If the disruption of integrations is caused by a hard-deleted service principal, you can recreate the service principal and update the necessary configurations in the affected Azure services or external applications. To create a new service principal using the Azure CLI, use the following command:

```
az ad sp create-for-rbac --name <service_principal_name>
```

This will create a new service principal with a new set of credentials. Update the necessary configurations with the new service principal's credentials to restore the trust relationship and ensure the continuity of integrations.

3. To address the audit and compliance challenges caused by a hard-deleted service principal, it is important to have proper documentation and logging mechanisms in place. Ensure that you have a process in place to track and record the creation, modification, and deletion of service principals. Additionally, consider implementing Azure Monitor or Azure Sentinel to collect and analyze logs related to service principal activities. This will help you meet regulatory compliance requirements and maintain visibility into the actions performed by service principals.

#### Using Python

To remediate the loss of access control in Azure Active Directory when a service principal is hard deleted, you can take the following steps:

1. Restore the deleted service principal: If the service principal was recently deleted, you can restore it using the Azure AD PowerShell module or Azure CLI. This will recover the associated access permissions and role assignments, restoring the access control.

2. Reassign permissions and roles: If the service principal cannot be restored, you will need to manually reassign the necessary permissions and roles to the affected users or applications. This can be done using the Azure portal, Azure AD PowerShell module, or Azure CLI. Ensure that the appropriate access levels are granted to maintain the required access control.

3. Update integrations and workflows: If the deletion of the service principal has disrupted integrations or workflows, you will need to update the affected systems to use an alternative service principal or establish a new trust relationship. This may involve modifying configuration files, updating API credentials, or reconfiguring authentication mechanisms.

Here is an example of a Python script using the Azure SDK for Python (azure-identity) to restore a deleted service principal:

```python
from azure.identity import DefaultAzureCredential
from azure.graphrbac import GraphRbacManagementClient

# Create a credential object using the default Azure credentials
credential = DefaultAzureCredential()

# Create a GraphRbacManagementClient using the credential
graph_client = GraphRbacManagementClient(credential, "<your-tenant-id>")

# Restore the deleted service principal by object ID
graph_client.service_principals.restore("<deleted-service-principal-object-id>")
```

Note: Replace `<your-tenant-id>` with your Azure AD tenant ID and `<deleted-service-principal-object-id>` with the object ID of the deleted service principal.

Remember to handle exceptions and errors appropriately in your script and ensure that you have the necessary permissions to perform the restoration and reassignment of access control.


 