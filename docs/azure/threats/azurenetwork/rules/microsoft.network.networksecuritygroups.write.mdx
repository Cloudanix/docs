--- 
slug: Microsoft.Network.networkSecurityGroups.write
eventname: Microsoft.Network.networkSecurityGroups.write
title: Microsoft.Network.networkSecurityGroups.write
sidebar_label: Microsoft.Network.networkSecurityGroups.write
---
                       
### Event Information

1. The Microsoft.Network.networkSecurityGroups.write event in Azure for AzureNetwork refers to the action of creating or updating a network security group (NSG) within the Azure Network resource.

2. This event indicates that a change has been made to the NSG configuration, such as adding or removing security rules, modifying network interfaces associated with the NSG, or updating NSG properties.

3. It is important to monitor this event as it can help track any modifications made to the NSG, ensuring that the network security policies are properly maintained and any unauthorized changes are detected and addressed.


### Examples

1. Unauthorized changes to network security groups: If the Microsoft.Network.networkSecurityGroups.write permission is misused or granted to unauthorized users, it can lead to unauthorized changes being made to network security groups in Azure. This can result in the exposure of sensitive resources or the introduction of security vulnerabilities.

2. Network segmentation issues: Network security groups are used to enforce network segmentation and control traffic flow within an Azure network. If the Microsoft.Network.networkSecurityGroups.write permission is compromised, an attacker could modify the network security groups to bypass segmentation rules, potentially allowing unauthorized access to sensitive resources or compromising the overall network security posture.

3. Compliance and regulatory violations: Many organizations have specific compliance requirements that dictate how network security should be configured and managed. If the Microsoft.Network.networkSecurityGroups.write permission is abused, it can lead to non-compliance with these regulations, potentially resulting in financial penalties or reputational damage. It is crucial to ensure that only authorized individuals have the ability to modify network security groups in order to maintain compliance.

### Remediation

#### Using Console

To remediate unauthorized changes to network security groups in Azure, follow these steps:

1. Review and restrict permissions: 
   - Identify the users or roles that have the Microsoft.Network.networkSecurityGroups.write permission.
   - Remove this permission from any unauthorized users or roles.
   - Ensure that only trusted and authorized individuals have this permission.

2. Implement RBAC (Role-Based Access Control):
   - Define custom roles with granular permissions for managing network security groups.
   - Assign these custom roles to appropriate users or groups based on their responsibilities.
   - Regularly review and update role assignments to ensure they align with the principle of least privilege.

3. Enable Azure Security Center:
   - Azure Security Center provides continuous monitoring and recommendations for securing your Azure resources.
   - Enable Security Center and configure it to send alerts for any unauthorized changes to network security groups.
   - Follow the recommended remediation steps provided by Security Center to address any identified issues.

By following these steps, you can mitigate the risk of unauthorized changes to network security groups, ensure proper network segmentation, and maintain compliance with relevant standards and regulations.

#### Using CLI

1. To remediate unauthorized changes to network security groups in Azure, you can follow these steps using Azure CLI commands:

- Identify the unauthorized changes by reviewing the network security group (NSG) rules and configurations. You can use the following command to list all NSGs in your Azure subscription:
  ```
  az network nsg list
  ```

- Remove the unauthorized changes by reverting the NSG rules to their previous state. You can use the following command to update an NSG rule:
  ```
  az network nsg rule update --name <rule_name> --nsg-name <nsg_name> --resource-group <resource_group_name> --access <access_type> --priority <priority>
  ```

- Restrict permissions to prevent future unauthorized changes. Ensure that only authorized users have the Microsoft.Network.networkSecurityGroups.write permission. You can use Azure RBAC (Role-Based Access Control) to manage permissions. For example, you can assign the "Network Contributor" role to trusted individuals:
  ```
  az role assignment create --assignee <user_or_group_id> --role "Network Contributor" --scope /subscriptions/<subscription_id>/resourceGroups/<resource_group_name>
  ```

2. To remediate network segmentation issues caused by compromised Microsoft.Network.networkSecurityGroups.write permission, you can take the following steps using Azure CLI commands:

- Identify the compromised NSG rules by reviewing the network security group configurations. Look for any rules that bypass segmentation rules or allow unauthorized access. Use the command mentioned in the previous point to list NSGs.

- Update the compromised NSG rules to enforce proper network segmentation. Modify the rules to align with your desired segmentation rules. Use the following command to update an NSG rule:
  ```
  az network nsg rule update --name <rule_name> --nsg-name <nsg_name> --resource-group <resource_group_name> --access <access_type> --priority <priority>
  ```

- Strengthen security by regularly reviewing and monitoring NSG configurations. Implement a process to detect and respond to any unauthorized changes promptly.

3. To remediate compliance violations caused by abuse of Microsoft.Network.networkSecurityGroups.write permission, you can follow these steps using Azure CLI commands:

- Identify the non-compliant NSG configurations by reviewing the compliance requirements and comparing them with the actual NSG rules. Use the command mentioned earlier to list NSGs.

- Update the non-compliant NSG rules to align with the compliance requirements. Modify the rules to meet the necessary standards. Use the following command to update an NSG rule:
  ```
  az network nsg rule update --name <rule_name> --nsg-name <nsg_name> --resource-group <resource_group_name> --access <access_type> --priority <priority>
  ```

- Implement continuous compliance monitoring and auditing to ensure ongoing adherence to compliance requirements. Regularly review NSG configurations and enforce strict access controls to prevent unauthorized changes.

#### Using Python

To remediate unauthorized changes to network security groups in Azure, you can follow these steps using Python scripts:

1. Regularly audit and monitor network security groups: Implement a script that periodically checks for any unauthorized changes to network security groups. This can be done by comparing the current configuration with a baseline or predefined set of rules. If any unauthorized changes are detected, the script should alert the appropriate personnel.

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
network_client = NetworkManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Define the resource group and network security group name
resource_group_name = 'your_resource_group_name'
nsg_name = 'your_network_security_group_name'

# Get the current network security group rules
nsg = network_client.network_security_groups.get(resource_group_name, nsg_name)

# Compare the current rules with a predefined set of rules
# If any unauthorized changes are detected, alert the appropriate personnel
```

2. Implement role-based access control (RBAC): Ensure that the Microsoft.Network.networkSecurityGroups.write permission is only granted to authorized users or groups. Use RBAC to assign appropriate roles and permissions to individuals based on their responsibilities. Regularly review and update these permissions to maintain least privilege access.

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Define the role assignment details
resource_group_name = 'your_resource_group_name'
nsg_name = 'your_network_security_group_name'
principal_id = 'your_principal_id'
role_definition_id = '/subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{role_definition_id}'

# Create a role assignment for the authorized user or group
authorization_client.role_assignments.create(
    scope=f'/subscriptions/{os.environ['AZURE_SUBSCRIPTION_ID']}/resourceGroups/{resource_group_name}/providers/Microsoft.Network/networkSecurityGroups/{nsg_name}',
    role_assignment_name='your_role_assignment_name',
    principal_id=principal_id,
    role_definition_id=role_definition_id
)
```

3. Enable Azure Security Center and Network Security Group flow logs: Azure Security Center provides advanced threat protection and security recommendations for Azure resources. Enable it to receive alerts and recommendations related to network security groups. Additionally, enable Network Security Group flow logs to capture and analyze network traffic for any suspicious activities or unauthorized changes.

```python
import os
from azure.identity import DefaultAzureCredential
from azure.mgmt.security import SecurityCenter
from azure.mgmt.network import NetworkManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()
security_center_client = SecurityCenter(credential, os.environ['AZURE_SUBSCRIPTION_ID'])
network_client = NetworkManagementClient(credential, os.environ['AZURE_SUBSCRIPTION_ID'])

# Enable Azure Security Center for the subscription
security_center_client.auto_provisioning_settings.create(
    auto_provisioning_setting_name='default',
    auto_provisioning_setting=AutoProvisioningSettingData(
        auto_provision='On',
        target_resource_type='Subscription'
    )
)

# Enable Network Security Group flow logs for the network security group
network_client.network_security_groups.update_flow_log_status(
    resource_group_name='your_resource_group_name',
    network_security_group_name='your_network_security_group_name',
    parameters=FlowLogStatusParameters(
        target_resource_id='/subscriptions/{subscription_id}/resourceGroups/{resource_group_name}/providers/Microsoft.Network/networkSecurityGroups/{nsg_name}',
        enabled=True,
        storage_id='/subscriptions/{subscription_id}/resourceGroups/{resource_group_name}/providers/Microsoft.Storage/storageAccounts/{storage_account_name}',
        storage_account_subscription_id='your_storage_account_subscription_id'
    )
)
```

These scripts provide a starting point for remediating unauthorized changes to network security groups in Azure. Customize them according to your specific requirements and integrate them into your existing infrastructure and security processes.


 