--- 
slug: Microsoft.Network.networkSecurityGroups.write
eventname: Microsoft.Network.networkSecurityGroups.write
title: Microsoft.Network.networkSecurityGroups.write
sidebar_label: Microsoft.Network.networkSecurityGroups.write
---
                       
### Event Information

1. The Microsoft.Network.networkSecurityGroups.write event in Azure for AzureNetwork refers to the action of creating or updating a network security group (NSG) within the Azure Network resource.

2. This event indicates that a change has been made to the NSG configuration, such as adding or removing security rules, modifying network interfaces associated with the NSG, or updating NSG properties.

3. It is important to monitor this event as it can help track any modifications made to the NSG, ensuring that the network security policies are properly maintained and any unauthorized changes are detected and addressed.


### Examples

1. Unauthorized changes to network security groups: If the Microsoft.Network.networkSecurityGroups.write permission is misused or granted to unauthorized users, it can lead to unauthorized changes being made to network security groups in Azure. This can result in the exposure of sensitive resources or the introduction of security vulnerabilities.

2. Network segmentation issues: Network security groups are used to enforce network segmentation and control traffic flow within an Azure network. If the Microsoft.Network.networkSecurityGroups.write permission is compromised, an attacker could modify the network security groups to bypass segmentation rules, potentially allowing unauthorized access to sensitive resources or compromising the overall network security posture.

3. Compliance violations: Many organizations have specific compliance requirements that dictate how network security groups should be configured and managed. If the Microsoft.Network.networkSecurityGroups.write permission is abused, it can lead to non-compliance with these requirements, potentially resulting in penalties or loss of certifications. It is crucial to ensure that only authorized and trusted individuals have the ability to modify network security groups in order to maintain compliance.

### Remediation

#### Using Console

To remediate unauthorized changes to network security groups for AzureNetwork using the Azure console, follow these steps:

1. Identify the unauthorized changes: Review the network security group rules and identify any unauthorized changes that have been made. Look for any rules that allow traffic that should be blocked or block traffic that should be allowed.

2. Revert the unauthorized changes: To revert the unauthorized changes, navigate to the Azure portal and open the AzureNetwork resource. Go to the "Network security groups" section and select the affected network security group.

3. Modify the network security group rules: Within the network security group, review the rules and remove any unauthorized rules that have been added. Ensure that the necessary rules are in place to allow the desired traffic and block any unnecessary or unauthorized traffic.

4. Monitor and enforce security: Regularly monitor the network security groups for any further unauthorized changes. Implement proper access controls and permissions to prevent unauthorized modifications in the future. Consider using Azure Security Center or Azure Policy to enforce security best practices and compliance standards.

Note: It is recommended to follow the principle of least privilege and restrict write permissions to network security groups to only trusted individuals or roles. Regularly review and audit the network security group configurations to ensure compliance and security.

#### Using CLI

To remediate unauthorized changes to network security groups for AzureNetwork using Azure CLI, you can follow these steps:

1. Identify the unauthorized changes: Use the Azure CLI command `az network nsg show` to retrieve the current configuration of the network security group associated with the AzureNetwork. Compare it with the desired configuration to identify any unauthorized changes.

2. Revert unauthorized changes: If unauthorized changes are detected, use the Azure CLI command `az network nsg rule delete` to remove the unauthorized rules or `az network nsg rule update` to modify the rules back to their original state. Make sure to specify the appropriate network security group and rule names in the command.

3. Implement access controls: To prevent future unauthorized changes, ensure that proper access controls are in place. Use the Azure CLI command `az role assignment create` to assign the appropriate RBAC roles to limit the write access to network security groups. Restrict the permissions to only authorized users or groups.

Remember to regularly monitor and audit the network security groups to detect and remediate any unauthorized changes promptly.

#### Using Python

To remediate unauthorized changes to network security groups for AzureNetwork in Azure, you can use the Azure Python SDK to programmatically manage and enforce the desired network security group rules. Here are the steps you can follow:

1. Connect to Azure: Use the `azure.identity` library to authenticate and connect to your Azure account. You can use the `DefaultAzureCredential` class to automatically authenticate using the available credentials (e.g., environment variables, managed identity, or Azure CLI).

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

credential = DefaultAzureCredential()
network_client = NetworkManagementClient(credential, subscription_id)
```

2. Get the existing network security group rules: Use the `network_client.security_rules.list` method to retrieve the current network security group rules associated with the AzureNetwork.

```python
security_rules = network_client.security_rules.list(resource_group_name, network_security_group_name)
```

3. Enforce desired network security group rules: Compare the retrieved security rules with the desired rules and make necessary modifications using the `network_client.security_rules.create_or_update` method. You can add, update, or delete rules as needed.

```python
# Example: Add a new security rule
new_security_rule = {
    "name": "AllowSSH",
    "protocol": "Tcp",
    "source_port_range": "*",
    "destination_port_range": "22",
    "source_address_prefix": "*",
    "destination_address_prefix": "*",
    "access": "Allow",
    "priority": 100,
    "direction": "Inbound"
}

network_client.security_rules.create_or_update(resource_group_name, network_security_group_name, new_security_rule_name, new_security_rule)
```

By regularly running this script or integrating it into your CI/CD pipeline, you can ensure that the network security group rules for AzureNetwork are always in the desired state, mitigating the risk of unauthorized changes and potential security vulnerabilities.


 