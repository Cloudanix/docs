--- 
slug: Microsoft.Network.dnszones.write
eventname: Microsoft.Network.dnszones.write
title: Microsoft.Network.dnszones.write
sidebar_label: Microsoft.Network.dnszones.write
---
                       
### Event Information

1. The Microsoft.Network.dnszones.write event in Azure for AzureNetwork refers to a write operation performed on the DNS zones associated with the Azure Network.
2. This event indicates that changes have been made to the DNS configuration of the Azure Network, such as adding, modifying, or deleting DNS records.
3. It is important to monitor this event as it can help track any changes made to the DNS settings, ensuring the integrity and availability of the network's DNS resolution.


### Examples

1. Unauthorized modification of DNS records: If security is impacted with Microsoft.Network.dnszones.write permission for AzureNetwork, an attacker with this permission could potentially modify DNS records within the Azure Network. This could lead to unauthorized redirection of network traffic, spoofing of domain names, or even complete denial of service by redirecting traffic to malicious destinations.

2. DNS cache poisoning: With the ability to write to DNS zones, an attacker could potentially inject malicious DNS records into the Azure Network's DNS cache. This could result in users being redirected to malicious websites or services, leading to potential data breaches, phishing attacks, or other security incidents.

3. DNS hijacking: By exploiting the Microsoft.Network.dnszones.write permission, an attacker could hijack the DNS resolution process within the Azure Network. This could allow them to redirect legitimate traffic to their own malicious servers, intercept sensitive information, or launch man-in-the-middle attacks. This type of attack can be particularly dangerous as it can go unnoticed by users and can be used to bypass other security measures in place.

### Remediation

#### Using Console

To remediate unauthorized modification of DNS records for AzureNetwork using the Azure console, follow these steps:

1. Review and restrict permissions: 
   - Access the Azure portal and navigate to the Azure Active Directory (AAD) section.
   - Select "App registrations" and search for the application associated with AzureNetwork.
   - Review the permissions granted to the application and ensure that the Microsoft.Network.dnszones.write permission is only granted to trusted entities.
   - Remove any unnecessary or suspicious permissions.

2. Implement role-based access control (RBAC):
   - Navigate to the Azure portal and go to the AzureNetwork resource.
   - Select "Access control (IAM)" and click on "Add".
   - Choose the appropriate role (e.g., DNS Zone Contributor) and assign it to the necessary users or groups.
   - Ensure that only authorized personnel have the ability to modify DNS records.

3. Enable Azure DNS zone locks:
   - Go to the Azure portal and navigate to the AzureNetwork resource.
   - Select "DNS zones" and choose the associated Azure DNS zone.
   - Under the "Settings" section, click on "Locks".
   - Click on "Add" and create a new lock with the "Delete" and "Write" permissions set to "Deny".
   - Apply the lock to prevent unauthorized modifications to the DNS zone.

Regularly monitor and review the permissions, access controls, and DNS zone configurations to ensure the ongoing security and integrity of the AzureNetwork's DNS infrastructure.

#### Using CLI

To remediate unauthorized modification of DNS records, DNS cache poisoning, and Denial of Service (DoS) attacks in Azure using Azure CLI commands, you can follow these steps:

1. Review and restrict permissions:
   - Use the `az role assignment list` command to list all role assignments for the AzureNetwork.
   - Identify any assignments with the `Microsoft.Network/dnszones/write` permission.
   - Use the `az role assignment delete` command to remove any unnecessary or unauthorized assignments.

2. Implement strong access controls:
   - Use the `az network dns zone list` command to list all DNS zones associated with the AzureNetwork.
   - Review the configurations of each DNS zone using the `az network dns zone show` command.
   - Ensure that only authorized users or roles have the `Microsoft.Network/dnszones/write` permission for each DNS zone.
   - Use the `az network dns zone update` command to modify the access control settings if necessary.

3. Regularly monitor DNS zone configurations:
   - Set up Azure Monitor alerts to notify you of any changes to DNS zone configurations.
   - Use the `az monitor activity-log list` command to retrieve activity logs related to DNS zone modifications.
   - Analyze the logs to identify any suspicious or unauthorized changes.
   - Take appropriate actions, such as investigating the source of the changes and reverting them if necessary.

By following these steps and regularly reviewing and monitoring DNS zone configurations, you can mitigate the risks associated with unauthorized modification of DNS records, DNS cache poisoning, and Denial of Service (DoS) attacks in Azure.

#### Using Python

To remediate unauthorized modification of DNS records, DNS cache poisoning, and Denial of Service (DoS) attacks in AzureNetwork, you can use Python scripts to implement the following measures:

1. Implement Role-Based Access Control (RBAC): Use the Azure SDK for Python to manage RBAC roles and permissions. Create a custom RBAC role that restricts the Microsoft.Network.dnszones.write permission to only authorized users or groups. Assign this role to the appropriate individuals or teams responsible for managing DNS records.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, subscription_id)

# Create a custom role definition with restricted permissions
role_definition = {
    "properties": {
        "roleName": "Custom DNS Writer",
        "description": "Custom role with write access to DNS zones",
        "assignableScopes": ["/subscriptions/{subscription_id}"],
        "permissions": [
            {
                "actions": [
                    "Microsoft.Network/dnszones/write"
                ],
                "notActions": [],
                "dataActions": [],
                "notDataActions": []
            }
        ]
    }
}

# Create the custom role definition
role_definition = authorization_client.role_definitions.create_or_update(
    scope="/subscriptions/{subscription_id}",
    role_definition_name="custom-dns-writer",
    parameters=role_definition
)
```

2. Enable Azure DNS Zone Locking: Use the Azure SDK for Python to enable DNS zone locking for the Azure DNS zone associated with AzureNetwork. This prevents unauthorized modifications to DNS records by locking the zone.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()
network_client = NetworkManagementClient(credential, subscription_id)

# Enable DNS zone locking for the Azure DNS zone
network_client.dns_zones.update(
    resource_group_name="your-resource-group",
    zone_name="your-dns-zone",
    parameters={
        "etag": "*",
        "zone_type": "Public",
        "registration_virtual_networks": [],
        "resolution_virtual_networks": [],
        "max_number_of_record_sets": 10000,
        "max_number_of_records": 100000,
        "locking": {
            "name": "Locked"
        }
    }
)
```

3. Implement DNS Monitoring and Alerting: Use the Azure SDK for Python to set up monitoring and alerting for DNS changes in the Azure DNS zone associated with AzureNetwork. Configure alerts to notify the appropriate individuals or teams when any unauthorized modifications or suspicious activities are detected.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.monitor import MonitorManagementClient

# Authenticate using DefaultAzureCredential
credential = DefaultAzureCredential()
monitor_client = MonitorManagementClient(credential, subscription_id)

# Create an alert rule for DNS changes
monitor_client.alert_rules.create_or_update(
    resource_group_name="your-resource-group",
    rule_name="dns-changes-alert",
    parameters={
        "location": "global",
        "enabled": True,
        "condition": {
            "odata.type": "Microsoft.Azure.Management.Monitor.Models.ManagementEventRuleCondition",
            "dataSource": {
                "odata.type": "Microsoft.Azure.Management.Monitor.Models.RuleMetricDataSource",
                "resourceUri": "/subscriptions/{subscription_id}/resourceGroups/{resource_group_name}/providers/Microsoft.Network/dnszones/{dns_zone_name}",
                "metricName": "RecordSetWrite"
            },
            "operator": "GreaterThan",
            "threshold": 0,
            "windowSize": "PT5M"
        },
        "actions": {
            "odata.type": "Microsoft.Azure.Management.Monitor.Models.RuleEmailAction",
            "sendToServiceOwners": True,
            "customEmails": []
        }
    }
)
```

By implementing RBAC, enabling DNS zone locking, and setting up monitoring and alerting, you can effectively remediate unauthorized modification of DNS records, DNS cache poisoning, and Denial of Service (DoS) attacks in AzureNetwork.


 