--- 
slug: Microsoft.Network.virtualNetworks.write
eventname: Microsoft.Network.virtualNetworks.write
title: Microsoft.Network.virtualNetworks.write
sidebar_label: Microsoft.Network.virtualNetworks.write
---
                       
### Event Information

- The Microsoft.Network.virtualNetworks.write event in Azure for AzureNetwork refers to the action of creating or updating a virtual network in the Azure Network service.
- This event indicates that a user or application has made changes to the configuration of a virtual network, such as modifying its address space, subnets, or peering connections.
- It is important to monitor this event as it can help track any changes made to the virtual network infrastructure, ensuring proper network connectivity and security within the Azure environment.


### Examples

1. Unauthorized modification of virtual network configurations: If security is impacted with Microsoft.Network.virtualNetworks.write permission, an attacker could potentially modify the virtual network configurations, such as changing the subnets, IP ranges, or security groups. This could lead to unauthorized access to resources within the virtual network or disruption of network connectivity.

2. Creation of rogue virtual networks: With the Microsoft.Network.virtualNetworks.write permission, an attacker could create rogue virtual networks within the Azure environment. These rogue networks could be used to bypass network security controls, establish unauthorized communication channels, or launch attacks against other resources within the Azure environment.

3. Exposure of sensitive network information: If security is compromised with Microsoft.Network.virtualNetworks.write permission, an attacker could gain access to sensitive network information, such as IP addresses, routing tables, or network security group rules. This information could be used to plan targeted attacks, exploit vulnerabilities, or gain unauthorized access to resources within the virtual network.

### Remediation

#### Using Console

To remediate the issues mentioned in the previous response for Azure Network using the Azure console, you can follow these step-by-step instructions:

1. Enable Network Security Groups (NSGs):
   - Go to the Azure portal and navigate to the desired virtual network.
   - Select "Network security groups" from the left-hand menu.
   - Click on "Add" to create a new NSG or select an existing NSG.
   - Configure inbound and outbound security rules based on your requirements.
   - Apply the NSG to the desired subnets or network interfaces.

2. Implement Azure DDoS Protection Standard:
   - Go to the Azure portal and navigate to the desired virtual network.
   - Select "Distributed denial of service (DDoS) protection" from the left-hand menu.
   - Click on "Enable DDoS protection" and choose the "Standard" tier.
   - Configure the DDoS protection settings based on your requirements.
   - Apply the DDoS protection to the desired resources within the virtual network.

3. Enable Azure Firewall:
   - Go to the Azure portal and navigate to the desired virtual network.
   - Select "Azure Firewall" from the left-hand menu.
   - Click on "Add" to create a new Azure Firewall or select an existing one.
   - Configure the firewall rules and network rules based on your requirements.
   - Associate the Azure Firewall with the desired subnets within the virtual network.

Note: The above instructions are general guidelines, and you may need to adapt them based on your specific requirements and Azure environment setup. It is recommended to refer to the official Azure documentation for detailed instructions and best practices.

#### Using CLI

To remediate issues related to Azure Network using Azure CLI, you can follow these steps:

1. Enable Network Security Groups (NSGs) for Subnets:
   - Use the `az network vnet subnet update` command to update the subnet configuration.
   - Specify the `--network-security-group` parameter with the name or resource ID of the NSG you want to associate with the subnet.

2. Implement Network Virtual Appliances (NVAs):
   - Use the `az network vnet-gateway create` command to create a virtual network gateway.
   - Specify the `--gateway-type` parameter as "Vpn" or "ExpressRoute" depending on your requirements.
   - Provide the necessary parameters like `--name`, `--resource-group`, `--vnet`, etc.

3. Enable Azure Firewall:
   - Use the `az network firewall create` command to create an Azure Firewall.
   - Specify the `--name` and `--resource-group` parameters for the firewall.
   - Configure the necessary parameters like `--public-ip-address`, `--vnet-name`, `--subnet-name`, etc.

Please note that the actual CLI commands may vary based on your specific requirements and Azure environment setup. Make sure to replace the placeholders with the appropriate values.

#### Using Python

To remediate issues related to AzureNetwork using Python, you can use the Azure SDK for Python. Here are three examples of how you can remediate common issues:

1. Example 1: Enable Network Security Group (NSG) Flow Logs
   - Use the `azure.mgmt.network` package to retrieve the NSG resource.
   - Enable flow logs for the NSG by setting the `enable_flow_logs` property to `True`.
   - Update the NSG resource using the `network_client.network_security_groups.create_or_update` method.

   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.network import NetworkManagementClient

   # Authenticate using default credentials
   credential = DefaultAzureCredential()
   network_client = NetworkManagementClient(credential, subscription_id)

   # Retrieve the NSG resource
   nsg = network_client.network_security_groups.get(resource_group_name, nsg_name)

   # Enable flow logs for the NSG
   nsg.enable_flow_logs = True

   # Update the NSG resource
   network_client.network_security_groups.create_or_update(resource_group_name, nsg_name, nsg)
   ```

2. Example 2: Add a Network Security Rule to an NSG
   - Use the `azure.mgmt.network` package to retrieve the NSG resource.
   - Add a new security rule to the NSG by appending it to the `security_rules` list.
   - Update the NSG resource using the `network_client.network_security_groups.create_or_update` method.

   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.network import NetworkManagementClient
   from azure.mgmt.network.models import SecurityRule

   # Authenticate using default credentials
   credential = DefaultAzureCredential()
   network_client = NetworkManagementClient(credential, subscription_id)

   # Retrieve the NSG resource
   nsg = network_client.network_security_groups.get(resource_group_name, nsg_name)

   # Add a new security rule to the NSG
   new_rule = SecurityRule(name="Allow-SSH", protocol="Tcp", source_port_range="*", destination_port_range="22", access="Allow", direction="Inbound")
   nsg.security_rules.append(new_rule)

   # Update the NSG resource
   network_client.network_security_groups.create_or_update(resource_group_name, nsg_name, nsg)
   ```

3. Example 3: Update Network Security Group (NSG) Rules
   - Use the `azure.mgmt.network` package to retrieve the NSG resource.
   - Modify the existing security rules in the NSG by updating the desired properties.
   - Update the NSG resource using the `network_client.network_security_groups.create_or_update` method.

   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.network import NetworkManagementClient

   # Authenticate using default credentials
   credential = DefaultAzureCredential()
   network_client = NetworkManagementClient(credential, subscription_id)

   # Retrieve the NSG resource
   nsg = network_client.network_security_groups.get(resource_group_name, nsg_name)

   # Modify the existing security rules in the NSG
   for rule in nsg.security_rules:
       if rule.name == "Allow-SSH":
           rule.access = "Deny"

   # Update the NSG resource
   network_client.network_security_groups.create_or_update(resource_group_name, nsg_name, nsg)
   ```


 