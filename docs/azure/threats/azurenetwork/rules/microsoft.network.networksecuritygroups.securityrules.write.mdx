--- 
slug: Microsoft.Network.networkSecurityGroups.securityRules.write
eventname: Microsoft.Network.networkSecurityGroups.securityRules.write
title: Microsoft.Network.networkSecurityGroups.securityRules.write
sidebar_label: Microsoft.Network.networkSecurityGroups.securityRules.write
---
                       
### Event Information

1. The Microsoft.Network.networkSecurityGroups.securityRules.write event in Azure for AzureNetwork refers to the action of creating or modifying security rules within a network security group (NSG) in Azure.

2. This event indicates that changes have been made to the inbound or outbound rules of the NSG, which control the traffic flow to and from the associated resources within the Azure network.

3. It is important to monitor this event as it allows you to track any modifications made to the security rules, ensuring that the network traffic is properly controlled and aligned with your organization's security policies.


### Examples

1. Unauthorized modification of network security rules: If security is impacted with Microsoft.Network.networkSecurityGroups.securityRules.write in Azure for AzureNetwork, it could potentially allow unauthorized users to modify the network security rules associated with the network security group. This could lead to the introduction of insecure rules or the removal of necessary security controls, compromising the overall security of the network.

2. Exposure of sensitive resources: With the ability to write network security rules, an attacker could potentially create rules that expose sensitive resources within the AzureNetwork. For example, they could open up ports or protocols that were previously blocked, allowing unauthorized access to critical systems or data.

3. Network traffic hijacking: By manipulating the network security rules, an attacker could redirect or hijack network traffic within the AzureNetwork. This could be used to intercept sensitive information, perform man-in-the-middle attacks, or gain unauthorized access to resources within the network.

To mitigate these security risks, it is important to closely monitor and control access to the Microsoft.Network.networkSecurityGroups.securityRules.write permission. Implementing strong access controls, regularly reviewing and auditing network security rules, and leveraging network security best practices can help minimize the impact of potential security breaches.

### Remediation

#### Using Console

1. Unauthorized modification of network security rules can be remediated by following these steps in the Azure console:
   - Identify the affected network security group (NSG) associated with the AzureNetwork.
   - Navigate to the Azure portal and search for "Network security groups" in the search bar.
   - Select the appropriate NSG from the list.
   - Click on the "Inbound security rules" or "Outbound security rules" tab, depending on the direction of the unauthorized modification.
   - Review the existing rules and identify any unauthorized or suspicious rules.
   - Delete the unauthorized rules by selecting them and clicking on the "Delete" button.
   - Consider implementing Azure Firewall or Azure Application Gateway to provide additional security controls and prevent unauthorized modifications in the future.

2. To remediate the exposure of sensitive resources through unauthorized network security rules modification:
   - Follow the steps mentioned above to identify and access the affected NSG.
   - Review the existing rules and identify any rules that expose sensitive resources.
   - Modify or delete the rules that allow unauthorized access to critical systems or data.
   - Consider implementing Azure Network Security Groups (NSGs) with more granular rules to restrict access to sensitive resources.
   - Regularly monitor and audit the NSG rules to ensure compliance and detect any unauthorized modifications.

3. To remediate network traffic hijacking caused by unauthorized network security rule modification:
   - Follow the steps mentioned above to identify and access the affected NSG.
   - Review the existing rules and identify any rules that could potentially redirect or hijack network traffic.
   - Modify or delete the rules that redirect traffic to malicious endpoints or bypass security controls.
   - Implement network traffic monitoring and intrusion detection systems to detect and prevent network traffic hijacking attempts.
   - Regularly review and update the NSG rules to ensure that only necessary and secure traffic is allowed.

#### Using CLI

1. To remediate unauthorized modification of network security rules in Azure for AzureNetwork, you can use the Azure CLI to restore the security rules to their desired state. 

   - First, identify the desired network security rules configuration that should be applied.
   - Use the `az network nsg rule create` command to create or update the network security rules with the desired configuration.
   - Ensure that only authorized users have the necessary permissions to modify the network security rules.

2. To remediate the exposure of sensitive resources due to unauthorized modification of network security rules in Azure for AzureNetwork, you can follow these steps:

   - Identify the sensitive resources that have been exposed by the unauthorized network security rules.
   - Use the Azure CLI to update the network security rules and remove the rules that expose the sensitive resources.
   - Regularly review and audit the network security rules to ensure that only necessary and secure rules are in place.

3. To remediate the risk of network traffic hijacking in Azure for AzureNetwork caused by unauthorized modification of network security rules, you can take the following actions:

   - Use the Azure CLI to review and update the network security rules to prevent any redirection or hijacking of network traffic.
   - Ensure that the network security rules are configured to only allow traffic to authorized endpoints and block any suspicious or malicious traffic.
   - Regularly monitor and analyze network traffic to detect any anomalies or unauthorized redirection attempts.

#### Using Python

1. Unauthorized modification of network security rules can be remediated by implementing strict access controls and permissions for managing network security groups in Azure. This can be achieved by following these steps using Python:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()

# Specify your Azure subscription ID and resource group name
subscription_id = 'your_subscription_id'
resource_group_name = 'your_resource_group_name'

# Create a Network Management client
network_client = NetworkManagementClient(credential, subscription_id)

# Specify the name of the network security group and the security rule to be modified
network_security_group_name = 'your_network_security_group_name'
security_rule_name = 'your_security_rule_name'

# Get the existing security rule
security_rule = network_client.security_rules.get(resource_group_name, network_security_group_name, security_rule_name)

# Modify the security rule as needed
security_rule.access = 'Deny'  # Example: Change the access to 'Deny'

# Update the security rule
network_client.security_rules.create_or_update(resource_group_name, network_security_group_name, security_rule_name, security_rule)
```

2. To mitigate the exposure of sensitive resources, it is important to regularly review and audit the network security rules in Azure. This can be done using the following Python script:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.network import NetworkManagementClient

# Authenticate using default credentials
credential = DefaultAzureCredential()

# Specify your Azure subscription ID and resource group name
subscription_id = 'your_subscription_id'
resource_group_name = 'your_resource_group_name'

# Create a Network Management client
network_client = NetworkManagementClient(credential, subscription_id)

# Specify the name of the network security group
network_security_group_name = 'your_network_security_group_name'

# Get all the security rules associated with the network security group
security_rules = network_client.security_rules.list(resource_group_name, network_security_group_name)

# Iterate through the security rules and check for any rules that expose sensitive resources
for security_rule in security_rules:
    if security_rule.destination_port_range == 'SensitivePort':
        print(f"Security rule {security_rule.name} exposes sensitive resources.")
```

3. To prevent network traffic hijacking, it is recommended to regularly monitor and analyze network traffic patterns within Azure. Additionally, implementing network security monitoring tools and intrusion detection systems can help detect and mitigate any suspicious or unauthorized network traffic.


 