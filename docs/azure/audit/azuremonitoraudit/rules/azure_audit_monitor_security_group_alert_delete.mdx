---
slug: azure_audit_monitor_security_group_alert_delete
title: Ensure Activity Log Alert exists for Delete Network Security Group
sidebar_label: Ensure Activity Log Alert exists for Delete Network Security Group
---

### More Info:

Monitoring for 'Delete Network Security Group' events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

CISAZURE, CBP, SOC2, ISO27001, HIPAA, HITRUST, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Open your web browser, navigate to the Azure portal and sign in with your Azure account credentials.

2. Navigate to Monitor: On the left-hand side menu, click on "Monitor". This will open the Monitor blade where you can view and manage all your monitoring settings.

3. Check Activity Log Alerts: In the Monitor blade, click on "Alerts" and then select "Manage alert rules". This will open a list of all your existing alert rules. Look for an alert rule that is set up to trigger when a Network Security Group is deleted.

4. Verify Alert Details: Click on the alert rule to view its details. Ensure that the rule is set to trigger on the 'Delete Network Security Group' activity. The rule should be active and properly configured to notify the appropriate parties when it is triggered.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft Azure website. Once installed, open your command prompt or terminal and type `az login` to log in to your Azure account.

2. Check for Existing Activity Log Alerts: To check if an Activity Log Alert exists for Delete Network Security Group, you can use the following command:

    ```
    az monitor activity-log alert list --resource-group <resource-group-name>
    ```
    Replace `<resource-group-name>` with the name of your resource group. This command will list all the activity log alerts in the specified resource group.

3. Filter the Results: The above command will return a list of all activity log alerts. You need to check if there is an alert for 'Delete Network Security Group'. You can do this by piping the output to a grep command or by manually inspecting the output. Look for an alert with a condition that includes `'equals': 'Microsoft.Network/networkSecurityGroups/delete'`.

4. Verify the Alert: Once you find the alert, verify that it is enabled and properly configured to send notifications when a Network Security Group is deleted. The alert's `enabled` property should be `true`, and the `actions` property should include at least one action group for sending notifications.

Please note that the exact commands and properties may vary depending on your Azure CLI version and configuration. Always refer to the official Azure CLI documentation for the most accurate information.

#### Using Python

1. Install Azure SDK: To interact with Azure services, you need to install Azure SDK in your Python environment. You can do this by running the command `pip install azure-mgmt-monitor`.

2. Import Required Libraries: Import the necessary libraries into your Python script.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.monitor import MonitorManagementClient
from azure.mgmt.monitor.models import ActivityLogAlertResource
```

3. Authenticate and Initialize Monitor Management Client: Use the DefaultAzureCredential from the Azure Identity library to authenticate the user. Then, initialize the MonitorManagementClient with your subscription ID.

```python
credential = DefaultAzureCredential()
subscription_id = 'your-subscription-id'
monitor_client = MonitorManagementClient(credential, subscription_id)
```

4. Check for Activity Log Alert: Now, you can use the `activity_log_alerts` attribute of the `monitor_client` to list all the activity log alerts in your subscription. You can then iterate over these alerts and check if there is an alert for 'Delete Network Security Group'.

```python
activity_log_alerts = monitor_client.activity_log_alerts.list_by_subscription_id()

for alert in activity_log_alerts:
    if 'Delete Network Security Group' in alert.condition.all_of:
        print(f"Alert exists for Delete Network Security Group: {alert.name}")
```

This script will print the name of the alert if it exists. If it doesn't print anything, that means there is no alert for 'Delete Network Security Group'.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "Ensure Activity Log Alert exists for Delete Network Security Group" for Azure using the Azure console:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Click on "Monitor" from the left-hand menu.
3. Click on "Activity log" from the "Monitor" menu.
4. Click on the "Alerts" tab.
5. Click on the "New alert rule" button.
6. In the "Create rule" page, select the "Resource Manager" option.
7. In the "Condition" section, select "Delete Network Security Group" from the "Event name" drop-down menu.
8. In the "Actions" section, select "Create action group" and click on the "OK" button.
9. In the "Create action group" page, provide a name for the action group, select the "Email/SMS/Push/Voice" option, and enter the email address or phone number to receive the alert.
10. Click on the "OK" button to create the action group.
11. In the "Create rule" page, provide a name for the alert rule, select the action group you just created, and click on the "Create alert rule" button.

You have now successfully remediated the misconfiguration "Ensure Activity Log Alert exists for Delete Network Security Group" for Azure using the Azure console. Now, whenever a network security group is deleted, an alert will be sent to the specified email address or phone number.

#### Using CLI

To remediate the misconfiguration of not having an Activity Log Alert for Delete Network Security Group in Azure using Azure CLI, follow these steps:

1. Open Azure CLI on your machine.

2. Run the following command to create an Activity Log Alert for Delete Network Security Group:

```
az monitor activity-log alert create --name <Alert_Name> --description <Alert_Description> --condition category=Administrative and operationName=Microsoft.Network/networkSecurityGroups/delete --action email <Email_Address>
```

Replace `<Alert_Name>` with the name of the alert you want to create, `<Alert_Description>` with a brief description of the alert, and `<Email_Address>` with the email address to which the alert should be sent.

3. Once the command is executed successfully, the alert will be created and configured to send an email notification whenever a Network Security Group is deleted.

4. You can verify the alert by running the following command:

```
az monitor activity-log alert list
```

This will display a list of all the activity log alerts configured in your Azure environment, including the one you just created.

By following these steps, you can remediate the misconfiguration of not having an Activity Log Alert for Delete Network Security Group in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration "Ensure Activity Log Alert exists for Delete Network Security Group" in Azure using Python, you can follow the below steps:

Step 1: Install the Azure SDK for Python using the following pip command:

```python
pip install azure-mgmt-monitor
```

Step 2: Use the below code to check if an Activity Log Alert exists for Delete Network Security Group:

```python
from azure.mgmt.monitor import MonitorManagementClient
from azure.common.credentials import ServicePrincipalCredentials

# Replace with your tenant ID, client ID and client secret
tenant_id = '<your_tenant_id>'
client_id = '<your_client_id>'
client_secret = '<your_client_secret>'

# Replace with your subscription ID and resource group name
subscription_id = '<your_subscription_id>'
resource_group_name = '<your_resource_group_name>'

# Replace with your Activity Log Alert name and resource ID of the Network Security Group
activity_log_alert_name = '<your_activity_log_alert_name>'
network_security_group_resource_id = '<your_network_security_group_resource_id>'

# Create credentials object
credentials = ServicePrincipalCredentials(client_id=client_id, secret=client_secret, tenant=tenant_id)

# Create MonitorManagementClient object
monitor_client = MonitorManagementClient(credentials, subscription_id)

# Get Activity Log Alert by name
activity_log_alert = monitor_client.activity_log_alerts.get(resource_group_name, activity_log_alert_name)

# Get the condition of the Activity Log Alert
condition = activity_log_alert.condition.all_of[0].field_value == network_security_group_resource_id and activity_log_alert.condition.all_of[0].equals == 'Microsoft.Network/networkSecurityGroups/delete'

# Check if the Activity Log Alert exists for Delete Network Security Group
if activity_log_alert.enabled and condition:
    print('Activity Log Alert exists for Delete Network Security Group')
else:
    print('Activity Log Alert does not exist for Delete Network Security Group')
```

Step 3: If the output of the above code is "Activity Log Alert does not exist for Delete Network Security Group", then you can use the below code to create an Activity Log Alert for Delete Network Security Group:

```python
from azure.mgmt.monitor.models import *

# Replace with your Activity Log Alert name, description and resource ID of the Network Security Group
activity_log_alert_name = '<your_activity_log_alert_name>'
activity_log_alert_description = '<your_activity_log_alert_description>'
network_security_group_resource_id = '<your_network_security_group_resource_id>'

# Create the condition for the Activity Log Alert
condition = Condition(all_of=[ManagementEventRuleCondition(field='resourceId', equals=network_security_group_resource_id), ManagementEventRuleCondition(field='operationName', equals='Microsoft.Network/networkSecurityGroups/delete')])

# Create the Action Group for the Activity Log Alert
action_group = ActionGroup(action_group_id='<your_action_group_id>')

# Create the Activity Log Alert object
activity_log_alert = ActivityLogAlert(enabled=True, name=activity_log_alert_name, description=activity_log_alert_description, condition=condition, actions=[action_group])

# Create the Activity Log Alert
monitor_client.activity_log_alerts.create_or_update(resource_group_name, activity_log_alert_name, activity_log_alert)
```

Note: Replace the placeholders `<your_tenant_id>`, `<your_client_id>`, `<your_client_secret>`, `<your_subscription_id>`, `<your_resource_group_name>`, `<your_activity_log_alert_name>`, `<your_activity_log_alert_description>`, `<your_network_security_group_resource_id>` and `<your_action_group_id>` with the actual values for your Azure environment.


### Additional Reading:

- [https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log](https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log) 


</Tab>
</Tabs>