

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal and navigate to the "Storage Accounts" section. 

2. Select the storage account you want to check. In the storage account window, click on the "Blob service" section, then select "Containers".

3. In the Containers window, select the container that you want to check. This should be the container that is storing your logs.

4. In the container window, check the "Public access level" setting. If it is set to "Private (no anonymous access)", then the container is not publicly accessible. If it is set to "Blob (anonymous read access for blobs only)" or "Container (anonymous read access for containers and blobs)", then the container is publicly accessible and this is a misconfiguration.

#### Using CLI

1. Install and configure Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine and sign in to your Azure account. You can install Azure CLI by following the instructions provided by Microsoft. Once installed, you can sign in to your Azure account using the following command:

   ```
   az login
   ```

2. List all storage accounts: The first step to check if a storage account container containing the logs is publicly accessible is to list all the storage accounts in your Azure subscription. You can do this using the following command:

   ```
   az storage account list
   ```

3. Get the properties of the storage account: Once you have the list of all storage accounts, you can get the properties of each storage account using the following command:

   ```
   az storage account show --name {storage_account_name} --query 'allowBlobPublicAccess'
   ```

   Replace `{storage_account_name}` with the name of your storage account. This command will return the value of the `allowBlobPublicAccess` property of the storage account. If the value is `true`, then the storage account container is publicly accessible.

4. Check the access level of the container: To further confirm if the container is publicly accessible, you can check the access level of the container using the following command:

   ```
   az storage container show --name {container_name} --account-name {storage_account_name} --query 'publicAccess'
   ```

   Replace `{container_name}` with the name of your container and `{storage_account_name}` with the name of your storage account. This command will return the access level of the container. If the access level is `blob` or `container`, then the container is publicly accessible.

#### Using Python

To check if a Storage Account container containing the logs is not publicly accessible in Azure, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: You need to install the Azure SDK for Python if it's not already installed. You can install it using pip:
   ```python
   pip install azure-storage-blob
   ```
2. **Import Required Libraries**: Import the necessary libraries into your Python script:
   ```python
   from azure.storage.blob import BlobServiceClient, BlobClient, ContainerClient, PublicAccess
   ```
3. **Create a BlobServiceClient**: You need to create a BlobServiceClient object which will be used to create a ContainerClient object. Replace 'my_connection_string' with your storage account's connection string.
   ```python
   blob_service_client = BlobServiceClient.from_connection_string('my_connection_string')
   ```
4. **Check Public Access Level**: Now, you can create a ContainerClient for the container you want to check and then get the container's properties. If the public access level is blob or container, then the container is publicly accessible.
   ```python
   container_client = blob_service_client.get_container_client('my_container')
   properties = container_client.get_container_properties()
   if properties.public_access == PublicAccess.Container or properties.public_access == PublicAccess.Blob:
       print("The container is publicly accessible")
   else:
       print("The container is not publicly accessible")
   ```
This script will print whether the specified container is publicly accessible or not. If you want to check all containers in the storage account, you can list all containers using the `blob_service_client.list_containers()` method and then check each container's public access level in a loop.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration in Azure, you can follow these steps:

1. Open the Azure portal and navigate to the storage account that contains the container with the logs.

2. Click on the "Containers" tab on the left-hand side of the screen.

3. Select the container that contains the logs.

4. Click on the "Access policy" tab on the top of the screen.

5. Under the "Public access level" section, select "Private (no anonymous access)".

6. Click on the "Save" button at the top of the screen to save the changes.

7. Verify that the container is no longer publicly accessible by trying to access it from a different browser or device.

By following these steps, you have successfully remediated the misconfiguration and ensured that the storage account container containing the logs is no longer publicly accessible.

#### Using CLI

To remediate the issue of a publicly accessible Storage Account container containing logs in Azure, you can follow the steps below using Azure CLI:

1. Log in to your Azure account using the Azure CLI command `az login`.

2. Once you have successfully logged in, you can list all the storage accounts in your subscription using the command `az storage account list`.

3. Identify the storage account that contains the publicly accessible container and copy its `resource group` and `name`.

4. Use the following command to update the access level of the container to private: 

   `az storage container set-permission --account-name <storage_account_name> --account-key <storage_account_key> --name <container_name> --public-access off`

   Replace `<storage_account_name>` with the name of the storage account, `<storage_account_key>` with the account key of the storage account, and `<container_name>` with the name of the container that contains the logs.

5. Verify that the access level of the container has been updated to private by running the command `az storage container show --account-name <storage_account_name> --account-key <storage_account_key> --name <container_name>`.

   If the access level is set to `private`, you have successfully remediated the issue. 

By following these steps, you can remediate the issue of a publicly accessible Storage Account container containing logs in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration in Azure using Python, you can follow these steps:

1. Import the required modules:

```python
from azure.storage.blob import BlobServiceClient, PublicAccess
from azure.core.exceptions import ResourceExistsError
```

2. Connect to the Azure Storage Account using the connection string:

```python
connection_string = "<your_connection_string>"
blob_service_client = BlobServiceClient.from_connection_string(connection_string)
```

3. Get the container name that contains the logs:

```python
container_name = "<your_container_name>"
container_client = blob_service_client.get_container_client(container_name)
```

4. Set the PublicAccess level to 'None':

```python
try:
    container_client.set_access_policy(PublicAccess.NONE)
    print("Public access has been removed from the container.")
except ResourceExistsError:
    print("The container already has PublicAccess.NONE.")
```

5. Verify that the PublicAccess level has been set to 'None':

```python
container_properties = container_client.get_container_properties()
print("Public access level: ", container_properties.public_access)
```

This will ensure that the Storage Account container containing the logs is not publicly accessible.


</Tab>
</Tabs>