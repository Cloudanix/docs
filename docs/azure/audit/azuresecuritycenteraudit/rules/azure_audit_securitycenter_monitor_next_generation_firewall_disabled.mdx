---
slug: azure_audit_securitycenter_monitor_next_generation_firewall_disabled
title: Monitor Next Generation Firewall (NGFW) setting is not enabled
sidebar_label: Monitor Next Generation Firewall (NGFW) setting is not enabled
---

### More Info:

Enable Next Generation Firewall (NGFW) recommendations for virtual machines.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

SOC2, ISO27001, HIPAA


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Open your web browser, navigate to the Azure portal (https://portal.azure.com/), and sign in with your Azure account credentials.

2. Open Security Center: Once you're logged in, locate the "Security Center" in the left-hand menu. If it's not immediately visible, you can find it by using the search bar at the top of the dashboard.

3. Navigate to Security Policy: In the Security Center dashboard, find and click on the "Security policy" option in the sidebar menu. This will open a new page where you can see all the security policies applied to your subscriptions.

4. Check NGFW setting: In the Security Policy page, look for the "Monitor Next Generation Firewall (NGFW)" setting under the "Data & Storage" section. If it's not enabled, it means that the NGFW setting is not being monitored.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: After installing Azure CLI, you need to login to your Azure account. Open your command prompt and type the following command:
   ```
   az login
   ```
   This will open a new browser window asking you to sign in to your Azure account.

3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where you want to check the NGFW setting. Use the following command to set the subscription:
   ```
   az account set --subscription "your-subscription-id"
   ```
4. Check NGFW Setting: Now, you can check the NGFW setting in Security Center. Use the following command to get the details:
   ```
   az security pricing list --query "[?name=='VirtualNetworks']"
   ```
   This command will return the details of the NGFW setting. If the 'pricingTier' is set to 'Standard', it means the NGFW setting is enabled. If it's set to 'Free', it means the NGFW setting is not enabled.

#### Using Python

To check if the Monitor Next Generation Firewall (NGFW) setting is not enabled in Azure Security Center using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to work with Azure services like Azure Storage, Azure Cosmos DB, etc. You can install it using pip:
   ```
   pip install azure
   ```

2. **Authenticate to Azure**: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for Python to authenticate:
   ```python
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   ```

3. **Create a client to interact with Azure Security Center**: You can use Azure Security Center's management client to interact with it. You need to provide your subscription ID and the credential object you created in the previous step:
   ```python
   from azure.mgmt.security import SecurityCenter

   subscription_id = "<your-subscription-id>"
   client = SecurityCenter(credential, subscription_id)
   ```

4. **Check if NGFW is enabled**: You can use the `client` object to check if NGFW is enabled. If it's not enabled, the script will print a message:
   ```python
   settings = client.settings.get("MCAS")
   if settings.data["MonitoringStatus"] != "On":
       print("Monitor Next Generation Firewall (NGFW) setting is not enabled.")
   ```
Please replace `<your-subscription-id>` with your actual Azure subscription ID.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Monitor Next Generation Firewall (NGFW) setting is not enabled" for Azure using Azure console, follow the below steps:

1. Login to the Azure portal (https://portal.azure.com/)
2. Go to the "Security Center" service
3. In the left-hand menu, select "Security policy"
4. Scroll down to "Firewall" and click on "Edit settings"
5. Under "Next Generation Firewall (NGFW)", toggle the switch to "On"
6. Click on "Save" to apply the changes.

After enabling the Monitor Next Generation Firewall (NGFW) setting, Azure Security Center will start monitoring your NGFW logs and alert you if any suspicious activity is detected. This will help you to identify and remediate any potential security threats in your Azure environment.

#### Using CLI

To remediate the misconfiguration "Monitor Next Generation Firewall (NGFW) setting is not enabled" for Azure using Azure CLI, you can follow the below steps:

Step 1: Open Azure CLI and login to your Azure account using the command `az login`.

Step 2: Once you are logged in, run the command `az network firewall show --name <NGFW-Name> --resource-group <Resource-Group-Name> --query "enableDnsProxy"`. This command will check if the DNS proxy is enabled on the NGFW or not.

Step 3: If the output of the above command is "false", then run the command `az network firewall update --name <NGFW-Name> --resource-group <Resource-Group-Name> --enable-dns-proxy true`. This command will enable the DNS proxy on the NGFW.

Step 4: Once the DNS proxy is enabled on the NGFW, you can verify it by running the command `az network firewall show --name <NGFW-Name> --resource-group <Resource-Group-Name> --query "enableDnsProxy"`. The output of this command should be "true".

Step 5: Finally, you can check if the misconfiguration is remediated or not by checking the Monitor NGFW setting. If it is enabled, then the misconfiguration is remediated successfully.

Note: Replace `<NGFW-Name>` with the name of your NGFW and `<Resource-Group-Name>` with the name of your resource group.

#### Using Python

To remediate the "Monitor Next Generation Firewall (NGFW) setting is not enabled" misconfiguration for Azure using Python, follow these steps:

1. Install the Azure SDK for Python by running the following command in your terminal or command prompt:
```
pip install azure-mgmt-monitor
```

2. Import the necessary modules in your Python script:
```python
from azure.common.credentials import ServicePrincipalCredentials
from azure.mgmt.monitor import MonitorManagementClient
```

3. Set up the credentials for your Azure account by creating a Service Principal. You can follow the instructions in this Microsoft documentation to create a Service Principal: https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal

4. Create a MonitorManagementClient object using the credentials you just set up:
```python
subscription_id = 'your-subscription-id'
credentials = ServicePrincipalCredentials(
    client_id='your-client-id',
    secret='your-client-secret',
    tenant='your-tenant-id'
)

monitor_client = MonitorManagementClient(
    credentials=credentials,
    subscription_id=subscription_id
)
```

5. Use the MonitorManagementClient object to enable the NGFW setting for Azure Firewall:
```python
resource_group_name = 'your-resource-group-name'
firewall_name = 'your-firewall-name'

firewall = monitor_client.firewall_policies.get(resource_group_name, firewall_name)
firewall.enable_ngfw(True)

monitor_client.firewall_policies.create_or_update(resource_group_name, firewall_name, firewall)
```

6. Verify that the NGFW setting has been enabled by checking the Firewall Policy in the Azure portal.

By following these steps, you should be able to remediate the "Monitor Next Generation Firewall (NGFW) setting is not enabled" misconfiguration for Azure using Python.




</Tab>
</Tabs>