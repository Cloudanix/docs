---
slug: azure_audit_securitycenter_security_contacts_alert_to_admins_not_set
title: Sending Email to Administrators on Alert Is Off
sidebar_label: Sending Email to Administrators on Alert Is Off
---

### More Info:

Set Send Me Email About Alerts to On.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal by entering "portal.azure.com" in your web browser and enter your login credentials.

2. Open Security Center: Once you are logged in, look for the "Security Center" in the left-hand menu. If it's not visible, you can find it by using the search bar at the top of the dashboard.

3. Navigate to Pricing & settings: In the Security Center dashboard, look for the "Pricing & settings" option in the left-hand menu and click on it.

4. Check Email Notifications: In the Pricing & settings page, you will find the "Email Notifications" section. Here, you can check if the "Send email notification to administrators on alert" option is turned off or on. If it's off, then it means that the administrators are not receiving email notifications when an alert is triggered.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft Azure website. After installation, open your command prompt or terminal.

2. Login to Azure: Use the following command to login to your Azure account. You will be redirected to the browser for login. Enter your credentials and login.
   ```
   az login
   ```
3. Select Subscription: If you have multiple subscriptions, select the subscription where you want to check the misconfiguration. Use the following command to set the subscription.
   ```
   az account set --subscription "mySubscription"
   ```
4. Check Email Alert: Use the following command to check if sending email to administrators on alert is off in Security Center.
   ```
   az security alert show --location "Global" --name "SecurityCenterFree"
   ```
   In the output, look for the "emailAccountAdmins" field. If it is set to "false", then sending email to administrators on alert is off.

#### Using Python

To check if sending email to administrators on alert is off in Security Center using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to work with Azure services. You can install it using pip:
   ```
   pip install azure-mgmt-security
   ```
2. **Authenticate to Azure**: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for this. Here is a sample code snippet:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter

   credential = DefaultAzureCredential()
   security_center = SecurityCenter(credential, "<subscription_id>")
   ```
3. **Get Security Center Settings**: You can use the `security_center.settings.get()` method to get the settings. Here is a sample code snippet:
   ```python
   settings = security_center.settings.get(setting_name="MCAS")
   print(settings)
   ```
4. **Check if Email Alerts are Enabled**: The settings object returned in the previous step contains a property `email_notification_admins` which indicates if email alerts are enabled or not. Here is a sample code snippet:
   ```python
   if settings.email_notification_admins:
       print("Email alerts are enabled")
   else:
       print("Email alerts are disabled")
   ```
Please replace `<subscription_id>` with your actual Azure subscription ID.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Sending Email to Administrators on Alert Is Off" for Azure using the Azure console, follow these steps:

1. Log in to the Azure portal.
2. Navigate to the "Monitor" section from the left-hand side menu.
3. Click on "Alerts" from the Monitor menu.
4. Select the alert that needs to be remediated.
5. Click on the "Edit" button.
6. In the "Actions" section, click on the "Add action group" button.
7. In the "Create action group" window, enter a name for the action group.
8. In the "Actions" section of the "Create action group" window, select "Email/SMS/Push/Voice" as the action type.
9. In the "Email/SMS/Push/Voice" section, enter the email addresses of the administrators who should receive the alert notifications.
10. Click on the "OK" button to create the action group.
11. In the "Actions" section of the alert, select the newly created action group.
12. Save the changes to the alert.

After completing these steps, the alert will trigger an email notification to the specified administrators when it is triggered.

#### Using CLI

To remediate the misconfiguration "Sending Email to Administrators on Alert Is Off" in Azure using Azure CLI, you can follow the below steps:

Step 1: Open the Azure CLI and login to your Azure account using the command:
```
az login
```

Step 2: Once you are logged in, set the subscription in which the alert is created using the command:
```
az account set --subscription <subscription_id>
```

Step 3: Get the list of all the alert rules configured in the subscription using the command:
```
az monitor metrics alert list-rules --resource-group <resource_group_name>
```

Step 4: Identify the alert rule for which the "Sending Email to Administrators on Alert Is Off" misconfiguration exists.

Step 5: Update the alert rule to enable sending email to administrators on alert using the command:
```
az monitor metrics alert update --resource-group <resource_group_name> --name <alert_rule_name> --email-service-owners true
```

Step 6: Verify the update by checking the alert rule configuration using the command:
```
az monitor metrics alert show --resource-group <resource_group_name> --name <alert_rule_name>
```

Step 7: Once you have verified the update, the misconfiguration "Sending Email to Administrators on Alert Is Off" would have been remediated.

Note: In Step 5, replace `<resource_group_name>` with the name of the resource group in which the alert rule is created, `<alert_rule_name>` with the name of the alert rule for which the misconfiguration exists, and `true` with `false` to disable sending email to administrators on alert.

#### Using Python

To remediate the misconfiguration "Sending Email to Administrators on Alert Is Off" for Azure using Python, you can follow the below steps:

Step 1: Import necessary libraries and authenticate to Azure.

```python
from azure.common.credentials import ServicePrincipalCredentials
from azure.mgmt.monitor import MonitorManagementClient
from azure.mgmt.monitor.models import ActionGroupPatchBody, EmailReceiver

subscription_id = '<Subscription ID>'
client_id = '<Client ID>'
secret = '<Client Secret>'
tenant = '<Tenant ID>'

credentials = ServicePrincipalCredentials(
    client_id=client_id,
    secret=secret,
    tenant=tenant
)

monitor_client = MonitorManagementClient(credentials, subscription_id)
```

Step 2: Get the action groups and check if the email receiver is enabled or not.

```python
action_groups = monitor_client.action_groups.list()
for action_group in action_groups:
    if action_group.email_receivers is not None:
        for email_receiver in action_group.email_receivers:
            if email_receiver.name == 'Administrators':
                if email_receiver.enabled is False:
                    print('Email receiver for Administrators is disabled')
```

Step 3: Enable the email receiver for the Administrators group.

```python
action_group_patch = ActionGroupPatchBody(
    email_receivers=[
        EmailReceiver(
            name='Administrators',
            email_address='<Email Address>',
            use_common_alert_schema=True,
            enabled=True
        )
    ]
)

monitor_client.action_groups.update(
    resource_group_name='<Resource Group Name>',
    action_group_name='<Action Group Name>',
    parameters=action_group_patch
)
```

Replace the placeholders `<Subscription ID>`, `<Client ID>`, `<Client Secret>`, `<Tenant ID>`, `<Email Address>`, `<Resource Group Name>`, and `<Action Group Name>` with the appropriate values.

Note: This solution assumes that the action group and email receiver for the Administrators group already exist. If they don't exist, you can create them using the Azure Portal or the Azure SDK for Python.




</Tab>
</Tabs>