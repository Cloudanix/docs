---
slug: azure_audit_securitycenter_defender_enabled_for_app_service_instances
title: Enable Microsoft Defender for Cloud for App Service Instances
sidebar_label: Enable Microsoft Defender for Cloud for App Service Instances
---

### More Info:

Ensure that Microsoft Defender for Cloud is enabled for Azure App Service instances.

### Risk Level

High

### Address

Security, Operational Maturity

### Compliance Standards

CISAZURE, CBP, HITRUST


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to portal.azure.com and sign in with your Azure account credentials.

2. Open Security Center: On the left-hand side menu, click on "Security Center". This will open the Security Center dashboard where you can view and manage the security posture of your Azure resources.

3. Check Recommendations: In the Security Center dashboard, click on "Recommendations". This will display a list of security recommendations for your Azure resources.

4. Check for Microsoft Defender for Cloud: In the list of recommendations, look for "Enable Microsoft Defender for Cloud for App Service Instances". If this recommendation is present, it means that Microsoft Defender for Cloud is not currently enabled for your App Service Instances. If the recommendation is not present, it means that Microsoft Defender for Cloud is already enabled.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: Open your command line interface and type the following command to login to your Azure account:
   ```
   az login
   ```
   Follow the instructions to complete the login process.

3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where your App Service Instances are located. Use the following command to list all your subscriptions:
   ```
   az account list --output table
   ```
   Then, use the following command to set your desired subscription as the active subscription:
   ```
   az account set --subscription "Your Subscription Name"
   ```
4. Check Microsoft Defender for Cloud: Use the following command to check if Microsoft Defender for Cloud is enabled for your App Service Instances:
   ```
   az security pricing list
   ```
   This command will list all the resources and their associated security pricing tiers. Look for your App Service Instances in the list and check if the pricing tier is set to 'Standard'. If it is set to 'Standard', it means Microsoft Defender for Cloud is enabled for your App Service Instances. If it is set to 'Free', it means Microsoft Defender for Cloud is not enabled.

#### Using Python

1. Install Azure SDK for Python: Azure SDK for Python is a set of libraries that you can use to interact with Azure services. You can install it using pip:

   ```bash
   pip install azure-mgmt-security
   ```
   
2. Import the necessary libraries and authenticate: You need to import the necessary libraries and authenticate to your Azure account. You can use Azure Identity library for authentication.

   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'  # replace with your subscription id
   asc_client = SecurityCenter(credential, subscription_id)
   ```

3. Get the security settings: You can use the `security_settings` property of the `SecurityCenter` client to get the security settings. This will return a list of all security settings.

   ```python
   security_settings = asc_client.security_settings.list()
   ```

4. Check if Microsoft Defender for Cloud is enabled for App Service Instances: You can iterate over the security settings and check if Microsoft Defender for Cloud is enabled for App Service Instances.

   ```python
   for setting in security_settings:
       if setting.name == 'MCAS':
           print(f"Microsoft Defender for Cloud is {'enabled' if setting.is_enabled else 'disabled'} for App Service Instances")
   ```
   
Please replace 'your-subscription-id' with your actual Azure subscription id.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Enable Microsoft Defender for Cloud for App Service Instances" in Azure using the Azure console, please follow these steps:

1. Open the Azure portal and navigate to the App Service instance for which you want to enable Microsoft Defender for Cloud.

2. Click on "Security" from the left-hand menu and then click on "Security Center" from the sub-menu.

3. In the Security Center, click on "Recommendations" from the left-hand menu.

4. Search for the recommendation "Enable Microsoft Defender for Cloud for App Service Instances" in the list of recommendations.

5. Click on the recommendation to view the details.

6. Click on the "Remediate" button to remediate the recommendation.

7. In the "Remediate" pane, select the subscription, resource group, and App Service instance for which you want to enable Microsoft Defender for Cloud.

8. Click on the "Remediate" button to enable Microsoft Defender for Cloud for the selected App Service instance.

9. Once the remediation is complete, the recommendation status will change to "Compliant".

By following these steps, you can successfully remediate the misconfiguration "Enable Microsoft Defender for Cloud for App Service Instances" in Azure using the Azure console.

#### Using CLI

To enable Microsoft Defender for Cloud for App Service Instances in Azure using Azure CLI, you can follow these steps:

1. Open the Azure CLI command prompt.

2. Log in to your Azure account using the following command:

   ```
   az login
   ```

3. Select the subscription that contains the App Service Instance you want to enable Microsoft Defender for Cloud for using the following command:

   ```
   az account set --subscription <subscription_id>
   ```

4. Enable Microsoft Defender for Cloud for the App Service Instance using the following command:

   ```
   az webapp update --name <app_service_instance_name> --resource-group <resource_group_name> --set properties.siteAuthEnabled=true
   ```

   This command sets the `siteAuthEnabled` property of the App Service Instance to `true`, which enables Microsoft Defender for Cloud.

5. Verify that Microsoft Defender for Cloud is enabled for the App Service Instance using the following command:

   ```
   az webapp show --name <app_service_instance_name> --resource-group <resource_group_name> --query 'properties.siteAuthEnabled'
   ```

   This command returns the value `true` if Microsoft Defender for Cloud is enabled for the App Service Instance.

That's it! You have successfully enabled Microsoft Defender for Cloud for the App Service Instance in Azure using Azure CLI.

#### Using Python

To enable Microsoft Defender for Cloud for App Service Instances in Azure using Python, follow these steps:

1. Import the necessary libraries:
```
from azure.identity import DefaultAzureCredential
from azure.mgmt.web import WebSiteManagementClient
from azure.mgmt.web.models import SiteConfigResource
```

2. Authenticate using Azure credentials:
```
credential = DefaultAzureCredential()
subscription_id = 'your-subscription-id'
resource_group_name = 'your-resource-group-name'
webapp_name = 'your-webapp-name'

web_client = WebSiteManagementClient(credential, subscription_id)
```

3. Get the current site configuration:
```
site_config = web_client.web_apps.get_configuration(resource_group_name, webapp_name)
```

4. Enable Microsoft Defender for Cloud by setting the `webSiteManagementEndpointEnabled` property to `True`:
```
site_config.site_auth_enabled = True
site_config.windows_fx_version = "DOCKER|mcr.microsoft.com/azure-security/defender-appsvc:latest"
site_config.app_command_line = "java -jar /home/site/wwwroot/defender/defender.jar"
site_config.linux_fx_version = "DOCKER|mcr.microsoft.com/azure-security/defender-appsvc:latest"
site_config.webSiteManagementEndpointEnabled = True
```

5. Update the site configuration:
```
web_client.web_apps.update_configuration(resource_group_name, webapp_name, site_config)
```

After executing these steps, Microsoft Defender for Cloud will be enabled for the App Service Instance in Azure.




</Tab>
</Tabs>