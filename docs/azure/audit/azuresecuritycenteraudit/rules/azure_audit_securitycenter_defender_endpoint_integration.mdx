---
slug: azure_audit_securitycenter_defender_endpoint_integration
title: Ensure That Defender For Cloud Integration Is Enabled.
sidebar_label: Ensure That Defender For Cloud Integration Is Enabled.
---

### More Info:

Ensure that Defender for Endpoint â€“ Defender for Cloud integration is enabled.

### Risk Level

Medium

### Address

Operational Maturity

### Compliance Standards

CISAZURE, CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal by entering "https://portal.azure.com" in your web browser's address bar. Enter your Azure account credentials to log in.

2. Open Security Center: Once you're logged in, look for the "Security Center" option in the left-hand menu. If you can't find it, use the search bar at the top of the dashboard and type "Security Center", then select it from the dropdown list.

3. Check Defender for Cloud: In the Security Center dashboard, look for the "Pricing & settings" option in the left-hand menu. Click on it, then select the subscription you want to check. In the "Defender plans" tab, you can see if Defender for Cloud is enabled or not.

4. Verify the Integration: Check the "Integration" section in the "Defender plans" tab. If Defender for Cloud is enabled, you should see "Integrated" under the "Status" column. If it's not, the status will be "Not Integrated".

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: After installing Azure CLI, open your command prompt and type the following command to login to your Azure account:

   ```
   az login
   ```
   Follow the instructions on the screen to complete the login process.

3. Check the status of Azure Defender: To check the status of Azure Defender, you can use the following command:

   ```
   az security pricing list
   ```
   This command will list all the subscriptions and their associated Azure Defender plans. If the plan is enabled, it means that Azure Defender is enabled for that subscription.

4. Check the details of Azure Defender: If you want to check the details of Azure Defender for a specific subscription, you can use the following command:

   ```
   az security pricing show --name "default"
   ```
   Replace "default" with the name of your subscription. This command will show the details of Azure Defender for that subscription, including whether it is enabled or not.

#### Using Python

1. Install Azure SDK: To interact with Azure services, you need to install Azure SDK for Python. You can install it using pip:
   ```
   pip install azure-mgmt-security
   ```

2. Authenticate with Azure: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for this. Here is a sample code to authenticate:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter

   credential = DefaultAzureCredential()
   security_center = SecurityCenter(credential, "<subscription_id>")
   ```

3. Check Defender for Cloud Integration: Now, you can use the `security_center` object to check if Defender for Cloud Integration is enabled. Here is a sample code:
   ```python
   from azure.mgmt.security.models import SettingName

   setting = security_center.settings.get(SettingName.CONTACTS)
   if setting.is_defender_for_cloud_enabled:
       print("Defender for Cloud Integration is enabled.")
   else:
       print("Defender for Cloud Integration is not enabled.")
   ```

4. Handle Exceptions: It's a good practice to handle exceptions in your code. If there is any error while fetching the setting, an exception will be raised. You can catch it and print the error message:
   ```python
   try:
       setting = security_center.settings.get(SettingName.CONTACTS)
       if setting.is_defender_for_cloud_enabled:
           print("Defender for Cloud Integration is enabled.")
       else:
           print("Defender for Cloud Integration is not enabled.")
   except Exception as e:
       print(f"An error occurred: {e}")
   ```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Ensure That Defender For Cloud Integration Is Enabled" in Azure using the Azure console, follow the steps below:

1. Login to the Azure portal using your credentials.
2. Navigate to the Security Center dashboard.
3. Click on the "Security policy" option from the left-hand side menu.
4. Select the subscription for which you want to enable the Defender for Cloud integration.
5. Click on the "Edit" button to edit the security policy.
6. Scroll down to the "Data Collection" section and click on the "Edit" button.
7. In the "Data Collection" section, ensure that the "Defender for Cloud" option is enabled.
8. Click on the "Save" button to save the changes.

After following these steps, the Defender for Cloud integration will be enabled, and the misconfiguration "Ensure That Defender For Cloud Integration Is Enabled" will be remediated in Azure.

#### Using CLI

To remediate the misconfiguration "Ensure That Defender For Cloud Integration Is Enabled" for Azure using Azure CLI, follow the below steps:

1. Open the Azure CLI on your system.

2. Login to your Azure account using the below command:
   
   `az login`

3. Once you are logged in, set the default subscription using the below command:
   
   `az account set --subscription <subscription-id>`

   Replace `<subscription-id>` with the ID of the Azure subscription that you want to use.

4. Now, enable the Defender for Cloud integration using the below command:
   
   `az security auto-provisioning-setting update --name 'default' --auto-provision 'On'`

   This command will update the auto-provisioning setting to 'On' for the default policy.

5. Verify that the Defender for Cloud integration is enabled using the below command:
   
   `az security auto-provisioning-setting show --name 'default'`

   This command will show the details of the auto-provisioning setting for the default policy.

Once you have completed the above steps, the misconfiguration "Ensure That Defender For Cloud Integration Is Enabled" will be remediated for Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration "Ensure That Defender For Cloud Integration Is Enabled" for Azure using Python, you can use the Azure SDK for Python to enable the integration of Defender for Cloud. Here are the step-by-step instructions:

1. Install the Azure SDK for Python using the following command:

```
pip install azure-mgmt-security
```

2. Create an Azure Active Directory (AD) application and service principal. You can follow the instructions in this [Microsoft document](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal) to create the application and service principal.

3. Create an Azure credential object using the service principal credentials. Here's an example code snippet:

```python
from azure.common.credentials import ServicePrincipalCredentials

subscription_id = '<your-subscription-id>'
client_id = '<your-client-id>'
client_secret = '<your-client-secret>'
tenant_id = '<your-tenant-id>'

credentials = ServicePrincipalCredentials(
    client_id=client_id,
    secret=client_secret,
    tenant=tenant_id
)
```

4. Use the Azure SDK for Python to enable the Defender for Cloud integration. Here's an example code snippet:

```python
from azure.mgmt.security import SecurityCenter

security_center_client = SecurityCenter(credentials, subscription_id)

defender_for_cloud = security_center_client.settings.get('defenderForCloud')
defender_for_cloud.properties['status'] = 'On'
security_center_client.settings.create('defenderForCloud', defender_for_cloud)
```

This code snippet retrieves the current Defender for Cloud settings, sets the status to "On", and updates the settings.

5. Run the Python script to remediate the misconfiguration.

After running the script, the Defender for Cloud integration will be enabled for your Azure environment.




</Tab>
</Tabs>