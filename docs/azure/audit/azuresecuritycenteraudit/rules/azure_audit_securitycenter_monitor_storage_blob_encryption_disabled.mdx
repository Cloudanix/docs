---
slug: azure_audit_securitycenter_monitor_storage_blob_encryption_disabled
title: Monitor Storage Blob Encryption setting is not enabled
sidebar_label: Monitor Storage Blob Encryption setting is not enabled
---

### More Info:

Enable Storage Blob Encryption recommendations for virtual machines.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

ISO27001, HIPAA


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal by entering "https://portal.azure.com" in your web browser's address bar. Enter your Azure account credentials to log in.

2. Open Security Center: Once you're logged in, locate the "Security Center" option in the left-hand menu. Click on it to open the Security Center dashboard.

3. Navigate to the Recommendations tab: In the Security Center dashboard, find and click on the "Recommendations" tab. This will display a list of security recommendations for your Azure resources.

4. Check for Blob Storage Encryption recommendation: In the list of recommendations, look for one that says "Monitor Storage Blob Encryption". If this recommendation is present, it means that Blob Storage Encryption is not enabled in Security Center. If it's not present, then Blob Storage Encryption is enabled.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: After installing Azure CLI, open your command line interface and type the following command to login to your Azure account:

   ```
   az login
   ```
   Follow the prompts in your command line interface to complete the login process.

3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where you want to check the blob encryption setting. Use the following command to set the subscription:

   ```
   az account set --subscription "mySubscription"
   ```

4. Check Blob Encryption Setting: Now, you can check the blob encryption setting using the following command:

   ```
   az security blob-storage show --name "myBlobStorage" --resource-group "myResourceGroup"
   ```
   Replace "myBlobStorage" with the name of your blob storage and "myResourceGroup" with the name of your resource group. This command will return the blob encryption setting. If the setting is not enabled, it means that the blob encryption is not enabled in the Security Center.

#### Using Python

To check if the Monitor Storage Blob Encryption setting is not enabled in Azure Security Center using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to manage and utilize Azure services. You can install it using pip:
   ```
   pip install azure-mgmt-security
   ```
2. **Authenticate to Azure**: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for this. Here is a sample code snippet:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter

   credential = DefaultAzureCredential()
   security_center = SecurityCenter(credential, "<subscription_id>")
   ```
   Replace `<subscription_id>` with your Azure subscription ID.

3. **Fetch Security Center Settings**: You can fetch the settings of Azure Security Center using the `security_center.settings.list()` method. This will return a list of all settings. You can then iterate over this list and check if the `Monitor Storage Blob Encryption` setting is enabled or not. Here is a sample code snippet:
   ```python
   settings = security_center.settings.list()

   for setting in settings:
       if setting.name == "MonitorStorageBlobEncryption":
           print(f"Monitor Storage Blob Encryption is {'enabled' if setting.enabled else 'not enabled'}")
   ```
4. **Check the Setting**: If the `Monitor Storage Blob Encryption` setting is not enabled, the script will print "Monitor Storage Blob Encryption is not enabled". If it is enabled, it will print "Monitor Storage Blob Encryption is enabled".

Please note that you need to have the necessary permissions to read the settings of Azure Security Center. If you don't have the necessary permissions, you will get an error when you try to fetch the settings.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Monitor Storage Blob Encryption setting is not enabled" misconfiguration in Azure using the Azure console, follow the below steps:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Navigate to the "Storage accounts" service.
3. Select the storage account that you want to remediate.
4. In the left-hand menu, click on "Encryption" under the "Security + networking" section.
5. In the "Encryption" blade, ensure that the "Storage Service Encryption" toggle is set to "On".
6. Scroll down to the "Advanced" section and ensure that the "Monitor Storage Blob Encryption setting" toggle is also set to "On".
7. Click "Save" to apply the changes.

By following the above steps, you have successfully remediated the "Monitor Storage Blob Encryption setting is not enabled" misconfiguration in Azure using the Azure console.

#### Using CLI

To remediate the "Monitor Storage Blob Encryption setting is not enabled" misconfiguration in AZURE using AZURE CLI, follow these steps:

1. Open the AZURE CLI on your local machine or in the AZURE portal.

2. Log in to AZURE using the command "az login".

3. Check if you have the necessary permissions to remediate this misconfiguration by running the command "az role assignment list --assignee `<your email address or object ID>`". If you don't have the necessary permissions, contact your administrator.

4. Enable the "Monitor Storage Blob Encryption" setting using the command "az monitor diagnostic-settings create". Here is an example command:

```
az monitor diagnostic-settings create --resource /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName} --name BlobEncryptionDiagnosticSetting --logs '[{"category": "StorageRead"}]' --metrics '[{"category": "Capacity"}]' --workspace /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName} --storage-account {storageAccountName} --encryption-scope {encryptionScopeName} --enabled true
```

Note: Replace the placeholders `<subscriptionId>`, `<resourceGroupName>`, `<storageAccountName>`, `<workspaceName>`, and `<encryptionScopeName>` with the correct values for your environment.

5. Verify that the "Monitor Storage Blob Encryption" setting is enabled by running the command "az monitor diagnostic-settings show". Here is an example command:

```
az monitor diagnostic-settings show --resource /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName} --name BlobEncryptionDiagnosticSetting
```

If the output shows that the setting is enabled, then the misconfiguration has been remediated successfully.

#### Using Python

To remediate the "Monitor Storage Blob Encryption setting is not enabled" misconfiguration in Azure using Python, you can follow the below steps:

1. Import the required libraries:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.monitor import MonitorManagementClient
from azure.mgmt.storage import StorageManagementClient
from azure.mgmt.storage.models import StorageAccountUpdateParameters
```

2. Authenticate and create the clients:

```python
credential = DefaultAzureCredential()
monitor_client = MonitorManagementClient(credential, subscription_id)
storage_client = StorageManagementClient(credential, subscription_id)
```

3. Get the list of storage accounts:

```python
storage_accounts = storage_client.storage_accounts.list()
```

4. Loop through the storage accounts and check if the "Monitor Storage Blob Encryption" setting is enabled:

```python
for account in storage_accounts:
    account_name = account.name
    resource_group_name = account.id.split('/')[4]
    account_properties = storage_client.storage_accounts.get_properties(resource_group_name, account_name)
    encryption_enabled = account_properties.encryption.services.blob.enabled
    if not encryption_enabled:
        # enable the encryption
```

5. If the "Monitor Storage Blob Encryption" setting is not enabled, update the storage account to enable it:

```python
        account_properties.encryption.services.blob.enabled = True
        update_parameters = StorageAccountUpdateParameters(encryption=account_properties.encryption)
        storage_client.storage_accounts.update(resource_group_name, account_name, update_parameters)
```

6. Once the setting is enabled, you can also create an alert to monitor it:

```python
        monitor_client.alert_rules.create_or_update(
            resource_group_name,
            f"{account_name}-blob-encryption-alert",
            {
                "location": account.location,
                "enabled": True,
                "condition": {
                    "allOf": [
                        {
                            "field": "type",
                            "equals": "Microsoft.Storage/storageAccounts/blobServices"
                        },
                        {
                            "field": "Microsoft.Storage/storageAccounts/blobServices/encryption.services.blob.enabled",
                            "equals": False
                        }
                    ]
                },
                "actions": {
                    "severity": "2",
                    "sendToServiceOwners": True
                }
            }
        )
```

By following these steps, you can remediate the "Monitor Storage Blob Encryption setting is not enabled" misconfiguration in Azure using Python.


</Tab>
</Tabs>