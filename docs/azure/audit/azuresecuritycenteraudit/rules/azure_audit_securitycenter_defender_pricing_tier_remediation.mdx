

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to portal.azure.com and sign in with your Azure account credentials.

2. Open Security Center: On the left-hand side menu, click on "Security Center". This will open the Azure Security Center dashboard.

3. Check Pricing Tier: In the Security Center, click on the "Pricing & settings" option on the left-hand side menu. This will open a new page where you can see the pricing tier for each of your subscriptions.

4. Verify Microsoft Defender Standard: In the "Pricing & settings" page, select the subscription you want to check. In the "Pricing tier" section, you should see the current pricing tier for that subscription. If it is set to "Microsoft Defender for Cloud Standard", then Microsoft Defender Standard Pricing Tier is enabled. If not, it means it's not enabled.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download and install it from the official Microsoft Azure website. 

2. Login to Azure: After installing Azure CLI, open your command line interface and login to your Azure account using the following command:
   ```
   az login
   ```
   Follow the instructions on the screen to complete the login process.

3. Select Subscription: If you have multiple subscriptions, you need to select the subscription where you want to check the Microsoft Defender Standard Pricing Tier. Use the following command to set the subscription:
   ```
   az account set --subscription "your-subscription-id"
   ```
   Replace "your-subscription-id" with your actual subscription ID.

4. Check Microsoft Defender Standard Pricing Tier: Now, you can check the pricing tier of Microsoft Defender in Security Center using the following command:
   ```
   az security pricing list
   ```
   This command will list all the pricing tiers including Microsoft Defender. If Microsoft Defender is set to the Standard Pricing Tier, it will be listed in the output.

#### Using Python

1. Install Azure SDK: To interact with Azure services, you need to install Azure SDK for Python. You can install it using pip:
   ```
   pip install azure-mgmt-security
   ```
2. Import necessary modules: Import the necessary modules in your Python script.
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter
   ```
3. Authenticate and initialize: Authenticate to Azure using DefaultAzureCredential which provides a simplified authentication experience to quickly start developing applications. Then, initialize the SecurityCenter client.
   ```python
   credential = DefaultAzureCredential()
   security_center = SecurityCenter(credential, "<subscription_id>")
   ```
4. Check Pricing Tier: Now, you can use the `security_center.pricing.get()` method to get the pricing tier of Microsoft Defender. If the pricing tier is not 'Standard', it means Microsoft Defender Standard Pricing Tier is not enabled.
   ```python
   pricing = security_center.pricing.get("default", "default")
   if pricing.pricing_tier != 'Standard':
       print("Microsoft Defender Standard Pricing Tier is not enabled.")
   else:
       print("Microsoft Defender Standard Pricing Tier is enabled.")
   ```
Replace `<subscription_id>` with your Azure subscription ID. This script will print whether Microsoft Defender Standard Pricing Tier is enabled or not.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of enabling Microsoft Defender Standard Pricing Tier in AZURE, you can follow these step-by-step instructions:

1. Login to the AZURE portal using your credentials.
2. Navigate to the Security Center from the left-hand menu.
3. In the Security Center, click on the "Security Policy" option from the left-hand menu.
4. In the Security Policy page, scroll down to the "Pricing tier" section and click on the "Edit" button.
5. In the Pricing tier page, select the "Standard" option and click on the "Save" button.
6. After saving the changes, wait for a few minutes to allow the changes to take effect.
7. Verify that the Microsoft Defender Standard Pricing Tier is now enabled by checking the "Pricing tier" section in the Security Policy page.

By following these steps, you should be able to remediate the misconfiguration of enabling Microsoft Defender Standard Pricing Tier in AZURE.

#### Using CLI

To remediate the misconfiguration "Enable Microsoft Defender Standard Pricing Tier" in AZURE using AZURE CLI, follow these steps:

1. Open the AZURE CLI on your local machine or use the AZURE Cloud Shell.

2. Login to your AZURE account using the command:

```
az login
```

3. Once you are logged in, set the subscription that you want to work on using the command:

```
az account set --subscription <subscription_id>
```

4. Next, enable Microsoft Defender Standard Pricing Tier using the command:

```
az security pricing create --name 'Default' --tier 'Standard'
```

5. Verify that the pricing tier has been set to Standard using the command:

```
az security pricing show --name 'Default'
```

This will show you the details of the pricing tier that you have set.

By following the above steps, you can remediate the misconfiguration "Enable Microsoft Defender Standard Pricing Tier" in AZURE using AZURE CLI.

#### Using Python

To enable Microsoft Defender Standard Pricing Tier in Azure using Python, you can follow these steps:

1. Install the Azure SDK for Python using the following command:

   ```
   pip install azure-mgmt-resource
   ```

2. Authenticate using the Azure CLI or a service principal. You can use the following code to authenticate using a service principal:

   ```
   from azure.common.credentials import ServicePrincipalCredentials

   # Replace the values with your own
   subscription_id = 'your-subscription-id'
   client_id = 'your-client-id'
   secret = 'your-client-secret'
   tenant = 'your-tenant-id'

   credentials = ServicePrincipalCredentials(
       client_id=client_id,
       secret=secret,
       tenant=tenant
   )
   ```

3. Create a `ResourceManagementClient` object using the authenticated credentials and the subscription ID:

   ```
   from azure.mgmt.resource import ResourceManagementClient
   from azure.mgmt.resource.resources.models import GenericResource

   resource_client = ResourceManagementClient(credentials, subscription_id)
   ```

4. Get the resource group and the Microsoft Defender Security Center workspace. You can use the following code to get the resource group and workspace:

   ```
   resource_group_name = 'your-resource-group-name'
   workspace_name = 'your-workspace-name'

   workspace_resource = resource_client.resources.get(
       resource_group_name,
       'Microsoft.OperationalInsights/workspaces',
       workspace_name
   )
   ```

5. Update the pricing tier for the workspace to `PerNode`. You can use the following code to update the pricing tier:

   ```
   workspace_resource.properties['sku'] = {
       'name': 'PerNode',
       'tier': 'Standard'
   }

   resource_client.resources.create_or_update(
       resource_group_name,
       'Microsoft.OperationalInsights/workspaces',
       workspace_name,
       GenericResource(location=workspace_resource.location, properties=workspace_resource.properties)
   )
   ```

6. Verify that the pricing tier has been updated by checking the workspace properties:

   ```
   workspace = resource_client.resources.get(
       resource_group_name,
       'Microsoft.OperationalInsights/workspaces',
       workspace_name
   )

   print(workspace.properties['sku'])
   ```

This should enable Microsoft Defender Standard Pricing Tier in Azure for the specified workspace.


</Tab>
</Tabs>