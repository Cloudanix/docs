---
slug: azure_audit_securitycenter_monitor_web_application_firewall_disabled
title: Monitor Web Application Firewall setting is not enabled
sidebar_label: Monitor Web Application Firewall setting is not enabled
---

### More Info:

Enable Web Application Firewall recommendations for virtual machines.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

SOC2, ISO27001, HIPAA, HITRUST


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to portal.azure.com and sign in with your Azure account credentials.

2. Open Security Center: On the left-hand side menu, click on "Security Center". This will open the Azure Security Center dashboard.

3. Check Security Policy: In the Security Center, click on "Security policy" on the left-hand side menu. This will open a list of your subscriptions. Click on the subscription you want to check.

4. Check Web Application Firewall: In the security policy settings, scroll down to the "Data" section. Here, you should see a setting for "Monitor Web Application Firewall". If this setting is not enabled, it means that the Web Application Firewall is not being monitored.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft Azure website. After installation, open your command prompt or terminal.

2. Login to Azure: Use the following command to login to your Azure account. You will be redirected to the browser for login. Enter your credentials and login.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, select the one you want to check. Use the following command to list all the subscriptions and then set the one you want.
   ```
   az account list --output table
   az account set --subscription "My Demos"
   ```
4. Check the Web Application Firewall setting: Use the following command to check the Web Application Firewall setting in the Security Center.
   ```
   az security waf-policy show --name "Your_WAF_Policy_Name" --resource-group "Your_Resource_Group_Name"
   ```
   If the Web Application Firewall setting is not enabled, the output will not show any details about the WAF policy.

#### Using Python

To check if the Monitor Web Application Firewall setting is not enabled in Azure Security Center using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to manage your Azure resources. To install it, you can use pip:
   ```
   pip install azure-mgmt-security
   ```
2. **Authenticate to Azure**: Before you can interact with Azure resources, you need to authenticate using a Service Principal. You can create a Service Principal and get the necessary credentials (client id, client secret, tenant id) from the Azure portal. Then, you can authenticate like this:
   ```python
   from azure.common.credentials import ServicePrincipalCredentials

   credentials = ServicePrincipalCredentials(
       client_id = 'your-client-id',
       secret = 'your-client-secret',
       tenant = 'your-tenant-id'
   )
   ```
3. **Initialize Security Center client**: Once you have the credentials, you can initialize the Security Center client:
   ```python
   from azure.mgmt.security import SecurityCenter

   sc = SecurityCenter(credentials, 'your-subscription-id')
   ```
4. **Check Web Application Firewall setting**: Now you can check the status of the Web Application Firewall setting:
   ```python
   setting = sc.settings.get('MCAS')
   if setting.value == 'Disabled':
       print('Monitor Web Application Firewall setting is not enabled')
   else:
       print('Monitor Web Application Firewall setting is enabled')
   ```
This script will print whether the Monitor Web Application Firewall setting is enabled or not. If it's not enabled, you might want to enable it to improve the security of your Azure resources.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Monitor Web Application Firewall setting is not enabled" misconfiguration in Azure using the Azure console, you can follow the below steps:

1. Open the Azure portal and navigate to the Azure Application Gateway resource that you want to configure.
2. Click on the "Firewall" option under the "Security" section in the left-hand menu.
3. Under the "Web application firewall" section, click on the "Edit" button.
4. In the "Web application firewall settings" page, scroll down to the "Diagnostic logs" section.
5. Click on the "Enable" button next to "Send logs to Log Analytics workspace".
6. Select the Log Analytics workspace that you want to use for storing the diagnostic logs.
7. Click on the "Save" button to save the changes.

Once you have completed these steps, the "Monitor Web Application Firewall setting is not enabled" misconfiguration will be remediated and the diagnostic logs for the web application firewall will be sent to the specified Log Analytics workspace for monitoring and analysis.

#### Using CLI

To remediate the "Monitor Web Application Firewall setting is not enabled" misconfiguration in Azure using Azure CLI, please follow the below steps:

1. Open the Azure CLI command prompt and log in to your Azure account using the command: 
   `az login`

2. Once you are logged in, set your subscription using the command: 
   `az account set --subscription <subscription_id>`

3. Enable the Web Application Firewall (WAF) monitoring by running the following command:
   `az network application-gateway waf-policy set --name <waf_policy_name> --resource-group <resource_group_name> --firewall-mode Detection`

   Note: Replace `<waf_policy_name>` and `<resource_group_name>` with the actual names of your WAF policy and resource group.

4. Verify that the WAF monitoring is enabled by running the following command:
   `az network application-gateway waf-policy show --name <waf_policy_name> --resource-group <resource_group_name>`

   This command will display the details of your WAF policy, including the firewall mode which should now be set to "Detection".

5. Finally, you can also verify the WAF monitoring status by checking the Azure Security Center dashboard.

By following these steps, you should be able to remediate the "Monitor Web Application Firewall setting is not enabled" misconfiguration in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration "Monitor Web Application Firewall setting is not enabled" for Azure using Python, follow the below steps:

Step 1: Import the required libraries
```
from azure.common.credentials import ServicePrincipalCredentials
from azure.mgmt.monitor import MonitorManagementClient
```

Step 2: Authenticate and create the MonitorManagementClient object
```
TENANT_ID = '<your tenant id>'
CLIENT = '<your client id>'
KEY = '<your client secret>'
SUBSCRIPTION_ID = '<your subscription id>'

credentials = ServicePrincipalCredentials(
    client_id=CLIENT,
    secret=KEY,
    tenant=TENANT_ID
)

monitor_client = MonitorManagementClient(
    credentials,
    SUBSCRIPTION_ID
)
```

Step 3: Retrieve the existing web application firewall settings
```
resource_id = '/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Network/frontDoors/{2}/webApplicationFirewallConfiguration'.format(
    SUBSCRIPTION_ID,
    '<your resource group name>',
    '<your front door name>'
)

waf_settings = monitor_client.metric_definitions.list(resource_id)
```

Step 4: Check if the "Monitor Web Application Firewall setting" metric is enabled
```
waf_metric_name = 'Monitor Web Application Firewall setting'
is_enabled = False

for metric in waf_settings:
    if metric.name.localized_value == waf_metric_name:
        is_enabled = True
        break
```

Step 5: If the metric is not enabled, enable it
```
if not is_enabled:
    monitor_client.metric_baseline.create(
        resource_id,
        waf_metric_name,
        {
            'enabled': True
        }
    )
```

The above steps will enable the "Monitor Web Application Firewall setting" metric for your Azure front door using Python.




</Tab>
</Tabs>