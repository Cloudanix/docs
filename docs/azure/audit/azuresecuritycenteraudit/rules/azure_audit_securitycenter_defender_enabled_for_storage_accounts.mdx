---
slug: azure_audit_securitycenter_defender_enabled_for_storage_accounts
title: Enable Microsoft Defender for Cloud for Storage Accounts
sidebar_label: Enable Microsoft Defender for Cloud for Storage Accounts
---

### More Info:

Enable Microsoft Defender for Cloud for Storage Accounts

### Risk Level

High

### Address

Security, Operational Maturity

### Compliance Standards

CISAZURE, CBP, HITRUST, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal using your credentials.
2. Navigate to the Security Center from the left-hand side menu. 
3. In the Security Center, go to the "Recommendations" section. Here, you will find a list of all the security recommendations for your resources.
4. Look for the recommendation named "Enable Microsoft Defender for Cloud for Storage Accounts". If this recommendation is present, it means that Microsoft Defender for Cloud is not enabled for some or all of your storage accounts, indicating a misconfiguration.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: After installing Azure CLI, you need to login to your Azure account. Open your terminal or command prompt and type the following command:
   ```
   az login
   ```
   Follow the instructions on the screen to login to your Azure account.

3. Check Security Center Policy: To check if Microsoft Defender for Cloud is enabled for Storage Accounts, you need to check the Security Center policy. Use the following command to list all the policies:
   ```
   az policy assignment list
   ```
   Look for the policy named "ASC Default (subscription: <your_subscription_id>)". This is the default Security Center policy.

4. Check Policy Details: To check the details of the policy, use the following command:
   ```
   az policy assignment show --name "ASC Default (subscription: <your_subscription_id>)"
   ```
   In the output, look for the parameter "storageAccounts". If its value is "On", then Microsoft Defender for Cloud is enabled for Storage Accounts. If its value is "Off", then it is not enabled.

#### Using Python

1. Install Azure SDK: To interact with Azure services, you need to install Azure SDK for Python. You can install it using pip:
   ```
   pip install azure-mgmt-security
   ```
2. Authenticate with Azure: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for this. Here is a sample code to authenticate:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.security import SecurityCenter

   credential = DefaultAzureCredential()
   client = SecurityCenter(credential, "<subscription_id>")
   ```
3. Get the security settings: Now, you can use the client to get the security settings of the storage account. Here is a sample code to get the settings:
   ```python
   settings = client.settings.get()
   print(settings)
   ```
4. Check the status of Microsoft Defender for Cloud: Now, you can check the status of Microsoft Defender for Cloud for storage accounts. If the status is not enabled, then it is a misconfiguration. Here is a sample code to check the status:
   ```python
   if settings.data_sources.microsoft_defender_for_cloud_storage_accounts.status != "Enabled":
       print("Microsoft Defender for Cloud for Storage Accounts is not enabled.")
   else:
       print("Microsoft Defender for Cloud for Storage Accounts is enabled.")
   ```
Please replace "<subscription_id>" with your actual Azure subscription ID.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To enable Microsoft Defender for Cloud for Storage Accounts in AZURE, follow these steps:

1. Log in to the AZURE portal (https://portal.azure.com/).

2. In the left-hand menu, select "Security Center".

3. In the Security Center blade, select "Recommendations".

4. In the Recommendations blade, locate the recommendation for "Enable Microsoft Defender for Storage Accounts".

5. Click on the recommendation to open the details page.

6. In the details page, click on the "Remediate" button.

7. In the Remediate blade, review the recommended remediation steps.

8. Click on the "Remediate" button to apply the recommended remediation steps.

9. Wait for the remediation process to complete.

10. Verify that the recommendation status has changed to "Compliant".

Note: Enabling Microsoft Defender for Cloud for Storage Accounts may incur additional costs. Please review the pricing details before enabling this feature.

#### Using CLI

To remediate the misconfiguration "Enable Microsoft Defender for Cloud for Storage Accounts" for AZURE using AZURE CLI, please follow the below steps:

Step 1: Open the Azure CLI command prompt or terminal.

Step 2: Login to your Azure account using the below command:
```
az login
```

Step 3: After login, set the subscription where the storage account is located using the below command:
```
az account set --subscription <subscription_id>
```

Step 4: To enable Microsoft Defender for Cloud for Storage Accounts, use the below command:
```
az security atp storage enable --storage-account <storage_account_name> --resource-group <resource_group_name>
```
Note: Replace `<storage_account_name>` and `<resource_group_name>` with the actual names of your storage account and resource group respectively.

Step 5: Verify the configuration by using the below command:
```
az security atp storage show --storage-account <storage_account_name> --resource-group <resource_group_name>
```
Note: Replace `<storage_account_name>` and `<resource_group_name>` with the actual names of your storage account and resource group respectively.

Step 6: Once the configuration is verified, you have successfully remediated the misconfiguration "Enable Microsoft Defender for Cloud for Storage Accounts" for AZURE using AZURE CLI.

I hope this helps!

#### Using Python

To enable Microsoft Defender for Cloud for Storage Accounts in Azure using Python, you can follow these steps:

1. Install the Azure SDK for Python using the following command:
```
pip install azure-mgmt-storage
```

2. Import the necessary modules:
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.storage import StorageManagementClient
```

3. Set up the credentials for authentication:
```python
credential = DefaultAzureCredential()
subscription_id = '<your-subscription-id>'
```

4. Create a StorageManagementClient object:
```python
storage_client = StorageManagementClient(credential, subscription_id)
```

5. Get the resource group and storage account names:
```python
resource_group_name = '<your-resource-group-name>'
storage_account_name = '<your-storage-account-name>'
```

6. Enable Microsoft Defender for Cloud for the storage account:
```python
storage_client.operations.enable_microsoft_defender_for_storage_accounts(resource_group_name, storage_account_name)
```

7. Verify that Microsoft Defender for Cloud has been enabled by checking the storage account properties:
```python
storage_account = storage_client.storage_accounts.get_properties(resource_group_name, storage_account_name)
print(storage_account.identity.type)
```

Note: This code assumes that you have already set up the necessary Azure credentials and have the required permissions to enable Microsoft Defender for Cloud for the storage account.


</Tab>
</Tabs>