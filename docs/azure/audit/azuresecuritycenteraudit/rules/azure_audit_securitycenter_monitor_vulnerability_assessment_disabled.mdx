---
slug: azure_audit_securitycenter_monitor_vulnerability_assessment_disabled
title: Monitor Vulnerability Assessment setting is not enabled
sidebar_label: Monitor Vulnerability Assessment setting is not enabled
---

### More Info:

Enable Vulnerability Assessment recommendations for virtual machines.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

CISAZURE, CBP, SOC2, ISO27001, HIPAA


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Azure portal: Open your web browser and navigate to the Azure portal. Sign in using your Azure account credentials.

2. Navigate to Security Center: Once you are logged in, look for the "Security Center" option in the left-hand menu. Click on it to open the Security Center dashboard.

3. Check Security Policy: In the Security Center dashboard, look for the "Security policy" option in the left-hand menu. Click on it to open the Security Policy page.

4. Check Vulnerability Assessment settings: In the Security Policy page, scroll down to the "DATA & STORAGE" section. Here, look for the "Vulnerability assessment" option. If it is not enabled, it means the Monitor Vulnerability Assessment setting is not enabled in Security Center.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI, you need to install it on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: Open your command line interface and type the following command to login to your Azure account:

   ```
   az login
   ```
   Follow the prompts in your browser to complete the authentication process.

3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where you want to check the Monitor Vulnerability Assessment setting. Use the following command to list all your subscriptions:

   ```
   az account list --output table
   ```
   Then, use the following command to set your desired subscription:

   ```
   az account set --subscription "My Subscription"
   ```

4. Check Monitor Vulnerability Assessment Setting: Now, you can check the Monitor Vulnerability Assessment setting in Security Center. Use the following command:

   ```
   az security va settings show --name default
   ```
   If the Monitor Vulnerability Assessment setting is not enabled, the command will return "false" in the "isEnabled" field.

#### Using Python

To check if the Monitor Vulnerability Assessment setting is not enabled in Security Center using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to work with Azure services like Security Center. You can install it using pip:

```python
pip install azure-mgmt-security
```

2. **Authenticate to Azure**: Before you can interact with Azure services, you need to authenticate. You can use Azure Identity library for this. Here is an example of how to authenticate using a service principal:

```python
from azure.identity import ClientSecretCredential
from azure.mgmt.security import SecurityCenter

credential = ClientSecretCredential(
    tenant_id="<azure-tenant-id>",
    client_id="<azure-client-id>",
    client_secret="<azure-client-secret>"
)

client = SecurityCenter(credential, "<azure-subscription-id>")
```

3. **Get Security Center Settings**: Now that you are authenticated, you can get the settings of Security Center. You can do this using the `settings` property of the `SecurityCenter` client:

```python
settings = client.settings.get()
```

4. **Check Monitor Vulnerability Assessment Setting**: Finally, you can check if the Monitor Vulnerability Assessment setting is enabled or not:

```python
if settings.data["monitorVulnerabilityAssessment"] == "Disabled":
    print("Monitor Vulnerability Assessment setting is not enabled.")
else:
    print("Monitor Vulnerability Assessment setting is enabled.")
```

This script will print a message indicating whether the Monitor Vulnerability Assessment setting is enabled or not.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Monitor Vulnerability Assessment setting not enabled in Azure, please follow the below steps:

1. Open the Azure portal and sign in with your credentials.
2. From the Azure dashboard, click on the "Security Center" icon.
3. In the Security Center, navigate to the "Security policy" tab.
4. Under the "Security policy" tab, click on the "Edit" button to modify the policy.
5. Scroll down to the "Vulnerability assessment" section and click on the "On" button to enable the "Monitor Vulnerability Assessment" setting.
6. After enabling the setting, click on the "Save" button to save the changes.

Once the above steps are completed, the "Monitor Vulnerability Assessment" setting will be enabled in Azure, and the system will start monitoring for vulnerabilities. It is recommended to periodically review the security policies to ensure that they are up to date and provide adequate protection against potential threats.

#### Using CLI

To remediate the "Monitor Vulnerability Assessment setting is not enabled" misconfiguration for Azure using Azure CLI, follow these steps:

1. Open the Azure CLI and login to your Azure account using the command `az login`.

2. Once you are logged in, run the command `az account list` to list all the subscriptions associated with your account.

3. Identify the subscription for which you want to enable the Monitor Vulnerability Assessment setting and set it as the default subscription using the command `az account set --subscription <subscription-id>`.

4. Run the command `az policy definition list` to list all the policy definitions available in your subscription.

5. Identify the policy definition for the Monitor Vulnerability Assessment setting. You can use the command `az policy definition show --name <policy-name>` to view the details of a specific policy definition.

6. Once you have identified the policy definition, assign it to the appropriate scope. For example, to assign the policy definition to a resource group, use the command `az policy assignment create --name <assignment-name> --scope <resource-group-id> --policy <policy-name>`.

7. Verify that the policy assignment has been created successfully using the command `az policy assignment show --name <assignment-name> --scope <resource-group-id>`.

8. Finally, wait for the policy to be enforced. The time it takes for the policy to be enforced depends on the scope of the policy assignment.

By following these steps, you should be able to remediate the "Monitor Vulnerability Assessment setting is not enabled" misconfiguration for Azure using Azure CLI.

#### Using Python

To remediate the "Monitor Vulnerability Assessment setting is not enabled" misconfiguration in Azure using Python, you can use the Azure SDK for Python to enable the vulnerability assessment setting for the specified Azure SQL Database. Here are the step-by-step instructions:

1. Install the Azure SDK for Python using pip:

```
pip install azure-mgmt-sql
```

2. Import the necessary modules:

```python
from azure.common.credentials import ServicePrincipalCredentials
from azure.mgmt.sql import SqlManagementClient
from azure.mgmt.sql.models import VulnerabilityAssessmentPolicy, ServerSecurityAlertPolicy, \
    ServerVulnerabilityAssessmentSettings
```

3. Set up the Azure credentials:

```python
credentials = ServicePrincipalCredentials(
    client_id='<YOUR_CLIENT_ID>',
    secret='<YOUR_SECRET>',
    tenant='<YOUR_TENANT_ID>'
)
```

4. Create a SqlManagementClient object:

```python
sql_client = SqlManagementClient(credentials, '<YOUR_SUBSCRIPTION_ID>')
```

5. Get the current vulnerability assessment settings for the specified Azure SQL Database:

```python
resource_group_name = '<YOUR_RESOURCE_GROUP_NAME>'
server_name = '<YOUR_SERVER_NAME>'
database_name = '<YOUR_DATABASE_NAME>'

vulnerability_assessment_settings = sql_client.vulnerability_assessments.get(
    resource_group_name=resource_group_name,
    server_name=server_name,
    database_name=database_name
).as_dict()
```

6. Check if the vulnerability assessment setting is already enabled:

```python
if vulnerability_assessment_settings['properties']['state'] == 'Enabled':
    print('Vulnerability assessment setting is already enabled.')
    exit()
```

7. If the vulnerability assessment setting is not enabled, create a new vulnerability assessment policy object:

```python
vulnerability_assessment_policy = VulnerabilityAssessmentPolicy(
    storage_account_access_key='<YOUR_STORAGE_ACCOUNT_ACCESS_KEY>',
    storage_container_path='<YOUR_STORAGE_CONTAINER_PATH>',
    recurring_scans={
        'isEnabled': True,
        'emailSubscriptionAdmins': False,
        'emailSubscriptionOwners': False,
        'emailAddresses': []
    },
    notifications={
        'emailAdmins': False,
        'emailOwners': False,
        'includeFailures': False,
        'customEmailAddresses': []
    }
)
```

8. Create a new server security alert policy object:

```python
server_security_alert_policy = ServerSecurityAlertPolicy(
    state='Enabled',
    disabled_alerts=[],
    email_account_admins=False,
    retention_days=90
)
```

9. Create a new server vulnerability assessment settings object with the new policy objects:

```python
server_vulnerability_assessment_settings = ServerVulnerabilityAssessmentSettings(
    name='default',
    storage_account_access_key='<YOUR_STORAGE_ACCOUNT_ACCESS_KEY>',
    storage_container_path='<YOUR_STORAGE_CONTAINER_PATH>',
    vulnerability_assessment_policy=vulnerability_assessment_policy,
    security_alert_policy=server_security_alert_policy
)
```

10. Update the vulnerability assessment settings for the specified Azure SQL Database:

```python
sql_client.vulnerability_assessments.create_or_update(
    resource_group_name=resource_group_name,
    server_name=server_name,
    database_name=database_name,
    parameters=server_vulnerability_assessment_settings
)
```

This will enable the vulnerability assessment setting for the specified Azure SQL Database.




</Tab>
</Tabs>