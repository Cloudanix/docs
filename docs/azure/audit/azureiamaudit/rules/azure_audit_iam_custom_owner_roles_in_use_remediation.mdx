

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Open your web browser, navigate to the Azure portal and sign in with your Azure account credentials.

2. Navigate to Azure Active Directory: From the left-hand menu, click on "Azure Active Directory". This will take you to the Azure Active Directory overview page.

3. Access Roles and Administrators: From the Azure Active Directory page, click on "Roles and administrators" under the "Manage" section. This will display a list of all the predefined roles and any custom roles that have been created.

4. Check for Custom Owner Roles: In the "Roles and administrators" page, you can check for any custom owner roles. These roles will not match the predefined roles provided by Azure. If any custom owner roles are in use, they will be listed here.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft Azure website.

2. Login to Azure: Use the following command to login to your Azure account. You will be redirected to the browser for login. Enter your credentials to login.
   ```
   az login
   ```
3. List all roles: Use the following command to list all the custom roles in your Azure account. This command will return a JSON object with all the custom roles.
   ```
   az role definition list --custom-role-only true
   ```
4. Analyze the output: The output will contain a list of all the custom roles in your Azure account. Each role will have a 'roleName' and 'description'. If there are any custom owner roles, they will be listed here. You can use the 'roleName' and 'description' to identify the custom owner roles.

#### Using Python

To check for custom owner roles in use in IAM using Python scripts, you can use the Google Cloud SDK (gcloud) or the Google Cloud Client Libraries. Here are the steps:

1. **Install Google Cloud SDK and Python Client Libraries**: Before you start, make sure you have installed the Google Cloud SDK and the Python client libraries. You can install the SDK by following the instructions here: https://cloud.google.com/sdk/docs/install. For the Python client libraries, you can install them using pip: `pip install --upgrade google-cloud-iam`.

2. **Authenticate your SDK**: Use the `gcloud auth application-default login` command to authenticate your SDK. This will open a new browser window where you can log in with your Google account.

3. **List all IAM roles**: Use the `gcloud iam roles list` command to list all IAM roles. This will return a list of all roles, including custom roles.

4. **Check for custom owner roles**: You can use a Python script to check for custom owner roles. Here is a simple script that checks for custom owner roles:

```python
from google.cloud import iam

client = iam.IAMClient()

# List all roles
roles = client.list_roles()

# Check for custom owner roles
for role in roles:
    if 'custom' in role.name and 'owner' in role.title.lower():
        print(f"Custom owner role found: {role.name}")
```

This script uses the Google Cloud IAM client to list all roles, then checks each role to see if it is a custom role and if the title includes 'owner'. If it finds a custom owner role, it prints the name of the role.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Custom Owner Roles In Use" misconfiguration in Azure using the Azure console, follow these steps:

1. Log in to the Azure portal at https://portal.azure.com/.
2. In the left-hand menu, click on "Azure Active Directory".
3. Click on "Roles and administrators".
4. In the "Roles and administrators" page, click on "Custom roles".
5. Review the custom roles that are currently in use.
6. Identify any custom roles that are assigned to users or groups that have owner-level permissions.
7. Determine if the custom role is necessary for the user or group to perform their job duties.
8. If the custom role is not necessary, remove the role assignment.
9. If the custom role is necessary, modify the permissions of the role to reduce the level of access granted.
10. Repeat steps 6-9 for each custom role that is assigned to users or groups with owner-level permissions.

By following these steps, you can remediate the "Custom Owner Roles In Use" misconfiguration in Azure using the Azure console.

#### Using CLI

To remediate the "Custom Owner Roles In Use" misconfiguration in Azure using Azure CLI, follow the steps below:

1. Open the Azure CLI command prompt or terminal.
2. Run the following command to list all the custom owner roles in use:

   ```
   az role assignment list --all --include-classic-administrators --query "[?roleDefinitionName=='Owner']"
   ```

   This command lists all the custom owner roles in use in your Azure subscription.

3. Review the output of the above command and identify the custom owner roles that are not required or are no longer in use.

4. Run the following command to delete the custom owner role:

   ```
   az role assignment delete --assignee <object-id> --role <role-name>
   ```

   Replace `<object-id>` with the object ID of the user or group to whom the custom owner role is assigned, and `<role-name>` with the name of the custom owner role.

5. Repeat step 4 for all the custom owner roles that are not required or are no longer in use.

6. Run the following command to verify that the custom owner roles have been deleted:

   ```
   az role assignment list --all --include-classic-administrators --query "[?roleDefinitionName=='Owner']"
   ```

   This command should not list any custom owner roles.

By following the above steps, you can remediate the "Custom Owner Roles In Use" misconfiguration in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration "Custom Owner Roles In Use" in Azure using Python, you can follow the below steps:

Step 1: Connect to Azure using Python SDK
```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.resource import ResourceManagementClient

credential = DefaultAzureCredential()
subscription_id = 'your_subscription_id'
client = ResourceManagementClient(credential, subscription_id)
```

Step 2: Get the list of resource groups
```python
resource_groups = client.resource_groups.list()
```

Step 3: For each resource group, check if custom owner roles are assigned
```python
for rg in resource_groups:
    roles = client.role_assignments.list_for_resource_group(rg.name)
    for role in roles:
        if role.role_definition_name == 'Owner' and role.scope == rg.id:
            print(f"Custom Owner role assigned in Resource Group {rg.name}")
```

Step 4: Remove the custom owner role assignments
```python
for rg in resource_groups:
    roles = client.role_assignments.list_for_resource_group(rg.name)
    for role in roles:
        if role.role_definition_name == 'Owner' and role.scope == rg.id:
            client.role_assignments.delete(role.scope, role.name)
            print(f"Custom Owner role removed from Resource Group {rg.name}")
```

Note: Before running the script, make sure to authenticate with Azure using the appropriate credentials and provide the necessary permissions to the service principal or user account. Also, test the script in a non-production environment before running it in a production environment.


</Tab>
</Tabs>