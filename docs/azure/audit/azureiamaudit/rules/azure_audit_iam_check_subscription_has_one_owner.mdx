---
slug: azure_audit_iam_check_subscription_has_one_owner
title: Atleast Two Subscription Owners Should Exist
sidebar_label: Atleast Two Subscription Owners Should Exist
---

### More Info:

Ensure there are at least two subscription owners designated for your Microsoft Azure account subscription in order to provide administrator access redundancy.

### Risk Level

Medium

### Address

Security

### Compliance Standards

NISTCSF


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Azure portal: Navigate to the Azure portal by entering 'https://portal.azure.com' in your web browser. Enter your Azure account credentials to log in.

2. Access IAM: Once you are logged in, look for the 'Azure Active Directory' service in the left-hand side menu. Click on it to open. In the Azure Active Directory window, click on 'Identity and Access Management (IAM)'.

3. Check the roles: In the IAM section, click on 'Role assignments'. This will display a list of all the roles assigned to users, groups, and services in your Azure subscription. 

4. Verify the owners: In the 'Role assignments' list, look for the 'Owner' role. Check the number of users assigned to this role. If there are less than two users assigned to the 'Owner' role, it indicates a misconfiguration as per the best practices, at least two subscription owners should exist.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft Azure website. Once installed, open your command prompt or terminal and type `az login` to log in to your Azure account.

2. List all IAM roles: Use the following command to list all the IAM roles in your Azure subscription:

    ```
    az role assignment list --query "[?roleDefinitionName=='Owner']"
    ```

    This command will return a list of all IAM roles with the 'Owner' role definition. 

3. Count the number of Owners: You can use the following command to count the number of 'Owner' roles:

    ```
    az role assignment list --query "[?roleDefinitionName=='Owner']" | wc -l
    ```

    This command will return the number of lines in the output, which corresponds to the number of 'Owner' roles.

4. Check if there are at least two Owners: If the number returned by the previous command is less than 2, then there is a misconfiguration. This means that there are not at least two 'Owner' roles in your Azure subscription.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3). You will need to set up your AWS credentials and the AWS region to use. You can do this by using the AWS CLI and running `aws configure`.

2. Use the IAM client from Boto3 to get a list of all IAM users in your AWS account. Here is a sample script:

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# List users with the pagination interface
paginator = iam.get_paginator('list_users')
for response in paginator.paginate():
    print(response['Users'])
```

3. Once you have the list of all IAM users, you can then check their permissions. You can do this by calling the `list_attached_user_policies` method for each user. Here is a sample script:

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# List users with the pagination interface
paginator = iam.get_paginator('list_users')
for response in paginator.paginate():
    for user in response['Users']:
        # Get user's policies
        policies = iam.list_attached_user_policies(UserName=user['UserName'])
        for policy in policies['AttachedPolicies']:
            print(f"User: {user['UserName']}, Policy: {policy['PolicyName']}")
```

4. Finally, you can check if there are at least two users with the "Owner" policy. If there are less than two, then it's a misconfiguration. Here is a sample script:

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# Initialize owner counter
owner_counter = 0

# List users with the pagination interface
paginator = iam.get_paginator('list_users')
for response in paginator.paginate():
    for user in response['Users']:
        # Get user's policies
        policies = iam.list_attached_user_policies(UserName=user['UserName'])
        for policy in policies['AttachedPolicies']:
            # Check if user has owner policy
            if policy['PolicyName'] == 'Owner':
                owner_counter += 1

# Check if there are at least two owners
if owner_counter < 2:
    print("Misconfiguration: There are less than two owners.")
else:
    print("Configuration is correct.")
```

This script will print "Misconfiguration: There are less than two owners." if there are less than two users with the "Owner" policy, and "Configuration is correct." otherwise.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "At least two subscription owners should exist" in Azure, you can follow the below steps:

1. Log in to the Azure Portal using your credentials.
2. Go to the "Subscriptions" option in the left-hand menu.
3. Select the subscription that needs to be remediated.
4. Click on "Access control (IAM)" in the left-hand menu.
5. Click on "Add" and select "Add role assignment".
6. In the "Add role assignment" pane, select "Owner" as the role.
7. In the "Select" box, search for the user or group that needs to be added as an owner.
8. Click on "Save" to add the user or group as an owner.

Repeat steps 5-8 to add another owner to the subscription. Once you have added at least two owners, the misconfiguration will be remediated.

#### Using CLI

To remediate the misconfiguration "Atleast Two Subscription Owners Should Exist" for AZURE using AZURE CLI, follow the below steps:

Step 1: Open the Azure CLI and login to your Azure account using the command:
```
az login
```

Step 2: Once you are logged in, check the number of subscription owners using the command:
```
az role assignment list --role Owner --query "[].{Name:principalName}" --output tsv | sort | uniq | wc -l
```

Step 3: If the output is less than 2, create a new subscription owner using the command:
```
az ad sp create-for-rbac --name "NewOwnerName" --role owner --scopes /subscriptions/{subscription-id}
```
Replace "NewOwnerName" with the name you want to give to the new subscription owner and "{subscription-id}" with your Azure subscription ID.

Step 4: Assign the newly created subscription owner to the subscription using the command:
```
az role assignment create --assignee "NewOwnerName" --role Owner --subscription "{subscription-id}"
```
Replace "NewOwnerName" with the name of the new subscription owner and "{subscription-id}" with your Azure subscription ID.

Step 5: Verify the number of subscription owners again using the command:
```
az role assignment list --role Owner --query "[].{Name:principalName}" --output tsv | sort | uniq | wc -l
```

Step 6: If the output is 2 or more, the misconfiguration has been remediated successfully.

Note: Repeat the above steps for each Azure subscription that you have.

#### Using Python

To remediate the misconfiguration "At least two subscription owners should exist" in Azure using Python, you can use the Azure SDK for Python. Here are the steps to remediate the misconfiguration:

1. Import the necessary modules:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.authorization import AuthorizationManagementClient
```

2. Authenticate using the Azure SDK for Python:

```python
credential = DefaultAzureCredential()
authorization_client = AuthorizationManagementClient(credential, subscription_id)
```

Note: Replace `subscription_id` with the ID of the Azure subscription you want to remediate.

3. Check the number of subscription owners:

```python
subscription_id = 'your-subscription-id'
owners = authorization_client.role_assignments.list_for_scope(subscription_id, filter='roleDefinitionId eq acdd72a7-3385-48ef-bd42-f606fba81ae7')
num_owners = len(list(owners))
```

Note: The `acdd72a7-3385-48ef-bd42-f606fba81ae7` role definition ID is for the Owner role.

4. If the number of owners is less than 2, add another owner:

```python
if num_owners < 2:
    owner_principal_id = 'your-owner-principal-id'
    owner_role_definition_id = '/subscriptions/your-subscription-id/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7' # Owner role definition ID
    authorization_client.role_assignments.create(scope=subscription_id, role_assignment_name='owner', role_definition_id=owner_role_definition_id, principal_id=owner_principal_id)
```

Note: Replace `your-owner-principal-id` with the principal ID of the user or service principal you want to add as an owner.

5. Verify that there are now at least two subscription owners:

```python
owners = authorization_client.role_assignments.list_for_scope(subscription_id, filter='roleDefinitionId eq acdd72a7-3385-48ef-bd42-f606fba81ae7')
num_owners = len(list(owners))
if num_owners >= 2:
    print('There are now at least two subscription owners.')
else:
    print('There are still less than two subscription owners.')
```

Note: This step is optional, but it can be helpful to verify that the misconfiguration has been remediated successfully.

By following these steps, you can remediate the misconfiguration "At least two subscription owners should exist" in Azure using Python.




</Tab>
</Tabs>