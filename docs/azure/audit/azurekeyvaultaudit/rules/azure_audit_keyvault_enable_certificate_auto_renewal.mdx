---
slug: azure_audit_keyvault_enable_certificate_auto_renewal
title: Auto Renewal should be enabled for SSL Certificates
sidebar_label: Auto Renewal should be enabled for SSL Certificates
---

### More Info:

Microsoft Azure Key Vault service can renew your SSL certificates automatically in order to prevent any application or service outage, credential leak, or process violation that can disrupts your business.

### Risk Level

High

### Address

Security

### Compliance Standards

GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal using your credentials.
2. Navigate to the Key Vaults section from the left-hand side menu.
3. Select the Key Vault you want to inspect for SSL certificate auto-renewal.
4. Inside the Key Vault, go to the "Certificates" section. Here, you will see a list of all the certificates stored in the Key Vault.
5. Click on the certificate you want to check. In the certificate details page, look for the "Auto Renewal" setting. If it's set to "Yes", then auto-renewal is enabled. If it's set to "No", then auto-renewal is not enabled.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft Azure website. After installation, open your command prompt or terminal.

2. Login to Azure: Use the following command to login to your Azure account. You will be redirected to the browser for login. Enter your Azure account credentials.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, select the subscription where the Key Vault is located. Replace 'your-subscription-id' with your actual subscription id.
   ```
   az account set --subscription 'your-subscription-id'
   ```
4. Check Auto Renewal Status: Use the following command to check the auto-renewal status of SSL Certificates in Key Vault. Replace 'your-keyvault-name' with your actual Key Vault name and 'your-certificate-name' with your actual certificate name.
   ```
   az keyvault certificate show --vault-name 'your-keyvault-name' --name 'your-certificate-name' --query 'policy.attributes.auto_renew'
   ```
   If the output is 'null' or '0', then auto-renewal is not enabled for the SSL certificate. If the output is '1', then auto-renewal is enabled.

#### Using Python

To check if Auto Renewal is enabled for SSL Certificates in Azure Key Vault using Python scripts, you can follow these steps:

1. **Install Azure SDK for Python**: Azure SDK for Python is a set of libraries that allow you to work with Azure services like Key Vault. You can install it using pip:
   ```
   pip install azure-keyvault-certificates azure-identity
   ```

2. **Set up Azure credentials**: To interact with Azure services, you need to authenticate your application. You can do this by setting up environment variables for your Azure credentials. You can set `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, and `AZURE_CLIENT_SECRET` environment variables with your Azure account details.

3. **Connect to Azure Key Vault**: Use the Azure SDK for Python to connect to your Key Vault. Here's a sample script:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.keyvault.certificates import CertificateClient

   credential = DefaultAzureCredential()
   certificate_client = CertificateClient(vault_url="https://my-key-vault.vault.azure.net/", credential=credential)
   ```

4. **Check Auto Renewal status**: You can now use the `get_certificate` method to get a certificate and check its policy's `lifetime_actions` attribute. If Auto Renewal is enabled, there should be a `LifetimeAction` with `action_type` of `AutoRenew` and `trigger_days_before_expiry` set to a positive number. Here's a sample script:
   ```python
   certificate_name = "my-certificate"
   certificate = certificate_client.get_certificate(certificate_name)
   auto_renew_enabled = any(
       action.action_type == "AutoRenew" and action.trigger_days_before_expiry > 0
       for action in certificate.policy.lifetime_actions
   )
   print(f"Auto Renewal is {'enabled' if auto_renew_enabled else 'disabled'} for {certificate_name}")
   ```
   This script will print whether Auto Renewal is enabled or disabled for the specified certificate.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the steps to remediate the SSL certificate auto-renewal misconfiguration in Azure using the Azure console:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Navigate to the "App Services" section.
3. Select the app service for which you want to enable SSL certificate auto-renewal.
4. In the left-hand menu, click on "TLS/SSL settings".
5. Under the "Certificates" tab, select the SSL certificate for which you want to enable auto-renewal.
6. Click on the "Renew" button.
7. In the "Renewal settings" section, enable the "Auto-renew" option.
8. Set the "Days before expiration" value to a number of days before the certificate expires when you want to start the renewal process.
9. Click on the "Save" button to apply the changes.

That's it! The SSL certificate for your app service will now be automatically renewed before it expires.

#### Using CLI

To remediate the misconfiguration of SSL certificate auto-renewal for AZURE using AZURE CLI, follow these steps:

1. Open the AZURE CLI on your local machine or use the Cloud Shell in the Azure Portal.

2. Login to your Azure account using the command `az login`.

3. Once you are logged in, set the subscription context where the SSL certificate is located using the command `az account set --subscription <subscription_id>`.

4. Check the current status of the SSL certificate auto-renewal using the command `az network application-gateway ssl-cert show --resource-group <resource_group_name> --gateway-name <application_gateway_name> --name <ssl_certificate_name> --query 'sslState'`.

5. If the output of the above command shows that the SSL certificate auto-renewal is not enabled, then enable it using the command `az network application-gateway ssl-cert update --resource-group <resource_group_name> --gateway-name <application_gateway_name> --name <ssl_certificate_name> --set sslState=AutoRenew`.

6. Verify that the SSL certificate auto-renewal is enabled using the command `az network application-gateway ssl-cert show --resource-group <resource_group_name> --gateway-name <application_gateway_name> --name <ssl_certificate_name> --query 'sslState'`.

7. Once you have verified that the SSL certificate auto-renewal is enabled, you can exit the Azure CLI by typing `exit`.

By following these steps, you can remediate the misconfiguration of SSL certificate auto-renewal for AZURE using AZURE CLI.

#### Using Python

To remediate the misconfiguration of enabling auto-renewal for SSL certificates in Azure using Python, follow the steps below:

Step 1: Install the Azure SDK for Python using the following command:

```python
pip install azure-mgmt-web
```

Step 2: Authenticate with Azure using the Azure CLI or by setting the environment variables for authentication.

Step 3: Use the following Python code to enable auto-renewal for SSL certificates in Azure:

```python
from azure.mgmt.web import WebSiteManagementClient
from azure.common.credentials import UserPassCredentials

# Replace the values with your Azure subscription ID, resource group name, and certificate name
subscription_id = 'your-subscription-id'
resource_group_name = 'your-resource-group-name'
certificate_name = 'your-certificate-name'

# Replace the values with your Azure credentials
credentials = UserPassCredentials('username', 'password')

# Create a WebSiteManagementClient object
client = WebSiteManagementClient(credentials, subscription_id)

# Get the certificate details
certificate = client.certificates.get(resource_group_name, certificate_name)

# Enable auto-renewal for the certificate
certificate.auto_renew = True

# Update the certificate
client.certificates.create_or_update(resource_group_name, certificate_name, certificate)
```

This code will enable auto-renewal for the specified SSL certificate in Azure.


### Additional Reading:

- [https://docs.microsoft.com/en-us/azure/key-vault/general/about-keys-secrets-certificates](https://docs.microsoft.com/en-us/azure/key-vault/general/about-keys-secrets-certificates) 


</Tab>
</Tabs>