---
slug: azure_audit_networksecurity_security_group_unrestricted_oracle_database_access
title: Unrestricted Oracle Database Access
sidebar_label: Unrestricted Oracle Database Access
---

### More Info:

Ensure that your Microsoft Azure network security groups (NSGs) restrict inbound/ingress access on TCP port 1521 to trusted entities only (i.e. IP addresses) in order to implement the principle of least privilege and vastly reduce the attack surface. TCP port 1521 is used by Oracle Database Server, which is an object-relational database management system (RDBMS) server developed by Oracle Corporation.

### Risk Level

High

### Address

Security

### Compliance Standards

SOC2, GDPR, HIPAA, NISTCSF, PCIDSS, FedRAMP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal by entering "https://portal.azure.com" in your web browser. Enter your login credentials to access your Azure account.

2. Navigate to the Network Security Group (NSG): On the left-hand side of the Azure portal, click on "All Services". In the search box, type "Network Security Groups" and select it. This will display a list of all the NSGs associated with your Azure account.

3. Check for Oracle Database Access Rules: Select the NSG associated with the Oracle database. In the NSG window, click on "Inbound security rules" or "Outbound security rules" depending on the direction of the traffic you want to inspect. Look for any rules that allow traffic to or from the Oracle database (port 1521) from any source (0.0.0.0/0 or ::/0).

4. Inspect the Access: For each rule that allows traffic to or from the Oracle database, check the "Action" column. If the action is set to "Allow", this indicates that the Oracle database access is unrestricted.

#### Using CLI

1. Install and configure Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine and sign in to your Azure account. You can install Azure CLI by following the instructions on the official Azure CLI documentation. After installing Azure CLI, you can sign in to your Azure account by running the following command in your terminal:

   ```
   az login
   ```

2. List all Network Security Groups (NSGs): NSGs contain a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network. To list all NSGs in your Azure account, run the following command:

   ```
   az network nsg list
   ```

3. Check NSG rules for unrestricted Oracle Database access: Oracle Database typically uses port 1521 for connections. If there is an NSG rule that allows inbound traffic from any source to port 1521, it means that Oracle Database access is unrestricted. To check NSG rules, run the following command for each NSG:

   ```
   az network nsg rule list --nsg-name <NSG Name>
   ```

   Replace `<NSG Name>` with the name of your NSG. This command will return a list of all rules in the specified NSG.

4. Analyze the output: Look for rules that have 'destinationPortRange' set to '1521' and 'access' set to 'Allow'. If the 'sourceAddressPrefix' is set to '*', it means that the rule allows traffic from any source. This is a misconfiguration as it allows unrestricted Oracle Database access.

#### Using Python

1. AWS:
   - Use the AWS SDK for Python (Boto3) to list all the security groups in your AWS environment.
   - For each security group, check the inbound rules. If any rule allows traffic from all IP addresses (0.0.0.0/0) to port 1521 (the default port for Oracle databases), then the database is misconfigured.
   - Python script:
   ```python
   import boto3
   ec2 = boto3.resource('ec2')
   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           for ip_range in permission['IpRanges']:
               if ip_range['CidrIp'] == '0.0.0.0/0' and permission['FromPort'] == 1521:
                   print(f"Security Group {security_group.id} allows unrestricted Oracle database access.")
   ```

2. Azure:
   - Use the Azure SDK for Python to list all the network security groups in your Azure environment.
   - For each network security group, check the security rules. If any rule allows traffic from all IP addresses (0.0.0.0/0) to port 1521, then the database is misconfigured.
   - Python script:
   ```python
   from azure.mgmt.network import NetworkManagementClient
   from azure.identity import DefaultAzureCredential
   credential = DefaultAzureCredential()
   network_client = NetworkManagementClient(credential, '<subscription_id>')
   for nsg in network_client.network_security_groups.list_all():
       for rule in nsg.security_rules:
           if rule.destination_port_range == '1521' and rule.source_address_prefix == '*':
               print(f"Network Security Group {nsg.id} allows unrestricted Oracle database access.")
   ```

3. GCP:
   - Use the Google Cloud SDK for Python to list all the firewall rules in your GCP environment.
   - For each firewall rule, check the allowed traffic. If any rule allows traffic from all IP addresses (0.0.0.0/0) to port 1521, then the database is misconfigured.
   - Python script:
   ```python
   from google.cloud import compute_v1
   client = compute_v1.FirewallsClient()
   for firewall in client.list(project='<project_id>'):
       for allowed in firewall.allowed:
           if '1521' in allowed.ports and firewall.source_ranges == ['0.0.0.0/0']:
               print(f"Firewall {firewall.name} allows unrestricted Oracle database access.")
   ```
Please replace `<subscription_id>` and `<project_id>` with your actual Azure subscription ID and GCP project ID respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of unrestricted Oracle Database Access in Azure, you can follow the below steps:

1. Login to Azure portal (https://portal.azure.com/)

2. Navigate to the Azure SQL Database service.

3. Select the database that needs to be remediated.

4. In the left-hand menu, select "Firewalls and virtual networks".

5. Under "Firewalls", select "Add client IP".

6. This will add your client IP to the allowed IP addresses list. If you want to allow access from a specific IP range, you can add that range as well.

7. Under "Virtual networks", select "Add existing virtual network".

8. This will allow you to add an existing virtual network to the allowed networks list.

9. Once you have added the necessary IP addresses and networks, click "Save" to apply the changes.

10. Finally, ensure that the "Allow access to Azure services" option is set to "OFF" to prevent unrestricted access to the database.

By following these steps, you can remediate the misconfiguration of unrestricted Oracle Database Access in Azure and ensure that your database is secure.

#### Using CLI

The following are the step-by-step instructions to remediate the "Unrestricted Oracle Database Access" misconfiguration in Azure using Azure CLI:

1. Open the Azure CLI and log in to your Azure account.

2. Run the following command to list all the Oracle database servers in your subscription:

   ```
   az mysql server list
   ```

3. Identify the server that has unrestricted access.

4. Run the following command to update the firewall rules for the identified server:

   ```
   az mysql server firewall-rule update --name <firewall-rule-name> --server <server-name> --resource-group <resource-group-name> --start-ip-address <start-ip-address> --end-ip-address <end-ip-address>
   ```

   Replace the following parameters in the command:

   - `<firewall-rule-name>`: The name of the firewall rule that needs to be updated.
   - `<server-name>`: The name of the Oracle database server.
   - `<resource-group-name>`: The name of the resource group that contains the Oracle database server.
   - `<start-ip-address>`: The starting IP address of the allowed IP range.
   - `<end-ip-address>`: The ending IP address of the allowed IP range.

5. Run the following command to verify that the firewall rule has been updated:

   ```
   az mysql server firewall-rule list --server <server-name> --resource-group <resource-group-name>
   ```

   Replace the following parameters in the command:

   - `<server-name>`: The name of the Oracle database server.
   - `<resource-group-name>`: The name of the resource group that contains the Oracle database server.

6. Verify that the firewall rule has been updated and that access to the Oracle database is now restricted.

7. Repeat the above steps for all the Oracle database servers in your subscription that have unrestricted access.

#### Using Python

To remediate the unrestricted Oracle Database Access issue in Azure using Python, you can follow these steps:

1. Connect to your Azure account using the Azure Python SDK.

2. Retrieve the list of Azure Database for Oracle servers in your subscription.

3. For each server, retrieve the list of firewall rules associated with it.

4. For each firewall rule, check if it allows unrestricted access to the server.

5. If a firewall rule allows unrestricted access, update the firewall rule to restrict access to a specific IP range or subnet.

Here's a sample Python code that demonstrates how to remediate the unrestricted Oracle Database Access issue in Azure:

```
# Import the required libraries
from azure.identity import DefaultAzureCredential
from azure.mgmt.rdbms.oracle import OracleManagementClient

# Create a credential object
credential = DefaultAzureCredential()

# Create a management client object
oracle_client = OracleManagementClient(credential, subscription_id)

# Retrieve the list of Oracle servers in the subscription
servers = oracle_client.servers.list()

# For each server, retrieve the list of firewall rules
for server in servers:
    firewall_rules = oracle_client.firewall_rules.list_by_server(server.resource_group, server.name)
    
    # For each firewall rule, check if it allows unrestricted access
    for rule in firewall_rules:
        if rule.start_ip_address == "0.0.0.0" and rule.end_ip_address == "255.255.255.255":
            # Update the firewall rule to restrict access to a specific IP range or subnet
            updated_rule = rule
            updated_rule.start_ip_address = "x.x.x.x" # Replace x.x.x.x with the start IP address of the IP range or subnet
            updated_rule.end_ip_address = "y.y.y.y" # Replace y.y.y.y with the end IP address of the IP range or subnet
            oracle_client.firewall_rules.create_or_update(server.resource_group, server.name, updated_rule.name, updated_rule)
```

Note: You will need to replace `subscription_id` with your Azure subscription ID, and `x.x.x.x` and `y.y.y.y` with the appropriate IP addresses for your environment.




</Tab>
</Tabs>