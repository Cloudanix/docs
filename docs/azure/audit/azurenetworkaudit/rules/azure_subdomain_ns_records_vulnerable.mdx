---
slug: azure_subdomain_ns_records_vulnerable
title: Azure Subdomain NS Records Vulnerable
sidebar_label: Azure Subdomain NS Records Vulnerable
---

### More Info:

Ensure Azure Subdomain NS Records are not vulnerable

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to Azure Portal: First, you need to log in to your Azure portal using your credentials. 

2. Navigate to DNS Zones: Once you are logged in, go to the left-hand side menu and click on "All Services". In the search bar, type "DNS Zones" and select it.

3. Check DNS Zones: In the DNS Zones, you will see a list of all your DNS zones. Click on the DNS zone that you want to check. 

4. Verify NS Records: In the DNS zone, you will see a list of record sets. Look for the NS (Name Server) record set. If the NS record is pointing to a subdomain, it is vulnerable. The NS record should always point to the domain itself, not a subdomain.

#### Using CLI

1. Install Azure CLI: Before you can start detecting misconfigurations, you need to have Azure CLI installed on your system. You can download it from the official Microsoft website and install it following the instructions provided.

2. Login to Azure Account: Once Azure CLI is installed, open your command prompt and type the following command to login to your Azure account:

   ```
   az login
   ```
   Follow the prompts in your terminal to sign in.

3. List DNS Zones: After logging in, you can list all the DNS zones in your Azure account by running the following command:

   ```
   az network dns zone list
   ```
   This command will return a list of all DNS zones along with their properties.

4. Check NS Records: For each DNS zone, you can check the NS records by running the following command:

   ```
   az network dns record-set ns show --resource-group {resource-group-name} --zone-name {zone-name} --name "@"
   ```
   Replace `{resource-group-name}` and `{zone-name}` with the name of your resource group and DNS zone respectively. This command will return the NS records for the specified DNS zone. If the NS records are pointing to an external DNS server, it indicates a potential misconfiguration.

#### Using Python

1. Install the necessary Python libraries: You will need the 'requests' and 'dns.resolver' libraries. You can install them using pip:

```python
pip install requests dnspython
```

2. Create a Python script to check for the NS records of the subdomain:

```python
import dns.resolver
import requests

def check_ns_records(subdomain):
    try:
        result = dns.resolver.resolve(subdomain, 'NS')
        for val in result:
            print('NS record for subdomain: ', val.to_text())
    except:
        print('No NS records found for subdomain')

subdomain = 'your_subdomain.your_domain.com'
check_ns_records(subdomain)
```

This script will print out the NS records for the specified subdomain. If no NS records are found, it will print a message saying so.

3. Run the script: You can run the script using the Python interpreter from the command line:

```bash
python check_ns_records.py
```

4. Analyze the output: If the script prints out NS records, then the subdomain has NS records. If it prints out the message saying no NS records were found, then the subdomain does not have NS records. If the NS records are not the ones you expected, then there may be a misconfiguration.

Remember to replace 'your_subdomain.your_domain.com' with the actual subdomain you want to check.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the Azure Subdomain NS Records vulnerability in the Azure Network using the Azure console, follow these steps:

1. Log in to the Azure portal (portal.azure.com) using your Azure account credentials.

2. Navigate to the Azure DNS service by searching for "DNS" in the search bar at the top of the portal and selecting "DNS zones" from the results.

3. In the DNS zones blade, select the DNS zone that contains the vulnerable subdomain NS records.

4. Once you've selected the DNS zone, you will see a list of DNS records associated with it. Look for the NS records related to the vulnerable subdomain.

5. Select the vulnerable NS record to open the record details.

6. In the record details, click on the "Edit" button to modify the NS record.

7. Replace the existing vulnerable NS record with the correct NS record provided by your DNS provider or the authoritative DNS server for the subdomain.

8. Save the changes by clicking on the "Save" button.

9. Repeat steps 5 to 8 for all the vulnerable NS records associated with the subdomain.

10. Once you have updated all the NS records, monitor the DNS propagation to ensure the changes are reflected across the DNS infrastructure. This may take some time depending on the TTL (Time to Live) settings of the DNS records.

11. After the DNS changes have propagated, verify the subdomain NS records using DNS lookup tools or commands to ensure they are pointing to the correct authoritative DNS servers.

By following these steps, you will be able to remediate the Azure Subdomain NS Records vulnerability in the Azure Network using the Azure console.

#### Using CLI

To remediate the Azure Subdomain NS Records vulnerability using Azure CLI, follow these step-by-step instructions:

1. Install and configure Azure CLI: If you haven't already, install Azure CLI on your local machine and sign in to your Azure account using the command `az login`.

2. Identify the affected subdomain: Determine the subdomain that has the vulnerable NS records.

3. Retrieve the current NS records: Use the following command to retrieve the current NS records for the subdomain:
   ```
   az network dns zone show --name <zone_name> --resource-group <resource_group_name>
   ```

   Replace `<zone_name>` with the name of the DNS zone containing the subdomain and `<resource_group_name>` with the name of the resource group where the DNS zone is located.

4. Update the NS records: Remove the vulnerable NS records and add the correct ones using the following command:
   ```
   az network dns record-set ns update --name <record_set_name> --zone-name <zone_name> --resource-group <resource_group_name> --remove nsRecords --add nsRecords <new_ns_records>
   ```

   Replace `<record_set_name>` with the name of the record set containing the NS records, `<zone_name>` with the name of the DNS zone, `<resource_group_name>` with the resource group name, and `<new_ns_records>` with the correct NS records.

   Note: Ensure that you remove the vulnerable NS records and add the correct ones in the `--remove` and `--add` parameters, respectively.

5. Verify the changes: Use the following command to verify that the NS records have been updated:
   ```
   az network dns record-set ns show --name <record_set_name> --zone-name <zone_name> --resource-group <resource_group_name>
   ```

   Ensure that the output reflects the updated NS records.

By following these steps, you can remediate the Azure Subdomain NS Records vulnerability using Azure CLI.

#### Using Python

To remediate the Azure subdomain NS records vulnerability using Python, you can follow these steps:

1. Install the required Python packages:
   ```bash
   pip install azure-mgmt-dns
   ```

2. Import the necessary modules in your Python script:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.dns import DnsManagementClient
   ```

3. Authenticate with Azure using the DefaultAzureCredential:
   ```python
   credential = DefaultAzureCredential()
   dns_client = DnsManagementClient(credential, subscription_id)
   ```

4. Retrieve the list of DNS zones in your Azure subscription:
   ```python
   zones = dns_client.zones.list()
   ```

5. Iterate through each DNS zone and check for subdomains with vulnerable NS records:
   ```python
   for zone in zones:
       record_sets = dns_client.record_sets.list_by_dns_zone(zone.resource_group, zone.name)
       for record_set in record_sets:
           if record_set.type == 'NS' and record_set.ttl < 3600:
               # Update the TTL value for vulnerable NS records
               record_set.ttl = 3600
               dns_client.record_sets.update(zone.resource_group, zone.name, record_set.name, record_set.type, record_set)
   ```

6. Save the Python script and execute it. Ensure that you have the necessary permissions to modify DNS records in your Azure subscription.

This script will iterate through all the DNS zones in your Azure subscription and identify any NS records with a TTL (Time to Live) value less than 3600 seconds (1 hour). It will then update the TTL value for these vulnerable NS records to 3600 seconds, which is the recommended minimum value.

Make sure to replace `subscription_id` with your Azure subscription ID in the authentication step.

Note: This script assumes that you have already authenticated with Azure and have the necessary permissions to modify DNS records.



</Tab>
</Tabs>