

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Azure portal using your Azure account credentials.

2. In the left-hand menu, navigate to "Storage accounts". This will open a list of all the storage accounts associated with your Azure subscription.

3. Click on the name of the storage account you want to check. This will open the storage account's dashboard.

4. In the storage account dashboard, navigate to the "Settings" section and click on "Firewalls and virtual networks". Under the "Allow access from" section, if the "All networks" option is selected, it means that the storage account is allowing public traffic.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft website and follow the installation instructions.

2. Login to Azure: After installing Azure CLI, you need to login to your Azure account. Open your command prompt and type the following command:
   ```
   az login
   ```
   Follow the instructions on the screen to login to your Azure account.

3. List all storage accounts: Once you are logged in, you can list all the storage accounts in your Azure subscription by running the following command:
   ```
   az storage account list
   ```
   This command will return a JSON object with all the storage accounts.

4. Check for public access: To check if a storage account allows public traffic, you need to look at the 'allowBlobPublicAccess' property of each storage account. If this property is set to 'true', then the storage account allows public traffic. You can use the following command to check this property for all storage accounts:
   ```
   az storage account list --query "[].{name:name, allowBlobPublicAccess:allowBlobPublicAccess}"
   ```
   This command will return a list of all storage accounts with their names and the 'allowBlobPublicAccess' property. If the 'allowBlobPublicAccess' property is 'true' for any storage account, then that storage account allows public traffic.

#### Using Python

1. Install Azure SDK: To interact with Azure services, you need to install Azure SDK in your Python environment. You can do this by running the command `pip install azure-storage-blob`.

2. Import Required Libraries: Import the necessary libraries into your Python script. You will need the `azure.storage.blob` library to interact with Azure Blob Storage.

```python
from azure.storage.blob import BlobServiceClient, BlobClient, ContainerClient, PublicAccess
```

3. Connect to Azure Storage Account: You need to connect to your Azure Storage Account. You can do this by creating an instance of `BlobServiceClient` using your storage account connection string.

```python
connection_string = "your-connection-string"
blob_service_client = BlobServiceClient.from_connection_string(connection_string)
```

4. Check for Public Access: Now, you can iterate over all the containers in your storage account and check if they allow public access. If the `public_access` attribute of a container is not `None`, it means that the container allows public access.

```python
container_list = blob_service_client.list_containers()
for container in container_list:
    container_client = blob_service_client.get_container_client(container)
    properties = container_client.get_container_properties()
    if properties.public_access != PublicAccess.OFF:
        print(f"Container {container.name} allows public access.")
```

This script will print the names of all containers in your storage account that allow public access.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of storage accounts allowing public traffic in Azure, you can follow the below steps:

1. Open the Azure Portal and navigate to the storage account that is allowing public traffic.
2. Click on "Firewalls and virtual networks" under the "Settings" section in the left-hand menu.
3. In the "Firewalls and virtual networks" tab, select "Selected networks" under the "Allow access from" section.
4. Add the IP addresses or ranges that need access to the storage account.
5. Under the "Network connectivity" section, select "Private endpoint" to restrict access to the storage account to only those clients that have a private endpoint in the same virtual network.
6. Save the changes.

By following the above steps, you can remediate the issue of storage accounts allowing public traffic in Azure.

#### Using CLI

To remediate the issue of Azure Storage Accounts allowing public traffic, you can follow the below steps using Azure CLI:

1. Open the Azure CLI in your terminal or command prompt.
2. Login to your Azure account using the command `az login`.
3. Once you are logged in, select the subscription that contains the storage account using the command `az account set --subscription <subscription-id>`.
4. Identify the storage account that is allowing public traffic using the command `az storage account list`.
5. Once you have identified the storage account, update the network access rule to deny public access using the command `az storage account update --name <storage-account-name> --resource-group <resource-group-name> --default-action Deny`.

Note: Replace `<subscription-id>`, `<storage-account-name>`, and `<resource-group-name>` with the actual values from your environment.

After executing the above command, the storage account will be updated to deny public access, and only authorized traffic will be allowed to access the storage account.

#### Using Python

To remediate the Azure storage accounts allowing public traffic misconfiguration using Python, you can use the Azure SDK for Python. Follow these steps:

1. Install the Azure SDK for Python using pip:

```
pip install azure-storage-blob
```

2. Import the necessary modules:

```python
from azure.storage.blob import BlockBlobService, PublicAccess
```

3. Initialize the BlockBlobService object with your storage account credentials:

```python
account_name = '<your_account_name>'
account_key = '<your_account_key>'
service = BlockBlobService(account_name=account_name, account_key=account_key)
```

4. Get a list of all containers in the storage account:

```python
containers = service.list_containers()
```

5. For each container, set the public access level to 'None':

```python
for container in containers:
    service.set_container_acl(container.name, public_access=PublicAccess.None)
```

6. Finally, verify that the public access level for all containers is set to 'None':

```python
for container in containers:
    acl = service.get_container_acl(container.name)
    if acl.public_access != PublicAccess.None:
        print(f"Public access still enabled for container {container.name}")
```

That's it! With these steps, you should be able to remediate the Azure storage accounts allowing public traffic misconfiguration using Python.


</Tab>
</Tabs>