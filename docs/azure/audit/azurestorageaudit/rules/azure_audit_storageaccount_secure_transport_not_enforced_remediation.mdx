

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the Azure portal.

2. Navigate to the Storage Accounts section. Here, you will see a list of all your storage accounts.

3. Select the storage account you want to check for the misconfiguration.

4. In the storage account window, under the settings section, click on the "Configuration" option. 

5. In the configuration section, look for the "Secure transfer required" setting. If it is disabled, it means that Secure Transfer (HTTPS) is not enforced for that storage account.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install the Azure CLI on your local machine. You can download it from the official Microsoft Azure website. Once installed, open your command line interface and run the following command to login to your Azure account:

   ```
   az login
   ```

2. List all storage accounts: After logging in, you can list all the storage accounts in your Azure subscription by running the following command:

   ```
   az storage account list
   ```

3. Check Secure Transfer Required property: For each storage account, you need to check the 'supportsHttpsTrafficOnly' property. If this property is set to false, it means that the storage account does not enforce secure transfer. You can check this property by running the following command:

   ```
   az storage account show --name <storage_account_name> --query "supportsHttpsTrafficOnly"
   ```

   Replace `<storage_account_name>` with the name of your storage account. This command will return either true or false.

4. Repeat for all storage accounts: You need to repeat step 3 for all storage accounts in your Azure subscription. If any storage account returns false, it means that secure transfer is not enforced for that storage account.

#### Using Python

1. AWS S3:

You can use the AWS SDK for Python (Boto3) to check if Secure Transfer is enabled on S3 buckets. Here is a sample script:

```python
import boto3

s3 = boto3.client('s3')

def check_secure_transfer(bucket_name):
    bucket_policy = s3.get_bucket_policy(Bucket=bucket_name)
    for statement in bucket_policy['Policy']['Statement']:
        if statement['Action'] == 's3:*' and 'Condition' in statement:
            if 'Bool' in statement['Condition'] and 'aws:SecureTransport' in statement['Condition']['Bool']:
                if statement['Condition']['Bool']['aws:SecureTransport'] == 'false':
                    return False
    return True
```

2. Azure Blob Storage:

You can use the Azure SDK for Python to check if Secure Transfer is enabled on Blob Storage. Here is a sample script:

```python
from azure.storage.blob import BlobServiceClient

def check_secure_transfer(storage_account_name, storage_account_key):
    blob_service_client = BlobServiceClient(account_url=f"https://{storage_account_name}.blob.core.windows.net", credential=storage_account_key)
    service_properties = blob_service_client.get_service_properties()
    return service_properties['SecureTransferRequired']
```

3. Google Cloud Storage (GCS):

You can use the Google Cloud SDK for Python to check if Secure Transfer is enabled on GCS buckets. Here is a sample script:

```python
from google.cloud import storage

def check_secure_transfer(bucket_name):
    client = storage.Client()
    bucket = client.get_bucket(bucket_name)
    iam_policy = bucket.get_iam_policy(requested_policy_version=3)
    for binding in iam_policy.bindings:
        if binding['role'] == 'roles/storage.objectViewer' and 'condition' in binding:
            if binding['condition']['title'] == 'secureTransport' and binding['condition']['description'] == 'Enforce secure transport':
                return True
    return False
```

Please replace the placeholders with your actual values. Also, make sure to handle exceptions as needed.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Secure Transfer (HTTPS) Not Enforced" misconfiguration in Azure, follow these steps:

1. Log in to the Azure portal.

2. Navigate to the storage account that needs to be remediated.

3. Click on the "Firewalls and virtual networks" tab.

4. Ensure that "Allow access from" is set to "Selected networks".

5. Click on the "Selected networks" tab and ensure that "All networks" is not selected.

6. Add the IP addresses or ranges that need to access the storage account.

7. Click on the "Secure transfer required" toggle switch to enable HTTPS.

8. Click on the "Save" button to save the changes.

9. Verify that HTTPS is enforced by attempting to access the storage account using HTTP. Access should be denied.

By following these steps, you can remediate the "Secure Transfer (HTTPS) Not Enforced" misconfiguration in Azure.

#### Using CLI

To remediate the "Secure Transfer (HTTPS) Not Enforced" misconfiguration for an Azure resource using Azure CLI, follow these steps:

1. Open the Azure CLI and log in to your Azure account.

2. Identify the resource for which HTTPS is not enforced.

3. Run the following command to enable HTTPS for the identified resource:
```
az webapp update --name <app_name> --resource-group <resource_group_name> --set httpsOnly=true
```

4. Replace `<app_name>` with the name of the app for which you want to enforce HTTPS.

5. Replace `<resource_group_name>` with the name of the resource group that contains the app.

6. After running the command, Azure CLI will return the updated configuration of the app.

7. Verify that HTTPS is now enforced by accessing the app's URL using HTTPS.

By following these steps, you can remediate the "Secure Transfer (HTTPS) Not Enforced" misconfiguration for an Azure resource using Azure CLI.

#### Using Python

To remediate the misconfiguration "Secure Transfer (HTTPS) Not Enforced" for Azure using Python, you can follow these steps:

1. Install the Azure SDK for Python using pip. You can install it by running the following command in your terminal:
```
pip install azure
```

2. Use the Azure Python SDK to create an HTTPS-only endpoint for your web app. You can do this by running the following code:
```
from azure.mgmt.web import WebSiteManagementClient
from azure.common.credentials import ServicePrincipalCredentials

# Replace with your own subscription ID, resource group name, and web app name
subscription_id = 'your-subscription-id'
resource_group_name = 'your-resource-group-name'
web_app_name = 'your-web-app-name'

# Replace with your own service principal details
tenant_id = 'your-tenant-id'
client_id = 'your-client-id'
client_secret = 'your-client-secret'

# Authenticate using a service principal
credentials = ServicePrincipalCredentials(
    client_id=client_id,
    secret=client_secret,
    tenant=tenant_id
)

# Create a web site management client
web_client = WebSiteManagementClient(credentials, subscription_id)

# Get the web app configuration
web_app_config = web_client.web_apps.get_configuration(resource_group_name, web_app_name)

# Update the web app configuration to use HTTPS only
web_app_config.http20_enabled = True
web_app_config.min_tls_version = '1.2'
web_client.web_apps.update_configuration(resource_group_name, web_app_name, web_app_config)
```

3. Run the code to update your web app configuration and enforce HTTPS. Once the code has executed successfully, your web app will only be accessible over HTTPS, ensuring that all data is transferred securely.

Note: This code assumes that you have already created a web app in Azure and have the necessary permissions to modify its configuration. If you need to create a new web app, you can use the Azure Python SDK to create one programmatically.


</Tab>
</Tabs>