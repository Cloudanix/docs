---
slug: azure_audit_postgresql_database_server_enable_in_transit_encryption
title: Enable In-Transit Encryption for PostgreSQL Database Servers
sidebar_label: Enable In-Transit Encryption for PostgreSQL Database Servers
---

### More Info:

Ensure that Microsoft Azure PostgreSQL server data is encrypted in transit in order to meet security and compliance requirements. In-transit encryption helps prevent unauthorized users from getting access to critical data available in your Azure PostgreSQL databases.

### Risk Level

High

### Address

Security

### Compliance Standards

CISAZURE, CBP, HITRUST, SOC2, NISTCSF, PCIDSS, FedRAMP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal and navigate to the Azure Database for PostgreSQL servers page.
2. Select the PostgreSQL server for which you want to check the in-transit encryption status.
3. In the server's dashboard, select "Connection security" under the "Settings" section.
4. In the "Connection security" page, check the status of "SSL enforce status". If it is set to "ENABLED", then in-transit encryption is enabled for your PostgreSQL server. If it is set to "DISABLED", then in-transit encryption is not enabled.

#### Using CLI

1. Install Azure CLI: Before you can use the Azure CLI commands, you need to install Azure CLI on your local system. You can download it from the official Microsoft Azure website.

2. Login to Azure: Use the following command to login to your Azure account. You will be redirected to the browser for login.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, select the subscription where the PostgreSQL server resides.
   ```
   az account set --subscription "mySubscription"
   ```
4. Check In-Transit Encryption: Use the following command to check the status of in-transit encryption for your PostgreSQL server. Replace 'myserver' and 'myresourcegroup' with your server name and resource group respectively.
   ```
   az postgres server show --name "myserver" --resource-group "myresourcegroup" --query sslEnforcement
   ```
   If the output is "Enabled", then in-transit encryption is enabled. If the output is "Disabled", then in-transit encryption is not enabled.

#### Using Python

To check if In-Transit Encryption is enabled for PostgreSQL Database Servers in SQL, you can use the boto3 library in Python which allows you to write scripts to automate AWS services. Here are the steps:

1. **Import the necessary libraries and establish a session with AWS:**

```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

2. **Create a client for RDS:**

```python
rds = session.client('rds')
```

3. **Get the list of all DB instances and check if In-Transit Encryption is enabled:**

```python
try:
    response = rds.describe_db_instances()
except BotoCoreError as e:
    print(e)
else:
    for instance in response['DBInstances']:
        if instance['Engine'] == 'postgres':
            if 'EnabledCloudwatchLogsExports' in instance:
                if 'postgresql' in instance['EnabledCloudwatchLogsExports']:
                    print(f"DB instance {instance['DBInstanceIdentifier']} has In-Transit Encryption enabled.")
                else:
                    print(f"DB instance {instance['DBInstanceIdentifier']} does not have In-Transit Encryption enabled.")
            else:
                print(f"DB instance {instance['DBInstanceIdentifier']} does not have In-Transit Encryption enabled.")
```

This script will print out whether each PostgreSQL DB instance has In-Transit Encryption enabled or not.

Please replace `'YOUR_ACCESS_KEY'`, `'YOUR_SECRET_KEY'`, and `'YOUR_REGION'` with your actual AWS access key, secret key, and region respectively.

Note: This script assumes that you have the necessary permissions to list and describe DB instances in RDS. If you don't, you may need to adjust your IAM policies accordingly.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration of enabling in-transit encryption for PostgreSQL Database Servers in AZURE:

1. Go to the AZURE portal and login to your account.
2. In the left-hand menu, click on the "Azure Database for PostgreSQL servers" option.
3. Select the PostgreSQL server for which you want to enable in-transit encryption.
4. In the left-hand menu, under the "Security" section, click on the "Connection security" option.
5. Under the "Connection security" section, toggle the "Enforce SSL connection" option to "Enabled".
6. Once you have enabled the "Enforce SSL connection" option, click on the "Save" button at the top of the page to save your changes.

That's it! You have now remediated the misconfiguration of enabling in-transit encryption for PostgreSQL Database Servers in AZURE. Now, all connections to your PostgreSQL server will be encrypted using SSL.

#### Using CLI

To remediate the misconfiguration of enabling In-Transit Encryption for PostgreSQL Database Servers in AZURE using AZURE CLI, you can follow these step-by-step instructions:

1. Open the Azure CLI in your preferred terminal.

2. Login to your Azure account using the command below:

   ```
   az login
   ```

3. Once you are logged in, set the subscription where your PostgreSQL server is located using the command below:

   ```
   az account set --subscription <subscription_name>
   ```

4. Next, set the resource group where your PostgreSQL server is located using the command below:

   ```
   az group set --name <resource_group_name>
   ```

5. Now, enable SSL enforcement for your PostgreSQL server using the command below:

   ```
   az postgres server update --resource-group <resource_group_name> --name <postgresql_server_name> --ssl-enforcement Enabled
   ```

   This command will enable SSL enforcement for your PostgreSQL server which will encrypt the data in transit.

6. Finally, verify that SSL enforcement is enabled for your PostgreSQL server by running the following command:

   ```
   az postgres server show --resource-group <resource_group_name> --name <postgresql_server_name> --query sslEnforcement
   ```

   This command will return the value "Enabled" which confirms that SSL enforcement is enabled for your PostgreSQL server.

By following these steps, you will be able to remediate the misconfiguration of enabling In-Transit Encryption for PostgreSQL Database Servers in AZURE using AZURE CLI.

#### Using Python

To remediate the misconfiguration "Enable In-Transit Encryption for PostgreSQL Database Servers" in Azure using Python, you can follow the below steps:

1. Import the necessary libraries:

```
from azure.common.credentials import ServicePrincipalCredentials
from azure.mgmt.postgresql import PostgreSQLManagementClient
from azure.mgmt.postgresql.models import ServerUpdateParameters
```

2. Authenticate with Azure using Service Principal credentials:

```
TENANT_ID = 'your_tenant_id'
CLIENT_ID = 'your_client_id'
CLIENT_SECRET = 'your_client_secret'
SUBSCRIPTION_ID = 'your_subscription_id'

credentials = ServicePrincipalCredentials(
    client_id=CLIENT_ID,
    secret=CLIENT_SECRET,
    tenant=TENANT_ID
)
```

3. Instantiate the PostgreSQLManagementClient:

```
client = PostgreSQLManagementClient(credentials, SUBSCRIPTION_ID)
```

4. Get the existing server details:

```
resource_group_name = 'your_resource_group_name'
server_name = 'your_server_name'

server = client.servers.get(resource_group_name, server_name)
```

5. Update the server with the in-transit encryption enabled:

```
params = ServerUpdateParameters(
    ssl_enforcement="Enabled"
)

client.servers.update(resource_group_name, server_name, params)
```

6. Verify that the in-transit encryption is enabled:

```
server = client.servers.get(resource_group_name, server_name)
print(server.ssl_enforcement)
```

These steps will enable in-transit encryption for PostgreSQL Database Servers in Azure using Python.




</Tab>
</Tabs>