---
slug: azure_audit_redis_tls_protocol_latest_version
title: Check for TLS Protocol Latest Version
sidebar_label: Check for TLS Protocol Latest Version
---

### More Info:

Ensure that the tls_version parameter is set to TLSV1.2

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, ISO27001


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal (https://portal.azure.com/) and sign in with your Azure account credentials.

2. Navigate to SQL databases: From the left-hand menu, select "SQL databases". This will display a list of all the SQL databases in your Azure account.

3. Select the SQL Server: Click on the name of the SQL Server for which you want to check the TLS protocol version. This will open the SQL Server's dashboard.

4. Check for TLS Protocol Version: In the SQL Server's dashboard, navigate to the "Firewalls and virtual networks" section. Under the settings, look for the "Minimum TLS version" field. This field will display the minimum TLS version that is currently being used by the SQL Server. If the version displayed is not the latest version, then it indicates a misconfiguration.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install the Azure CLI on your local machine. You can download it from the official Microsoft Azure website.

2. Login to Azure: Use the following command to login to your Azure account. You will be prompted to enter your username and password.
   ```
   az login
   ```
3. List SQL Servers: Use the following command to list all the SQL servers in your Azure account. This will give you a list of all the SQL servers along with their details.
   ```
   az sql server list
   ```
4. Check for TLS Protocol Version: Use the following command to check the TLS protocol version of a specific SQL server. Replace `<server_name>` and `<resource_group>` with your SQL server name and resource group respectively.
   ```
   az sql server show --name <server_name> --resource-group <resource_group> --query 'minimalTlsVersion'
   ```
   This command will return the minimal TLS version that is required to connect to the SQL server. If it is not the latest version, then it is a misconfiguration.

#### Using Python

1. Import the necessary libraries: You will need the 'requests' library to make HTTP requests and 'ssl' library to handle SSL connections. If they are not installed, you can install them using pip.

```python
import requests
import ssl
```

2. Create a function to check the TLS version: This function will establish a connection to the SQL server and check the version of the TLS protocol being used.

```python
def check_tls_version(host, port):
    context = ssl.create_default_context()
    with context.wrap_socket(socket.socket(), server_hostname=host) as s:
        s.connect((host, port))
        return s.version()
```

3. Call the function with the SQL server's host and port: Replace 'sql_server_host' and 'sql_server_port' with your SQL server's host and port.

```python
tls_version = check_tls_version('sql_server_host', 'sql_server_port')
print(f'TLS version: {tls_version}')
```

4. Check the output: The script will print the version of the TLS protocol being used by the SQL server. If the version is not the latest (TLS 1.3 at the time of writing), then it is a misconfiguration.

Please note that this script assumes that the SQL server is accessible over the network and that SSL/TLS is enabled. If the SQL server is not accessible or SSL/TLS is not enabled, the script will fail. Also, the script does not handle any exceptions, so you might want to add error handling code to make it more robust.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the TLS Protocol Latest Version misconfiguration in Azure using the Azure console, follow the steps below:

Step 1: Log in to the Azure portal and navigate to the virtual machine that needs to be remediated.

Step 2: Open the virtual machine and click on the "Networking" tab.

Step 3: Under "Settings", click on "Network Security Group".

Step 4: Click on the Network Security Group that is associated with the virtual machine.

Step 5: Click on "Inbound security rules" and then click on "Add".

Step 6: In the "Add inbound security rule" page, enter the following details:

- Name: A name for the rule (e.g. "TLS Latest Version")
- Priority: A priority number for the rule (e.g. 100)
- Source: Any
- Source port ranges: *
- Destination: Any
- Destination port ranges: 443
- Protocol: TCP
- Action: Allow
- Priority: 100

Step 7: Click on "Review + create" and then click on "Create" to create the new inbound security rule.

Step 8: Once the rule is created, it will be automatically applied to the virtual machine.

By following these steps, you have successfully remediated the TLS Protocol Latest Version misconfiguration in Azure using the Azure console.

#### Using CLI

To remediate the TLS protocol version misconfiguration in Azure using Azure CLI, you can follow the below steps:

1. Open the Azure CLI on your local machine or Azure Cloud Shell.

2. Run the following command to check the TLS protocol version:

   ```
   az webapp config ssl list --resource-group <resource_group_name> --name <app_name> --query "[].{protocolVersion:protocols[0].protocol}" --output table
   ```

   This command will list the TLS protocol version of the specified App Service.

3. If the TLS protocol version is not the latest version, you can update it by running the following command:

   ```
   az webapp config ssl update --resource-group <resource_group_name> --name <app_name> --protocols 'TLSv1.2'
   ```

   This command will update the TLS protocol version to the latest version (TLSv1.2).

4. After running the above command, you can verify the TLS protocol version again by running the first command mentioned above.

   ```
   az webapp config ssl list --resource-group <resource_group_name> --name <app_name> --query "[].{protocolVersion:protocols[0].protocol}" --output table
   ```

   This command should now display the updated TLS protocol version.

By following these steps, you can remediate the TLS protocol version misconfiguration in Azure using Azure CLI.

#### Using Python

To remediate the TLS Protocol Latest Version misconfiguration in AZURE using Python, follow these steps:

1. Identify the resources that are affected by the misconfiguration. This can be done by using the Azure CLI command `az resource list`.

2. For each affected resource, check if the TLS protocol version is up to date. This can be done by using the `requests` library in Python to make a test request to the resource using the `TLSv1_2` protocol. If the request succeeds, then the TLS protocol version is up to date. If the request fails, then the TLS protocol version is not up to date.

3. If the TLS protocol version is not up to date, update the resource to use the latest TLS protocol version. This can be done by using the Azure Python SDK to update the resource's configuration. The specific steps will depend on the type of resource that is affected.

4. After updating the resource, verify that the TLS protocol version is up to date by repeating step 2.

Here is a sample Python code that can be used to check and remediate the TLS Protocol Latest Version misconfiguration for Azure Web Apps:

```python
import requests
from azure.identity import DefaultAzureCredential
from azure.mgmt.web import WebSiteManagementClient

# Set the Azure subscription ID, resource group name, and web app name
subscription_id = 'your-subscription-id'
resource_group_name = 'your-resource-group-name'
web_app_name = 'your-web-app-name'

# Authenticate using the default Azure credentials
credential = DefaultAzureCredential()

# Create the Azure Web Apps management client
web_client = WebSiteManagementClient(credential, subscription_id)

# Get the web app resource ID
web_app = web_client.web_apps.get(resource_group_name, web_app_name)
web_app_id = web_app.id

# Check if the TLS protocol version is up to date
test_url = f'https://{web_app_name}.azurewebsites.net'
response = requests.get(test_url, verify=False)
if response.status_code == 200:
    print('TLS protocol version is up to date')
else:
    print('TLS protocol version is not up to date')

    # Update the web app to use the latest TLS protocol version
    web_app_config = web_client.web_apps.get_configuration(resource_group_name, web_app_name)
    web_app_config.min_tls_version = '1.2'
    web_client.web_apps.update_configuration(resource_group_name, web_app_name, web_app_config)

    # Verify that the TLS protocol version is up to date
    response = requests.get(test_url, verify=False)
    if response.status_code == 200:
        print('TLS protocol version has been updated')
    else:
        print('Failed to update TLS protocol version')
```




</Tab>
</Tabs>