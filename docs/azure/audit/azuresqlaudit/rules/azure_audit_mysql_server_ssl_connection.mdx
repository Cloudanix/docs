---
slug: azure_audit_mysql_server_ssl_connection
title: MySQL Database Server Should Enforce SSL Connection
sidebar_label: MySQL Database Server Should Enforce SSL Connection
---

### More Info:

MySQL Database Server should have enforce ssl connection enabled

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, ISO27001, CISAZURE, CBP, HITRUST, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal (https://portal.azure.com/) and sign in with your Azure account credentials.

2. Navigate to SQL databases: From the left-hand menu, select "SQL databases". This will display a list of all SQL databases in your Azure environment.

3. Select the database: Click on the name of the database for which you want to check the SSL connection enforcement. This will open the database's dashboard.

4. Check SSL settings: From the database dashboard, select "Connection security" under the "Security" section. Here, you can see whether "Enforce SSL connection" is enabled or not. If it's enabled, it means that the MySQL Database Server is enforcing SSL Connection. If it's not enabled, it means that the server is not enforcing SSL Connection.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install the Azure CLI on your local machine. You can download it from the official Microsoft Azure website. Once installed, open your command prompt or terminal.

2. Login to Azure: Use the following command to log in to your Azure account. You will be prompted to enter your username and password.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, select the subscription where your SQL server resides. Replace 'your-subscription-id' with your actual subscription id.
   ```
   az account set --subscription 'your-subscription-id'
   ```
4. Check SSL enforcement: Use the following command to check if SSL is enforced on your MySQL server. Replace 'your-resource-group' and 'your-server-name' with your actual resource group and server name. The command will return the server parameters including 'sslEnforcement', if it's 'Enabled' then SSL is enforced, otherwise, it's not.
   ```
   az mysql server show --resource-group 'your-resource-group' --name 'your-server-name' --query 'sslEnforcement'
   ```

#### Using Python

1. AWS RDS:
   - First, you need to install boto3, the AWS SDK for Python, using pip.
   ```python
   pip install boto3
   ```
   - Then, you can use the following Python script to check if SSL is enforced on your RDS instances.
   ```python
   import boto3

   client = boto3.client('rds')

   response = client.describe_db_instances()

   for r in response['DBInstances']:
       if r['Engine'] == 'mysql' and r['CACertificateIdentifier'] != 'rds-ca-2019':
           print(f"RDS instance {r['DBInstanceIdentifier']} does not enforce SSL connection.")
   ```
2. Azure SQL Database:
   - First, you need to install azure-mgmt-sql, the Azure SDK for Python, using pip.
   ```python
   pip install azure-mgmt-sql
   ```
   - Then, you can use the following Python script to check if SSL is enforced on your SQL databases.
   ```python
   from azure.mgmt.sql import SqlManagementClient
   from azure.identity import DefaultAzureCredential

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   sql_client = SqlManagementClient(credential, subscription_id)

   for server in sql_client.servers.list():
       server_name = server.name
       resource_group = server.id.split('/')[4]
       server_azure_ad_admin = sql_client.server_azure_ad_administrators.get(resource_group, server_name)
       if server_azure_ad_admin.login != 'Active Directory Admin':
           print(f"SQL Server {server_name} does not enforce SSL connection.")
   ```
3. Google Cloud SQL:
   - First, you need to install google-cloud-sql, the Google Cloud SDK for Python, using pip.
   ```python
   pip install google-cloud-sql
   ```
   - Then, you can use the following Python script to check if SSL is enforced on your Cloud SQL instances.
   ```python
   from google.cloud import sql

   client = sql.SqlInstancesServiceClient()

   project_id = 'your-project-id'
   instances = client.list(project=project_id)

   for instance in instances:
       if instance.database_version != sql.SqlInstancesServiceClient.DatabaseVersion.MYSQL_5_7:
           print(f"Cloud SQL instance {instance.name} does not enforce SSL connection.")
   ```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the MySQL Database Server Should Enforce SSL Connection misconfiguration in Azure using the Azure console:

1. Log in to the Azure portal (https://portal.azure.com/).

2. Navigate to the Azure Database for MySQL server that you want to remediate.

3. Click on the "Connection security" option under the "Security" section in the left-hand menu.

4. In the "Connection security" section, toggle the "Enforce SSL connection" option to "Enabled".

5. Click the "Save" button at the top of the page to save the changes.

6. Once the changes are saved, the MySQL database server will now enforce SSL connections.

That's it! By following these steps, you have successfully remediated the MySQL Database Server Should Enforce SSL Connection misconfiguration in Azure using the Azure console.

#### Using CLI

To remediate the MySQL Database Server Should Enforce SSL Connection misconfiguration in Azure using Azure CLI, you can follow the below steps:

1. Open the Azure CLI and log in to your Azure account using the command `az login`.

2. Once you are logged in, select the Azure subscription that contains your MySQL database by using the command `az account set --subscription <subscription_id>`.

3. Next, retrieve the resource ID of your MySQL server using the command `az mysql server list --resource-group <resource_group_name> --query [0].id --output tsv`.

4. Now, enable SSL enforcement for the MySQL server by running the command `az mysql server update --resource-group <resource_group_name> --name <mysql_server_name> --ssl-enforcement Enabled`.

5. Finally, verify that SSL enforcement is enabled by running the command `az mysql server show --resource-group <resource_group_name> --name <mysql_server_name> --query sslEnforcement`.

If the output of the above command is "Enabled", then SSL enforcement has been successfully enabled for your MySQL server in Azure.

#### Using Python

To remediate the misconfiguration of MySQL Database Server Should Enforce SSL Connection in AZURE, you can follow the below steps using Python:

1. First, you need to install the 'azure-mgmt-rdbms' package. You can install it using the following command:

```
pip install azure-mgmt-rdbms
```

2. Next, you need to authenticate to your Azure account. You can use the following code to authenticate:

```python
from azure.common.credentials import ServicePrincipalCredentials

# Replace the values with your own
subscription_id = 'your_subscription_id'
client_id = 'your_client_id'
secret = 'your_client_secret'
tenant = 'your_tenant_id'

credentials = ServicePrincipalCredentials(
    client_id=client_id,
    secret=secret,
    tenant=tenant
)
```

3. After authentication, you need to create a client object for the Azure Database for MySQL server. You can use the following code to create the client object:

```python
from azure.mgmt.rdbms.mysql import MySQLManagementClient
from azure.mgmt.rdbms.mysql.models import ServerForUpdate

# Replace the values with your own
resource_group_name = 'your_resource_group_name'
server_name = 'your_server_name'
location = 'your_server_location'

client = MySQLManagementClient(
    credentials=credentials,
    subscription_id=subscription_id
)

server = client.servers.get(resource_group_name, server_name)
```

4. Once you have the client object, you can update the server configuration to enforce SSL connection. You can use the following code to update the server configuration:

```python
server.ssl_enforcement = 'Enabled'

server_for_update = ServerForUpdate(
    ssl_enforcement=server.ssl_enforcement
)

client.servers.begin_create_or_update(
    resource_group_name=resource_group_name,
    server_name=server_name,
    parameters=server_for_update
)
```

5. Finally, you can verify if the SSL connection is enforced by checking the server configuration. You can use the following code to check the server configuration:

```python
server = client.servers.get(resource_group_name, server_name)

if server.ssl_enforcement == 'Enabled':
    print('SSL connection is enforced')
else:
    print('SSL connection is not enforced')
```

That's it! You have successfully remediated the misconfiguration of MySQL Database Server Should Enforce SSL Connection in Azure using Python.




</Tab>
</Tabs>