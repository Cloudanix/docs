---
slug: azure_audit_check_sql_server_automatic_tuning
title: Enable Automatic Tuning For SQL Database Servers
sidebar_label: Enable Automatic Tuning For SQL Database Servers
---

### More Info:

Enable automatic tuning for Microsoft Azure SQL servers in order to monitor database queries and improve database workload performance. Automatic Tuning is a built-in intelligence feature that automatically tunes your Azure SQL databases to optimize their performance.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, SOC2


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal using your credentials.
2. Navigate to the SQL databases section from the left-hand side menu. Here, you will see a list of all your SQL databases.
3. Click on the SQL database server for which you want to check the Automatic Tuning settings. This will open the dashboard for that particular SQL database server.
4. In the database server dashboard, look for the "Automatic Tuning" option under the "Settings" section. Click on it. If Automatic Tuning is enabled, you will see the status as "On". If it's not enabled, the status will be "Off".

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI to detect misconfigurations, you need to install it. You can download it from the official Microsoft website and install it on your local machine. 

2. Login to Azure: After installing Azure CLI, open your command prompt or terminal and type the following command to login to your Azure account:

   ```
   az login
   ```
   Follow the instructions on the screen to complete the login process.

3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where your SQL Database Server is located. Use the following command to list all your subscriptions:

   ```
   az account list --output table
   ```
   Then, use the following command to set your desired subscription:

   ```
   az account set --subscription "Your Subscription Name"
   ```

4. Check Automatic Tuning: Now, you can check if Automatic Tuning is enabled for your SQL Database Server. Use the following command:

   ```
   az sql server auto-tuning show --resource-group "Your Resource Group Name" --server "Your Server Name"
   ```
   This command will return the current Automatic Tuning settings for your SQL Database Server. If Automatic Tuning is enabled, the "desiredState" field will be "Enabled". If it's not, then there is a misconfiguration.

#### Using Python

To check if Automatic Tuning is enabled for SQL Database Servers in Azure, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: You need to install the Azure SDK for Python if it's not already installed. You can install it using pip:
   ```
   pip install azure-mgmt-sql
   ```

2. **Authenticate to Azure**: Before you can interact with Azure resources, you need to authenticate. You can use Azure Identity library for this. Here is a sample code snippet:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.sql import SqlManagementClient

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   sql_client = SqlManagementClient(credential, subscription_id)
   ```

3. **List all SQL Servers**: Now, you can list all SQL servers in your subscription and check if Automatic Tuning is enabled. Here is a sample code snippet:
   ```python
   for server in sql_client.servers.list():
       server_name = server.name
       resource_group = server.additional_properties['resourceGroup']
       tuning_settings = sql_client.server_azure_ad_administrators.get(resource_group, server_name)
       print(f"Server: {server_name}, Automatic Tuning: {tuning_settings}")
   ```

4. **Check Automatic Tuning Status**: The above code will print the Automatic Tuning status for each SQL server. If the status is 'True', it means Automatic Tuning is enabled. If it's 'False', it means Automatic Tuning is not enabled.

Please replace 'your-subscription-id' with your actual Azure subscription ID. Also, make sure you have the necessary permissions to list SQL servers and get Automatic Tuning settings.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Enable Automatic Tuning for SQL Database Servers" in Azure using the Azure console, follow these steps:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Navigate to the SQL databases page.
3. Select the SQL database server that needs to be remediated.
4. Click on the "Automatic tuning" option in the left-hand menu.
5. Click on the "Configure" button to enable automatic tuning for the server.
6. In the "Automatic tuning" pane, select the "Basic" option to enable automatic tuning for all databases on the server.
7. Click on the "Apply" button to save the changes.

Once you have completed these steps, automatic tuning will be enabled for the selected SQL database server, which will help optimize query performance and improve overall database performance.

#### Using CLI

To remediate the misconfiguration "Enable Automatic Tuning For SQL Database Servers" for AZURE using AZURE CLI, you can follow the below steps:

Step 1: Open the Azure CLI in your system or use the Azure Cloud Shell.

Step 2: Run the following command to enable automatic tuning for a specific database server:

```
az sql server configuration set --name automaticTuning --resource-group <resource_group_name> --server <server_name> --value Enabled
```

Note: Replace `<resource_group_name>` with the name of the resource group where your database server is located and `<server_name>` with the name of your database server.

Step 3: If you want to enable automatic tuning for all the database servers in your subscription, run the following command:

```
az sql server configuration set --name automaticTuning --value Enabled --subscription <subscription_id>
```

Note: Replace `<subscription_id>` with the ID of your subscription.

Step 4: After running the above command, automatic tuning will be enabled for your SQL database servers, and Azure will automatically tune your database to improve its performance.

That's it! You have successfully remediated the misconfiguration "Enable Automatic Tuning For SQL Database Servers" for AZURE using AZURE CLI.

#### Using Python

To remediate the misconfiguration of enabling automatic tuning for SQL database servers in Azure using Python, you can follow the below steps:

1. Install the Azure SDK for Python using the following command:

   ```
   pip install azure-mgmt-sql
   ```

2. Authenticate and create a client object to interact with the Azure SQL Database using the following code:

   ```python
   from azure.common.credentials import ServicePrincipalCredentials
   from azure.mgmt.sql import SqlManagementClient
   
   subscription_id = 'your_subscription_id'
   credentials = ServicePrincipalCredentials(
       client_id='your_client_id',
       secret='your_client_secret',
       tenant='your_tenant_id'
   )
   
   sql_client = SqlManagementClient(credentials, subscription_id)
   ```

3. Get the resource group and server name where the SQL database is located using the following code:

   ```python
   resource_group_name = 'your_resource_group_name'
   server_name = 'your_server_name'
   ```

4. Enable automatic tuning for the SQL database server using the following code:

   ```python
   from azure.mgmt.sql.models import ServerAutomaticTuningProperties
   
   sql_client.servers.create_or_update(
       resource_group_name=resource_group_name,
       server_name=server_name,
       parameters={
           'properties': {
               'automatic_tuning': {
                   'state': 'Enabled',
                   'options': {
                       'createIndex': 'Auto',
                       'dropIndex': 'Auto',
                       'forceLastGoodPlan': 'Enabled'
                   }
               }
           }
       }
   )
   ```

   In the above code, we are setting the state of automatic tuning to 'Enabled' and also setting the options for createIndex, dropIndex, and forceLastGoodPlan to 'Auto', 'Auto', and 'Enabled' respectively.

5. Verify the automatic tuning is enabled for the SQL database server using the following code:

   ```python
   server = sql_client.servers.get(resource_group_name, server_name)
   print(server.properties.automatic_tuning.state)
   ```

   This will print the current state of automatic tuning for the SQL database server.

By following the above steps, you can remediate the misconfiguration of enabling automatic tuning for SQL database servers in Azure using Python.




</Tab>
</Tabs>