

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal and navigate to the SQL databases section.
2. Select the SQL database for which you want to check the Infrastructure Double Encryption status.
3. In the SQL database blade, under the 'Security' section, click on 'Transparent Data Encryption'.
4. Here, you can see the status of Infrastructure Double Encryption. If it is enabled, it will show 'On'. If not, it will show 'Off'.

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to have the Azure CLI installed on your system. You can download and install it from the official Microsoft Azure website.

2. Login to Azure: Use the following command to login to your Azure account. You will be prompted to enter your login credentials.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, select the subscription where the SQL Server is located using the following command. Replace 'your-subscription-id' with your actual subscription id.
   ```
   az account set --subscription 'your-subscription-id'
   ```
4. Check Infrastructure Double Encryption: Use the following command to check the status of Infrastructure Double Encryption for a specific SQL Server. Replace 'your-resource-group' with the name of your resource group and 'your-server-name' with the name of your SQL Server.
   ```
   az sql server tde-settings show --resource-group 'your-resource-group' --server 'your-server-name' --name current
   ```
   In the output, look for the "status" field. If it is set to "Enabled", then Infrastructure Double Encryption is enabled. If it is set to "Disabled", then Infrastructure Double Encryption is not enabled.

#### Using Python

To check if Infrastructure Double Encryption is enabled in Azure SQL Database using Python, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: You can install the Azure SDK for Python using pip. Run the following command in your terminal:
   ```
   pip install azure-mgmt-sql
   ```
2. **Authenticate to Azure**: Before you can interact with Azure resources, you need to authenticate using a Service Principal. You can create a Service Principal and get the credentials (tenant id, client id, and client secret) from the Azure portal. Use these credentials to authenticate as shown below:
   ```python
   from azure.common.credentials import ServicePrincipalCredentials

   credentials = ServicePrincipalCredentials(
       tenant=YOUR_TENANT_ID,
       client_id=YOUR_CLIENT_ID,
       secret=YOUR_CLIENT_SECRET,
   )
   ```
3. **Initialize SQL Management Client**: After authenticating, you can initialize the SQL Management Client which allows you to interact with Azure SQL Database.
   ```python
   from azure.mgmt.sql import SqlManagementClient

   sql_client = SqlManagementClient(credentials, YOUR_SUBSCRIPTION_ID)
   ```
4. **Check Infrastructure Double Encryption**: Now, you can use the SQL Management Client to check if Infrastructure Double Encryption is enabled for a specific SQL Server and database.
   ```python
   server = sql_client.servers.get(YOUR_RESOURCE_GROUP, YOUR_SERVER_NAME)
   database = sql_client.databases.get(YOUR_RESOURCE_GROUP, YOUR_SERVER_NAME, YOUR_DATABASE_NAME)

   if database.transparent_data_encryption_activity.status == 'Enabled':
       print("Infrastructure Double Encryption is enabled.")
   else:
       print("Infrastructure Double Encryption is not enabled.")
   ```
Please replace `YOUR_TENANT_ID`, `YOUR_CLIENT_ID`, `YOUR_CLIENT_SECRET`, `YOUR_SUBSCRIPTION_ID`, `YOUR_RESOURCE_GROUP`, `YOUR_SERVER_NAME`, and `YOUR_DATABASE_NAME` with your actual Azure details.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Enable Infrastructure Double Encryption" in Azure using Azure Console, follow the below steps:

1. Login to the Azure Portal (https://portal.azure.com/)
2. Click on the "Virtual machines" option from the left-hand menu.
3. Select the virtual machine that you want to remediate.
4. Click on the "Disks" option from the left-hand menu.
5. Select the disk that you want to remediate.
6. Click on the "Disk Encryption" option from the left-hand menu.
7. Click on the "Enable encryption" button.
8. Select the key vault that you want to use for encryption.
9. Click on the "Save" button to enable encryption.

By following these steps, you can remediate the misconfiguration "Enable Infrastructure Double Encryption" in Azure using Azure Console.

#### Using CLI

To remediate the misconfiguration of enabling infrastructure double encryption in AZURE using AZURE CLI, please follow the below steps:

1. Open the AZURE CLI in your terminal or command prompt.
2. Login to your AZURE account using the command "az login".
3. Select the subscription in which the infrastructure needs to be double encrypted using the command `az account set --subscription <subscription-id>`
4. Enable the infrastructure double encryption by creating a new storage account with encryption enabled using the command `az storage account create --name <storage-account-name> --resource-group <resource-group-name> --location <location> --sku Standard_LRS --encryption-services blob --encryption blob`.
5. Verify that the infrastructure double encryption is enabled by checking the encryption status of the storage account using the command `az storage account show --name <storage-account-name> --resource-group <resource-group-name> --query "encryption.services.blob.enabled"`.

By doing the above steps, you have successfully remediated the misconfiguration of enabling infrastructure double encryption in AZURE using AZURE CLI.

#### Using Python

To enable Infrastructure Double Encryption in Azure using Python, you can follow these steps:

1. Install the Azure SDK for Python using pip:

   ```
   pip install azure-mgmt-storage
   ```

2. Import the necessary modules:

   ```python
   from azure.common.credentials import ServicePrincipalCredentials
   from azure.mgmt.storage import StorageManagementClient
   from azure.mgmt.storage.models import StorageAccountUpdateParameters
   from azure.mgmt.storage.models import Encryption
   from azure.mgmt.storage.models import EncryptionService
   from azure.mgmt.storage.models import EncryptionServiceType
   ```

3. Set up the Azure credentials:

   ```python
   credentials = ServicePrincipalCredentials(
       client_id='<client-id>',
       secret='<client-secret>',
       tenant='<tenant-id>'
   )
   ```

4. Create a StorageManagementClient object:

   ```python
   storage_client = StorageManagementClient(credentials, subscription_id)
   ```

5. Get the storage account that you want to enable Infrastructure Double Encryption for:

   ```python
   storage_account = storage_client.storage_accounts.get_properties(resource_group_name, account_name)
   ```

6. Create an Encryption object with the necessary properties:

   ```python
   encryption = Encryption(
       services=[
           EncryptionService(
               service=EncryptionServiceType.blob,
               enabled=True
           ),
           EncryptionService(
               service=EncryptionServiceType.file,
               enabled=True
           )
       ]
   )
   ```

7. Create a StorageAccountUpdateParameters object with the Encryption object:

   ```python
   update_params = StorageAccountUpdateParameters(
       encryption=encryption
   )
   ```

8. Update the storage account with the StorageAccountUpdateParameters object:

   ```python
   storage_client.storage_accounts.update(resource_group_name, account_name, update_params)
   ```

These steps will enable Infrastructure Double Encryption for the specified storage account in Azure using Python.


</Tab>
</Tabs>