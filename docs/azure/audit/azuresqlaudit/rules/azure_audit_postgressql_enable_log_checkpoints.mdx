---
slug: azure_audit_postgressql_enable_log_checkpoints
title: Enable "LOG_CHECKPOINTS" Parameter for PostgreSQL Servers
sidebar_label: Enable "LOG_CHECKPOINTS" Parameter for PostgreSQL Servers
---

### More Info:

Ensure that "log_checkpoints" server parameter is enabled for all PostgreSQL database servers available within your Microsoft Azure cloud account. The "log_checkpoints" parameter allows checkpoints and restart points to be logged in the Azure PostgreSQL server log.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAZURE, CBP, HITRUST, SOC2, NISTCSF, PCIDSS


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Open your web browser, navigate to the Azure portal (https://portal.azure.com/) and sign in with your Azure account credentials.

2. Navigate to PostgreSQL servers: On the Azure portal, click on "All Services" in the left-hand menu. In the "All Services" box, type "PostgreSQL servers" in the search bar and select it from the dropdown menu.

3. Select the PostgreSQL server: You will see a list of all PostgreSQL servers in your Azure account. Click on the name of the server for which you want to check the "LOG_CHECKPOINTS" parameter.

4. Check the "LOG_CHECKPOINTS" parameter: In the server dashboard, click on "Server parameters" under the "Settings" section. In the "Server parameters" page, type "log_checkpoints" in the search bar and press enter. If the "LOG_CHECKPOINTS" parameter is enabled, its value will be set to "ON". If it's not enabled, its value will be set to "OFF".

#### Using CLI

1. Install Azure CLI: Before you can use the Azure CLI commands, you need to have the Azure CLI installed on your system. You can download it from the official Azure website and install it on your system.

2. Login to Azure: Use the following command to login to your Azure account. You will be prompted to enter your username and password.
   ```
   az login
   ```
3. Select the Subscription: If you have multiple subscriptions, you need to select the subscription where your PostgreSQL server is located. Use the following command to set the subscription.
   ```
   az account set --subscription "Your_Subscription_Name"
   ```
4. Check the "LOG_CHECKPOINTS" Parameter: Use the following command to check the "LOG_CHECKPOINTS" parameter for your PostgreSQL server. Replace "Your_Server_Name" and "Your_Resource_Group" with your actual server name and resource group.
   ```
   az postgres server configuration show --name log_checkpoints --resource-group Your_Resource_Group --server-name Your_Server_Name --query value
   ```
   If the output of this command is "off", then the "LOG_CHECKPOINTS" parameter is not enabled. If the output is "on", then the parameter is enabled.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. For this task, you will need the `psycopg2` library to connect to the PostgreSQL server and the `pandas` library to handle the data. You can install these libraries using pip:

```python
pip install psycopg2-binary pandas
```

2. Connect to the PostgreSQL server: After installing the necessary libraries, you can write a Python script to connect to the PostgreSQL server. You will need the server name, database name, username, and password to establish the connection.

```python
import psycopg2

def create_conn():
    conn = psycopg2.connect(
        host="your_host",
        database="your_database",
        user="your_username",
        password="your_password"
    )
    return conn
```

3. Query the PostgreSQL server: Once the connection is established, you can query the PostgreSQL server to check if the "LOG_CHECKPOINTS" parameter is enabled. You can do this by executing the `SHOW log_checkpoints;` command.

```python
def check_log_checkpoints(conn):
    cur = conn.cursor()
    cur.execute("SHOW log_checkpoints;")
    result = cur.fetchone()
    return result[0]
```

4. Check the result: Finally, you can check the result of the query. If the "LOG_CHECKPOINTS" parameter is enabled, the result will be 'on'. If it's not enabled, the result will be 'off'.

```python
def main():
    conn = create_conn()
    log_checkpoints_status = check_log_checkpoints(conn)
    if log_checkpoints_status == 'on':
        print("LOG_CHECKPOINTS parameter is enabled.")
    else:
        print("LOG_CHECKPOINTS parameter is not enabled.")

if __name__ == "__main__":
    main()
```

This script will print whether the "LOG_CHECKPOINTS" parameter is enabled or not.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of enabling "LOG_CHECKPOINTS" parameter for PostgreSQL servers in Azure, you can follow the below steps:

1. Open the Azure portal and navigate to the Azure Database for PostgreSQL service.

2. Select the PostgreSQL server for which you want to enable the "LOG_CHECKPOINTS" parameter.

3. Click on the "Configuration" option in the left-hand menu.

4. Under the "Settings" tab, scroll down to the "Custom" section and click on the "+ Add" button.

5. In the "Add Configuration Parameter" window, enter "log_checkpoints" in the "Name" field and "on" in the "Value" field.

6. Click on the "OK" button to save the configuration parameter.

7. Restart the PostgreSQL server for the changes to take effect.

After completing these steps, the "LOG_CHECKPOINTS" parameter will be enabled for the PostgreSQL server in Azure.

#### Using CLI

To remediate the "LOG_CHECKPOINTS" parameter misconfiguration for PostgreSQL servers in Azure using Azure CLI, you can follow these steps:

1. Open the Azure CLI on your local machine or through the Azure portal.

2. Run the following command to log in to your Azure account:
```
az login
```

3. Once you are logged in, run the following command to list all the available PostgreSQL servers in your Azure account:
```
az postgres server list
```

4. Choose the server that you want to remediate and run the following command to get the current configuration settings:
```
az postgres server configuration list --resource-group <resource-group-name> --server-name <server-name>
```
Make sure to replace `<resource-group-name>` and `<server-name>` with the actual names of your resource group and server.

5. Identify whether the "LOG_CHECKPOINTS" parameter is set to "off" or not in the output of the above command.

6. If the "LOG_CHECKPOINTS" parameter is set to "off", run the following command to update the configuration and enable it:
```
az postgres server configuration set --resource-group <resource-group-name> --server-name <server-name> --name log_checkpoints --value on
```
Again, replace `<resource-group-name>` and `<server-name>` with the actual names of your resource group and server.

7. Verify the updated configuration by running the command in step 4 again.

8. Repeat steps 5-7 for any other PostgreSQL servers that have the "LOG_CHECKPOINTS" parameter misconfiguration.

By following these steps, you can remediate the "LOG_CHECKPOINTS" parameter misconfiguration for PostgreSQL servers in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration of enabling the "LOG_CHECKPOINTS" parameter for PostgreSQL servers in Azure using Python, you can follow the below steps:

1. First, you need to connect to the Azure PostgreSQL server using the `psycopg2` library in Python. You can install it using the following command:

   ```
   !pip install psycopg2-binary
   ```

2. Once you have installed the `psycopg2` library, you can use the following code snippet to connect to the Azure PostgreSQL server:

   ```
   import psycopg2
   
   conn = psycopg2.connect(
       host="your_server_name.postgres.database.azure.com",
       database="your_database_name",
       user="your_username@your_server_name",
       password="your_password"
   )
   ```

   Replace the `<your_server_name>`, `<your_database_name>`, `<your_username>`, and `<your_password>` with your actual server details.

3. After connecting to the Azure PostgreSQL server, you can execute the following SQL query to enable the "LOG_CHECKPOINTS" parameter:

   ```
   with conn.cursor() as cur:
       cur.execute("ALTER SYSTEM SET log_checkpoints = on;")
       conn.commit()
   ```

   This query will enable the "LOG_CHECKPOINTS" parameter for the Azure PostgreSQL server.

4. Finally, you can close the connection to the Azure PostgreSQL server using the following code:

   ```
   conn.close()
   ```

   This will close the connection to the Azure PostgreSQL server.

By following the above steps, you can remediate the misconfiguration of enabling the "LOG_CHECKPOINTS" parameter for PostgreSQL servers in Azure using Python.


</Tab>
</Tabs>