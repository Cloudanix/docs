---
slug: azure_audit_mysql_tls_version
title: Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server
sidebar_label: Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server
---

### More Info:

Ensure TLS version on MySQL flexible servers is set to the default value.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAZURE, CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal (https://portal.azure.com/) and sign in with your Azure account credentials.

2. Navigate to Azure Database for MySQL servers: On the Azure portal, click on "All Services" in the left-hand menu. In the "All Services" box, type "Azure Database for MySQL servers" in the search bar and select it.

3. Select the MySQL server: In the "Azure Database for MySQL servers" page, select the MySQL server for which you want to check the TLS version.

4. Check the TLS version: In the MySQL server page, click on "Connection security" under the "Security" section in the left-hand menu. In the "Connection security" page, look for the "Minimum TLS version" setting. If the "Minimum TLS version" is not set to "TLS1.2", then the MySQL Flexible Database Server is not using the recommended TLS version.

#### Using CLI

1. Install and configure Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine and sign in to your Azure account. You can install Azure CLI by following the instructions provided by Microsoft. Once installed, you can sign in to your Azure account using the following command:

   ```
   az login
   ```

2. List all MySQL Flexible Database Servers: Use the following command to list all MySQL Flexible Database Servers in your Azure account:

   ```
   az mysql flexible-server show --resource-group MyResourceGroup --name MyServer
   ```

   Replace 'MyResourceGroup' and 'MyServer' with your actual resource group and server names.

3. Check the TLS version: The output of the above command will include a field named 'minimalTlsVersion'. This field indicates the minimum TLS version that the server requires for client connections. If the value of this field is not 'TLS1_2', then the server is not configured to use TLS version 1.2.

4. If you want to check this for all servers, you can use a script like this:

   ```
   servers=$(az mysql flexible-server list --query "[].name" -o tsv)
   for server in $servers
   do
     tls_version=$(az mysql flexible-server show --name $server --query "minimalTlsVersion" -o tsv)
     echo "Server: $server, TLS version: $tls_version"
   done
   ```

   This script first gets a list of all MySQL Flexible Database Servers, and then for each server, it gets the minimal TLS version and prints it.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the Azure SDK for Python. This SDK provides libraries to work with Azure resources. You can install it using pip:

   ```python
   pip install azure-mgmt-sql
   ```

2. Authenticate with Azure: To interact with Azure resources, you need to authenticate your script. You can use Azure Identity library for this. Here is an example of how to authenticate using a service principal:

   ```python
   from azure.identity import ClientSecretCredential
   from azure.mgmt.sql import SqlManagementClient

   tenant_id = "your-tenant-id"
   client_id = "your-client-id"
   client_secret = "your-client-secret"

   credential = ClientSecretCredential(tenant_id, client_id, client_secret)
   sql_client = SqlManagementClient(credential, "your-subscription-id")
   ```

3. List all MySQL Flexible Database Servers: Once authenticated, you can list all MySQL Flexible Database Servers in your subscription:

   ```python
   servers = sql_client.servers.list()
   for server in servers:
       print(server.name)
   ```

4. Check the TLS version: For each server, you can check the TLS version. If it's not set to TLSV1.2, then it's a misconfiguration:

   ```python
   for server in servers:
       server_config = sql_client.servers.get(server.resource_group, server.name)
       if server_config.minimal_tls_version != "TLS1_2":
           print(f"Server {server.name} is misconfigured. TLS version is {server_config.minimal_tls_version}")
   ```

This script will print the name of all MySQL Flexible Database Servers that are not using TLSV1.2.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server" for Azure using Azure console, please follow the below steps:

1. Login to Azure portal (https://portal.azure.com/).
2. Navigate to "Azure Database for MySQL Flexible Server" service.
3. Select the "Flexible server" for which you want to remediate the misconfiguration.
4. Under the "Settings" section, click on "Connection security".
5. Under the "Connection security" tab, select "TLS 1.2" from the "TLS version" drop-down list.
6. Click on the "Save" button to save the changes.

Once you have completed these steps, your Azure MySQL Flexible Server will be configured to use TLS version 1.2 for connection security.

#### Using CLI

To remediate the misconfiguration "Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server" for AZURE using AZURE CLI, you can follow the below steps:

Step 1: Open the AZURE CLI and login to your account using the following command:
```
az login
```

Step 2: Once you are logged in, set the subscription where your MySQL Flexible Database Server is located using the following command:
```
az account set --subscription <subscription_id>
```

Step 3: Next, retrieve the resource ID of your MySQL Flexible Database Server using the following command:
```
az mysql flexible-server list --query "[?name=='<server_name>'].id" -o tsv
```
Replace `<server_name>` with the name of your MySQL Flexible Database Server.

Step 4: Now, update the TLS version to TLSv1.2 for your MySQL Flexible Database Server using the following command:
```
az mysql flexible-server update --name <server_name> --resource-group <resource_group_name> --tls-version "TLSv1.2"
```
Replace `<server_name>` with the name of your MySQL Flexible Database Server and `<resource_group_name>` with the name of the resource group where your MySQL Flexible Database Server is located.

Step 5: Verify that the TLS version has been updated to TLSv1.2 for your MySQL Flexible Database Server using the following command:
```
az mysql flexible-server show --name <server_name> --resource-group <resource_group_name> --query "tlsVersion"
```
Replace `<server_name>` with the name of your MySQL Flexible Database Server and `<resource_group_name>` with the name of the resource group where your MySQL Flexible Database Server is located.

Once you have completed these steps, the misconfiguration "Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server" will be remediated for your AZURE MySQL Flexible Database Server.

#### Using Python

To remediate the misconfiguration "Ensure TLS Version Is Set To TLSV1.2 For MySQL Flexible Database Server" in AZURE using Python, you can use the Azure SDK for Python. Here are the steps to remediate the misconfiguration:

1. Import the required libraries:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.rdbms import MySQLManagementClient
from azure.mgmt.rdbms.models import ServerUpdateParameters
```

2. Set the Azure credentials:

```python
credential = DefaultAzureCredential()
subscription_id = 'your_subscription_id'
resource_group_name = 'your_resource_group_name'
server_name = 'your_server_name'
```

3. Instantiate the MySQLManagementClient:

```python
client = MySQLManagementClient(credential, subscription_id)
```

4. Get the current server configuration:

```python
server = client.servers.get(resource_group_name, server_name)
```

5. Update the server configuration to set TLS version to TLSv1.2:

```python
server_update_params = ServerUpdateParameters(tls_version="TLSv1.2")
client.servers.update(resource_group_name, server_name, server_update_params)
```

6. Verify the updated configuration:

```python
server = client.servers.get(resource_group_name, server_name)
print(server.tls_version)
```

Note: Make sure to replace the placeholders "your_subscription_id", "your_resource_group_name", and "your_server_name" with your actual values. Also, make sure to authenticate the Azure credentials before running the code.


### Additional Reading:

- [https://docs.microsoft.com/en-us/azure/mysql/concepts-ssl-connection-security](https://docs.microsoft.com/en-us/azure/mysql/concepts-ssl-connection-security) 


</Tab>
</Tabs>