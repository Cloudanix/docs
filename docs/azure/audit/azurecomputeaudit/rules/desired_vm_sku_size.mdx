---
slug: desired_vm_sku_size
title: Check For Desired VM SKU Size
sidebar_label: Check For Desired VM SKU Size
---

### More Info:

Determine if the virtual machine (VM) instances provisioned within your Azure cloud account have the desired SKU size(s) established by your organization based on the workload deployed. The desired SKU size(s) must be defined in the conformity rule settings, on the Trend Micro Cloud One™ – Conformity account console

### Risk Level

High

### Address

Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to portal.azure.com and sign in with your Azure account credentials.

2. Navigate to Virtual Machines: Once you are logged in, click on the "Virtual Machines" option from the left-hand side menu. This will display a list of all the virtual machines that are currently running in your Azure environment.

3. Check VM SKU Size: Click on the name of the VM for which you want to check the SKU size. This will open the VM's dashboard. Under the "Settings" section, click on "Size". This will display the current SKU size of the VM.

4. Compare with Desired SKU Size: Compare the current SKU size with the desired SKU size. If they do not match, it indicates a misconfiguration.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install the Azure CLI on your local machine. You can download it from the official Microsoft Azure website. Once installed, open your command prompt or terminal and type `az login` to log in to your Azure account.

2. List Available VM Sizes: To check for the desired VM SKU size, you need to list all the available VM sizes in your region. Use the following command to do so:

    ```
    az vm list-sizes --location <location> --output table
    ```
    Replace `<location>` with your Azure region, for example, `westus`. This command will display a table with all the available VM sizes in your specified region.

3. Check VM Size of a Specific VM: If you want to check the VM size of a specific VM, you can use the following command:

    ```
    az vm show --resource-group <resource-group-name> --name <vm-name> --query hardwareProfile.vmSize
    ```
    Replace `<resource-group-name>` with the name of your resource group and `<vm-name>` with the name of your VM. This command will display the VM size of the specified VM.

4. Check VM Size of All VMs: If you want to check the VM size of all VMs in a specific resource group, you can use the following command:

    ```
    az vm list --resource-group <resource-group-name> --query "[].{Name:name, VMSize:hardwareProfile.vmSize}" --output table
    ```
    Replace `<resource-group-name>` with the name of your resource group. This command will display a table with the names and VM sizes of all VMs in the specified resource group.

#### Using Python

To check for the desired VM SKU size in Compute using Python scripts, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: You need to install the Azure SDK for Python to interact with Azure resources. You can install it using pip:
   ```
   pip install azure-mgmt-compute
   ```
2. **Authenticate to Azure**: Before you can interact with Azure resources, you need to authenticate. You can use Azure Identity library for this. Here is a sample code snippet:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.compute import ComputeManagementClient

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   compute_client = ComputeManagementClient(credential, subscription_id)
   ```
3. **List all VMs and their SKUs**: You can list all the VMs and their SKUs using the `virtual_machines` property of the `ComputeManagementClient` object. Here is a sample code snippet:
   ```python
   for vm in compute_client.virtual_machines.list_all():
       print(f"VM Name: {vm.name}, VM SKU: {vm.hardware_profile.vm_size}")
   ```
4. **Check for desired VM SKU size**: You can check if the VM SKU size matches your desired SKU size. Here is a sample code snippet:
   ```python
   desired_sku = 'Standard_D2s_v3'
   for vm in compute_client.virtual_machines.list_all():
       if vm.hardware_profile.vm_size != desired_sku:
           print(f"VM {vm.name} does not have the desired SKU size. Current SKU: {vm.hardware_profile.vm_size}")
   ```
This script will print the names of all VMs that do not have the desired SKU size.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "Check for desired VM SKU size" in Azure using the Azure console:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Navigate to the virtual machine that needs to be checked for the desired VM SKU size.
3. Click on the virtual machine to open its details page.
4. From the left-hand side menu, select "Size".
5. Check if the VM SKU size is set to the desired size. If not, select the desired size from the list of available sizes.
6. Click on "Resize" to apply the changes.

That's it. By following these steps, you will be able to remediate the misconfiguration "Check for desired VM SKU size" in Azure using the Azure console.

#### Using CLI

Sure, here are the step-by-step instructions to remediate the "Check for desired VM SKU size" misconfiguration in Azure using Azure CLI:

1. Firstly, you need to identify the desired VM SKU size. You can do this by checking the requirements of your application or workload that will be running on the VM.

2. Once you have identified the desired VM SKU size, you need to check the current VM SKU size of the virtual machine. You can do this by running the following command in Azure CLI:

   `az vm show --resource-group <resource-group-name> --name <vm-name> --query hardwareProfile.vmSize`

   Replace `<resource-group-name>` with the name of the resource group where the virtual machine is located, and `<vm-name>` with the name of the virtual machine.

3. Compare the current VM SKU size with the desired VM SKU size. If they are different, proceed to the next step.

4. To change the VM SKU size, run the following command in Azure CLI:

   `az vm resize --resource-group <resource-group-name> --name <vm-name> --size <desired-vm-size>`

   Replace `<resource-group-name>` with the name of the resource group where the virtual machine is located, `<vm-name>` with the name of the virtual machine, and `<desired-vm-size>` with the desired VM SKU size.

5. Wait for the VM resize operation to complete. You can check the status of the operation by running the following command:

   `az vm show --resource-group <resource-group-name> --name <vm-name> --query provisioningState`

   The command will return "Succeeded" once the operation is completed.

6. Finally, verify that the VM SKU size has been changed to the desired size by running the following command:

   `az vm show --resource-group <resource-group-name> --name <vm-name> --query hardwareProfile.vmSize`

   The command should return the desired VM SKU size.

That's it! You have now successfully remediated the "Check for desired VM SKU size" misconfiguration in Azure using Azure CLI.

#### Using Python

To check for desired VM SKU size misconfiguration in Azure using Python, you can use Azure SDK for Python. The following steps can be followed to remediate this issue:

1. Install the Azure SDK for Python using pip:

```
pip install azure-mgmt-compute
```

2. Import the necessary libraries:

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient
```

3. Authenticate to Azure using the DefaultAzureCredential:

```python
credential = DefaultAzureCredential()
subscription_id = '<your-subscription-id>'
compute_client = ComputeManagementClient(credential, subscription_id)
```

4. Get the list of virtual machines in the specified resource group:

```python
resource_group_name = '<your-resource-group-name>'
vm_list = compute_client.virtual_machines.list(resource_group_name)
```

5. For each virtual machine in the list, check if the SKU size matches the desired size:

```python
desired_size = '<your-desired-size>'
for vm in vm_list:
    if vm.hardware_profile.vm_size != desired_size:
        # Update the VM SKU size
        vm.hardware_profile.vm_size = desired_size
        async_vm_update = compute_client.virtual_machines.create_or_update(
            resource_group_name, vm.name, vm)
        async_vm_update.wait()
```

6. The above code will update the SKU size of the virtual machine to the desired size if it doesn't match. You can run this code periodically to ensure that all virtual machines have the desired SKU size.

Note: Make sure you have the necessary permissions to update the SKU size of the virtual machines.




</Tab>
</Tabs>