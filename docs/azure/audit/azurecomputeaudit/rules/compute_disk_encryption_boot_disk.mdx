---
slug: compute_disk_encryption_boot_disk
title: Azure Disk Encryption For Boot Disk Volumes
sidebar_label: Azure Disk Encryption For Boot Disk Volumes
---

### More Info:

Ensure that your Microsoft Azure virtual machine (VM) boot volumes are encrypted using Azure Disk Encryption in order to meet security and compliance requirements. ADE encrypts the OS and data disks of Azure virtual machines (VMs) inside your VMs using the CPU via the DM-Crypt feature for Linux or the BitLocker feature for Windows. ADE is integrated with Azure Key Vault to help you control and manage the disk encryption keys and secrets. The boot (OS) volumes encryption and decryption is handled transparently and does not require any additional action from you, your Azure virtual machine, or your cloud application.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, HITRUST, SOC2, GDPR, NISTCSF, PCIDSS, ISO27001


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal: Navigate to the Azure portal (https://portal.azure.com/) and sign in with your Azure account credentials.

2. Navigate to Virtual Machines: From the left-hand menu, select "Virtual Machines" to view the list of all your existing virtual machines.

3. Select a Virtual Machine: Click on the name of the virtual machine for which you want to check the disk encryption. This will open the virtual machine's dashboard.

4. Check Disk Encryption: In the virtual machine's dashboard, select "Disks" from the left-hand menu. Here, you can see the encryption settings for each disk attached to the virtual machine. If the "Disk state" is "Encrypted", then Azure Disk Encryption is enabled for that disk. If not, then it is not enabled.

#### Using CLI

1. Install Azure CLI: Before you can run any Azure CLI commands, you need to install Azure CLI on your local machine. You can download it from the official Microsoft website. Once installed, open your command prompt or terminal and type `az login` to log in to your Azure account.

2. List all the VMs: Use the following command to list all the VMs in a specific subscription and resource group.

   ```
   az vm list --resource-group MyResourceGroup --subscription MySubscription
   ```

   Replace 'MyResourceGroup' and 'MySubscription' with your actual resource group and subscription names. This command will return a JSON output with details about all the VMs.

3. Check the disk encryption status: For each VM, check the disk encryption status using the following command:

   ```
   az vm encryption show --name MyVM --resource-group MyResourceGroup
   ```

   Replace 'MyVM' and 'MyResourceGroup' with your actual VM and resource group names. This command will return a JSON output with the disk encryption details.

4. Analyze the output: In the JSON output, look for the 'osDisk' field. If the 'encryptionSettings' field under 'osDisk' is not present or if its 'enabled' subfield is set to false, then the boot disk volume is not encrypted.

#### Using Python

1. Install Azure SDK: To interact with Azure resources, you need to install Azure SDK in your Python environment. You can do this by running the command `pip install azure-mgmt-compute`.

2. Import necessary modules and authenticate: Import the necessary modules and authenticate with Azure. You will need to import `ComputeManagementClient` from `azure.mgmt.compute` and `DefaultAzureCredential` from `azure.identity`. Use `DefaultAzureCredential` to authenticate with Azure.

```python
from azure.identity import DefaultAzureCredential
from azure.mgmt.compute import ComputeManagementClient

credential = DefaultAzureCredential()
subscription_id = 'your-subscription-id'  # replace with your Azure subscription id
compute_client = ComputeManagementClient(credential, subscription_id)
```

3. Get the list of all virtual machines: Use the `compute_client.virtual_machines.list_all()` method to get a list of all virtual machines in your Azure subscription.

```python
vms = compute_client.virtual_machines.list_all()
```

4. Check the disk encryption status: For each virtual machine, get the OS disk and check if it is encrypted. If the `encryption_settings_collection` attribute is not None and the `enabled` attribute is True, then the disk is encrypted.

```python
for vm in vms:
    os_disk = compute_client.disks.get(vm.resource_group, vm.storage_profile.os_disk.name)
    if os_disk.encryption_settings_collection and os_disk.encryption_settings_collection.enabled:
        print(f"Disk {os_disk.name} is encrypted.")
    else:
        print(f"Disk {os_disk.name} is not encrypted.")
```

This script will print the encryption status of all OS disks in your Azure subscription. If a disk is not encrypted, it indicates a misconfiguration.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the steps to remediate the Azure Disk Encryption misconfiguration for boot disk volumes using the Azure console:

1. Open the Azure portal and navigate to the virtual machine that you want to remediate.
2. Click on the "Disks" option in the left-hand menu.
3. Select the OS disk that you want to encrypt and click on "Disk encryption" in the top menu.
4. Click on the "Enable" button to enable disk encryption.
5. In the "Encryption settings" section, select "Azure managed key" and click on "Select existing" to select the key vault where the encryption key is stored.
6. Select the key that you want to use for disk encryption and click on "Select".
7. Review the encryption settings and click on "Enable encryption" to start the encryption process.
8. Wait for the encryption process to complete. This may take some time depending on the size of the disk.
9. Once the encryption process is complete, restart the virtual machine to ensure that the encryption is applied to the boot disk.

That's it! You have successfully remediated the Azure Disk Encryption misconfiguration for boot disk volumes using the Azure console.

#### Using CLI

Here are the step by step instructions to remediate Azure Disk Encryption for Boot Disk Volumes using Azure CLI:

1. Check if the Azure Disk Encryption is enabled for the Boot Disk Volume of the Virtual Machine using the following command:

   ```
   az vm encryption show --name <VM Name> --resource-group <Resource Group Name> --query "disksEncryptionSettings[?osDisk=true].enabled"
   ```

   If the output is `true`, then Azure Disk Encryption is enabled for the Boot Disk Volume.

2. Disable the Azure Disk Encryption for the Boot Disk Volume of the Virtual Machine using the following command:

   ```
   az vm encryption disable --name <VM Name> --resource-group <Resource Group Name> --volume-type OS
   ```

   This command will disable the Azure Disk Encryption for the Boot Disk Volume of the Virtual Machine.

3. Verify if the Azure Disk Encryption is disabled for the Boot Disk Volume of the Virtual Machine using the following command:

   ```
   az vm encryption show --name <VM Name> --resource-group <Resource Group Name> --query "disksEncryptionSettings[?osDisk=true].enabled"
   ```

   If the output is `false`, then Azure Disk Encryption is disabled for the Boot Disk Volume.

4. Restart the Virtual Machine to complete the remediation process.

   ```
   az vm restart --name <VM Name> --resource-group <Resource Group Name>
   ```

   This command will restart the Virtual Machine to complete the remediation process.

By following the above steps, you can remediate Azure Disk Encryption for Boot Disk Volumes using Azure CLI.

#### Using Python

To remediate the misconfiguration "Azure Disk Encryption For Boot Disk Volumes", you can use the following steps:

1. Install the Azure PowerShell module using the following command: 

```
Install-Module -Name Az -AllowClobber -Scope CurrentUser
```

2. Connect to your Azure account using the following command:

```
Connect-AzAccount
```

3. Retrieve the virtual machine that needs to be remediated using the following command:

```
$vm = Get-AzVM -ResourceGroupName <resource-group-name> -Name <vm-name>
```

4. Check if the boot disk is already encrypted using the following command:

```
$diskEncryptionStatus = Get-AzVMDiskEncryptionStatus -ResourceGroupName $vm.ResourceGroupName -VMName $vm.Name
$bootDiskStatus = $diskEncryptionStatus[0].DiskEncryptionKeyEncryptionMethod
```

5. If the boot disk is not encrypted, enable encryption for the boot disk using the following command:

```
$diskEncryptionKeyVaultUrl = "https://<key-vault-name>.vault.azure.net/"
$diskEncryptionKeyVaultResourceId = (Get-AzKeyVault -VaultName <key-vault-name>).ResourceId
$diskEncryptionKeyEncryptionAlgorithm = "RSA-OAEP"
$diskEncryptionKey = (Get-AzKeyVaultKey -VaultName <key-vault-name> -Name <key-name>).Key
Set-AzVMDiskEncryptionExtension -ResourceGroupName $vm.ResourceGroupName -VMName $vm.Name -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $diskEncryptionKeyVaultResourceId -DiskEncryptionKeyEncryptionAlgorithm $diskEncryptionKeyEncryptionAlgorithm -DiskEncryptionKey $diskEncryptionKey -VolumeType "OS"
```

Note: Replace `<resource-group-name>`, `<vm-name>`, `<key-vault-name>`, and `<key-name>` with the appropriate values.

6. Verify that the boot disk is encrypted using the following command:

```
$diskEncryptionStatus = Get-AzVMDiskEncryptionStatus -ResourceGroupName $vm.ResourceGroupName -VMName $vm.Name
$bootDiskStatus = $diskEncryptionStatus[0].DiskEncryptionKeyEncryptionMethod
```

7. Once you have verified that the boot disk is encrypted, you can disconnect from your Azure account using the following command: 

```
Disconnect-AzAccount
```

This will remediate the misconfiguration "Azure Disk Encryption For Boot Disk Volumes" for your Azure virtual machine using Python.




</Tab>
</Tabs>