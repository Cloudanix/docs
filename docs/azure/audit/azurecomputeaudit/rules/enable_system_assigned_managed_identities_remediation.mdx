

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the Azure portal using your Azure account credentials.

2. Navigate to the "Virtual Machines" section from the left-hand side menu. Here, you will see a list of all the virtual machines that are currently running in your Azure environment.

3. Click on the name of the virtual machine for which you want to check the System-Assigned Managed Identities. This will open the dashboard of the selected virtual machine.

4. In the virtual machine dashboard, scroll down to the "Identity" section under the "Settings" category. Here, you can check the status of the System-Assigned Managed Identity. If it is enabled, you will see "On" under the "System assigned" tab. If it is not enabled, you will see "Off".

#### Using CLI

1. Install Azure CLI: Before you can use Azure CLI commands, you need to have the Azure CLI installed on your system. You can download and install it from the official Microsoft Azure website.

2. Login to Azure: Open your command line interface and login to your Azure account using the following command:
   ```
   az login
   ```
   Follow the instructions on the screen to complete the login process.

3. List all VMs: Now, you need to list all the virtual machines (VMs) in your Azure account. You can do this using the following command:
   ```
   az vm list --query "[].{Name:name, ResourceGroup:resourceGroup}" -o table
   ```
   This command will display a table with the names of all VMs and their respective resource groups.

4. Check System-Assigned Managed Identities: For each VM, you can check if System-Assigned Managed Identities are enabled or not using the following command:
   ```
   az vm identity show --name <VM-Name> --resource-group <Resource-Group-Name> --query "type"
   ```
   Replace `<VM-Name>` and `<Resource-Group-Name>` with the name of your VM and its resource group respectively. If the output of this command is "SystemAssigned", then System-Assigned Managed Identities are enabled for that VM. If the output is "None", then they are not enabled.

#### Using Python

To check if System-Assigned Managed Identities are enabled in Azure Compute instances using Python, you can use the Azure SDK for Python. Here are the steps:

1. **Install Azure SDK for Python**: You need to install the Azure SDK for Python if it's not already installed. You can install it using pip:
   ```python
   pip install azure-mgmt-compute
   ```
2. **Authenticate to Azure**: Before you can interact with Azure resources, you need to authenticate. You can use Azure Identity library for this. Here is a sample code snippet:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.resource import ResourceManagementClient

   credential = DefaultAzureCredential()
   subscription_id = 'your-subscription-id'
   resource_client = ResourceManagementClient(credential, subscription_id)
   ```
3. **Get the Compute Instance**: Now, you can get the compute instance for which you want to check if System-Assigned Managed Identities are enabled. Here is a sample code snippet:
   ```python
   from azure.mgmt.compute import ComputeManagementClient

   compute_client = ComputeManagementClient(credential, subscription_id)
   vm = compute_client.virtual_machines.get('resource-group-name', 'vm-name')
   ```
4. **Check for System-Assigned Managed Identity**: Finally, you can check if System-Assigned Managed Identity is enabled for the compute instance. Here is a sample code snippet:
   ```python
   if vm.identity and vm.identity.type == "SystemAssigned":
       print("System-Assigned Managed Identity is enabled")
   else:
       print("System-Assigned Managed Identity is not enabled")
   ```
This script will print whether the System-Assigned Managed Identity is enabled or not for the specified compute instance.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration of enabling System-Assigned Managed Identities in Azure using the Azure console:

1. Log in to the Azure portal (https://portal.azure.com/).
2. Navigate to the resource group that contains the misconfigured resource.
3. Select the resource that needs to have the System-Assigned Managed Identity enabled.
4. In the left-hand menu, under the Settings section, select Identity.
5. In the Identity blade, set the System Assigned Managed Identity toggle to On.
6. Click Save to save the changes.

After completing these steps, the System-Assigned Managed Identity will be enabled for the selected resource. Please note that not all resources support System-Assigned Managed Identities, so it's important to check the documentation to ensure that the resource you're working with supports this feature.

#### Using CLI

To remediate the misconfiguration of not having System-Assigned Managed Identities enabled in Azure using Azure CLI, you can follow these steps:

1. Open Azure CLI and log in to your Azure account using the command: 

   ```
   az login
   ```

2. Once you are logged in, set the subscription to the one that contains the resource group where the misconfiguration needs to be remediated using the command:

   ```
   az account set --subscription <subscription_id>
   ```

3. Identify the resource group where the misconfiguration needs to be remediated using the command:

   ```
   az group list
   ```

4. Once you have identified the resource group, enable System-Assigned Managed Identities for the resource group using the command:

   ```
   az identity create --resource-group <resource_group_name> --name <managed_identity_name>
   ```

   Replace `<resource_group_name>` with the name of the resource group where the misconfiguration needs to be remediated and `<managed_identity_name>` with the name you want to give to the managed identity.

5. Once the managed identity is created, assign the managed identity to the Azure resource that needs to access Azure services using the command:

   ```
   az resource update --ids <resource_id> --set identity.type='SystemAssigned'
   ```

   Replace `<resource_id>` with the ID of the Azure resource that needs to access Azure services.

6. Verify that the System-Assigned Managed Identity has been enabled by running the command:

   ```
   az resource show --ids <resource_id> --query identity
   ```

   This command should return the identity details of the Azure resource, including the System-Assigned Managed Identity.

By following these steps, you will have successfully remediated the misconfiguration of not having System-Assigned Managed Identities enabled in Azure using Azure CLI.

#### Using Python

To remediate the misconfiguration "Enable System-Assigned Managed Identities" in Azure using Python, you can follow the below steps:

1. Install the Azure SDK for Python using the following command:

   ```
   pip install azure
   ```

2. Import the required modules in your Python script:

   ```
   from azure.mgmt.compute import ComputeManagementClient
   from azure.identity import DefaultAzureCredential
   ```

3. Set the credentials for authentication using the `DefaultAzureCredential` class:

   ```
   credential = DefaultAzureCredential()
   ```

4. Create an instance of the `ComputeManagementClient` class using the credentials and the Azure subscription ID:

   ```
   compute_client = ComputeManagementClient(credential, subscription_id)
   ```

5. Get the details of the virtual machine that needs to be remediated using the `get` method of the `VirtualMachinesOperations` class:

   ```
   vm = compute_client.virtual_machines.get(resource_group_name, vm_name)
   ```

6. Enable the system-assigned managed identity for the virtual machine using the `update` method of the `VirtualMachinesOperations` class:

   ```
   vm.identity = {"type": "SystemAssigned"}
   compute_client.virtual_machines.update(resource_group_name, vm_name, vm)
   ```

7. Save the changes and exit the script.

The above steps will enable the system-assigned managed identity for the specified virtual machine in Azure.


</Tab>
</Tabs>