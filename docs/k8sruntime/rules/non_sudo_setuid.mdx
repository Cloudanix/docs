--- 
slug: Non sudo setuid
rule: Non sudo setuid
title: Non sudo setuid
sidebar_label: Non sudo setuid
---
                   

### Event Information

#### Meaning

The "Non sudo setuid" event in a Kubernetes cluster refers to a situation where a non-root user attempts to execute a process with the setuid permission, which allows the process to run with the privileges of the file owner. This event can have security implications and may violate compliance standards. Here are three key points about this event:

1. Security risk: The "Non sudo setuid" event indicates that a non-root user is attempting to execute a process with elevated privileges. This can be a security risk as it may allow unauthorized access or privilege escalation within the cluster.

2. Compliance violation: Many compliance standards, such as PCI DSS or HIPAA, require strict control over user privileges and access. The "Non sudo setuid" event violates these standards as it allows non-root users to execute processes with elevated privileges.

3. Investigation and mitigation: To address this event, it is important to investigate the process and user involved. Check if the process is legitimate and necessary for the cluster's operation. If not, remove or restrict the process. Additionally, review user permissions and ensure that only authorized users have the necessary privileges to execute processes with elevated permissions.

#### Remediation

1. Bash script remediation:
   - Create a bash script, let's say `remediate.sh`, with the following content:
     ```bash
     #!/bin/bash
     sudo chmod -s <path_to_binary>
     ```
   - Replace `<path_to_binary>` with the actual path of the binary that has the setuid permission.
   - Make the script executable by running `chmod +x remediate.sh`.
   - In your Python script, call this bash script using `subprocess` module:
     ```python
     import subprocess
     subprocess.run(["./remediate.sh"])
     ```

2. Kubernetes remediation using kubectl:
   - Identify the pod where the unauthorized setuid binary is running. You can use `kubectl` commands like `kubectl get pods` or `kubectl describe pods` to find the pod name.
   - Execute a shell inside the pod using the following command:
     ```bash
     kubectl exec -it <pod_name> -- /bin/bash
     ```
   - Once inside the pod, find the path of the unauthorized setuid binary and remove the setuid permission using the `chmod` command:
     ```bash
     chmod -s <path_to_binary>
     ```
   - Exit the shell and the setuid permission will be removed.

3. Python script integration:
   - In your Python script, you can use the `subprocess` module to execute the kubectl commands mentioned above.
   - Example:
     ```python
     import subprocess
     subprocess.run(["kubectl", "exec", "-it", "<pod_name>", "--", "/bin/bash", "-c", "chmod -s <path_to_binary>"])
     ```
   - Replace `<pod_name>` with the actual name of the pod and `<path_to_binary>` with the path of the unauthorized setuid binary.

 