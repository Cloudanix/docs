--- 
slug: Create Symlink Over Sensitive Files
rule: Create Symlink Over Sensitive Files
title: Create Symlink Over Sensitive Files
sidebar_label: Create Symlink Over Sensitive Files
---
                   

### Event Information

#### Meaning

- The Create Symlink Over Sensitive Files event in a Kubernetes cluster indicates that a process or container attempted to create a symbolic link (symlink) pointing to a sensitive file or directory.
- This event could potentially be a security risk as it may allow unauthorized access or modification of sensitive data or system files.
- It is important to investigate this event further to identify the source of the symlink creation and take appropriate actions to mitigate the risk, such as removing the symlink and securing the sensitive files or directories.

To investigate and mitigate this event in a Kubernetes cluster:
1. Identify the pod or container involved in the event by checking the relevant logs or using the Kubernetes audit logs.
   - Use the following command to retrieve the logs of a specific pod:
     ```
     kubectl logs <pod_name> -n <namespace>
     ```
   - Check the Kubernetes audit logs to find relevant events:
     ```
     kubectl get events --field-selector=type=Normal -n <namespace>
     ```

2. Inspect the container or pod configuration to ensure that it does not have unnecessary privileges or access to sensitive files.
   - Use the following command to describe the pod and check its security context:
     ```
     kubectl describe pod <pod_name> -n <namespace>
     ```
   - Ensure that the pod or container does not have excessive permissions or access to sensitive files/directories.

3. Implement security measures to prevent unauthorized symlink creation and protect sensitive files.
   - Apply Pod Security Policies (PSPs) to restrict the capabilities and permissions of pods.
   - Regularly scan and monitor the cluster for any unauthorized symlink creations or modifications.
   - Implement file integrity monitoring (FIM) tools to detect any unauthorized changes to sensitive files or directories.

#### Remediation

Bash Script:
1. Identify the sensitive files that need to be protected.
2. Create a backup of the sensitive files.
3. Remove the symlink and replace it with the original file.

```bash
#!/bin/bash

# Specify the sensitive files
sensitive_files=(
    "/path/to/file1"
    "/path/to/file2"
    "/path/to/file3"
)

# Create a backup of the sensitive files
for file in "${sensitive_files[@]}"; do
    cp "$file" "$file.bak"
done

# Remove the symlink and replace it with the original file
for file in "${sensitive_files[@]}"; do
    if [ -L "$file" ]; then
        rm "$file"
        cp "$file.bak" "$file"
    fi
done
```

Python Script:
1. Import the necessary modules.
2. Use the `subprocess` module to execute kubectl commands.
3. Use the `subprocess.run()` function to run the kubectl commands.

```python
import subprocess

# Specify the kubectl commands
kubectl_commands = [
    "kubectl delete symlink <symlink_name>",
    "kubectl cp <original_file> <pod_name>:<destination_path>"
]

# Execute the kubectl commands
for command in kubectl_commands:
    subprocess.run(command, shell=True)
```

Note: Replace `<symlink_name>`, `<original_file>`, `<pod_name>`, and `<destination_path>` with the actual values specific to your environment.

 