--- 
slug: Contact K8S API Server From Container
rule: Contact K8S API Server From Container
title: Contact K8S API Server From Container
sidebar_label: Contact K8S API Server From Container
---
                   

### Event Information

#### Meaning

- The "Contact K8S API Server From Container" event in a Kubernetes cluster indicates that a container within the cluster attempted to communicate with the Kubernetes API server.
- This event could be triggered by a legitimate action, such as a pod querying the API server for information or performing an operation like scaling or updating resources.
- However, it could also indicate a potential security concern if the container is attempting unauthorized access or performing malicious activities against the API server.

To investigate further, you can:
- Use the `kubectl get pods` command to list all the pods running in the cluster and check if any suspicious or unauthorized pods are present.
- Review the logs of the container that triggered the event using `kubectl logs <pod-name> -c <container-name>` to look for any abnormal or unauthorized API requests.
- Analyze the network policies and RBAC (Role-Based Access Control) configurations to ensure that only authorized containers have access to the Kubernetes API server. Use `kubectl get networkpolicies` and `kubectl get roles` to retrieve relevant information.

#### Remediation

1. Bash script:
   - Use the `kubectl exec` command to execute a bash command inside the container that triggered the event.
   - Within the bash command, use the `curl` command to send a request to the Kubernetes API server.
   - Capture the response and handle it accordingly in the script.

   Example:
   ```bash
   #!/bin/bash
   POD_NAME=<pod_name>
   CONTAINER_NAME=<container_name>
   K8S_API_SERVER=<k8s_api_server>

   kubectl exec -it $POD_NAME -c $CONTAINER_NAME -- bash -c "curl $K8S_API_SERVER"
   ```

2. Python script:
   - Use the `subprocess` module in Python to execute the `kubectl exec` command.
   - Within the command, use the `curl` command to send a request to the Kubernetes API server.
   - Capture the output of the command and handle it accordingly in the script.

   Example:
   ```python
   import subprocess

   pod_name = "<pod_name>"
   container_name = "<container_name>"
   k8s_api_server = "<k8s_api_server>"

   command = f"kubectl exec -it {pod_name} -c {container_name} -- curl {k8s_api_server}"
   output = subprocess.check_output(command, shell=True)
   print(output)
   ```

3. Ensure compliance:
   - Make sure the script is executed with appropriate permissions to access the Kubernetes API server.
   - Validate that the script is executed within the context of a Kubernetes cluster.
   - Consider using RBAC (Role-Based Access Control) to restrict access to the Kubernetes API server from containers, ensuring only authorized containers can make API requests.

 