--- 
slug: Run shell untrusted
rule: Run shell untrusted
title: Run shell untrusted
sidebar_label: Run shell untrusted
---
                   

### Event Information

#### Meaning

- The "Run shell untrusted" event in a Kubernetes cluster indicates that a shell command was executed within a container running in the cluster, and it was flagged as untrusted.
- This event typically occurs when a user or process attempts to run a shell command that is not allowed or violates the security policies defined for the cluster.
- It is important to investigate this event further to determine the source of the command and assess whether it poses a security risk or violates any compliance standards.

To investigate the "Run shell untrusted" event in a Kubernetes cluster, you can:
1. Use the `kubectl get pods` command to identify the pod in which the event occurred.
2. Use the `kubectl logs <pod-name>` command to view the logs of the container associated with the pod, which may provide more information about the untrusted shell command.
3. Review the security policies and access controls in place to identify any potential vulnerabilities or misconfigurations that allowed the untrusted command to be executed.

Note: The specific commands may vary depending on the Kubernetes distribution and configuration.

#### Remediation

1. Disable the execution of untrusted shell scripts:
   - Update the Linux system's security policy to prevent the execution of untrusted shell scripts. This can be done by modifying the `/etc/sudoers` file to restrict the execution of specific scripts or by implementing a more fine-grained access control mechanism like SELinux or AppArmor.

2. Implement a secure execution environment for untrusted scripts:
   - Set up a container runtime environment like Docker or Kubernetes to isolate the execution of untrusted scripts. Create a Docker image or a Kubernetes pod with restricted privileges and run the untrusted script within this isolated environment. This will help prevent any potential damage caused by the script.

3. Validate and sanitize user input in the Python script:
   - Modify the Python script to include input validation and sanitization mechanisms. This will help prevent any command injection vulnerabilities that could be exploited by the untrusted shell script. Use libraries like `subprocess` or `shlex` to properly handle user input and avoid executing arbitrary commands.

Note: It is important to thoroughly review and test any remediation script before implementing it in a production environment.

 