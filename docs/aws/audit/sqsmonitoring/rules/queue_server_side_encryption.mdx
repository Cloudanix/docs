---
slug: queue_server_side_encryption
title: SQS Queue Should Enforce Server Side Encryption
sidebar_label: SQS Queue Should Enforce Server Side Encryption
---

### More Info:

Amazon SQS queues should enforce Server-Side Encryption (SSE) to protect the contents of their messages. This way contents of your messages will be unavailable to unauthorized or anonymous users.

### Risk Level

High

### Addresses

Security

### Compliance Standards

HIPAA,ISO27001,HITRUST,NISTCSF,SEBI

### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent SQS Queue misconfiguration by enforcing Server Side Encryption (SSE) in AWS using the AWS Management Console, follow these steps:

1. **Navigate to the SQS Dashboard:**
   - Sign in to the AWS Management Console.
   - Open the Amazon SQS console at [https://console.aws.amazon.com/sqs/](https://console.aws.amazon.com/sqs/).

2. **Create or Select an SQS Queue:**
   - To create a new queue, click on the "Create queue" button.
   - To modify an existing queue, select the queue from the list.

3. **Configure Server-Side Encryption:**
   - In the "Create Queue" or "Edit Queue" page, scroll down to the "Server-side encryption" section.
   - Check the box for "Enable server-side encryption".

4. **Select the AWS KMS Key:**
   - Choose the AWS Key Management Service (KMS) key you want to use for encryption. You can select the default AWS managed key (aws/sqs) or a customer-managed key (CMK) from the dropdown list.

By following these steps, you ensure that your SQS queues are configured to enforce server-side encryption, thereby enhancing the security of the data in transit and at rest.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of an SQS Queue not enforcing Server Side Encryption (SSE) using AWS CLI, follow these steps:

1. **Create a KMS Key**:
   First, ensure you have a KMS key that you can use for encryption. If you don't have one, create it using the following command:
   ```sh
   aws kms create-key --description "SQS encryption key" --region <your-region>
   ```

2. **Get the KMS Key ID**:
   Retrieve the Key ID of the KMS key you just created or an existing one:
   ```sh
   aws kms list-keys --region <your-region>
   ```

3. **Create an SQS Queue with SSE**:
   Create a new SQS queue and specify the KMS key for server-side encryption:
   ```sh
   aws sqs create-queue --queue-name <your-queue-name> --attributes KmsMasterKeyId=<your-kms-key-id> --region <your-region>
   ```

4. **Update an Existing SQS Queue to Enforce SSE**:
   If you have an existing SQS queue, you can update it to enforce SSE using the following command:
   ```sh
   aws sqs set-queue-attributes --queue-url <your-queue-url> --attributes KmsMasterKeyId=<your-kms-key-id> --region <your-region>
   ```

Replace `<your-region>`, `<your-queue-name>`, `<your-kms-key-id>`, and `<your-queue-url>` with your specific values. These steps ensure that your SQS queues are configured to enforce server-side encryption using AWS KMS.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of an SQS Queue not enforcing Server Side Encryption (SSE) in AWS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that SSE is enforced on your SQS queues:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

3. **Create or Update SQS Queue with SSE**:
   Use the following Python script to create a new SQS queue with SSE enabled or update an existing queue to enforce SSE.

   ```python
   import boto3

   # Initialize a session using Amazon SQS
   sqs = boto3.client('sqs')

   # Define the queue name and the KMS key ID
   queue_name = 'your-queue-name'
   kms_key_id = 'your-kms-key-id'  # Replace with your KMS Key ID

   # Create a new SQS queue with SSE enabled
   response = sqs.create_queue(
       QueueName=queue_name,
       Attributes={
           'KmsMasterKeyId': kms_key_id,
           'KmsDataKeyReusePeriodSeconds': '300'  # Optional: Set the data key reuse period
       }
   )

   print(f"Queue URL: {response['QueueUrl']}")

   # If you need to update an existing queue to enforce SSE
   queue_url = response['QueueUrl']  # Replace with your existing queue URL if updating
   sqs.set_queue_attributes(
       QueueUrl=queue_url,
       Attributes={
           'KmsMasterKeyId': kms_key_id,
           'KmsDataKeyReusePeriodSeconds': '300'  # Optional: Set the data key reuse period
       }
   )

   print(f"SSE enforced on queue: {queue_url}")
   ```

4. **Verify SSE Configuration**:
   After creating or updating the queue, you can verify that SSE is enforced by retrieving the queue attributes.

   ```python
   # Retrieve the queue attributes to verify SSE configuration
   response = sqs.get_queue_attributes(
       QueueUrl=queue_url,
       AttributeNames=['All']
   )

   print("Queue Attributes:")
   for key, value in response['Attributes'].items():
       print(f"{key}: {value}")
   ```

By following these steps, you can ensure that your SQS queues are configured to enforce Server Side Encryption using a specified KMS key. This helps in preventing the misconfiguration related to the lack of SSE in SQS queues.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon SQS console at https://console.aws.amazon.com/sqs/.
2. In the navigation pane, choose 'Queues'.
3. In the 'Queue Name' list, choose the name of the queue.
4. In the 'Details' section, under 'Queue Attributes', check the 'Server-side encryption' attribute. If it is not set to 'Enabled', then the SQS queue is not enforcing server-side encryption.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all SQS queues: Use the following command to list all your SQS queues:

   ```
   aws sqs list-queues
   ```
   This command will return a list of URLs for each of your SQS queues.

3. Get queue attributes: For each queue URL returned from the previous command, run the following command to get its attributes:

   ```
   aws sqs get-queue-attributes --queue-url <QueueURL> --attribute-names All
   ```
   Replace `<QueueURL>` with the URL of your queue. This command will return all the attributes of the specified queue.

4. Check for Server Side Encryption: In the output of the previous command, look for the `KmsMasterKeyId` attribute. If this attribute is present and has a value, it means that Server Side Encryption is enabled for the queue. If this attribute is not present or has no value, it means that Server Side Encryption is not enabled for the queue.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a client for SQS and list all the queues:

```python
sqs = session.client('sqs')
response = sqs.list_queues()
```

4. For each queue, get the queue attributes and check if the 'KmsMasterKeyId' attribute is present. If it's not, then the queue is not enforcing server-side encryption:

```python
for queue_url in response['QueueUrls']:
    attributes = sqs.get_queue_attributes(
        QueueUrl=queue_url,
        AttributeNames=['All']
    )
    if 'KmsMasterKeyId' not in attributes['Attributes']:
        print(f"Queue {queue_url} is not enforcing server-side encryption.")
```

This script will print out the URLs of all SQS queues that are not enforcing server-side encryption.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of an SQS Queue not enforcing server-side encryption in AWS using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console:**
   - Go to https://aws.amazon.com and sign in to the AWS Management Console using your IAM credentials.

2. **Navigate to the Amazon SQS service:**
   - From the AWS Management Console, search for "SQS" or find the "Simple Queue Service" under the "Messaging" section.

3. **Select the SQS Queue requiring encryption:**
   - Click on the SQS Queue that needs to enforce server-side encryption.

4. **Configure Server-Side Encryption:**
   - In the SQS Queue details page, click on the "Configure Queue" button.

5. **Enable Server-Side Encryption:**
   - Under the "Server-side encryption" section, select the option to enable server-side encryption.

6. **Choose Encryption Key:**
   - Choose the Customer Master Key (CMK) from AWS Key Management Service (KMS) that you want to use for encrypting the messages in the SQS Queue.

7. **Save Changes:**
   - Click on the "Save Changes" button to apply the server-side encryption configuration to the SQS Queue.

8. **Verify Encryption Configuration:**
   - To ensure that server-side encryption is enforced, you can check the SQS Queue settings to confirm that encryption is enabled.

By following these steps, you have successfully enforced server-side encryption for the SQS Queue in AWS using the AWS Management Console. This will help in securing the messages stored in the queue and ensure compliance with security best practices.
</Accordion>

<Accordion title='Using CLI'>
#

To remediate the misconfiguration of SQS Queue not enforcing server-side encryption in AWS using AWS CLI, follow these steps:

1. List all the existing SQS Queues to identify the one that needs to be remediated:
```bash
aws sqs list-queues
```

2. Get the attributes of the specific SQS Queue that needs to enforce server-side encryption. Replace `queue-url` with the URL of the SQS Queue:
```bash
aws sqs get-queue-attributes --queue-url <queue-url> --attribute-names All
```

3. Enable server-side encryption on the SQS Queue. Replace `queue-url` with the URL of the SQS Queue:
```bash
aws sqs set-queue-attributes --queue-url <queue-url> --attributes KmsMasterKeyId=alias/aws/sqs, KmsDataKeyReusePeriodSeconds=300, KmsDataKeyReusePeriodSeconds=300
```

4. Verify that server-side encryption is enabled on the SQS Queue by checking the attributes again:
```bash
aws sqs get-queue-attributes --queue-url <queue-url> --attribute-names All
```

By following these steps, you can successfully remediate the misconfiguration of SQS Queue not enforcing server-side encryption in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To enforce server-side encryption for an AWS SQS queue using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the SQS client:
```python
sqs = boto3.client('sqs')
```

3. Get the URL of the SQS queue:
```python
queue_url = 'YOUR_QUEUE_URL'
```

4. Update the SQS queue attributes to enable server-side encryption:
```python
response = sqs.set_queue_attributes(
    QueueUrl=queue_url,
    Attributes={
        'KmsMasterKeyId': 'YOUR_KMS_KEY_ID',
        'KmsDataKeyReusePeriodSeconds': '300',  # Optional, specify the data key reuse period
        'Policy': '{"Version": "2012-10-17","Id": "Queue_Policy","Statement": [{"Effect": "Allow","Principal": "*","Action": "SQS:SendMessage","Resource": "YOUR_QUEUE_ARN","Condition": {"StringEquals": {"aws:SourceAccount": "YOUR_ACCOUNT_ID"}}}]}'
    }
)
```
Replace `YOUR_QUEUE_URL`, `YOUR_KMS_KEY_ID`, `YOUR_QUEUE_ARN`, and `YOUR_ACCOUNT_ID` with your actual values.

5. Verify that the server-side encryption is enabled for the SQS queue:
```python
response = sqs.get_queue_attributes(
    QueueUrl=queue_url,
    AttributeNames=['All']
)
print(response['Attributes']['KmsMasterKeyId'])
```

By following these steps, you can remediate the misconfiguration and enforce server-side encryption for an AWS SQS queue using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

