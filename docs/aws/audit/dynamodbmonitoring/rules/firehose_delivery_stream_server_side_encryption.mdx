---
slug: firehose_delivery_stream_server_side_encryption
title: Enable Firehose Delivery Stream Server-Side Encryption
sidebar_label: Enable Firehose Delivery Stream Server-Side Encryption
---

### More Info:

Ensure that your Amazon Kinesis Data Firehose delivery streams are encrypted using Server-Side Encryption. It is recommended for added security to use KMS Customer-managed Customer Master Keys (CMKs) instead of AWS managed-keys, in order to have full control over the encryption and decryption process and meet regulatory requirements. Amazon Kinesis Data Firehose is a fully managed service designed for real-time streaming data delivery to destinations such as Amazon S3, Amazon Redshift, Amazon ElasticSearch Service, and Splunk.

### Risk Level

High

### Address

Cost optimization, Operational Maturity, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not enabling Firehose Delivery Stream Server-Side Encryption in DynamoDB using the AWS Management Console, follow these steps:

1. **Navigate to Kinesis Data Firehose:**
   - Open the AWS Management Console.
   - In the search bar, type "Kinesis" and select "Kinesis Data Firehose" from the dropdown.

2. **Create or Edit Delivery Stream:**
   - If you are creating a new delivery stream, click on "Create delivery stream."
   - If you are editing an existing delivery stream, select the delivery stream from the list and click on "Edit."

3. **Configure Destination Settings:**
   - In the "Destination settings" section, choose the destination for your data (e.g., Amazon S3, Amazon Redshift, etc.).
   - Scroll down to the "Server-side encryption" section.

4. **Enable Server-Side Encryption:**
   - Check the box to enable server-side encryption.
   - Choose the AWS Key Management Service (KMS) key you want to use for encryption. You can select an existing key or create a new one.

By following these steps, you ensure that server-side encryption is enabled for your Firehose Delivery Stream, thereby securing the data being delivered to DynamoDB.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of not enabling Firehose Delivery Stream Server-Side Encryption in DynamoDB using AWS CLI, follow these steps:

1. **Create a KMS Key for Encryption:**
   Ensure you have a KMS key that will be used for server-side encryption. If you don't have one, create it using the following command:
   ```sh
   aws kms create-key --description "KMS key for Firehose Delivery Stream encryption"
   ```

2. **Enable Server-Side Encryption on the Firehose Delivery Stream:**
   When creating or updating a Firehose Delivery Stream, specify the KMS key to enable server-side encryption. Use the following command to create a new Firehose Delivery Stream with encryption:
   ```sh
   aws firehose create-delivery-stream --delivery-stream-name my-firehose-stream \
   --s3-destination-configuration RoleARN=arn:aws:iam::123456789012:role/firehose_delivery_role,BucketARN=arn:aws:s3:::my-bucket,Prefix=my-prefix/,EncryptionConfiguration={KMSEncryptionConfig={AWSKMSKeyARN=arn:aws:kms:region:account-id:key/key-id}}
   ```

3. **Update an Existing Firehose Delivery Stream to Enable Encryption:**
   If you have an existing Firehose Delivery Stream, update it to enable server-side encryption using the following command:
   ```sh
   aws firehose update-destination --delivery-stream-name my-firehose-stream \
   --current-delivery-stream-version-id version-id \
   --destination-id destination-id \
   --s3-destination-update RoleARN=arn:aws:iam::123456789012:role/firehose_delivery_role,BucketARN=arn:aws:s3:::my-bucket,Prefix=my-prefix/,EncryptionConfiguration={KMSEncryptionConfig={AWSKMSKeyARN=arn:aws:kms:region:account-id:key/key-id}}
   ```

4. **Verify the Encryption Configuration:**
   Confirm that the Firehose Delivery Stream has server-side encryption enabled by describing the delivery stream:
   ```sh
   aws firehose describe-delivery-stream --delivery-stream-name my-firehose-stream
   ```

By following these steps, you can ensure that server-side encryption is enabled for your Firehose Delivery Stream, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not enabling Firehose Delivery Stream Server-Side Encryption in DynamoDB using Python scripts, you can follow these steps:

1. **Install AWS SDK for Python (Boto3):**
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials:**
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

3. **Create a Python Script to Enable Server-Side Encryption:**
   Write a Python script that enables server-side encryption for your Firehose Delivery Stream. Below is an example script:

   ```python
   import boto3

   # Initialize a session using Amazon Kinesis Firehose
   firehose_client = boto3.client('firehose')

   # Define the delivery stream name
   delivery_stream_name = 'your_delivery_stream_name'

   # Enable server-side encryption
   response = firehose_client.start_delivery_stream_encryption(
       DeliveryStreamName=delivery_stream_name,
       DeliveryStreamEncryptionConfigurationInput={
           'KeyType': 'AWS_OWNED_CMK'  # You can also use 'CUSTOMER_MANAGED_CMK' if you have a custom key
       }
   )

   print(f"Server-side encryption enabled for delivery stream: {delivery_stream_name}")
   ```

4. **Run the Script:**
   Execute the script to enable server-side encryption for your Firehose Delivery Stream:
   ```bash
   python enable_firehose_encryption.py
   ```

By following these steps, you can ensure that server-side encryption is enabled for your Firehose Delivery Stream in DynamoDB, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Kinesis Firehose console at https://console.aws.amazon.com/firehose/.

2. In the navigation pane, choose "Delivery streams".

3. In the list of delivery streams, choose the name of the delivery stream that you want to check.

4. In the details pane, under "Destination details", check the "Server-side encryption" section. If it's enabled, you will see the details of the encryption like the AWS Key Management Service (KMS) key that's being used. If it's not enabled, the section will be blank or will show "Disabled".
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation: `pip install awscli`
   
   Configuration: `aws configure`

2. List all Firehose Delivery Streams: Use the `list-delivery-streams` command to get a list of all Firehose Delivery Streams in your AWS account. The command is as follows:

   `aws firehose list-delivery-streams`

3. Describe Delivery Stream: For each Delivery Stream, use the `describe-delivery-stream` command to get detailed information about the stream. This information includes whether Server-Side Encryption is enabled or not. The command is as follows:

   `aws firehose describe-delivery-stream --delivery-stream-name <your-delivery-stream-name>`

4. Check Server-Side Encryption: In the output of the `describe-delivery-stream` command, look for the `DeliveryStreamEncryptionConfiguration` field. If the `Status` field under it is set to `ENABLED`, then Server-Side Encryption is enabled. If not, then it is not enabled.
</Accordion>

<Accordion title='Using Python'>
To check if Firehose Delivery Stream Server-Side Encryption is enabled in DynamoDB using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Import the Boto3 library in Python:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:
   ```python
   pip install boto3
   ```
   Then import it in your script:
   ```python
   import boto3
   ```

2. **Create a Firehose client:**
   You can create a Firehose client using the `boto3.client()` function. You need to specify 'firehose' as the service name.
   ```python
   firehose = boto3.client('firehose')
   ```

3. **List all delivery streams:**
   You can list all the delivery streams using the `list_delivery_streams()` function. This function returns a dictionary containing all the delivery streams.
   ```python
   response = firehose.list_delivery_streams()
   delivery_streams = response['DeliveryStreamNames']
   ```

4. **Check if Server-Side Encryption is enabled:**
   For each delivery stream, you can check if Server-Side Encryption is enabled using the `describe_delivery_stream()` function. This function returns a dictionary containing the description of the delivery stream. If the 'DeliveryStreamEncryptionConfiguration' key is present and its 'Status' is 'ENABLED', then Server-Side Encryption is enabled.
   ```python
   for stream in delivery_streams:
       description = firehose.describe_delivery_stream(DeliveryStreamName=stream)
       encryption_config = description['DeliveryStreamDescription']['DeliveryStreamEncryptionConfiguration']
       if encryption_config['Status'] == 'ENABLED':
           print(f'Server-Side Encryption is enabled for {stream}')
       else:
           print(f'Server-Side Encryption is not enabled for {stream}')
   ```
This script will print whether Server-Side Encryption is enabled for each delivery stream.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of enabling Firehose Delivery Stream Server-Side Encryption for AWS DynamoDB using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console:**
   - Go to the AWS Management Console (https://aws.amazon.com/console/) and sign in to your AWS account.

2. **Navigate to Amazon Kinesis Data Firehose:**
   - In the AWS Management Console, search for "Kinesis" in the search bar at the top and select "Kinesis" under the Analytics section.

3. **Select the Firehose Delivery Stream:**
   - Click on the "Delivery Streams" option on the left sidebar to view a list of your existing Firehose delivery streams.
   - Select the Firehose delivery stream that is connected to your DynamoDB table and requires server-side encryption.

4. **Enable Server-Side Encryption:**
   - In the selected Firehose delivery stream details page, click on the "Edit" button to modify the settings.
   - Scroll down to the "Server-side encryption" section and select the option for "Enable server-side encryption."
   - Choose the appropriate KMS key from the dropdown menu or create a new KMS key if necessary.

5. **Save Changes:**
   - After enabling server-side encryption and selecting the KMS key, click on the "Save" button to apply the changes to the Firehose delivery stream.

6. **Verify Encryption Configuration:**
   - Once the changes are saved, verify that server-side encryption is enabled for the Firehose delivery stream by checking the settings in the details page.

By following these steps, you will successfully remediate the misconfiguration by enabling Firehose Delivery Stream Server-Side Encryption for AWS DynamoDB using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To enable server-side encryption for an AWS Kinesis Data Firehstream using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable server-side encryption for the Firehose Delivery Stream:

```bash
aws firehose update-delivery-stream \
--delivery-stream-name YOUR_DELIVERY_STREAM_NAME \
--extended-s3-destination-update EncryptionConfiguration.Enabled=true,EncryptionConfiguration.KeyType=AWS_OWNED_CMK
```

Make sure to replace `YOUR_DELIVERY_STREAM_NAME` with the actual name of your Firehose Delivery Stream.

2. Once the command is executed successfully, the server-side encryption will be enabled for the specified Firehose Delivery Stream using the AWS-owned Customer Master Key (CMK).

3. You can verify the changes by describing the delivery stream using the following command:

```bash
aws firehose describe-delivery-stream --delivery-stream-name YOUR_DELIVERY_STREAM_NAME
```

Look for the `EncryptionConfiguration` section in the output to confirm that server-side encryption is enabled.

By following these steps, you can remediate the misconfiguration and enable server-side encryption for an AWS Kinesis Data Firehose Delivery Stream using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of enabling Firehose Delivery Stream Server-Side Encryption for AWS DynamoDB using Python, follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the AWS DynamoDB client:
```python
dynamodb = boto3.client('dynamodb')
```

3. Get the list of all the existing DynamoDB tables:
```python
tables = dynamodb.list_tables()
```

4. Iterate through each table and enable server-side encryption for the desired table:
```python
for table_name in tables['TableNames']:
    response = dynamodb.update_table(
        TableName=table_name,
        SSESpecification={
            'Enabled': True,
            'SSEType': 'KMS'
        }
    )
    print(f"Server-side encryption enabled for table: {table_name}")
```

5. Run the Python script to enable server-side encryption for all the DynamoDB tables.

By following these steps, you can remediate the misconfiguration of enabling Firehose Delivery Stream Server-Side Encryption for AWS DynamoDB using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/firehose/latest/dev/encryption.html](https://docs.aws.amazon.com/firehose/latest/dev/encryption.html) 

