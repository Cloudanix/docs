---
slug: kinesis_stream_shard_level_metrics
title: Kinesis Stream Shard Level Metrics
sidebar_label: Kinesis Stream Shard Level Metrics
---

### More Info:

Ensure enhanced Amazon Kinesis stream monitoring for shard-level metrics is enabled in order to increase visibility into your streams performance. Kinesis is a platform for streaming data on Amazon Web Services that provides you with the ability to build and manage your own custom streaming data applications for specialized needs. A Kinesis stream is an ordered sequence of data records collected within a dedicated storage layer. The data records within a Kinesis stream is distributed into unique identified groups called shards.

### Risk Level

Low

### Address

Cost optimization, Operational Maturity

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon Kinesis console at https://console.aws.amazon.com/kinesis.

2. In the navigation pane, choose "Data Streams". This will display a list of all your Kinesis data streams.

3. Click on the name of the Kinesis data stream for which you want to check the shard level metrics. This will open the details page for the selected stream.

4. In the "Shards" tab, you can see the list of all shards for the selected stream. Click on the ID of the shard for which you want to check the metrics. This will open the "Shard Details" page where you can see the shard level metrics for the selected shard.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List Kinesis Streams**: Use the `list-streams` command to list all the Kinesis streams in your account. The command is as follows:

    ```
    aws kinesis list-streams
    ```

    This command will return a list of names of all the Kinesis streams in your account.

3. **Describe Kinesis Stream**: Use the `describe-stream` command to get detailed information about a specific Kinesis stream. Replace `stream-name` with the name of your Kinesis stream. The command is as follows:

    ```
    aws kinesis describe-stream --stream-name stream-name
    ```

    This command will return a JSON object that contains detailed information about the specified Kinesis stream, including the number of shards.

4. **Get Shard Level Metrics**: Use the `get-shard-iterator` command to get a shard iterator for a specific shard. Replace `stream-name`, `shard-id`, and `shard-iterator-type` with the name of your Kinesis stream, the ID of the shard, and the type of the shard iterator respectively. The command is as follows:

    ```
    aws kinesis get-shard-iterator --stream-name stream-name --shard-id shard-id --shard-iterator-type shard-iterator-type
    ```

    This command will return a shard iterator. You can then use this shard iterator with the `get-records` command to get the records from the shard. The command is as follows:

    ```
    aws kinesis get-records --shard-iterator shard-iterator
    ```

    This command will return a JSON object that contains the records from the shard. You can then analyze these records to get the shard level metrics.
</Accordion>

<Accordion title='Using Python'>
To check Kinesis Stream Shard Level Metrics in DynamoDB using python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Install Boto3**: If you haven't installed Boto3, you can install it using pip:
   ```
   pip install boto3
   ```
2. **Configure AWS Credentials**: Before you can start using Boto3, you need to set up authentication credentials for your AWS account. You can do this by creating the files ~/.aws/credentials and ~/.aws/config on your local machine. The content of these files should be as follows:
   ```
   ~/.aws/credentials:
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY

   ~/.aws/config:
   [default]
   region=us-east-1
   ```
3. **Create a Python Script to Get Shard Level Metrics**: You can use the `get_shard_iterator` method of the Kinesis client in Boto3 to get the shard iterator. Then, you can use the `get_records` method to get the records from the shard. Here is a sample script:
   ```python
   import boto3

   # Create a Kinesis client
   kinesis = boto3.client('kinesis', region_name='us-east-1')

   # Get the shard iterator
   shard_iterator = kinesis.get_shard_iterator(
       StreamName='YourStreamName',
       ShardId='YourShardId',
       ShardIteratorType='TRIM_HORIZON'
   )['ShardIterator']

   # Get the records from the shard
   records = kinesis.get_records(
       ShardIterator=shard_iterator,
       Limit=100
   )

   # Print the records
   for record in records['Records']:
       print(record)
   ```
4. **Run the Python Script**: Finally, you can run the Python script to get the shard level metrics. If there are any misconfigurations, you should be able to see them in the output of the script.

Please replace 'YourStreamName' and 'YourShardId' with your actual Stream Name and Shard ID.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration related to Kinesis Stream Shard Level Metrics in AWS DynamoDB, you can follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login using your credentials.

2. **Navigate to DynamoDB Service**: From the list of AWS services, click on "DynamoDB" to open the DynamoDB dashboard.

3. **Select the Table**: In the DynamoDB dashboard, select the table for which you want to remediate the misconfiguration related to Kinesis Stream Shard Level Metrics.

4. **Edit Table Settings**:
   - Click on the "Overview" tab for the selected table.
   - Scroll down to the "Table details" section and click on the "Manage stream" button.

5. **Update Stream Settings**:
   - In the "Manage stream" dialog box, select the option to enable the stream for the DynamoDB table.
   - Choose the stream view type as "New and old images" or "New images" based on your requirements.
   - Click on the "Create" button to save the changes.

6. **Verify Configuration**:
   - Once the stream is enabled for the DynamoDB table, verify that the Kinesis Stream Shard Level Metrics are now active and functioning properly.

By following these steps, you can successfully remediate the misconfiguration related to Kinesis Stream Shard Level Metrics in AWS DynamoDB using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration related to Kinesis Stream Shard Level Metrics in AWS DynamoDB using AWS CLI, follow these steps:

1. Open your terminal and configure AWS CLI with the necessary credentials by running the following command:
```
aws configure
```
Enter your AWS Access Key ID, Secret Access Key, default region, and default output format as prompted.

2. Enable Kinesis Stream Shard Level Metrics for the DynamoDB table using the AWS CLI by running the following command:
```
aws dynamodb update-continuous-backups --table-name YOUR_TABLE_NAME --point-in-time-recovery-specification PointInTimeRecoveryEnabled=true
```
Replace `YOUR_TABLE_NAME` with the name of your DynamoDB table.

3. Verify that Kinesis Stream Shard Level Metrics have been successfully enabled for the DynamoDB table by running the following command:
```
aws dynamodb describe-continuous-backups --table-name YOUR_TABLE_NAME
```
Replace `YOUR_TABLE_NAME` with the name of your DynamoDB table. Check the output to ensure that `PointInTimeRecoverySpecification` shows `PointInTimeRecoveryEnabled` as `true`.

By following these steps, you can remediate the misconfiguration related to Kinesis Stream Shard Level Metrics in AWS DynamoDB using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration related to Kinesis Stream Shard Level Metrics for AWS DynamoDB using Python, you can follow these steps:

1. **Install boto3**: If you haven't already, install the boto3 library in Python. You can do this using pip by running the following command:
   ```
   pip install boto3
   ```

2. **Update the CloudWatch Metrics Configuration**: Use the following Python script to update the CloudWatch Metrics configuration for the DynamoDB table:

```python
import boto3

def update_dynamodb_cloudwatch_metrics(table_name):
    client = boto3.client('dynamodb')

    response = client.update_continuous_backups(
        TableName=table_name,
        PointInTimeRecoverySpecification={
            'PointInTimeRecoveryEnabled': True
        }
    )

    print(response)

# Replace 'your_table_name' with the name of your DynamoDB table
update_dynamodb_cloudwatch_metrics('your_table_name')
```

3. **Run the Python Script**: Save the above Python script in a file, and run it in your Python environment. This script will enable continuous backups for the specified DynamoDB table, which will ensure that the CloudWatch Metrics for the table are properly configured.

By following these steps, you can remediate the misconfiguration related to Kinesis Stream Shard Level Metrics for AWS DynamoDB using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

