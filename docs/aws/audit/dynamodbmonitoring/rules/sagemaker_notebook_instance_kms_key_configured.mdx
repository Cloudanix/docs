---
slug: sagemaker_notebook_instance_kms_key_configured
title: Sagemaker Notebook Instance Should Have KMS Key Configured
sidebar_label: Sagemaker Notebook Instance Should Have KMS Key Configured
---

### More Info:

Sagemaker Notebook Instance Should Have KMS Key Configured

### Risk Level

High

### Address

Security

### Compliance Standards

ISO27001,HIPAA,NISTCSF,PCIDSS,AWSSSB,RBI_UCB


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon SageMaker console. You can find this by typing 'SageMaker' into the search bar at the top of the console.
3. In the left navigation pane, choose 'Notebook instances'.
4. In the 'Notebook instances' pane, select the notebook instance you want to check.
5. In the 'Security and access' section, look for the 'KMS key ID' field. If this field is empty or not configured, then the SageMaker Notebook Instance does not have a KMS Key configured.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the Sagemaker notebook instances. You can do this by using the AWS CLI command:

```bash
aws sagemaker list-notebook-instances --region <region-name>
```

2. Once you have the list of all Sagemaker notebook instances, you can describe each notebook instance to get its KMS key ID. Use the following command:

```bash
aws sagemaker describe-notebook-instance --notebook-instance-name <notebook-instance-name> --region <region-name>
```

3. From the output of the above command, check the "KmsKeyId" field. If it is not present or is empty, then the Sagemaker notebook instance does not have a KMS key configured.

4. Repeat the above steps for all the Sagemaker notebook instances in your AWS account. If any of them do not have a KMS key configured, then you have detected a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To check if a SageMaker Notebook Instance has a KMS Key configured in DynamoDB using Python scripts, you can follow these steps:

1. **Set up AWS SDK (Boto3) in Python:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials either by setting up environment variables or by using the AWS CLI.

2. **List all SageMaker Notebook Instances:**
   Use the `list_notebook_instances()` function from the `boto3` client for SageMaker to get all the notebook instances. Here is a sample script:
   ```python
   import boto3

   def list_sagemaker_instances():
       sagemaker = boto3.client('sagemaker')
       response = sagemaker.list_notebook_instances()
       return response['NotebookInstances']
   ```

3. **Check KMS Key for each Notebook Instance:**
   For each notebook instance, check if the `KmsKeyId` attribute is present. If it's not present, then the notebook instance does not have a KMS Key configured. Here is a sample script:
   ```python
   def check_kms_key(notebook_instances):
       for instance in notebook_instances:
           if 'KmsKeyId' not in instance:
               print(f"Notebook instance {instance['NotebookInstanceName']} does not have a KMS Key configured.")
   ```

4. **Combine the functions:**
   Finally, combine the two functions to get a list of all SageMaker notebook instances that do not have a KMS Key configured:
   ```python
   def main():
       notebook_instances = list_sagemaker_instances()
       check_kms_key(notebook_instances)

   if __name__ == "__main__":
       main()
   ```
   Run this script to get the list of misconfigured notebook instances.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not having a KMS key configured for an AWS Sagemaker Notebook Instance accessing AWS DynamoDB, follow these step-by-step instructions using the AWS Management Console:

1. **Create a KMS Key**:
   - Go to the AWS Management Console and navigate to the Key Management Service (KMS) service.
   - Click on "Create key" to create a new KMS key.
   - Choose the appropriate options for creating the key, such as the key material origin, key type, key description, and key administrators.
   - Click "Next" to define key permissions.
   - Add the necessary IAM roles or users that require access to the KMS key.
   - Click "Next" to review and then click "Finish" to create the KMS key.

2. **Update Sagemaker Notebook Instance**:
   - Go to the AWS Management Console and navigate to the Amazon Sagemaker service.
   - Select the Sagemaker Notebook Instance that needs to access DynamoDB.
   - Click on the "Permissions and encryption" tab.
   - Under the "Encryption key" section, click on "Change" to select the KMS key you created in step 1.
   - Select the KMS key from the dropdown menu and click "Save".

3. **Grant KMS Key Permissions**:
   - Ensure that the IAM roles or users that need to access the DynamoDB table have the necessary permissions to use the KMS key.
   - Go to the AWS Management Console and navigate to the IAM service.
   - Update the IAM policies attached to the roles or users to include permissions to use the KMS key.
   - Add the `kms:Decrypt` permission for the KMS key in the IAM policy attached to the role or user.

4. **Test Access**:
   - Test the Sagemaker Notebook Instance to ensure that it can access the DynamoDB table using the KMS key for encryption and decryption.
   - Verify that the data is being encrypted and decrypted properly when accessing DynamoDB.

By following these steps, you can remediate the misconfiguration of not having a KMS key configured for an AWS Sagemaker Notebook Instance accessing AWS DynamoDB.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Sagemaker Notebook Instance not having a KMS Key configured for AWS DynamoDB using AWS CLI, follow these steps:

1. **Create a KMS Key**:
   - Use the AWS CLI command to create a KMS key. Replace `<alias-name>` with your desired alias name.
     ```bash
     aws kms create-key --description "KMS Key for DynamoDB" --origin AWS_KMS --region <region>
     ```
   - Note down the `KeyId` from the output of the above command.

2. **Add an Alias to the KMS Key**:
   - Use the AWS CLI command to add an alias to the KMS key.
     ```bash
     aws kms create-alias --alias-name alias/<alias-name> --target-key-id <key-id> --region <region>
     ```

3. **Grant Key Usage Permissions**:
   - Use the AWS CLI command to grant key usage permissions to the Sagemaker Notebook Instance IAM role. Replace `<role-name>` with the name of your Sagemaker Notebook Instance IAM role.
     ```bash
     aws kms create-grant --key-id <key-id> --grantee-principal <role-arn> --operations "Encrypt" "Decrypt" --region <region>
     ```

4. **Update DynamoDB Table Encryption Settings**:
   - Use the AWS CLI command to update the DynamoDB table encryption settings. Replace `<table-name>` with the name of your DynamoDB table.
     ```bash
     aws dynamodb update-table --table-name <table-name> --sse-specification Enabled=true,KMSMasterKeyId=<key-id> --region <region>
     ```

5. **Verify Configuration**:
   - Verify that the KMS Key is configured for the DynamoDB table encryption.
     ```bash
     aws dynamodb describe-table --table-name <table-name> --query "Table.SSEDescription" --region <region>
     ```

By following these steps, you can remediate the misconfiguration of not having a KMS Key configured for AWS DynamoDB using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having a KMS key configured for an AWS Sagemaker Notebook Instance, follow these steps:

1. **Create a KMS Key**:
   - Go to the AWS Key Management Service (KMS) console.
   - Click on "Create key" button.
   - Choose the appropriate options for creating the KMS key, such as key type, key material origin, key administrators, and key usage permissions.
   - Click on "Create key" to create the KMS key.

2. **Update the Sagemaker Notebook Instance**:
   - Go to the AWS Sagemaker console.
   - Select the Notebook instance that needs to be updated.
   - Click on the "Permissions and encryption" tab.
   - Under the "Encryption key" section, select the KMS key that you created in step 1.
   - Click on "Update" to apply the KMS key to the Notebook instance.

3. **Verify the Configuration**:
   - Once the KMS key is applied to the Sagemaker Notebook instance, verify that the encryption is working as expected.
   - You can run a test notebook or script that interacts with AWS services like DynamoDB to ensure that the KMS key is being used for encryption.

4. **Update the DynamoDB Encryption**:
   - If you are using DynamoDB in your notebook, ensure that the DynamoDB client in your Python code is configured to use the KMS key for encryption.
   - Update the DynamoDB client configuration in your Python code to specify the KMS key ARN for encryption.

Here is an example of how you can update the DynamoDB client in Python to use the KMS key for encryption:

```python
import boto3

# Create a DynamoDB client with KMS encryption
dynamodb = boto3.client('dynamodb', region_name='your_region', aws_access_key_id='your_access_key', aws_secret_access_key='your_secret_key', encryption_type='KMS', encryption_key='your_kms_key_arn')

# Now you can use the DynamoDB client to interact with DynamoDB tables securely with KMS encryption
```

By following these steps, you can remediate the misconfiguration of not having a KMS key configured for an AWS Sagemaker Notebook Instance and ensure that data encryption is properly implemented when interacting with AWS services like DynamoDB.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

