---
slug: sagemaker_notebook_instance_kms_key_configured
title: Sagemaker Notebook Instance Should Have KMS Key Configured
sidebar_label: Sagemaker Notebook Instance Should Have KMS Key Configured
---

### More Info:

Sagemaker Notebook Instance Should Have KMS Key Configured

### Risk Level

High

### Address

Security

### Compliance Standards

ISO27001,HIPAA,NISTCSF,PCIDSS,AWSSSB,RBI_UCB

### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon SageMaker console. You can find this by typing 'SageMaker' into the search bar at the top of the console.
3. In the left navigation pane, choose 'Notebook instances'.
4. In the 'Notebook instances' pane, select the notebook instance you want to check.
5. In the 'Security and access' section, look for the 'KMS key ID' field. If this field is empty or not configured, then the SageMaker Notebook Instance does not have a KMS Key configured.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the Sagemaker notebook instances. You can do this by using the AWS CLI command:

```bash
aws sagemaker list-notebook-instances --region <region-name>
```

2. Once you have the list of all Sagemaker notebook instances, you can describe each notebook instance to get its KMS key ID. Use the following command:

```bash
aws sagemaker describe-notebook-instance --notebook-instance-name <notebook-instance-name> --region <region-name>
```

3. From the output of the above command, check the "KmsKeyId" field. If it is not present or is empty, then the Sagemaker notebook instance does not have a KMS key configured.

4. Repeat the above steps for all the Sagemaker notebook instances in your AWS account. If any of them do not have a KMS key configured, then you have detected a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To check if a SageMaker Notebook Instance has a KMS Key configured in DynamoDB using Python scripts, you can follow these steps:

1. **Set up AWS SDK (Boto3) in Python:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials either by setting up environment variables or by using the AWS CLI.

2. **List all SageMaker Notebook Instances:**
   Use the `list_notebook_instances()` function from the `boto3` client for SageMaker to get all the notebook instances. Here is a sample script:
   ```python
   import boto3

   def list_sagemaker_instances():
       sagemaker = boto3.client('sagemaker')
       response = sagemaker.list_notebook_instances()
       return response['NotebookInstances']
   ```

3. **Check KMS Key for each Notebook Instance:**
   For each notebook instance, check if the `KmsKeyId` attribute is present. If it's not present, then the notebook instance does not have a KMS Key configured. Here is a sample script:
   ```python
   def check_kms_key(notebook_instances):
       for instance in notebook_instances:
           if 'KmsKeyId' not in instance:
               print(f"Notebook instance {instance['NotebookInstanceName']} does not have a KMS Key configured.")
   ```

4. **Combine the functions:**
   Finally, combine the two functions to get a list of all SageMaker notebook instances that do not have a KMS Key configured:
   ```python
   def main():
       notebook_instances = list_sagemaker_instances()
       check_kms_key(notebook_instances)

   if __name__ == "__main__":
       main()
   ```
   Run this script to get the list of misconfigured notebook instances.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
**Sagemaker notebook instance cannot be encrypted after instance is created.**

To configure the KMS key, delete the existing notebook instance and create a new one by following the below steps.
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. **Log in to the AWS Management Console:**
   - Open the AWS Management Console and navigate to the SageMaker service.

2. **Create a New Notebook Instance:**
   - Click on "Create notebook instance."

3. **Configure Notebook Instance:**
   - Fill in the "Notebook instance name," "Notebook instance type," and other required fields.

4. **Configure Encryption:**
   - Scroll down to the "Encryption settings" section.
   - Under "KMS key," select an existing KMS key from the dropdown or enter the KMS key ID manually.

5. **Create the Notebook Instance:**
   - After configuring all necessary settings, click on "Create notebook instance."

</Accordion>

<Accordion title='Using CLI'>
To create a SageMaker notebook instance with a specified KMS key, you can use the following CLI command:

```sh
aws sagemaker create-notebook-instance \
    --notebook-instance-name <YourNotebookInstanceName> \
    --instance-type <InstanceType> \
    --role-arn <IAMRoleARN> \
    --kms-key-id <KMSKeyID> \
    --volume-size-in-gb <VolumeSize> \
    --default-code-repository <CodeRepositoryURL> \
    --additional-code-repositories <AdditionalCodeRepositories>
```

Replace the placeholders (`<YourNotebookInstanceName>`, `<InstanceType>`, `<IAMRoleARN>`, `<KMSKeyID>`, `<VolumeSize>`, `<CodeRepositoryURL>`, and `<AdditionalCodeRepositories>`) with appropriate values.
</Accordion>
<Accordion title='Using Python'>
To create a SageMaker notebook instance with a specified KMS key using a Python script, you'll need the `boto3` library:

1. **Install `boto3` (if not already installed):**

```sh
pip install boto3
```

2. **Script to Create a Notebook Instance:**

```python
import boto3

sagemaker = boto3.client('sagemaker')

def create_notebook_instance():
    response = sagemaker.create_notebook_instance(
        NotebookInstanceName='<YourNotebookInstanceName>',
        InstanceType='<InstanceType>',
        RoleArn='<IAMRoleARN>',
        KmsKeyId='<KMSKeyID>',
        VolumeSizeInGB=<VolumeSize>,
        DefaultCodeRepository='<CodeRepositoryURL>',
        AdditionalCodeRepositories=['<AdditionalCodeRepositories>']
    )
    print(response)

# Replace placeholders with appropriate values
create_notebook_instance()
```

Replace the placeholders (`<YourNotebookInstanceName>`, `<InstanceType>`, `<IAMRoleARN>`, `<KMSKeyID>`, `<VolumeSize>`, `<CodeRepositoryURL>`, and `<AdditionalCodeRepositories>`) with appropriate values.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>
