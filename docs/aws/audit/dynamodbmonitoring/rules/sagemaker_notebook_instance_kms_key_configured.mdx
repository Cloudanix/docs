---
slug: sagemaker_notebook_instance_kms_key_configured
title: Sagemaker Notebook Instance Should Have KMS Key Configured
sidebar_label: Sagemaker Notebook Instance Should Have KMS Key Configured
---

### More Info:

Sagemaker Notebook Instance Should Have KMS Key Configured

### Risk Level

High

### Address

Security

### Compliance Standards

ISO27001,HIPAA,NISTCSF,PCIDSS,AWSSSB,RBI_UCB

### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent a SageMaker Notebook Instance from lacking a KMS key configuration in AWS using the AWS Management Console, follow these steps:

1. **Navigate to SageMaker in the AWS Console:**
   - Open the AWS Management Console.
   - In the search bar, type "SageMaker" and select "Amazon SageMaker" from the results.

2. **Create or Modify a Notebook Instance:**
   - To create a new notebook instance, click on "Notebook instances" in the left-hand menu, then click the "Create notebook instance" button.
   - To modify an existing notebook instance, select the notebook instance from the list.

3. **Configure Encryption Settings:**
   - In the "Notebook instance settings" section, locate the "Encryption key" option.
   - Select a KMS key from the dropdown menu. If you do not have a KMS key, you can create one in the AWS KMS service.

4. **Save and Launch:**
   - For a new notebook instance, complete the remaining configuration options and click "Create notebook instance."
   - For an existing notebook instance, after selecting the KMS key, click "Update notebook instance" to apply the changes.

By following these steps, you ensure that your SageMaker Notebook Instance is configured with a KMS key, enhancing the security of your data.
</Accordion>

<Accordion title='Using CLI'>
To ensure that your SageMaker Notebook Instance has a KMS key configured using AWS CLI, follow these steps:

1. **Create a KMS Key:**
   First, create a KMS key if you don't already have one. This key will be used to encrypt the data in your SageMaker Notebook Instance.

   ```sh
   aws kms create-key --description "SageMaker Notebook KMS Key" --key-usage ENCRYPT_DECRYPT --origin AWS_KMS
   ```

2. **Get the KMS Key ID:**
   Retrieve the Key ID of the newly created KMS key. This will be used in the next step to configure the SageMaker Notebook Instance.

   ```sh
   aws kms list-keys
   ```

   Note the Key ID from the output.

3. **Create or Update SageMaker Notebook Instance with KMS Key:**
   When creating a new SageMaker Notebook Instance or updating an existing one, specify the KMS Key ID to ensure that the instance is encrypted.

   ```sh
   aws sagemaker create-notebook-instance --notebook-instance-name <YourNotebookInstanceName> --instance-type <InstanceType> --role-arn <YourRoleARN> --kms-key-id <YourKMSKeyID>
   ```

   If you are updating an existing instance, use:

   ```sh
   aws sagemaker update-notebook-instance --notebook-instance-name <YourNotebookInstanceName> --kms-key-id <YourKMSKeyID>
   ```

4. **Verify the Configuration:**
   Ensure that the SageMaker Notebook Instance is configured with the KMS key by describing the instance.

   ```sh
   aws sagemaker describe-notebook-instance --notebook-instance-name <YourNotebookInstanceName>
   ```

   Check the output to confirm that the `KmsKeyId` field is populated with your KMS Key ID.

By following these steps, you can ensure that your SageMaker Notebook Instance is properly configured with a KMS key using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of a SageMaker Notebook Instance not having a KMS key configured in DynamoDB using Python scripts, you can follow these steps:

1. **Install Required Libraries**:
   Ensure you have the `boto3` library installed, which is the AWS SDK for Python. You can install it using pip if you haven't already.

   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Configure your AWS credentials using the AWS CLI or by setting environment variables. This is necessary for `boto3` to authenticate your requests.

   ```bash
   aws configure
   ```

3. **Create a Python Script to Check and Configure KMS Key**:
   Write a Python script that checks if a SageMaker Notebook Instance has a KMS key configured and configures it if not.

   ```python
   import boto3

   def ensure_kms_key_for_sagemaker_notebook(instance_name, kms_key_id):
       sagemaker_client = boto3.client('sagemaker')
       response = sagemaker_client.describe_notebook_instance(NotebookInstanceName=instance_name)
       
       if 'KmsKeyId' not in response or not response['KmsKeyId']:
           print(f"No KMS Key configured for {instance_name}. Configuring KMS Key...")
           sagemaker_client.update_notebook_instance(
               NotebookInstanceName=instance_name,
               KmsKeyId=kms_key_id
           )
           print(f"KMS Key {kms_key_id} configured for {instance_name}.")
       else:
           print(f"KMS Key already configured for {instance_name}: {response['KmsKeyId']}")

   # Example usage
   instance_name = 'your-notebook-instance-name'
   kms_key_id = 'your-kms-key-id'
   ensure_kms_key_for_sagemaker_notebook(instance_name, kms_key_id)
   ```

4. **Run the Script**:
   Execute the script to ensure that your SageMaker Notebook Instance has a KMS key configured.

   ```bash
   python ensure_kms_key.py
   ```

This script will check if the specified SageMaker Notebook Instance has a KMS key configured. If not, it will configure the specified KMS key for the instance. Make sure to replace `'your-notebook-instance-name'` and `'your-kms-key-id'` with your actual SageMaker Notebook Instance name and KMS key ID.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon SageMaker console. You can find this by typing 'SageMaker' into the search bar at the top of the console.
3. In the left navigation pane, choose 'Notebook instances'.
4. In the 'Notebook instances' pane, select the notebook instance you want to check.
5. In the 'Security and access' section, look for the 'KMS key ID' field. If this field is empty or not configured, then the SageMaker Notebook Instance does not have a KMS Key configured.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the Sagemaker notebook instances. You can do this by using the AWS CLI command:

```bash
aws sagemaker list-notebook-instances --region <region-name>
```

2. Once you have the list of all Sagemaker notebook instances, you can describe each notebook instance to get its KMS key ID. Use the following command:

```bash
aws sagemaker describe-notebook-instance --notebook-instance-name <notebook-instance-name> --region <region-name>
```

3. From the output of the above command, check the "KmsKeyId" field. If it is not present or is empty, then the Sagemaker notebook instance does not have a KMS key configured.

4. Repeat the above steps for all the Sagemaker notebook instances in your AWS account. If any of them do not have a KMS key configured, then you have detected a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To check if a SageMaker Notebook Instance has a KMS Key configured in DynamoDB using Python scripts, you can follow these steps:

1. **Set up AWS SDK (Boto3) in Python:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials either by setting up environment variables or by using the AWS CLI.

2. **List all SageMaker Notebook Instances:**
   Use the `list_notebook_instances()` function from the `boto3` client for SageMaker to get all the notebook instances. Here is a sample script:
   ```python
   import boto3

   def list_sagemaker_instances():
       sagemaker = boto3.client('sagemaker')
       response = sagemaker.list_notebook_instances()
       return response['NotebookInstances']
   ```

3. **Check KMS Key for each Notebook Instance:**
   For each notebook instance, check if the `KmsKeyId` attribute is present. If it's not present, then the notebook instance does not have a KMS Key configured. Here is a sample script:
   ```python
   def check_kms_key(notebook_instances):
       for instance in notebook_instances:
           if 'KmsKeyId' not in instance:
               print(f"Notebook instance {instance['NotebookInstanceName']} does not have a KMS Key configured.")
   ```

4. **Combine the functions:**
   Finally, combine the two functions to get a list of all SageMaker notebook instances that do not have a KMS Key configured:
   ```python
   def main():
       notebook_instances = list_sagemaker_instances()
       check_kms_key(notebook_instances)

   if __name__ == "__main__":
       main()
   ```
   Run this script to get the list of misconfigured notebook instances.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
**Sagemaker notebook instance cannot be encrypted after instance is created.**

To configure the KMS key, delete the existing notebook instance and create a new one by following the below steps.
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. **Log in to the AWS Management Console:**
   - Open the AWS Management Console and navigate to the SageMaker service.

2. **Create a New Notebook Instance:**
   - Click on "Create notebook instance."

3. **Configure Notebook Instance:**
   - Fill in the "Notebook instance name," "Notebook instance type," and other required fields.

4. **Configure Encryption:**
   - Scroll down to the "Encryption settings" section.
   - Under "KMS key," select an existing KMS key from the dropdown or enter the KMS key ID manually.

5. **Create the Notebook Instance:**
   - After configuring all necessary settings, click on "Create notebook instance."

</Accordion>

<Accordion title='Using CLI'>
To create a SageMaker notebook instance with a specified KMS key, you can use the following CLI command:

```sh
aws sagemaker create-notebook-instance \
    --notebook-instance-name <YourNotebookInstanceName> \
    --instance-type <InstanceType> \
    --role-arn <IAMRoleARN> \
    --kms-key-id <KMSKeyID> \
    --volume-size-in-gb <VolumeSize> \
    --default-code-repository <CodeRepositoryURL> \
    --additional-code-repositories <AdditionalCodeRepositories>
```

Replace the placeholders (`<YourNotebookInstanceName>`, `<InstanceType>`, `<IAMRoleARN>`, `<KMSKeyID>`, `<VolumeSize>`, `<CodeRepositoryURL>`, and `<AdditionalCodeRepositories>`) with appropriate values.
</Accordion>
<Accordion title='Using Python'>
To create a SageMaker notebook instance with a specified KMS key using a Python script, you'll need the `boto3` library:

1. **Install `boto3` (if not already installed):**

```sh
pip install boto3
```

2. **Script to Create a Notebook Instance:**

```python
import boto3

sagemaker = boto3.client('sagemaker')

def create_notebook_instance():
    response = sagemaker.create_notebook_instance(
        NotebookInstanceName='<YourNotebookInstanceName>',
        InstanceType='<InstanceType>',
        RoleArn='<IAMRoleARN>',
        KmsKeyId='<KMSKeyID>',
        VolumeSizeInGB=<VolumeSize>,
        DefaultCodeRepository='<CodeRepositoryURL>',
        AdditionalCodeRepositories=['<AdditionalCodeRepositories>']
    )
    print(response)

# Replace placeholders with appropriate values
create_notebook_instance()
```

Replace the placeholders (`<YourNotebookInstanceName>`, `<InstanceType>`, `<IAMRoleARN>`, `<KMSKeyID>`, `<VolumeSize>`, `<CodeRepositoryURL>`, and `<AdditionalCodeRepositories>`) with appropriate values.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>
