---
slug: sagemaker_endpoint_configuration_kms_key_configured
title: Sagemaker Endpoint Should Have KMS Key  Configured
sidebar_label: Sagemaker Endpoint Should Have KMS Key  Configured
---

### More Info:

Ensure Sagemaker enpoint has KMS key configured

### Risk Level

High

### Address

Security

### Compliance Standards

ISO27001,HIPAA,NISTCSF,PCIDSS,AWSSSB,RBI_UCB



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon SageMaker console at https://console.aws.amazon.com/sagemaker/.

2. In the left navigation pane, choose "Endpoint configurations".

3. In the Endpoint configurations pane, select the endpoint configuration that you want to examine.

4. In the details pane, under the "Production variants" section, check the "KMS key" field. If the field is empty or not configured with a KMS key, then the SageMaker endpoint is not encrypted with a KMS key, indicating a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the SageMaker endpoints in your account by running the following command:

   ```
   aws sagemaker list-endpoints --region your-region-name
   ```
   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all SageMaker endpoints in the specified region.

3. For each endpoint, you can describe the endpoint configuration to check if a KMS key is configured. Use the following command:

   ```
   aws sagemaker describe-endpoint-config --endpoint-config-name your-endpoint-config-name --region your-region-name
   ```
   Replace 'your-endpoint-config-name' with the name of your endpoint configuration and 'your-region-name' with the name of your AWS region. This command will return the details of the specified endpoint configuration.

4. In the output of the above command, look for the 'KmsKeyId' field. If this field is not present or is empty, then the SageMaker endpoint does not have a KMS key configured. If the 'KmsKeyId' field is present and contains a value, then a KMS key is configured for the endpoint.

#### Using Python

To detect if a SageMaker endpoint has a KMS key configured in DynamoDB using Python scripts, you can follow these steps:

1. **Import necessary libraries and establish a session:**

    You will need to import the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You will also need to establish a session using your AWS credentials.

    ```python
    import boto3

    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='us-west-2'
    )
    ```

2. **Create a SageMaker client:**

    Using the session you created, you can now create a SageMaker client. This client will allow you to interact with the SageMaker service and its resources.

    ```python
    sagemaker = session.client('sagemaker')
    ```

3. **List all SageMaker endpoints:**

    You can now list all the SageMaker endpoints in your account. For each endpoint, you will need to check if it has a KMS key configured.

    ```python
    response = sagemaker.list_endpoints(
        MaxResults=100
    )

    for endpoint in response['Endpoints']:
        print(endpoint['EndpointName'])
    ```

4. **Check if KMS key is configured:**

    For each endpoint, you can describe the endpoint configuration and check if a KMS key is configured. If the 'KmsKeyId' field is not present or is empty, then the endpoint does not have a KMS key configured.

    ```python
    for endpoint in response['Endpoints']:
        endpoint_config = sagemaker.describe_endpoint_config(
            EndpointConfigName=endpoint['EndpointConfigName']
        )

        if 'KmsKeyId' not in endpoint_config or not endpoint_config['KmsKeyId']:
            print(f"Endpoint {endpoint['EndpointName']} does not have a KMS key configured.")
    ```

This script will print out the names of all SageMaker endpoints that do not have a KMS key configured.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of a Sagemaker Endpoint not having a KMS key configured for AWS DynamoDB using the AWS console, follow these steps:

1. **Open AWS Management Console**: Go to the AWS Management Console at https://aws.amazon.com/ and log in to your account.

2. **Navigate to Amazon Sagemaker Console**: Click on the "Services" dropdown menu at the top left corner of the console, search for "Sagemaker" and click on it to open the Amazon Sagemaker console.

3. **Select Endpoints**: In the Amazon Sagemaker console, click on "Endpoints" from the left-hand side menu to view the list of endpoints.

4. **Select the Endpoint**: Identify the Sagemaker Endpoint that is connected to the AWS DynamoDB table that needs a KMS key configured and click on its name to open the details page.

5. **Edit Endpoint Configuration**: On the details page of the Sagemaker Endpoint, click on the "Edit" button to modify the endpoint configuration.

6. **Configure KMS Key**: In the Endpoint configuration settings, look for the option to configure the KMS key for the endpoint. If the option is not available, it means that the endpoint is not encrypted with a KMS key.

7. **Select KMS Key**: Click on the dropdown menu or input field to select or enter the KMS key that you want to use to encrypt the data for the Sagemaker Endpoint connected to the DynamoDB table.

8. **Save Changes**: After selecting the appropriate KMS key, click on the "Save" or "Update" button to apply the changes to the Sagemaker Endpoint configuration.

9. **Verify Configuration**: Once the changes are saved, verify that the KMS key is successfully configured for the Sagemaker Endpoint connected to the AWS DynamoDB table by checking the endpoint details.

By following these steps, you can remediate the misconfiguration of a Sagemaker Endpoint not having a KMS key configured for AWS DynamoDB using the AWS console.

#### Using CLI

To remediate the misconfiguration of Sagemaker Endpoint not having a KMS Key configured for AWS DynamoDB using AWS CLI, follow these steps:

1. **Identify the Sagemaker Endpoint**: Use the AWS CLI command to identify the Sagemaker Endpoint that needs to have a KMS Key configured. You can list all the Sagemaker endpoints using the following command:
   ```
   aws sagemaker list-endpoints
   ```

2. **Get the ARN of the Sagemaker Endpoint**: Once you have identified the Sagemaker Endpoint that needs to be configured, get the ARN of that endpoint using the following command:
   ```
   aws sagemaker describe-endpoint --endpoint-name <endpoint-name>
   ```

3. **Identify the KMS Key**: Next, identify the KMS Key that you want to associate with the Sagemaker Endpoint. You can list all the available KMS keys using the following command:
   ```
   aws kms list-keys
   ```

4. **Update the Sagemaker Endpoint Configuration**: Update the Sagemaker Endpoint configuration to associate it with the KMS Key. Use the following command to update the Sagemaker Endpoint configuration:
   ```
   aws sagemaker update-endpoint --endpoint-name <endpoint-name> --kms-key-id <kms-key-id>
   ```

Replace `<endpoint-name>` with the actual name of the Sagemaker Endpoint and `<kms-key-id>` with the ARN of the KMS Key that you want to associate with the Sagemaker Endpoint.

By following these steps, you can successfully remediate the misconfiguration of the Sagemaker Endpoint not having a KMS Key configured for AWS DynamoDB using AWS CLI.

#### Using Python

To remediate the misconfiguration of Sagemaker Endpoint not having a KMS Key configured in AWS, you can follow these steps using Python:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the DynamoDB client:
```python
dynamodb = boto3.client('dynamodb')
```

3. Get the list of all the Sagemaker endpoints:
```python
endpoints = sagemaker.list_endpoints()
```

4. For each Sagemaker endpoint, check if it is using the KMS key:
```python
for endpoint in endpoints['Endpoints']:
    endpoint_name = endpoint['EndpointName']
    endpoint_config_name = endpoint['EndpointConfigName']
    
    response = sagemaker.describe_endpoint_config(EndpointConfigName=endpoint_config_name)
    kms_key_id = response['ProductionVariants'][0]['ModelVariant']['InitialInstanceCount']['SecurityGroupIds']
    
    if not kms_key_id:
        # Get the KMS Key ARN
        kms_key_arn = 'YOUR_KMS_KEY_ARN'
        
        # Update the Sagemaker endpoint configuration with the KMS Key
        response = sagemaker.update_endpoint(EndpointName=endpoint_name, 
                                             EndpointConfigName=endpoint_config_name, 
                                             KmsKeyId=kms_key_arn)
        
        print(f"KMS Key configured for Sagemaker endpoint: {endpoint_name}")
```

5. Run the Python script to remediate the misconfiguration of Sagemaker Endpoint not having a KMS Key configured.

By following these steps, you can remediate the misconfiguration of Sagemaker Endpoint not having a KMS Key configured in AWS DynamoDB using Python.



</Tab>
</Tabs>