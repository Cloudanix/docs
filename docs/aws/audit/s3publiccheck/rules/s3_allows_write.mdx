---
slug: s3_allows_write
title: S3 Buckets Should Not Allow Public Writes
sidebar_label: S3 Buckets Should Not Allow Public Writes
---

### More Info:

AWS S3 buckets should not be publicly accessible for WRITE actions via S3 access control lists (ACLs), in order to protect your S3 data from unauthorized users.

### Risk Level

Critical

### Address

Security

### Compliance Standards

HIPAA, PCIDSS, NIST


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 buckets from allowing public writes using the AWS Management Console, follow these steps:

1. **Navigate to S3 Service:**
   - Open the AWS Management Console.
   - In the Services menu, select "S3" to go to the Amazon S3 console.

2. **Select the Bucket:**
   - In the S3 console, you will see a list of your buckets. Click on the name of the bucket you want to configure.

3. **Bucket Permissions:**
   - Once inside the bucket, go to the "Permissions" tab.
   - Under the "Block public access (bucket settings)" section, click on "Edit".

4. **Block Public Access:**
   - Ensure that the following options are checked:
     - "Block all public access"
     - "Block public access to buckets and objects granted through new access control lists (ACLs)"
     - "Block public access to buckets and objects granted through any access control lists (ACLs)"
     - "Block public access to buckets and objects granted through new public bucket or access point policies"
   - Click "Save changes" to apply the settings.

By following these steps, you can prevent public write access to your S3 buckets using the AWS Management Console.
</Accordion>

<Accordion title='Using CLI'>
To prevent S3 buckets from allowing public writes using the AWS CLI, you can follow these steps:

1. **Create a Bucket Policy to Deny Public Write Access:**
   Use the `aws s3api put-bucket-policy` command to apply a policy that denies public write access to your S3 bucket.

   ```sh
   aws s3api put-bucket-policy --bucket your-bucket-name --policy '{
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Deny",
               "Principal": "*",
               "Action": "s3:PutObject",
               "Resource": "arn:aws:s3:::your-bucket-name/*",
               "Condition": {
                   "StringEquals": {
                       "aws:PrincipalType": "Anonymous"
                   }
               }
           }
       ]
   }'
   ```

2. **Block Public Access Settings:**
   Use the `aws s3api put-public-access-block` command to block public access settings for the bucket.

   ```sh
   aws s3api put-public-access-block --bucket your-bucket-name --public-access-block-configuration '{
       "BlockPublicAcls": true,
       "IgnorePublicAcls": true,
       "BlockPublicPolicy": true,
       "RestrictPublicBuckets": true
   }'
   ```

3. **Remove Existing Public Access Control Lists (ACLs):**
   Use the `aws s3api put-bucket-acl` command to set the ACL to private, removing any public access.

   ```sh
   aws s3api put-bucket-acl --bucket your-bucket-name --acl private
   ```

4. **Verify Bucket Policy and ACLs:**
   Use the `aws s3api get-bucket-policy` and `aws s3api get-bucket-acl` commands to verify that the bucket policy and ACLs are correctly configured to prevent public writes.

   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   aws s3api get-bucket-acl --bucket your-bucket-name
   ```

By following these steps, you can ensure that your S3 bucket does not allow public write access.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 buckets from allowing public writes using Python scripts, you can use the AWS SDK for Python, known as Boto3. Here are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Create a Boto3 Session**:
   Initialize a Boto3 session with your AWS credentials.
   ```python
   import boto3

   # Initialize a session using Amazon S3
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )

   s3 = session.client('s3')
   ```

3. **List All S3 Buckets**:
   Retrieve a list of all S3 buckets in your account.
   ```python
   response = s3.list_buckets()
   buckets = [bucket['Name'] for bucket in response['Buckets']]
   ```

4. **Update Bucket Policies to Prevent Public Writes**:
   Iterate through each bucket and update its policy to ensure it does not allow public writes.
   ```python
   for bucket in buckets:
       try:
           # Get the current bucket policy
           policy = s3.get_bucket_policy(Bucket=bucket)
           policy_statements = policy['Policy']['Statement']

           # Check and update the policy statements
           for statement in policy_statements:
               if statement['Effect'] == 'Allow' and 's3:PutObject' in statement['Action']:
                   if 'Principal' in statement and statement['Principal'] == '*':
                       # Remove or update the statement to prevent public writes
                       statement['Effect'] = 'Deny'

           # Update the bucket policy
           s3.put_bucket_policy(
               Bucket=bucket,
               Policy=json.dumps(policy)
           )
           print(f"Updated policy for bucket: {bucket}")

       except s3.exceptions.NoSuchBucketPolicy:
           print(f"No policy found for bucket: {bucket}")
       except Exception as e:
           print(f"Error updating policy for bucket {bucket}: {e}")
   ```

This script ensures that no S3 bucket in your account allows public write access by checking and updating the bucket policies accordingly.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for public write access.

3. Choose the Permissions tab.

4. Under the "Block Public Access" settings, check if "Block all public access" is turned on. If it is, then your bucket does not allow public writes. If it's off, you need to check the bucket policy and ACLs.

5. Under the "Bucket Policy" or "Access Control List", look for any statements with "Effect": "Allow" and "Principal": "*". If such statements exist and the "Action" includes "s3:PutObject", "s3:PutObjectAcl", or any other write permissions, then your bucket allows public writes.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation: `pip install awscli`
   
   Configuration: `aws configure`

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account:

   `aws s3api list-buckets --query "Buckets[].Name"`

3. Check bucket policy: For each bucket, check the bucket policy to see if it allows public write access. You can do this by running the following command:

   `aws s3api get-bucket-policy --bucket bucket-name`

   Replace "bucket-name" with the name of your bucket. This command will return the bucket's policy.

4. Analyze the policy: Look for any statements in the policy that have "Effect": "Allow" and "Principal": "*". If such a statement also includes "Action": "s3:PutObject" or "Action": "s3:*", then the bucket allows public write access.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. At the very least, the contents of the file should be:

   ```bash
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check S3 bucket permissions: The following script will list all your S3 buckets and check if they allow public write access.

   ```python
   import boto3

   s3 = boto3.client('s3')

   # List all S3 buckets
   buckets = s3.list_buckets()
   for bucket in buckets['Buckets']:
       # Get bucket policy
       policy = s3.get_bucket_policy(Bucket=bucket['Name'])
       # Check if policy allows public write access
       if 'Statement' in policy['Policy']:
           for statement in policy['Policy']['Statement']:
               if statement['Effect'] == 'Allow' and 'Principal' in statement and statement['Principal'] == '*':
                   if 'Action' in statement and 's3:PutObject' in statement['Action']:
                       print(f"Bucket {bucket['Name']} allows public write access")
   ```

4. Run the script: You can run the script using the Python interpreter. The script will print the names of all S3 buckets that allow public write access.

   ```bash
   python check_s3_permissions.py
   ```
   
Please note that this script only checks for explicit public write permissions in the bucket policy. There are other ways to allow public write access to an S3 bucket, such as through the bucket ACL or through a bucket policy that allows public access to a specific prefix.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the misconfiguration in AWS:

1. Log in to the AWS Management Console.
2. Navigate to the S3 service.
3. Click on the name of the bucket that you want to remediate.
4. Click on the "Permissions" tab.
5. Under the "Block public access (bucket settings)" section, click on "Edit".
6. Uncheck the box next to "Block all public access".
7. Check the box next to "Block public access to buckets and objects granted through new public bucket policies".
8. Check the box next to "Block public and cross-account access to buckets and objects through any public bucket policies".
9. Click on "Save changes".

After following these steps, your S3 bucket will no longer allow public writes.

#
</Accordion>

<Accordion title='Using CLI'>
The following steps can be taken to remediate the S3 bucket public write issue in AWS using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the S3 buckets in your AWS account:

```
aws s3 ls
```

3. Identify the S3 bucket that has public write access.

4. Run the following command to remove public write access from the S3 bucket:

```
aws s3api put-bucket-acl --bucket BUCKET-NAME --acl private
```

Replace `BUCKET-NAME` with the name of the S3 bucket that has public write access.

5. Run the following command to verify that the public write access has been removed from the S3 bucket:

```
aws s3api get-bucket-acl --bucket BUCKET-NAME
```

Replace `BUCKET-NAME` with the name of the S3 bucket that has public write access.

6. If the above command returns the following output, then public write access has been successfully removed from the S3 bucket:

```
{
    "Grants": [
        {
            "Grantee": {
                "Type": "CanonicalUser",
                "ID": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
            },
            "Permission": "FULL_CONTROL"
        }
    ],
    "Owner": {
        "DisplayName": "owner-name",
        "ID": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    }
}
```

Note: It is important to regularly audit the S3 buckets in your AWS account to ensure that they are not publicly accessible and have the appropriate access controls in place.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "S3 Buckets Should Not Allow Public Writes" in AWS, you can use the following steps in Python:

1. Install the AWS SDK for Python (Boto3) using the command `pip install boto3`.

2. Create an S3 client using the following code:

```
import boto3

s3 = boto3.client('s3')
```

3. Get a list of all S3 buckets in your AWS account using the `list_buckets()` method:

```
response = s3.list_buckets()

for bucket in response['Buckets']:
    bucket_name = bucket['Name']
```

4. For each bucket, check if it allows public write access using the `get_bucket_acl()` method:

```
acl = s3.get_bucket_acl(Bucket=bucket_name)

for grant in acl['Grants']:
    grantee = grant['Grantee']
    permission = grant['Permission']
    
    if 'URI' in grantee and grantee['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers' and permission == 'WRITE':
        # Bucket allows public write access
```

5. If the bucket allows public write access, remove the permission using the `put_bucket_acl()` method:

```
s3.put_bucket_acl(
    Bucket=bucket_name,
    ACL='private'
)
```

The final code to remediate the misconfiguration "S3 Buckets Should Not Allow Public Writes" in AWS using Python will look something like this:

```
import boto3

s3 = boto3.client('s3')

response = s3.list_buckets()

for bucket in response['Buckets']:
    bucket_name = bucket['Name']
    
    acl = s3.get_bucket_acl(Bucket=bucket_name)

    for grant in acl['Grants']:
        grantee = grant['Grantee']
        permission = grant['Permission']

        if 'URI' in grantee and grantee['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers' and permission == 'WRITE':
            s3.put_bucket_acl(
                Bucket=bucket_name,
                ACL='private'
            )
```
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

