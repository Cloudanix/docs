---
slug: s3_allows_write
title: S3 Buckets Should Not Allow Public Writes
sidebar_label: S3 Buckets Should Not Allow Public Writes
---

### More Info:

AWS S3 buckets should not be publicly accessible for WRITE actions via S3 access control lists (ACLs), in order to protect your S3 data from unauthorized users.

### Risk Level

Critical

### Address

Security

### Compliance Standards

HIPAA, PCIDSS, NIST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for public write access.

3. Choose the Permissions tab. Under the "Block public access" section, check if the "Block all public access" is set to On. If it is set to Off, it means the bucket might be publicly accessible.

4. Under the same Permissions tab, scroll down to the "Bucket Policy" section. Check the policy for any statements with "Effect": "Allow" and "Principal": "*". If such statements exist and the "Action" includes "s3:Put*", it means the bucket allows public write access.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all S3 buckets: Once your AWS CLI is set up, you can list all your S3 buckets by running the following command:
   ```
   aws s3api list-buckets --query "Buckets[].Name"
   ```
   This command will return a list of all your S3 bucket names.

3. Check bucket policy: For each bucket, you can check its policy using the following command:
   ```
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```
   Replace "your-bucket-name" with the name of your bucket. This command will return the bucket's policy.

4. Check for public write permissions: In the returned policy, look for any statements with "Effect": "Allow" and "Principal": "*". If the "Action" in such a statement includes "s3:PutObject", "s3:Put*", or "s3:*", then the bucket allows public write access.

#### Using Python

1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then, input your access key, secret access key, and your preferred AWS region when prompted.

3. Write a Python script to check S3 bucket permissions: The following script lists all your S3 buckets and checks if they allow public write access:

   ```python
   import boto3

   s3 = boto3.client('s3')

   # List all S3 buckets
   buckets = s3.list_buckets()
   for bucket in buckets['Buckets']:
       # Get bucket policy
       policy = s3.get_bucket_policy(Bucket=bucket['Name'])
       # Check if policy allows public write access
       if 'Statement' in policy['Policy']:
           for statement in policy['Policy']['Statement']:
               if statement['Effect'] == 'Allow' and 'Principal' in statement and statement['Principal'] == '*':
                   if 'Action' in statement and 's3:PutObject' in statement['Action']:
                       print(f"Bucket {bucket['Name']} allows public write access")
   ```

4. Run the script: Save the script to a file, e.g., check_s3_permissions.py, and run it with Python:

   ```bash
   python check_s3_permissions.py
   ```

   The script will print the names of all S3 buckets that allow public write access. If no such buckets exist, it will print nothing.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration in AWS:

1. Log in to the AWS Management Console.
2. Navigate to the S3 service.
3. Click on the name of the bucket that you want to remediate.
4. Click on the "Permissions" tab.
5. Under the "Block public access (bucket settings)" section, click on "Edit".
6. Uncheck the box next to "Block all public access".
7. Check the box next to "Block public access to buckets and objects granted through new public bucket policies".
8. Check the box next to "Block public and cross-account access to buckets and objects through any public bucket policies".
9. Click on "Save changes".

After following these steps, your S3 bucket will no longer allow public writes.

#### Using CLI

The following steps can be taken to remediate the S3 bucket public write issue in AWS using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the S3 buckets in your AWS account:

```
aws s3 ls
```

3. Identify the S3 bucket that has public write access.

4. Run the following command to remove public write access from the S3 bucket:

```
aws s3api put-bucket-acl --bucket BUCKET-NAME --acl private
```

Replace `BUCKET-NAME` with the name of the S3 bucket that has public write access.

5. Run the following command to verify that the public write access has been removed from the S3 bucket:

```
aws s3api get-bucket-acl --bucket BUCKET-NAME
```

Replace `BUCKET-NAME` with the name of the S3 bucket that has public write access.

6. If the above command returns the following output, then public write access has been successfully removed from the S3 bucket:

```
{
    "Grants": [
        {
            "Grantee": {
                "Type": "CanonicalUser",
                "ID": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
            },
            "Permission": "FULL_CONTROL"
        }
    ],
    "Owner": {
        "DisplayName": "owner-name",
        "ID": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    }
}
```

Note: It is important to regularly audit the S3 buckets in your AWS account to ensure that they are not publicly accessible and have the appropriate access controls in place.

#### Using Python

To remediate the misconfiguration "S3 Buckets Should Not Allow Public Writes" in AWS, you can use the following steps in Python:

1. Install the AWS SDK for Python (Boto3) using the command `pip install boto3`.

2. Create an S3 client using the following code:

```
import boto3

s3 = boto3.client('s3')
```

3. Get a list of all S3 buckets in your AWS account using the `list_buckets()` method:

```
response = s3.list_buckets()

for bucket in response['Buckets']:
    bucket_name = bucket['Name']
```

4. For each bucket, check if it allows public write access using the `get_bucket_acl()` method:

```
acl = s3.get_bucket_acl(Bucket=bucket_name)

for grant in acl['Grants']:
    grantee = grant['Grantee']
    permission = grant['Permission']
    
    if 'URI' in grantee and grantee['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers' and permission == 'WRITE':
        # Bucket allows public write access
```

5. If the bucket allows public write access, remove the permission using the `put_bucket_acl()` method:

```
s3.put_bucket_acl(
    Bucket=bucket_name,
    ACL='private'
)
```

The final code to remediate the misconfiguration "S3 Buckets Should Not Allow Public Writes" in AWS using Python will look something like this:

```
import boto3

s3 = boto3.client('s3')

response = s3.list_buckets()

for bucket in response['Buckets']:
    bucket_name = bucket['Name']
    
    acl = s3.get_bucket_acl(Bucket=bucket_name)

    for grant in acl['Grants']:
        grantee = grant['Grantee']
        permission = grant['Permission']

        if 'URI' in grantee and grantee['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers' and permission == 'WRITE':
            s3.put_bucket_acl(
                Bucket=bucket_name,
                ACL='private'
            )
```

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 


</Tab>
</Tabs>