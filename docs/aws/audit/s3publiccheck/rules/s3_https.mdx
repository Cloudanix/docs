---
slug: s3_https
title: S3 Buckets Should Have A Secure Transport Policy
sidebar_label: S3 Buckets Should Have A Secure Transport Policy
---

### More Info:

AWS S3 buckets should enforce encryption of data over the network (as it travels to and from Amazon S3) using Secure Sockets Layer (SSL).

### Risk Level

Critical

### Address

Security

### Compliance Standards

HIPAA, CISAWS, CBP, GDPR, NIST, SOC2, PCIDSS, ISO27001, AWSWAF, HITRUST, NISTCSF


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 buckets from allowing insecure transport (i.e., HTTP instead of HTTPS) using the AWS Management Console, follow these steps:

1. **Navigate to S3 Service:**
   - Open the AWS Management Console.
   - In the Services menu, select "S3" to go to the Amazon S3 dashboard.

2. **Select the Bucket:**
   - In the S3 dashboard, find and click on the name of the bucket you want to configure.

3. **Go to Permissions Tab:**
   - Once inside the bucket, click on the "Permissions" tab.

4. **Add a Bucket Policy for Secure Transport:**
   - Scroll down to the "Bucket policy" section and click on the "Edit" button.
   - Add a policy that denies any requests that are not using HTTPS. Here is an example policy:
     ```json
     {
       "Version": "2012-10-17",
       "Id": "PolicyForSecureTransport",
       "Statement": [
         {
           "Sid": "DenyInsecureTransport",
           "Effect": "Deny",
           "Principal": "*",
           "Action": "s3:*",
           "Resource": [
             "arn:aws:s3:::your-bucket-name",
             "arn:aws:s3:::your-bucket-name/*"
           ],
           "Condition": {
             "Bool": {
               "aws:SecureTransport": "false"
             }
           }
         }
       ]
     }
     ```
   - Replace `your-bucket-name` with the actual name of your S3 bucket.
   - Click "Save changes" to apply the policy.

By following these steps, you ensure that your S3 bucket only allows secure (HTTPS) transport, thereby preventing insecure access.
</Accordion>

<Accordion title='Using CLI'>
To prevent S3 buckets from allowing insecure transport (i.e., HTTP instead of HTTPS), you can enforce a secure transport policy using AWS CLI. Here are the steps:

1. **Create a Bucket Policy JSON File:**
   Create a JSON file (e.g., `secure-transport-policy.json`) with the following content to enforce HTTPS:

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Sid": "EnforceHTTPS",
         "Effect": "Deny",
         "Principal": "*",
         "Action": "s3:*",
         "Resource": [
           "arn:aws:s3:::your-bucket-name",
           "arn:aws:s3:::your-bucket-name/*"
         ],
         "Condition": {
           "Bool": {
             "aws:SecureTransport": "false"
           }
         }
       }
     ]
   }
   ```

2. **Apply the Bucket Policy:**
   Use the `aws s3api put-bucket-policy` command to apply the policy to your S3 bucket.

   ```sh
   aws s3api put-bucket-policy --bucket your-bucket-name --policy file://secure-transport-policy.json
   ```

3. **Verify the Bucket Policy:**
   Use the `aws s3api get-bucket-policy` command to verify that the policy has been applied correctly.

   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```

4. **Test the Policy:**
   Attempt to access the bucket using HTTP to ensure that the policy is working as expected. You should receive an access denied error.

By following these steps, you can ensure that your S3 bucket enforces secure transport, preventing any insecure HTTP access.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 buckets from allowing insecure transport (i.e., HTTP instead of HTTPS), you can enforce a bucket policy that denies any requests that do not use secure transport. Below are the steps to achieve this using a Python script with the Boto3 library:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

3. **Create a Python Script**:
   Write a Python script to apply a bucket policy that enforces secure transport.

4. **Run the Script**:
   Execute the script to apply the policy to your S3 bucket.

Here is a sample Python script to enforce secure transport on an S3 bucket:

```python
import boto3
import json

# Initialize a session using Amazon S3
s3 = boto3.client('s3')

# Define the bucket name
bucket_name = 'your-bucket-name'

# Define the bucket policy
bucket_policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "EnforceSSL",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "s3:*",
            "Resource": [
                f"arn:aws:s3:::{bucket_name}",
                f"arn:aws:s3:::{bucket_name}/*"
            ],
            "Condition": {
                "Bool": {
                    "aws:SecureTransport": "false"
                }
            }
        }
    ]
}

# Convert the policy to a JSON string
bucket_policy_json = json.dumps(bucket_policy)

# Apply the bucket policy
s3.put_bucket_policy(Bucket=bucket_name, Policy=bucket_policy_json)

print(f"Bucket policy applied to {bucket_name} to enforce secure transport.")
```

### Explanation:
1. **Initialize Boto3 Client**:
   - The script initializes a Boto3 client for S3.

2. **Define Bucket Name**:
   - Replace `'your-bucket-name'` with the name of your S3 bucket.

3. **Create Bucket Policy**:
   - The policy denies any S3 actions (`s3:*`) on the bucket and its objects if the request is not using secure transport (`aws:SecureTransport` is `false`).

4. **Apply the Policy**:
   - The script converts the policy to a JSON string and applies it to the specified bucket using `put_bucket_policy`.

By following these steps, you can ensure that your S3 bucket only allows secure transport, thereby preventing insecure access.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.
   
2. In the Bucket name list, choose the name of the bucket that you want to check for a secure transport policy.

3. Choose the Permissions tab, and then choose Bucket Policy. 

4. In the Bucket policy editor, look for a statement with "Condition": `{ "Bool": { "aws:SecureTransport": "false" } }`. If this statement is present, it means that the bucket has a secure transport policy. If it's not present, the bucket does not have a secure transport policy.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account.

   ```
   aws s3api list-buckets --query 'Buckets[].Name'
   ```

3. Check the bucket policy: For each bucket, you need to check if it has a secure transport policy. You can do this by running the following command for each bucket.

   ```
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```

4. Analyze the output: The output of the above command will be a JSON object representing the bucket's policy. You need to check if this policy includes a statement with `"Effect": "Deny"` and `"Condition": { "Bool": { "aws:SecureTransport": "false" } }`. This statement ensures that all requests to the bucket must be made over SSL. If this statement is not present, then the bucket does not have a secure transport policy.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Now, create a client for 's3' and get the list of all the buckets:

```python
s3 = session.client('s3')
response = s3.list_buckets()

buckets = [bucket['Name'] for bucket in response['Buckets']]
```

4. For each bucket, get the bucket policy and check if it has a Secure Transport statement:

```python
for bucket in buckets:
    try:
        bucket_policy = s3.get_bucket_policy(Bucket=bucket)
        policy = json.loads(bucket_policy['Policy'])

        for statement in policy['Statement']:
            if statement['Sid'] == 'ForceSSLOnlyAccess':
                if statement['Effect'] == 'Deny' and 'aws:SecureTransport' in statement['Condition']['Bool'] and statement['Condition']['Bool']['aws:SecureTransport'] == 'false':
                    print(f"Bucket {bucket} has a secure transport policy.")
                else:
                    print(f"Bucket {bucket} does not have a secure transport policy.")
    except:
        print(f"Bucket {bucket} does not have a policy.")
```

This script will print out whether each bucket has a secure transport policy or not. If a bucket does not have a policy or if the policy does not include a statement with Sid 'ForceSSLOnlyAccess' that denies access when 'aws:SecureTransport' is 'false', it will be flagged as not having a secure transport policy.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Open the [AWS S3 Console](https://s3.console.aws.amazon.com/).
2. Navigate to the specific S3 bucket for which you want to enforce secure transport.
3. Click on the "Permissions" tab.
4. Scroll down to the "Bucket policy" section.
5. Edit the bucket policy to enforce the use of HTTPS.

Here is an example policy snippet to enforce HTTPS:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Deny",
            "Principal": "*",
            "Action": "*",
            "Resource": [
                "arn:aws:s3:::YOUR_BUCKET_NAME/*",
                "arn:aws:s3:::YOUR_BUCKET_NAME"
            ],
            "Condition": {
                "Bool": {
                    "aws:SecureTransport": "false"
                }
            }
        }
    ]
}
```


Replace `YOUR_BUCKET_NAME` with the name of your S3 bucket.

#
</Accordion>

<Accordion title='Using CLI'>
```bash
# Run the following AWS CLI command to update the bucket policy to enforce HTTPS
aws s3api put-bucket-policy --bucket YOUR_BUCKET_NAME --policy '{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Principal": "*",
      "Action": "*",
      "Resource": ["arn:aws:s3:::YOUR_BUCKET_NAME/*", "arn:aws:s3:::YOUR_BUCKET_NAME"],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}'
```


Replace `YOUR_BUCKET_NAME` with the name of your S3 bucket.
</Accordion>

<Accordion title='Using Python'>
```python
import boto3

def remediate_s3_secure_transport_policy(bucket_name, aws_access_key_id, aws_secret_access_key, region):
    # Create an S3 client
    s3_client = boto3.client('s3', aws_access_key_id=aws_access_key_id, aws_secret_access_key=aws_secret_access_key, region_name=region)

    # Bucket policy to enforce secure transport (HTTPS)
    bucket_policy = {
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Deny",
                "Principal": "*",
                "Action": "*",
                "Resource": [
                    f"arn:aws:s3:::{bucket_name}/*",
                    f"arn:aws:s3:::{bucket_name}"
                ],
                "Condition": {
                    "Bool": {
                        "aws:SecureTransport": "false"
                    }
                }
            }
        ]
    }

    # Apply the bucket policy
    s3_client.put_bucket_policy(
        Bucket=bucket_name,
        Policy=json.dumps(bucket_policy)
    )

    print(f"Secure transport policy (HTTPS) enforced for S3 bucket: {bucket_name}")

# Example usage
bucket_name = 'YOUR_BUCKET_NAME'
aws_access_key_id = 'YOUR_ACCESS_KEY'
aws_secret_access_key = 'YOUR_SECRET_KEY'
region = 'us-east-1'  # Replace with your desired region

remediate_s3_secure_transport_policy(bucket_name, aws_access_key_id, aws_secret_access_key, region)
```


Replace `YOUR_BUCKET_NAME`, `YOUR_ACCESS_KEY`, `YOUR_SECRET_KEY`, and update the `region` with your desired region in the Python script. Run the script, and it will enforce the use of HTTPS for the specified S3 bucket. Make sure to install the `boto3` library if you haven't already:

```bash
pip install boto3
```

Note: Ensure that you have the necessary permissions to make these changes, and exercise caution when applying changes to production environments.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html) 

