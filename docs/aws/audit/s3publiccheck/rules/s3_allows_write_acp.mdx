---
slug: s3_allows_write_acp
title: S3 Bucket Should Not Allow Public WRITE_ACP Access
sidebar_label: S3 Bucket Should Not Allow Public WRITE_ACP Access
---

### More Info:

AWS S3 buckets should not allow public WRITE_ACP access. Granting public "WRITE_ACP" access to your AWS S3 buckets can allow anonymous users to edit their ACL permissions and eventually be able to view, upload, modify and delete S3 objects within the bucket without restrictions.

### Risk Level

High

### Address

Security

### Compliance Standards

NIST, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 Bucket from allowing public WRITE_ACP (Write Access Control Policy) access using the AWS Management Console, follow these steps:

1. **Navigate to the S3 Console:**
   - Open the AWS Management Console.
   - In the Services menu, select "S3" to go to the Amazon S3 console.

2. **Select the Bucket:**
   - In the S3 console, find and click on the name of the bucket you want to configure.

3. **Bucket Permissions:**
   - Go to the "Permissions" tab.
   - Under the "Block public access (bucket settings)" section, click on "Edit".
   - Ensure that the option "Block public access to buckets and objects granted through new access control lists (ACLs)" is checked.
   - Ensure that the option "Block public access to buckets and objects granted through any access control lists (ACLs)" is checked.
   - Click "Save" to apply the changes.

4. **Review and Edit Bucket Policy:**
   - Still under the "Permissions" tab, scroll down to the "Bucket policy" section.
   - Review the bucket policy to ensure it does not grant `s3:PutBucketAcl` permission to any public or unauthorized users.
   - If necessary, edit the bucket policy to remove any statements that grant `s3:PutBucketAcl` permission to `Principal: "*"` or any other public entities.
   - Click "Save" to apply the changes.

By following these steps, you can ensure that your S3 bucket does not allow public WRITE_ACP access, thereby enhancing the security of your data.
</Accordion>

<Accordion title='Using CLI'>
To prevent an S3 bucket from allowing public WRITE_ACP (Write Access Control Policy) access using the AWS CLI, follow these steps:

1. **Create a Bucket Policy to Deny Public WRITE_ACP Access:**
   Create a JSON file (e.g., `deny_public_write_acp.json`) with the following content to deny public WRITE_ACP access:

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Deny",
               "Principal": "*",
               "Action": "s3:PutBucketAcl",
               "Resource": "arn:aws:s3:::your-bucket-name",
               "Condition": {
                   "StringEquals": {
                       "aws:PrincipalType": "Anonymous"
                   }
               }
           }
       ]
   }
   ```

2. **Apply the Bucket Policy:**
   Use the AWS CLI to apply the bucket policy to your S3 bucket:

   ```sh
   aws s3api put-bucket-policy --bucket your-bucket-name --policy file://deny_public_write_acp.json
   ```

3. **Block Public Access Settings:**
   Enable block public access settings for the bucket to prevent public WRITE_ACP access:

   ```sh
   aws s3api put-public-access-block --bucket your-bucket-name --public-access-block-configuration BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true
   ```

4. **Verify the Bucket Policy and Public Access Block:**
   Verify that the bucket policy and public access block settings are correctly applied:

   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   aws s3api get-public-access-block --bucket your-bucket-name
   ```

By following these steps, you can ensure that your S3 bucket does not allow public WRITE_ACP access using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 buckets from allowing public WRITE_ACP (Write Access Control Policy) access using Python scripts, you can use the AWS SDK for Python, known as Boto3. Here are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for S3. This will allow you to interact with your S3 buckets.
   ```python
   import boto3

   s3 = boto3.client('s3')
   ```

3. **Retrieve and Update Bucket ACL**:
   Retrieve the current Access Control List (ACL) of the bucket and update it to remove any public WRITE_ACP permissions.
   ```python
   def remove_public_write_acp(bucket_name):
       # Get the current ACL
       acl = s3.get_bucket_acl(Bucket=bucket_name)
       
       # Iterate over the grants and remove public WRITE_ACP permissions
       new_grants = []
       for grant in acl['Grants']:
           if grant['Permission'] == 'WRITE_ACP' and 'URI' in grant['Grantee'] and grant['Grantee']['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers':
               continue  # Skip public WRITE_ACP grants
           new_grants.append(grant)
       
       # Update the ACL with the new grants
       s3.put_bucket_acl(
           Bucket=bucket_name,
           AccessControlPolicy={
               'Grants': new_grants,
               'Owner': acl['Owner']
           }
       )

   # Example usage
   bucket_name = 'your-bucket-name'
   remove_public_write_acp(bucket_name)
   ```

4. **Automate the Script**:
   Optionally, you can automate this script to run periodically or integrate it into your CI/CD pipeline to ensure that no S3 bucket has public WRITE_ACP access at any time.
   ```python
   import schedule
   import time

   def job():
       # List all your buckets
       response = s3.list_buckets()
       for bucket in response['Buckets']:
           remove_public_write_acp(bucket['Name'])

   # Schedule the job to run every hour
   schedule.every().hour.do(job)

   while True:
       schedule.run_pending()
       time.sleep(1)
   ```

By following these steps, you can ensure that your S3 buckets do not allow public WRITE_ACP access, thereby enhancing the security of your AWS environment.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for public WRITE_ACP access.

3. Choose the Permissions tab.

4. Under the Bucket Policy section, look for any statements with "Action": "s3:PutBucketAcl" or "s3:PutObjectAcl" and "Effect": "Allow". If the "Principal" in these statements is set to "*", this means the bucket is publicly accessible for WRITE_ACP access.

5. Additionally, under the Access Control List (ACL) section, check if "Everyone" or "Any authenticated AWS user" has the "WRITE_ACP" permission. If they do, this means the bucket allows public WRITE_ACP access.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account.

   ```
   aws s3api list-buckets --query "Buckets[].Name"
   ```

3. Check bucket policy: For each bucket, you need to check the bucket policy to see if it allows public WRITE_ACP access. You can do this by running the following command for each bucket.

   ```
   aws s3api get-bucket-policy --bucket <bucket-name> --query 'Policy'
   ```

4. Analyze the policy: The above command will return the bucket policy in a JSON format. You need to analyze this policy to see if it contains a statement with `"Effect": "Allow"`, `"Principal": "*"`, and `"Action": "s3:PutBucketAcl"`. If such a statement exists, it means that the bucket allows public WRITE_ACP access.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, create a client for 's3' and get the list of all the buckets:

```python
s3 = session.client('s3')
response = s3.list_buckets()
```

4. Iterate over each bucket and check its ACL (Access Control List). If the 'WRITE_ACP' permission is granted to 'AllUsers' or 'AuthenticatedUsers', then the bucket is misconfigured:

```python
for bucket in response['Buckets']:
    acl = s3.get_bucket_acl(Bucket=bucket['Name'])
    for grant in acl['Grants']:
        if 'AllUsers' in grant['Grantee']['URI'] or 'AuthenticatedUsers' in grant['Grantee']['URI']:
            if grant['Permission'] == 'WRITE_ACP':
                print(f"Bucket {bucket['Name']} is misconfigured.")
```

This script will print the names of all the buckets that are misconfigured.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "S3 Bucket Should Not Allow Public WRITE_ACP Access" for AWS using the AWS console, please follow the below steps:

1. Log in to your AWS console.
2. Navigate to S3 service.
3. Select the bucket that has public WRITE_ACP access.
4. Click on the "Permissions" tab.
5. Scroll down to "Access Control List (ACL)" and click on it.
6. Look for any entries that have the "Grantee" set to "All Users" or "Authenticated Users".
7. If you find any such entries, select them and click on the "Revoke" button to remove the public WRITE_ACP access.
8. Click on the "Save" button to save the changes.

Once you have completed the above steps, your S3 bucket will no longer have public WRITE_ACP access and will be remediated.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "S3 Bucket Should Not Allow Public WRITE_ACP Access" for AWS using AWS CLI, you can follow these steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Identify the S3 bucket that is allowing public WRITE_ACP access. You can use the following command to list all the S3 buckets in your AWS account:
```
aws s3api list-buckets
```

3. Once you have identified the bucket, you can use the following command to update the bucket policy to remove public WRITE_ACP access:
```
aws s3api put-bucket-acl --bucket BUCKET_NAME --acl private
```
Replace BUCKET_NAME with the name of the S3 bucket that you want to update.

4. Verify that the bucket policy has been updated successfully by running the following command:
```
aws s3api get-bucket-acl --bucket BUCKET_NAME
```
Replace BUCKET_NAME with the name of the S3 bucket that you updated in step 3.

5. Check if the misconfiguration has been remediated by running a security scan or audit on your AWS account. 

By following these steps, you can remediate the misconfiguration "S3 Bucket Should Not Allow Public WRITE_ACP Access" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of S3 Bucket allowing public WRITE_ACP access in AWS using Python, you can follow the below steps:

1. Install the AWS SDK for Python (boto3) using the following command:

```
pip install boto3
```

2. Create a boto3 S3 client object using the following code:

```
import boto3
s3 = boto3.client('s3')
```

3. Get the bucket policy using the `get_bucket_policy` method of the S3 client object:

```
bucket_name = 'your-bucket-name'
bucket_policy = s3.get_bucket_policy(Bucket=bucket_name)
```

4. Check if the bucket policy allows public WRITE_ACP access. You can use the following code to check this:

```
import json
bucket_policy_json = json.loads(bucket_policy['Policy'])
if 'Statement' in bucket_policy_json:
    for statement in bucket_policy_json['Statement']:
        if 'Effect' in statement and statement['Effect'] == 'Allow':
            if 'Principal' in statement and statement['Principal'] == '*':
                if 'Action' in statement and 's3:PutBucketAcl' in statement['Action']:
                    print('Public WRITE_ACP access is allowed')
```

5. If the bucket policy allows public WRITE_ACP access, you can remove it using the `put_bucket_acl` method of the S3 client object. You can use the following code to remove the public WRITE_ACP access:

```
response = s3.put_bucket_acl(
    Bucket=bucket_name,
    ACL='private'
)
```

This will set the bucket ACL to private and remove the public WRITE_ACP access.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

