---
slug: s3_allows_full_control
title: S3 Bucket Should Not Allow Public FULL_CONTROL Access
sidebar_label: S3 Bucket Should Not Allow Public FULL_CONTROL Access
---

### More Info:

There should not be any publicly accessible S3 buckets available in your AWS account in order to protect your S3 data from loss and unauthorized access.

### Risk Level

Critical

### Address

Security

### Compliance Standards

CBP, HITRUST, AWSWAF, SOC2, NISTCSF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent an S3 bucket from allowing public FULL_CONTROL access using the AWS Management Console, follow these steps:

1. **Open the S3 Console:**
   - Sign in to the AWS Management Console.
   - Navigate to the S3 service by searching for "S3" in the search bar and selecting it.

2. **Select the Bucket:**
   - In the S3 console, you will see a list of your buckets. Click on the name of the bucket you want to configure.

3. **Bucket Permissions:**
   - Go to the "Permissions" tab of the selected bucket.
   - Under the "Bucket Policy" section, review the bucket policy to ensure it does not grant `FULL_CONTROL` access to the public (i.e., `Principal` set to `*` with `Action` set to `s3:*`).

4. **Block Public Access:**
   - In the "Permissions" tab, find the "Block public access (bucket settings)" section.
   - Click on "Edit" and ensure that all options to block public access are checked:
     - Block all public access
     - Block public access to buckets and objects granted through new access control lists (ACLs)
     - Block public access to buckets and objects granted through any access control lists (ACLs)
     - Block public access to buckets and objects granted through new public bucket or access point policies
   - Click "Save changes" to apply the settings.

By following these steps, you can ensure that your S3 bucket does not allow public FULL_CONTROL access.
</Accordion>

<Accordion title='Using CLI'>
To prevent an S3 bucket from allowing public FULL_CONTROL access using the AWS CLI, follow these steps:

1. **Create a Bucket Policy to Deny Public FULL_CONTROL Access:**
   Use the following JSON policy to deny any public access that grants FULL_CONTROL permissions. Save this policy to a file named `deny_public_full_control_policy.json`.

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Deny",
               "Principal": "*",
               "Action": "s3:*",
               "Resource": [
                   "arn:aws:s3:::your-bucket-name",
                   "arn:aws:s3:::your-bucket-name/*"
               ],
               "Condition": {
                   "StringEquals": {
                       "s3:x-amz-acl": "public-read-write"
                   }
               }
           }
       ]
   }
   ```

2. **Apply the Bucket Policy:**
   Use the `aws s3api put-bucket-policy` command to apply the policy to your S3 bucket.

   ```sh
   aws s3api put-bucket-policy --bucket your-bucket-name --policy file://deny_public_full_control_policy.json
   ```

3. **Block Public Access Settings:**
   Enable block public access settings for the bucket to prevent any public access configurations.

   ```sh
   aws s3api put-public-access-block --bucket your-bucket-name --public-access-block-configuration BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true
   ```

4. **Verify the Bucket Policy and Public Access Block:**
   Ensure that the bucket policy and public access block settings are correctly applied.

   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   aws s3api get-public-access-block --bucket your-bucket-name
   ```

By following these steps, you can prevent your S3 bucket from allowing public FULL_CONTROL access using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent an S3 bucket from allowing public FULL_CONTROL access using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Install Boto3**:
   Ensure you have Boto3 installed. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Create a Python Script to Check and Update Bucket Policies**:
   Write a Python script to check the bucket policy and update it to ensure it does not allow public FULL_CONTROL access.

4. **Python Script**:
   Here is a sample Python script to prevent public FULL_CONTROL access to an S3 bucket:

   ```python
   import boto3
   import json

   # Initialize a session using Amazon S3
   s3 = boto3.client('s3')

   # Replace 'your-bucket-name' with your actual bucket name
   bucket_name = 'your-bucket-name'

   # Get the current bucket policy
   try:
       result = s3.get_bucket_policy(Bucket=bucket_name)
       policy = json.loads(result['Policy'])
   except s3.exceptions.NoSuchBucketPolicy:
       policy = {"Version": "2012-10-17", "Statement": []}

   # Function to check if a statement allows public FULL_CONTROL access
   def is_public_full_control(statement):
       if statement['Effect'] == 'Allow' and 'Principal' in statement and statement['Principal'] == '*':
           if 'Action' in statement and ('s3:*' in statement['Action'] or 's3:PutObjectAcl' in statement['Action']):
               if 'Condition' not in statement or ('Condition' in statement and 'StringEquals' in statement['Condition'] and 's3:x-amz-acl' in statement['Condition']['StringEquals'] and statement['Condition']['StringEquals']['s3:x-amz-acl'] == 'public-read-write'):
                   return True
       return False

   # Remove any statements that allow public FULL_CONTROL access
   policy['Statement'] = [statement for statement in policy['Statement'] if not is_public_full_control(statement)]

   # Update the bucket policy
   s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(policy))

   print(f"Updated policy for bucket {bucket_name} to prevent public FULL_CONTROL access.")
   ```

### Explanation:
1. **Install Boto3**: Ensure Boto3 is installed to interact with AWS services.
2. **Set Up AWS Credentials**: Configure your AWS credentials to allow the script to authenticate with AWS.
3. **Create a Python Script**: Write a script to fetch the current bucket policy, check for any statements that allow public FULL_CONTROL access, and remove those statements.
4. **Python Script**: The script initializes the S3 client, retrieves the current bucket policy, checks for and removes any statements that allow public FULL_CONTROL access, and updates the bucket policy.

By following these steps, you can ensure that your S3 bucket does not allow public FULL_CONTROL access using a Python script.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for public access.

3. Choose the Permissions tab. Under the "Block public access" section, you can see the current public access settings for the selected bucket.

4. Under the "Access Control List" section, check the "Public access" column. If it says "Everyone" with "List objects" or "Write objects" permissions, then the bucket is publicly accessible. If it says "Public access: Everyone has FULL_CONTROL permission", then the bucket allows public FULL_CONTROL access.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account:

   ```
   aws s3api list-buckets --query "Buckets[].Name"
   ```
   This command will return a list of all the S3 bucket names.

3. Check bucket policy: For each bucket, you need to check the bucket policy to see if it allows public FULL_CONTROL access. You can do this by running the following command:

   ```
   aws s3api get-bucket-policy --bucket <bucket-name> --query Policy
   ```
   Replace `<bucket-name>` with the name of the bucket you want to check. This command will return the bucket policy in JSON format.

4. Parse the policy: You need to parse the returned policy to see if it contains a statement that allows public FULL_CONTROL access. You can do this by looking for a statement where the "Effect" is "Allow", the "Principal" is "*", and the "Action" is "s3:*". If such a statement exists, then the bucket allows public FULL_CONTROL access.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then, input your access key, secret access key, and your preferred AWS region when prompted.

3. Write a Python script to check S3 bucket permissions: The following script lists all your S3 buckets and checks if they allow public FULL_CONTROL access:

   ```python
   import boto3

   s3 = boto3.client('s3')

   # List all S3 buckets
   buckets = s3.list_buckets()
   for bucket in buckets['Buckets']:
       # Get bucket policy
       policy = s3.get_bucket_policy(Bucket=bucket['Name'])
       # Check if policy allows public FULL_CONTROL access
       if 'Statement' in policy['Policy']:
           for statement in policy['Policy']['Statement']:
               if (statement['Effect'] == 'Allow' and
                   'Principal' in statement and
                   statement['Principal'] == '*' and
                   'Action' in statement and
                   statement['Action'] == 's3:*' and
                   'Resource' in statement and
                   statement['Resource'] == f"arn:aws:s3:::{bucket['Name']}/*"):
                   print(f"Bucket {bucket['Name']} allows public FULL_CONTROL access")
   ```

4. Run the script: You can run the script using Python:

   ```bash
   python check_s3_permissions.py
   ```

   The script will print the names of all S3 buckets that allow public FULL_CONTROL access. If no such buckets exist, it will print nothing.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the S3 bucket misconfiguration in AWS:

1. Log in to the AWS Management Console and navigate to the S3 service.

2. Click on the name of the bucket that has the public FULL_CONTROL access.

3. Click on the "Permissions" tab and then select "Bucket Policy".

4. Review the policy to see if there is any statement that grants public FULL_CONTROL access. 

5. If there is any statement that grants public FULL_CONTROL access, remove it from the policy by editing the JSON policy document.

6. Alternatively, you can also revoke the public FULL_CONTROL access by selecting the "Access Control List" (ACL) tab and then removing the "Everyone" grantee with FULL_CONTROL access.

7. Once you have made the necessary changes, click on the "Save" button to save the updated policy or ACL.

8. Finally, test the bucket to ensure that the public FULL_CONTROL access has been remediated. 

By following the above steps, you can remediate the S3 bucket misconfiguration to ensure that it does not allow public FULL_CONTROL access.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate this misconfiguration, you can follow these steps using AWS CLI:

1. Open your terminal and install the AWS CLI if you haven't installed it already.

2. Run the following command to list all the S3 buckets in your account:

   ```
   aws s3api list-buckets
   ```

3. Identify the bucket that has public FULL_CONTROL access.

4. Run the following command to remove the public FULL_CONTROL access from the bucket:

   ```
   aws s3api put-bucket-acl --bucket <bucket-name> --acl private
   ```

   Replace `<bucket-name>` with the name of the bucket that you identified in step 3.

5. Verify that the public FULL_CONTROL access has been removed by running the following command:

   ```
   aws s3api get-bucket-acl --bucket <bucket-name>
   ```

   Replace `<bucket-name>` with the name of the bucket that you identified in step 3. The output should show that there are no grants with the permission "FULL_CONTROL" for "AllUsers" or "AuthenticatedUsers".

6. Repeat steps 3-5 for any other buckets that have public FULL_CONTROL access.

By following these steps, you have successfully remediated the misconfiguration of allowing public FULL_CONTROL access to an S3 bucket in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of an S3 bucket allowing public FULL_CONTROL access, you can follow these steps:

1. Open the AWS Management Console and navigate to the S3 service.

2. Select the bucket that you want to remediate.

3. Click on the "Permissions" tab and then click on the "Access control list (ACL)" option.

4. Locate the "Grantee" that is set to "Everyone" and has "FULL_CONTROL" permissions.

5. Remove the "Grantee" by clicking on the "x" icon next to it.

6. Click on the "Save" button to save the changes.

To automate this process using Python, you can use the AWS SDK for Python (Boto3) and follow these steps:

1. Install the Boto3 library by running the following command in your terminal:

```
pip install boto3
```

2. Create a new Python file and import the necessary libraries:

```python
import boto3
```

3. Create a new S3 client:

```python
s3 = boto3.client('s3')
```

4. Retrieve the ACL of the bucket:

```python
bucket_acl = s3.get_bucket_acl(Bucket='your-bucket-name')
```

5. Loop through the ACL and remove any grant that has "FULL_CONTROL" permissions for the "AllUsers" group:

```python
for grant in bucket_acl['Grants']:
    if grant['Grantee']['Type'] == 'Group' and grant['Grantee']['URI'] == 'http://acs.amazonaws.com/groups/global/AllUsers' and grant['Permission'] == 'FULL_CONTROL':
        s3.put_bucket_acl(Bucket='your-bucket-name', AccessControlPolicy={'Grants': [g for g in bucket_acl['Grants'] if g != grant], 'Owner': bucket_acl['Owner']})
```

6. Run the Python script and check the S3 bucket to confirm that the public FULL_CONTROL access has been removed.

Note: Make sure to replace "your-bucket-name" with the name of your actual S3 bucket.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

