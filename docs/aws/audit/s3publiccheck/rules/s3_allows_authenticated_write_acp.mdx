---
slug: s3_allows_authenticated_write_acp
title: S3 Bucket Should Not Allow WRITE_ACP Access to Authenticated Users
sidebar_label: S3 Bucket Should Not Allow WRITE_ACP Access to Authenticated Users
---

### More Info:

AWS S3 buckets should not allow WRITE_ACP access to AWS authenticated users using ACLs. Granting authenticated "WRITE_ACP" access to your AWS S3 buckets can allow other AWS accounts or IAM users to edit ACL permissions in order to view, upload, modify and delete S3 objects within the buckets without restrictions.

### Risk Level

High

### Address

Security

### Compliance Standards

CBP, PCIDSS, NIST


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 Bucket from allowing WRITE_ACP access to authenticated users using the AWS Management Console, follow these steps:

1. **Navigate to the S3 Console:**
   - Open the AWS Management Console.
   - In the Services menu, select "S3" to go to the Amazon S3 console.

2. **Select the Bucket:**
   - In the S3 console, find and click on the name of the bucket you want to configure.

3. **Access Bucket Permissions:**
   - Once inside the bucket, go to the "Permissions" tab.
   - Under the "Permissions" tab, click on "Bucket Policy" or "Access Control List" (ACL) depending on where the WRITE_ACP permission might be set.

4. **Review and Modify Permissions:**
   - If using Bucket Policy: Ensure that the policy does not include a statement that grants `s3:PutBucketAcl` (WRITE_ACP) permission to `Principal: "*"` or any authenticated users.
   - If using ACL: Ensure that the "Access for other AWS accounts" section does not grant WRITE_ACP permissions to "Authenticated Users group".

By following these steps, you can ensure that your S3 bucket does not allow WRITE_ACP access to authenticated users, thereby enhancing the security of your bucket.
</Accordion>

<Accordion title='Using CLI'>
To prevent S3 buckets from allowing `WRITE_ACP` access to authenticated users using AWS CLI, follow these steps:

1. **List the Bucket Policies**:
   First, identify the bucket policies that might be allowing `WRITE_ACP` access to authenticated users.
   ```sh
   aws s3api get-bucket-policy --bucket <bucket-name>
   ```

2. **Modify the Bucket Policy**:
   If the policy allows `WRITE_ACP` access to authenticated users, you need to modify it. Create a JSON file (e.g., `bucket-policy.json`) with the updated policy that removes or denies `WRITE_ACP` access to authenticated users.

3. **Apply the Updated Policy**:
   Use the following command to apply the updated policy to the bucket.
   ```sh
   aws s3api put-bucket-policy --bucket <bucket-name> --policy file://bucket-policy.json
   ```

4. **Verify the Policy**:
   Ensure that the policy has been updated correctly by retrieving the bucket policy again.
   ```sh
   aws s3api get-bucket-policy --bucket <bucket-name>
   ```

By following these steps, you can prevent S3 buckets from allowing `WRITE_ACP` access to authenticated users using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 buckets from allowing `WRITE_ACP` access to authenticated users using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Install Boto3**:
   Ensure you have Boto3 installed. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for S3.
   ```python
   import boto3

   s3 = boto3.client('s3')
   ```

3. **Retrieve and Update Bucket Policy**:
   Retrieve the current bucket policy, modify it to ensure `WRITE_ACP` access is not granted to authenticated users, and then update the policy.

   ```python
   import json

   bucket_name = 'your-bucket-name'

   # Retrieve the current bucket policy
   try:
       result = s3.get_bucket_policy(Bucket=bucket_name)
       policy = json.loads(result['Policy'])
   except s3.exceptions.NoSuchBucketPolicy:
       policy = {
           "Version": "2012-10-17",
           "Statement": []
       }

   # Define the statement to deny WRITE_ACP to authenticated users
   deny_statement = {
       "Effect": "Deny",
       "Principal": "*",
       "Action": "s3:PutBucketAcl",
       "Resource": f"arn:aws:s3:::{bucket_name}",
       "Condition": {
           "StringEquals": {
               "aws:PrincipalType": "Account"
           }
       }
   }

   # Check if the deny statement already exists
   if deny_statement not in policy['Statement']:
       policy['Statement'].append(deny_statement)

   # Update the bucket policy
   s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(policy))
   ```

4. **Verify the Policy**:
   Verify that the policy has been updated correctly.
   ```python
   result = s3.get_bucket_policy(Bucket=bucket_name)
   print(result['Policy'])
   ```

This script ensures that the S3 bucket policy explicitly denies `WRITE_ACP` access to authenticated users, thereby preventing any misconfigurations related to this permission.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the S3 service.
2. In the S3 dashboard, click on the name of the bucket you want to check.
3. In the bucket properties page, click on the "Permissions" tab.
4. Under the "Access Control List (ACL)" section, check the permissions granted to "Any authenticated AWS user". If "WRITE_ACP" (Write Access Control Policy) is listed, then the bucket allows WRITE_ACP access to authenticated users.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account:

   ```
   aws s3api list-buckets --query 'Buckets[].Name'
   ```

3. Check bucket policy: For each bucket, check the bucket policy to see if it allows WRITE_ACP access to authenticated users. You can do this by running the following command:

   ```
   aws s3api get-bucket-policy --bucket <bucket-name> --query 'Policy'
   ```

   Replace `<bucket-name>` with the name of your bucket. This command will return the bucket's policy in JSON format.

4. Analyze the policy: Look for any statements in the policy that have "Effect": "Allow", "Principal": "*", and "Action": "s3:PutBucketAcl" or "s3:PutObjectAcl". If such statements exist, it means the bucket allows WRITE_ACP access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Now, create a client for 's3' and get the list of all the buckets:

```python
s3 = session.client('s3')
response = s3.list_buckets()

buckets = [bucket['Name'] for bucket in response['Buckets']]
```

4. For each bucket, get the bucket policy and check if it allows WRITE_ACP access to authenticated users:

```python
for bucket in buckets:
    bucket_policy = s3.get_bucket_policy(Bucket=bucket)
    policy = json.loads(bucket_policy['Policy'])

    for statement in policy['Statement']:
        if statement['Effect'] == 'Allow' and 's3:PutBucketAcl' in statement['Action'] and 'AuthenticatedUsers' in statement['Principal']:
            print(f'Bucket {bucket} allows WRITE_ACP access to authenticated users.')
```

This script will print the names of all buckets that allow WRITE_ACP access to authenticated users. If no such buckets exist, it will print nothing.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the "S3 Bucket Should Not Allow WRITE_ACP Access to Authenticated Users" misconfiguration in AWS, you can follow these steps using the AWS console:

1. Log in to the AWS Management Console.

2. Navigate to the S3 service.

3. Click on the name of the bucket that you want to remediate.

4. Click on the "Permissions" tab.

5. Click on the "Access control list (ACL)" button.

6. Under the "Grantee" column, find the row that has "Authenticated Users".

7. In the "Permission" column, find the "WRITE_ACP" permission.

8. Click on the "x" button to remove the "WRITE_ACP" permission for "Authenticated Users".

9. Click on the "Save" button to save the changes.

10. Verify that the "Authenticated Users" group no longer has the "WRITE_ACP" permission by checking the "Access control list (ACL)" again.

11. Repeat these steps for any other S3 buckets that have the same misconfiguration.

Note: You can also use AWS CLI or AWS SDKs to remediate this misconfiguration.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "S3 Bucket Should Not Allow WRITE_ACP Access to Authenticated Users" for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get a list of all S3 buckets in your AWS account:

   ```
   aws s3api list-buckets
   ```

3. Identify the S3 bucket that has WRITE_ACP access granted to authenticated users.

4. Run the following command to revoke WRITE_ACP access for authenticated users:

   ```
   aws s3api put-bucket-acl --bucket bucket-name --grant-write-acp uri=http://acs.amazonaws.com/groups/global/AuthenticatedUsers --acl private
   ```

   Replace "bucket-name" with the name of the S3 bucket that you want to remediate.

5. Verify that WRITE_ACP access for authenticated users has been revoked by running the following command:

   ```
   aws s3api get-bucket-acl --bucket bucket-name
   ```

   Replace "bucket-name" with the name of the S3 bucket that you want to remediate.

6. Repeat the above steps for all S3 buckets that have WRITE_ACP access granted to authenticated users.

By following these steps, you can remediate the misconfiguration "S3 Bucket Should Not Allow WRITE_ACP Access to Authenticated Users" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of allowing WRITE_ACP access to authenticated users in an AWS S3 bucket using Python, follow these steps:

1. Create an AWS S3 client using the AWS SDK for Python (Boto3).
2. Get the bucket policy using the `get_bucket_policy()` method of the S3 client.
3. Parse the JSON policy to identify the statement that allows WRITE_ACP access to authenticated users.
4. Remove the identified statement from the policy.
5. Update the bucket policy using the `put_bucket_policy()` method of the S3 client.

Here's the Python code to remediate the misconfiguration:

```python
import boto3
import json

# Create an S3 client
s3 = boto3.client('s3')

# Get the bucket policy
bucket_name = 'your-bucket-name'
policy = s3.get_bucket_policy(Bucket=bucket_name)

# Parse the JSON policy
policy_json = json.loads(policy['Policy'])
statements = policy_json['Statement']

# Identify the statement that allows WRITE_ACP access to authenticated users
for statement in statements:
    if 'Principal' in statement and statement['Principal'] == {'AWS': '*'}:
        if 'Action' in statement and 's3:PutObjectAcl' in statement['Action']:
            if 'Condition' in statement and 'Bool' in statement['Condition']:
                if 'aws:SecureTransport' in statement['Condition']['Bool'] and statement['Condition']['Bool']['aws:SecureTransport'] == 'false':
                    # Remove the identified statement from the policy
                    policy_json['Statement'].remove(statement)

# Update the bucket policy
s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(policy_json))
```

This code will remove the statement that allows WRITE_ACP access to authenticated users from the S3 bucket policy.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

