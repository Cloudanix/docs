
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Buckets list, choose the name of the bucket that you want to check for default encryption.

3. Choose the Properties tab.

4. In the Default encryption section, check if there is an encryption method set. If there is no encryption method set, then the bucket does not have default encryption enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account:

   ```
   aws s3api list-buckets --query "Buckets[].Name"
   ```
   This command will return a list of all the S3 bucket names.

3. Check the default encryption status: For each bucket, you can check if it has default encryption enabled by running the following command:

   ```
   aws s3api get-bucket-encryption --bucket <bucket-name>
   ```
   Replace `<bucket-name>` with the name of your bucket. If the bucket has default encryption enabled, this command will return the encryption configuration. If not, it will return an error.

4. Repeat step 3 for all buckets: You need to repeat the above step for each bucket in your AWS account. You can automate this process by writing a script that loops through all the bucket names and runs the `get-bucket-encryption` command for each one.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. At the very least, the contents of the file should be:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check for S3 bucket encryption: The following script will list all your S3 buckets and check if they have default encryption enabled.

   ```python
   import boto3

   # Create a session using your AWS credentials
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
   )

   # Create an S3 resource object using the session
   s3 = session.resource('s3')

   # Iterate over all your S3 buckets
   for bucket in s3.buckets.all():
       try:
           # Try to get the bucket encryption. If it's not set, an exception will be thrown
           encryption = s3.BucketEncryption(bucket.name).server_side_encryption_configuration()
           print(f'Bucket {bucket.name} has default encryption enabled.')
       except Exception as e:
           print(f'Bucket {bucket.name} does not have default encryption enabled.')
   ```

4. Run the script: You can run the script using any Python interpreter. The script will print the names of all your S3 buckets and whether they have default encryption enabled. If a bucket does not have default encryption enabled, you should consider enabling it to improve the security of your data.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the misconfiguration of S3 Buckets not having default encryption enabled in AWS:

1. Log in to the AWS Management Console.
2. Go to the S3 service dashboard.
3. Click on the bucket for which you want to enable default encryption.
4. Click on the "Properties" tab.
5. Scroll down to the "Default encryption" section and click on "Edit".
6. Select "AES-256" or "AWS-KMS" as the default encryption option.
7. If you choose "AWS-KMS", select the KMS key that you want to use for encryption.
8. Click on the "Save" button to save the changes.

After following these steps, the S3 bucket will have default encryption enabled, and all objects stored in the bucket will be encrypted with the selected encryption option.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of S3 Buckets not having default encryption enabled in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your system.

2. Check if the S3 bucket has default encryption enabled or not using the following command:
   ```
   aws s3api get-bucket-encryption --bucket <bucket-name>
   ```

3. If the response shows that default encryption is not enabled, then you can enable it using the following command:
   ```
   aws s3api put-bucket-encryption --bucket <bucket-name> --server-side-encryption-configuration '{"Rules": [{"ApplyServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]}'
   ```
   This command will enable default encryption for the specified S3 bucket using AES256 encryption.

4. Verify that default encryption is enabled on the S3 bucket using the following command:
   ```
   aws s3api get-bucket-encryption --bucket <bucket-name>
   ```
   The response should show that default encryption is enabled on the S3 bucket.

By following the above steps, you can remediate the misconfiguration of S3 Buckets not having default encryption enabled in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of S3 buckets not having default encryption enabled in AWS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) using pip:

```python
pip install boto3
```

2. Configure AWS credentials using the AWS CLI or by setting environment variables.

3. Write a Python script to enable default encryption for all S3 buckets in your AWS account:

```python
import boto3

# Create an S3 client
s3 = boto3.client('s3')

# Get a list of all S3 buckets in your account
buckets = s3.list_buckets()['Buckets']

# For each bucket, check if default encryption is enabled
for bucket in buckets:
    bucket_name = bucket['Name']
    bucket_encryption = s3.get_bucket_encryption(Bucket=bucket_name)
    
    # If default encryption is not enabled, enable it
    if 'ServerSideEncryptionConfiguration' not in bucket_encryption:
        s3.put_bucket_encryption(
            Bucket=bucket_name,
            ServerSideEncryptionConfiguration={
                'Rules': [
                    {
                        'ApplyServerSideEncryptionByDefault': {
                            'SSEAlgorithm': 'AES256'
                        }
                    }
                ]
            }
        )
```

4. Run the Python script to enable default encryption for all S3 buckets in your AWS account. 

Note: This script will enable default encryption using AES256 algorithm. If you want to use a different encryption algorithm, you can modify the script accordingly.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
