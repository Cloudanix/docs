---
slug: s3_allows_authenticated_write
title: S3 Bucket Should Not Allow WRITE Access to Authenticated Users
sidebar_label: S3 Bucket Should Not Allow WRITE Access to Authenticated Users
---

### More Info:

S3 buckets should not allow WRITE access to AWS authenticated users through S3 ACLs.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP, HIPAA


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 buckets from allowing WRITE access to authenticated users using the AWS Management Console, follow these steps:

1. **Navigate to the S3 Console:**
   - Sign in to the AWS Management Console.
   - Open the Amazon S3 console at [https://s3.console.aws.amazon.com/s3/](https://s3.console.aws.amazon.com/s3/).

2. **Select the Bucket:**
   - In the S3 console, find and click on the name of the bucket you want to configure.

3. **Access Bucket Permissions:**
   - Go to the "Permissions" tab.
   - Under the "Bucket Policy" and "Access Control List (ACL)" sections, review the current permissions.

4. **Modify Bucket Policy and ACL:**
   - Ensure that the bucket policy does not include any statements that grant `s3:PutObject` or other WRITE permissions to `"Principal": "*"` or `"AWS": "*"` (which represents all authenticated users).
   - In the "Access Control List (ACL)" section, ensure that the "Everyone" group does not have WRITE permissions. Specifically, uncheck any WRITE permissions for the "Authenticated Users" group.

By following these steps, you can prevent S3 buckets from allowing WRITE access to authenticated users using the AWS Management Console.
</Accordion>

<Accordion title='Using CLI'>
To prevent an S3 bucket from allowing WRITE access to authenticated users using the AWS CLI, you can follow these steps:

1. **Check the Current Bucket Policy:**
   First, you need to check the current bucket policy to see if it allows WRITE access to authenticated users.
   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```

2. **Remove WRITE Permissions for Authenticated Users:**
   If the policy allows WRITE access to authenticated users, you need to modify it. Create a JSON file (e.g., `bucket-policy.json`) with the updated policy that removes WRITE permissions for authenticated users.

3. **Apply the Updated Bucket Policy:**
   Use the following command to apply the updated bucket policy.
   ```sh
   aws s3api put-bucket-policy --bucket your-bucket-name --policy file://bucket-policy.json
   ```

4. **Verify the Updated Bucket Policy:**
   Finally, verify that the updated bucket policy has been applied correctly.
   ```sh
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```

By following these steps, you can ensure that your S3 bucket does not allow WRITE access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 buckets from allowing WRITE access to authenticated users using Python scripts, you can use the AWS SDK for Python, known as Boto3. Below are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for S3. This will allow you to interact with your S3 buckets.
   ```python
   import boto3

   s3 = boto3.client('s3')
   ```

3. **Retrieve and Update Bucket Policy**:
   Retrieve the current bucket policy, modify it to ensure that WRITE access is not allowed for authenticated users, and then update the policy.

   ```python
   import json

   bucket_name = 'your-bucket-name'

   # Retrieve the current bucket policy
   try:
       result = s3.get_bucket_policy(Bucket=bucket_name)
       policy = json.loads(result['Policy'])
   except s3.exceptions.NoSuchBucketPolicy:
       policy = {
           "Version": "2012-10-17",
           "Statement": []
       }

   # Define the statement to deny WRITE access to authenticated users
   deny_write_statement = {
       "Effect": "Deny",
       "Principal": "*",
       "Action": "s3:PutObject",
       "Resource": f"arn:aws:s3:::{bucket_name}/*",
       "Condition": {
           "StringEquals": {
               "aws:PrincipalType": "Account"
           }
       }
   }

   # Check if the statement already exists
   if deny_write_statement not in policy['Statement']:
       policy['Statement'].append(deny_write_statement)

   # Update the bucket policy
   s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(policy))
   ```

4. **Verify the Policy**:
   Optionally, you can verify that the policy has been updated correctly by retrieving it again and printing it out.

   ```python
   # Retrieve and print the updated bucket policy
   result = s3.get_bucket_policy(Bucket=bucket_name)
   updated_policy = json.loads(result['Policy'])
   print(json.dumps(updated_policy, indent=4))
   ```

By following these steps, you ensure that your S3 bucket does not allow WRITE access to authenticated users, thereby preventing potential misconfigurations.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for WRITE access.

3. Choose the Permissions tab, and then choose Bucket Policy. Here you can see the bucket policy in JSON format.

4. Look for any statements in the policy that have "Effect": "Allow" and "Principal": "*". If such a statement exists and the "Action" includes "s3:PutObject", "s3:Put*", or "s3:*", then the bucket allows WRITE access to all authenticated AWS users.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account:

   ```
   aws s3api list-buckets --query 'Buckets[].Name'
   ```

3. Check bucket policy: For each bucket, check the bucket policy to see if it allows WRITE access to authenticated users. You can do this by running the following command:

   ```
   aws s3api get-bucket-policy --bucket bucket-name --query 'Policy'
   ```

   Replace "bucket-name" with the name of your bucket. This command will return the bucket's policy in JSON format.

4. Analyze the policy: Look for any statements in the policy that allow "s3:PutObject", "s3:PutObjectAcl", or "s3:PutObjectVersionAcl" actions for the "AuthenticatedUsers" group. If such statements exist, it means the bucket allows WRITE access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure your credentials in several ways, but the simplest is to use the AWS CLI tool. Run `aws configure` and then enter your credentials at the prompts.

3. Write the Python script: Now you can write a Python script that uses boto3 to check the access permissions of your S3 buckets. Here's a simple script that lists all your S3 buckets and checks if they allow WRITE access to authenticated users:

```python
import boto3

s3 = boto3.client('s3')

# List all S3 buckets
response = s3.list_buckets()
buckets = [bucket['Name'] for bucket in response['Buckets']]

# Check each bucket for public WRITE access
for bucket in buckets:
    acl = s3.get_bucket_acl(Bucket=bucket)
    for grant in acl['Grants']:
        if grant['Grantee']['Type'] == 'Group' and 'WRITE' in grant['Permission']:
            print(f"Bucket {bucket} allows WRITE access to authenticated users")
```

4. Run the script: Finally, you can run the script using Python. If any of your S3 buckets allow WRITE access to authenticated users, the script will print a message with the name of the bucket. If no such buckets are found, the script will not print anything.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step by step instructions to remediate the S3 Bucket Should Not Allow WRITE Access to Authenticated Users misconfiguration for AWS using AWS console:

1. Log in to your AWS Management Console.
2. Go to the S3 service.
3. Select the bucket that is misconfigured.
4. Click on the "Permissions" tab.
5. Click on "Bucket Policy".
6. Remove any policies that allow write access to authenticated users.
7. You can also add a policy that explicitly denies write access to authenticated users.

Here is an example of a policy that denies write access to authenticated users:

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyAuthenticatedUsers",
            "Effect": "Deny",
            "Principal": {
                "AWS": "*"
            },
            "Action": [
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:PutObjectAcl",
                "s3:PutObjectVersionAcl"
            ],
            "Resource": [
                "arn:aws:s3:::bucket-name/*"
            ],
            "Condition": {
                "StringEquals": {
                    "aws:PrincipalType": "AuthenticatedUser"
                }
            }
        }
    ]
}
```

8. Click on "Save" to apply the changes.

That's it! You have now successfully remediated the S3 Bucket Should Not Allow WRITE Access to Authenticated Users misconfiguration for AWS using AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of S3 bucket allowing WRITE access to authenticated users in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine and run the following command to list all the S3 buckets in your AWS account:

   `aws s3api list-buckets`

2. Identify the S3 bucket that has WRITE access to authenticated users.

3. Run the following command to remove WRITE access for authenticated users on the identified S3 bucket:

   `aws s3api put-bucket-acl --bucket bucket-name --grant-write "uri=http://acs.amazonaws.com/groups/global/AuthenticatedUsers"`

   Replace `bucket-name` with the name of the identified S3 bucket.

4. Run the following command to verify that authenticated users no longer have WRITE access to the S3 bucket:

   `aws s3api get-bucket-acl --bucket bucket-name`

   Replace `bucket-name` with the name of the identified S3 bucket.

5. Verify that the remediation has worked successfully by attempting to write to the S3 bucket using an authenticated user. The attempt should now fail.

By following the above steps, you have successfully remediated the issue of S3 Bucket allowing WRITE access to Authenticated Users in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "S3 Bucket Should Not Allow WRITE Access to Authenticated Users" in AWS using Python, you can follow these steps:

1. First, you need to identify the S3 bucket that has WRITE access to authenticated users. You can use the following Python code to list all the S3 buckets and their ACLs:

```python
import boto3

# Create an S3 client
s3 = boto3.client('s3')

# List all the S3 buckets
buckets = s3.list_buckets()

# Iterate through each bucket and print its ACL
for bucket in buckets['Buckets']:
    acl = s3.get_bucket_acl(Bucket=bucket['Name'])
    print(f"Bucket {bucket['Name']} ACL: {acl}")
```

2. Once you have identified the bucket with WRITE access to authenticated users, you can update its ACL to remove the WRITE access. You can use the following Python code to remove WRITE access from authenticated users:

```python
import boto3

# Create an S3 client
s3 = boto3.client('s3')

# Set the bucket name and grantee type
bucket_name = 'your-bucket-name'
grantee_type = 'AuthenticatedUsers'

# Get the bucket ACL
acl = s3.get_bucket_acl(Bucket=bucket_name)

# Iterate through each grant and remove WRITE access from authenticated users
for grant in acl['Grants']:
    if grant['Grantee']['Type'] == grantee_type:
        acl['Grants'].remove(grant)
        
# Set the updated ACL for the bucket
s3.put_bucket_acl(Bucket=bucket_name, AccessControlPolicy=acl)
```

3. Run the above code to remove WRITE access from authenticated users for the identified S3 bucket.

Note: Make sure you have the necessary permissions to update the ACL of the S3 bucket.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

