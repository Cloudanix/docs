---
slug: s3_allows_authenticated_full_control
title: S3 Bucket Should Not Allow FULL_CONTROL Access to Authenticated Users
sidebar_label: S3 Bucket Should Not Allow FULL_CONTROL Access to Authenticated Users
---

### More Info:

AWS S3 buckets should not be granting FULL_CONTROL access to authenticated users (i.e. signed AWS accounts or AWS IAM users) in order to prevent unauthorized access. Exposing your S3 buckets to AWS signed accounts or users can lead to data leaks, data loss and unexpected charges for the S3 service.

### Risk Level

High

### Address

Security

### Compliance Standards

CBP, AWSWAF, PCIDSS, NIST


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check for FULL_CONTROL access.

3. Choose the Permissions tab.

4. Under the Access Control List (ACL) section, check the Grantee list. If 'Authenticated Users' is listed with the permission 'FULL_CONTROL', then the bucket is misconfigured as it allows full control access to any authenticated AWS users.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all S3 buckets: Use the following command to list all the S3 buckets in your AWS account.

   ```
   aws s3api list-buckets --query 'Buckets[].Name'
   ```

3. Check bucket policies: For each bucket, you need to check the bucket policy to see if it allows FULL_CONTROL access to authenticated users. You can do this by running the following command for each bucket:

   ```
   aws s3api get-bucket-policy --bucket bucket-name --query 'Policy'
   ```

   Replace 'bucket-name' with the name of your bucket. This command will return the bucket policy in JSON format.

4. Analyze the bucket policies: Look for any statements in the policy that have 'Effect': 'Allow', 'Principal': '*', and 'Action': 's3:*'. If such a statement exists and the 'Resource' includes the ARN of the bucket or any object within the bucket, then the bucket allows FULL_CONTROL access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways. The easiest way is to install the AWS CLI, and then configure it with your credentials:

   ```bash
   aws configure
   ```

3. Write the Python script: The following Python script lists all your S3 buckets and checks if any of them have the FULL_CONTROL permission for authenticated users:

   ```python
   import boto3

   # Create a session using your AWS credentials
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
   )

   # Create an S3 resource object using the session
   s3 = session.resource('s3')

   # Iterate over all your S3 buckets
   for bucket in s3.buckets.all():
       # Get the bucket ACL
       acl = bucket.Acl()
       for grant in acl.grants:
           # Check if the grantee is an authenticated user and has FULL_CONTROL permission
           if grant['Grantee']['Type'] == 'Group' and 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers' in grant['Grantee']['URI'] and 'FULL_CONTROL' in grant['Permission']:
               print(f"Bucket {bucket.name} allows FULL_CONTROL access to authenticated users.")
   ```

4. Run the Python script: Save the script to a file, e.g., check_s3_permissions.py, and then run it using Python:

   ```bash
   python check_s3_permissions.py
   ```

   The script will print the names of all S3 buckets that allow FULL_CONTROL access to authenticated users. If no such buckets exist, the script will not print anything.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the issue of an S3 Bucket allowing FULL_CONTROL access to Authenticated Users in AWS using the AWS console:

1. Login to your AWS account and go to the S3 console.
2. Select the bucket for which you want to remediate the issue.
3. Click on the "Permissions" tab in the top navigation bar.
4. Under the "Access control list (ACL)" section, locate the "Authenticated Users" group and select it.
5. Click on the "Actions" button and select "Edit bucket policy".
6. In the bucket policy editor, remove the "FULL_CONTROL" permission from the "Authenticated Users" group.
7. Click on the "Save changes" button to save the updated bucket policy.

After following these steps, the S3 bucket will no longer allow FULL_CONTROL access to Authenticated Users.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI and run the following command to list all the S3 buckets in your account:

   ```
   aws s3api list-buckets
   ```

2. Identify the S3 bucket that is allowing FULL_CONTROL access to authenticated users.

3. Run the following command to remove the FULL_CONTROL access for authenticated users:

   ```
   aws s3api put-bucket-acl --bucket <bucket-name> --grant-full-control id=uri=http://acs.amazonaws.com/groups/global/AuthenticatedUsers
   ```

   Replace `<bucket-name>` with the name of the S3 bucket that you want to remediate.

4. Verify that the FULL_CONTROL access for authenticated users has been removed by running the following command:

   ```
   aws s3api get-bucket-acl --bucket <bucket-name>
   ```

   This command will display the access control list (ACL) for the specified S3 bucket. Verify that the authenticated users no longer have FULL_CONTROL access.

5. Repeat the above steps for any other S3 buckets that are allowing FULL_CONTROL access to authenticated users.

By following the above steps, you can remediate the misconfiguration in AWS where S3 bucket is allowing FULL_CONTROL access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "S3 Bucket Should Not Allow FULL_CONTROL Access to Authenticated Users" in AWS using Python, you can follow these steps:

1. First, you need to identify the S3 buckets that have full control access to authenticated users. You can use the AWS SDK for Python (Boto3) to list all the S3 buckets and their access control lists (ACLs).

```python
import boto3

s3 = boto3.client('s3')

# List all the S3 buckets
buckets = s3.list_buckets()

# Iterate over the buckets and their ACLs
for bucket in buckets['Buckets']:
    bucket_name = bucket['Name']
    acl = s3.get_bucket_acl(Bucket=bucket_name)
    print(f"Bucket {bucket_name} ACL: {acl}")
```

2. Once you have identified the buckets with full control access to authenticated users, you can update their ACLs to remove the FULL_CONTROL permission for authenticated users. You can use the `put_bucket_acl` method of the S3 client to update the ACL.

```python
import boto3

s3 = boto3.client('s3')

# Update the ACL for the bucket to remove FULL_CONTROL permission for authenticated users
s3.put_bucket_acl(
    Bucket='my-bucket',
    GrantFullControl='',
    GrantRead='',
    GrantWrite='',
    GrantReadACP='',
    GrantWriteACP='',
    AccessControlPolicy={
        'Grants': [
            {
                'Grantee': {
                    'Type': 'Group',
                    'URI': 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
                },
                'Permission': 'READ'
            },
            {
                'Grantee': {
                    'Type': 'Group',
                    'URI': 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
                },
                'Permission': 'WRITE'
            },
            {
                'Grantee': {
                    'Type': 'Group',
                    'URI': 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
                },
                'Permission': 'READ_ACP'
            },
            {
                'Grantee': {
                    'Type': 'Group',
                    'URI': 'http://acs.amazonaws.com/groups/global/AuthenticatedUsers'
                },
                'Permission': 'WRITE_ACP'
            }
        ],
        'Owner': {
            'DisplayName': 'string',
            'ID': 'string'
        }
    }
)
```

This will remove the FULL_CONTROL permission for authenticated users from the ACL of the specified bucket. You can repeat this step for all the buckets that have full control access to authenticated users.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

