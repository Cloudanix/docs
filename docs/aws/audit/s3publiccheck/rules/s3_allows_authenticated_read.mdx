---
slug: s3_allows_authenticated_read
title: S3 Bucket Should Not Allow READ Access to Authenticated Users
sidebar_label: S3 Bucket Should Not Allow READ Access to Authenticated Users
---

### More Info:

S3 buckets should not allow READ access to AWS authenticated users through ACLs n order to protect your S3 data against unauthorized access.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP, AWSWAF, PCIDSS, NIST


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. In the Bucket name list, choose the name of the bucket that you want to check the permissions for.

3. Choose the Permissions tab.

4. Under the "Block Public Access" settings, if the "Block all public access" is set to Off, it means that the bucket might be publicly accessible. 

5. To further check, go to the "Access Control List (ACL)" section. Under the "Public access" column, if "Everyone" or "Any authenticated AWS user" has READ access, then the bucket is misconfigured and allows READ access to authenticated users.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all S3 buckets: Once your AWS CLI is set up, you can list all your S3 buckets by running the following command:
   ```
   aws s3api list-buckets
   ```
   This will return a list of all your S3 buckets.

3. Check bucket policy: For each bucket, you can check its policy by running the following command:
   ```
   aws s3api get-bucket-policy --bucket your-bucket-name
   ```
   Replace "your-bucket-name" with the name of your bucket. This will return the bucket's policy.

4. Detect misconfiguration: In the returned policy, look for any statement with "Effect": "Allow", "Principal": "*", and "Action": "s3:GetObject". If such a statement exists, it means that the bucket allows READ access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3). You can do this by running the command `pip install boto3` in your terminal.

2. Once Boto3 is installed, you can use it to interact with your AWS services. To check for S3 bucket misconfigurations, you need to create a Python script that uses Boto3 to list all your S3 buckets and their policies. Here is a sample script:

```python
import boto3

s3 = boto3.client('s3')

def list_buckets():
    response = s3.list_buckets()
    for bucket in response['Buckets']:
        print(f'Bucket Name: {bucket["Name"]}')
        get_bucket_policy(bucket["Name"])

def get_bucket_policy(bucket_name):
    try:
        result = s3.get_bucket_policy(Bucket=bucket_name)
        print(f'Bucket Policy: {result["Policy"]}')
    except:
        print(f'No policy for bucket: {bucket_name}')

list_buckets()
```

3. This script will print out the names of all your S3 buckets and their policies. You can then manually check these policies to see if they allow READ access to authenticated users. 

4. To automate this process, you can modify the `get_bucket_policy` function to parse the policy and check for any statements that allow 's3:GetObject' (which is the action for READ access) to 'AuthenticatedUsers'. Here is a modified version of the function:

```python
import json

def get_bucket_policy(bucket_name):
    try:
        result = s3.get_bucket_policy(Bucket=bucket_name)
        policy = json.loads(result["Policy"])
        for statement in policy["Statement"]:
            if statement["Effect"] == "Allow" and 's3:GetObject' in statement["Action"] and 'AuthenticatedUsers' in statement["Principal"]:
                print(f'Bucket {bucket_name} allows READ access to authenticated users')
    except:
        print(f'No policy for bucket: {bucket_name}')
```

This script will print out the names of any buckets that allow READ access to authenticated users.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the issue in AWS:

1. Log in to the AWS Management Console and navigate to the S3 service.

2. Select the S3 bucket that is allowing READ access to authenticated users.

3. Click on the "Permissions" tab and then click on "Bucket Policy".

4. In the Bucket Policy Editor, remove any statements that allow authenticated users to read from the bucket.

5. You can use the following policy to deny read access to authenticated users:

```
{
    "Version": "2012-10-17",
    "Id": "DenyReadAccessToAuthenticatedUsers",
    "Statement": [
        {
            "Sid": "DenyReadAccess",
            "Effect": "Deny",
            "Principal": {
                "AWS": [
                    "*"
                ]
            },
            "Action": [
                "s3:GetObject",
                "s3:GetObjectVersion"
            ],
            "Resource": [
                "arn:aws:s3:::bucket-name/*"
            ],
            "Condition": {
                "StringEquals": {
                    "aws:PrincipalType": "AuthenticatedUser"
                }
            }
        }
    ]
}
```

6. Replace "bucket-name" with the name of your S3 bucket.

7. Click on the "Save" button to apply the new policy.

8. Verify that the policy has been applied correctly by attempting to access the S3 bucket as an authenticated user. You should receive an error message indicating that you do not have permission to access the bucket.

That's it! You have successfully remediated the misconfiguration in AWS S3 bucket.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of S3 bucket allowing READ access to authenticated users in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your system.

2. Check the current bucket policy of the S3 bucket using the following command:

   ```
   aws s3api get-bucket-policy --bucket bucket-name
   ```

   Replace `bucket-name` with the name of the S3 bucket.

3. If the current policy allows authenticated users to read the bucket, then create a new policy that denies the read access to authenticated users. You can create a new policy using the following JSON code:

   ```
   {
     "Version": "2012-10-17",
     "Id": "DenyReadAccessToAuthenticatedUsers",
     "Statement": [
       {
         "Sid": "DenyReadAccess",
         "Effect": "Deny",
         "Principal": {
           "AWS": [
             "*"
           ]
         },
         "Action": [
           "s3:GetObject"
         ],
         "Resource": [
           "arn:aws:s3:::bucket-name/*"
         ],
         "Condition": {
           "StringEquals": {
             "aws:PrincipalType": "AuthenticatedUser"
           }
         }
       }
     ]
   }
   ```

   Replace `bucket-name` with the name of the S3 bucket.

4. Apply the new policy to the S3 bucket using the following command:

   ```
   aws s3api put-bucket-policy --bucket bucket-name --policy file://policy.json
   ```

   Replace `bucket-name` with the name of the S3 bucket, and `policy.json` with the name of the file containing the new policy.

5. Verify the updated bucket policy using the following command:

   ```
   aws s3api get-bucket-policy --bucket bucket-name
   ```

   Replace `bucket-name` with the name of the S3 bucket.

After following these steps, the S3 bucket will no longer allow READ access to authenticated users.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "S3 Bucket Should Not Allow READ Access to Authenticated Users" for AWS using Python, you can follow the below steps:

Step 1: Install and configure AWS SDK for Python (Boto3) on your local machine.

Step 2: Write a Python script that uses Boto3 to update the S3 bucket policy to remove the read access for authenticated users. Below is an example code snippet:

```
import boto3
import json

# Initialize the S3 client
s3 = boto3.client('s3')

# Specify the bucket name and policy
bucket_name = 'your-bucket-name'
policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyReadAccessToAuthenticatedUsers",
            "Effect": "Deny",
            "Principal": {
                "AWS": "*"
            },
            "Action": [
                "s3:GetObject",
                "s3:GetObjectAcl",
                "s3:GetObjectVersion",
                "s3:GetObjectVersionAcl"
            ],
            "Resource": [
                "arn:aws:s3:::{}/*".format(bucket_name)
            ],
            "Condition": {
                "StringEquals": {
                    "aws:PrincipalType": "AuthenticatedUser"
                }
            }
        }
    ]
}

# Convert the policy to a JSON string
policy_json = json.dumps(policy)

# Update the bucket policy
s3.put_bucket_policy(Bucket=bucket_name, Policy=policy_json)
```

Step 3: Run the Python script on your local machine to update the S3 bucket policy.

Once the script is executed, the bucket policy will be updated to deny read access to authenticated users.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-overview.html) 

