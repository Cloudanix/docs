---
slug: redshift_cluster_in_vpc
title: Redshift Clusters Should Be Launched Within a VPC
sidebar_label: Redshift Clusters Should Be Launched Within a VPC
---

### More Info:

Your Redshift clusters should be provisioned within the AWS EC2-VPC platform instead of EC2-Classic platform (outdated) for better flexibility and control over clusters security, traffic routing, availability and more.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the top menu, then selecting "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand menu. This will display a list of all your Redshift clusters.
4. For each cluster, check the "VPC ID" column. If a cluster has a VPC ID listed, it is launched within a VPC. If the "VPC ID" column is blank or not listed, the cluster is not launched within a VPC, indicating a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the Redshift clusters available in your AWS account. You can do this by using the AWS CLI command:

```bash
aws redshift describe-clusters --query 'Clusters[*].[ClusterIdentifier]' --output text
```

This command will return a list of all Redshift cluster identifiers.

2. Next, for each cluster identifier returned from the previous step, you need to describe the cluster to get its details. You can do this by using the AWS CLI command:

```bash
aws redshift describe-clusters --cluster-identifier <ClusterIdentifier> --query 'Clusters[*].[VpcId]' --output text
```

Replace `<ClusterIdentifier>` with the actual cluster identifier. This command will return the VPC ID in which the Redshift cluster is launched.

3. If the VPC ID returned from the previous step is `None` or `null`, it means that the Redshift cluster is not launched within a VPC. This is a misconfiguration as Redshift clusters should always be launched within a VPC for better security and isolation.

4. Repeat the above steps for all Redshift clusters in your AWS account. If any cluster is not launched within a VPC, it is a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your local environment. This will allow you to interact with AWS services including Redshift.

```python
pip install boto3
aws configure
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a Redshift client using the session.

```python
redshift = session.client('redshift')
```

4. Use the `describe_clusters` method to retrieve information about all Redshift clusters. Then, iterate over the clusters and check the `VpcId` attribute. If a cluster does not have a `VpcId`, it means it is not launched within a VPC.

```python
clusters = redshift.describe_clusters()
for cluster in clusters['Clusters']:
    if 'VpcId' not in cluster:
        print(f"Cluster {cluster['ClusterIdentifier']} is not launched within a VPC.")
```

This script will print the identifiers of all Redshift clusters that are not launched within a VPC.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of launching Redshift clusters outside of a VPC in AWS, follow these steps using the AWS Management Console:

1. **Create a VPC (Virtual Private Cloud)**:
   - Go to the AWS Management Console and navigate to the VPC dashboard.
   - Click on "Create VPC" and provide the necessary details like VPC name, CIDR block, and other configurations.
   - Create at least one subnet within the VPC for your Redshift cluster.

2. **Modify Redshift Cluster Configuration**:
   - Go to the Amazon Redshift console.
   - Select the Redshift cluster that is not within a VPC.
   - Click on the "Cluster" actions dropdown and select "Modify".
   - In the "Network and security" section, choose the VPC and the subnet you created in step 1.
   - Save the changes.

3. **Verify the Configuration**:
   - Once the modification is complete, verify that the Redshift cluster is now launched within the VPC.
   - Check the VPC ID and subnet ID associated with the Redshift cluster to ensure it is within the desired VPC.

4. **Update Security Group Rules**:
   - Update the security group rules associated with the Redshift cluster to allow necessary inbound and outbound traffic within the VPC.

5. **Test the Redshift Cluster**:
   - After making these changes, test the Redshift cluster to ensure it is functioning as expected within the VPC.

By following these steps, you can remediate the misconfiguration of launching Redshift clusters outside of a VPC in AWS and ensure that your Redshift cluster is securely deployed within a VPC.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of launching Redshift clusters within a VPC in AWS using AWS CLI, follow these steps:

1. **Create a VPC (if not already created):**
   ```bash
   aws ec2 create-vpc --cidr-block 10.0.0.0/16
   ```

2. **Create a subnet within the VPC:**
   ```bash
   aws ec2 create-subnet --vpc-id <VPC_ID> --cidr-block 10.0.1.0/24
   ```

3. **Create a security group for Redshift within the VPC:**
   ```bash
   aws ec2 create-security-group --group-name redshift-sg --description "Redshift Security Group" --vpc-id <VPC_ID>
   ```

4. **Allow necessary inbound rules for the security group (e.g., Redshift port 5439):**
   ```bash
   aws ec2 authorize-security-group-ingress --group-id <SECURITY_GROUP_ID> --protocol tcp --port 5439 --cidr 0.0.0.0/0
   ```

5. **Launch a Redshift cluster within the VPC:**
   ```bash
   aws redshift create-cluster --cluster-identifier myredshiftcluster --node-type dc2.large --master-username admin --master-user-password <PASSWORD> --cluster-type single-node --vpc-security-group-ids <SECURITY_GROUP_ID> --cluster-subnet-group-name <SUBNET_GROUP_NAME>
   ```

6. **Ensure that the Redshift cluster is launched within the VPC by checking the VPC ID of the cluster:**
   ```bash
   aws redshift describe-clusters --cluster-identifier myredshiftcluster
   ```

By following these steps, you would have successfully remediated the misconfiguration of launching Redshift clusters within a VPC in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of launching Redshift clusters within a VPC in AWS using Python, you can follow these steps:

1. Import the necessary Python libraries:
```python
import boto3
```

2. Initialize the AWS Redshift client:
```python
redshift_client = boto3.client('redshift')
```

3. Get a list of existing Redshift clusters:
```python
response = redshift_client.describe_clusters()
clusters = response['Clusters']
```

4. For each Redshift cluster, check if it is launched within a VPC:
```python
for cluster in clusters:
    cluster_id = cluster['ClusterIdentifier']
    vpc_id = cluster.get('VpcId', None)
    
    if vpc_id is None:
        # Modify the cluster to launch within a VPC
        redshift_client.modify_cluster(ClusterIdentifier=cluster_id, VpcSecurityGroupIds=['vpc-security-group-id'])
```

5. Replace `'vpc-security-group-id'` with the appropriate VPC security group ID where you want to launch the Redshift cluster.

6. Run the Python script to remediate the misconfiguration by launching the Redshift clusters within a VPC.

By following these steps, you can use Python to remediate the misconfiguration of launching Redshift clusters within a VPC in AWS.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/getting-started-cluster-in-vpc.html](https://docs.aws.amazon.com/redshift/latest/mgmt/getting-started-cluster-in-vpc.html) 

