---
slug: idle_redshift_cluster
title: Idle Redshift Clusters Should Be Terminated
sidebar_label: Idle Redshift Clusters Should Be Terminated
---

### More Info:

Idle AWS Redshift clusters should be terminated in order to help lower the cost of your monthly AWS bill.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent idle Redshift clusters from remaining active and incurring unnecessary costs using the AWS Management Console, follow these steps:

1. **Enable Cost Allocation Tags:**
   - Navigate to the AWS Management Console.
   - Go to the "Billing and Cost Management" dashboard.
   - Select "Cost Allocation Tags" and activate relevant tags to track Redshift usage and costs.

2. **Set Up CloudWatch Alarms:**
   - Open the Amazon CloudWatch console.
   - Create a new alarm by selecting "Alarms" and then "Create Alarm."
   - Choose the Redshift metrics related to CPU utilization, disk space, or query performance.
   - Set thresholds for these metrics to identify when a cluster is idle (e.g., CPU utilization below 5% for a certain period).

3. **Enable Enhanced Monitoring:**
   - Go to the Amazon Redshift console.
   - Select the cluster you want to monitor.
   - Enable "Enhanced VPC Routing" and "Enhanced Monitoring" to get detailed metrics and logs.
   - Use these insights to identify idle clusters.

4. **Automate Notifications:**
   - In the CloudWatch console, set up SNS (Simple Notification Service) to send alerts when the CloudWatch alarm is triggered.
   - Configure the SNS topic to notify relevant stakeholders via email or SMS when a cluster is identified as idle.

By following these steps, you can effectively monitor and manage your Redshift clusters to ensure that idle clusters are identified and can be terminated promptly to save costs.
</Accordion>

<Accordion title='Using CLI'>
To prevent idle Redshift clusters from being left running and incurring unnecessary costs, you can set up automated monitoring and termination using AWS CLI. Here are the steps:

1. **Create a CloudWatch Alarm for Idle Redshift Cluster:**
   - Use CloudWatch to monitor the CPU utilization of your Redshift clusters. If the CPU utilization is below a certain threshold for a specified period, it can be considered idle.
   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "IdleRedshiftClusterAlarm" \
   --metric-name CPUUtilization --namespace AWS/Redshift --statistic Average \
   --period 300 --threshold 10 --comparison-operator LessThanThreshold \
   --dimensions Name=ClusterIdentifier,Value=<YourClusterIdentifier> \
   --evaluation-periods 12 --alarm-actions <SNS_Topic_ARN> \
   --unit Percent
   ```

2. **Create an SNS Topic for Alarm Notifications:**
   - Create an SNS topic to receive notifications when the CloudWatch alarm is triggered.
   ```sh
   aws sns create-topic --name IdleRedshiftClusterTopic
   ```

3. **Subscribe to the SNS Topic:**
   - Subscribe an email endpoint to the SNS topic to receive notifications.
   ```sh
   aws sns subscribe --topic-arn <SNS_Topic_ARN> --protocol email --notification-endpoint <YourEmail@example.com>
   ```

4. **Create a Lambda Function to Terminate Idle Clusters:**
   - Create a Lambda function that will be triggered by the SNS topic to terminate the idle Redshift cluster.
   ```sh
   aws lambda create-function --function-name TerminateIdleRedshiftCluster \
   --runtime python3.8 --role <IAM_Role_ARN> --handler lambda_function.lambda_handler \
   --zip-file fileb://function.zip
   ```

   - The `lambda_function.py` should contain logic to terminate the Redshift cluster:
   ```python
   import boto3

   def lambda_handler(event, context):
       redshift = boto3.client('redshift')
       cluster_identifier = '<YourClusterIdentifier>'
       redshift.delete_cluster(ClusterIdentifier=cluster_identifier, SkipFinalClusterSnapshot=True)
   ```

By following these steps, you can automate the monitoring and termination of idle Redshift clusters using AWS CLI, ensuring that you do not incur unnecessary costs.
</Accordion>

<Accordion title='Using Python'>
To prevent idle Amazon Redshift clusters from being left running and incurring unnecessary costs, you can use Python scripts to automate the monitoring and termination of these clusters. Below are the steps to achieve this:

### Step 1: Set Up AWS SDK for Python (Boto3)
First, ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip if you haven't already:

```bash
pip install boto3
```

### Step 2: Configure AWS Credentials
Make sure your AWS credentials are configured. You can do this by setting up the `~/.aws/credentials` file or by using environment variables.

### Step 3: Write the Python Script
Create a Python script to monitor and terminate idle Redshift clusters. Below is an example script:

```python
import boto3
from datetime import datetime, timedelta

# Initialize a session using Amazon Redshift
client = boto3.client('redshift')

# Define the idle time threshold (e.g., 1 hour)
idle_time_threshold = timedelta(hours=1)

def get_idle_clusters():
    # Get the list of clusters
    clusters = client.describe_clusters()['Clusters']
    idle_clusters = []

    for cluster in clusters:
        # Check if the cluster is available
        if cluster['ClusterStatus'] == 'available':
            # Get the cluster's last activity time
            last_activity_time = cluster['ClusterCreateTime']
            current_time = datetime.utcnow().replace(tzinfo=None)
            idle_time = current_time - last_activity_time

            # Check if the cluster has been idle for longer than the threshold
            if idle_time > idle_time_threshold:
                idle_clusters.append(cluster['ClusterIdentifier'])

    return idle_clusters

def terminate_idle_clusters(idle_clusters):
    for cluster_id in idle_clusters:
        print(f"Terminating idle cluster: {cluster_id}")
        client.delete_cluster(ClusterIdentifier=cluster_id, SkipFinalClusterSnapshot=True)

if __name__ == "__main__":
    idle_clusters = get_idle_clusters()
    if idle_clusters:
        terminate_idle_clusters(idle_clusters)
    else:
        print("No idle clusters found.")
```

### Step 4: Automate the Script Execution
To ensure this script runs periodically, you can set up a cron job (on Linux) or use AWS Lambda with CloudWatch Events to trigger the script at regular intervals.

#### Using AWS Lambda and CloudWatch Events:
1. **Create a Lambda Function:**
   - Go to the AWS Lambda console and create a new function.
   - Upload the Python script as the function code.
   - Set up the necessary IAM role with permissions to describe and delete Redshift clusters.

2. **Create a CloudWatch Event Rule:**
   - Go to the CloudWatch console and create a new rule.
   - Set the rule to trigger at your desired interval (e.g., every hour).
   - Set the target to the Lambda function you created.

By following these steps, you can automate the prevention of idle Redshift clusters, ensuring they are terminated promptly to avoid unnecessary costs.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the navigation bar, then choosing "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand navigation pane. This will display a list of all your Redshift clusters.
4. For each cluster, check the "Last Modified" date and time under the "Properties" tab. If a cluster has not been modified or accessed for a long period of time, it may be idle and should be considered for termination.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all Redshift clusters: Use the following AWS CLI command to list all Redshift clusters in your AWS account:

   ```
   aws redshift describe-clusters --query 'Clusters[*].[ClusterIdentifier, ClusterStatus]' --output text
   ```
   This command will return a list of all Redshift clusters along with their status.

3. Check the status of each Redshift cluster: From the output of the previous command, check the status of each Redshift cluster. If the status of a cluster is 'available' but it's not being used, it's an idle cluster.

4. Check the last access time of each Redshift cluster: To confirm if a cluster is idle, you can check the last access time of the cluster. Unfortunately, AWS CLI does not provide a direct command to do this. However, you can run a SQL query on each cluster to get the last access time. The query is:

   ```
   SELECT db_id, MAX(last_activity_time) FROM stv_sessions GROUP BY db_id;
   ```
   If the last access time is a long time ago, the cluster is likely idle.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) on your local system. This SDK allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc.

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a Redshift client and retrieve all the Redshift clusters.

```python
redshift_client = session.client('redshift')

try:
    response = redshift_client.describe_clusters()
except ClientError as e:
    print(f"Error: {e}")
```

4. Iterate over the clusters and check the 'ClusterStatus' attribute. If the status is 'available' but the 'NumberOfNodes' attribute is 0, then the cluster is idle.

```python
for cluster in response['Clusters']:
    if cluster['ClusterStatus'] == 'available' and cluster['NumberOfNodes'] == 0:
        print(f"Idle Redshift Cluster: {cluster['ClusterIdentifier']}")
```

This script will print out the identifiers of all idle Redshift clusters. You can then decide what action to take based on this information.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of idle Redshift clusters in AWS, follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and sign in using your credentials.

2. **Navigate to Amazon Redshift**: From the AWS Management Console, navigate to the Amazon Redshift service by typing "Redshift" in the search bar and selecting it from the options.

3. **Identify Idle Clusters**: In the Amazon Redshift dashboard, identify the Redshift clusters that are idle and have no active queries or connections. You can check the "Last Modified" or "Last Backup" timestamps to identify clusters that have been inactive for a long time.

4. **Select the Idle Cluster**: Click on the checkbox next to the idle Redshift cluster that you want to terminate.

5. **Terminate the Cluster**: Click on the "Clusters" tab at the top of the dashboard and then click on the "Actions" dropdown menu. Select "Delete cluster" from the options.

6. **Confirm Termination**: A confirmation window will appear asking you to confirm the termination of the cluster. Enter the cluster identifier in the text box and click on the "Delete" button to confirm.

7. **Monitor Deletion**: Once you confirm the deletion, the idle Redshift cluster will start the termination process. Monitor the progress in the Amazon Redshift dashboard until the cluster is successfully terminated.

8. **Repeat if Necessary**: Repeat the above steps for any other idle Redshift clusters that need to be terminated to avoid unnecessary costs and resource wastage.

By following these steps, you can remediate the issue of idle Redshift clusters in AWS and ensure that only active clusters are running to optimize costs and resources effectively.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the idle Redshift clusters in AWS using AWS CLI, follow these steps:

Step 1: List all the Redshift clusters in your AWS account to identify the idle clusters. Run the following command in AWS CLI:

```
aws redshift describe-clusters --query "Clusters[?ClusterStatus=='available'].{ClusterIdentifier:ClusterIdentifier, ClusterStatus:ClusterStatus, CreateTime:CreateTime}" --output table
```

Step 2: Identify the idle Redshift clusters based on the `ClusterStatus` and `CreateTime` values. Look for clusters that have not been used for an extended period and are in the `available` status.

Step 3: Terminate the idle Redshift clusters to save costs and resources. Run the following command in AWS CLI to delete the identified idle cluster:

```
aws redshift delete-cluster --cluster-identifier <cluster-identifier> --skip-final-cluster-snapshot
```

Replace `<cluster-identifier>` with the actual identifier of the idle cluster you want to terminate.

Step 4: Confirm the termination of the cluster by listing all the Redshift clusters again:

```
aws redshift describe-clusters --query "Clusters[?ClusterStatus=='available'].{ClusterIdentifier:ClusterIdentifier, ClusterStatus:ClusterStatus, CreateTime:CreateTime}" --output table
```

Ensure that the terminated cluster is no longer listed in the output.

By following these steps, you can remediate the issue of idle Redshift clusters in AWS by terminating them using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of idle Redshift clusters not being terminated in AWS using Python, you can create a script that programmatically checks for idle clusters based on certain criteria (e.g., last query execution time, CPU utilization, etc.) and terminates them if they are deemed idle. Here's a step-by-step guide on how to do this:

1. **Install Boto3**: Boto3 is the AWS SDK for Python that allows you to interact with AWS services. You can install it using pip:
   ```
   pip install boto3
   ```

2. **Create a Python Script**:
   Create a Python script (e.g., `terminate_idle_redshift_clusters.py`) and import the necessary libraries:
   ```python
   import boto3
   import datetime
   ```

3. **Initialize Boto3**:
   Initialize the Boto3 client for Redshift:
   ```python
   redshift = boto3.client('redshift')
   ```

4. **Define Criteria for Idle Clusters**:
   Define the criteria for identifying idle clusters. This could be based on factors like last query execution time, CPU utilization, etc.

5. **List Redshift Clusters**:
   Use the `describe_clusters` method to list all Redshift clusters:
   ```python
   response = redshift.describe_clusters()
   clusters = response['Clusters']
   ```

6. **Check for Idle Clusters**:
   Iterate through the list of clusters and check if they meet the criteria for being idle:
   ```python
   for cluster in clusters:
       # Add your logic here to determine if the cluster is idle
       # If the cluster is deemed idle, terminate it
       if cluster_is_idle:
           redshift.delete_cluster(ClusterIdentifier=cluster['ClusterIdentifier'], SkipFinalClusterSnapshot=True)
   ```

7. **Run the Script**:
   Run the Python script periodically (e.g., using a cron job) to check for and terminate idle Redshift clusters.

8. **Testing**:
   Test the script in a non-production environment to ensure that it correctly identifies and terminates idle clusters without affecting active clusters.

By following these steps, you can create a Python script to automatically identify and terminate idle Redshift clusters in AWS, helping to optimize costs and resources.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/performance-metrics-perf.html](https://docs.aws.amazon.com/redshift/latest/mgmt/performance-metrics-perf.html) 

