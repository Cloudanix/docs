---
slug: deferred_maintenance
title: Redshift Clusters Should Have Deferred Maintenance Enabled
sidebar_label: Redshift Clusters Should Have Deferred Maintenance Enabled
---

### More Info:

Deferred maintenance should be enabled for all your AWS Redshift clusters in order to keep your data warehouse running without interruption during critical business periods. Amazon Redshift service gives you the option to defer maintenance for your clusters by up to 14 days.

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

NIST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the top menu, then selecting "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand menu. This will display a list of all your Redshift clusters.
4. For each cluster, select the cluster name to open its details page. Under the "Configuration" tab, look for the "Maintenance" section. If "Deferred Maintenance" is not enabled, it means the cluster has a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Redshift clusters: Use the following AWS CLI command to list all the Redshift clusters in your account:

   ```
   aws redshift describe-clusters --query 'Clusters[*].[ClusterIdentifier]' --output text
   ```

   This command will return a list of all Redshift cluster identifiers.

3. Check the maintenance settings for each cluster: For each cluster identifier returned by the previous command, run the following command to get the maintenance settings:

   ```
   aws redshift describe-clusters --cluster-identifier <ClusterIdentifier> --query 'Clusters[*].[DeferredMaintenanceWindows]' --output text
   ```

   Replace `<ClusterIdentifier>` with the actual cluster identifier. This command will return the deferred maintenance windows for the specified Redshift cluster.

4. Analyze the output: If the output of the previous command is empty, it means that deferred maintenance is not enabled for the specified Redshift cluster. If the output contains one or more maintenance windows, it means that deferred maintenance is enabled. Repeat steps 3 and 4 for each Redshift cluster in your account.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) on your local system. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
pip install boto3
aws configure
```

2. Import the necessary modules and create a Redshift client using your AWS credentials.

```python
import boto3
redshift = boto3.client('redshift')
```

3. Use the `describe_clusters` method to retrieve information about all your Redshift clusters. This method returns a dictionary containing the details of each cluster.

```python
clusters = redshift.describe_clusters()
```

4. Iterate over each cluster and check the `DeferredMaintenanceWindows` attribute. If this attribute is not enabled, then the cluster has a misconfiguration.

```python
for cluster in clusters['Clusters']:
    if not cluster['DeferredMaintenanceWindows']:
        print(f"Cluster {cluster['ClusterIdentifier']} has Deferred Maintenance not enabled.")
```

This script will print out the identifiers of all Redshift clusters that do not have deferred maintenance enabled. This allows you to quickly identify any misconfigured clusters.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of missing deferred maintenance for AWS Redshift clusters, follow these steps using the AWS Management Console:

1. **Log in to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in using your credentials.

2. **Navigate to Amazon Redshift**: In the AWS Management Console, navigate to the Amazon Redshift service by either searching for it in the services search bar or locating it under the "Analytics" section.

3. **Select the Redshift Cluster**: From the list of Redshift clusters, select the cluster for which you want to enable deferred maintenance.

4. **Modify Cluster**: Click on the cluster name to access the cluster details and then click on the "Modify" button at the top of the page.

5. **Enable Deferred Maintenance**: In the cluster settings, scroll down to the "Maintenance" section. Look for the option related to deferred maintenance and enable it by checking the box or selecting the appropriate option.

6. **Review and Apply Changes**: Review the other settings to ensure they are as per your requirements. Once you have enabled deferred maintenance, click on the "Apply Changes" button to save the modifications.

7. **Monitor the Status**: After applying the changes, monitor the cluster status to ensure that deferred maintenance is successfully enabled. You can check the maintenance schedule to verify that it reflects the changes made.

By following these steps, you can remediate the misconfiguration of missing deferred maintenance for your AWS Redshift cluster using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of Redshift clusters not having deferred maintenance enabled in AWS using AWS CLI, follow these steps:

1. **List Existing Clusters**: First, you need to list all the existing Redshift clusters to identify the cluster that needs to have deferred maintenance enabled. Run the following AWS CLI command to list all Redshift clusters:

```bash
aws redshift describe-clusters
```

2. **Identify the Cluster**: Identify the cluster for which you want to enable deferred maintenance based on the output of the above command.

3. **Enable Deferred Maintenance**: Once you have identified the cluster, run the following AWS CLI command to enable deferred maintenance for the identified Redshift cluster. Replace `<cluster-identifier>` with the actual identifier of the Redshift cluster:

```bash
aws redshift modify-cluster-maintenance --cluster-identifier <cluster-identifier> --defer-maintenance
```

4. **Verify Deferred Maintenance**: To verify that deferred maintenance has been successfully enabled for the cluster, you can describe the cluster again and check the maintenance settings:

```bash
aws redshift describe-clusters --cluster-identifier <cluster-identifier>
```

After following these steps, the deferred maintenance should be successfully enabled for the specified Redshift cluster, remedying the misconfiguration.

#### Using Python

To remediate the misconfiguration of deferred maintenance not being enabled for AWS Redshift clusters using Python, you can use the AWS SDK for Python (Boto3). Below are the step-by-step instructions to enable deferred maintenance for Redshift clusters:

1. Install Boto3: If you haven't already installed the Boto3 library, you can install it using pip by running the following command:
   ```
   pip install boto3
   ```

2. Configure AWS Credentials: Make sure you have configured your AWS credentials either by setting environment variables or using the AWS CLI `aws configure` command.

3. Write Python Script: Create a Python script with the following code to enable deferred maintenance for Redshift clusters:

```python
import boto3

def enable_deferred_maintenance(redshift_cluster_identifier):
    # Create a Redshift client
    redshift_client = boto3.client('redshift')

    # Enable deferred maintenance for the specified Redshift cluster
    response = redshift_client.modify_cluster(
        ClusterIdentifier=redshift_cluster_identifier,
        DeferMaintenance=True
    )

    print(f"Deferred maintenance enabled for Redshift cluster {redshift_cluster_identifier}")

# Specify the Redshift cluster identifier for which you want to enable deferred maintenance
redshift_cluster_identifier = 'your-redshift-cluster-identifier'

# Call the function to enable deferred maintenance
enable_deferred_maintenance(redshift_cluster_identifier)
```

4. Replace `'your-redshift-cluster-identifier'` with the actual identifier of your Redshift cluster.

5. Run the Python Script: Execute the Python script, and it will enable deferred maintenance for the specified Redshift cluster.

By following these steps, you can remediate the misconfiguration of deferred maintenance not being enabled for AWS Redshift clusters using Python and the Boto3 library.

### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html](https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html) 


</Tab>
</Tabs>