---
slug: underutilized_redshift_cluster
title: Redshift Cluster Should Not be Underutilized
sidebar_label: Redshift Cluster Should Not be Underutilized
---

### More Info:

Underutilized Redshift clusters should be downsized in order to optimize AWS costs.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP



### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Redshift clusters from being underutilized using the AWS Management Console, follow these steps:

1. **Monitor Cluster Performance:**
   - Navigate to the Amazon Redshift console.
   - Select the cluster you want to monitor.
   - Go to the "Performance" tab to review metrics such as CPU utilization, disk space usage, and query performance.
   - Set up CloudWatch alarms to notify you when certain thresholds are breached, indicating underutilization.

2. **Resize the Cluster:**
   - In the Amazon Redshift console, select the cluster.
   - Choose "Actions" and then "Resize".
   - Adjust the number of nodes or the node type to better match your workload requirements.

3. **Enable Concurrency Scaling:**
   - Go to the Amazon Redshift console and select your cluster.
   - Navigate to the "Properties" tab.
   - Under "Concurrency Scaling", enable the feature to automatically add and remove capacity based on your workload demands.

4. **Review and Optimize Workloads:**
   - Regularly review the types of queries and workloads running on your Redshift cluster.
   - Use the "Query Monitoring" tab to identify long-running or inefficient queries.
   - Optimize these queries or consider offloading less critical workloads to other services like Amazon S3 or Amazon Athena.

By following these steps, you can ensure that your Redshift clusters are appropriately sized and utilized, preventing underutilization and optimizing costs.
</Accordion>

<Accordion title='Using CLI'>
To prevent Redshift clusters from being underutilized using AWS CLI, you can follow these steps:

1. **Monitor Cluster Performance:**
   Regularly monitor the performance of your Redshift clusters to ensure they are being utilized efficiently. Use the `describe-clusters` command to get details about your clusters.

   ```sh
   aws redshift describe-clusters
   ```

2. **Enable Enhanced VPC Routing:**
   Ensure that Enhanced VPC Routing is enabled for your Redshift cluster to optimize data transfer and reduce costs.

   ```sh
   aws redshift modify-cluster --cluster-identifier <your-cluster-id> --enhanced-vpc-routing-enabled
   ```

3. **Set Up CloudWatch Alarms:**
   Create CloudWatch alarms to monitor key metrics such as CPU utilization, disk space, and query performance. This will help you identify underutilized clusters.

   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "RedshiftCPUUtilization" --metric-name CPUUtilization --namespace AWS/Redshift --statistic Average --period 300 --threshold 20 --comparison-operator LessThanThreshold --dimensions Name=ClusterIdentifier,Value=<your-cluster-id> --evaluation-periods 1 --alarm-actions <your-sns-topic-arn>
   ```

4. **Automate Scaling:**
   Use AWS Lambda and CloudWatch Events to automate the scaling of your Redshift clusters based on utilization metrics. This can help in adjusting the cluster size dynamically to match the workload.

   ```sh
   aws events put-rule --name "RedshiftScalingRule" --schedule-expression "rate(1 hour)"
   aws lambda create-function --function-name "RedshiftAutoScaling" --runtime python3.8 --role <your-iam-role-arn> --handler lambda_function.lambda_handler --zip-file fileb://function.zip
   aws events put-targets --rule "RedshiftScalingRule" --targets "Id"="1","Arn"="<your-lambda-function-arn>"
   ```

By following these steps, you can ensure that your Redshift clusters are not underutilized and are operating efficiently.
</Accordion>

<Accordion title='Using Python'>
To prevent Redshift clusters from being underutilized using Python scripts, you can follow these steps:

1. **Install Required Libraries**:
   Ensure you have the necessary libraries installed. You will need `boto3` to interact with AWS services.

   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

   ```bash
   aws configure
   ```

3. **Monitor Cluster Utilization**:
   Write a Python script to monitor the utilization of your Redshift clusters. You can use CloudWatch metrics to get the CPU utilization and other performance metrics.

   ```python
   import boto3

   def get_redshift_clusters():
       client = boto3.client('redshift')
       clusters = client.describe_clusters()
       return clusters['Clusters']

   def get_cluster_utilization(cluster_identifier):
       cloudwatch = boto3.client('cloudwatch')
       metrics = cloudwatch.get_metric_statistics(
           Namespace='AWS/Redshift',
           MetricName='CPUUtilization',
           Dimensions=[
               {
                   'Name': 'ClusterIdentifier',
                   'Value': cluster_identifier
               },
           ],
           StartTime=datetime.utcnow() - timedelta(days=1),
           EndTime=datetime.utcnow(),
           Period=3600,
           Statistics=['Average']
       )
       return metrics['Datapoints']

   clusters = get_redshift_clusters()
   for cluster in clusters:
       utilization = get_cluster_utilization(cluster['ClusterIdentifier'])
       print(f"Cluster {cluster['ClusterIdentifier']} utilization: {utilization}")
   ```

4. **Automate Scaling Actions**:
   Based on the utilization metrics, you can automate actions to scale your Redshift cluster up or down. For example, if the utilization is consistently low, you can resize the cluster to a smaller node type or reduce the number of nodes.

   ```python
   def resize_cluster(cluster_identifier, node_type, number_of_nodes):
       client = boto3.client('redshift')
       response = client.modify_cluster(
           ClusterIdentifier=cluster_identifier,
           NodeType=node_type,
           NumberOfNodes=number_of_nodes
       )
       return response

   for cluster in clusters:
       utilization = get_cluster_utilization(cluster['ClusterIdentifier'])
       avg_utilization = sum([point['Average'] for point in utilization]) / len(utilization)
       if avg_utilization < 20:  # Example threshold
           print(f"Cluster {cluster['ClusterIdentifier']} is underutilized. Resizing...")
           resize_cluster(cluster['ClusterIdentifier'], 'dc2.large', 2)  # Example resize action
   ```

By following these steps, you can monitor and prevent your Redshift clusters from being underutilized using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon Redshift console at https://console.aws.amazon.com/redshift/.

2. In the navigation pane, choose "Clusters". This will display a list of all your Redshift clusters.

3. Select the cluster that you want to check for underutilization. This will open the cluster details page.

4. In the cluster details page, check the "Performance" tab. Here, you can see various metrics related to the cluster's performance such as CPU Utilization, Database Connections, and Query Performance. If the CPU Utilization is consistently low (for example, below 20%) and the Database Connections are not many, it indicates that the cluster may be underutilized.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured with the necessary permissions. You can install it using pip:
   ```
   pip install awscli
   ```
   Then configure it using:
   ```
   aws configure
   ```
   You'll be asked to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. **List all Redshift Clusters**: Use the following command to list all the Redshift clusters:
   ```
   aws redshift describe-clusters
   ```
   This command will return a JSON output with details of all the Redshift clusters.

3. **Check the Performance Metrics**: For each cluster, you need to check the performance metrics to determine if it's underutilized. You can use the following command to get the performance metrics:
   ```
   aws cloudwatch get-metric-statistics --namespace "AWS/Redshift" --metric-name "CPUUtilization" --dimensions Name=ClusterIdentifier,Value=<your-cluster-identifier> --start-time <start-time> --end-time <end-time> --period 3600 --statistics "Average" --unit "Percent"
   ```
   Replace `<your-cluster-identifier>`, `<start-time>`, and `<end-time>` with your actual cluster identifier and the time period for which you want to check the metrics. This command will return the average CPU utilization for the specified period.

4. **Analyze the Output**: If the CPU utilization is consistently low (for example, less than 20%) over a long period of time (for example, over the past month), it indicates that the Redshift cluster is underutilized. You might want to consider downsizing the cluster or shutting it down to save costs.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) on your local system. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
pip install boto3
aws configure
```

2. Create a Python script that uses Boto3 to interact with the AWS Redshift service. The script will list all the Redshift clusters and their performance data.

```python
import boto3

def list_clusters():
    client = boto3.client('redshift')
    response = client.describe_clusters()
    return response['Clusters']

def get_cluster_performance(cluster_identifier):
    client = boto3.client('cloudwatch')
    response = client.get_metric_statistics(
        Namespace='AWS/Redshift',
        MetricName='CPUUtilization',
        Dimensions=[
            {
                'Name': 'ClusterIdentifier',
                'Value': cluster_identifier
            },
        ],
        StartTime=datetime.datetime.utcnow() - datetime.timedelta(seconds=600),
        EndTime=datetime.datetime.utcnow(),
        Period=60,
        Statistics=[
            'Average',
        ],
    )
    return response['Datapoints']
```

3. Iterate over each cluster and check its CPU utilization. If the CPU utilization is consistently low, the cluster may be underutilized.

```python
clusters = list_clusters()
for cluster in clusters:
    performance = get_cluster_performance(cluster['ClusterIdentifier'])
    average_cpu_utilization = sum([datapoint['Average'] for datapoint in performance]) / len(performance)
    if average_cpu_utilization < 20:  # adjust this threshold as needed
        print(f"Cluster {cluster['ClusterIdentifier']} is underutilized")
```

4. Run the script regularly (e.g., as a cron job) to monitor your Redshift clusters. Adjust the CPU utilization threshold and the time period as needed to fit your use case. Remember that occasional low utilization is normal, but consistent low utilization indicates that the cluster is underutilized.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of an underutilized Redshift cluster in AWS, you can follow these steps using the AWS Management Console:

1. **Monitor Cluster Performance**:
   - Go to the AWS Management Console and navigate to the Amazon Redshift service.
   - Select your Redshift cluster that is underutilized.
   - Click on the "Clusters" tab and then select the specific cluster.
   - Monitor the performance metrics such as CPU utilization, disk space usage, and query performance to identify areas of underutilization.

2. **Resize the Cluster**:
   - If the performance metrics indicate that the cluster is underutilized, consider resizing the cluster to better match the workload requirements.
   - Click on the "Modify" button for the selected cluster.
   - Adjust the number of nodes or the node type based on the workload demands. You can scale up or down the cluster size as needed.

3. **Optimize Query Performance**:
   - Analyze the queries running on the cluster to identify any inefficient queries that may be impacting performance.
   - Optimize the queries by adding appropriate sort keys, distribution keys, and performing necessary tuning.
   - Consider using Amazon Redshift Advisor to get recommendations for optimizing query performance.

4. **Implement Auto Scaling**:
   - Configure Auto Scaling for your Redshift cluster to automatically adjust the number of nodes based on the workload demand.
   - Enable Auto Scaling by setting up the minimum and maximum number of nodes for the cluster.

5. **Monitor and Fine-tune**:
   - Continuously monitor the cluster performance and adjust the configuration as needed.
   - Utilize Amazon CloudWatch metrics and alarms to set up notifications for any performance issues.
   - Regularly review and optimize the cluster configuration to ensure efficient resource utilization.

By following these steps, you can remediate the issue of an underutilized Redshift cluster in AWS and ensure optimal performance and resource utilization for your workload.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate an underutilized Redshift cluster in AWS using AWS CLI, follow these steps:

1. **Identify underutilized Redshift clusters**: Use the following AWS CLI command to list all Redshift clusters along with their utilization metrics:
   ```bash
   aws redshift describe-clusters
   ```

2. **Identify underutilized clusters**: Look for clusters with low CPU utilization, low query throughput, or high idle time to identify underutilized clusters.

3. **Modify the cluster**: Once you have identified the underutilized cluster, modify the cluster by resizing it to a smaller size to reduce costs. Use the following AWS CLI command to modify the cluster:
   ```bash
   aws redshift modify-cluster --cluster-identifier <cluster-identifier> --node-type <new-node-type>
   ```
   Replace `<cluster-identifier>` with the identifier of the underutilized cluster and `<new-node-type>` with the desired node type (e.g., `dc2.large`).

4. **Monitor the cluster**: After modifying the cluster, monitor the cluster's performance and utilization metrics using AWS CloudWatch or Redshift Console to ensure that the cluster is now properly utilized.

5. **Automate resizing**: To prevent underutilization in the future, consider setting up automated resizing policies using AWS CloudWatch Alarms and AWS Lambda to resize the cluster based on predefined utilization thresholds.

By following these steps, you can remediate an underutilized Redshift cluster in AWS and optimize its performance and cost-effectiveness.
</Accordion>

<Accordion title='Using Python'>
To remediate an underutilized Redshift cluster in AWS, you can use the AWS SDK for Python (Boto3) to automate the process. Here are the step-by-step instructions to remediate this issue:

1. **Identify Underutilized Redshift Clusters:**
   - Use the Boto3 library to describe all the Redshift clusters in your AWS account.
   - Check the performance metrics like CPU utilization, disk space usage, and query performance to identify underutilized clusters.

2. **Modify Cluster Configuration:**
   - Use the `modify_cluster` method in Boto3 to adjust the cluster's configuration based on the identified underutilization.
   - You can modify parameters like the number of nodes, node type, or enable/disable features like Concurrency Scaling based on the cluster's workload.

3. **Automate Scaling Based on Metrics:**
   - Implement a script that regularly monitors the Redshift cluster metrics and automatically adjusts the cluster configuration to optimize performance and cost.
   - You can use CloudWatch metrics to set up alarms for specific thresholds and trigger the script to modify the cluster configuration accordingly.

4. **Implement Cost Optimization Strategies:**
   - Consider implementing cost optimization strategies like pausing or resizing the cluster during off-peak hours to save costs.
   - You can automate this process by scheduling scripts to pause and resume the cluster based on specific time intervals or workload patterns.

5. **Monitor and Fine-tune:**
   - Continuously monitor the cluster performance metrics and workload patterns to ensure the cluster is appropriately sized and optimized.
   - Fine-tune the cluster configuration as needed based on the changing workload requirements.

By following these steps and automating the remediation process using Python and Boto3, you can effectively address underutilized Redshift clusters in AWS and optimize their performance and cost efficiency.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/dg/advisor-recommendations.html](https://docs.aws.amazon.com/redshift/latest/dg/advisor-recommendations.html) 

