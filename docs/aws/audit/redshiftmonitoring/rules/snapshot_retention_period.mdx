---
slug: snapshot_retention_period
title: Redshift Automated Snapshots Should Have Retention Period Enabled
sidebar_label: Redshift Automated Snapshots Should Have Retention Period Enabled
---

### More Info:

The automated snapshot retention period set for your AWS Redshift clusters should be a positive number, meaning that automated backups are enabled for the clusters.

### Risk Level

Low

### Address

Security

### Compliance Standards

SOC2, HIPAA, GDPR, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the top menu, then selecting "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand menu. This will display a list of all your Redshift clusters.
4. For each cluster, select the cluster name to open its configuration details. Under the "Backup" section, check the "Automated Snapshot Retention Period" setting. If it is set to 0, it means that the automated snapshots are not retained and the misconfiguration is detected.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access Redshift resources.

2. Once AWS CLI is set up, you can list all the Redshift clusters using the following command:

   ```
   aws redshift describe-clusters --query 'Clusters[*].[ClusterIdentifier]' --output text
   ```

   This command will return a list of all Redshift cluster identifiers.

3. For each cluster identifier, you can describe its attributes including the automated snapshot retention period using the following command:

   ```
   aws redshift describe-clusters --cluster-identifier <ClusterIdentifier> --query 'Clusters[*].[AutomatedSnapshotRetentionPeriod]' --output text
   ```

   Replace `<ClusterIdentifier>` with the actual cluster identifier. This command will return the number of days that automated snapshots are retained. If the returned value is 0, it means that the retention period is not enabled.

4. To automate the process, you can write a script that loops through all the clusters and checks the retention period. Here is a simple Python script using the boto3 library:

   ```python
   import boto3

   client = boto3.client('redshift')

   response = client.describe_clusters()

   for cluster in response['Clusters']:
       retention_period = cluster['AutomatedSnapshotRetentionPeriod']
       if retention_period == 0:
           print(f"Cluster {cluster['ClusterIdentifier']} does not have retention period enabled.")
   ```

   This script will print out the identifiers of all clusters that do not have the retention period enabled.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) on your local system. This will allow you to interact with AWS services including Redshift.

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a Redshift client and retrieve all the clusters.

```python
redshift_client = session.client('redshift')

clusters = redshift_client.describe_clusters()
```

4. Iterate over each cluster and check the retention period. If the retention period is 1 day (the default), it means that the retention period is not enabled.

```python
for cluster in clusters['Clusters']:
    if cluster['AutomatedSnapshotRetentionPeriod'] == 1:
        print(f"Cluster {cluster['ClusterIdentifier']} does not have retention period enabled.")
```

This script will print out the identifiers of all clusters that do not have a retention period enabled for automated snapshots.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console and log in with your credentials.

2. **Navigate to Amazon Redshift**: Click on the "Services" dropdown menu at the top of the page, and then select "Redshift" under the Analytics section.

3. **Select your Redshift Cluster**: From the Redshift dashboard, select the Redshift cluster for which you want to enable the retention period for automated snapshots.

4. **Modify Cluster**: In the cluster details page, click on the cluster identifier link to go to the cluster details.

5. **Configure Automated Snapshots**: In the cluster details page, scroll down to the "Cluster snapshots" section and click on the "Modify" button.

6. **Enable Retention Period**: In the Modify cluster snapshot settings page, locate the "Automated snapshots" section. Here, you will find the option to set the retention period for automated snapshots.

7. **Set Retention Period**: Check the box next to "Enable" to enable automated snapshots and set a retention period using the dropdown menu. You can choose a retention period between 1 to 35 days.

8. **Save Changes**: Once you have set the retention period, scroll down to the bottom of the page and click on the "Modify cluster" button to save the changes.

9. **Verify Configuration**: After saving the changes, AWS Redshift will start taking automated snapshots with the configured retention period.

By following these steps, you have successfully remediated the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS.

#### Using CLI

To remediate the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS, you can follow these steps using AWS CLI:

1. List the existing automated snapshots for your Redshift cluster to identify the snapshot identifier that needs to be updated:
```bash
aws redshift describe-cluster-snapshots --cluster-identifier YOUR_CLUSTER_IDENTIFIER
```

2. Modify the retention period for the identified automated snapshot using the following command. Replace `YOUR_SNAPSHOT_IDENTIFIER` with the actual snapshot identifier and set the `--retention-period` value to the desired number of days:
```bash
aws redshift modify-cluster-snapshot --snapshot-identifier YOUR_SNAPSHOT_IDENTIFIER --retention-period YOUR_RETENTION_PERIOD
```

3. Verify the modification by describing the snapshot attributes again:
```bash
aws redshift describe-cluster-snapshots --cluster-identifier YOUR_CLUSTER_IDENTIFIER
```

4. Repeat steps 1-3 for all other automated snapshots that do not have the retention period enabled.

By following these steps, you can remediate the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS, you can use the AWS SDK for Python (Boto3) to update the cluster snapshot schedule. Here are the step-by-step instructions to remediate this issue:

1. Install Boto3:
   If you haven't already installed the Boto3 library, you can do so using pip:
   ```
   pip install boto3
   ```

2. Create a Python script to enable the retention period for Redshift Automated Snapshots. You can use the following code snippet as a template:

```python
import boto3

def enable_snapshot_retention(redshift_cluster_identifier, retention_period):
    client = boto3.client('redshift')

    response = client.modify_cluster_snapshot_schedule(
        ClusterIdentifier=redshift_cluster_identifier,
        ScheduleIdentifier='default',
        DisassociateSchedule=True
    )

    response = client.create_snapshot_schedule(
        ScheduleDefinitions=[
            'rate(1 day)',
        ],
        ScheduleIdentifier='default',
        ScheduleDescription='Default snapshot schedule',
        Tags=[
            {
                'Key': 'Name',
                'Value': 'DefaultSchedule'
            },
        ],
        ClusterIdentifier=redshift_cluster_identifier,
        AssociatedClusterCount=1,
        AssociatedClusters=[
            {
                'ClusterIdentifier': redshift_cluster_identifier
            },
        ],
        Enable=True,
        RetentionPeriod=retention_period
    )

    print(f"Snapshot retention period enabled for Redshift cluster {redshift_cluster_identifier}")

# Replace 'your-redshift-cluster-id' with your Redshift cluster identifier
redshift_cluster_identifier = 'your-redshift-cluster-id'

# Set the desired snapshot retention period in days
retention_period = 7

enable_snapshot_retention(redshift_cluster_identifier, retention_period)
```

3. Update the script with your Redshift cluster identifier and the desired snapshot retention period in days.

4. Run the Python script:
   ```
   python enable_redshift_snapshot_retention.py
   ```

5. Verify that the retention period is enabled for Redshift Automated Snapshots by checking the Redshift console or using the following AWS CLI command:
   ```
   aws redshift describe-cluster-snapshot-schedules --cluster-identifier your-redshift-cluster-id
   ```

By following these steps, you can remediate the misconfiguration of Redshift Automated Snapshots not having retention period enabled in AWS Redshift using Python and Boto3.

### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-snapshots.html](https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-snapshots.html) 


</Tab>
</Tabs>