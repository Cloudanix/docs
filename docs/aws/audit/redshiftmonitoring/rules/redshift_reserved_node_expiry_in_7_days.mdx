---
slug: redshift_reserved_node_expiry_in_7_days
title: Redshift Reserved Node Lease Expiration In The Next 7 Days
sidebar_label: Redshift Reserved Node Lease Expiration In The Next 7 Days
---

### More Info:

Amazon Redshift Reserved Nodes (RN) should be renewed before expiration.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon Redshift console at https://console.aws.amazon.com/redshift/.
   
2. In the navigation pane, choose "Reserved Nodes". This will display a list of all your reserved nodes.

3. For each reserved node, check the "Duration" and "Start time" columns. The "Duration" column shows the length of the reservation and the "Start time" column shows when the reservation started.

4. Calculate if the lease for the reserved node will expire in the next 7 days by adding the "Duration" to the "Start time" and comparing it to the current date. If the result is within the next 7 days, then the lease for that reserved node will expire soon.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Redshift Reserved Nodes: Use the `describe-reserved-nodes` command to list all your Redshift Reserved Nodes. This command returns the configuration details of each reserved node, including the start time and duration of the lease.

   ```
   aws redshift describe-reserved-nodes
   ```
3. Parse the output: The output of the above command is in JSON format. You need to parse this output to extract the `StartTime` and `Duration` of each reserved node. You can use the `jq` command-line JSON processor for this purpose.

   ```
   aws redshift describe-reserved-nodes | jq '.ReservedNodes[] | {node: .ReservedNodeId, start: .StartTime, duration: .Duration}'
   ```
4. Check for lease expiration: Now, you need to check if the lease of any reserved node is expiring in the next 7 days. You can do this by comparing the current date with the `StartTime` and `Duration` of each reserved node. If the difference is less than or equal to 7, then the lease of that reserved node is expiring in the next 7 days.

   Note: This step involves writing a script in a programming language like Python or Bash to automate the date comparison process. The exact code will depend on the language you choose.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) on your local system. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

2. Import the necessary libraries and establish a session with AWS using your access keys. 

```python
import boto3
from datetime import datetime, timedelta

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2' # specify the region
)
```

3. Create a Redshift client using the session created above. Then, use the `describe_reserved_nodes` method to get a list of all reserved nodes.

```python
# Create Redshift client
redshift = session.client('redshift')

# Get a list of all reserved nodes
response = redshift.describe_reserved_nodes()
```

4. Iterate over the list of reserved nodes and check the `StartTime` and `Duration` of each node to determine if it will expire in the next 7 days.

```python
# Get current date and time
now = datetime.now()

# Iterate over the reserved nodes
for node in response['ReservedNodes']:
    # Calculate the expiration date of the node
    expiration_date = node['StartTime'] + timedelta(seconds=node['Duration'])

    # Check if the node will expire in the next 7 days
    if now <= expiration_date <= now + timedelta(days=7):
        print(f"Node {node['ReservedNodeId']} will expire on {expiration_date}")
```

This script will print out the IDs of all reserved nodes that will expire in the next 7 days.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days in AWS using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to Amazon Redshift Console**: Click on the "Services" dropdown menu at the top of the page and select "Redshift" under the Analytics section. This will take you to the Amazon Redshift Console.

3. **Check Reserved Nodes**: In the left navigation pane, click on "Clusters" to view your Redshift clusters. Then, click on the cluster for which you want to check the Reserved Node Lease Expiration.

4. **View Reserved Nodes**: In the cluster details page, scroll down to the "Cluster Details" section. Under the "Node Configuration" tab, you will find the details of your Reserved Nodes, including the expiration date.

5. **Renew Reserved Node Lease**: If the Reserved Node Lease is expiring within the next 7 days, you will need to renew the lease to avoid any disruption in your Redshift cluster. To renew the lease, follow these steps:
   
   - Click on the "Reserved Nodes" tab.
   - Select the Reserved Node that is expiring soon.
   - Click on the "Actions" dropdown menu and select "Modify Reserved Node".
   - In the Modify Reserved Node dialog box, adjust the lease duration to extend the expiration date beyond the next 7 days.
   - Click "Modify" to update the Reserved Node lease.

6. **Verify Lease Renewal**: Once you have renewed the Reserved Node lease, go back to the cluster details page and verify that the expiration date has been extended beyond the next 7 days.

By following these steps, you can successfully remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days in AWS using the AWS Management Console.

#### Using CLI

To remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days using AWS CLI, follow these steps:

1. **List Reserved Nodes:** First, list all the reserved nodes in your Redshift cluster using the following AWS CLI command:
   ```
   aws redshift describe-reserved-nodes
   ```

2. **Identify Expiring Nodes:** Identify the reserved nodes that are expiring in the next 7 days from the output of the above command.

3. **Purchase New Reserved Nodes:** To avoid any downtime, purchase new reserved nodes to replace the expiring ones. You can purchase new reserved nodes using the following AWS CLI command:
   ```
   aws redshift purchase-reserved-node-offering --reserved-node-offering-id <offering-id> --node-count <count>
   ```
   Replace `<offering-id>` with the ID of the reserved node offering you want to purchase and `<count>` with the number of nodes you want to purchase.

4. **Modify Cluster:** Modify your Redshift cluster to use the newly purchased reserved nodes. You can modify the cluster using the following AWS CLI command:
   ```
   aws redshift modify-cluster --cluster-identifier <cluster-identifier> --node-type <node-type> --number-of-nodes <number-of-nodes>
   ```
   Replace `<cluster-identifier>` with the identifier of your Redshift cluster, `<node-type>` with the type of nodes you want to use, and `<number-of-nodes>` with the total number of nodes in the cluster.

5. **Verify Changes:** After modifying the cluster, verify that the new reserved nodes are being used and the expiring nodes are no longer in use.

By following these steps, you can remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days for AWS Redshift using AWS CLI.

#### Using Python

To remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days using Python, you can create a script that will check the expiration date of the reserved node leases and take necessary actions. Here's a step-by-step guide to remediate this issue:

Step 1: Install the necessary Python libraries
Make sure you have the AWS SDK for Python (Boto3) installed. You can install it using pip:

```bash
pip install boto3
```

Step 2: Write a Python script to check the expiration date of reserved nodes
Create a Python script that will use Boto3 to interact with AWS Redshift and check the expiration date of the reserved nodes. Here's an example script:

```python
import boto3
from datetime import datetime, timedelta

# Initialize the Redshift client
client = boto3.client('redshift')

# Get a list of reserved nodes
response = client.describe_reserved_nodes()

# Check the expiration date of each reserved node
for node in response['ReservedNodes']:
    expiration_date = node['StartTime'] + timedelta(days=node['Duration'])
    days_until_expiration = (expiration_date - datetime.now()).days

    if days_until_expiration <= 7:
        print(f"Reserved Node {node['ReservedNodeId']} expires in {days_until_expiration} days. Renewing...")
        # Add code here to renew the reserved node lease
```

Step 3: Add code to renew the reserved node lease
In the script above, you need to add code to renew the reserved node lease if the expiration date is within the next 7 days. You can use the `modify_reserved_node` method to modify the reserved node lease with an extended duration.

Step 4: Schedule the script to run periodically
You can schedule the script to run periodically using a cron job or a scheduler like AWS CloudWatch Events. Set it to run daily or as frequently as needed to check for reserved node leases expiring within the next 7 days.

By following these steps and customizing the script according to your requirements, you can effectively remediate the issue of Redshift Reserved Node Lease Expiration in the next 7 days using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html](https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html) 


</Tab>
</Tabs>