---
slug: redshift_reserved_node_recent_purchase
title: Redshift Reserved Node Recent Purchases Should Be Reviewed
sidebar_label: Redshift Reserved Node Recent Purchases Should Be Reviewed
---

### More Info:

Ensure Redshift Reserved Node purchases are regularly reviewed for cost optimization (informational).

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard. You can do this by typing "Redshift" into the search bar at the top of the console, then selecting "Amazon Redshift" from the dropdown menu.
3. Once in the Redshift dashboard, click on "Reserved Nodes" in the left-hand navigation pane. This will bring up a list of all your reserved nodes.
4. Review the list of reserved nodes for any recent purchases. Information about each node, including the purchase date, is displayed in the table. Pay particular attention to the "Start Date" and "Duration" columns, as these will tell you when the node was purchased and for how long it is reserved.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Redshift Reserved Nodes: Use the following AWS CLI command to list all the Redshift Reserved Nodes in your AWS account:

   ```
   aws redshift describe-reserved-nodes
   ```

   This command will return a JSON output with details of all the Redshift Reserved Nodes.

3. Check the start time of each Reserved Node: From the JSON output, you can check the 'StartTime' of each Reserved Node. This is the time when the Reserved Node was purchased. 

   ```
   aws redshift describe-reserved-nodes --query 'ReservedNodes[*].[ReservedNodeId,StartTime]'
   ```

4. Review recent purchases: If the 'StartTime' is within the last few days, it means that the Reserved Node was recently purchased and should be reviewed. You can use the following command to filter out the Reserved Nodes that were purchased in the last 7 days:

   ```
   aws redshift describe-reserved-nodes --query 'ReservedNodes[?StartTime>=`2022-03-01`].[ReservedNodeId,StartTime]'
   ```

   Replace '2022-03-01' with the date 7 days ago from the current date. This command will return the ReservedNodeId and StartTime of the Reserved Nodes that were purchased in the last 7 days.

#### Using Python

1. **Setup AWS SDK (Boto3) in Python:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials either by setting up environment variables or by using the AWS CLI. 

2. **Create a Python Script to Connect to Redshift:**
   Use the Boto3 library to create a client for AWS Redshift. This client will allow you to interact with your Redshift resources.
   ```python
   import boto3

   # Create a Redshift client
   redshift = boto3.client('redshift', region_name='us-west-2') # replace 'us-west-2' with your region
   ```

3. **Fetch the List of Reserved Nodes:**
   Use the `describe_reserved_nodes` method to fetch the list of all reserved nodes. This method returns a dictionary containing the details of each reserved node.
   ```python
   # Fetch the list of reserved nodes
   reserved_nodes = redshift.describe_reserved_nodes()
   ```

4. **Check the Purchase Time of Each Reserved Node:**
   Iterate over the list of reserved nodes and check the `StartTime` of each node. If the `StartTime` is within the last 30 days, print out the details of the node for review.
   ```python
   from datetime import datetime, timedelta

   # Get the current time
   now = datetime.now()

   # Check the purchase time of each reserved node
   for node in reserved_nodes['ReservedNodes']:
       # Convert the StartTime to a datetime object
       start_time = node['StartTime'].replace(tzinfo=None)
       
       # If the node was purchased within the last 30 days, print out its details
       if now - start_time < timedelta(days=30):
           print(f"Reserved node {node['ReservedNodeId']} should be reviewed. It was purchased on {node['StartTime']}.")
   ```
   This script will help you detect any recent purchases of Redshift reserved nodes that should be reviewed.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Redshift Reserved Node Recent Purchases Should Be Reviewed" for AWS Redshift using the AWS console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the Amazon Redshift Console**: Click on "Services" in the top navigation bar, then select "Redshift" under the Analytics section.

3. **Review Reserved Nodes**: In the Amazon Redshift Console, navigate to the "Clusters" section on the left side menu and select your Redshift cluster that you want to review reserved nodes for.

4. **Check Reserved Nodes**: In the cluster details page, scroll down to the "Cluster Details" section and look for the "Reserved Nodes" tab. Click on it to view the list of reserved nodes associated with your cluster.

5. **Review Recent Purchases**: In the Reserved Nodes tab, review the list of recent purchases to ensure that they align with your current usage and requirements. Look for any unused or unnecessary reserved nodes that can be modified or sold.

6. **Modify or Sell Unused Reserved Nodes**: If you find any unused or unnecessary reserved nodes, you can modify or sell them to optimize your costs. To modify a reserved node, select the node and click on the "Modify" button to adjust the node type or quantity. To sell a reserved node, select the node and click on the "Sell" button to list it on the Reserved Nodes Marketplace.

7. **Monitor and Review Regularly**: It is recommended to regularly monitor and review your reserved nodes to ensure they are aligned with your current workload and optimize costs effectively.

By following these steps, you can remediate the misconfiguration "Redshift Reserved Node Recent Purchases Should Be Reviewed" for AWS Redshift using the AWS console.

#### Using CLI

To remediate the misconfiguration "Redshift Reserved Node Recent Purchases Should Be Reviewed" for AWS Redshift using AWS CLI, follow these steps:

1. List all the existing reserved nodes for Redshift using the following AWS CLI command:
```bash
aws redshift describe-reserved-nodes
```

2. Review the output of the command to identify any recent purchases of reserved nodes that need to be reviewed.

3. If there are any recent purchases that need to be reviewed, check the details of the specific reserved node using the following AWS CLI command:
```bash
aws redshift describe-reserved-nodes --reserved-node-id <RESERVED_NODE_ID>
```
Replace `<RESERVED_NODE_ID>` with the actual ID of the reserved node that needs to be reviewed.

4. Analyze the details of the reserved node, including the node type, duration, upfront cost, and recurring charges.

5. If the reserved node purchase is not required or needs to be modified, you can modify or delete the reserved node using the following AWS CLI commands:
- To modify a reserved node, use the `modify-reserved-node` command:
```bash
aws redshift modify-reserved-node --reserved-node-id <RESERVED_NODE_ID> --node-type <NEW_NODE_TYPE> --reserved-node-offering-id <NEW_OFFERING_ID>
```
Replace `<RESERVED_NODE_ID>` with the actual ID of the reserved node, `<NEW_NODE_TYPE>` with the new node type, and `<NEW_OFFERING_ID>` with the ID of the new offering.

- To delete a reserved node, use the `delete-reserved-node` command:
```bash
aws redshift delete-reserved-node --reserved-node-id <RESERVED_NODE_ID>
```
Replace `<RESERVED_NODE_ID>` with the actual ID of the reserved node that needs to be deleted.

6. After modifying or deleting the reserved node, re-run the `describe-reserved-nodes` command to verify that the changes have been applied successfully.

By following these steps, you can remediate the misconfiguration "Redshift Reserved Node Recent Purchases Should Be Reviewed" for AWS Redshift using AWS CLI.

#### Using Python

To remediate the misconfiguration of "Redshift Reserved Node Recent Purchases Should Be Reviewed" in AWS Redshift using Python, you can follow these steps:

1. Use the AWS SDK for Python (Boto3) to access AWS Redshift and describe the recent purchases of reserved nodes.

2. Check the purchase date of each reserved node and compare it with the current date to identify any recently purchased nodes.

3. Send a notification or alert if any reserved nodes have been recently purchased and need to be reviewed.

Here is a sample Python code snippet to achieve this:

```python
import boto3
from datetime import datetime

# Initialize the Redshift client
redshift_client = boto3.client('redshift')

# Describe recent purchases of reserved nodes
response = redshift_client.describe_reserved_nodes()

# Get the current date
current_date = datetime.now()

# Check the purchase date of each reserved node
for reserved_node in response['ReservedNodes']:
    purchase_date = reserved_node['OfferingType']
    if (current_date - purchase_date).days <= 30:  # Check if the node was purchased within the last 30 days
        print(f"Reserved node {reserved_node['ReservedNodeId']} was purchased on {purchase_date}. Please review this purchase.")
```

Make sure to replace the print statement with the appropriate action you want to take when a recently purchased reserved node is detected, such as sending an alert via email or a notification to your monitoring system.

You can run this Python script periodically using a cron job or a scheduled AWS Lambda function to continuously monitor and remediate the misconfiguration of reviewing recent purchases of reserved nodes in AWS Redshift.

### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html](https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html) 


</Tab>
</Tabs>