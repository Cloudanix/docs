---
slug: redshift_reserved_node_payment_failed
title: Redshift Reserved Nodes Should Not Have Status - Payment Failed
sidebar_label: Redshift Reserved Nodes Should Not Have Status - Payment Failed
---

### More Info:

Ensure that none of your AWS Redshift Reserved Node purchases have been failed.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP



### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Redshift Reserved Nodes from having a status of "Payment Failed" in AWS using the AWS Management Console, follow these steps:

1. **Monitor Billing and Payment Settings:**
   - Navigate to the AWS Management Console.
   - Go to the "Billing and Cost Management" dashboard.
   - Ensure that your payment methods are up-to-date and valid. Regularly check for any notifications or alerts related to payment issues.

2. **Set Up Billing Alerts:**
   - In the "Billing and Cost Management" dashboard, select "Billing preferences."
   - Enable billing alerts and set up notifications to receive alerts when your bill reaches a certain threshold. This helps in proactively managing your billing and avoiding payment failures.

3. **Review Reserved Node Purchases:**
   - Go to the Amazon Redshift console.
   - Select "Reserved Nodes" from the navigation pane.
   - Regularly review your reserved node purchases to ensure they align with your budget and usage patterns. This helps in avoiding unexpected costs that could lead to payment failures.

4. **Enable Cost and Usage Reports:**
   - In the "Billing and Cost Management" dashboard, navigate to "Cost & Usage Reports."
   - Enable detailed cost and usage reports to track your spending and identify any anomalies or unexpected charges. This helps in managing your budget effectively and preventing payment issues.

By following these steps, you can proactively manage your billing and payment settings to prevent Redshift Reserved Nodes from having a status of "Payment Failed."
</Accordion>

<Accordion title='Using CLI'>
To prevent Redshift Reserved Nodes from having a status of "Payment Failed" using AWS CLI, you can follow these steps:

1. **Monitor Billing and Payment Status:**
   Regularly check your AWS billing and payment status to ensure that your payment methods are up-to-date and there are no issues with your account.

   ```sh
   aws ce get-cost-and-usage --time-period Start=$(date -d '1 month ago' +%Y-%m-%d),End=$(date +%Y-%m-%d) --granularity MONTHLY --metrics "UnblendedCost"
   ```

2. **Set Up Billing Alerts:**
   Create billing alerts to notify you when your charges exceed a certain threshold. This helps in ensuring that you are aware of any potential payment issues before they affect your reserved nodes.

   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "BillingAlarm" --metric-name "EstimatedCharges" --namespace "AWS/Billing" --statistic "Maximum" --period 21600 --threshold 100 --comparison-operator "GreaterThanOrEqualToThreshold" --dimensions Name=Currency,Value=USD --evaluation-periods 1 --alarm-actions arn:aws:sns:us-east-1:123456789012:MyTopic
   ```

3. **Update Payment Methods:**
   Ensure that your payment methods are valid and up-to-date. You can update your payment methods through the AWS Management Console, but you can also use the AWS CLI to list your current payment methods and ensure they are valid.

   ```sh
   aws organizations list-payment-methods
   ```

4. **Automate Payment Verification:**
   Use a script to periodically verify the status of your reserved nodes and ensure that there are no payment issues. This can be done using a combination of AWS CLI commands and a simple script.

   ```sh
   aws redshift describe-reserved-nodes --query 'ReservedNodes[?State==`payment-failed`]'
   ```

By following these steps, you can proactively monitor and manage your AWS billing and payment status to prevent Redshift Reserved Nodes from having a "Payment Failed" status.
</Accordion>

<Accordion title='Using Python'>
To prevent the issue of Redshift Reserved Nodes having a status of "Payment Failed" using Python scripts, you can follow these steps:

1. **Set Up AWS SDK (Boto3) and Authentication:**
   Ensure you have the AWS SDK for Python (Boto3) installed and properly configured with your AWS credentials.

   ```bash
   pip install boto3
   ```

   ```python
   import boto3

   # Initialize a session using Amazon Redshift
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )

   redshift = session.client('redshift')
   ```

2. **Monitor Reserved Node Payment Status:**
   Create a function to check the payment status of your reserved nodes. This function will query the reserved nodes and check their status.

   ```python
   def check_reserved_node_payment_status():
       response = redshift.describe_reserved_nodes()
       for node in response['ReservedNodes']:
           if node['State'] == 'payment-failed':
               print(f"Reserved Node ID {node['ReservedNodeId']} has a payment failed status.")
               # Implement further actions like alerting or logging
           else:
               print(f"Reserved Node ID {node['ReservedNodeId']} is in good standing.")
   ```

3. **Automate Payment Status Checks:**
   Schedule the script to run at regular intervals to continuously monitor the payment status of your reserved nodes. You can use a scheduling library like `schedule` or `APScheduler`.

   ```python
   import schedule
   import time

   def job():
       check_reserved_node_payment_status()

   # Schedule the job every day at a specific time
   schedule.every().day.at("10:00").do(job)

   while True:
       schedule.run_pending()
       time.sleep(1)
   ```

4. **Alerting and Notification:**
   Integrate an alerting mechanism to notify you if any reserved node has a payment failed status. You can use AWS SNS (Simple Notification Service) or any other notification service.

   ```python
   import boto3

   sns = boto3.client('sns')

   def send_alert(message):
       sns.publish(
           TopicArn='YOUR_SNS_TOPIC_ARN',
           Message=message,
           Subject='Redshift Reserved Node Payment Alert'
       )

   def check_reserved_node_payment_status():
       response = redshift.describe_reserved_nodes()
       for node in response['ReservedNodes']:
           if node['State'] == 'payment-failed':
               alert_message = f"Reserved Node ID {node['ReservedNodeId']} has a payment failed status."
               print(alert_message)
               send_alert(alert_message)
           else:
               print(f"Reserved Node ID {node['ReservedNodeId']} is in good standing.")
   ```

By following these steps, you can proactively monitor and prevent Redshift Reserved Nodes from having a "Payment Failed" status using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard. From the navigation pane, choose "Reserved Nodes".
3. In the "Reserved Nodes" section, you will see a list of all your reserved nodes. Check the "Status" column of each reserved node.
4. If the status of any reserved node is "payment-failed", it means that the payment for that reserved node has failed.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Redshift Reserved Nodes: Use the following AWS CLI command to list all your Redshift Reserved Nodes:

   ```
   aws redshift describe-reserved-nodes
   ```

   This command will return a JSON output with details about all your Redshift Reserved Nodes.

3. Parse the output: You need to parse the JSON output to find the nodes with the status "payment-failed". You can do this using a tool like `jq` or a scripting language like Python. Here is an example using `jq`:

   ```
   aws redshift describe-reserved-nodes | jq -r '.ReservedNodes[] | select(.State=="payment-failed")'
   ```

4. Check the status: If the above command returns any output, it means that there are Redshift Reserved Nodes with the status "payment-failed". If it doesn't return any output, it means that all your Redshift Reserved Nodes have a status other than "payment-failed".
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): To interact with AWS services, you need to install and configure Boto3. You can install it using pip:

   ```
   pip install boto3
   ```
   Then, configure your AWS credentials to enable Boto3 to communicate with AWS services:

   ```
   aws configure
   ```
   You'll be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. Import necessary libraries and establish a session: Import the Boto3 library into your Python script and establish a session using your credentials.

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```
3. Connect to the Redshift service and list all reserved nodes: Use the session to connect to the Redshift service. Then, use the `describe_reserved_nodes` method to get a list of all reserved nodes.

   ```python
   redshift = session.client('redshift')

   response = redshift.describe_reserved_nodes()
   ```
4. Check the status of each reserved node: Iterate over the list of reserved nodes and check the `State` attribute of each node. If the `State` is 'payment-failed', print out or log the node ID.

   ```python
   for node in response['ReservedNodes']:
       if node['State'] == 'payment-failed':
           print(f"Reserved node with ID {node['ReservedNodeId']} has payment failed status.")
   ```
This script will help you identify any Redshift reserved nodes that have a payment failed status.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of Redshift Reserved Nodes having a status of "Payment Failed" in AWS, you can follow these steps using the AWS Management Console:

1. **Navigate to the AWS Redshift Console:**
   - Go to the AWS Management Console (https://aws.amazon.com/console/).
   - In the "Find Services" search bar, type "Redshift" and select "Amazon Redshift" from the options.

2. **Access the Reserved Nodes Dashboard:**
   - In the Amazon Redshift console, navigate to the "Clusters" section from the left-hand menu.
   - Click on the "Reserved Nodes" tab to view the list of reserved nodes.

3. **Identify Reserved Nodes with Payment Failed Status:**
   - Look for the reserved nodes that have a status of "Payment Failed" in the list of reserved nodes.

4. **Modify the Reserved Node:**
   - Select the reserved node with the "Payment Failed" status by clicking on it.
   - Click on the "Modify" button to edit the reservation.

5. **Update Payment Information:**
   - In the modification form, update the payment information associated with the reserved node.
   - Ensure that the payment method linked to the reserved node is valid and has sufficient funds to cover the reservation.

6. **Save Changes:**
   - After updating the payment information, click on the "Save" or "Apply Changes" button to confirm the modifications.

7. **Verify Status:**
   - Once the changes are saved, verify that the status of the reserved node has been updated to a valid state (e.g., "Active").

8. **Monitor and Confirm:**
   - Monitor the status of the reserved node over the next few minutes to ensure that the changes are successfully applied.
   - Confirm that the reserved node no longer shows a status of "Payment Failed."

By following these steps, you should be able to remediate the issue of Redshift Reserved Nodes having a status of "Payment Failed" in AWS Redshift using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of Redshift Reserved Nodes having a status of "Payment Failed" in AWS, you can follow these steps using the AWS CLI:

1. Identify the Reserved Node with Payment Failed status:
   Use the following AWS CLI command to list all the Redshift Reserved Nodes and their statuses:
   ```
   aws redshift describe-reserved-nodes
   ```
   Look for the Reserved Node(s) with the "Payment Failed" status.

2. Modify the Reserved Node:
   Use the following AWS CLI command to modify the Reserved Node with the Payment Failed status:
   ```
   aws redshift modify-reserved-node --reserved-node-id <ReservedNodeId> --reserved-node-offering-id <NewReservedNodeOfferingId>
   ```
   Replace `<ReservedNodeId>` with the ID of the Reserved Node with Payment Failed status and `<NewReservedNodeOfferingId>` with the ID of a new Reserved Node offering that you want to apply.

3. Confirm the modification:
   Use the following AWS CLI command to confirm the modification and apply the changes:
   ```
   aws redshift purchase-reserved-node-offering --reserved-node-offering-id <NewReservedNodeOfferingId>
   ```
   Replace `<NewReservedNodeOfferingId>` with the ID of the new Reserved Node offering that you specified in step 2.

4. Verify the status:
   Use the following AWS CLI command to verify that the Reserved Node status has been updated:
   ```
   aws redshift describe-reserved-nodes
   ```
   Check if the Reserved Node status is now updated and no longer shows "Payment Failed".

By following these steps using the AWS CLI, you should be able to remediate the issue of Redshift Reserved Nodes having a status of "Payment Failed" in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Redshift Reserved Nodes having a status of "Payment Failed" in AWS, you can use the AWS SDK for Python (Boto3) to automate the remediation process. Here are the step-by-step instructions to remediate this issue:

1. Install Boto3: If you haven't already installed Boto3, you can do so using pip:
   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Make sure you have your AWS credentials configured either through environment variables, shared credentials file, or AWS config file.

3. Write Python Script: Create a Python script with the following code to identify and update the status of Redshift Reserved Nodes with "Payment Failed" status:

   ```python
   import boto3

   # Initialize the Redshift client
   redshift_client = boto3.client('redshift')

   # Describe reserved nodes to get the list of reserved nodes
   response = redshift_client.describe_reserved_nodes()

   for reserved_node in response['ReservedNodes']:
       if reserved_node['State'] == 'payment-failed':
           # Modify the status of the reserved node
           redshift_client.modify_reserved_node(
               ReservedNodeId=reserved_node['ReservedNodeId'],
               ReservedNodeOfferingType=reserved_node['OfferingType'],
               NodeCount=reserved_node['NodeCount'],
               NodeType=reserved_node['NodeType'],
               Duration=reserved_node['Duration'],
               OfferingType=reserved_node['OfferingType'],
               PaymentOption='ALL_UPFRONT'
           )
           print(f"Successfully updated the status of Reserved Node {reserved_node['ReservedNodeId']}")

   ```

4. Run the Script: Execute the Python script to identify Redshift Reserved Nodes with "Payment Failed" status and update their status to "ALL_UPFRONT" payment option.

   ```bash
   python remediate_redshift_reserved_nodes.py
   ```

By following these steps, you can automatically remediate the misconfiguration of Redshift Reserved Nodes with a status of "Payment Failed" in AWS Redshift using Python and Boto3.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html](https://docs.aws.amazon.com/redshift/latest/mgmt/purchase-reserved-node-instance.html) 

