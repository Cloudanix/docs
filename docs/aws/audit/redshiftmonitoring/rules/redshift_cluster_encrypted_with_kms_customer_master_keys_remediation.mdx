### Remediation

How to encrypt an existing Redshift cluster with KMS CMK customer-managed keys?

#### Using AWS Console

- Step 1: In the left navigation panel click Encryption Keys. Select the appropriate AWS region from the Filter menu: (must match the region where the new Redshift cluster will be launched).

- Step 2: Click Create Key from the dashboard top menu. In the Alias and Description fields, enter a name (alias) and a description for the new CMK then click the Next Step.

- Step 3: Under Key Administrators section, select which IAM users and/or roles can administer the new CMK, then click Next Step.

- Step 4: Under This Account section, select which IAM users and/or roles can use the new CMK to encrypt/decrypt data with the AWS KMS API.

- Step 5: (Optional) Under External Accounts section, click Add an External Account and enter an external account ID in order to add another AWS account that can use this CMK to encrypt/decrypt the cluster data. The owners of the external AWS accounts must also provide access to this CMK by creating appropriate policies for their IAM users.

- Step 6: Click Next Step to continue.

- Step 7: Under Preview Key Policy section, review the key policy generated by AWS then click Finish to create your new CMK. Once the key is created, the KMS dashboard will display a confirmation message: "Your master key was created successfully. Alias: the CMK display name".

- Step 8: Click on the newly created CMK alias link and copy the key full ARN displayed in the Summary section:
- Step 9: Now that the necessary KMS CMK customer-managed key is created, Go to the Redshift dashboard at https://console.aws.amazon.com/redshift/ to launch the new cluster.

- Step 10: In the left navigation panel, under Redshift Dashboard, click Clusters. Click Launch Cluster button from the dashboard top menu to start the cluster setup process.

- Step 11: On the Cluster Details configuration page, enter a unique name for your new cluster in the Cluster Identifier field and fill out the rest of the fields available on this page with the information taken from your existing (unencrypted or encrypted with the default key) cluster.

- Step 12: Click the Continue button to continue the setup process.

- Step 13: On the Node Configuration page, select the appropriate node type for the new cluster from the Node Type dropdown list and configure the number of nodes used to match the existing cluster configuration. Then click Continue.

- Step 14: On the Additional Configuration page, in the first configuration section, select KMS next to Encrypt Database. Choose the name of your KMS CMK key created earlier from the Master Key dropdown list to encrypt the new Redshift cluster using your own customer-managed key. Configure the rest of the options available on the Additional Configuration page to reflect the existing cluster configuration.

- Step 15: Click Continue to load the next page.

- Step 16: On the Review page, review the cluster properties, its database details, the security and encryption configuration, then click Launch Cluster to build the new AWS Redshift cluster.

- Step 17: On the confirmation page click Close to return to the dashboard. Once the Cluster Status value changes to available and the DB Health status changes to healthy, the new cluster can used to load the existing data.

- Step 18: Now unload your data from the former Redshift cluster and reload it into the newly created cluster using the Amazon Redshift Unload/Copyutility. With this utility tool you can unload (export) your data from the unencrypted cluster (source) to an AWS S3 bucket, encrypt it, then import the data into your new cluster (destination) and clean up the S3 bucket used. All the necessary instructions to install, configure and use the Amazon Redshift Unload/Copy tool can be found at this URL.

- Step 19: As the migration process is completed and all the data is loaded into your new Redshift cluster (encrypted with the KMS CMK key), you can update your application configuration to refer to the new cluster endpoint:
- Step 20: Once the Redshift cluster endpoint is changed within your application configuration, you can remove the former (i.e. the unencrypted or encrypted with the default key) cluster from your AWS account by performing the following actions:
  A: In the navigation panel, under Redshift Dashboard, click Clusters.

  B: Choose the Redshift cluster that you want to remove then click on its identifier link listed in the Cluster column.

  C: On the selected cluster Configuration tab, click the Cluster dropdown button from the dashboard main menu then select Delete from the dropdown list:

  D: Inside the Delete Cluster dialog box, enter a unique name for the final snapshot in the Snapshot name box then click Delete to confirm the action. Once the snapshot is created the former cluster removal process begins.
