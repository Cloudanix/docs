---
slug: allow_cluster_version_upgrade
title: Redshift Clusters Should Allow Version Upgrade
sidebar_label: Redshift Clusters Should Allow Version Upgrade
---

### More Info:

Version Upgrade should be enabled for Redshift clusters to automatically receive upgrades during the maintenance window.

### Risk Level

Low

### Address

Operational Maturity, Security

### Compliance Standards

AWSWAF




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the top menu, then selecting "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand menu. This will display a list of all your Redshift clusters.
4. For each cluster, check the "Allow Version Upgrade" setting under the "Configuration" tab. If this setting is set to "No", then the Redshift cluster is not configured to allow version upgrades.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Redshift clusters: Use the `describe-clusters` command to list all the Redshift clusters in your AWS account. The command is as follows:
   ```
   aws redshift describe-clusters
   ```
   This command will return a JSON output with details of all the Redshift clusters.

3. Parse the output: You need to parse the output to get the `ClusterIdentifier` and `AllowVersionUpgrade` for each cluster. You can use the `jq` command-line JSON processor for this. The command is as follows:
   ```
   aws redshift describe-clusters | jq -r '.Clusters[] | .ClusterIdentifier, .AllowVersionUpgrade'
   ```
   This command will return the `ClusterIdentifier` and `AllowVersionUpgrade` for each cluster.

4. Check the `AllowVersionUpgrade` value: If the `AllowVersionUpgrade` value is `false` for any cluster, it means that the cluster is not configured to allow version upgrades. This is a misconfiguration as it can prevent the cluster from receiving important updates and improvements.

#### Using Python

To check if Redshift Clusters allow version upgrade in AWS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, etc. Here are the steps:

1. **Import the Boto3 library in Python:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:
   ```
   pip install boto3
   ```

2. **Set up AWS Credentials:**
   Before you can begin, you need to set up authentication credentials for your AWS account using either the AWS CLI or by creating a credentials file manually. The credentials file should be located at `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. **Create a Python script to list all Redshift clusters and check if they allow version upgrade:**
   Here is a sample script:
   ```python
   import boto3

   def check_redshift_version_upgrade():
       client = boto3.client('redshift')
       response = client.describe_clusters()

       for cluster in response['Clusters']:
           if not cluster['AllowVersionUpgrade']:
               print(f"Redshift cluster {cluster['ClusterIdentifier']} does not allow version upgrade.")

   if __name__ == "__main__":
       check_redshift_version_upgrade()
   ```
   This script will print out the identifiers of all Redshift clusters that do not allow version upgrades.

4. **Run the Python script:**
   You can run the Python script using any Python environment. Make sure that the AWS credentials are correctly set up in the environment where you run this script. If any misconfigurations are detected, they will be printed out.

Remember, this script only checks for the misconfiguration. It does not fix them. You would need to manually change the settings or use AWS CLI or SDK to change the settings.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration where Redshift clusters do not allow version upgrades in AWS, you can follow these steps using the AWS Management Console:

1. **Navigate to the Amazon Redshift Console:**
   - Open a web browser and go to the AWS Management Console.
   - In the "Find services" search bar, type "Redshift" and select it from the options that appear.

2. **Select the Redshift Cluster:**
   - In the Amazon Redshift console, select the Redshift cluster for which you want to enable version upgrades.

3. **Modify the Cluster:**
   - In the cluster details page, click on the "Clusters" tab and select the cluster you want to modify.
   - Click on the "Modify" button at the top of the page.

4. **Enable Version Upgrade:**
   - In the "Modify cluster" page, scroll down to the "Cluster permissions and maintenance" section.
   - Look for the "Allow version upgrade" option and check the box next to it to enable version upgrades for the cluster.

5. **Save Changes:**
   - Scroll down to the bottom of the page and click on the "Modify cluster" button to save the changes.

6. **Monitor the Upgrade:**
   - Once the modification is complete, AWS Redshift will start the version upgrade process for the cluster.
   - You can monitor the progress of the upgrade in the Amazon Redshift console.

By following these steps, you can successfully remediate the misconfiguration and allow version upgrades for your AWS Redshift clusters.

#### Using CLI

To remediate the misconfiguration where Redshift clusters do not allow version upgrade in AWS, you can follow these steps using AWS CLI:

1. List the existing Redshift clusters to identify the cluster that needs to be updated:
```bash
aws redshift describe-clusters --query 'Clusters[*].[ClusterIdentifier,ClusterVersion]' --output table
```

2. Modify the Redshift cluster parameter group to allow version upgrade:
```bash
aws redshift modify-cluster --cluster-identifier <cluster-identifier> --allow-version-upgrade
```
Replace `<cluster-identifier>` with the identifier of the Redshift cluster that needs to allow version upgrade.

3. Verify the modification status to ensure the version upgrade is allowed:
```bash
aws redshift describe-clusters --cluster-identifier <cluster-identifier> --query 'Clusters[*].[ClusterIdentifier,AllowVersionUpgrade]' --output table
```
Replace `<cluster-identifier>` with the identifier of the Redshift cluster.

4. If the modification is successful, you can proceed with upgrading the Redshift cluster to the desired version. You can use the following command to upgrade the Redshift cluster:
```bash
aws redshift modify-cluster --cluster-identifier <cluster-identifier> --cluster-version <desired-version>
```
Replace `<cluster-identifier>` with the identifier of the Redshift cluster and `<desired-version>` with the version you want to upgrade to.

By following these steps, you can remediate the misconfiguration and allow version upgrade for Redshift clusters in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration where Redshift clusters do not allow version upgrades, you can use the AWS SDK for Python (Boto3) to modify the cluster parameter group associated with the Redshift cluster. Here are the steps to remediate this issue:

1. Install Boto3: If you haven't already installed the Boto3 library, you can do so using pip:

```bash
pip install boto3
```

2. Update the Redshift Cluster Parameter Group: Use the following Python script to update the Redshift cluster parameter group to allow version upgrades:

```python
import boto3

# Initialize the Redshift client
redshift_client = boto3.client('redshift')

# Specify the cluster identifier for the Redshift cluster
cluster_identifier = 'your-redshift-cluster-identifier'

# Specify the parameter group name associated with the Redshift cluster
parameter_group_name = 'your-redshift-parameter-group-name'

# Update the cluster parameter group to allow version upgrades
response = redshift_client.modify_cluster_parameter_group(
    ParameterGroupName=parameter_group_name,
    Parameters=[
        {
            'ParameterName': 'allow_version_upgrade',
            'ParameterValue': 'true',
            'Description': 'Allow version upgrade for Redshift cluster',
            'Source': 'user'
        },
    ]
)

# Print the response
print(response)
```

3. Replace the placeholders 'your-redshift-cluster-identifier' and 'your-redshift-parameter-group-name' with the actual values for your Redshift cluster.

4. Run the Python script: Save the above script in a Python file (e.g., update_redshift_parameter_group.py) and run it using the Python interpreter:

```bash
python update_redshift_parameter_group.py
```

After running the script, the Redshift cluster parameter group will be updated to allow version upgrades. You can verify the changes in the AWS Management Console or by describing the cluster parameter group using the Boto3 SDK.

### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html](https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html) 


</Tab>
</Tabs>