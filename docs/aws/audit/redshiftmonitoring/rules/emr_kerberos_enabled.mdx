---
slug: emr_kerberos_enabled
title: Amazon EMR Clusters Should Have Kerberos Enabled
sidebar_label: Amazon EMR Clusters Should Have Kerberos Enabled
---

### More Info:

This rule checks if Amazon EMR clusters have Kerberos enabled. It is marked as NON_COMPLIANT if a security configuration is not attached to the cluster or if the security configuration does not satisfy the specified rule parameters.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,RBI_MD_ITF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Redshift dashboard by choosing "Redshift" under the "Database" category.
3. In the navigation pane, choose "Clusters". This will display a list of all your Redshift clusters.
4. Select the cluster you want to check for Kerberos configuration. In the details pane, under the "Cluster Properties" section, look for the "Cluster Database Properties" field.
5. Under "Cluster Database Properties", check the "Kerberos" field. If it is not enabled, then Kerberos is not configured for that particular Redshift cluster.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, make sure you have AWS CLI installed and configured with the necessary permissions. You can install it using pip:
   ```
   pip install awscli
   ```
   Then configure it using:
   ```
   aws configure
   ```
   You'll be asked to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all EMR clusters: Use the below command to list all the EMR clusters in your account.
   ```
   aws emr list-clusters --active
   ```
   This command will return a list of active clusters with their respective details.

3. Describe cluster security configuration: For each cluster, use the following command to describe its security and Kerberos configuration.
   ```
   aws emr describe-cluster --cluster-id <Cluster_ID> --query Cluster.SecurityConfiguration
   ```
   Replace `<Cluster_ID>` with the ID of your cluster. This command will return the name of the security configuration associated with the specified cluster.

4. Get security configuration details: Finally, use the following command to get the details of the security configuration.
   ```
   aws emr describe-security-configuration --name <Security_Configuration_Name>
   ```
   Replace `<Security_Configuration_Name>` with the name of your security configuration. This command will return the details of the security configuration in JSON format. Check the "AuthenticationConfiguration" field in the returned JSON. If Kerberos is not enabled, the "KerberosConfiguration" field will be missing or set to false.

#### Using Python

To check if Amazon EMR clusters have Kerberos enabled in Redshift using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Import the necessary libraries and establish a session**:

    You need to import Boto3 and establish a session with the necessary credentials.

    ```python
    import boto3

    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='us-west-2'
    )
    ```

2. **Create an EMR client**:

    Use the session to create an EMR client.

    ```python
    emr = session.client('emr')
    ```

3. **List and describe clusters**:

    Use the `list_clusters` method to get a list of all clusters, and then use `describe_cluster` to get details about each cluster.

    ```python
    clusters = emr.list_clusters()
    for cluster_id in clusters['Clusters']:
        cluster = emr.describe_cluster(ClusterId=cluster_id['Id'])
    ```

4. **Check for Kerberos**:

    Check the `KerberosAttributes` field in the cluster description. If it's not present or if `KerberosEnabled` is False, then Kerberos is not enabled.

    ```python
    if 'KerberosAttributes' not in cluster or not cluster['KerberosAttributes']['KerberosEnabled']:
        print(f"Cluster {cluster_id['Id']} does not have Kerberos enabled.")
    ```

This script will print out the IDs of all clusters that do not have Kerberos enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of not having Kerberos enabled for Amazon EMR clusters in AWS Redshift using the AWS console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console and login with your credentials.

2. **Navigate to Amazon Redshift Console**: Click on the "Services" dropdown menu at the top left corner, then select "Redshift" under the Analytics section.

3. **Select your Redshift Cluster**: From the list of clusters, select the Redshift cluster for which you want to enable Kerberos.

4. **Modify Cluster**: Click on the cluster identifier to open the cluster details. In the cluster details page, click on the "Modify" button.

5. **Enable Kerberos Authentication**: Scroll down to the "Security and Access Control" section in the Modify Cluster page.

6. **Enable Kerberos**: Under the "Authentication" section, select "Kerberos" as the authentication type. You will need to provide the Kerberos server details such as KDC server hostname, realm, and other relevant information.

7. **Save Changes**: After providing the necessary Kerberos authentication details, scroll down to the bottom of the page and click on the "Modify Cluster" button to save the changes.

8. **Verify Kerberos Configuration**: Once the modification is completed, verify that Kerberos authentication is successfully enabled for the Redshift cluster.

By following these steps, you can remediate the misconfiguration of not having Kerberos enabled for Amazon EMR clusters in AWS Redshift using the AWS console.

#### Using CLI

To remediate the misconfiguration of enabling Kerberos on Amazon EMR Clusters in AWS Redshift using AWS CLI, follow these steps:

1. **Enable Kerberos on Redshift Cluster**:
   
   Run the following AWS CLI command to enable Kerberos authentication on the Redshift cluster:
   
   ```
   aws redshift modify-cluster --cluster-identifier <cluster-identifier> --enable-iam-database-authentication
   ```

   Replace `<cluster-identifier>` with the identifier of your Redshift cluster.

2. **Verify Kerberos Authentication**:

   To verify that Kerberos authentication has been enabled successfully on the Redshift cluster, describe the cluster using the following command:
   
   ```
   aws redshift describe-clusters --cluster-identifier <cluster-identifier> --query "Clusters[0].IamRoles"
   ```

   Ensure that the output includes the IAM roles associated with the Redshift cluster.

3. **Update Security Groups**:

   Update the security groups associated with the Redshift cluster to allow the necessary traffic for Kerberos authentication. Ensure that the necessary ports are open for Kerberos communication.

4. **Test Kerberos Authentication**:

   Test the Kerberos authentication by connecting to the Redshift cluster using a client that supports Kerberos authentication. Verify that you can successfully authenticate using Kerberos credentials.

By following these steps, you can remediate the misconfiguration of enabling Kerberos on Amazon EMR Clusters in AWS Redshift using AWS CLI.

#### Using Python

To remediate the misconfiguration of enabling Kerberos for AWS Redshift clusters using Python, you can follow these steps:

1. Install the required Python packages:
```bash
pip install boto3
```

2. Use the following Python script to enable Kerberos for AWS Redshift clusters:

```python
import boto3

# Initialize the Redshift client
client = boto3.client('redshift')

# Specify the Redshift cluster identifier
cluster_identifier = 'your-redshift-cluster-identifier'

# Enable Kerberos for the specified Redshift cluster
response = client.modify_cluster(
    ClusterIdentifier=cluster_identifier,
    EnhancedVpcRouting=True,
    IamRoles=[
        'arn:aws:iam::123456789012:role/RedshiftKerberosRole'  # Specify the IAM role for Kerberos
    ],
    ClusterParameterGroupName='default.redshift-1.0',
    NodeType='dc2.large',  # Specify the node type
    NumberOfNodes=2  # Specify the number of nodes
)

print(response)
```

3. Replace `'your-redshift-cluster-identifier'` with the actual identifier of your Redshift cluster.

4. Replace `'arn:aws:iam::123456789012:role/RedshiftKerberosRole'` with the ARN of the IAM role that should be used for Kerberos authentication.

5. Run the Python script to enable Kerberos for the specified AWS Redshift cluster.

Please note that you need to have the necessary permissions to modify Redshift clusters in your AWS account.



</Tab>
</Tabs>