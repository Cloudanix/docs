---
slug: default_master_username
title: Redshift Cluster Should Not Use Default Master Username
sidebar_label: Redshift Cluster Should Not Use Default Master Username
---

### More Info:

AWS Redshift database clusters should not be using "awsuser" (default master user name) for database access.

### Risk Level

Informational

### Address

Operational Maturity, Security

### Compliance Standards

PCIDSS



### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the use of the default master username in Amazon Redshift using the AWS Management Console, follow these steps:

1. **Navigate to Redshift Dashboard:**
   - Open the AWS Management Console.
   - In the search bar, type "Redshift" and select "Amazon Redshift" from the dropdown.

2. **Create a New Cluster:**
   - Click on the "Create cluster" button.
   - Fill in the necessary details for your new cluster.

3. **Specify Master Username:**
   - In the "Database configurations" section, locate the "Master user settings."
   - Enter a custom master username in the "Master user name" field. Avoid using the default username "awsuser."

4. **Review and Launch:**
   - Continue with the remaining configuration steps.
   - Review your settings and click "Create cluster" to launch the cluster with the custom master username.

By following these steps, you ensure that the Redshift cluster does not use the default master username, enhancing the security of your database.
</Accordion>

<Accordion title='Using CLI'>
To prevent the use of the default master username in Amazon Redshift using AWS CLI, follow these steps:

1. **Create a New Redshift Cluster with a Custom Master Username:**
   When creating a new Redshift cluster, specify a custom master username using the `--master-username` parameter.

   ```sh
   aws redshift create-cluster \
       --cluster-identifier my-cluster \
       --node-type dc2.large \
       --master-username customadmin \
       --master-user-password MySecurePassword123 \
       --cluster-type single-node
   ```

2. **Modify an Existing Redshift Cluster to Change the Master Username:**
   Note that AWS does not allow changing the master username of an existing cluster directly. Instead, you need to create a new cluster with the desired username and migrate your data.

3. **Use AWS CloudFormation to Enforce Custom Master Username:**
   Define a CloudFormation template that specifies a custom master username. This ensures that any Redshift cluster created using this template will not use the default master username.

   ```yaml
   Resources:
     MyRedshiftCluster:
       Type: "AWS::Redshift::Cluster"
       Properties:
         ClusterIdentifier: "my-cluster"
         NodeType: "dc2.large"
         MasterUsername: "customadmin"
         MasterUserPassword: "MySecurePassword123"
         ClusterType: "single-node"
   ```

   Deploy the CloudFormation stack using AWS CLI:

   ```sh
   aws cloudformation create-stack \
       --stack-name my-redshift-stack \
       --template-body file://my-redshift-template.yaml
   ```

4. **Automate Cluster Creation with a Custom Username Using a Python Script:**
   Use the AWS SDK for Python (Boto3) to automate the creation of a Redshift cluster with a custom master username.

   ```python
   import boto3

   redshift = boto3.client('redshift')

   response = redshift.create_cluster(
       ClusterIdentifier='my-cluster',
       NodeType='dc2.large',
       MasterUsername='customadmin',
       MasterUserPassword='MySecurePassword123',
       ClusterType='single-node'
   )

   print(response)
   ```

   Run the Python script to create the cluster:

   ```sh
   python create_redshift_cluster.py
   ```

By following these steps, you can ensure that your Redshift clusters do not use the default master username, thereby enhancing the security of your AWS environment.
</Accordion>

<Accordion title='Using Python'>
To prevent the use of the default master username in Amazon Redshift clusters using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Create a Python Script**:
   Write a Python script that will create a Redshift cluster with a custom master username instead of the default one.

3. **Define the Custom Master Username**:
   Specify a custom master username in your script to ensure it does not use the default username.

4. **Create the Redshift Cluster**:
   Use the Boto3 `create_cluster` method to create the Redshift cluster with the custom master username.

Here is a sample Python script to prevent using the default master username:

```python
import boto3
from botocore.exceptions import ClientError

# Initialize a session using Amazon Redshift
redshift = boto3.client('redshift')

# Define the cluster parameters
cluster_identifier = 'my-redshift-cluster'
node_type = 'dc2.large'
master_username = 'customadmin'  # Custom master username
master_user_password = 'YourSecurePassword123'
db_name = 'mydatabase'
cluster_type = 'single-node'

try:
    # Create the Redshift cluster
    response = redshift.create_cluster(
        ClusterIdentifier=cluster_identifier,
        NodeType=node_type,
        MasterUsername=master_username,
        MasterUserPassword=master_user_password,
        DBName=db_name,
        ClusterType=cluster_type
    )
    print(f"Cluster {cluster_identifier} created successfully.")
except ClientError as e:
    print(f"Error creating cluster: {e}")
```

### Key Points:
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Define Custom Master Username**: Specify a custom master username in the script.
3. **Create Redshift Cluster**: Use the `create_cluster` method with the custom master username.
4. **Error Handling**: Implement error handling to catch and display any issues during cluster creation.

By following these steps, you can ensure that your Redshift clusters do not use the default master username, thereby enhancing security and compliance.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Redshift dashboard by selecting "Services" from the top menu, then selecting "Redshift" under the "Database" category.
3. In the Redshift dashboard, select "Clusters" from the left-hand menu. This will display a list of all your Redshift clusters.
4. For each cluster, check the "Master username" field. If the master username is "awsuser", this indicates that the default master username is being used, which is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all Redshift clusters: Use the `describe-clusters` command to list all the Redshift clusters in your AWS account. This command will return a JSON output with details about each cluster.

   ```
   aws redshift describe-clusters
   ```

3. Parse the output: You need to parse the output of the above command to get the master username of each cluster. You can do this using the `jq` command-line JSON processor. If you don't have `jq` installed, you can install it using `apt-get install jq` (for Ubuntu) or `brew install jq` (for MacOS).

   ```
   aws redshift describe-clusters | jq -r '.Clusters[].MasterUsername'
   ```

4. Check for default master username: The default master username for Redshift clusters is `awsuser`. If any of your clusters are using this username, it means they are using the default master username. You can check this by comparing the output of the above command with `awsuser`.

   ```
   aws redshift describe-clusters | jq -r '.Clusters[].MasterUsername' | grep 'awsuser'
   ```
   If this command returns any output, it means those clusters are using the default master username.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials via the AWS CLI, or by manually creating the files yourself. Set your AWS credentials by creating the files at ~/.aws/credentials. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the default profile, you can use the following format:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Create a Python script to list all Redshift clusters and check the master username: Now you can create a Python script that uses the boto3 library to interact with the AWS Redshift service. The script will list all Redshift clusters and check if the master username is the default one ("awsuser").

   ```python
   import boto3

   def check_redshift_clusters():
       client = boto3.client('redshift')
       response = client.describe_clusters()

       for cluster in response['Clusters']:
           if cluster['MasterUsername'] == 'awsuser':
               print(f"Cluster {cluster['ClusterIdentifier']} is using the default master username")

   if __name__ == "__main__":
       check_redshift_clusters()
   ```

4. Run the Python script: Finally, you can run the Python script. It will print out the identifiers of all Redshift clusters that are using the default master username. If no such clusters are found, it will not print anything. This way, you can easily detect any misconfigurations in your Redshift clusters.

   ```python
   python check_redshift_clusters.py
   ```
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of an AWS Redshift cluster using the default master username, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in to your AWS account.

2. **Navigate to Amazon Redshift**: In the AWS Management Console, search for "Redshift" in the services search bar and click on "Amazon Redshift" to open the Redshift dashboard.

3. **Select the Redshift Cluster**: From the list of Redshift clusters, select the cluster for which you want to remediate the misconfiguration.

4. **Modify the Cluster**: Click on the cluster identifier to open the cluster details page. In the cluster details page, click on the "Modify" button at the top.

5. **Change Master Username**: In the "Cluster Database Properties" section of the modify cluster page, locate the "Master user name" field. Change the default master username (usually "masteruser") to a custom username that follows your organization's security best practices.

6. **Save Changes**: After updating the master username, scroll down to the bottom of the modify cluster page and click on the "Modify cluster" button to save the changes.

7. **Monitor the Modification**: AWS Redshift will start applying the changes to the cluster. You can monitor the modification progress in the cluster details page.

8. **Verify the Changes**: Once the modification is completed, verify that the master username has been successfully changed to the custom username you specified.

By following these steps, you have successfully remediated the misconfiguration of using the default master username for an AWS Redshift cluster.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of AWS Redshift cluster using the default master username, you can follow these steps using AWS CLI:

Step 1: List the existing Redshift clusters to identify the cluster that is using the default master username.
```
aws redshift describe-clusters
```

Step 2: Identify the Redshift cluster for which you want to change the master username.

Step 3: Modify the master username for the identified Redshift cluster using the following command:
```
aws redshift modify-cluster --cluster-identifier YOUR_CLUSTER_IDENTIFIER --master-username NEW_MASTER_USERNAME
```
Replace `YOUR_CLUSTER_IDENTIFIER` with the actual identifier of your Redshift cluster and `NEW_MASTER_USERNAME` with the desired non-default master username.

Step 4: You will be prompted to provide the master user password for confirmation. Enter the master user password when prompted.

Step 5: Verify that the master username has been successfully changed by describing the cluster again:
```
aws redshift describe-clusters --cluster-identifier YOUR_CLUSTER_IDENTIFIER
```

By following these steps, you can remediate the misconfiguration of using the default master username for an AWS Redshift cluster using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of an AWS Redshift cluster using the default master username, you can follow these steps using Python and AWS SDK (boto3):

1. Install boto3 library if you haven't already:
```bash
pip install boto3
```

2. Use the following Python script to update the master username of the Redshift cluster:

```python
import boto3

# Define the AWS region and the Redshift cluster identifier
region = 'your_aws_region'
cluster_identifier = 'your_redshift_cluster_identifier'

# Define the new master username
new_master_username = 'new_master_username'

# Create a Redshift client using boto3
redshift_client = boto3.client('redshift', region_name=region)

# Modify the Redshift cluster to update the master username
response = redshift_client.modify_cluster(
    ClusterIdentifier=cluster_identifier,
    MasterUserPassword=new_master_username,
    ApplyImmediately=True
)

# Print the response
print(response)
```

3. Replace the placeholders `your_aws_region`, `your_redshift_cluster_identifier`, and `new_master_username` with your actual AWS region, Redshift cluster identifier, and the desired new master username.

4. Run the Python script to update the master username of the Redshift cluster. This will trigger an immediate update, and the Redshift cluster will no longer use the default master username.

By following these steps and running the Python script, you can remediate the misconfiguration of an AWS Redshift cluster using the default master username.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html](https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html) 

