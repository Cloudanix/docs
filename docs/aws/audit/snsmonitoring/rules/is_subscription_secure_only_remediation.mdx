

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Simple Notification Service (SNS) dashboard by selecting "Services" from the top menu, then typing "SNS" in the search box and selecting "Simple Notification Service".
3. In the SNS dashboard, select "Topics" from the left-hand navigation pane. This will display a list of all the SNS topics available within your AWS account.
4. For each topic, click on the topic ARN (Amazon Resource Name) to open the topic details. In the "Subscriptions" section, check the "Protocol" column. If any subscription uses "HTTP" as the delivery protocol, it indicates a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, make sure you have AWS CLI installed and configured with the necessary permissions. You can install it using pip (Python package installer). 

   ```
   pip install awscli
   ```
   Then configure it using the following command and provide your AWS credentials (Access Key ID and Secret Access Key), default region name, and default output format when prompted.

   ```
   aws configure
   ```

2. List all SNS topics: Use the following command to list all your SNS topics. This will return a list of all SNS topics in your account.

   ```
   aws sns list-topics
   ```

3. List all subscriptions for each topic: For each topic in your list, use the following command to list all subscriptions. Replace 'topic-arn' with the ARN of your topic.

   ```
   aws sns list-subscriptions-by-topic --topic-arn topic-arn
   ```

4. Check the protocol of each subscription: In the output of the previous command, check the 'Protocol' field of each subscription. If it is 'http', then the SNS subscription is using HTTP as the delivery protocol, which is a misconfiguration. 

   Note: This process needs to be repeated for each SNS topic in your AWS account. You can automate this process using a script.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) in your local environment. This will allow you to interact with AWS services using Python.

```python
pip install boto3
aws configure
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create an SNS client and retrieve all the SNS subscriptions.

```python
sns = session.client('sns')
response = sns.list_subscriptions()
```

4. Iterate over the subscriptions and check the protocol of each subscription. If the protocol is HTTP, print a message indicating a misconfiguration.

```python
for subscription in response['Subscriptions']:
    if subscription['Protocol'] == 'http':
        print(f"Misconfiguration detected: SNS Subscription {subscription['SubscriptionArn']} uses HTTP as delivery protocol.")
```

This script will detect if any SNS subscription is using HTTP as the delivery protocol, which is considered a misconfiguration due to the lack of security compared to HTTPS.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the issue of "AWS SNS Subscription Should Not Use HTTP As Delivery Protocol" for AWS using the AWS console:

1. Login to the AWS Management Console.
2. Navigate to the SNS service from the Services dropdown.
3. Click on the Subscriptions option from the left-hand menu.
4. Select the subscription that is using HTTP as the delivery protocol.
5. Click on the Edit button from the subscription details page.
6. From the Protocol dropdown, select HTTPS as the delivery protocol.
7. Enter the endpoint URL that supports HTTPS delivery.
8. Click on the Update button to save the changes.

Once the above steps are completed, the SNS subscription will use HTTPS as the delivery protocol instead of HTTP, which will remediate the issue of "AWS SNS Subscription Should Not Use HTTP As Delivery Protocol".

#### Using CLI

To remediate the misconfiguration of AWS SNS Subscription using HTTP as delivery protocol, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the SNS subscriptions in your AWS account:
    
    `aws sns list-subscriptions`

3. Identify the subscription that uses HTTP as the delivery protocol.

4. Run the following command to update the subscription to use HTTPS as the delivery protocol:

    `aws sns set-subscription-attributes --subscription-arn <subscription-arn> --attribute-name DeliveryPolicy --attribute-value '{"http":{"defaultHealthyRetryPolicy":{"minDelayTarget":20,"maxDelayTarget":20,"numRetries":3,"numMaxDelayRetries":0,"numNoDelayRetries":0,"numMinDelayRetries":0,"backoffFunction":"linear"}},"https":{"defaultHealthyRetryPolicy":{"minDelayTarget":20,"maxDelayTarget":20,"numRetries":3,"numMaxDelayRetries":0,"numNoDelayRetries":0,"numMinDelayRetries":0,"backoffFunction":"linear"}}}'`
    
    Replace `<subscription-arn>` with the ARN of the subscription that needs to be updated.

5. Verify that the subscription has been updated by running the following command:

    `aws sns get-subscription-attributes --subscription-arn <subscription-arn>`
    
    This command will return the attributes of the subscription. Verify that the `DeliveryPolicy` attribute has been updated with the new value.

6. Repeat the above steps for all the SNS subscriptions that use HTTP as the delivery protocol.

By following these steps, you can remediate the misconfiguration of AWS SNS Subscription using HTTP as delivery protocol and update it to use HTTPS instead.

#### Using Python

Sure, here are the step-by-step instructions to remediate the AWS SNS Subscription that uses HTTP as the delivery protocol using Python:

1. First, you need to import the necessary libraries:

```
import boto3
```

2. Next, create a new boto3 client for SNS:

```
sns_client = boto3.client('sns')
```

3. Then, you need to get a list of all the subscriptions for your SNS topic:

```
response = sns_client.list_subscriptions_by_topic(TopicArn='your_topic_arn')
```

4. Loop through the response and check if any of the subscriptions are using HTTP as the delivery protocol:

```
for subscription in response['Subscriptions']:
    if subscription['Protocol'] == 'http':
        subscription_arn = subscription['SubscriptionArn']
```

5. If you find a subscription using HTTP, you need to update it to use HTTPS instead. To do this, you can use the `set_subscription_attributes` method:

```
sns_client.set_subscription_attributes(
    SubscriptionArn=subscription_arn,
    AttributeName='DeliveryPolicy',
    AttributeValue='{"http": {"defaultHealthyRetryPolicy": {"numRetries": 3,"numNoDelayRetries": 0,"minDelayTarget": 20,"maxDelayTarget": 20,"numMinDelayRetries": 0,"numMaxDelayRetries": 0,"backoffFunction": "linear"},"disableSubscriptionOverrides": false,"defaultThrottlePolicy": {"numRetries": 0,"numNoDelayRetries": 0,"minDelayTarget": 0,"maxDelayTarget": 0,"numMinDelayRetries": 0,"numMaxDelayRetries": 0,"backoffFunction": "linear"}},"https": {"defaultHealthyRetryPolicy": {"numRetries": 3,"numNoDelayRetries": 0,"minDelayTarget": 20,"maxDelayTarget": 20,"numMinDelayRetries": 0,"numMaxDelayRetries": 0,"backoffFunction": "linear"},"disableSubscriptionOverrides": false,"defaultThrottlePolicy": {"numRetries": 0,"numNoDelayRetries": 0,"minDelayTarget": 0,"maxDelayTarget": 0,"numMinDelayRetries": 0,"numMaxDelayRetries": 0,"backoffFunction": "linear"}}}'
)
```

This will update the subscription to use HTTPS as the delivery protocol.

That's it! You have successfully remediated the AWS SNS Subscription that uses HTTP as the delivery protocol using Python.


</Tab>
</Tabs>