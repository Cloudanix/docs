---
slug: is_topic_publishing_public
title: SNS Topics Should Not Allow Global Publishing
sidebar_label: SNS Topics Should Not Allow Global Publishing
---

### More Info:

Your AWS Simple Notification Service (SNS) topics should not allow Everyone to publish in order to protect against attackers or unauthorized users that can publish malicious messages to your topics.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent SNS Topics from allowing global publishing in AWS using the AWS Management Console, follow these steps:

1. **Navigate to SNS Dashboard:**
   - Open the AWS Management Console.
   - In the Services menu, select "Simple Notification Service" (SNS) to go to the SNS dashboard.

2. **Select the SNS Topic:**
   - In the SNS dashboard, click on "Topics" in the left-hand navigation pane.
   - Find and select the SNS topic you want to configure.

3. **Edit Access Policy:**
   - Once you have selected the topic, click on the "Actions" button and choose "Edit topic policy."
   - Review the existing policy and ensure that it does not include a wildcard (`*`) for the `Principal` element, which would allow global access.

4. **Restrict Access:**
   - Modify the policy to specify the AWS accounts or IAM roles that are allowed to publish to the topic.
   - Ensure that the `Principal` element is restricted to specific AWS account IDs or IAM roles, rather than using a wildcard.

By following these steps, you can ensure that your SNS topics are not configured to allow global publishing, thereby enhancing the security of your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To prevent SNS Topics from allowing global publishing using AWS CLI, you can follow these steps:

1. **List SNS Topics**:
   First, identify the SNS topics in your AWS account.
   ```sh
   aws sns list-topics
   ```

2. **Get Topic Attributes**:
   For each SNS topic, retrieve the current access policy to review and modify it.
   ```sh
   aws sns get-topic-attributes --topic-arn <topic-arn>
   ```

3. **Modify the Access Policy**:
   Update the access policy to restrict publishing permissions. Ensure that only specific AWS accounts or IAM roles/users are allowed to publish to the topic. Create a JSON policy file (e.g., `sns-policy.json`) with the appropriate restrictions.
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "AWS": "arn:aws:iam::123456789012:root"
         },
         "Action": "SNS:Publish",
         "Resource": "<topic-arn>"
       }
     ]
   }
   ```

4. **Set the Updated Policy**:
   Apply the updated policy to the SNS topic.
   ```sh
   aws sns set-topic-attributes --topic-arn <topic-arn> --attribute-name Policy --attribute-value file://sns-policy.json
   ```

By following these steps, you can ensure that your SNS topics do not allow global publishing and are restricted to specific AWS accounts or IAM roles/users.
</Accordion>

<Accordion title='Using Python'>
To prevent SNS Topics from allowing global publishing using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for SNS. This will allow you to interact with the SNS service.
   ```python
   import boto3

   sns_client = boto3.client('sns')
   ```

3. **List SNS Topics**:
   Retrieve the list of all SNS topics in your AWS account.
   ```python
   response = sns_client.list_topics()
   topics = response['Topics']
   ```

4. **Check and Update Topic Policies**:
   Iterate through each topic, retrieve its policy, and ensure that it does not allow global publishing. If it does, update the policy to restrict it.
   ```python
   import json

   for topic in topics:
       topic_arn = topic['TopicArn']
       
       # Get the current policy of the topic
       policy_response = sns_client.get_topic_attributes(TopicArn=topic_arn)
       policy = json.loads(policy_response['Attributes'].get('Policy', '{}'))
       
       # Check if the policy allows global publishing
       statements = policy.get('Statement', [])
       for statement in statements:
           if statement.get('Effect') == 'Allow' and statement.get('Principal') == '*':
               # Modify the statement to restrict global publishing
               statement['Principal'] = {'AWS': 'arn:aws:iam::YOUR_ACCOUNT_ID:root'}
       
       # Update the topic policy
       updated_policy = json.dumps(policy)
       sns_client.set_topic_attributes(
           TopicArn=topic_arn,
           AttributeName='Policy',
           AttributeValue=updated_policy
       )
   ```

**Note**: Replace `YOUR_ACCOUNT_ID` with your actual AWS account ID to restrict publishing to your account only.

This script ensures that SNS topics do not allow global publishing by checking and updating their policies accordingly.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon SNS console at https://console.aws.amazon.com/sns/v3/home.

2. In the navigation pane, choose 'Topics'. This will display a list of all the SNS topics in your account.

3. Select the SNS topic you want to check. In the 'Details' section, look for the 'Access policy' field.

4. In the 'Access policy' field, check if the 'Principal' is set to '*'. If it is, this means the SNS topic allows global publishing.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the SNS topics.

2. Once the AWS CLI is installed and configured, you can list all the SNS topics in your account by running the following command:

   ```
   aws sns list-topics
   ```
   This command will return a list of all SNS topics in your account.

3. For each SNS topic, you can get the topic attributes, which include the policy, by running the following command:

   ```
   aws sns get-topic-attributes --topic-arn <TopicARN>
   ```
   Replace `<TopicARN>` with the ARN of the SNS topic. This command will return the attributes of the specified SNS topic.

4. To check if the SNS topic allows global publishing, you need to look at the policy of the topic. If the policy includes a statement with `"Effect": "Allow"` and `"Principal": "*"`, it means the topic allows global publishing. You can do this manually by looking at the policy or you can use a Python script to parse the policy and check for these conditions.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. These can be configured in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   You'll be prompted to enter your AWS Access Key ID, Secret Access Key, default region name, and default output format.

3. Write the Python script: The following Python script uses Boto3 to retrieve all SNS topics in your AWS account and checks if they allow global publishing:

   ```python
   import boto3

   def check_sns_topics():
       sns = boto3.client('sns')
       topics = sns.list_topics()
       for topic in topics['Topics']:
           attrs = sns.get_topic_attributes(TopicArn=topic['TopicArn'])
           policy = json.loads(attrs['Attributes']['Policy'])
           for statement in policy['Statement']:
               if statement['Principal'] == '*' and statement['Action'] == 'SNS:Publish' and statement['Effect'] == 'Allow':
                   print(f"Topic {topic['TopicArn']} allows global publishing")

   check_sns_topics()
   ```

4. Run the Python script: Save the script to a file, e.g., check_sns_topics.py, and run it using Python:

   ```bash
   python check_sns_topics.py
   ```

   The script will print out the ARNs of all SNS topics that allow global publishing. If no such topics exist, it will not print anything.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the SNS topic global publishing misconfiguration in AWS:

1. Open the AWS Management Console and navigate to the SNS service.
2. Click on the SNS topic that needs to be remediated.
3. In the topic details page, click on the "Access Policy" tab.
4. Click on the "Edit" button to modify the access policy.
5. In the access policy editor, remove the following statement:

```
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "SNS:Publish",
  "Resource": "arn:aws:sns:*:*:*"
}
```

6. Click on the "Save Changes" button to save the updated access policy.
7. Verify that the access policy no longer allows global publishing by checking that the `Principal` is no longer set to `"*"`.
8. Repeat these steps for any other SNS topics that need to be remediated.

That's it! By following these steps, you have successfully remediated the SNS topic global publishing misconfiguration in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of SNS Topics allowing global publishing in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your system.

2. Run the following command to list all the SNS topics in your AWS account:

   ```
   aws sns list-topics
   ```

3. Identify the ARN of the SNS topic that needs to be remediated.

4. Run the following command to update the SNS topic policy to disallow global publishing:

   ```
   aws sns set-topic-attributes --topic-arn <topic-arn> --attribute-name Policy --attribute-value '{"Version":"2008-10-17","Id":"__default_policy_ID","Statement":[{"Effect":"Deny","Principal":"*","Action":"SNS:Publish","Resource":"<topic-arn>","Condition":{"StringEquals":{"AWS:SourceOwner":"<aws-account-id>"}}}]}'
   ```

   Replace `<topic-arn>` with the ARN of the SNS topic identified in step 3 and `<aws-account-id>` with your AWS account ID.

5. Verify that the SNS topic policy has been updated successfully by running the following command:

   ```
   aws sns get-topic-attributes --topic-arn <topic-arn> --attribute-names Policy
   ```

   This command should return the updated policy that disallows global publishing.

6. Repeat steps 3-5 for all the SNS topics in your AWS account that allow global publishing.

By following these steps, you can remediate the misconfiguration of SNS topics allowing global publishing in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration in AWS where SNS Topics should not allow global publishing, you can follow the below steps using Python:

1. Create an AWS SNS client using the Boto3 library in Python.

```python
import boto3

sns_client = boto3.client('sns')
```

2. Get the list of all SNS topics using the `list_topics()` method.

```python
response = sns_client.list_topics()
topics = response['Topics']
```

3. For each topic, check if it has the `Policy` attribute set. If it does, retrieve the policy using the `get_topic_attributes()` method.

```python
for topic in topics:
    topic_arn = topic['TopicArn']
    response = sns_client.get_topic_attributes(TopicArn=topic_arn)
    policy = response.get('Attributes', {}).get('Policy')
```

4. If the policy exists, parse it using the `json` module and check if it allows global publishing. If it does, update the policy to disallow global publishing using the `set_topic_attributes()` method.

```python
import json

if policy:
    policy_json = json.loads(policy)
    if 'Statement' in policy_json:
        for statement in policy_json['Statement']:
            if (statement.get('Effect') == 'Allow' and 
                statement.get('Principal') == '*'):
                policy_json['Statement'].remove(statement)
        new_policy = json.dumps(policy_json)
        sns_client.set_topic_attributes(TopicArn=topic_arn, 
                                         AttributeName='Policy', 
                                         AttributeValue=new_policy)
```

5. Once all the policies have been updated, the misconfiguration has been remediated.

Note: Make sure to have the appropriate AWS credentials and permissions set up for the Python script to access and modify SNS topics.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html](https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html) 

