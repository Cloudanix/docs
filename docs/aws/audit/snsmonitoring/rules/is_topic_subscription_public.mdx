---
slug: is_topic_subscription_public
title: SNS Topics Should Not Allow Global Subscribe
sidebar_label: SNS Topics Should Not Allow Global Subscribe
---

### More Info:

Your AWS Simple Notification Service (SNS) topics should not allow "Everyone" to subscribe in order to protect the messages published to your topics against attackers or unauthorized personnel.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon SNS console at https://console.aws.amazon.com/sns/v3/home.

2. In the navigation pane, choose "Topics". This will display a list of all the SNS topics in your account.

3. Select the SNS topic you want to check. In the "Details" section, look for the "Access policy" field. This field contains the policy that determines who can publish messages to the topic and who can subscribe to the topic.

4. Check the "Principal" field in the policy. If it is set to "*", this means that the topic allows global subscribe, which is a misconfiguration. The "Principal" field should be set to specific AWS accounts or AWS services that need to publish or subscribe to the topic.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the SNS topics.

2. Once the AWS CLI is set up, you can list all the SNS topics in your account using the following command:
   ```
   aws sns list-topics
   ```
   This command will return a list of all SNS topics in your account.

3. For each SNS topic, you can get the topic attributes using the following command:
   ```
   aws sns get-topic-attributes --topic-arn <TopicARN>
   ```
   Replace `<TopicARN>` with the ARN of the SNS topic. This command will return the attributes of the specified SNS topic.

4. Check the `Policy` attribute of each SNS topic. If the `Policy` attribute contains a statement with `"Effect": "Allow"` and `"Principal": "*"`, it means that the SNS topic allows global subscribe. This is a misconfiguration and should be fixed. You can use a Python script to automate this process. Here is a simple example:
   ```python
   import json
   import subprocess

   # Get the list of all SNS topics
   topics = json.loads(subprocess.check_output(['aws', 'sns', 'list-topics']))['Topics']

   for topic in topics:
       # Get the attributes of each SNS topic
       attributes = json.loads(subprocess.check_output(['aws', 'sns', 'get-topic-attributes', '--topic-arn', topic['TopicArn']]))['Attributes']
       
       # Check the policy of each SNS topic
       policy = json.loads(attributes['Policy'])
       for statement in policy['Statement']:
           if statement['Effect'] == 'Allow' and statement['Principal'] == '*':
               print(f"The SNS topic {topic['TopicArn']} allows global subscribe.")
   ```
   This script will print the ARNs of all SNS topics that allow global subscribe.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing Python scripts to interact with AWS, you need to install the necessary libraries. The primary library you need is boto3, which is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can set them up in your environment variables:

   ```python
   import os
   os.environ['AWS_ACCESS_KEY_ID'] = 'your_access_key'
   os.environ['AWS_SECRET_ACCESS_KEY'] = 'your_secret_access_key'
   ```

3. Write a Python script to list all SNS topics and their policies: You can use the `list_topics` method to get all SNS topics and then use the `get_topic_attributes` method to get the policy of each topic. Here is a sample script:

   ```python
   import boto3

   sns = boto3.client('sns')

   # List all SNS topics
   response = sns.list_topics()
   topics = response['Topics']

   for topic in topics:
       # Get the policy of each topic
       topic_arn = topic['TopicArn']
       response = sns.get_topic_attributes(TopicArn=topic_arn)
       policy = response['Attributes']['Policy']
       print(f'Topic ARN: {topic_arn}\nPolicy: {policy}\n')
   ```

4. Analyze the policies: The policy of each SNS topic is a JSON string. You can convert it to a Python dictionary using the `json.loads` method and then check if it allows global subscribe. If the "Principal" in the policy is "*", it means the topic allows global subscribe. Here is how you can modify the above script to detect such topics:

   ```python
   import boto3
   import json

   sns = boto3.client('sns')

   # List all SNS topics
   response = sns.list_topics()
   topics = response['Topics']

   for topic in topics:
       # Get the policy of each topic
       topic_arn = topic['TopicArn']
       response = sns.get_topic_attributes(TopicArn=topic_arn)
       policy = json.loads(response['Attributes']['Policy'])

       # Check if the topic allows global subscribe
       for statement in policy['Statement']:
           if statement['Principal'] == '*':
               print(f'Topic ARN: {topic_arn} allows global subscribe\n')
   ```
This script will print the ARNs of all SNS topics that allow global subscribe.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate this misconfiguration in AWS using the AWS console:

1. Open the Amazon SNS console at https://console.aws.amazon.com/sns/.
2. In the navigation pane, choose Topics.
3. Select the SNS topic that you want to remediate.
4. Choose the Access policy tab.
5. In the Access policy editor, locate the statement that grants global subscribe permissions. It should look like this:

```
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "SNS:Subscribe",
  "Resource": "arn:aws:sns:us-east-1:123456789012:MyTopic",
  "Condition": {
    "StringEquals": {
      "AWS:SourceOwner": "123456789012"
    }
  }
}
```

6. Remove the `"Principal": "*"` line from the statement to restrict subscriptions to only AWS accounts that you explicitly specify.
7. Choose Save changes to update the access policy for the SNS topic.

That's it! You have successfully remediated the misconfiguration by removing global subscribe permissions from the SNS topic.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using AWS CLI, you can follow these steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Run the following command to list all the SNS topics in your AWS account:

   ```
   aws sns list-topics
   ```

3. Identify the SNS topic(s) that have global subscription enabled.

4. Run the following command to update the policy of the identified SNS topic(s) to disallow global subscription:

   ```
   aws sns set-topic-attributes --topic-arn <topic-arn> --attribute-name Policy --attribute-value '{"Version":"2008-10-17","Id":"__default_policy_ID","Statement":[{"Effect":"Deny","Principal":{"AWS":"*"},"Action":"SNS:Subscribe","Resource":"<topic-arn>"}]}'
   ```

   Replace `<topic-arn>` with the ARN of the identified SNS topic.

5. Verify that the policy has been updated successfully by running the following command:

   ```
   aws sns get-topic-attributes --topic-arn <topic-arn> --attribute-names Policy
   ```

   Replace `<topic-arn>` with the ARN of the identified SNS topic.

6. Repeat steps 3-5 for all the SNS topics that have global subscription enabled.

By following these steps, you can remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using Python, you can follow the below steps:

1. First, you need to get a list of all the SNS topics in your AWS account using the boto3 library in Python. You can use the following code snippet to achieve this:

```
import boto3

sns = boto3.client('sns')
response = sns.list_topics()
topics = response['Topics']
```

2. Once you have the list of all SNS topics, you can iterate through each topic and check if it allows global subscriptions. To do this, you need to get the policy of the SNS topic using the `get_topic_attributes` method and then check if the policy allows global subscriptions. You can use the following code snippet to achieve this:

```
for topic in topics:
    topic_arn = topic['TopicArn']
    attributes = sns.get_topic_attributes(TopicArn=topic_arn)
    policy = attributes['Attributes']['Policy']
    if 'AllowEveryoneToSubscribe' in policy:
        # Remove the global subscription permission
        policy = policy.replace('"AllowEveryoneToSubscribe": "true"', '"AllowEveryoneToSubscribe": "false"')
        # Update the policy
        sns.set_topic_attributes(TopicArn=topic_arn, AttributeName='Policy', AttributeValue=policy)
```

3. Finally, you need to test the remediation by checking if the SNS topics still allow global subscriptions. You can use the same code snippet in step 2 to check the policy of each SNS topic and make sure that the "AllowEveryoneToSubscribe" parameter is set to "false".

By following these steps, you can remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html](https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html) 

