---
slug: is_topic_subscription_public
title: SNS Topics Should Not Allow Global Subscribe
sidebar_label: SNS Topics Should Not Allow Global Subscribe
---

### More Info:

Your AWS Simple Notification Service (SNS) topics should not allow "Everyone" to subscribe in order to protect the messages published to your topics against attackers or unauthorized personnel.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon SNS console at https://console.aws.amazon.com/sns/v3/home.

2. In the navigation pane, choose 'Topics'. This will display a list of all the SNS topics in your account.

3. Select the SNS topic you want to check. In the 'Details' section, look for the 'Access policy' field. This field contains the JSON policy document that determines who can access the SNS topic.

4. In the policy document, look for a statement with "Effect": "Allow" and "Principal": "*". If such a statement exists and the 'Action' field is either "SNS:Subscribe" or "SNS:*", then the SNS topic allows global subscribe, which is a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the SNS topics.

2. Once the AWS CLI is installed and configured, you can list all the SNS topics in your account using the following command:

   ```
   aws sns list-topics
   ```
   This command will return a list of all the SNS topics in your account.

3. For each SNS topic, you can get the topic attributes using the following command:

   ```
   aws sns get-topic-attributes --topic-arn <TopicARN>
   ```
   Replace `<TopicARN>` with the ARN of the SNS topic. This command will return the attributes of the specified SNS topic.

4. Check the `Policy` attribute of each SNS topic. If the `Policy` attribute contains a statement with `"Effect": "Allow"` and `"Principal": "*"`, then the SNS topic allows global subscribe. This is a misconfiguration because it allows any AWS account to subscribe to this SNS topic.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION_NAME'
)
```

3. Now, create a client for SNS and get the list of all SNS topics:

```python
sns = session.client('sns')
response = sns.list_topics()
```

4. For each topic, get the topic attributes and check if the policy allows global (Everyone) subscription. If it does, print the topic ARN:

```python
for topic in response['Topics']:
    attributes = sns.get_topic_attributes(TopicArn=topic['TopicArn'])
    policy = json.loads(attributes['Attributes']['Policy'])
    for statement in policy['Statement']:
        if 'Condition' not in statement and statement['Principal'] == {'AWS': '*'} and statement['Effect'] == 'Allow':
            print(f"Global subscription allowed for topic: {topic['TopicArn']}")
```

This script will print the ARNs of all SNS topics that allow global subscription.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate this misconfiguration in AWS using the AWS console:

1. Open the Amazon SNS console at https://console.aws.amazon.com/sns/.
2. In the navigation pane, choose Topics.
3. Select the SNS topic that you want to remediate.
4. Choose the Access policy tab.
5. In the Access policy editor, locate the statement that grants global subscribe permissions. It should look like this:

```
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "SNS:Subscribe",
  "Resource": "arn:aws:sns:us-east-1:123456789012:MyTopic",
  "Condition": {
    "StringEquals": {
      "AWS:SourceOwner": "123456789012"
    }
  }
}
```

6. Remove the `"Principal": "*"` line from the statement to restrict subscriptions to only AWS accounts that you explicitly specify.
7. Choose Save changes to update the access policy for the SNS topic.

That's it! You have successfully remediated the misconfiguration by removing global subscribe permissions from the SNS topic.

#### Using CLI

To remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using AWS CLI, you can follow these steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Run the following command to list all the SNS topics in your AWS account:

   ```
   aws sns list-topics
   ```

3. Identify the SNS topic(s) that have global subscription enabled.

4. Run the following command to update the policy of the identified SNS topic(s) to disallow global subscription:

   ```
   aws sns set-topic-attributes --topic-arn <topic-arn> --attribute-name Policy --attribute-value '{"Version":"2008-10-17","Id":"__default_policy_ID","Statement":[{"Effect":"Deny","Principal":{"AWS":"*"},"Action":"SNS:Subscribe","Resource":"<topic-arn>"}]}'
   ```

   Replace `<topic-arn>` with the ARN of the identified SNS topic.

5. Verify that the policy has been updated successfully by running the following command:

   ```
   aws sns get-topic-attributes --topic-arn <topic-arn> --attribute-names Policy
   ```

   Replace `<topic-arn>` with the ARN of the identified SNS topic.

6. Repeat steps 3-5 for all the SNS topics that have global subscription enabled.

By following these steps, you can remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using Python, you can follow the below steps:

1. First, you need to get a list of all the SNS topics in your AWS account using the boto3 library in Python. You can use the following code snippet to achieve this:

```
import boto3

sns = boto3.client('sns')
response = sns.list_topics()
topics = response['Topics']
```

2. Once you have the list of all SNS topics, you can iterate through each topic and check if it allows global subscriptions. To do this, you need to get the policy of the SNS topic using the `get_topic_attributes` method and then check if the policy allows global subscriptions. You can use the following code snippet to achieve this:

```
for topic in topics:
    topic_arn = topic['TopicArn']
    attributes = sns.get_topic_attributes(TopicArn=topic_arn)
    policy = attributes['Attributes']['Policy']
    if 'AllowEveryoneToSubscribe' in policy:
        # Remove the global subscription permission
        policy = policy.replace('"AllowEveryoneToSubscribe": "true"', '"AllowEveryoneToSubscribe": "false"')
        # Update the policy
        sns.set_topic_attributes(TopicArn=topic_arn, AttributeName='Policy', AttributeValue=policy)
```

3. Finally, you need to test the remediation by checking if the SNS topics still allow global subscriptions. You can use the same code snippet in step 2 to check the policy of each SNS topic and make sure that the "AllowEveryoneToSubscribe" parameter is set to "false".

By following these steps, you can remediate the misconfiguration "SNS Topics Should Not Allow Global Subscribe" in AWS using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html](https://docs.aws.amazon.com/sns/latest/dg/AccessPolicyLanguage.html) 


</Tab>
</Tabs>