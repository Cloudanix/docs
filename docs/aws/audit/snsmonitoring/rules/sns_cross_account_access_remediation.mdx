

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Simple Notification Service (SNS) dashboard by choosing "Services" from the top menu and then selecting "Simple Notification Service" under the "Application Integration" category.
3. In the SNS dashboard, select "Topics" from the left-hand navigation pane. This will display a list of all the SNS topics available within your current AWS region.
4. For each topic listed, click on the ARN link to open the topic's configuration page. Under the "Subscriptions" section, check the "Owner" column. If there are any accounts listed that are not your own, this indicates that the SNS topic has cross-account access.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the SNS topics.

2. Once the AWS CLI is set up, you can list all the SNS topics in your account using the following command:

   ```
   aws sns list-topics
   ```
   This command will return a list of all SNS topics in your account.

3. For each SNS topic, you can get the topic attributes which include the policy using the following command:

   ```
   aws sns get-topic-attributes --topic-arn <TopicARN>
   ```
   Replace `<TopicARN>` with the ARN of the topic you want to check. This command will return the attributes of the specified SNS topic.

4. Now, you need to check the policy of each SNS topic. The policy is returned in the JSON format. You need to look for the `"AWS": "*"` in the `"Principal"` field of the policy. If this is present, it means that the SNS topic is accessible by all AWS accounts. You can use a JSON parser or a script to automate this process. Here is a simple Python script that can do this:

   ```python
   import json
   import subprocess

   # List all SNS topics
   result = subprocess.check_output(['aws', 'sns', 'list-topics'])
   topics = json.loads(result)['Topics']

   for topic in topics:
       # Get topic attributes
       result = subprocess.check_output(['aws', 'sns', 'get-topic-attributes', '--topic-arn', topic['TopicArn']])
       attributes = json.loads(result)['Attributes']

       # Parse policy
       policy = json.loads(attributes['Policy'])

       # Check for cross account access
       for statement in policy['Statement']:
           if 'Principal' in statement and statement['Principal'] == '*':
               print(f"SNS topic {topic['TopicArn']} has cross account access")
   ```
   This script will print the ARNs of all SNS topics that have cross account access.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, create a client for SNS and get the list of all SNS topics:

```python
sns = session.client('sns')
response = sns.list_topics()
```

4. For each topic, get the topic attributes and check if the `Policy` attribute allows cross-account access. If it does, print a warning message:

```python
for topic in response['Topics']:
    attributes = sns.get_topic_attributes(TopicArn=topic['TopicArn'])
    policy = json.loads(attributes['Attributes']['Policy'])
    for statement in policy['Statement']:
        if statement['Principal'] == '*':
            print(f"Warning: The SNS topic {topic['TopicArn']} allows cross-account access.")
```

This script will print a warning for each SNS topic that allows cross-account access. Note that this is a simple check and might not cover all possible misconfigurations. For a more thorough check, you might need to parse the policy in more detail.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "SNS Topics Should Not Have Cross Account Access" in AWS, you can follow the below steps:

1. Open the AWS SNS console at https://console.aws.amazon.com/sns/.
2. Select the SNS topic that you want to remediate.
3. Click on the "Access Policy" button under the "Permissions" section on the left side of the console.
4. Review the access policy to ensure that there is no cross-account access granted to the SNS topic.
5. If there is cross-account access granted, click on the "Edit" button to modify the access policy.
6. Remove any statements that grant cross-account access to the SNS topic.
7. Click on the "Save Changes" button to save the modified access policy.

After following these steps, the SNS topic will no longer have cross-account access and the misconfiguration will be remediated.

#### Using CLI

To remediate the misconfiguration "SNS Topics Should Not Have Cross Account Access" in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the SNS topics in your AWS account:
```
aws sns list-topics
```

3. Identify the SNS topic that has cross-account access.

4. Run the following command to remove cross-account access from the SNS topic:
```
aws sns remove-permission --topic-arn <topic-arn> --label <permission-label>
```
Replace `<topic-arn>` with the ARN of the SNS topic that has cross-account access. Replace `<permission-label>` with the label of the permission that you want to remove.

5. Run the following command to verify that the cross-account access has been removed:
```
aws sns get-topic-attributes --topic-arn <topic-arn> --attribute-names Policy
```
Replace `<topic-arn>` with the ARN of the SNS topic that you want to verify.

6. If the output of the above command shows that the policy for the SNS topic still has cross-account access, then you need to update the policy for the SNS topic.

7. Run the following command to update the policy for the SNS topic:
```
aws sns set-topic-attributes --topic-arn <topic-arn> --attribute-name Policy --attribute-value "{}"
```
Replace `<topic-arn>` with the ARN of the SNS topic that you want to update.

8. Run the following command to verify that the policy for the SNS topic has been updated:
```
aws sns get-topic-attributes --topic-arn <topic-arn> --attribute-names Policy
```
Replace `<topic-arn>` with the ARN of the SNS topic that you want to verify.

9. Repeat steps 3 to 8 for all the SNS topics in your AWS account that have cross-account access.

By following these steps, you can remediate the misconfiguration "SNS Topics Should Not Have Cross Account Access" in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of SNS Topics having cross-account access in AWS using python, you can follow the below steps:

1. Identify the SNS Topics that have cross-account access.
2. Revoke the cross-account access for those SNS Topics.
3. Verify that the cross-account access has been revoked successfully.

Here is the python code to remediate the misconfiguration:

```
import boto3

# Create an SNS client
sns = boto3.client('sns')

# Get all SNS Topics
topics = sns.list_topics()

# Loop through each topic
for topic in topics['Topics']:
    topic_arn = topic['TopicArn']
    
    # Get the topic policy
    policy = sns.get_topic_attributes(TopicArn=topic_arn)['Attributes']['Policy']
    
    # Check if the policy allows cross-account access
    if 'Statement' in policy:
        for statement in policy['Statement']:
            if 'Condition' in statement and 'ArnLike' in statement['Condition']:
                for arn in statement['Condition']['ArnLike'].values():
                    if 'AWS:*:*:' in arn:
                        print(f"Revoking cross-account access for {topic_arn}")
                        
                        # Revoke the cross-account access
                        statement['Condition']['ArnLike'] = {}
                        sns.set_topic_attributes(TopicArn=topic_arn, AttributeName='Policy', AttributeValue=policy)
                        
                        print(f"Cross-account access revoked for {topic_arn}")
```

Note: This code will revoke cross-account access for all SNS Topics that have a policy allowing it. It is important to review the policy before revoking access to ensure that it is not needed for any legitimate use case.


</Tab>
</Tabs>