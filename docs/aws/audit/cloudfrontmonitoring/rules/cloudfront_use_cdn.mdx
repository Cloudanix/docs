---
slug: cloudfront_use_cdn
title: Web Applications Should Use CDNs
sidebar_label: Web Applications Should Use CDNs
---

### More Info:

Your web application should be using Amazon Cloudfront Content Distribution Network (CDN) to secure its content delivery to absorb and mitigate potential Distributed Denial of Service (DDoS) attacks and keep the application available for legitimate users.

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CloudFront service. 

2. In the CloudFront console, you will see a list of all your CloudFront distributions. 

3. For each distribution, check the "Origin Settings". If the origin is an S3 bucket or an EC2 instance, it means that the web application is using CloudFront as a CDN. 

4. If the origin is not an S3 bucket or an EC2 instance, or if there are no CloudFront distributions at all, it means that the web application is not using CloudFront as a CDN, which is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all distributions: Once you have AWS CLI set up, you can list all your CloudFront distributions by running the following command:
   ```
   aws cloudfront list-distributions
   ```
   This command will return a JSON object containing all your CloudFront distributions.

3. Check for CDN usage: To check if your web applications are using CDNs, you need to look at the "Origins" section of each distribution. If the "DomainName" in the "Origins" section points to your web application's domain, then your web application is using a CDN. You can do this manually by looking at the JSON object returned by the previous command, or you can use a tool like jq to parse the JSON object and extract the information you need.

4. Automate the process: If you have a large number of distributions, it might be more efficient to automate the process with a Python script. You can use the boto3 library to interact with AWS services. Here is a simple script that lists all distributions and checks if they are using a CDN:

   ```python
   import boto3

   client = boto3.client('cloudfront')

   response = client.list_distributions()

   for distribution in response['DistributionList']['Items']:
       for origin in distribution['Origins']['Items']:
           if 'your-web-application-domain' in origin['DomainName']:
               print(f"Distribution {distribution['Id']} is using a CDN")
   ```
   Replace 'your-web-application-domain' with the domain of your web application. This script will print the IDs of all distributions that are using a CDN.
</Accordion>

<Accordion title='Using Python'>
To check if your web applications are using CDNs in CloudFront using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. If you haven't installed it yet, you can do so using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS Credentials:**
   Before you can begin using Boto3, you need to set up authentication credentials. You can do this by creating a new IAM user in your AWS console, then set your credentials in the AWS credentials file, which is located by default at `~/.aws/credentials`. At a minimum, the credentials file should look something like this:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. **Create a Python Script to List CloudFront Distributions:**
   You can use the `list_distributions()` function from the CloudFront client in Boto3 to retrieve a list of your CloudFront distributions. Here's a simple script that does this:
   ```python
   import boto3

   def list_cloudfront_distributions():
       client = boto3.client('cloudfront')
       response = client.list_distributions()
       return response['DistributionList']['Items']

   distributions = list_cloudfront_distributions()
   for distribution in distributions:
       print(distribution['Id'], distribution['DomainName'])
   ```
   This script will print the ID and domain name of each CloudFront distribution.

4. **Check if Web Applications are Using the CDN:**
   Now that you have a list of your CloudFront distributions, you can check if your web applications are using them. This can be done by comparing the domain names of your web applications with the domain names of your CloudFront distributions. If a web application's domain name matches a CloudFront distribution's domain name, then that web application is using the CDN. Here's a simple script that does this:
   ```python
   web_app_domains = ['www.example.com', 'www.test.com']  # replace with your web app domains

   for distribution in distributions:
       if distribution['DomainName'] in web_app_domains:
           print(f"Web application {distribution['DomainName']} is using CDN.")
       else:
           print(f"Web application {distribution['DomainName']} is not using CDN.")
   ```
   This script will print whether each of your web applications is using the CDN or not.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The misconfiguration is that the web application is not using a Content Delivery Network (CDN) which can lead to slower load times and higher latency for users. Here are the step-by-step instructions to remediate this issue for AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the Amazon CloudFront service.
3. Click on the "Create Distribution" button.
4. Select the "Web" option for the type of distribution.
5. In the "Origin Domain Name" field, enter the domain name of your web application.
6. In the "Origin Protocol Policy" field, select "HTTPS Only" to ensure that all traffic to your web application is encrypted.
7. In the "Viewer Protocol Policy" field, select "Redirect HTTP to HTTPS" to ensure that all traffic is encrypted.
8. In the "Allowed HTTP Methods" field, select "GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE" to allow all necessary HTTP methods.
9. In the "Price Class" field, select the appropriate price class for your needs.
10. In the "Alternate Domain Names (CNAMEs)" field, enter any alternate domain names that you want to use for your web application.
11. In the "Default Root Object" field, enter the name of the default file that should be served when a user accesses your web application.
12. Click on the "Create Distribution" button to create your CDN distribution.

Once you have completed these steps, your web application will be using a CDN which will improve load times and reduce latency for your users.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Web Applications Should Use CDNs" for AWS using AWS CLI, follow these steps:

1. Login to AWS CLI using your AWS account credentials.

2. Identify the web application that needs to be configured with CDN.

3. Create an S3 bucket that will store the static content of the web application. Use the following AWS CLI command to create an S3 bucket:

```
aws s3api create-bucket --bucket <bucket-name> --region <region>
```

Replace `<bucket-name>` with a unique name for your S3 bucket and `<region>` with the region where you want to create the bucket.

4. Upload the static content of the web application to the S3 bucket. Use the following AWS CLI command to upload the files:

```
aws s3 sync <local-path> s3://<bucket-name> --acl public-read
```

Replace `<local-path>` with the local path of the static files and `<bucket-name>` with the name of the S3 bucket you created in step 3.

5. Create a CloudFront distribution for the S3 bucket. Use the following AWS CLI command to create a CloudFront distribution:

```
aws cloudfront create-distribution --origin-domain-name <bucket-name>.s3.amazonaws.com --default-root-object index.html
```

Replace `<bucket-name>` with the name of the S3 bucket you created in step 3.

6. Update the DNS settings of the web application to point to the CloudFront distribution. Use the following AWS CLI command to get the CloudFront distribution domain name:

```
aws cloudfront get-distribution --id <distribution-id> --query "Distribution.DomainName" --output text
```

Replace `<distribution-id>` with the ID of the CloudFront distribution you created in step 5.

7. Update the DNS settings of the web application to point to the CloudFront distribution domain name obtained in step 6.

By following these steps, you have configured the web application with CDN on AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Web Applications Should Use CDNs" for AWS using Python, you can follow these steps:

1. Create an AWS CloudFront distribution: 

```python
import boto3

cloudfront = boto3.client('cloudfront')

response = cloudfront.create_distribution(
    DistributionConfig={
        'CallerReference': 'unique-id', # unique identifier for the distribution
        'Aliases': {
            'Quantity': 1, # number of CNAMEs (aliases) for the distribution
            'Items': ['example.com'] # list of CNAMEs for the distribution
        },
        'DefaultRootObject': 'index.html', # default object to serve when no path is specified
        'Origins': {
            'Quantity': 1, # number of origins for the distribution
            'Items': [
                {
                    'Id': 'my-s3-bucket', # unique identifier for the origin
                    'DomainName': 'my-s3-bucket.s3.amazonaws.com', # domain name of the S3 bucket
                    'S3OriginConfig': {
                        'OriginAccessIdentity': '' # optional, use if you want to restrict access to the S3 bucket
                    }
                }
            ]
        },
        'DefaultCacheBehavior': {
            'TargetOriginId': 'my-s3-bucket', # unique identifier for the origin
            'ForwardedValues': {
                'QueryString': False, # whether to forward query strings to the origin
                'Cookies': {
                    'Forward': 'none' # whether to forward cookies to the origin
                }
            },
            'TrustedSigners': {
                'Enabled': False, # whether to require signed URLs or cookies
                'Quantity': 0 # number of trusted signers
            },
            'ViewerProtocolPolicy': 'redirect-to-https', # whether to redirect HTTP requests to HTTPS
            'MinTTL': 0 # minimum time-to-live for objects in the cache
        },
        'Comment': 'My CloudFront distribution', # optional comment for the distribution
        'Enabled': True # whether the distribution is enabled
    }
)

distribution_id = response['Distribution']['Id']
```

2. Update DNS records:

Once the CloudFront distribution is created, you need to update your DNS records to point to the CloudFront domain name. You can do this by creating a CNAME record in your DNS provider's control panel that points to the CloudFront domain name.

3. Test the distribution:

Once the DNS records have propagated, you can test the CloudFront distribution by accessing your web application using the CloudFront domain name. If everything is working correctly, your web application should be served from the CloudFront edge locations, which will improve performance and reduce latency for your users.

Note: Remember to update your web application code to use the CloudFront domain name instead of the S3 bucket URL.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/cloudfront/](https://aws.amazon.com/cloudfront/) 

