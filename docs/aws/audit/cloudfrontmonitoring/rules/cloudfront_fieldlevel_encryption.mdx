---
slug: cloudfront_fieldlevel_encryption
title: CloudFront Distributions Should Have Field-Level Encryption Enabled
sidebar_label: CloudFront Distributions Should Have Field-Level Encryption Enabled
---

### More Info:

Field-level encryption should be enabled for your Amazon CloudFront web distributions in order to help protect sensitive data like credit card numbers or social security numbers, and to help protect your data across application services.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, ISO27001, HIPAA, HITRUST, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent CloudFront distributions from lacking field-level encryption using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select "CloudFront" from the dropdown.

2. **Select the Distribution:**
   - In the CloudFront dashboard, you will see a list of your distributions.
   - Click on the ID of the distribution you want to configure.

3. **Edit Distribution Settings:**
   - In the distribution settings page, go to the "Behaviors" tab.
   - Click on the "Edit" button next to the behavior you want to configure.

4. **Enable Field-Level Encryption:**
   - Scroll down to the "Field-Level Encryption" section.
   - Select the appropriate Field-Level Encryption Configuration from the dropdown menu.
   - Click on the "Yes, Edit" button to save your changes.

By following these steps, you ensure that your CloudFront distribution has field-level encryption enabled, enhancing the security of sensitive data in transit.
</Accordion>

<Accordion title='Using CLI'>
To prevent CloudFront distributions from lacking field-level encryption using AWS CLI, you can follow these steps:

1. **Create a Field-Level Encryption Profile:**
   First, you need to create a field-level encryption profile. This profile will define the fields that need to be encrypted and the public key to use for encryption.

   ```sh
   aws cloudfront create-field-level-encryption-profile --field-level-encryption-profile-config file://field-level-encryption-profile-config.json
   ```

   Ensure that `field-level-encryption-profile-config.json` contains the necessary configuration for your encryption profile.

2. **Create a Field-Level Encryption Configuration:**
   Next, create a field-level encryption configuration that specifies how CloudFront should handle the encryption.

   ```sh
   aws cloudfront create-field-level-encryption-config --field-level-encryption-config file://field-level-encryption-config.json
   ```

   Ensure that `field-level-encryption-config.json` contains the necessary configuration for your encryption settings.

3. **Update CloudFront Distribution to Use Field-Level Encryption:**
   Update your CloudFront distribution to use the field-level encryption configuration created in the previous step.

   ```sh
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://distribution-config.json
   ```

   Ensure that `distribution-config.json` includes the `FieldLevelEncryptionId` that references the field-level encryption configuration.

4. **Verify the Configuration:**
   Finally, verify that the CloudFront distribution has been updated to use field-level encryption.

   ```sh
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   Check the output to ensure that the `FieldLevelEncryptionId` is correctly set in the distribution configuration.

By following these steps, you can ensure that your CloudFront distributions have field-level encryption enabled using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent CloudFront distributions from being created without Field-Level Encryption enabled using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that Field-Level Encryption is enabled for CloudFront distributions:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Create a Field-Level Encryption Configuration**:
   Before you can enable Field-Level Encryption on a CloudFront distribution, you need to create a Field-Level Encryption configuration. This configuration specifies the fields to be encrypted and the public key to use for encryption.

   ```python
   import boto3

   client = boto3.client('cloudfront')

   response = client.create_field_level_encryption_config(
       FieldLevelEncryptionConfig={
           'CallerReference': 'unique-string',
           'Comment': 'Field-level encryption configuration',
           'QueryArgProfileConfig': {
               'ForwardWhenQueryArgProfileIsUnknown': False,
               'QueryArgProfiles': {
                   'Items': [
                       {
                           'QueryArg': 'sensitive-data',
                           'ProfileId': 'profile-id'
                       },
                   ],
                   'Quantity': 1
               }
           },
           'ContentTypeProfileConfig': {
               'ForwardWhenContentTypeIsUnknown': False,
               'ContentTypeProfiles': {
                   'Items': [
                       {
                           'Format': 'URLEncoded',
                           'ProfileId': 'profile-id',
                           'ContentType': 'application/x-www-form-urlencoded'
                       },
                   ],
                   'Quantity': 1
               }
           }
       }
   )

   field_level_encryption_id = response['FieldLevelEncryption']['Id']
   ```

3. **Create or Update CloudFront Distribution with Field-Level Encryption**:
   When creating or updating a CloudFront distribution, ensure that the Field-Level Encryption configuration is associated with the distribution.

   ```python
   distribution_config = {
       'CallerReference': 'unique-string',
       'Comment': 'My CloudFront Distribution',
       'Enabled': True,
       'Origins': {
           'Quantity': 1,
           'Items': [
               {
                   'Id': 'origin-1',
                   'DomainName': 'example.com',
                   'OriginPath': '',
                   'CustomHeaders': {
                       'Quantity': 0
                   },
                   'S3OriginConfig': {
                       'OriginAccessIdentity': ''
                   }
               },
           ]
       },
       'DefaultCacheBehavior': {
           'TargetOriginId': 'origin-1',
           'ViewerProtocolPolicy': 'redirect-to-https',
           'AllowedMethods': {
               'Quantity': 2,
               'Items': ['GET', 'HEAD'],
               'CachedMethods': {
                   'Quantity': 2,
                   'Items': ['GET', 'HEAD']
               }
           },
           'FieldLevelEncryptionId': field_level_encryption_id,
           'ForwardedValues': {
               'QueryString': False,
               'Cookies': {
                   'Forward': 'none'
               },
               'Headers': {
                   'Quantity': 0
               },
               'QueryStringCacheKeys': {
                   'Quantity': 0
               }
           },
           'MinTTL': 0
       },
       'ViewerCertificate': {
           'CloudFrontDefaultCertificate': True
       },
       'Restrictions': {
           'GeoRestriction': {
               'RestrictionType': 'none',
               'Quantity': 0
           }
       }
   }

   response = client.create_distribution(
       DistributionConfig=distribution_config
   )

   distribution_id = response['Distribution']['Id']
   ```

4. **Verify Field-Level Encryption is Enabled**:
   After creating or updating the distribution, verify that the Field-Level Encryption configuration is correctly applied.

   ```python
   response = client.get_distribution_config(
       Id=distribution_id
   )

   distribution_config = response['DistributionConfig']
   if 'FieldLevelEncryptionId' in distribution_config['DefaultCacheBehavior']:
       print("Field-Level Encryption is enabled for the distribution.")
   else:
       print("Field-Level Encryption is not enabled for the distribution.")
   ```

By following these steps, you can ensure that Field-Level Encryption is enabled for your CloudFront distributions using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the navigation pane, click on "Distributions".

3. In the list of distributions, click on the ID of the distribution that you want to check.

4. In the distribution settings, click on the "Behaviors" tab.

5. In the list of behaviors, check the "Field-Level Encryption" column. If it is set to "None", then field-level encryption is not enabled for that distribution.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List CloudFront Distributions: Use the AWS CLI command "list-distributions" to get a list of all the CloudFront distributions. The command is as follows:
   ```
   aws cloudfront list-distributions
   ```
   This command will return a JSON output with details of all the CloudFront distributions.

3. Check Field-Level Encryption: For each CloudFront distribution, check the "FieldLevelEncryptionId" field. If this field is empty or not present, it means that field-level encryption is not enabled for that distribution. You can do this by parsing the JSON output using a tool like jq. The command is as follows:
   ```
   aws cloudfront list-distributions | jq -r '.DistributionList.Items[] | select(.FieldLevelEncryptionId == "")'
   ```
   This command will return the details of all the CloudFront distributions where field-level encryption is not enabled.

4. Repeat the process: Repeat steps 2 and 3 for all the AWS accounts and regions in your organization to ensure that field-level encryption is enabled for all CloudFront distributions.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   After installing Boto3, you need to configure it. You can do this by creating a new session using your AWS credentials:
   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       aws_session_token='SESSION_TOKEN',
   )
   ```
2. Use Boto3 to list all CloudFront distributions:
   You can use the `list_distributions` method of the CloudFront client in Boto3 to list all your CloudFront distributions:
   ```python
   cloudfront = session.client('cloudfront')
   distributions = cloudfront.list_distributions()
   ```
3. Check each distribution for field-level encryption:
   You can iterate over each distribution and check if field-level encryption is enabled. If the `FieldLevelEncryptionId` is empty, then field-level encryption is not enabled:
   ```python
   for distribution in distributions['DistributionList']['Items']:
       if not distribution['DefaultCacheBehavior']['FieldLevelEncryptionId']:
           print(f"Field-level encryption is not enabled for distribution {distribution['Id']}")
   ```
4. Run the script:
   Finally, you can run the script to check all your CloudFront distributions. If any distributions do not have field-level encryption enabled, they will be printed to the console.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "CloudFront Distributions Should Have Field-Level Encryption Enabled" in AWS using AWS console, follow the below steps:

1. Login to AWS Management Console.
2. Go to the CloudFront service.
3. Select the CloudFront distribution for which you want to enable field-level encryption.
4. Click on the "Edit" button in the top menu.
5. Scroll down to the "Security and Privacy" section.
6. In the "Field-level Encryption Config" section, click on the "Create Field-level Encryption Config" button.
7. In the "Create Field-level Encryption Config" dialog box, enter a name for the configuration and click on the "Create" button.
8. In the "Field-level Encryption Config" section, select the newly created configuration from the dropdown list.
9. Click on the "Yes, Edit" button to save the changes.
10. Finally, click on the "Save Changes" button to complete the remediation.

By following these steps, you have successfully enabled Field-level Encryption for the selected CloudFront distribution in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of CloudFront distributions not having field-level encryption enabled in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine and run the following command to enable field-level encryption for your CloudFront distribution:

```
aws cloudfront update-distribution --id DISTRIBUTION_ID --field-level-encryption-config Id=FIELD_LEVEL_ENCRYPTION_ID,ForwardWhenContentTypeIsUnknown=true
```

Replace `DISTRIBUTION_ID` with the ID of your CloudFront distribution and `FIELD_LEVEL_ENCRYPTION_ID` with the ID of the field-level encryption configuration that you want to use.

2. Verify that field-level encryption is enabled for your CloudFront distribution by running the following command:

```
aws cloudfront get-distribution-config --id DISTRIBUTION_ID
```

This command will return the current configuration for your CloudFront distribution. Verify that the `FieldLevelEncryptionId` parameter is set to the ID of the field-level encryption configuration that you specified in step 1.

3. Test your CloudFront distribution to ensure that field-level encryption is working as expected.

Congratulations! You have now successfully remediated the misconfiguration of CloudFront distributions not having field-level encryption enabled in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "CloudFront Distributions Should Have Field-Level Encryption Enabled" in AWS using Python, you can follow the below steps:

1. Import the Boto3 library: 

```
import boto3
```

2. Create a CloudFront client object: 

```
client = boto3.client('cloudfront')
```

3. Get the list of CloudFront distributions: 

```
response = client.list_distributions()
```

4. Loop through each distribution and check if field-level encryption is enabled: 

```
for distribution in response['DistributionList']['Items']:
    distribution_id = distribution['Id']
    response = client.get_distribution_config(Id=distribution_id)
    if 'FieldLevelEncryption' not in response['DistributionConfig']:
        # Field-level encryption is not enabled, remediate it
```

5. If field-level encryption is not enabled, enable it by adding a field-level encryption configuration: 

```
field_level_encryption_config = {
    'CallerReference': 'unique_reference_string',
    'FieldLevelEncryptionConfig': {
        'FieldLevelEncryptionProfileConfig': {
            'Name': 'profile_name',
            'CallerReference': 'unique_reference_string',
            'EncryptionEntities': {
                'Quantity': 1,
                'Items': [
                    {
                        'PublicKeyId': 'public_key_id',
                        'ProviderId': 'provider_id'
                    }
                ]
            }
        },
        'ContentTypeProfileConfig': {
            'ForwardWhenContentTypeIsUnknown': False,
            'ContentTypeProfiles': {
                'Quantity': 1,
                'Items': [
                    {
                        'Format': 'URLEncoded',
                        'ProfileId': 'profile_id',
                        'ContentType': 'content_type'
                    }
                ]
            }
        }
    }
}
response = client.update_distribution(
    DistributionConfig={
        'CallerReference': 'unique_reference_string',
        'Aliases': {
            'Quantity': 1,
            'Items': [
                'example.com'
            ]
        },
        'DefaultRootObject': 'index.html',
        'Origins': {
            'Quantity': 1,
            'Items': [
                {
                    'Id': 'unique_id',
                    'DomainName': 'example.com',
                    'OriginPath': '',
                    'CustomHeaders': {
                        'Quantity': 0
                    },
                    'S3OriginConfig': {
                        'OriginAccessIdentity': ''
                    },
                    'CustomOriginConfig': {
                        'HTTPPort': 80,
                        'HTTPSPort': 443,
                        'OriginProtocolPolicy': 'https-only',
                        'OriginSslProtocols': {
                            'Quantity': 3,
                            'Items': [
                                'TLSv1',
                                'TLSv1.1',
                                'TLSv1.2'
                            ]
                        }
                    }
                }
            ]
        },
        'DefaultCacheBehavior': {
            'TargetOriginId': 'unique_id',
            'ForwardedValues': {
                'QueryString': False,
                'Cookies': {
                    'Forward': 'none'
                },
                'Headers': {
                    'Quantity': 0
                },
                'QueryStringCacheKeys': {
                    'Quantity': 0
                }
            },
            'TrustedSigners': {
                'Enabled': False,
                'Quantity': 0
            },
            'ViewerProtocolPolicy': 'redirect-to-https',
            'MinTTL': 0,
            'AllowedMethods': {
                'Quantity': 2,
                'Items': [
                    'GET',
                    'HEAD'
                ],
                'CachedMethods': {
                    'Quantity': 2,
                    'Items': [
                        'GET',
                        'HEAD'
                    ]
                }
            },
            'SmoothStreaming': False,
            'DefaultTTL': 86400,
            'MaxTTL': 31536000,
            'Compress': False,
            'LambdaFunctionAssociations': {
                'Quantity': 0
            }
        },
        'CacheBehaviors': {
            'Quantity': 0
        },
        'CustomErrorResponses': {
            'Quantity': 0
        },
        'Comment': '',
        'Logging': {
            'Enabled': False,
            'IncludeCookies': False,
            'Bucket': '',
            'Prefix': ''
        },
        'PriceClass': 'PriceClass_All',
        'Enabled': True,
        'ViewerCertificate': {
            'CloudFrontDefaultCertificate': True,
            'MinimumProtocolVersion': 'TLSv1',
            'CertificateSource': 'cloudfront'
        },
        'Restrictions': {
            'GeoRestriction': {
                'RestrictionType': 'none',
                'Quantity': 0
            }
        },
        'WebACLId': '',
        'HttpVersion': 'http2',
        'IsIPV6Enabled': True,
        'FieldLevelEncryption': field_level_encryption_config
    },
    Id=distribution_id,
    IfMatch=response['ETag']
)
```

6. Replace the `unique_reference_string`, `profile_name`, `public_key_id`, `provider_id`, `profile_id`, `content_type`, `example.com`, `unique_id`, and `bucket_name` with the appropriate values for your CloudFront distribution.

7. Save the Python script and execute it to remediate the "CloudFront Distributions Should Have Field-Level Encryption Enabled" misconfiguration in AWS.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/field-level-encryption.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/field-level-encryption.html) 

