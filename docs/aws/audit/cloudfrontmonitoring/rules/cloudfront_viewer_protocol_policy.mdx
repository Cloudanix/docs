---
slug: cloudfront_viewer_protocol_policy
title: Communication With Viewers Should Be Encrypted Using HTTPS
sidebar_label: Communication With Viewers Should Be Encrypted Using HTTPS
---

### More Info:

The communication between your Amazon CloudFront CDN distribution and its viewers (end users) should be encrypted using HTTPS in order to secure the delivery of your web application content

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NIST, GDPR


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent communication with viewers should be encrypted using HTTPS in CloudFront using the AWS Management Console, follow these steps:

1. **Access CloudFront Distributions:**
   - Sign in to the AWS Management Console.
   - Open the CloudFront console at [https://console.aws.amazon.com/cloudfront/](https://console.aws.amazon.com/cloudfront/).
   - In the CloudFront console, choose "Distributions" from the navigation pane.

2. **Select the Distribution:**
   - In the list of distributions, select the ID of the distribution that you want to update.
   - This will take you to the distribution's settings page.

3. **Edit Viewer Protocol Policy:**
   - Choose the "Behaviors" tab.
   - Select the behavior that you want to update (usually the default behavior).
   - Click on the "Edit" button to modify the behavior settings.

4. **Set HTTPS Only:**
   - In the "Viewer Protocol Policy" section, select "Redirect HTTP to HTTPS" or "HTTPS Only" from the dropdown menu.
   - "Redirect HTTP to HTTPS" will automatically redirect HTTP requests to HTTPS.
   - "HTTPS Only" will only allow HTTPS requests and reject HTTP requests.
   - Click on the "Yes, Edit" button to save the changes.

By following these steps, you ensure that communication between viewers and CloudFront is encrypted using HTTPS, enhancing the security of your content delivery.
</Accordion>

<Accordion title='Using CLI'>
To ensure that communication with viewers is encrypted using HTTPS in Amazon CloudFront, you can configure your CloudFront distribution to only allow HTTPS connections. Here are the steps to achieve this using the AWS CLI:

1. **Create or Update CloudFront Distribution with HTTPS Only:**
   Ensure that your CloudFront distribution is configured to redirect HTTP requests to HTTPS. This can be done by setting the `ViewerProtocolPolicy` to `redirect-to-https`.

2. **Modify the Default Cache Behavior:**
   Update the default cache behavior to enforce HTTPS. This involves setting the `ViewerProtocolPolicy` to `redirect-to-https`.

3. **Update the Distribution Configuration:**
   Use the `update-distribution` command to apply the changes to your CloudFront distribution.

4. **Verify the Configuration:**
   Confirm that the distribution settings have been updated correctly.

Here are the specific AWS CLI commands to achieve this:

### Step 1: Get the Current Distribution Configuration
```sh
aws cloudfront get-distribution-config --id <DISTRIBUTION_ID> > config.json
```

### Step 2: Modify the Configuration File
Edit the `config.json` file to set the `ViewerProtocolPolicy` to `redirect-to-https` for the default cache behavior and any other cache behaviors you have.

Example JSON snippet:
```json
{
  "DistributionConfig": {
    ...
    "DefaultCacheBehavior": {
      ...
      "ViewerProtocolPolicy": "redirect-to-https",
      ...
    },
    ...
  }
}
```

### Step 3: Update the Distribution with the Modified Configuration
```sh
aws cloudfront update-distribution --id <DISTRIBUTION_ID> --if-match <ETAG> --distribution-config file://config.json
```
- `<DISTRIBUTION_ID>`: The ID of your CloudFront distribution.
- `<ETAG>`: The ETag value from the `get-distribution-config` command output.

### Step 4: Verify the Configuration
```sh
aws cloudfront get-distribution --id <DISTRIBUTION_ID>
```
Check the output to ensure that the `ViewerProtocolPolicy` is set to `redirect-to-https`.

By following these steps, you can ensure that all communication with viewers is encrypted using HTTPS in your CloudFront distribution.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS CloudFront using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure that your CloudFront distribution is configured to use HTTPS for communication with viewers:

### Step 1: Install Boto3
Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
```bash
pip install boto3
```

### Step 2: Initialize Boto3 Client
Initialize the Boto3 client for CloudFront:
```python
import boto3

client = boto3.client('cloudfront')
```

### Step 3: Get the Distribution Configuration
Fetch the current configuration of your CloudFront distribution. Replace `DISTRIBUTION_ID` with your actual distribution ID.
```python
distribution_id = 'DISTRIBUTION_ID'
response = client.get_distribution_config(Id=distribution_id)
config = response['DistributionConfig']
etag = response['ETag']
```

### Step 4: Update the Viewer Protocol Policy
Ensure that the `ViewerProtocolPolicy` is set to `redirect-to-https` or `https-only` for all cache behaviors. This will enforce HTTPS communication with viewers.
```python
# Update the default cache behavior
config['DefaultCacheBehavior']['ViewerProtocolPolicy'] = 'redirect-to-https'

# Update all other cache behaviors if they exist
if 'CacheBehaviors' in config and 'Items' in config['CacheBehaviors']:
    for cache_behavior in config['CacheBehaviors']['Items']:
        cache_behavior['ViewerProtocolPolicy'] = 'redirect-to-https'

# Update the distribution configuration
client.update_distribution(
    DistributionConfig=config,
    Id=distribution_id,
    IfMatch=etag
)
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Initialize Boto3 Client**: Set up the Boto3 client for CloudFront.
3. **Get the Distribution Configuration**: Fetch the current configuration of your CloudFront distribution.
4. **Update the Viewer Protocol Policy**: Modify the `ViewerProtocolPolicy` to `redirect-to-https` or `https-only` for all cache behaviors and update the distribution configuration.

By following these steps, you can ensure that communication with viewers is encrypted using HTTPS in AWS CloudFront.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CloudFront service.

2. In the CloudFront dashboard, select the ID of the distribution that you want to check.

3. In the distribution settings, click on the "Behaviors" tab.

4. Check the "Viewer Protocol Policy" setting. If it is set to "HTTP and HTTPS" or "Redirect HTTP to HTTPS", then the communication with viewers is encrypted using HTTPS. If it is set to "HTTP Only", then the communication is not encrypted.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the CloudFront distributions.

2. Once the AWS CLI is set up, you can list all the CloudFront distributions using the following command:

   ```
   aws cloudfront list-distributions
   ```

   This command will return a JSON object with all the CloudFront distributions.

3. To check if communication with viewers is encrypted using HTTPS, you need to look at the ViewerProtocolPolicy under DefaultCacheBehavior. You can do this by using the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   Replace `<distribution-id>` with the ID of the distribution you want to check. This command will return the configuration of the specified CloudFront distribution.

4. Finally, you can use a tool like `jq` to parse the JSON output and check the ViewerProtocolPolicy. The command would look something like this:

   ```
   aws cloudfront get-distribution-config --id <distribution-id> | jq '.DistributionConfig.DefaultCacheBehavior.ViewerProtocolPolicy'
   ```

   If the output of this command is "redirect-to-https" or "https-only", then the communication with viewers is encrypted using HTTPS. If the output is "allow-all", then the communication is not necessarily encrypted.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials for use by boto3 in several ways, but the simplest is to use the AWS CLI tool. Run `aws configure` and then enter your access key, secret access key, and default region when prompted.

3. Write a Python script to check the CloudFront distributions: Here is a simple Python script that uses boto3 to retrieve all the CloudFront distributions and check if they are configured to communicate with viewers using HTTPS:

   ```python
   import boto3

   def check_cloudfront_https():
       client = boto3.client('cloudfront')
       distributions = client.list_distributions()
       for distribution in distributions['DistributionList']['Items']:
           if 'ViewerCertificate' in distribution and 'MinimumProtocolVersion' in distribution['ViewerCertificate']:
               if distribution['ViewerCertificate']['MinimumProtocolVersion'] != 'TLSv1.2_2018':
                   print(f"Distribution {distribution['Id']} is not configured to use HTTPS for communication with viewers.")
   
   if __name__ == "__main__":
       check_cloudfront_https()
   ```
   
   This script will print out the IDs of any distributions that are not configured to use at least TLSv1.2 for communication with viewers.

4. Run the script: You can run the script from your command line using the Python interpreter:

   ```bash
   python check_cloudfront_https.py
   ```

   This will print out the IDs of any CloudFront distributions that are not configured to use HTTPS for communication with viewers. If no such distributions are found, the script will not output anything.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate this misconfiguration in AWS, you can follow the below steps:

1. Log in to your AWS console and navigate to the Amazon CloudFront service.

2. Click on the distribution ID for which you want to enable HTTPS.

3. In the distribution settings, click on the "Behaviors" tab.

4. Select the behavior for which you want to enable HTTPS and click on the "Edit" button.

5. In the "Edit Behavior" window, scroll down to the "Viewer Protocol Policy" section.

6. Select "Redirect HTTP to HTTPS" from the dropdown list.

7. Click on the "Yes, Edit" button to save the changes.

8. Wait for the changes to propagate. This may take a few minutes.

9. Once the changes are propagated, your CloudFront distribution will be configured to use HTTPS for all viewer communications.

By following these steps, you can remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine and run the following command to update the CloudFront distribution configuration:

```
aws cloudfront update-distribution --id <distribution-id> --distribution-config file://<path_to_config_file>
```

Note: Replace `<distribution-id>` with the ID of your CloudFront distribution and `<path_to_config_file>` with the path to your CloudFront distribution configuration file.

2. In the CloudFront distribution configuration file, add the following JSON code to enable HTTPS encryption for viewer communication:

```
"ViewerCertificate": {
  "CloudFrontDefaultCertificate": true,
  "MinimumProtocolVersion": "TLSv1.2_2018",
  "SSLSupportMethod": "sni-only"
}
```

3. Save the configuration file and run the update-distribution command again to apply the changes.

4. Wait for the CloudFront distribution to deploy the changes. This may take several minutes.

5. Verify that HTTPS encryption is enabled for viewer communication by accessing your CloudFront distribution using HTTPS. You can do this by visiting the domain name of your CloudFront distribution in a web browser and checking that the URL starts with "https://" and has a green padlock icon.

That's it! You have now remediated the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" for AWS using python, you can follow the below steps:

1. Open the AWS console and navigate to the CloudFront service.
2. Select the distribution for which you want to enable HTTPS.
3. Click on the "Behaviors" tab and select the behavior for which you want to enable HTTPS.
4. Click on "Edit" and then select "Yes" for the "Redirect HTTP to HTTPS" option.
5. Scroll down to the "Viewer Protocol Policy" option and select "Redirect HTTP to HTTPS".
6. Save the changes.

To automate this process using Python, you can use the AWS SDK boto3. Here's a sample code:

```
import boto3

# Initialize the CloudFront client
cloudfront = boto3.client('cloudfront')

# Get the distribution ID for which you want to enable HTTPS
distribution_id = 'YOUR_DISTRIBUTION_ID'

# Get the current configuration for the distribution
response = cloudfront.get_distribution_config(Id=distribution_id)

# Enable HTTPS for the viewer
response['DistributionConfig']['ViewerCertificate']['MinimumProtocolVersion'] = 'TLSv1.2_2018'

# Save the updated configuration
cloudfront.update_distribution(DistributionConfig=response['DistributionConfig'], Id=distribution_id, IfMatch=response['ETag'])
```

Note: Replace `YOUR_DISTRIBUTION_ID` with the actual distribution ID for which you want to enable HTTPS.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html) 

