---
slug: cloudfront_viewer_protocol_policy
title: Communication With Viewers Should Be Encrypted Using HTTPS
sidebar_label: Communication With Viewers Should Be Encrypted Using HTTPS
---

### More Info:

The communication between your Amazon CloudFront CDN distribution and its viewers (end users) should be encrypted using HTTPS in order to secure the delivery of your web application content

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NIST, GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the CloudFront service.
2. In the CloudFront dashboard, select the ID of the distribution you want to check.
3. In the distribution settings, navigate to the "General" tab.
4. Check the "Viewer Protocol Policy" under the "Default Cache Behavior Settings". If it is not set to "Redirect HTTP to HTTPS" or "HTTPS Only", then the communication with viewers is not encrypted using HTTPS.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the CloudFront distributions.

2. Once the AWS CLI is set up, you can list all the CloudFront distributions using the following command:

   ```
   aws cloudfront list-distributions
   ```

   This command will return a JSON object with all the CloudFront distributions.

3. To check if communication with viewers is encrypted using HTTPS, you need to look at the ViewerProtocolPolicy under DefaultCacheBehavior. You can do this by using the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   Replace `<distribution-id>` with the ID of the distribution you want to check. This command will return the configuration of the specified CloudFront distribution.

4. Finally, you can use a tool like `jq` to parse the JSON output and check the ViewerProtocolPolicy. The command would look something like this:

   ```
   aws cloudfront get-distribution-config --id <distribution-id> | jq '.DistributionConfig.DefaultCacheBehavior.ViewerProtocolPolicy'
   ```

   If the output is "redirect-to-https", "https-only" or "allow-all", then the communication with viewers is encrypted using HTTPS. If the output is "http-and-https", then the communication with viewers is not necessarily encrypted.

#### Using Python

To check if communication with viewers is encrypted using HTTPS in CloudFront using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3**: First, you need to install the Boto3 library in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS Credentials**: Boto3 needs your AWS credentials to interact with AWS services. You can configure it using the AWS CLI:
   ```
   aws configure
   ```
   Then, provide your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

3. **Create a Python Script**: Now, create a Python script to check if the communication with viewers is encrypted using HTTPS in CloudFront. Here is a sample script:

   ```python
   import boto3

   def check_cloudfront_encryption():
       client = boto3.client('cloudfront')
       distributions = client.list_distributions()
       for distribution in distributions['DistributionList']['Items']:
           if distribution['ViewerCertificate']['MinimumProtocolVersion'] != 'TLSv1.2_2018':
               print(f"Distribution {distribution['Id']} is not using HTTPS for communication with viewers.")

   if __name__ == "__main__":
       check_cloudfront_encryption()
   ```
   This script lists all CloudFront distributions and checks if the `MinimumProtocolVersion` of the `ViewerCertificate` is not 'TLSv1.2_2018'. If it's not, it prints the ID of the distribution.

4. **Run the Python Script**: Finally, run the Python script using the Python interpreter:
   ```
   python check_cloudfront_encryption.py
   ```
   This will print the IDs of all CloudFront distributions that are not using HTTPS for communication with viewers.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate this misconfiguration in AWS, you can follow the below steps:

1. Log in to your AWS console and navigate to the Amazon CloudFront service.

2. Click on the distribution ID for which you want to enable HTTPS.

3. In the distribution settings, click on the "Behaviors" tab.

4. Select the behavior for which you want to enable HTTPS and click on the "Edit" button.

5. In the "Edit Behavior" window, scroll down to the "Viewer Protocol Policy" section.

6. Select "Redirect HTTP to HTTPS" from the dropdown list.

7. Click on the "Yes, Edit" button to save the changes.

8. Wait for the changes to propagate. This may take a few minutes.

9. Once the changes are propagated, your CloudFront distribution will be configured to use HTTPS for all viewer communications.

By following these steps, you can remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using the AWS console.

#### Using CLI

To remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine and run the following command to update the CloudFront distribution configuration:

```
aws cloudfront update-distribution --id <distribution-id> --distribution-config file://<path_to_config_file>
```

Note: Replace `<distribution-id>` with the ID of your CloudFront distribution and `<path_to_config_file>` with the path to your CloudFront distribution configuration file.

2. In the CloudFront distribution configuration file, add the following JSON code to enable HTTPS encryption for viewer communication:

```
"ViewerCertificate": {
  "CloudFrontDefaultCertificate": true,
  "MinimumProtocolVersion": "TLSv1.2_2018",
  "SSLSupportMethod": "sni-only"
}
```

3. Save the configuration file and run the update-distribution command again to apply the changes.

4. Wait for the CloudFront distribution to deploy the changes. This may take several minutes.

5. Verify that HTTPS encryption is enabled for viewer communication by accessing your CloudFront distribution using HTTPS. You can do this by visiting the domain name of your CloudFront distribution in a web browser and checking that the URL starts with "https://" and has a green padlock icon.

That's it! You have now remediated the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration "Communication With Viewers Should Be Encrypted Using HTTPS" for AWS using python, you can follow the below steps:

1. Open the AWS console and navigate to the CloudFront service.
2. Select the distribution for which you want to enable HTTPS.
3. Click on the "Behaviors" tab and select the behavior for which you want to enable HTTPS.
4. Click on "Edit" and then select "Yes" for the "Redirect HTTP to HTTPS" option.
5. Scroll down to the "Viewer Protocol Policy" option and select "Redirect HTTP to HTTPS".
6. Save the changes.

To automate this process using Python, you can use the AWS SDK boto3. Here's a sample code:

```
import boto3

# Initialize the CloudFront client
cloudfront = boto3.client('cloudfront')

# Get the distribution ID for which you want to enable HTTPS
distribution_id = 'YOUR_DISTRIBUTION_ID'

# Get the current configuration for the distribution
response = cloudfront.get_distribution_config(Id=distribution_id)

# Enable HTTPS for the viewer
response['DistributionConfig']['ViewerCertificate']['MinimumProtocolVersion'] = 'TLSv1.2_2018'

# Save the updated configuration
cloudfront.update_distribution(DistributionConfig=response['DistributionConfig'], Id=distribution_id, IfMatch=response['ETag'])
```

Note: Replace `YOUR_DISTRIBUTION_ID` with the actual distribution ID for which you want to enable HTTPS.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html) 


</Tab>
</Tabs>