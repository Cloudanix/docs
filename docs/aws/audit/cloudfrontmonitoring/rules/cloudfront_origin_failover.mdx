---
slug: cloudfront_origin_failover
title: Origin Failover Should Be Enabled For CloudFront Distributions
sidebar_label: Origin Failover Should Be Enabled For CloudFront Distributions
---

### More Info:

Origin Failover feature should be enabled for your Amazon CloudFront web distributions in order to improve the availability of the content delivered to your end users

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" in AWS CloudFront using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select "CloudFront" from the dropdown.
   - In the CloudFront dashboard, click on "Distributions" to view your list of CloudFront distributions.

2. **Select the Distribution:**
   - From the list of distributions, click on the ID of the distribution for which you want to enable origin failover.

3. **Edit Origin Settings:**
   - In the distribution settings, go to the "Origins and Origin Groups" tab.
   - Click on the "Create Origin Group" button to create a new origin group or select an existing origin group if you have one.

4. **Configure Origin Failover:**
   - In the origin group settings, add your primary and secondary origins.
   - Ensure that the "Origin Group Failover Criteria" is configured correctly. This typically involves setting the conditions under which CloudFront should failover to the secondary origin (e.g., HTTP 4xx/5xx status codes).
   - Save the changes by clicking the "Create" or "Update" button.

By following these steps, you can ensure that origin failover is enabled for your CloudFront distributions, thereby improving the reliability and availability of your content delivery.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" using AWS CLI, you can follow these steps:

1. **Create a Primary and Secondary Origin:**
   Ensure you have both primary and secondary origins configured for your CloudFront distribution. You can create origins using the `create-distribution` or `update-distribution` commands.

   ```sh
   aws cloudfront create-distribution --distribution-config file://distribution-config.json
   ```

   Ensure your `distribution-config.json` includes both primary and secondary origins.

2. **Configure Origin Groups:**
   Define an origin group that includes both the primary and secondary origins. This configuration ensures that CloudFront can failover to the secondary origin if the primary origin fails.

   ```sh
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://distribution-config-with-origin-group.json
   ```

   Your `distribution-config-with-origin-group.json` should include an `OriginGroups` section.

3. **Set Failover Criteria:**
   Specify the failover criteria for the origin group. This typically involves setting the status codes that should trigger a failover.

   ```sh
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://distribution-config-with-failover-criteria.json
   ```

   Ensure your `distribution-config-with-failover-criteria.json` includes the `FailoverCriteria` within the `OriginGroups` section.

4. **Enable Origin Failover:**
   Ensure that the origin group is associated with the appropriate cache behaviors in your distribution configuration.

   ```sh
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://distribution-config-with-cache-behavior.json
   ```

   Your `distribution-config-with-cache-behavior.json` should reference the origin group in the `CacheBehaviors` section.

By following these steps, you can configure your CloudFront distribution to enable origin failover using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where Origin Failover should be enabled for CloudFront distributions using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that Origin Failover is enabled:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Create a Python Script**:
   Write a Python script to check and enable Origin Failover for your CloudFront distributions.

4. **Enable Origin Failover**:
   Use the Boto3 library to interact with CloudFront and enable Origin Failover.

Here is a sample Python script to enable Origin Failover for a CloudFront distribution:

```python
import boto3

# Initialize a session using Amazon CloudFront
client = boto3.client('cloudfront')

def enable_origin_failover(distribution_id, primary_origin_id, failover_origin_id):
    # Get the current distribution configuration
    response = client.get_distribution_config(Id=distribution_id)
    distribution_config = response['DistributionConfig']
    etag = response['ETag']

    # Check if Origin Failover is already enabled
    origins = distribution_config['Origins']['Items']
    for origin in origins:
        if origin['Id'] == primary_origin_id and 'OriginGroupId' in origin:
            print(f"Origin Failover is already enabled for origin {primary_origin_id}")
            return

    # Add Origin Failover configuration
    origin_group = {
        'Id': 'origin-group-1',
        'FailoverCriteria': {
            'StatusCodes': {
                'Quantity': 1,
                'Items': [500]
            }
        },
        'Members': {
            'Quantity': 2,
            'Items': [
                {'OriginId': primary_origin_id},
                {'OriginId': failover_origin_id}
            ]
        }
    }

    if 'OriginGroups' not in distribution_config:
        distribution_config['OriginGroups'] = {
            'Quantity': 0,
            'Items': []
        }

    distribution_config['OriginGroups']['Quantity'] += 1
    distribution_config['OriginGroups']['Items'].append(origin_group)

    # Update the distribution with the new configuration
    client.update_distribution(
        DistributionConfig=distribution_config,
        Id=distribution_id,
        IfMatch=etag
    )

    print(f"Origin Failover enabled for distribution {distribution_id}")

# Example usage
distribution_id = 'YOUR_DISTRIBUTION_ID'
primary_origin_id = 'YOUR_PRIMARY_ORIGIN_ID'
failover_origin_id = 'YOUR_FAILOVER_ORIGIN_ID'

enable_origin_failover(distribution_id, primary_origin_id, failover_origin_id)
```

### Explanation:
1. **Install Boto3**: Ensure Boto3 is installed to interact with AWS services.
2. **Set Up AWS Credentials**: Configure your AWS credentials to allow the script to authenticate with AWS.
3. **Create a Python Script**: Write a script to interact with CloudFront.
4. **Enable Origin Failover**: The script fetches the current distribution configuration, checks if Origin Failover is already enabled, and if not, it updates the configuration to include an Origin Group with failover settings.

This script ensures that Origin Failover is enabled for your CloudFront distribution, preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the CloudFront service by typing 'CloudFront' into the search bar and selecting it from the dropdown menu.
3. In the CloudFront console, you will see a list of your distributions. Click on the ID of the distribution you want to check.
4. In the distribution settings, click on the 'Origins and Origin Groups' tab. Here, you can see if Origin Failover is enabled or not. If there are two origins listed under the 'Origin Group' with the second one marked as 'Failover', then Origin Failover is enabled. If not, then it is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].Id' --output text
   ```
   This command will return a list of IDs for all your CloudFront distributions.

3. Check Origin Failover settings: For each CloudFront distribution ID returned by the previous command, run the following command to check the Origin Failover settings:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```
   Replace `<distribution-id>` with the ID of the CloudFront distribution you want to check. This command will return the configuration details of the specified CloudFront distribution.

4. Check the output: In the output of the previous command, look for the `Origins` section. If the `FailoverCriteria` and `StatusCodes` fields are present and correctly configured, then Origin Failover is enabled for the CloudFront distribution. If these fields are missing or misconfigured, then Origin Failover is not enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials for use by boto3 in several ways, but a common way is to use the AWS CLI. Run `aws configure` and then enter your access key, secret access key, and default region when prompted.

3. Write a Python script to check the CloudFront distributions: Here is a simple Python script that uses boto3 to retrieve all CloudFront distributions and check if Origin Failover is enabled.

   ```python
   import boto3

   def check_origin_failover():
       client = boto3.client('cloudfront')
       distributions = client.list_distributions()
       for distribution in distributions['DistributionList']['Items']:
           for origin in distribution['Origins']['Items']:
               if 'OriginGroups' in distribution:
                   for group in distribution['OriginGroups']['Items']:
                       if group['FailoverCriteria']['StatusCodes']['Quantity'] > 0:
                           print(f"Origin Failover is enabled for distribution {distribution['Id']}")
                       else:
                           print(f"Origin Failover is not enabled for distribution {distribution['Id']}")
               else:
                   print(f"Origin Failover is not enabled for distribution {distribution['Id']}")

   if __name__ == "__main__":
       check_origin_failover()
   ```

4. Run the script: You can run the script using any Python interpreter. The script will print out the ID of each CloudFront distribution and whether Origin Failover is enabled or not. If Origin Failover is not enabled for a distribution, it may be a misconfiguration.

Please note that this script assumes that you have the necessary permissions to list and describe CloudFront distributions. If you don't, you may need to adjust your IAM policies or roles.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" for AWS using the AWS console, follow the below steps:

1. Log in to the AWS Management Console.
2. Go to the CloudFront service page.
3. Select the distribution for which you want to enable Origin Failover.
4. Click on the "Origins and Origin Groups" tab.
5. Select the origin for which you want to enable failover.
6. Click on the "Edit" button.
7. Scroll down to the "Origin Failover" section.
8. Click on the "Yes" radio button to enable Origin Failover.
9. Provide the alternate origin details in the "Alternate Domain Name" field.
10. Click on the "Create" button to create a new origin group.
11. Click on the "Save Changes" button to save the changes made.

Once you have followed these steps, Origin Failover will be enabled for your CloudFront distribution.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" for AWS using AWS CLI, follow the steps below:

1. Open your terminal and ensure that AWS CLI is installed and configured.

2. Run the following command to list all the CloudFront distributions in your AWS account:
```
aws cloudfront list-distributions
```
3. Identify the CloudFront distribution that needs to be remediated.

4. Run the following command to update the CloudFront distribution to enable origin failover:
```
aws cloudfront update-distribution --id <cloudfront-distribution-id> --origin-failover-status-enabled
```
Replace `<cloudfront-distribution-id>` with the actual ID of the CloudFront distribution.

5. Verify that origin failover has been enabled for the CloudFront distribution by running the following command:
```
aws cloudfront get-distribution --id <cloudfront-distribution-id> --query 'Distribution.Origins.Items[].OriginFailoverCriteria.StatusCodes.Quantity' --output text
```
This command will return the number of status codes that are required to trigger a failover. If the output is greater than 0, it means that origin failover has been enabled for the CloudFront distribution.

6. Repeat the above steps for all the CloudFront distributions in your AWS account that need to be remediated.

By following these steps, you can remediate the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Origin Failover Should Be Enabled For CloudFront Distributions" for AWS using Python, you can follow the below steps:

1. Import the required AWS SDK libraries in your Python code. You will need `boto3` and `botocore` libraries.

```
import boto3
from botocore.exceptions import ClientError
```

2. Create a `boto3` client for CloudFront.

```
cloudfront_client = boto3.client('cloudfront')
```

3. Get the list of all the CloudFront distributions in your AWS account.

```
distributions = cloudfront_client.list_distributions()['DistributionList']['Items']
```

4. Loop through all the distributions and check if the "Origin Failover" is enabled or not. If it is not enabled, enable it.

```
for distribution in distributions:
    distribution_id = distribution['Id']
    distribution_config = cloudfront_client.get_distribution_config(Id=distribution_id)['DistributionConfig']
    if not distribution_config.get('Enabled', False):
        distribution_config['Enabled'] = True
        origin_failover_config = distribution_config.get('OriginFailoverSettings', {})
        origin_failover_config['Enabled'] = True
        distribution_config['OriginFailoverSettings'] = origin_failover_config
        try:
            cloudfront_client.update_distribution(DistributionConfig=distribution_config, Id=distribution_id, IfMatch=distribution_config['ETag'])
            print(f'Origin Failover enabled for CloudFront distribution {distribution_id}')
        except ClientError as e:
            print(f'Error enabling Origin Failover for CloudFront distribution {distribution_id}: {e}')
```

5. Run the Python script to enable the "Origin Failover" for all the CloudFront distributions in your AWS account.

Once the script is successfully executed, the "Origin Failover" will be enabled for all the CloudFront distributions in your AWS account.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/high_availability_origin_failover.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/high_availability_origin_failover.html) 

