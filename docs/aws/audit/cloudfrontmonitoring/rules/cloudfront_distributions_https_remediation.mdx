
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the CloudFront service. You can find this by typing 'CloudFront' into the search bar at the top of the console.
3. In the CloudFront console, you will see a list of your CloudFront distributions. Click on the ID of the distribution you want to check.
4. In the distribution settings, click on the 'Behaviors' tab. Here, you can see the 'Viewer Protocol Policy'. If it is set to 'HTTP and HTTPS', 'Redirect HTTP to HTTPS', or 'HTTPS Only', then HTTPS is enabled. If it is set to 'HTTP Only', then HTTPS is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].Id' --output text
   ```
   This command will return a list of IDs for all your CloudFront distributions.

3. Check HTTPS configuration for each distribution: For each distribution ID returned by the previous command, run the following command to check its HTTPS configuration:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```
   Replace `<distribution-id>` with the actual ID of your CloudFront distribution. This command will return the configuration details of the specified distribution.

4. Check the ViewerProtocolPolicy: In the output of the previous command, look for the `ViewerProtocolPolicy` field under `DefaultCacheBehavior`. If the value of this field is `allow-all`, it means that both HTTP and HTTPS are enabled on the distribution. If the value is `https-only`, it means that only HTTPS is enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3). You will need to set up your AWS credentials and AWS region to use Boto3. You can install Boto3 using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a CloudFront client and retrieve all distributions:

```python
cf = session.client('cloudfront')
distributions = cf.list_distributions()
```

4. Iterate over each distribution and check if HTTPS is enabled:

```python
for distribution in distributions['DistributionList']['Items']:
    if 'ViewerCertificate' in distribution and 'MinimumProtocolVersion' in distribution['ViewerCertificate']:
        if distribution['ViewerCertificate']['MinimumProtocolVersion'] != 'TLSv1.2_2018':
            print(f"CloudFront distribution {distribution['Id']} does not have HTTPS enabled.")
```

This script will print out the IDs of all CloudFront distributions that do not have HTTPS enabled. The 'MinimumProtocolVersion' attribute is used to determine if HTTPS is enabled, as it specifies the minimum SSL/TLS protocol that can be used to access the content. If it's not set to 'TLSv1.2_2018' or higher, then HTTPS is not enabled.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, I can help you with that. Here are the steps to remediate the HTTPS misconfiguration on CloudFront Distributions in AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the CloudFront service.
3. Click on the ID of the distribution you want to remediate.
4. Click on the "Behaviors" tab.
5. Select the behavior that requires HTTPS.
6. Click on the "Edit" button.
7. In the "Viewer Protocol Policy" section, select "Redirect HTTP to HTTPS".
8. Click on the "Yes, Edit" button to save the changes.

Once the above steps are completed, HTTPS will be enabled on the CloudFront distribution. If you have multiple distributions, you will need to repeat these steps for each of them.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate this misconfiguration for AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI on your local machine or on an EC2 instance.

2. Run the following command to enable HTTPS on your CloudFront distributions:

```
aws cloudfront update-distribution --id <distribution-id> --default-root-object index.html --viewer-protocol-policy redirect-to-https --no-include-cookies --no-forward-query-string --no-smooth-streaming --no-logging
```

Note: Replace `<distribution-id>` with the ID of your CloudFront distribution.

3. Wait for the distribution to update. This might take a few minutes.

4. Run the following command to verify that HTTPS is enabled:

```
aws cloudfront get-distribution --id <distribution-id> --query 'Distribution.DistributionConfig.ViewerCertificate.CloudFrontDefaultCertificate' --output text
```

Note: This command should return "true" to indicate that HTTPS is enabled.

5. Repeat the above steps for all of your CloudFront distributions.

By following these steps, you will have successfully enabled HTTPS on your CloudFront distributions.
</Accordion>

<Accordion title='Using Python'>
To remediate the HTTPS should be enabled on CloudFront Distributions misconfiguration in AWS using Python, follow these steps:

1. Import the required modules:

```python
import boto3
```

2. Create a boto3 client for CloudFront:

```python
client = boto3.client('cloudfront')
```

3. Get a list of all CloudFront distributions:

```python
response = client.list_distributions()
```

4. Loop through the distributions and check if HTTPS is enabled:

```python
for distribution in response['DistributionList']['Items']:
    if distribution['ViewerCertificate']['CertificateSource'] == 'cloudfront':
        print('HTTPS is already enabled for distribution:', distribution['Id'])
    else:
        print('HTTPS is not enabled for distribution:', distribution['Id'])
```

5. If HTTPS is not enabled, update the distribution to enable HTTPS:

```python
client.update_distribution(
    DistributionConfig={
        'Enabled': True,
        'ViewerCertificate': {
            'CloudFrontDefaultCertificate': True,
        },
    },
    Id=distribution['Id'],
    IfMatch=distribution['ETag']
)
```

This will enable HTTPS on the CloudFront distribution.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
