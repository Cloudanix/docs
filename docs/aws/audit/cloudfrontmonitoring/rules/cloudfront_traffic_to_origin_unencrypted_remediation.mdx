

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, in the top navigation pane, click on "Distributions".

3. In the Distributions pane, select the distribution that you want to check.

4. In the distribution settings, click on the "Behaviors" tab. Here, you can see all the behaviors associated with the selected distribution.

5. Check the "Viewer Protocol Policy" for each behavior. If the Viewer Protocol Policy is set to "HTTP and HTTPS" or "Redirect HTTP to HTTPS", then the CloudFront distribution is using HTTPS for secure delivery of web content. If it's set to "HTTP Only", then it's a misconfiguration as it's not using HTTPS for secure delivery.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List CloudFront Distributions: Use the AWS CLI command "list-distributions" to retrieve a list of your CloudFront distributions. The command is as follows:
   ```
   aws cloudfront list-distributions
   ```
   This command will return a JSON output with details about all your CloudFront distributions.

3. Check Viewer Protocol Policy: For each CloudFront distribution, check the "ViewerProtocolPolicy" under "DefaultCacheBehavior". This policy determines the protocols that viewers can use to access the content. If the policy is set to "allow-all", it means that viewers can access the content using both HTTP and HTTPS. If it's set to "https-only", it means that viewers can only access the content using HTTPS.

4. Use a script to automate the process: You can write a Python script using the boto3 library to automate the process of checking the ViewerProtocolPolicy for all your CloudFront distributions. Here is a simple example:
   ```python
   import boto3

   client = boto3.client('cloudfront')

   response = client.list_distributions()

   for distribution in response['DistributionList']['Items']:
       if distribution['DefaultCacheBehavior']['ViewerProtocolPolicy'] == 'allow-all':
           print(f"Distribution {distribution['Id']} allows both HTTP and HTTPS.")
       else:
           print(f"Distribution {distribution['Id']} allows only HTTPS.")
   ```
   This script will print out the ID of each distribution and whether it allows both HTTP and HTTPS or only HTTPS.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The primary library you need is boto3, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: To interact with AWS services, you need to set up your AWS credentials. You can do this by creating a credentials file at ~/.aws/credentials. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the default profile, you can use the following format:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write the Python script: Now you can write a Python script that uses boto3 to interact with AWS and check the CloudFront distributions. Here is a simple script that lists all CloudFront distributions and checks if they are using HTTPS:

   ```python
   import boto3

   # Create a CloudFront client
   cf = boto3.client('cloudfront')

   # List distributions
   distributions = cf.list_distributions()

   for distribution in distributions['DistributionList']['Items']:
       # Check if the viewer protocol policy is set to 'https-only'
       for cache_behavior in distribution['DefaultCacheBehavior']:
           if cache_behavior['ViewerProtocolPolicy'] != 'https-only':
               print(f"Distribution {distribution['Id']} is not using HTTPS for secure delivery of web content.")
   ```

4. Run the script: Finally, you can run the script using a Python interpreter. The script will print out the IDs of all CloudFront distributions that are not using HTTPS for secure delivery of web content. If no such distributions are found, the script will not output anything.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content" in AWS using the AWS Console:

1. Login to the AWS Management Console.
2. Navigate to the CloudFront console.
3. Select the distribution(s) that you want to modify.
4. Click on the "Edit" button at the top of the page.
5. In the "General" tab, under the "Viewer Protocol Policy" section, select "Redirect HTTP to HTTPS".
6. Click on the "Yes, Edit" button to save the changes.
7. Wait for the changes to propagate. 

Once the changes have propagated, your CloudFront distribution(s) will only allow HTTPS connections for secure delivery of web content.

#### Using CLI

To remediate the misconfiguration "CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content" for AWS using AWS CLI, follow the below steps:

1. Login to your AWS account using AWS CLI.
2. Identify the CloudFront distributions that are not using HTTPS for secure delivery of web content. You can use the following command to list all the CloudFront distributions in your account:

   ```
   aws cloudfront list-distributions
   ```

3. Once you have identified the CloudFront distribution that is not using HTTPS, you can update it to use HTTPS by using the following command:

   ```
   aws cloudfront update-distribution --id <distribution_id> --distribution-config file://config.json
   ```

   Replace `<distribution_id>` with the ID of the CloudFront distribution that you want to update.

4. Create a JSON file named `config.json` and add the following code to it:

   ```
   {
       "Comment": "Update CloudFront distribution to use HTTPS",
       "Enabled": true,
       "ViewerCertificate": {
           "ACMCertificateArn": "<ACM_certificate_ARN>",
           "MinimumProtocolVersion": "TLSv1.2_2018",
           "SSLSupportMethod": "sni-only"
       },
       "Origins": {
           "Quantity": 1,
           "Items": [
               {
                   "Id": "<origin_id>",
                   "DomainName": "<origin_domain_name>",
                   "OriginPath": "",
                   "CustomHeaders": {
                       "Quantity": 0
                   },
                   "CustomOriginConfig": {
                       "HTTPPort": 80,
                       "HTTPSPort": 443,
                       "OriginProtocolPolicy": "https-only",
                       "OriginSslProtocols": {
                           "Quantity": 3,
                           "Items": [
                               "TLSv1",
                               "TLSv1.1",
                               "TLSv1.2"
                           ]
                       }
                   }
               }
           ]
       },
       "DefaultCacheBehavior": {
           "TargetOriginId": "<origin_id>",
           "ViewerProtocolPolicy": "redirect-to-https",
           "MinTTL": 0,
           "AllowedMethods": {
               "Quantity": 7,
               "Items": [
                   "HEAD",
                   "DELETE",
                   "POST",
                   "GET",
                   "OPTIONS",
                   "PUT",
                   "PATCH"
               ],
               "CachedMethods": {
                   "Quantity": 2,
                   "Items": [
                       "GET",
                       "HEAD"
                   ]
               }
           },
           "SmoothStreaming": false,
           "Compress": true,
           "LambdaFunctionAssociations": {
               "Quantity": 0
           }
       },
       "PriceClass": "PriceClass_All",
       "Enabled": true
   }
   ```

   Replace `<ACM_certificate_ARN>` with the ARN of the ACM certificate that you want to use for HTTPS. Replace `<origin_id>` with the ID of the CloudFront origin that you want to use for HTTPS. Replace `<origin_domain_name>` with the domain name of the CloudFront origin that you want to use for HTTPS.

5. Save the `config.json` file and run the `aws cloudfront update-distribution` command to update the CloudFront distribution to use HTTPS.

6. Verify that the CloudFront distribution is now using HTTPS by accessing the distribution's URL in a web browser. The URL should start with `https://`.

#### Using Python

To remediate the misconfiguration of CloudFront distributions not using HTTPS for secure delivery of web content, you can use the following Python script:

1. First, import the necessary AWS SDK for Python (Boto3) libraries:

```
import boto3
```

2. Next, create a Boto3 client for CloudFront:

```
cloudfront = boto3.client('cloudfront')
```

3. Then, use the `list_distributions()` method to get a list of all CloudFront distributions:

```
response = cloudfront.list_distributions()
```

4. Loop through the distributions and check if they are using HTTPS:

```
for distribution in response['DistributionList']['Items']:
    if distribution['ViewerCertificate']['CertificateSource'] != 'cloudfront':
        print("Distribution {} is not using a CloudFront SSL certificate".format(distribution['Id']))
    elif distribution['ViewerCertificate']['MinimumProtocolVersion'] != 'TLSv1.2_2018':
        print("Distribution {} is not using TLSv1.2_2018".format(distribution['Id']))
    elif distribution['ViewerCertificate']['SSLSupportMethod'] != 'sni-only':
        print("Distribution {} is not using SNI-only SSL".format(distribution['Id']))
    else:
        print("Distribution {} is using HTTPS".format(distribution['Id']))
```

5. If a distribution is not using HTTPS, update its configuration using the `update_distribution()` method:

```
distribution_id = 'YOUR_DISTRIBUTION_ID'

response = cloudfront.get_distribution_config(Id=distribution_id)
config = response['DistributionConfig']

config['ViewerCertificate']['CloudFrontDefaultCertificate'] = True
config['ViewerCertificate']['MinimumProtocolVersion'] = 'TLSv1.2_2018'
config['ViewerCertificate']['SSLSupportMethod'] = 'sni-only'

response = cloudfront.update_distribution(DistributionConfig=config, Id=distribution_id, IfMatch=response['ETag'])

print("Distribution {} has been updated to use HTTPS".format(distribution_id))
```

Note: Replace `YOUR_DISTRIBUTION_ID` with the ID of the distribution you want to update.

By following these steps, you can remediate the misconfiguration of CloudFront distributions not using HTTPS for secure delivery of web content in AWS using Python.


</Tab>
</Tabs>