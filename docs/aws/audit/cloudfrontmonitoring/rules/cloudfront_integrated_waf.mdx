---
slug: cloudfront_integrated_waf
title: CloudFront Should Be Integrated With AWS WAF
sidebar_label: CloudFront Should Be Integrated With AWS WAF
---

### More Info:

All your AWS CloudFront web distributions should be integrated with the Web Application Firewall (AWS WAF) service to protect against application-layer attacks

### Risk Level

Low

### Address

Security

### Compliance Standards

SOC2, GDPR, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration where CloudFront should be integrated with AWS WAF using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select "CloudFront" from the dropdown list.
   - In the CloudFront dashboard, click on "Distributions" to view your existing CloudFront distributions.

2. **Select the Distribution:**
   - From the list of distributions, click on the ID of the distribution you want to integrate with AWS WAF.

3. **Edit Distribution Settings:**
   - In the distribution settings page, click on the "Behaviors" tab.
   - Select the behavior you want to associate with AWS WAF (usually the default behavior) and click on the "Edit" button.

4. **Associate AWS WAF Web ACL:**
   - In the "Edit Behavior" page, scroll down to the "AWS WAF Web ACL" section.
   - Click on the dropdown menu and select the Web ACL you want to associate with this CloudFront distribution.
   - Click on the "Yes, Edit" button to save the changes.

By following these steps, you ensure that your CloudFront distribution is integrated with AWS WAF, enhancing your security posture by protecting against common web exploits and vulnerabilities.
</Accordion>

<Accordion title='Using CLI'>
To ensure that AWS CloudFront is integrated with AWS WAF using AWS CLI, follow these steps:

1. **Create a Web ACL in AWS WAF:**
   First, you need to create a Web ACL (Access Control List) in AWS WAF. This Web ACL will be used to filter and monitor HTTP/HTTPS requests based on the rules you define.

   ```sh
   aws wafv2 create-web-acl --name myWebACL --scope CLOUDFRONT --default-action Block={} --visibility-config SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=myWebACLMetric --region us-east-1
   ```

2. **Create WAF Rules:**
   Create the necessary WAF rules that you want to apply to your CloudFront distribution. For example, you can create a rule to block IP addresses.

   ```sh
   aws wafv2 create-ip-set --name myIPSet --scope CLOUDFRONT --ip-address-version IPV4 --addresses 192.0.2.0/24 --region us-east-1
   ```

3. **Associate the Web ACL with CloudFront Distribution:**
   Once you have your Web ACL and rules set up, you need to associate the Web ACL with your CloudFront distribution.

   ```sh
   aws cloudfront update-distribution --id YOUR_DISTRIBUTION_ID --distribution-config file://distribution-config.json --if-match E2QWRUHAPOMQZL
   ```

   In the `distribution-config.json` file, ensure you include the Web ACL ID in the `WebACLId` field:

   ```json
   {
     "WebACLId": "arn:aws:wafv2:us-east-1:123456789012:regional/webacl/myWebACL/a1b2c3d4-5678-90ab-cdef-EXAMPLE11111"
   }
   ```

4. **Verify the Association:**
   Finally, verify that the Web ACL is correctly associated with your CloudFront distribution.

   ```sh
   aws cloudfront get-distribution --id YOUR_DISTRIBUTION_ID
   ```

   Check the output to ensure that the `WebACLId` field is populated with the correct Web ACL ARN.

By following these steps, you can ensure that your AWS CloudFront distribution is integrated with AWS WAF using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where CloudFront should be integrated with AWS WAF using Python scripts, you can follow these steps:

1. **Install AWS SDK for Python (Boto3):**
   Ensure you have Boto3 installed in your environment. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Create a WAF Web ACL:**
   First, you need to create a Web ACL (Access Control List) in AWS WAF. This Web ACL will be associated with your CloudFront distribution.
   ```python
   import boto3

   waf_client = boto3.client('wafv2', region_name='us-east-1')  # WAF is only available in us-east-1 for global resources

   response = waf_client.create_web_acl(
       Name='MyWebACL',
       Scope='CLOUDFRONT',
       DefaultAction={'Allow': {}},
       VisibilityConfig={
           'SampledRequestsEnabled': True,
           'CloudWatchMetricsEnabled': True,
           'MetricName': 'MyWebACL'
       },
       Rules=[]
   )

   web_acl_arn = response['Summary']['ARN']
   ```

3. **Associate the Web ACL with CloudFront Distribution:**
   Once the Web ACL is created, you need to associate it with your CloudFront distribution.
   ```python
   cloudfront_client = boto3.client('cloudfront')

   distribution_id = 'YOUR_CLOUDFRONT_DISTRIBUTION_ID'

   response = cloudfront_client.get_distribution_config(Id=distribution_id)
   etag = response['ETag']
   distribution_config = response['DistributionConfig']

   distribution_config['WebACLId'] = web_acl_arn

   cloudfront_client.update_distribution(
       DistributionConfig=distribution_config,
       Id=distribution_id,
       IfMatch=etag
   )
   ```

4. **Verify the Association:**
   Finally, verify that the Web ACL is correctly associated with the CloudFront distribution.
   ```python
   response = cloudfront_client.get_distribution(Id=distribution_id)
   if response['Distribution']['WebACLId'] == web_acl_arn:
       print("Web ACL successfully associated with CloudFront distribution.")
   else:
       print("Failed to associate Web ACL with CloudFront distribution.")
   ```

By following these steps, you can ensure that your CloudFront distribution is integrated with AWS WAF, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the CloudFront service. You can find this by typing 'CloudFront' into the search bar at the top of the console.
3. In the CloudFront console, you will see a list of all your CloudFront distributions. Click on the ID of the distribution you want to check.
4. In the distribution settings, click on the 'General' tab. Look for the 'AWS WAF WebACL' field. If this field is 'None', then CloudFront is not integrated with AWS WAF.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[].Id' --output text
   ```

   This command will return a list of IDs for all the CloudFront distributions.

3. Check each CloudFront distribution for AWS WAF integration: For each CloudFront distribution ID returned by the previous command, use the following AWS CLI command to check if it is integrated with AWS WAF:

   ```
   aws cloudfront get-distribution --id <distribution-id> --query 'Distribution.DistributionConfig.WebACLId' --output text
   ```

   Replace `<distribution-id>` with the ID of the CloudFront distribution you want to check. This command will return the ID of the AWS WAF web access control list (ACL) associated with the CloudFront distribution. If the command returns an empty string, it means that the CloudFront distribution is not integrated with AWS WAF.

4. Repeat the previous step for all CloudFront distributions: You need to repeat step 3 for each CloudFront distribution ID returned by the command in step 2. This will allow you to check all the CloudFront distributions in your AWS account for AWS WAF integration.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your local environment. Make sure you have the necessary permissions to access the CloudFront and WAF services.

```python
pip install boto3
aws configure
```

2. Create a Python script that lists all your CloudFront distributions and checks if they are integrated with AWS WAF.

```python
import boto3

def check_waf_integration():
    client = boto3.client('cloudfront')
    response = client.list_distributions()

    for distribution in response['DistributionList']['Items']:
        if 'WebACLId' in distribution and distribution['WebACLId']:
            print(f"Distribution {distribution['Id']} is integrated with WAF")
        else:
            print(f"Distribution {distribution['Id']} is not integrated with WAF")

check_waf_integration()
```

3. Run the Python script. The script will print out the IDs of all CloudFront distributions and whether they are integrated with AWS WAF.

```python
python check_waf_integration.py
```

4. Review the output. If a CloudFront distribution is not integrated with AWS WAF, it will be printed out. This indicates a potential misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration for AWS, follow these steps:

1. Log in to the AWS Management Console and navigate to the AWS WAF service.

2. Create a new web ACL (Access Control List) by clicking on the "Create web ACL" button.

3. Give your new web ACL a name and description.

4. Under "Rules", click on the "Add rule" button.

5. Select "AWS Managed Rules" and choose the rule set that you want to use. For example, choose the "AWSManagedRulesCommonRuleSet" rule set.

6. Under "Web ACL associations", click on the "Add association" button.

7. Select the CloudFront distribution that you want to associate with the web ACL.

8. Click on the "Add association" button to complete the association.

9. Wait for a few minutes for the changes to propagate.

10. Test your CloudFront distribution to ensure that it is now integrated with AWS WAF.

By following these steps, you should be able to remediate the misconfiguration and integrate your CloudFront distribution with AWS WAF.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of CloudFront not being integrated with AWS WAF for AWS using AWS CLI, follow the steps below:

1. Open the AWS CLI on your local machine.

2. Run the following command to create a new Web ACL in AWS WAF:

```
aws wafv2 create-web-acl --name <name-of-web-acl> --scope CLOUDFRONT --default-action block --description "<description-of-web-acl>"
```

Replace `<name-of-web-acl>` and `<description-of-web-acl>` with the desired name and description for your Web ACL.

3. Run the following command to get the ARN of the newly created Web ACL:

```
aws wafv2 list-web-acls --scope CLOUDFRONT --query "WebACLs[?Name=='<name-of-web-acl>'].ARN" --output text
```

Replace `<name-of-web-acl>` with the name of the Web ACL you created in step 2.

4. Run the following command to update the CloudFront distribution to use the new Web ACL:

```
aws cloudfront update-distribution --id <distribution-id> --web-acl-id <web-acl-arn> --web-acl-override
```

Replace `<distribution-id>` with the ID of the CloudFront distribution you want to update, and `<web-acl-arn>` with the ARN of the Web ACL you retrieved in step 3.

5. Wait for the CloudFront distribution to update and propagate the changes.

After completing these steps, your CloudFront distribution will be integrated with AWS WAF, and the new Web ACL will be applied to all incoming traffic.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of CloudFront not being integrated with AWS WAF, you can follow these steps using Python:

1. Import the necessary modules:

```
import boto3
```

2. Create a boto3 client for AWS WAF:

```
waf_client = boto3.client('waf')
```

3. Create a boto3 client for CloudFront:

```
cf_client = boto3.client('cloudfront')
```

4. Get the distribution ID of the CloudFront distribution that needs to be integrated with AWS WAF:

```
distribution_id = 'YOUR_DISTRIBUTION_ID'
```

5. Get the current configuration of the CloudFront distribution:

```
response = cf_client.get_distribution_config(Id=distribution_id)
```

6. Check if the distribution already has an AWS WAF web ACL ID configured:

```
if 'WebACLId' in response['DistributionConfig']['WebACLId']:
    print('The CloudFront distribution is already integrated with AWS WAF.')
else:
    print('The CloudFront distribution is not integrated with AWS WAF.')
```

7. If the distribution is not integrated with AWS WAF, get the ID of the AWS WAF web ACL that needs to be associated with the distribution:

```
web_acl_id = 'YOUR_WEB_ACL_ID'
```

8. Update the configuration of the CloudFront distribution to integrate it with AWS WAF:

```
response['DistributionConfig']['WebACLId'] = web_acl_id
cf_client.update_distribution(DistributionConfig=response['DistributionConfig'], Id=distribution_id, IfMatch=response['ETag'])
```

9. Verify that the CloudFront distribution is now integrated with AWS WAF:

```
response = cf_client.get_distribution_config(Id=distribution_id)
if 'WebACLId' in response['DistributionConfig']['WebACLId']:
    print('The CloudFront distribution is now integrated with AWS WAF.')
else:
    print('Failed to integrate CloudFront distribution with AWS WAF.')
```

You can save this code as a Python script and execute it using a Python interpreter to remediate the misconfiguration of CloudFront not being integrated with AWS WAF.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html](https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html) 

