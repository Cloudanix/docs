

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the CloudFront service by typing "CloudFront" into the search bar and selecting it from the dropdown menu.
3. In the CloudFront dashboard, you will see a list of your distributions. Click on the ID of the distribution you want to check.
4. In the distribution settings, click on the "Behaviors" tab. Here, you can see the settings for each behavior associated with the distribution. Look for the "Compress Objects Automatically" setting. If it's set to "No", then the CloudFront web distribution is not configured to automatically compress web content.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].Id' --output text
   ```

   This command will return a list of all the CloudFront distribution IDs.

3. Check the compression setting for each distribution: For each distribution ID returned by the previous command, use the following AWS CLI command to check the compression setting:

   ```
   aws cloudfront get-distribution-config --id <distribution-id> --query 'DistributionConfig.DefaultCacheBehavior.Compress' --output text
   ```

   Replace `<distribution-id>` with the actual ID of the distribution. This command will return either `true` or `false`, indicating whether or not the distribution is configured to automatically compress web content.

4. Analyze the results: If the command returns `false` for any distribution, it means that the distribution is not configured to automatically compress web content. This is a misconfiguration that should be corrected to improve the performance of the distribution.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the credentials file yourself. By default, its location is at `~/.aws/credentials`. At a minimum, the credentials file should look like this:

   ```bash
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write the Python script: Now you can write a Python script to check if CloudFront Web Distributions are configured to automatically compress web content. Here is a simple script that does this:

   ```python
   import boto3

   client = boto3.client('cloudfront')

   response = client.list_distributions()

   for distribution in response['DistributionList']['Items']:
       if 'DefaultCacheBehavior' in distribution:
           if 'Compress' in distribution['DefaultCacheBehavior']:
               if distribution['DefaultCacheBehavior']['Compress'] == False:
                   print(f"Distribution {distribution['Id']} does not compress content automatically")
   ```

4. Run the script: Finally, you can run the script using a Python interpreter. The script will print the IDs of all distributions that do not compress content automatically. If no such distributions are found, the script will not print anything. 

   ```bash
   python check_compression.py
   ```

This script only checks the default cache behavior of each distribution. If a distribution has additional cache behaviors, you might need to modify the script to check those as well.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of CloudFront web distributions not automatically compressing web content in AWS using the AWS console, please follow the below steps:

1. Open the AWS Management Console and navigate to the CloudFront service.

2. Select the distribution that needs to be remediated.

3. Click on the "Behaviors" tab.

4. Click on the "Create Behavior" button.

5. In the "Create Behavior" dialog box, set the following values:

- Path Pattern: *
- Viewer Protocol Policy: Redirect HTTP to HTTPS
- Allowed HTTP Methods: GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE
- Compress Objects Automatically: Yes
- Cache Based on Selected Request Headers: None

6. Click on the "Create" button to create the new behavior.

7. Wait for the distribution to update and propagate the changes.

After following these steps, CloudFront web distributions will automatically compress web content.

#### Using CLI

To remediate the misconfiguration "CloudFront Web Distributions Should Automatically Compress Web Content" for AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the ID of the distribution for which you want to enable automatic compression:

   ```
   aws cloudfront list-distributions --query "DistributionList.Items[].{Id:Id,DomainName:DomainName}"
   ```

   This will return a list of all your CloudFront distributions along with their IDs and domain names.

3. Once you have the distribution ID, run the following command to update the distribution configuration to enable automatic compression:

   ```
   aws cloudfront update-distribution --id <distribution-id> --distribution-config '{"Enabled":true,"Compress":true,"DefaultCacheBehavior":{"Compress":true}}'
   ```

   Replace `<distribution-id>` with the ID of the distribution you want to update.

4. After running the above command, the distribution configuration will be updated to enable automatic compression for web content.

5. Verify the changes by running the following command:

   ```
   aws cloudfront get-distribution --id <distribution-id> --query "Distribution.DistributionConfig.DefaultCacheBehavior"
   ```

   This will return the configuration of the default cache behavior for the distribution, which should now have the "Compress" property set to true.

By following the above steps, you can remediate the misconfiguration "CloudFront Web Distributions Should Automatically Compress Web Content" for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of CloudFront web distributions not automatically compressing web content in AWS using Python, you can follow these steps:

1. Import the required AWS SDK modules using the following code:

```python
import boto3
from botocore.exceptions import ClientError
```

2. Create a boto3 client for CloudFront using the following code:

```python
client = boto3.client('cloudfront')
```

3. Get a list of all CloudFront distributions using the following code:

```python
try:
    response = client.list_distributions()
    distributions = response['DistributionList']['Items']
except ClientError as e:
    print(e)
```

4. Iterate through each distribution and check if it has a default cache behavior with a gzip compression enabled using the following code:

```python
for distribution in distributions:
    try:
        response = client.get_distribution_config(Id=distribution['Id'])
        config = response['DistributionConfig']
        if config['DefaultCacheBehavior']['Compress']:
            print(f"Gzip compression is already enabled for {distribution['Id']}")
        else:
            config['DefaultCacheBehavior']['Compress'] = True
            response = client.update_distribution(
                DistributionConfig=config,
                Id=distribution['Id'],
                IfMatch=response['ETag']
            )
            print(f"Gzip compression enabled for {distribution['Id']}")
    except ClientError as e:
        print(e)
```

5. Save the Python script and run it to remediate the misconfiguration.

This script will enable gzip compression for all CloudFront distributions that do not have it enabled by updating the default cache behavior of each distribution.


</Tab>
</Tabs>