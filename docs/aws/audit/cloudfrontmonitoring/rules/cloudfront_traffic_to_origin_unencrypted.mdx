---
slug: cloudfront_traffic_to_origin_unencrypted
title: CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content
sidebar_label: CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content
---

### More Info:

The communication between your AWS CloudFront distributions and their custom origins should be encrypted using HTTPS in order to secure the delivery of your web content.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, GDPR, AWSWAF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To ensure that your CloudFront distributions use HTTPS for secure delivery of web content using the AWS Management Console, follow these steps:

1. **Access CloudFront Distributions:**
   - Open the AWS Management Console.
   - Navigate to the CloudFront service by typing "CloudFront" in the search bar and selecting it from the results.

2. **Select the Distribution:**
   - In the CloudFront dashboard, you will see a list of your distributions.
   - Click on the ID of the distribution you want to configure to open its settings.

3. **Modify the Behavior Settings:**
   - In the distribution settings, go to the "Behaviors" tab.
   - Click on the "Edit" button next to the default behavior or any other behavior you want to modify.

4. **Require HTTPS:**
   - In the behavior settings, find the "Viewer Protocol Policy" option.
   - Select "Redirect HTTP to HTTPS" or "HTTPS Only" from the dropdown menu.
   - Click the "Yes, Edit" button to save your changes.

By following these steps, you ensure that your CloudFront distribution will use HTTPS for secure delivery of web content.
</Accordion>

<Accordion title='Using CLI'>
To ensure that your CloudFront distributions use HTTPS for secure delivery of web content using AWS CLI, follow these steps:

1. **List CloudFront Distributions:**
   First, identify the CloudFront distribution that you want to configure to use HTTPS.

   ```sh
   aws cloudfront list-distributions
   ```

2. **Get Distribution Configuration:**
   Retrieve the current configuration of the specific CloudFront distribution. Replace `DISTRIBUTION_ID` with your actual distribution ID.

   ```sh
   aws cloudfront get-distribution-config --id DISTRIBUTION_ID
   ```

3. **Update Distribution Configuration:**
   Modify the distribution configuration to enforce HTTPS. You need to set the `ViewerProtocolPolicy` to `redirect-to-https` or `https-only` for each cache behavior. First, save the current configuration to a file (e.g., `config.json`), then edit the file to update the `ViewerProtocolPolicy`.

   ```sh
   aws cloudfront get-distribution-config --id DISTRIBUTION_ID > config.json
   ```

   Edit `config.json` to set `ViewerProtocolPolicy` to `redirect-to-https` or `https-only` for each cache behavior.

4. **Apply Updated Configuration:**
   Apply the updated configuration back to the CloudFront distribution. Ensure you include the `If-Match` header with the ETag value from the previous configuration to avoid conflicts.

   ```sh
   aws cloudfront update-distribution --id DISTRIBUTION_ID --distribution-config file://config.json --if-match E_TAG
   ```

Replace `DISTRIBUTION_ID` with your CloudFront distribution ID and `E_TAG` with the ETag value obtained from the `get-distribution-config` command.

By following these steps, you can ensure that your CloudFront distributions are configured to use HTTPS for secure delivery of web content.
</Accordion>

<Accordion title='Using Python'>
To ensure that CloudFront distributions use HTTPS for secure delivery of web content, you can use the AWS SDK for Python (Boto3) to configure your CloudFront distributions accordingly. Below are the steps to prevent this misconfiguration using a Python script:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Create a Boto3 Session**:
   Initialize a Boto3 session and create a CloudFront client.
   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_AWS_ACCESS_KEY_ID',
       aws_secret_access_key='YOUR_AWS_SECRET_ACCESS_KEY',
       region_name='YOUR_AWS_REGION'
   )
   cloudfront_client = session.client('cloudfront')
   ```

3. **Retrieve and Update Distribution Configurations**:
   Fetch the existing CloudFront distribution configurations, modify them to enforce HTTPS, and update the distribution.
   ```python
   def enforce_https(distribution_id):
       # Get the current distribution configuration
       response = cloudfront_client.get_distribution_config(Id=distribution_id)
       config = response['DistributionConfig']
       etag = response['ETag']

       # Modify the configuration to enforce HTTPS
       for cache_behavior in config['CacheBehaviors']['Items']:
           cache_behavior['ViewerProtocolPolicy'] = 'redirect-to-https'
       config['DefaultCacheBehavior']['ViewerProtocolPolicy'] = 'redirect-to-https'

       # Update the distribution with the new configuration
       cloudfront_client.update_distribution(
           DistributionConfig=config,
           Id=distribution_id,
           IfMatch=etag
       )

   # Example usage
   distribution_id = 'YOUR_DISTRIBUTION_ID'
   enforce_https(distribution_id)
   ```

4. **Automate the Process**:
   Optionally, you can automate this process to run periodically or integrate it into your CI/CD pipeline to ensure all new distributions are configured correctly.
   ```python
   import time

   def monitor_and_enforce_https():
       while True:
           distributions = cloudfront_client.list_distributions()
           for distribution in distributions['DistributionList']['Items']:
               enforce_https(distribution['Id'])
           time.sleep(3600)  # Check every hour

   # Start monitoring
   monitor_and_enforce_https()
   ```

By following these steps, you can ensure that your CloudFront distributions are configured to use HTTPS for secure delivery of web content.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, in the top navigation pane, click on "Distributions".

3. In the Distributions pane, select the distribution that you want to check.

4. In the distribution settings, click on the "Behaviors" tab. Here, you can see all the behaviors associated with the selected distribution.

5. Check the "Viewer Protocol Policy" for each behavior. If the Viewer Protocol Policy is set to "HTTP and HTTPS" or "Redirect HTTP to HTTPS", then the CloudFront distribution is using HTTPS for secure delivery of web content. If it is set to "HTTP Only", then it is a misconfiguration as it is not using HTTPS for secure delivery of web content.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].{ID:Id,Domain:DomainName,Origins:Origins.Items[*].{ID:Id,Domain:DomainName}}'
   ```
   This command will return a list of all CloudFront distributions along with their ID, domain name, and origin details.

3. Check the Viewer Protocol Policy: For each CloudFront distribution, check the Viewer Protocol Policy to see if it's set to HTTPS. You can do this by running the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id> --query 'DistributionConfig.DefaultCacheBehavior.ViewerProtocolPolicy'
   ```
   Replace `<distribution-id>` with the ID of the CloudFront distribution you want to check. This command will return the Viewer Protocol Policy of the specified CloudFront distribution.

4. Analyze the output: If the Viewer Protocol Policy is set to `https-only` or `redirect-to-https`, then the CloudFront distribution is using HTTPS for secure delivery of web content. If it's set to `allow-all`, then the CloudFront distribution is not using HTTPS for secure delivery of web content, which is a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install and configure AWS SDK for Python (Boto3) to interact with AWS services. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure it using AWS CLI:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID and Secret Access Key, which you can get from your AWS Management Console.

2. Import necessary libraries and create a CloudFront client:
   In your Python script, you need to import Boto3 and create a CloudFront client to interact with the service.
   ```python
   import boto3

   # Create CloudFront client
   cf = boto3.client('cloudfront')
   ```

3. List and check CloudFront distributions:
   Use the `list_distributions()` function to get a list of all your CloudFront distributions. Then, iterate over each distribution and check if the ViewerProtocolPolicy is set to 'https-only' or 'redirect-to-https'. If not, the distribution is misconfigured.
   ```python
   # List distributions
   distributions = cf.list_distributions()

   for distribution in distributions['DistributionList']['Items']:
       # Get the default cache behavior
       default_behavior = distribution['DefaultCacheBehavior']

       # Check the ViewerProtocolPolicy
       if default_behavior['ViewerProtocolPolicy'] not in ['https-only', 'redirect-to-https']:
           print(f"Distribution {distribution['Id']} is misconfigured.")
   ```

4. Run the script:
   Save your script and run it using Python. It will print the IDs of all misconfigured CloudFront distributions.
   ```
   python check_cloudfront.py
   ```
   If there are any misconfigured distributions, you should see their IDs printed in the console.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the misconfiguration "CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content" in AWS using the AWS Console:

1. Login to the AWS Management Console.
2. Navigate to the CloudFront console.
3. Select the distribution(s) that you want to modify.
4. Click on the "Edit" button at the top of the page.
5. In the "General" tab, under the "Viewer Protocol Policy" section, select "Redirect HTTP to HTTPS".
6. Click on the "Yes, Edit" button to save the changes.
7. Wait for the changes to propagate. 

Once the changes have propagated, your CloudFront distribution(s) will only allow HTTPS connections for secure delivery of web content.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "CloudFront Distributions Should Use HTTPS For Secure Delivery of Web Content" for AWS using AWS CLI, follow the below steps:

1. Login to your AWS account using AWS CLI.
2. Identify the CloudFront distributions that are not using HTTPS for secure delivery of web content. You can use the following command to list all the CloudFront distributions in your account:

   ```
   aws cloudfront list-distributions
   ```

3. Once you have identified the CloudFront distribution that is not using HTTPS, you can update it to use HTTPS by using the following command:

   ```
   aws cloudfront update-distribution --id <distribution_id> --distribution-config file://config.json
   ```

   Replace `<distribution_id>` with the ID of the CloudFront distribution that you want to update.

4. Create a JSON file named `config.json` and add the following code to it:

   ```
   {
       "Comment": "Update CloudFront distribution to use HTTPS",
       "Enabled": true,
       "ViewerCertificate": {
           "ACMCertificateArn": "<ACM_certificate_ARN>",
           "MinimumProtocolVersion": "TLSv1.2_2018",
           "SSLSupportMethod": "sni-only"
       },
       "Origins": {
           "Quantity": 1,
           "Items": [
               {
                   "Id": "<origin_id>",
                   "DomainName": "<origin_domain_name>",
                   "OriginPath": "",
                   "CustomHeaders": {
                       "Quantity": 0
                   },
                   "CustomOriginConfig": {
                       "HTTPPort": 80,
                       "HTTPSPort": 443,
                       "OriginProtocolPolicy": "https-only",
                       "OriginSslProtocols": {
                           "Quantity": 3,
                           "Items": [
                               "TLSv1",
                               "TLSv1.1",
                               "TLSv1.2"
                           ]
                       }
                   }
               }
           ]
       },
       "DefaultCacheBehavior": {
           "TargetOriginId": "<origin_id>",
           "ViewerProtocolPolicy": "redirect-to-https",
           "MinTTL": 0,
           "AllowedMethods": {
               "Quantity": 7,
               "Items": [
                   "HEAD",
                   "DELETE",
                   "POST",
                   "GET",
                   "OPTIONS",
                   "PUT",
                   "PATCH"
               ],
               "CachedMethods": {
                   "Quantity": 2,
                   "Items": [
                       "GET",
                       "HEAD"
                   ]
               }
           },
           "SmoothStreaming": false,
           "Compress": true,
           "LambdaFunctionAssociations": {
               "Quantity": 0
           }
       },
       "PriceClass": "PriceClass_All",
       "Enabled": true
   }
   ```

   Replace `<ACM_certificate_ARN>` with the ARN of the ACM certificate that you want to use for HTTPS. Replace `<origin_id>` with the ID of the CloudFront origin that you want to use for HTTPS. Replace `<origin_domain_name>` with the domain name of the CloudFront origin that you want to use for HTTPS.

5. Save the `config.json` file and run the `aws cloudfront update-distribution` command to update the CloudFront distribution to use HTTPS.

6. Verify that the CloudFront distribution is now using HTTPS by accessing the distribution's URL in a web browser. The URL should start with `https://`.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of CloudFront distributions not using HTTPS for secure delivery of web content, you can use the following Python script:

1. First, import the necessary AWS SDK for Python (Boto3) libraries:

```
import boto3
```

2. Next, create a Boto3 client for CloudFront:

```
cloudfront = boto3.client('cloudfront')
```

3. Then, use the `list_distributions()` method to get a list of all CloudFront distributions:

```
response = cloudfront.list_distributions()
```

4. Loop through the distributions and check if they are using HTTPS:

```
for distribution in response['DistributionList']['Items']:
    if distribution['ViewerCertificate']['CertificateSource'] != 'cloudfront':
        print("Distribution {} is not using a CloudFront SSL certificate".format(distribution['Id']))
    elif distribution['ViewerCertificate']['MinimumProtocolVersion'] != 'TLSv1.2_2018':
        print("Distribution {} is not using TLSv1.2_2018".format(distribution['Id']))
    elif distribution['ViewerCertificate']['SSLSupportMethod'] != 'sni-only':
        print("Distribution {} is not using SNI-only SSL".format(distribution['Id']))
    else:
        print("Distribution {} is using HTTPS".format(distribution['Id']))
```

5. If a distribution is not using HTTPS, update its configuration using the `update_distribution()` method:

```
distribution_id = 'YOUR_DISTRIBUTION_ID'

response = cloudfront.get_distribution_config(Id=distribution_id)
config = response['DistributionConfig']

config['ViewerCertificate']['CloudFrontDefaultCertificate'] = True
config['ViewerCertificate']['MinimumProtocolVersion'] = 'TLSv1.2_2018'
config['ViewerCertificate']['SSLSupportMethod'] = 'sni-only'

response = cloudfront.update_distribution(DistributionConfig=config, Id=distribution_id, IfMatch=response['ETag'])

print("Distribution {} has been updated to use HTTPS".format(distribution_id))
```

Note: Replace `YOUR_DISTRIBUTION_ID` with the ID of the distribution you want to update.

By following these steps, you can remediate the misconfiguration of CloudFront distributions not using HTTPS for secure delivery of web content in AWS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https.html) 

