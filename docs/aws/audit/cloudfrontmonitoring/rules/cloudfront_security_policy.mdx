---
slug: cloudfront_security_policy
title: CloudFront Distributions Should Use Security Policies With Appropriate Version And Ciphers
sidebar_label: CloudFront Distributions Should Use Security Policies With Appropriate Version And Ciphers
---

### More Info:

Your Amazon CloudFront distributions should use a security policy with minimum TLSv1.2 and appropriate security ciphers for HTTPS viewer connections.

### Risk Level

Medium

### Address

Security

### Compliance Standards

NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, select the ID of the distribution that you want to check.

3. In the distribution settings, click on the "Behaviors" tab.

4. In the Behaviors settings, look for the "SSL Protocol" field. This field indicates the security policy that the CloudFront distribution is using. The security policy determines the SSL/TLS protocol that CloudFront uses to communicate with viewers, and the cipher that CloudFront uses to encrypt the content that it returns to viewers. 

Note: The security policy should be TLSv1.1_2016 or later and the ciphers should be appropriate and secure. If the security policy is older or the ciphers are not secure, then the CloudFront distribution is misconfigured.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List CloudFront Distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].{ID:Id,Domain:DomainName,Origin:Origins.Items[0].Id,ViewerProtocolPolicy:DefaultCacheBehavior.ViewerProtocolPolicy,MinProtocolVersion:DefaultCacheBehavior.MinTlsVersion}'
   ```
   This command will return a list of all CloudFront distributions along with their ID, Domain Name, Origin, Viewer Protocol Policy, and Minimum Protocol Version.

3. Check Security Policies: From the output of the previous command, check the 'ViewerProtocolPolicy' and 'MinProtocolVersion' fields for each CloudFront distribution. The 'ViewerProtocolPolicy' should be set to 'https-only' or 'redirect-to-https' and the 'MinProtocolVersion' should be set to 'TLSv1.2_2018' or higher to ensure that the CloudFront distribution is using security policies with appropriate version and ciphers.

4. Automate the Process: If you have a large number of CloudFront distributions, you can automate the process of checking the security policies by writing a Python script that uses the AWS SDK (boto3) to list all CloudFront distributions and check their security policies. The script would essentially do the same thing as the AWS CLI commands above, but in an automated way.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing your Python script, you need to install the necessary libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: To interact with AWS services, you need to set up your AWS credentials. You can do this by configuring them in the AWS credentials file (`~/.aws/credentials`):

   ```bash
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write the Python script: Now you can write a Python script that uses Boto3 to interact with AWS CloudFront and check the security policies of your distributions. Here's a basic example:

   ```python
   import boto3

   # Create a CloudFront client
   client = boto3.client('cloudfront')

   # List all distributions
   distributions = client.list_distributions()

   # Check the security policies of each distribution
   for distribution in distributions['DistributionList']['Items']:
       viewer_certificate = distribution['ViewerCertificate']
       if 'MinimumProtocolVersion' not in viewer_certificate or viewer_certificate['MinimumProtocolVersion'] != 'TLSv1.2_2018':
           print(f"Distribution {distribution['Id']} is using an outdated or unspecified security policy.")
   ```

4. Run the Python script: Finally, you can run your Python script. It will print out the IDs of all distributions that are using an outdated or unspecified security policy. If no such distributions are found, it will not print anything.

   ```bash
   python check_security_policies.py
   ```

This script only checks for the minimum protocol version, but you can easily extend it to check for other aspects of the security policy, such as the use of appropriate ciphers.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the CloudFront Distribution Security Policy misconfiguration in AWS, you can follow the below steps:

1. Log in to your AWS Management Console.
2. Navigate to the Amazon CloudFront service.
3. Click on the "Distributions" tab from the left-hand menu.
4. Select the CloudFront distribution that needs to be remediated.
5. Click on the "Edit" button.
6. Scroll down to the "Security Policy" section.
7. Select the appropriate security policy version from the dropdown list. The recommended version is TLSv1.2_2018.
8. Select the appropriate ciphers from the "Cipher Suites" dropdown list. The recommended ciphers are AES128-SHA256 and AES256-SHA256.
9. Click on the "Yes, Edit" button to save the changes.

Once the changes are saved, the CloudFront distribution will use the appropriate security policies with the recommended version and ciphers.

#### Using CLI

To remediate this misconfiguration in AWS, you can follow the below steps using AWS CLI:

1. First, you need to create a security policy with appropriate version and ciphers that you want to use for your CloudFront distribution. You can use the following command to create a security policy:

```
aws cloudfront create-public-key --name <policy-name> --public-key-config '{"CallerReference": "<unique-id>", "Name": "<policy-name>", "PublicKey": "<public-key>", "Comment": "<comment>"}'
```

Here, `<policy-name>` is the name you want to give to your security policy, `<unique-id>` is a unique identifier for the policy, `<public-key>` is the actual public key that you want to use, and `<comment>` is an optional comment that you can add.

2. Once you have created your security policy, you need to update your CloudFront distribution to use this policy. You can use the following command to update your distribution:

```
aws cloudfront update-distribution --id <distribution-id> --distribution-config '{"ViewerCertificate": {"MinimumProtocolVersion": "<minimum-protocol-version>", "SSLSupportMethod": "<ssl-support-method>", "Certificate": "<certificate-arn>", "CertificateSource": "<certificate-source>", "SecurityPolicy": "<policy-name>"}}'
```

Here, `<distribution-id>` is the ID of your CloudFront distribution, `<minimum-protocol-version>` is the minimum TLS version that you want to use, `<ssl-support-method>` is the SSL support method that you want to use, `<certificate-arn>` is the ARN of the SSL certificate that you want to use, `<certificate-source>` is the source of the SSL certificate (either `iam` or `acm`), and `<policy-name>` is the name of the security policy that you created in step 1.

3. Finally, you should verify that your CloudFront distribution is now using the correct security policy. You can use the following command to get the details of your distribution:

```
aws cloudfront get-distribution --id <distribution-id>
```

Here, `<distribution-id>` is the ID of your CloudFront distribution. This command will return the details of your distribution, including the security policy that it is currently using.

That's it! By following these steps, you can remediate the misconfiguration of using inappropriate security policies with appropriate version and ciphers for your AWS CloudFront distributions using AWS CLI.

#### Using Python

To remediate the misconfiguration "CloudFront Distributions Should Use Security Policies With Appropriate Version And Ciphers" for AWS using python, follow the below steps:

1. Create a new security policy with appropriate version and ciphers using the AWS CLI command:

```
aws cloudfront create-security-policy --name <policy-name> --policy-config file://<policy-config-file>
```

Replace `<policy-name>` with the name you want to give to the new security policy and `<policy-config-file>` with the path to the JSON file containing the policy configuration.

2. Update the CloudFront distribution to use the new security policy using the AWS CLI command:

```
aws cloudfront update-distribution --id <distribution-id> --distribution-config file://<distribution-config-file>
```

Replace `<distribution-id>` with the ID of the CloudFront distribution you want to update and `<distribution-config-file>` with the path to the JSON file containing the distribution configuration.

3. Verify that the updated distribution is now using the new security policy with appropriate version and ciphers.

Note: You can also use the AWS SDK for Python (Boto3) to perform the above steps programmatically.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html) 


</Tab>
</Tabs>