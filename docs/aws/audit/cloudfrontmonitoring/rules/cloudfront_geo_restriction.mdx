---
slug: cloudfront_geo_restriction
title: CloudFront Distributions Should Have Geo Restriction Enabled
sidebar_label: CloudFront Distributions Should Have Geo Restriction Enabled
---

### More Info:

Geo restriction should be enabled for your Amazon CloudFront CDN distribution to whitelist or blacklist a country in order to allow or restrict users in specific locations from accessing web application content.

### Risk Level

Low

### Address

Security

### Compliance Standards

SOC2, GDPR


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent CloudFront distributions from not having Geo Restriction enabled using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select "CloudFront" from the dropdown.

2. **Select the Distribution:**
   - In the CloudFront dashboard, you will see a list of your distributions.
   - Click on the ID of the distribution you want to configure.

3. **Edit Distribution Settings:**
   - In the distribution settings page, click on the "Behaviors" tab.
   - Select the behavior you want to modify (usually the default behavior) and click on the "Edit" button.

4. **Enable Geo Restriction:**
   - Scroll down to the "Restrictions" section.
   - Click on the "Edit" button next to "Geo Restriction".
   - Choose "Whitelist" or "Blacklist" based on your requirements.
   - Add the countries you want to allow or block.
   - Click on the "Save Changes" button to apply the settings.

By following these steps, you can ensure that Geo Restriction is enabled for your CloudFront distributions, helping to prevent unauthorized access from specific geographic locations.
</Accordion>

<Accordion title='Using CLI'>
To prevent CloudFront distributions from being misconfigured without Geo Restriction enabled using AWS CLI, follow these steps:

1. **List Existing CloudFront Distributions:**
   First, identify the CloudFront distribution you want to configure by listing all distributions.
   ```sh
   aws cloudfront list-distributions
   ```

2. **Get Distribution Configuration:**
   Retrieve the current configuration of the specific CloudFront distribution you want to modify. Replace `DISTRIBUTION_ID` with the actual ID of your distribution.
   ```sh
   aws cloudfront get-distribution-config --id DISTRIBUTION_ID
   ```

3. **Update Distribution Configuration:**
   Modify the distribution configuration to include Geo Restriction settings. Create a JSON file (e.g., `geo_restriction_config.json`) with the updated configuration. Here is an example of what the Geo Restriction part of the configuration might look like:
   ```json
   {
     "GeoRestriction": {
       "RestrictionType": "whitelist",  // or "blacklist"
       "Items": ["US", "CA"],  // List of country codes
       "Quantity": 2
     }
   }
   ```

4. **Apply the Updated Configuration:**
   Use the `update-distribution` command to apply the updated configuration. Ensure you include the `IfMatch` parameter with the ETag value obtained from the `get-distribution-config` command.
   ```sh
   aws cloudfront update-distribution --id DISTRIBUTION_ID --distribution-config file://geo_restriction_config.json --if-match ETag
   ```

By following these steps, you can ensure that Geo Restriction is enabled for your CloudFront distributions using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent CloudFront distributions from being created without Geo Restriction enabled using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure that Geo Restriction is enabled when creating a CloudFront distribution:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Create a CloudFront Distribution with Geo Restriction**:
   Use the Boto3 library to create a CloudFront distribution and specify the Geo Restriction settings. Below is a sample script to create a CloudFront distribution with Geo Restriction enabled:

   ```python
   import boto3

   # Initialize a session using Amazon CloudFront
   client = boto3.client('cloudfront')

   # Define the Geo Restriction settings
   geo_restriction = {
       'RestrictionType': 'whitelist',  # or 'blacklist'
       'Items': ['US', 'CA'],  # List of country codes to allow or deny
       'Quantity': 2
   }

   # Define the distribution configuration
   distribution_config = {
       'CallerReference': 'unique-string',
       'Origins': {
           'Quantity': 1,
           'Items': [
               {
                   'Id': 'origin-1',
                   'DomainName': 'example.com',
                   'OriginPath': '',
                   'CustomHeaders': {
                       'Quantity': 0
                   },
                   'S3OriginConfig': {
                       'OriginAccessIdentity': ''
                   }
               }
           ]
       },
       'DefaultCacheBehavior': {
           'TargetOriginId': 'origin-1',
           'ViewerProtocolPolicy': 'allow-all',
           'TrustedSigners': {
               'Enabled': False,
               'Quantity': 0
           },
           'ForwardedValues': {
               'QueryString': False,
               'Cookies': {
                   'Forward': 'none'
               },
               'Headers': {
                   'Quantity': 0
               },
               'QueryStringCacheKeys': {
                   'Quantity': 0
               }
           },
           'MinTTL': 0
       },
       'Comment': 'My distribution with Geo Restriction',
       'Enabled': True,
       'Restrictions': {
           'GeoRestriction': geo_restriction
       }
   }

   # Create the CloudFront distribution
   response = client.create_distribution(
       DistributionConfig=distribution_config
   )

   print(response)
   ```

3. **Update an Existing CloudFront Distribution to Enable Geo Restriction**:
   If you need to update an existing CloudFront distribution to enable Geo Restriction, you can use the following script:

   ```python
   import boto3

   # Initialize a session using Amazon CloudFront
   client = boto3.client('cloudfront')

   # Get the current distribution configuration
   distribution_id = 'your-distribution-id'
   response = client.get_distribution_config(Id=distribution_id)
   distribution_config = response['DistributionConfig']
   etag = response['ETag']

   # Update the Geo Restriction settings
   distribution_config['Restrictions'] = {
       'GeoRestriction': {
           'RestrictionType': 'whitelist',  # or 'blacklist'
           'Items': ['US', 'CA'],  # List of country codes to allow or deny
           'Quantity': 2
       }
   }

   # Update the distribution with the new configuration
   response = client.update_distribution(
       Id=distribution_id,
       DistributionConfig=distribution_config,
       IfMatch=etag
   )

   print(response)
   ```

4. **Automate the Check and Update Process**:
   You can automate the process of checking and updating CloudFront distributions to ensure Geo Restriction is always enabled. Below is a sample script to check all distributions and update those without Geo Restriction:

   ```python
   import boto3

   # Initialize a session using Amazon CloudFront
   client = boto3.client('cloudfront')

   # List all CloudFront distributions
   response = client.list_distributions()
   distributions = response['DistributionList']['Items']

   for distribution in distributions:
       distribution_id = distribution['Id']
       config_response = client.get_distribution_config(Id=distribution_id)
       distribution_config = config_response['DistributionConfig']
       etag = config_response['ETag']

       # Check if Geo Restriction is enabled
       if 'GeoRestriction' not in distribution_config['Restrictions']:
           # Update the Geo Restriction settings
           distribution_config['Restrictions'] = {
               'GeoRestriction': {
                   'RestrictionType': 'whitelist',  # or 'blacklist'
                   'Items': ['US', 'CA'],  # List of country codes to allow or deny
                   'Quantity': 2
               }
           }

           # Update the distribution with the new configuration
           update_response = client.update_distribution(
               Id=distribution_id,
               DistributionConfig=distribution_config,
               IfMatch=etag
           )

           print(f"Updated distribution {distribution_id} with Geo Restriction")
       else:
           print(f"Distribution {distribution_id} already has Geo Restriction enabled")
   ```

These steps and scripts will help you ensure that Geo Restriction is enabled for your CloudFront distributions using Python and Boto3.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, in the top pane, click on the ID of the distribution that you want to check.

3. In the distribution settings page, click on the "Restrictions" tab.

4. Under the Geo Restriction section, check if the "Enable Geo Restriction" option is enabled or not. If it's not enabled, then it's a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].Id' --output text
   ```
   This command will return a list of IDs for all the CloudFront distributions.

3. Get the details of each CloudFront distribution: For each ID returned in the previous step, run the following command to get the details of the distribution:

   ```
   aws cloudfront get-distribution --id <distribution-id>
   ```
   Replace `<distribution-id>` with the ID of the distribution you want to check. This command will return a JSON object with the details of the distribution.

4. Check for Geo Restriction: In the JSON object returned in the previous step, look for the `Restrictions` field. If the `GeoRestriction` field under `Restrictions` is not present or if the `RestrictionType` is not set to `whitelist` or `blacklist`, then the CloudFront distribution does not have Geo Restriction enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install and configure Boto3 to interact with AWS services. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials to allow Boto3 to interact with AWS services on your behalf. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID='your_access_key'
   AWS_SECRET_ACCESS_KEY='your_secret_key'
   ```

2. Import the necessary modules and create a CloudFront client:
   You need to import Boto3 and create a CloudFront client to interact with the CloudFront service.
   ```python
   import boto3

   # Create CloudFront client
   cloudfront = boto3.client('cloudfront')
   ```

3. List all CloudFront distributions and check for Geo Restriction:
   You can list all CloudFront distributions using the `list_distributions` method and then check if Geo Restriction is enabled for each distribution.
   ```python
   # List all distributions
   distributions = cloudfront.list_distributions()

   for distribution in distributions['DistributionList']['Items']:
       # Get the distribution config
       distribution_config = cloudfront.get_distribution_config(Id=distribution['Id'])

       # Check if Geo Restriction is enabled
       if 'Restrictions' in distribution_config and 'GeoRestriction' in distribution_config['Restrictions']:
           if distribution_config['Restrictions']['GeoRestriction']['RestrictionType'] != 'none':
               print(f"Geo Restriction is enabled for distribution {distribution['Id']}")
           else:
               print(f"Geo Restriction is not enabled for distribution {distribution['Id']}")
   ```

4. Interpret the results:
   The script will print out whether Geo Restriction is enabled for each CloudFront distribution. If Geo Restriction is not enabled for a distribution, it means that the distribution is misconfigured. You should enable Geo Restriction for all distributions to prevent users in specific geographic locations from accessing content that you're distributing through a CloudFront web distribution.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "CloudFront Distributions Should Have Geo Restriction Enabled" for AWS using AWS console, follow the below steps:

1. Log in to your AWS console.
2. Navigate to the CloudFront service.
3. Click on the name of the distribution that you want to remediate.
4. Click on the "Behaviors" tab.
5. Click on the "Create Behavior" button.
6. In the "Create Behavior" screen, scroll down to the "Restrict Viewer Access (Use Signed URLs or Signed Cookies)" section.
7. Click on the "Yes" radio button for "Restrict Viewer Access".
8. In the "Geo Restriction" section, click on the "Yes" radio button for "Restrict access to your content by country/region".
9. In the "Whitelist" section, select the countries/regions that you want to allow access to your content.
10. Click on the "Create" button to save the behavior.

Once completed, the CloudFront distribution will have geo restriction enabled.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of CloudFront distributions not having Geo Restriction enabled in AWS using AWS CLI, follow these steps:

1. Open your terminal and ensure you have AWS CLI installed and configured with the necessary permissions to modify CloudFront distributions.

2. Identify the CloudFront distribution that needs Geo Restriction enabled. You can use the following command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions
   ```

   This command will return a JSON object containing information about all the CloudFront distributions in your account.

3. Once you have identified the distribution that needs Geo Restriction enabled, you can use the following command to enable Geo Restriction:

   ```
   aws cloudfront update-distribution --id <distribution-id> --distribution-config '{"GeoRestriction":{"RestrictionType":"whitelist","Quantity":0}}'
   ```

   Replace `<distribution-id>` with the ID of the distribution that needs Geo Restriction enabled.

4. After running the above command, you should receive a JSON object containing information about the updated CloudFront distribution.

5. Verify that Geo Restriction has been enabled for the distribution by running the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   This command will return a JSON object containing the configuration of the specified CloudFront distribution. Verify that the `GeoRestriction` object is present and contains the correct configuration.

That's it! You have successfully remediated the misconfiguration of CloudFront distributions not having Geo Restriction enabled in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the CloudFront Distributions should have Geo Restriction enabled misconfiguration in AWS using Python, follow the below steps:

1. Import the required libraries:

```python
import boto3
```

2. Initialize AWS credentials:

```python
aws_access_key_id = 'YOUR_AWS_ACCESS_KEY_ID'
aws_secret_access_key = 'YOUR_AWS_SECRET_ACCESS_KEY'
region_name = 'YOUR_AWS_REGION_NAME'

session = boto3.Session(
    aws_access_key_id=aws_access_key_id,
    aws_secret_access_key=aws_secret_access_key,
    region_name=region_name
)

cloudfront = session.client('cloudfront')
```

3. Get the list of CloudFront distributions:

```python
distributions = cloudfront.list_distributions()
```

4. Loop through the distributions and check if Geo Restriction is enabled:

```python
for distribution in distributions['DistributionList']['Items']:
    distribution_id = distribution['Id']
    distribution_config = cloudfront.get_distribution_config(Id=distribution_id)
    geo_restriction = distribution_config['DistributionConfig']['Restrictions']['GeoRestriction']['RestrictionType']
    if geo_restriction != 'whitelist':
        # Geo Restriction is not enabled, remediate the misconfiguration
```

5. Remediate the misconfiguration by enabling Geo Restriction:

```python
distribution_config['DistributionConfig']['Restrictions']['GeoRestriction']['RestrictionType'] = 'whitelist'
cloudfront.update_distribution(
    DistributionConfig=distribution_config['DistributionConfig'],
    Id=distribution_id,
    IfMatch=distribution_config['ETag']
)
```

Note: This code assumes that you have the necessary AWS credentials and permissions to access and modify CloudFront distributions.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html) 

