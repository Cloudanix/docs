---
slug: cloudfront_geo_restriction
title: CloudFront Distributions Should Have Geo Restriction Enabled
sidebar_label: CloudFront Distributions Should Have Geo Restriction Enabled
---

### More Info:

Geo restriction should be enabled for your Amazon CloudFront CDN distribution to whitelist or blacklist a country in order to allow or restrict users in specific locations from accessing web application content.

### Risk Level

Low

### Address

Security

### Compliance Standards

SOC2, GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, click on the ID of the distribution that you want to check.

3. In the distribution settings, click on the "Restrictions" tab.

4. Under the "Geo Restriction" section, check if the "Restriction Type" is set to "None". If it is, then Geo Restriction is not enabled for this distribution. If it is set to "Blacklist" or "Whitelist", then Geo Restriction is enabled.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all CloudFront distributions: Use the following AWS CLI command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].Id' --output text
   ```
   This command will return a list of IDs for all the CloudFront distributions.

3. Get the details of each CloudFront distribution: For each ID returned by the previous command, use the following AWS CLI command to get the details of the CloudFront distribution:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```
   Replace `<distribution-id>` with the ID of the CloudFront distribution. This command will return the configuration details of the specified CloudFront distribution.

4. Check for Geo Restriction: In the output of the previous command, look for the `Restrictions` field. If the `GeoRestriction` field under `Restrictions` is not present or if the `RestrictionType` is not set to `whitelist` or `blacklist`, then the CloudFront distribution does not have Geo Restriction enabled.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   After installing Boto3, you need to configure it with your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. Import the necessary modules and create a CloudFront client:
   You need to import Boto3 and create a CloudFront client to interact with the CloudFront service.
   ```python
   import boto3

   # Create CloudFront client
   cloudfront = boto3.client('cloudfront')
   ```

3. List all CloudFront distributions and check for Geo Restriction:
   You can use the `list_distributions` method to get a list of all CloudFront distributions. Then, for each distribution, you can check if Geo Restriction is enabled.
   ```python
   # List distributions
   distributions = cloudfront.list_distributions()

   for distribution in distributions['DistributionList']['Items']:
       # Get the distribution config
       distribution_config = cloudfront.get_distribution_config(Id=distribution['Id'])

       # Check if Geo Restriction is enabled
       if 'Restrictions' in distribution_config and 'GeoRestriction' in distribution_config['Restrictions']:
           geo_restriction = distribution_config['Restrictions']['GeoRestriction']
           if geo_restriction['RestrictionType'] == 'none':
               print(f"Distribution {distribution['Id']} does not have Geo Restriction enabled.")
   ```

4. Run the script:
   Finally, you can run the script to check all your CloudFront distributions for Geo Restriction. The script will print out the IDs of the distributions that do not have Geo Restriction enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "CloudFront Distributions Should Have Geo Restriction Enabled" for AWS using AWS console, follow the below steps:

1. Log in to your AWS console.
2. Navigate to the CloudFront service.
3. Click on the name of the distribution that you want to remediate.
4. Click on the "Behaviors" tab.
5. Click on the "Create Behavior" button.
6. In the "Create Behavior" screen, scroll down to the "Restrict Viewer Access (Use Signed URLs or Signed Cookies)" section.
7. Click on the "Yes" radio button for "Restrict Viewer Access".
8. In the "Geo Restriction" section, click on the "Yes" radio button for "Restrict access to your content by country/region".
9. In the "Whitelist" section, select the countries/regions that you want to allow access to your content.
10. Click on the "Create" button to save the behavior.

Once completed, the CloudFront distribution will have geo restriction enabled.

#### Using CLI

To remediate the misconfiguration of CloudFront distributions not having Geo Restriction enabled in AWS using AWS CLI, follow these steps:

1. Open your terminal and ensure you have AWS CLI installed and configured with the necessary permissions to modify CloudFront distributions.

2. Identify the CloudFront distribution that needs Geo Restriction enabled. You can use the following command to list all the CloudFront distributions in your AWS account:

   ```
   aws cloudfront list-distributions
   ```

   This command will return a JSON object containing information about all the CloudFront distributions in your account.

3. Once you have identified the distribution that needs Geo Restriction enabled, you can use the following command to enable Geo Restriction:

   ```
   aws cloudfront update-distribution --id <distribution-id> --distribution-config '{"GeoRestriction":{"RestrictionType":"whitelist","Quantity":0}}'
   ```

   Replace `<distribution-id>` with the ID of the distribution that needs Geo Restriction enabled.

4. After running the above command, you should receive a JSON object containing information about the updated CloudFront distribution.

5. Verify that Geo Restriction has been enabled for the distribution by running the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   This command will return a JSON object containing the configuration of the specified CloudFront distribution. Verify that the `GeoRestriction` object is present and contains the correct configuration.

That's it! You have successfully remediated the misconfiguration of CloudFront distributions not having Geo Restriction enabled in AWS using AWS CLI.

#### Using Python

To remediate the CloudFront Distributions should have Geo Restriction enabled misconfiguration in AWS using Python, follow the below steps:

1. Import the required libraries:

```python
import boto3
```

2. Initialize AWS credentials:

```python
aws_access_key_id = 'YOUR_AWS_ACCESS_KEY_ID'
aws_secret_access_key = 'YOUR_AWS_SECRET_ACCESS_KEY'
region_name = 'YOUR_AWS_REGION_NAME'

session = boto3.Session(
    aws_access_key_id=aws_access_key_id,
    aws_secret_access_key=aws_secret_access_key,
    region_name=region_name
)

cloudfront = session.client('cloudfront')
```

3. Get the list of CloudFront distributions:

```python
distributions = cloudfront.list_distributions()
```

4. Loop through the distributions and check if Geo Restriction is enabled:

```python
for distribution in distributions['DistributionList']['Items']:
    distribution_id = distribution['Id']
    distribution_config = cloudfront.get_distribution_config(Id=distribution_id)
    geo_restriction = distribution_config['DistributionConfig']['Restrictions']['GeoRestriction']['RestrictionType']
    if geo_restriction != 'whitelist':
        # Geo Restriction is not enabled, remediate the misconfiguration
```

5. Remediate the misconfiguration by enabling Geo Restriction:

```python
distribution_config['DistributionConfig']['Restrictions']['GeoRestriction']['RestrictionType'] = 'whitelist'
cloudfront.update_distribution(
    DistributionConfig=distribution_config['DistributionConfig'],
    Id=distribution_id,
    IfMatch=distribution_config['ETag']
)
```

Note: This code assumes that you have the necessary AWS credentials and permissions to access and modify CloudFront distributions.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html) 


</Tab>
</Tabs>