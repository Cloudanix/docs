
### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having a custom SSL certificate set for Amazon CloudFront distributions using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select "CloudFront" from the dropdown list.
   - This will take you to the CloudFront dashboard.

2. **Select the Distribution:**
   - In the CloudFront dashboard, you will see a list of your distributions.
   - Click on the ID of the distribution for which you want to set a custom SSL certificate.

3. **Edit Distribution Settings:**
   - In the distribution settings page, click on the "Edit" button in the "General" tab.

4. **Set Custom SSL Certificate:**
   - Scroll down to the "SSL Certificate" section.
   - Select the option "Custom SSL Certificate (example.com)".
   - From the dropdown menu, choose the custom SSL certificate you have uploaded to AWS Certificate Manager (ACM) or the IAM certificate store.
   - Click on the "Yes, Edit" button to save the changes.

By following these steps, you ensure that your CloudFront distribution uses a custom SSL certificate, enhancing the security of your content delivery.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of not having a custom SSL certificate set for Amazon CloudFront distributions using AWS CLI, follow these steps:

1. **Create or Import an SSL Certificate in AWS Certificate Manager (ACM):**
   Ensure you have a custom SSL certificate in ACM. If you don't have one, you can either import an existing certificate or request a new one.

   ```sh
   # To request a new certificate
   aws acm request-certificate --domain-name example.com --validation-method DNS

   # To import an existing certificate
   aws acm import-certificate --certificate file://path/to/certificate.pem --private-key file://path/to/privatekey.pem --certificate-chain file://path/to/certificatechain.pem
   ```

2. **Retrieve the Certificate ARN:**
   After creating or importing the certificate, retrieve its Amazon Resource Name (ARN).

   ```sh
   aws acm list-certificates
   ```

   Note the ARN of the certificate you want to use.

3. **Create or Update the CloudFront Distribution:**
   When creating or updating a CloudFront distribution, specify the custom SSL certificate ARN.

   ```sh
   aws cloudfront create-distribution --distribution-config file://distribution-config.json
   ```

   Ensure your `distribution-config.json` includes the `ViewerCertificate` configuration with the `ACMCertificateArn` field set to your certificate ARN.

   Example `distribution-config.json` snippet:
   ```json
   {
     "ViewerCertificate": {
       "ACMCertificateArn": "arn:aws:acm:region:account-id:certificate/certificate-id",
       "SSLSupportMethod": "sni-only",
       "MinimumProtocolVersion": "TLSv1.2_2018"
     },
     ...
   }
   ```

4. **Verify the Configuration:**
   After creating or updating the distribution, verify that the custom SSL certificate is correctly associated with the CloudFront distribution.

   ```sh
   aws cloudfront get-distribution --id YOUR_DISTRIBUTION_ID
   ```

   Check the `ViewerCertificate` section in the output to ensure the `ACMCertificateArn` is correctly set.

By following these steps, you can ensure that a custom SSL certificate is set for your Amazon CloudFront distributions using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not having a custom SSL certificate set for Amazon CloudFront distributions using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure that a custom SSL certificate is set for your CloudFront distributions:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Python Script to Check and Update CloudFront Distribution**:
   Use the following Python script to check if a custom SSL certificate is set for your CloudFront distributions and update it if necessary.

   ```python
   import boto3

   # Initialize a session using Amazon CloudFront
   client = boto3.client('cloudfront')

   # Function to update CloudFront distribution with custom SSL certificate
   def update_distribution_with_custom_ssl(distribution_id, acm_certificate_arn):
       # Get the current distribution configuration
       response = client.get_distribution_config(Id=distribution_id)
       distribution_config = response['DistributionConfig']
       etag = response['ETag']

       # Check if the custom SSL certificate is already set
       if 'ViewerCertificate' in distribution_config:
           viewer_certificate = distribution_config['ViewerCertificate']
           if viewer_certificate.get('ACMCertificateArn') == acm_certificate_arn:
               print(f"Custom SSL certificate already set for distribution {distribution_id}")
               return
       else:
           distribution_config['ViewerCertificate'] = {}

       # Update the ViewerCertificate with the custom SSL certificate
       distribution_config['ViewerCertificate'].update({
           'ACMCertificateArn': acm_certificate_arn,
           'SSLSupportMethod': 'sni-only',
           'MinimumProtocolVersion': 'TLSv1.2_2018'
       })

       # Update the distribution with the new configuration
       client.update_distribution(
           DistributionConfig=distribution_config,
           Id=distribution_id,
           IfMatch=etag
       )
       print(f"Custom SSL certificate set for distribution {distribution_id}")

   # Example usage
   distribution_id = 'YOUR_DISTRIBUTION_ID'
   acm_certificate_arn = 'YOUR_ACM_CERTIFICATE_ARN'
   update_distribution_with_custom_ssl(distribution_id, acm_certificate_arn)
   ```

4. **Run the Script**:
   Execute the script to ensure that your CloudFront distributions have the custom SSL certificate set. Replace `YOUR_DISTRIBUTION_ID` and `YOUR_ACM_CERTIFICATE_ARN` with your actual CloudFront distribution ID and ACM certificate ARN.

By following these steps, you can programmatically ensure that your CloudFront distributions are configured with a custom SSL certificate, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudFront console at https://console.aws.amazon.com/cloudfront/.

2. In the CloudFront console, in the top navigation pane, click on "Distributions".

3. In the "Distributions" panel, you will see a list of all your CloudFront distributions. Click on the ID of the distribution you want to check.

4. In the distribution settings, click on the "General" tab. Look for the "SSL Certificate" section. If the "Custom SSL Certificate (example.com)" option is selected, it means a custom SSL certificate is set for the distribution. If the "Default CloudFront Certificate (*.cloudfront.net)" option is selected, it means a custom SSL certificate is not set.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the CloudFront distributions.

2. Once the AWS CLI is set up, you can list all the CloudFront distributions using the following command:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].{ID:Id,Domain:DomainName}'
   ```
   This command will return a list of all the CloudFront distributions along with their ID and domain name.

3. To check the SSL certificate of a specific CloudFront distribution, you can use the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```
   Replace `<distribution-id>` with the ID of the distribution you want to check. This command will return the configuration of the specified CloudFront distribution.

4. In the output of the above command, look for the `ViewerCertificate` field. If the `ACMCertificateArn` field is present and has a value, it means that a custom SSL certificate is set for the distribution. If the `ACMCertificateArn` field is not present or does not have a value, it means that a custom SSL certificate is not set for the distribution.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): Before you can start writing Python scripts to manage AWS resources, you need to set up authentication credentials for your AWS account. You can do this by installing AWS CLI and configuring it with your access key ID and secret access key.

   ```bash
   pip install awscli
   aws configure
   ```

2. Import the necessary modules and create a session: In your Python script, you need to import the Boto3 module and create a session using your credentials.

   ```python
   import boto3
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. List all CloudFront distributions and check for custom SSL certificates: You can use the `list_distributions` method to get a list of all CloudFront distributions. Then, for each distribution, you can check if a custom SSL certificate is set by checking the `ViewerCertificate` attribute.

   ```python
   client = session.client('cloudfront')
   distributions = client.list_distributions()
   for distribution in distributions['DistributionList']['Items']:
       if 'ViewerCertificate' in distribution and 'ACMCertificateArn' in distribution['ViewerCertificate']:
           print(f"Custom SSL certificate is set for distribution {distribution['Id']}")
       else:
           print(f"Custom SSL certificate is not set for distribution {distribution['Id']}")
   ```

4. Run the script: Finally, you can run the script to check if a custom SSL certificate is set for all your CloudFront distributions. If a distribution does not have a custom SSL certificate, the script will print a message indicating this.

   ```bash
   python check_ssl.py
   ```

This script will print out the IDs of all distributions that do not have a custom SSL certificate set. This can help you identify any misconfigurations in your CloudFront distributions.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution in AWS, you can follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console:**
   - Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to Amazon CloudFront service:**
   - In the AWS Management Console, search for "CloudFront" in the search bar or go to the "Networking & Content Delivery" section and click on "CloudFront".

3. **Select the CloudFront distribution:**
   - From the list of CloudFront distributions, select the distribution for which you want to set a custom SSL certificate.

4. **Edit the distribution settings:**
   - Click on the distribution ID or domain name to open the distribution settings.

5. **Go to the "General" tab:**
   - In the distribution settings, navigate to the "General" tab where you can view the basic information about the distribution.

6. **Edit the SSL certificate settings:**
   - Scroll down to the "SSL Certificate" section and click on the "Edit" button next to the "Alternate Domain Names (CNAMEs)" field.

7. **Choose a custom SSL certificate:**
   - In the "Custom SSL Certificate" section, select "Custom SSL Certificate" from the drop-down menu.

8. **Select or import a custom SSL certificate:**
   - If you have already uploaded your SSL certificate to AWS Certificate Manager (ACM), select the appropriate certificate from the list.
   - If you haven't uploaded the certificate to ACM, you can click on the "Request or Import a Certificate with ACM" link to upload a new SSL certificate.

9. **Save the changes:**
   - After selecting the custom SSL certificate, click on the "Yes, Edit" button to save the changes.

10. **Wait for the distribution to deploy the changes:**
    - It may take some time for the CloudFront distribution to deploy the changes and propagate them across the edge locations.

By following these steps, you can successfully remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution using AWS CLI, you can follow these step-by-step instructions:

1. **Generate or Import an SSL Certificate**:
   - First, you need to have an SSL certificate ready. You can either import a certificate into AWS Certificate Manager (ACM) or use a certificate from a third-party Certificate Authority (CA).

2. **Get the ARN of the SSL Certificate**:
   - Use the AWS CLI command to list the SSL certificates in ACM:
     ```
     aws acm list-certificates
     ```
   - Note down the ARN of the SSL certificate you want to use for CloudFront.

3. **Update the CloudFront Distribution**:
   - Use the AWS CLI command to update the CloudFront distribution with the custom SSL certificate:
     ```
     aws cloudfront update-distribution --id YOUR_DISTRIBUTION_ID --default-cache-behavior ViewerProtocolPolicy=https-only,SSLSupportMethod=sni-only,MinimumProtocolVersion=TLSv1.2_2021,ACMCertificateArn=YOUR_SSL_CERTIFICATE_ARN
     ```
     - Replace `YOUR_DISTRIBUTION_ID` with the ID of your CloudFront distribution.
     - Replace `YOUR_SSL_CERTIFICATE_ARN` with the ARN of the SSL certificate you noted down earlier.

4. **Wait for the Distribution to Deploy**:
   - After updating the distribution, it may take some time for the changes to propagate. You can check the status of the distribution deployment using the following command:
     ```
     aws cloudfront get-distribution --id YOUR_DISTRIBUTION_ID --query 'Distribution.DistributionConfig.Enabled'
     ```
   - Wait until the status changes to `true`.

5. **Verify the SSL Certificate**:
   - Once the distribution is deployed, you can verify that the custom SSL certificate is set by accessing your CloudFront distribution using HTTPS and checking the SSL certificate details in the browser.

By following these steps, you can remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution using Python, you can follow these steps:

1. **Import necessary libraries**: Make sure you have the AWS SDK for Python (Boto3) installed. You can install it using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS credentials**: Ensure that your AWS credentials are properly configured on your system. You can set them up using the AWS CLI or by setting environment variables.

3. **Write Python script**:
   Here is a sample Python script to update the CloudFront distribution with a custom SSL certificate:
   ```python
   import boto3

   # Initialize the CloudFront client
   client = boto3.client('cloudfront')

   # Specify the CloudFront distribution ID
   distribution_id = 'YOUR_DISTRIBUTION_ID'

   # Specify the ARN of the custom SSL certificate
   certificate_arn = 'YOUR_CERTIFICATE_ARN'

   # Update the CloudFront distribution with the custom SSL certificate
   response = client.update_distribution(
       DistributionConfig={
           'CallerReference': 'YOUR_CALLER_REFERENCE',
           'Aliases': {
               'Quantity': 1,
               'Items': ['YOUR_DOMAIN_NAME']
           },
           'DefaultCacheBehavior': {
               'ViewerProtocolPolicy': 'redirect-to-https',
               'MinTTL': 0,
               'TargetOriginId': 'YOUR_ORIGIN_ID'
           },
           'ViewerCertificate': {
               'CloudFrontDefaultCertificate': False,
               'ACMCertificateArn': certificate_arn,
               'SSLSupportMethod': 'sni-only'
           },
           'Comment': 'YOUR_COMMENT',
           'Enabled': True,
           'DefaultRootObject': 'index.html',
           'Origins': {
               'Quantity': 1,
               'Items': [
                   {
                       'Id': 'YOUR_ORIGIN_ID',
                       'DomainName': 'YOUR_ORIGIN_DOMAIN_NAME',
                       'CustomOriginConfig': {
                           'HTTPPort': 80,
                           'HTTPSPort': 443,
                           'OriginProtocolPolicy': 'https-only'
                       }
                   }
               ]
           },
           'PriceClass': 'PriceClass_All',
           'DefaultRootObject': 'index.html'
       },
       Id=distribution_id,
       IfMatch='YOUR_DISTRIBUTION_ETAG'
   )

   print(response)
   ```

4. **Replace placeholders**:
   - Replace `YOUR_DISTRIBUTION_ID` with the actual CloudFront distribution ID.
   - Replace `YOUR_CERTIFICATE_ARN` with the ARN of your custom SSL certificate.
   - Replace other placeholders like `YOUR_DOMAIN_NAME`, `YOUR_ORIGIN_ID`, `YOUR_ORIGIN_DOMAIN_NAME`, `YOUR_CALLER_REFERENCE`, `YOUR_COMMENT`, and `YOUR_DISTRIBUTION_ETAG` with actual values.

5. **Run the script**: Save the script to a file (e.g., `update_cloudfront_ssl.py`) and run it using Python:
   ```
   python update_cloudfront_ssl.py
   ```

By following these steps, you can remediate the misconfiguration of not having a custom SSL certificate set for an Amazon CloudFront distribution using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
