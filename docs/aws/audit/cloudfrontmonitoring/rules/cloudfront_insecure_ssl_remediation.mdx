
### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent CloudFront distributions from using insecure SSL protocols in AWS CloudFront using the AWS Management Console, follow these steps:

1. **Navigate to CloudFront Distributions:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudFront" and select it from the dropdown list.
   - In the CloudFront dashboard, click on "Distributions" to view your list of distributions.

2. **Select the Distribution:**
   - From the list of distributions, click on the ID of the distribution you want to configure. This will take you to the distribution's settings page.

3. **Edit SSL/TLS Settings:**
   - In the distribution settings page, click on the "Behaviors" tab.
   - Select the behavior you want to modify (usually the default behavior) and click on the "Edit" button.

4. **Configure SSL Protocols:**
   - In the "SSL/TLS" section, ensure that the "Viewer Protocol Policy" is set to "Redirect HTTP to HTTPS" or "HTTPS Only".
   - Under "Minimum Protocol Version", select a secure protocol version such as "TLSv1.2" or higher from the dropdown menu.
   - Click on the "Yes, Edit" button to save your changes.

By following these steps, you can ensure that your CloudFront distributions are configured to use secure SSL protocols, thereby preventing the use of insecure protocols.
</Accordion>

<Accordion title='Using CLI'>
To prevent CloudFront distributions from using insecure SSL protocols using AWS CLI, follow these steps:

1. **List CloudFront Distributions:**
   First, identify the CloudFront distribution you want to update by listing all distributions.
   ```sh
   aws cloudfront list-distributions
   ```

2. **Get Distribution Configuration:**
   Retrieve the current configuration of the specific CloudFront distribution. Replace `<distribution-id>` with your actual distribution ID.
   ```sh
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

3. **Update SSL Protocols:**
   Modify the distribution configuration to use secure SSL protocols only. You need to update the `ViewerCertificate` section to include only secure protocols like TLSv1.2_2018. Save the configuration JSON to a file (e.g., `distribution-config.json`), and ensure you include the `IfMatch` header with the ETag value from the previous step.
   ```sh
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://distribution-config.json --if-match <ETag>
   ```

4. **Verify the Update:**
   Confirm that the distribution has been updated correctly by describing the distribution again.
   ```sh
   aws cloudfront get-distribution --id <distribution-id>
   ```

By following these steps, you ensure that your CloudFront distributions are configured to use secure SSL protocols, thereby preventing the use of insecure ones.
</Accordion>

<Accordion title='Using Python'>
To prevent CloudFront distributions from using insecure SSL protocols using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for CloudFront.
   ```python
   import boto3

   client = boto3.client('cloudfront')
   ```

3. **List CloudFront Distributions**:
   Retrieve the list of CloudFront distributions to identify which ones need to be updated.
   ```python
   distributions = client.list_distributions()
   ```

4. **Update SSL Protocols**:
   Iterate through the distributions and update the SSL protocols to ensure only secure protocols are used.
   ```python
   for distribution in distributions['DistributionList']['Items']:
       distribution_id = distribution['Id']
       config = client.get_distribution_config(Id=distribution_id)
       etag = config['ETag']
       distribution_config = config['DistributionConfig']

       # Update the SSL protocols
       distribution_config['ViewerCertificate']['MinimumProtocolVersion'] = 'TLSv1.2_2018'

       # Update the distribution with the new configuration
       client.update_distribution(
           DistributionConfig=distribution_config,
           Id=distribution_id,
           IfMatch=etag
       )
   ```

This script ensures that all CloudFront distributions are configured to use at least TLSv1.2, which is a secure SSL protocol. Make sure to run this script in an environment with appropriate AWS credentials and permissions to modify CloudFront distributions.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CloudFront service.

2. In the CloudFront dashboard, you will see a list of your distributions. Click on the ID of the distribution you want to check.

3. In the distribution settings, click on the "Behaviors" tab. This will show you the list of behaviors for your distribution.

4. Click on the behavior you want to check and then click on the "Edit" button. In the "SSL Protocol" section, you can see the SSL protocols that are being used. If you see SSLv3 or TLSv1 in the list, then the distribution is using insecure SSL protocols.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List CloudFront Distributions: Use the AWS CLI command "list-distributions" to get a list of all the CloudFront distributions in your AWS account. The command is as follows:
   ```
   aws cloudfront list-distributions
   ```
   This command will return a JSON output with details of all the CloudFront distributions.

3. Extract Distribution Configurations: For each distribution in the list, use the "get-distribution-config" command to get the configuration details. Replace "distribution_id" with the ID of the distribution you want to check.
   ```
   aws cloudfront get-distribution-config --id distribution_id
   ```
   This command will return a JSON output with the configuration details of the specified CloudFront distribution.

4. Check SSL Protocols: In the JSON output from the previous step, look for the "ViewerCertificate" section and then the "MinimumProtocolVersion" field. This field indicates the minimum SSL/TLS protocol version that the distribution uses. If the value of this field is "SSLv3" or "TLSv1", then the distribution is using insecure SSL protocols.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing your Python script, you need to install the AWS SDK for Python (Boto3). You can do this by running the command `pip install boto3` in your terminal.

2. Import the necessary libraries and initialize the CloudFront client: In your Python script, you need to import the Boto3 library and initialize the CloudFront client. Here's how you can do it:

```python
import boto3

# Create a CloudFront client
cf = boto3.client('cloudfront')
```

3. Get the list of CloudFront distributions and check the SSL protocols: You can use the `list_distributions()` method to get the list of all CloudFront distributions. Then, you can iterate over each distribution and check the SSL protocols. If any distribution is using insecure SSL protocols, print a message.

```python
# Get the list of all distributions
distributions = cf.list_distributions()

# Iterate over each distribution
for distribution in distributions['DistributionList']['Items']:
    # Get the viewer certificate information
    viewer_certificate = distribution['ViewerCertificate']

    # Check if the distribution is using insecure SSL protocols
    if 'SSLSupportMethod' in viewer_certificate and viewer_certificate['SSLSupportMethod'] == 'sni-only' and 'MinimumProtocolVersion' in viewer_certificate and viewer_certificate['MinimumProtocolVersion'] in ['SSLv3', 'TLSv1', 'TLSv1_2016', 'TLSv1.1_2016']:
        print(f"Distribution {distribution['Id']} is using insecure SSL protocols.")
```

4. Run the Python script: Save your Python script and run it in your terminal using the command `python script_name.py`. If there are any CloudFront distributions using insecure SSL protocols, they will be printed in the terminal.

Please note that you need to configure your AWS credentials before running the script. You can do this by setting the `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and `AWS_REGION` environment variables, or by using the AWS CLI `configure` command.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "CloudFront Distributions Should Not Use Insecure SSL Protocols" in AWS using AWS console, follow the below steps:

1. Login to your AWS console.
2. Go to the CloudFront service.
3. Select the distribution which is using insecure SSL protocols.
4. Click on the "Edit" button.
5. Scroll down to the "SSL Certificate" section.
6. In the "Minimum SSL Protocol Version" dropdown, select "TLSv1.2_2018".
7. Click on the "Yes, Edit" button to save the changes.

By doing this, you have successfully remediated the misconfiguration "CloudFront Distributions Should Not Use Insecure SSL Protocols" in AWS using AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the CloudFront Distributions Should Not Use Insecure SSL Protocols misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. Open your terminal and install AWS CLI if it is not installed already.

2. Run the following command to update the CloudFront distribution to use only secure SSL protocols:

```
aws cloudfront update-distribution --id <distribution-id> --viewer-protocol-policy https-only
```

Note: Replace `<distribution-id>` with the ID of the CloudFront distribution that you want to update.

3. After running the above command, the CloudFront distribution will be updated to use only secure SSL protocols. 

4. Verify the changes by checking the SSL protocols used by the CloudFront distribution using the following command:

```
aws cloudfront get-distribution-config --id <distribution-id> --query "DistributionConfig.ViewerCertificate.MinimumProtocolVersion"
```

Note: Replace `<distribution-id>` with the ID of the CloudFront distribution that you updated.

5. The output of the above command should show that the minimum SSL protocol version is TLSv1.1 or higher. 

By following these steps, you can remediate the CloudFront Distributions Should Not Use Insecure SSL Protocols misconfiguration in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of CloudFront distributions using insecure SSL protocols in AWS using Python, you can follow the below steps:

1. Import the required AWS modules and libraries in your Python script:

```
import boto3
from botocore.exceptions import ClientError
```

2. Create an AWS client for CloudFront using the boto3 library:

```
cloudfront_client = boto3.client('cloudfront')
```

3. Get a list of all the CloudFront distributions using the `list_distributions` method:

```
response = cloudfront_client.list_distributions()
```

4. Loop through the list of CloudFront distributions and check if they are using insecure SSL protocols. You can do this by checking the value of the `MinimumProtocolVersion` parameter. If it is set to `SSLv3` or `TLSv1`, then it is using an insecure SSL protocol.

```
for distribution in response['DistributionList']['Items']:
    if distribution['ViewerCertificate']['MinimumProtocolVersion'] in ['SSLv3', 'TLSv1']:
        # Remediation steps go here
```

5. To remediate the misconfiguration, you need to update the CloudFront distribution with a secure SSL protocol. You can do this by updating the `ViewerCertificate` parameter with a new value for `MinimumProtocolVersion`. For example, to set it to `TLSv1.2_2018`, you can use the `update_distribution` method:

```
distribution_id = distribution['Id']
etag = distribution['ETag']
viewer_certificate = {
    'CloudFrontDefaultCertificate': False,
    'MinimumProtocolVersion': 'TLSv1.2_2018'
}
try:
    cloudfront_client.update_distribution(
        DistributionConfig={
            'ViewerCertificate': viewer_certificate
        },
        Id=distribution_id,
        IfMatch=etag
    )
    print(f"Successfully updated CloudFront distribution {distribution_id}")
except ClientError as e:
    print(f"Error updating CloudFront distribution {distribution_id}: {e}")
```

6. Finally, run the Python script to remediate the misconfiguration for all the CloudFront distributions using insecure SSL protocols.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
