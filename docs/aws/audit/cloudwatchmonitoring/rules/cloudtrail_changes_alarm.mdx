---
slug: cloudtrail_changes_alarm
title: CloudTrail Changes Alarm
sidebar_label: CloudTrail Changes Alarm
---

### More Info:

Aall AWS CloudTrail configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAWS, CBP, SOC2, HIPAA, ISO27001, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Alarms". 

3. In the "Alarms" dashboard, look for the alarm that monitors CloudTrail changes. This alarm is typically named something like "CloudTrail-Changes-Alarm". 

4. Check the state of the alarm. If the state is "ALARM", it means that changes have been detected in CloudTrail. If the state is "OK", it means that no changes have been detected. If the state is "INSUFFICIENT_DATA", it means that the alarm has not had enough data to determine the state.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List Existing CloudWatch Alarms**: To check if a CloudTrail Changes alarm exists in CloudWatch, you can use the `describe-alarms` command. This command lists all the alarms that are currently set up in your AWS account. The command is as follows:

    ```
    aws cloudwatch describe-alarms
    ```

    This command will return a list of all the alarms, including their names, states, and other information.

3. **Filter CloudTrail Changes Alarm**: Since the `describe-alarms` command can return a lot of data, you might want to filter the results to only show the CloudTrail Changes alarm. You can do this by using the `--alarm-names` option followed by the name of the alarm. The command is as follows:

    ```
    aws cloudwatch describe-alarms --alarm-names "Your CloudTrail Changes Alarm Name"
    ```

    Replace "Your CloudTrail Changes Alarm Name" with the actual name of your CloudTrail Changes alarm.

4. **Check Alarm State**: The output of the `describe-alarms` command includes a field called `StateValue`. This field shows the current state of the alarm. If the state is `ALARM`, it means that the alarm condition is met. If the state is `INSUFFICIENT_DATA`, it means that the alarm has started but the metrics are not enough to determine the state. If the state is `OK`, it means that the alarm condition is not met.

#### Using Python

1. **Install Boto3**: Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```python
   pip install boto3
   ```

2. **Configure AWS Credentials**: Before you can begin to use the Boto3 SDK with your AWS services, you need to set up authentication credentials for your AWS account using either the AWS CLI or by creating the credentials file yourself. The default location for the file is `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. **Create a Python Script to Check CloudTrail Changes Alarm in Cloud Watch**: You can use the Boto3 SDK to interact with AWS services. Here's a simple script that lists all the CloudWatch alarms:

   ```python
   import boto3

   def list_alarms():
       client = boto3.client('cloudwatch')
       response = client.describe_alarms()
       return response['MetricAlarms']

   alarms = list_alarms()
   for alarm in alarms:
       print(alarm['AlarmName'])
   ```

4. **Check for CloudTrail Changes Alarm**: Now, you can modify the script to check for a specific alarm related to CloudTrail changes. You can do this by checking the `AlarmName` or `AlarmDescription` of each alarm:

   ```python
   import boto3

   def check_cloudtrail_changes_alarm():
       client = boto3.client('cloudwatch')
       response = client.describe_alarms()
       for alarm in response['MetricAlarms']:
           if 'CloudTrail' in alarm['AlarmName']:
               return True
       return False

   if check_cloudtrail_changes_alarm():
       print("CloudTrail changes alarm exists.")
   else:
       print("CloudTrail changes alarm does not exist.")
   ```

This script will print "CloudTrail changes alarm exists." if there is an alarm with 'CloudTrail' in its name, and "CloudTrail changes alarm does not exist." otherwise.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step-by-step instructions to remediate the CloudTrail Changes Alarm misconfiguration in AWS using the AWS console:

1. Login to your AWS account and navigate to the CloudTrail service.

2. Click on the "Trails" option in the left-hand menu and select the trail that you want to remediate.

3. Click on the "Edit" button at the top of the page.

4. Scroll down to the "CloudWatch Logs" section and click on the "Configure" button.

5. In the "Configure CloudWatch Logs" window, select the "Enable CloudWatch Logs" option.

6. Choose an existing CloudWatch log group or create a new one.

7. Click on the "Save" button to save the changes.

8. Navigate to the CloudWatch service in the AWS console.

9. Click on the "Alarms" option in the left-hand menu and select the alarm that you want to remediate.

10. Click on the "Actions" dropdown menu and select "Delete Alarm" to delete the alarm.

11. Click on the "Delete" button to confirm the deletion.

That's it! You have successfully remediated the CloudTrail Changes Alarm misconfiguration in AWS using the AWS console.

#### Using CLI

The CloudTrail Changes Alarm is triggered when there is a change made to CloudTrail, such as changes to the S3 bucket where the logs are stored or changes to the CloudTrail configuration. Here are the steps to remediate this issue for AWS using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Check the current status of the CloudTrail Changes Alarm by running the following command:

   ```
   aws cloudwatch describe-alarms --alarm-names CloudTrailChangesAlarm
   ```

   This command will return the current configuration of the CloudTrail Changes Alarm.

3. Disable the CloudTrail Changes Alarm by running the following command:

   ```
   aws cloudwatch disable-alarm-actions --alarm-names CloudTrailChangesAlarm
   ```

   This command will disable the actions that are triggered when the CloudTrail Changes Alarm is triggered.

4. Verify that the CloudTrail Changes Alarm has been disabled by running the following command:

   ```
   aws cloudwatch describe-alarms --alarm-names CloudTrailChangesAlarm
   ```

   This command should return a status of "OK" for the CloudTrail Changes Alarm, indicating that it has been successfully disabled.

5. If necessary, update the CloudTrail configuration to ensure that the logs are stored in a secure S3 bucket and that the appropriate permissions are set for accessing the logs.

6. Once the CloudTrail configuration has been updated, re-enable the CloudTrail Changes Alarm by running the following command:

   ```
   aws cloudwatch enable-alarm-actions --alarm-names CloudTrailChangesAlarm
   ```

   This command will re-enable the actions that are triggered when the CloudTrail Changes Alarm is triggered.

7. Verify that the CloudTrail Changes Alarm has been re-enabled by running the following command:

   ```
   aws cloudwatch describe-alarms --alarm-names CloudTrailChangesAlarm
   ```

   This command should return the current configuration of the CloudTrail Changes Alarm, with the actions re-enabled.

#### Using Python

The misconfiguration you mentioned is related to the CloudTrail Changes Alarm. This alarm is triggered when there is a change in the AWS CloudTrail configuration. To remediate this misconfiguration, we can use the following steps:

1. Open the AWS Management Console and navigate to the CloudTrail service.

2. Click on the Trails option in the left-hand menu and select the trail that is triggering the alarm.

3. Click on the Edit button to modify the trail configuration.

4. Scroll down to the CloudWatch Logs section and ensure that the Enable CloudWatch Logs option is selected.

5. Ensure that a CloudWatch Logs group is created and the appropriate permissions are set up to allow CloudTrail to write logs to this group.

6. Click on the Save button to save the changes to the trail configuration.

7. Open the AWS Management Console and navigate to the CloudWatch service.

8. Click on the Alarms option in the left-hand menu and select the alarm that is triggering the alert.

9. Click on the Actions button and select the Edit option.

10. In the Edit Alarm dialog box, modify the alarm threshold to the desired value.

11. Click on the Save Changes button to save the updated alarm configuration.

12. To remediate this misconfiguration using Python, we can use the AWS SDK for Python (boto3) to modify the CloudTrail trail and CloudWatch alarm configurations. Here is sample code to enable CloudWatch Logs for a CloudTrail trail:

```python
import boto3

# Create a CloudTrail client
client = boto3.client('cloudtrail')

# Update the trail with CloudWatch Logs enabled
response = client.update_trail(
    Name='my-trail',
    CloudWatchLogsLogGroupArn='arn:aws:logs:us-east-1:123456789012:log-group:/aws/cloudtrail/my-trail',
    CloudWatchLogsRoleArn='arn:aws:iam::123456789012:role/MyCloudTrailRole'
)
```

Here is sample code to modify the threshold of a CloudWatch alarm:

```python
import boto3

# Create a CloudWatch client
client = boto3.client('cloudwatch')

# Update the alarm threshold
response = client.put_metric_alarm(
    AlarmName='my-alarm',
    MetricName='NumberOfDeliveryErrors',
    Namespace='AWS/CloudTrail',
    Statistic='Sum',
    Period=300,
    EvaluationPeriods=1,
    Threshold=1,
    ComparisonOperator='GreaterThanThreshold',
    AlarmActions=[
        'arn:aws:sns:us-east-1:123456789012:my-sns-topic'
    ],
    OKActions=[
        'arn:aws:sns:us-east-1:123456789012:my-sns-topic'
    ],
    Dimensions=[
        {
            'Name': 'TrailName',
            'Value': 'my-trail'
        }
    ]
)
``` 

These are the steps to remediate the CloudTrail Changes Alarm misconfiguration in AWS using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html) 


</Tab>
</Tabs>