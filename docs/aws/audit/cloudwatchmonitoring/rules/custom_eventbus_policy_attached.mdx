---
slug: custom_eventbus_policy_attached
title: Resource Policy Attachment In Custom EventBus
sidebar_label: Resource Policy Attachment In Custom EventBus
---

### More Info:

This rule checks if Amazon EventBridge custom event buses have a resource-based policy attached. It ensures that proper access controls are in place for custom event buses to prevent unauthorized access and ensure compliance with security best practices.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, choose "Events", then in the "Event buses" section, select the name of the custom EventBus you want to check.

3. In the EventBus details page, navigate to the "Resource policy" section. Here you can see the policy attached to the EventBus. 

4. Review the policy to ensure it is correctly configured. The policy should specify the correct principal (the entity that is allowed to publish to the EventBus), the correct action (events:PutEvents), and the correct resource (the ARN of the EventBus).
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to execute the commands.

2. Once the AWS CLI is set up, you can list all the custom event buses in your account using the following command:

   ```
   aws events list-event-buses
   ```
   This command will return a list of all the event buses in your account. Note the name of the custom event bus you want to check.

3. Now, you can list all the policies attached to the custom event bus using the following command:

   ```
   aws events describe-event-bus --name <event-bus-name>
   ```
   Replace `<event-bus-name>` with the name of your custom event bus. This command will return a description of the event bus, including any policies attached to it.

4. To check the details of the policy, you can use the following command:

   ```
   aws iam get-policy --policy-arn <policy-arn>
   ```
   Replace `<policy-arn>` with the ARN of the policy you want to check. This command will return the details of the policy, including the policy document.

By following these steps, you can check the resource policy attachment in a custom EventBus in Cloud Watch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) in your environment. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
pip install boto3
```

2. Import the necessary libraries and create a session using your AWS credentials.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION_NAME'
)
```

3. Use the `list_event_buses` method from the CloudWatch client to get a list of all your custom event buses.

```python
client = session.client('events')
response = client.list_event_buses()

for event_bus in response['EventBuses']:
    print(event_bus['Name'])
```

4. For each custom event bus, use the `describe_event_bus` method to get the policy attached to it. If the policy is not as expected or if there is no policy attached, it is a misconfiguration.

```python
for event_bus in response['EventBuses']:
    event_bus_name = event_bus['Name']
    event_bus_details = client.describe_event_bus(Name=event_bus_name)
    policy = event_bus_details.get('Policy', None)
    if policy is None:
        print(f'Misconfiguration detected: No policy attached to {event_bus_name}')
    else:
        print(f'Policy for {event_bus_name}: {policy}')
```

This script will print out the names of all custom event buses that do not have a policy attached, indicating a potential misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Resource Policy Attachment in a Custom EventBus for AWS CloudWatch using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login with your credentials.

2. **Navigate to CloudWatch**: Click on the "Services" dropdown in the top left corner, search for "CloudWatch" in the search bar, and click on "CloudWatch" to open the CloudWatch dashboard.

3. **Select Event Buses**: In the CloudWatch dashboard, locate the "Event Buses" option in the left-hand menu and click on it.

4. **Select Custom EventBus**: Find the Custom EventBus that has the misconfigured Resource Policy Attachment and click on it to select it.

5. **Edit Resource Policy**: Locate the "Event bus policy" section and click on the "Edit policy" button to modify the Resource Policy Attachment.

6. **Update Resource Policy**: In the policy editor, review the existing policy and make necessary changes to ensure that only authorized resources have permission to access the Custom EventBus. You can use the AWS Policy Generator to create a new policy if needed.

7. **Save Changes**: After updating the Resource Policy Attachment, click on the "Save changes" button to apply the new policy to the Custom EventBus.

8. **Verify Configuration**: Once the policy is updated, verify that the Resource Policy Attachment is correctly configured by checking the permissions and access controls for the Custom EventBus.

By following these steps, you can remediate the misconfiguration of Resource Policy Attachment in a Custom EventBus for AWS CloudWatch using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of resource policy attachment in a custom EventBus for AWS CloudWatch using AWS CLI, follow these steps:

1. List the existing Event Buses in your AWS account to identify the custom EventBus that has the misconfigured resource policy. Run the following AWS CLI command:

```
aws events list-event-buses
```

2. Identify the custom EventBus that has the misconfigured resource policy attachment.

3. Remove the existing resource policy attachment from the custom EventBus using the following AWS CLI command. Replace `<event-bus-name>` with the name of the custom EventBus identified in step 2:

```
aws events remove-permission --statement-id default --event-bus-name <event-bus-name>
```

4. Verify that the resource policy attachment has been successfully removed by listing the permissions for the custom EventBus using the following AWS CLI command:

```
aws events describe-event-bus --name <event-bus-name>
```

5. If the resource policy attachment is successfully removed, you can now add the correct resource policy to the custom EventBus. Create a new resource policy document in JSON format and save it to a file (e.g., `resource-policy.json`). Here is an example of a resource policy that allows CloudWatch events:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "events.amazonaws.com"
      },
      "Action": "events:PutEvents",
      "Resource": "arn:aws:events:us-east-1:123456789012:event-bus/<event-bus-name>"
    }
  ]
}
```

6. Attach the new resource policy to the custom EventBus using the following AWS CLI command. Replace `<event-bus-name>` with the name of the custom EventBus:

```
aws events put-permission --event-bus-name <event-bus-name> --action events:PutEvents --principal events.amazonaws.com --statement-id default --policy file://resource-policy.json
```

7. Verify that the new resource policy has been successfully attached to the custom EventBus by listing the permissions for the custom EventBus using the following AWS CLI command:

```
aws events describe-event-bus --name <event-bus-name>
```

By following these steps, you can remediate the misconfiguration of resource policy attachment in a custom EventBus for AWS CloudWatch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of a resource policy attachment in a custom EventBus in AWS CloudWatch using Python, you can follow these steps:

1. **Identify the Misconfigured Resource Policy**: First, identify the custom EventBus in CloudWatch that has the misconfigured resource policy attachment. You can use the AWS SDK for Python (Boto3) to list the EventBuses and their associated resource policies.

2. **Remove the Misconfigured Resource Policy**: Use the `remove_permission` method from Boto3 to remove the misconfigured resource policy attachment from the custom EventBus. You will need to specify the EventBus name and the statement ID of the resource policy to be removed.

3. **Example Python Code**:
   
   ```python
   import boto3

   # Initialize the CloudWatch Events client
   cloudwatch_events = boto3.client('events')

   # Specify the name of the custom EventBus with the misconfigured resource policy
   event_bus_name = 'your-custom-event-bus-name'
   
   # Specify the statement ID of the misconfigured resource policy to be removed
   statement_id = 'your-misconfigured-statement-id'

   # Remove the misconfigured resource policy from the custom EventBus
   response = cloudwatch_events.remove_permission(
       StatementId=statement_id,
       EventBusName=event_bus_name
   )

   print('Resource policy removed successfully')
   ```
   
4. **Run the Python Script**: Execute the Python script on your local machine or in an AWS Lambda function to remove the misconfigured resource policy attachment from the custom EventBus in CloudWatch.

5. **Verify Remediation**: After running the script, verify that the resource policy attachment has been successfully removed from the custom EventBus by listing the EventBuses and checking the resource policies.

By following these steps and using the provided Python script, you can effectively remediate the misconfiguration of a resource policy attachment in a custom EventBus in AWS CloudWatch.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

