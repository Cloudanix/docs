

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the AWS WAF & Shield console at https://console.aws.amazon.com/wafv2/.

2. In the navigation pane, choose "WebACLs".

3. In the WebACLs section, select the WebACL that you want to check.

4. In the Rules tab, check if there is a Rule Group associated with the WebACL. If there is no Rule Group associated, it means the WebACL does not have a Rule Group association, indicating a misconfiguration.

5. For further verification, you can also check the CloudWatch metrics for the WebACL. In the AWS Management Console, navigate to the CloudWatch service. Under "All metrics", navigate to "WAF & Shield" > "WebACL" > "RuleGroup". If there are no metrics available for the Rule Group, it indicates that the Rule Group is not associated with the WebACL.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the WebACLs: Use the following AWS CLI command to list all the WebACLs in your AWS account:

   ```
   aws wafv2 list-web-acls --scope REGIONAL
   ```
   This command will return a list of all the WebACLs in your account. Note down the ARN of the WebACL you want to check.

3. Get the details of the WebACL: Use the following AWS CLI command to get the details of the WebACL:

   ```
   aws wafv2 get-web-acl --scope REGIONAL --arn <WebACL ARN>
   ```
   Replace `<WebACL ARN>` with the ARN of the WebACL you noted down in the previous step. This command will return the details of the WebACL including its associated rule groups.

4. Check for Rule Group Association: In the output of the previous command, look for the `RuleGroupReferenceStatement` field. If this field is present and contains a `RuleGroupArn`, it means that the WebACL has a rule group associated with it. If this field is not present or does not contain a `RuleGroupArn`, it means that the WebACL does not have a rule group associated with it.

#### Using Python

To check if an AWS Firewall Manager (FMS) Web ACL has a Rule Group Association using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Set up AWS SDK for Python (Boto3):**
   First, you need to set up Boto3 on your machine. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **Initialize the AWS WAFV2 Client:**
   Once Boto3 is set up, you can initialize the AWS WAFV2 client in your Python script:
   ```python
   import boto3

   client = boto3.client('wafv2')
   ```

3. **List all Web ACLs:**
   Use the `list_web_acls` method to get a list of all Web ACLs:
   ```python
   response = client.list_web_acls(
       Scope='REGIONAL'  # or 'CLOUDFRONT' depending on where your ACLs are
   )
   ```

4. **Check for Rule Group Associations:**
   For each Web ACL, use the `get_web_acl` method to get its details and check if it has any associated Rule Groups:
   ```python
   for acl in response['WebACLs']:
       acl_details = client.get_web_acl(
           Name=acl['Name'],
           Scope='REGIONAL',  # or 'CLOUDFRONT'
           Id=acl['Id']
       )
       if 'Rules' in acl_details['WebACL']:
           for rule in acl_details['WebACL']['Rules']:
               if 'RuleGroupReferenceStatement' in rule['Statement']:
                   print(f"Web ACL {acl['Name']} has a Rule Group Association")
               else:
                   print(f"Web ACL {acl['Name']} does not have a Rule Group Association")
   ```
   This script will print out whether each Web ACL has a Rule Group Association or not.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of FMS Web ACL not having a Rule Group Association in AWS Cloud Watch using the AWS console, follow these step-by-step instructions:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login with your credentials.

2. **Navigate to Firewall Manager**: In the AWS Management Console, navigate to the Firewall Manager service by typing "Firewall Manager" in the search bar and selecting it from the options.

3. **Select Policy**: In the Firewall Manager dashboard, click on the policy that is associated with the Web ACL that needs to have a Rule Group Association.

4. **Edit Policy**: Click on the "Edit policy" button to make changes to the policy.

5. **Add Rule Group Association**: In the policy settings, look for the section where you can associate a Rule Group with the Web ACL. Click on the "Add Rule Group Association" button.

6. **Select Rule Group**: A list of available Rule Groups will be displayed. Select the appropriate Rule Group that you want to associate with the Web ACL.

7. **Save Changes**: After selecting the Rule Group, click on the "Save" or "Update" button to save the changes to the policy.

8. **Review Changes**: Review the changes made to the policy to ensure that the Rule Group has been successfully associated with the Web ACL.

By following these steps, you will be able to remediate the misconfiguration of FMS Web ACL not having a Rule Group Association in AWS Cloud Watch using the AWS console.

#### Using CLI

To remediate the misconfiguration "FMS Web ACL Should Have Rule Group Association" for AWS CloudWatch using AWS CLI, follow these steps:

1. Open your terminal or command prompt.

2. Use the following AWS CLI command to associate a rule group with your FMS Web ACL:
   
```
aws wafv2 associate-web-acl \
  --web-acl-arn <YOUR_WEB_ACL_ARN> \
  --web-acl-capacity UNIT_42 \
  --web-acl-rule-group-reference "ARN=arn:aws:wafv2:REGION:ACCOUNT_ID:regional-rule-group/RULE_GROUP_ID" \
  --action "ALLOW" \
  --scope "REGIONAL"
```

Replace the following placeholders in the command:
- `<YOUR_WEB_ACL_ARN>`: The ARN of your FMS Web ACL
- `REGION`: The AWS region where your FMS Web ACL is deployed
- `ACCOUNT_ID`: Your AWS account ID
- `RULE_GROUP_ID`: The ID of the rule group you want to associate with the FMS Web ACL

3. Execute the command in your terminal. This will associate the specified rule group with your FMS Web ACL and remediate the misconfiguration.

4. Verify that the rule group is successfully associated with the FMS Web ACL by checking the Web ACL configuration in the AWS Management Console or by running the following AWS CLI command:

```
aws wafv2 list-web-acls --scope REGIONAL
```

This command will list all the regional web ACLs in your account, including the one with the associated rule group.

By following these steps, you can remediate the misconfiguration "FMS Web ACL Should Have Rule Group Association" for AWS CloudWatch using AWS CLI.

#### Using Python

To remediate the misconfiguration of FMS Web ACL not having a Rule Group Association in AWS CloudWatch using Python, you can follow these steps:

1. Install the necessary Python libraries:
Ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip:
```bash
pip install boto3
```

2. Write a Python script to associate a Rule Group with the FMS Web ACL:
```python
import boto3

# Initialize the FMS and WAF clients
fms_client = boto3.client('fms')
wafv2_client = boto3.client('wafv2')

# Specify the FMS Web ACL Id and the Rule Group ARN that you want to associate
web_acl_id = 'YOUR_WEB_ACL_ID'
rule_group_arn = 'YOUR_RULE_GROUP_ARN'

# Associate the Rule Group with the FMS Web ACL
response = fms_client.put_apps_list(
    ListId=web_acl_id,
    AppsList=rule_group_arn
)

print("Rule Group associated successfully with the FMS Web ACL")
```

3. Replace `'YOUR_WEB_ACL_ID'` and `'YOUR_RULE_GROUP_ARN'` with the actual Web ACL Id and Rule Group ARN that you want to associate.

4. Run the Python script:
Save the script in a file (e.g., `associate_rule_group.py`) and run it using Python:
```bash
python associate_rule_group.py
```

By following these steps and running the Python script, you can successfully associate a Rule Group with the FMS Web ACL in AWS CloudWatch, remediating the misconfiguration.


</Tab>
</Tabs>