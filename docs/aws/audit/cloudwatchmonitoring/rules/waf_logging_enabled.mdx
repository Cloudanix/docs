---
slug: waf_logging_enabled
title: WAF Logging Should Be Enabled
sidebar_label: WAF Logging Should Be Enabled
---

### More Info:

WAF logging should be enabled

### Risk Level

Medium

### Address

Security, Reliability, Operational Maturity

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001,SEBI,RBI_MD_ITF,RBI_UCB


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of WAF (Web Application Firewall) logging not being enabled in CloudWatch using the AWS Management Console, follow these steps:

1. **Navigate to WAF Console:**
   - Sign in to the AWS Management Console.
   - Open the WAF & Shield service by searching for "WAF" in the AWS Management Console search bar and selecting "WAF & Shield."

2. **Select the Web ACL:**
   - In the WAF console, navigate to the "Web ACLs" section.
   - Select the Web ACL for which you want to enable logging.

3. **Enable Logging:**
   - In the Web ACL details page, find the "Logging and metrics" section.
   - Click on the "Enable logging" button.

4. **Configure Log Destination:**
   - In the logging configuration page, select "CloudWatch Logs" as the log destination.
   - Choose or create a CloudWatch Log Group where the logs will be stored.
   - Save the configuration to enable logging.

By following these steps, you ensure that WAF logs are properly sent to CloudWatch Logs, which helps in monitoring and troubleshooting your web application firewall rules.
</Accordion>

<Accordion title='Using CLI'>
To ensure that WAF (Web Application Firewall) logging is enabled in CloudWatch using AWS CLI, follow these steps:

1. **Create a CloudWatch Log Group:**
   First, create a CloudWatch log group where the WAF logs will be stored.
   ```sh
   aws logs create-log-group --log-group-name <log-group-name>
   ```

2. **Create an IAM Role for WAF Logging:**
   Create an IAM role that grants WAF permission to write logs to CloudWatch. Save the following trust policy to a file named `trust-policy.json`:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "Service": "waf.amazonaws.com"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```
   Then, create the role using the trust policy:
   ```sh
   aws iam create-role --role-name WAFLoggingRole --assume-role-policy-document file://trust-policy.json
   ```

3. **Attach Policy to IAM Role:**
   Attach a policy to the IAM role that allows it to write logs to CloudWatch. Save the following policy to a file named `waf-logging-policy.json`:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "logs:CreateLogStream",
           "logs:PutLogEvents"
         ],
         "Resource": "arn:aws:logs:<region>:<account-id>:log-group:<log-group-name>:*"
       }
     ]
   }
   ```
   Then, attach the policy to the role:
   ```sh
   aws iam put-role-policy --role-name WAFLoggingRole --policy-name WAFLoggingPolicy --policy-document file://waf-logging-policy.json
   ```

4. **Enable WAF Logging:**
   Finally, enable logging for your WAF web ACL. Replace `<web-acl-id>`, `<log-group-name>`, and `<role-arn>` with your specific values.
   ```sh
   aws wafv2 put-logging-configuration --logging-configuration ResourceArn=arn:aws:wafv2:<region>:<account-id>:regional/webacl/<web-acl-id>/12345678-1234-1234-1234-123456789012,LogDestinationConfigs=arn:aws:logs:<region>:<account-id>:log-group:<log-group-name>,RedactedFields=[]
   ```

By following these steps, you can ensure that WAF logging is enabled and properly configured to send logs to CloudWatch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of WAF (Web Application Firewall) logging not being enabled in CloudWatch using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure WAF logging is enabled:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Enable WAF Logging**:
   Use the following Python script to enable WAF logging for a specific WebACL. This script assumes you have a CloudWatch Log Group already created.

   ```python
   import boto3

   # Initialize a session using Amazon WAF
   client = boto3.client('wafv2', region_name='us-east-1')  # Change the region as needed

   # Define the WebACL ARN and the CloudWatch Log Group ARN
   web_acl_arn = 'arn:aws:wafv2:us-east-1:123456789012:regional/webacl/name/ID'  # Replace with your WebACL ARN
   log_group_arn = 'arn:aws:logs:us-east-1:123456789012:log-group:your-log-group'  # Replace with your Log Group ARN

   # Enable logging configuration
   response = client.put_logging_configuration(
       LoggingConfiguration={
           'ResourceArn': web_acl_arn,
           'LogDestinationConfigs': [
               log_group_arn,
           ],
           'RedactedFields': [
               {
                   'SingleHeader': {
                       'Name': 'Authorization'
                   }
               },
           ]
       }
   )

   print("WAF Logging Configuration Response:", response)
   ```

4. **Verify Logging Configuration**:
   After running the script, you can verify that the logging configuration has been applied by checking the CloudWatch Logs console or by using the following script to retrieve the logging configuration:

   ```python
   response = client.get_logging_configuration(
       ResourceArn=web_acl_arn
   )

   print("Current WAF Logging Configuration:", response)
   ```

These steps will ensure that WAF logging is enabled in CloudWatch, helping you to prevent the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the AWS WAF & Shield service.

2. In the navigation pane, select "Web ACLs". This will display a list of all your Web ACLs.

3. Select the Web ACL that you want to check for logging configuration. This will open the details page for the selected Web ACL.

4. In the details page, look for the "Logging" section. If logging is enabled, you will see the name of the Amazon CloudWatch Logs group where AWS WAF is publishing the logs. If the "Logging" section is not present or if it says "Logging: OFF", then WAF logging is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the WebACLs: Use the following command to list all the WebACLs in your AWS account:

   ```
   aws wafv2 list-web-acls --scope REGIONAL
   ```
   This command will return a list of WebACLs. Note down the ARN of the WebACL for which you want to check the logging configuration.

3. Get WebACL details: Use the following command to get the details of a specific WebACL:

   ```
   aws wafv2 get-web-acl --scope REGIONAL --arn "arn:aws:wafv2:region:account-id:regional/webacl/WebACLName/ID"
   ```
   Replace "arn:aws:wafv2:region:account-id:regional/webacl/WebACLName/ID" with the ARN of your WebACL. This command will return the details of the WebACL including its logging configuration.

4. Check the logging configuration: In the output of the previous command, look for the "LoggingConfiguration" field. If this field is present and its "LogDestinationConfigs" field is not empty, then WAF logging is enabled. If the "LoggingConfiguration" field is not present or its "LogDestinationConfigs" field is empty, then WAF logging is not enabled.
</Accordion>

<Accordion title='Using Python'>
To check if WAF Logging is enabled in CloudWatch using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. **Create a Python Script to List WAF WebACLs:**
   You can use the `list_web_acls` method to list all your WAF WebACLs. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('wafv2')

   response = client.list_web_acls(
       Scope='REGIONAL'
   )

   print(response)
   ```
   This script will print all your WAF WebACLs in the console.

3. **Create a Python Script to Get WebACL Logging Configuration:**
   You can use the `get_logging_configuration` method to get the logging configuration of a WebACL. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('wafv2')

   response = client.get_logging_configuration(
       ResourceArn='arn:aws:wafv2:region:account-id:webacl/name/id'
   )

   print(response)
   ```
   Replace 'arn:aws:wafv2:region:account-id:webacl/name/id' with the ARN of your WebACL. This script will print the logging configuration of the specified WebACL in the console.

4. **Check if Logging is Enabled:**
   The `get_logging_configuration` method returns a dictionary that contains the logging configuration of the specified WebACL. If the 'LoggingConfiguration' key is present in the dictionary, then logging is enabled. If it's not present, then logging is not enabled. You can add this check to your script:
   ```python
   import boto3

   client = boto3.client('wafv2')

   response = client.get_logging_configuration(
       ResourceArn='arn:aws:wafv2:region:account-id:webacl/name/id'
   )

   if 'LoggingConfiguration' in response:
       print('Logging is enabled.')
   else:
       print('Logging is not enabled.')
   ```
   This script will print whether logging is enabled or not for the specified WebACL.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of WAF Logging not being enabled in AWS CloudWatch using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to AWS WAF Console**: Click on the "Services" dropdown menu at the top of the page, search for "WAF & Shield" under the Security, Identity, & Compliance category, and click on it.

3. **Select the Web ACL**: In the left-hand navigation pane, click on "Web ACLs".

4. **Choose the Web ACL**: Select the Web ACL for which you want to enable logging by clicking on its name.

5. **Enable Logging**: In the Web ACL details page, click on the "Logging" tab.

6. **Enable Logging**: Click on the "Edit" button to modify the logging configuration.

7. **Enable Logging**: Toggle the "Enable Logging" option to enable logging for the Web ACL.

8. **Choose Logging Destination**: Select the CloudWatch log group where you want to store the logs. If you don't have an existing log group, you can create a new one by clicking on the "Create a new CloudWatch log group" button.

9. **Save Changes**: Click on the "Update" button to save the changes and enable logging for the Web ACL.

10. **Verify Logging**: To verify that logging is enabled, you can check the CloudWatch logs in the specified log group to ensure that the WAF logs are being generated and stored correctly.

By following these steps, you will successfully remediate the misconfiguration of WAF Logging not being enabled in AWS CloudWatch using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of WAF logging not being enabled in AWS CloudWatch using AWS CLI, follow these steps:

1. Enable logging for your Web Application Firewall (WAF) in the AWS Management Console:
   - Navigate to the AWS WAF console.
   - Select the WebACL for which you want to enable logging.
   - Click on the "Logging and Metrics" tab.
   - Click on "Edit Logging Configuration" and enable logging.
   - Choose the Amazon Kinesis Data Firehose delivery stream or Amazon S3 bucket where you want to store the logs.

2. Use AWS CLI to enable logging for your WAF:
   - Open your terminal or command prompt.
   - Run the following AWS CLI command to associate a logging configuration with your WebACL:
     ```
     aws waf-regional update-web-acl --web-acl-id <web-acl-id> --updates Action=INSERT,ActivatedRule={Priority=1,RuleId=AWSManagedRulesCommonRuleSetRuleID},LoggingConfiguration={LogDestinationConfigs=[<log-destination-arn>],RedactedFields=[{Type=URI,Data=FULL},{Type=QUERY_STRING,Data=ALL},{Type=HEADER,Data=ALL},{Type=SINGLE_QUERY_ARG,Data=ALL},{Type=ALL_QUERY_ARGS,Data=ALL}]}
     ```
     Replace `<web-acl-id>` with the ID of your WebACL and `<log-destination-arn>` with the ARN of the Amazon Kinesis Data Firehose delivery stream or Amazon S3 bucket where you want to store the logs.

3. Verify that logging is enabled:
   - Run the following AWS CLI command to describe the logging configuration for your WebACL:
     ```
     aws waf-regional get-web-acl --web-acl-id <web-acl-id>
     ```
   - Check the output to ensure that the logging configuration is correctly set up and enabled.

By following these steps, you can remediate the misconfiguration of WAF logging not being enabled in AWS CloudWatch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To enable WAF logging in AWS CloudWatch using Python, you can use the AWS SDK for Python (Boto3). Follow these steps to remediate the misconfiguration:

1. Install Boto3:
```bash
pip install boto3
```

2. Create a Python script with the following code:
```python
import boto3

# Initialize the AWS service clients
waf_client = boto3.client('waf')
cloudwatch_client = boto3.client('cloudwatch')

# Get the WebACL Id
web_acl_id = 'YOUR_WEB_ACL_ID'

# Enable logging for the WebACL
response = waf_client.update_web_acl(
    WebACLId=web_acl_id,
    LoggingConfiguration={
        'ResourceArn': 'arn:aws:logs:REGION:ACCOUNT_ID:log-group:LOG_GROUP_NAME',
        'LogDestinationConfigs': [
            'arn:aws:firehose:REGION:ACCOUNT_ID:deliverystream/FIREHOSE_NAME'
        ],
        'RedactedFields': []
    }
)

# Create a CloudWatch log group for the WAF logs
response = cloudwatch_client.create_log_group(
    logGroupName='LOG_GROUP_NAME'
)

print("WAF logging has been enabled successfully.")
```

3. Replace the following placeholders in the script:
- `YOUR_WEB_ACL_ID`: Replace this with the ID of the WebACL for which you want to enable logging.
- `REGION`: Replace this with the AWS region where the logs will be stored.
- `ACCOUNT_ID`: Replace this with your AWS account ID.
- `LOG_GROUP_NAME`: Replace this with the name of the CloudWatch log group where WAF logs will be stored.
- `FIREHOSE_NAME`: Replace this with the name of the Kinesis Data Firehose delivery stream where logs will be delivered.

4. Run the Python script to enable WAF logging in AWS CloudWatch:
```bash
python enable_waf_logging.py
```

After running this script, WAF logging will be enabled for the specified WebACL, and the logs will be stored in the CloudWatch log group you specified.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

