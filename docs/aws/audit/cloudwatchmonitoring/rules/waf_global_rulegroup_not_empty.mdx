---
slug: waf_global_rulegroup_not_empty
title: WAF Global Rule Groups Should Not Be Empty
sidebar_label: WAF Global Rule Groups Should Not Be Empty
---

### More Info:

WAF rule groups should not be empty

### Risk Level

High

### Address

Security

### Compliance Standards

CBP


<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the AWS WAF & Shield service.

2. In the navigation pane, select "WebACLs". This will display a list of all your WebACLs.

3. Select the WebACL that you want to check. This will open the details page for that WebACL.

4. In the details page, check the "Rules" section. If there are no rules listed, or if the listed rule groups are empty, then the WebACL is misconfigured.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the WebACLs: Use the following command to list all the WebACLs in your AWS account:

   ```
   aws wafv2 list-web-acls --scope REGIONAL
   ```
   This command will return a list of WebACLs. Note down the ARN of the WebACL you want to check.

3. Get the details of a specific WebACL: Use the following command to get the details of a specific WebACL:

   ```
   aws wafv2 get-web-acl --scope REGIONAL --arn "arn:aws:wafv2:region:account-id:regional/webacl/WebACLName/ID"
   ```
   Replace "arn:aws:wafv2:region:account-id:regional/webacl/WebACLName/ID" with the ARN of the WebACL you noted down in the previous step. This command will return the details of the WebACL including the associated rule groups.

4. Check if the rule groups are empty: In the output of the previous command, look for the "Rules" field. If this field is empty or does not exist, it means that the global rule groups are empty.

#### Using Python

To check if WAF Global Rule Groups are not empty in AWS CloudWatch using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Set up your environment:**
   Before you start, make sure you have installed and configured AWS CLI and Boto3. You can install Boto3 using pip:
   ```
   pip install boto3
   ```
   And configure AWS CLI with your credentials:
   ```
   aws configure
   ```
   Enter your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. **Import necessary libraries and create a WAF client:**
   In your Python script, import the Boto3 library and create a WAF client:
   ```python
   import boto3

   client = boto3.client('waf')
   ```

3. **List all the rule groups:**
   Use the `list_rule_groups` method to get all the rule groups:
   ```python
   response = client.list_rule_groups()
   rule_groups = response['RuleGroups']
   ```

4. **Check if rule groups are empty:**
   Iterate over the rule groups and use the `get_rule_group` method to get the details of each rule group. If the 'Rules' list is empty, then the rule group is empty:
   ```python
   for rule_group in rule_groups:
       rule_group_id = rule_group['RuleGroupId']
       rule_group_details = client.get_rule_group(RuleGroupId=rule_group_id)
       if not rule_group_details['RuleGroup']['MetricName']:
           print(f"Rule group {rule_group_id} is empty.")
   ```
   This script will print the IDs of all rule groups that are empty. If no rule group is empty, it will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "WAF Global Rule Groups Should Not Be Empty" for AWS CloudWatch using the AWS console, follow these step-by-step instructions:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/) and login using your credentials.

2. **Navigate to AWS WAF Service**: In the AWS Management Console, search for "WAF" in the search bar at the top and click on the "AWS WAF & Shield" service.

3. **Select the Web ACL**: In the AWS WAF & Shield dashboard, click on "Web ACLs" from the left-hand menu.

4. **Choose the Web ACL**: Select the Web ACL that you want to remediate from the list of Web ACLs displayed.

5. **Edit the Web ACL**: Click on the Web ACL that you selected, and then click on the "Rules" tab.

6. **Add Rule Groups**: In the Rules tab, you will see the list of rules and rule groups associated with the Web ACL. Click on "Add rules or rule groups" button.

7. **Select Global Rule Groups**: In the Add rules or rule groups window, select the "Global Rule Groups" tab.

8. **Add Rule Group**: Click on the "Add rule group" button and select a rule group from the list that you want to add to the Web ACL.

9. **Save Changes**: After adding the rule group, click on the "Add rule group" button to save the changes.

10. **Review and Update**: Review the updated Web ACL configuration to ensure that the Global Rule Groups are not empty.

By following these steps, you have successfully added rule groups to the Web ACL in AWS WAF, ensuring that the Global Rule Groups are not empty and remediating the misconfiguration for AWS CloudWatch.

#### Using CLI

To remediate the misconfiguration of empty WAF Global Rule Groups in AWS CloudWatch using AWS CLI, follow these steps:

1. **List WAF Global Rule Groups**: First, list all the WAF Global Rule Groups to identify the empty ones. Run the following AWS CLI command:
   ```
   aws wafv2 list-available-managed-rule-groups --scope CLOUDWATCH_METRICS
   ```

2. **Identify Empty Rule Groups**: Look for any rule groups with an empty list of rules. Note down the ARN of the empty rule group that you want to remediate.

3. **Update Rule Group**: To remediate the empty rule group, you need to update the rule group with at least one rule. You can add a managed rule or a custom rule to the rule group. Run the following AWS CLI command to update the rule group:
   ```
   aws wafv2 update-managed-rule-set-version --name <rule-group-name> --id <rule-group-id> --lock-token <lock-token> --recommended-version <version> --rules-action <action> --scope CLOUDWATCH_METRICS
   ```

   - Replace `<rule-group-name>` with the name of the rule group.
   - Replace `<rule-group-id>` with the ID of the rule group.
   - Replace `<lock-token>` with the lock token of the rule group.
   - Replace `<version>` with the version of the rule set.
   - Replace `<action>` with the action to take on the rules (e.g., ALLOW, BLOCK).

4. **Verify Update**: After updating the rule group, verify that the rule group is no longer empty by listing the rules in the rule group:
   ```
   aws wafv2 list-managed-rules --scope CLOUDWATCH_METRICS --id <rule-group-id>
   ```

5. **Monitor Changes**: Monitor the CloudWatch metrics to ensure that the WAF Global Rule Groups are no longer empty and are actively protecting your resources.

By following these steps, you can successfully remediate the misconfiguration of empty WAF Global Rule Groups in AWS CloudWatch using AWS CLI.

#### Using Python

To remediate the misconfiguration of empty WAF Global Rule Groups in AWS CloudWatch using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
```
pip install boto3
```

2. Write a Python script to check and remediate the empty WAF Global Rule Groups. Here is an example script:

```python
import boto3

def remediate_empty_waf_rule_groups():
    # Initialize the WAF client
    waf_client = boto3.client('waf')

    # Get a list of all WAF Global Rule Groups
    response = waf_client.list_rule_groups(Scope='CLOUDFRONT')

    for rule_group in response['RuleGroups']:
        rule_group_id = rule_group['RuleGroupId']
        
        # Check if the Rule Group is empty
        if not rule_group['Rules']:
            print(f"Rule Group {rule_group_id} is empty. Adding a rule to the Rule Group...")
            
            # Add a sample rule to the empty Rule Group
            waf_client.update_rule_group(
                RuleGroupId=rule_group_id,
                Updates=[
                    {
                        'Action': 'INSERT',
                        'ActivatedRule': {
                            'Priority': 1,
                            'RuleId': 'SampleRuleID'
                        }
                    }
                ]
            )
            
            print(f"Rule added to Rule Group {rule_group_id}")
        else:
            print(f"Rule Group {rule_group_id} is not empty")

if __name__ == '__main__':
    remediate_empty_waf_rule_groups()
```

3. Run the Python script on your local machine or any AWS compute instance with the necessary IAM permissions to interact with WAF.

This script will check all the WAF Global Rule Groups associated with CloudFront and add a sample rule to any empty Rule Groups found. Make sure to replace 'SampleRuleID' with the actual Rule ID you want to add to the empty Rule Groups.

By following these steps, you can remediate the misconfiguration of empty WAF Global Rule Groups in AWS CloudWatch using Python.


</Tab>
</Tabs>