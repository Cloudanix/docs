---
slug: cw_loggroup_retention_period_check
title: Cloudwatch Loggroup Retention Period Should Be Reviewed
sidebar_label: Cloudwatch Loggroup Retention Period Should Be Reviewed
---

### More Info:

This rule checks if an Amazon CloudWatch LogGroup retention period is set to greater than 365 days or else a specified retention period. The rule is NON_COMPLIANT if the retention period is less than MinRetentionTime, if specified, or else 365 days.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

SOC2,HIPAA,GDPR,NISTCSF,PCIDSS,RBI_MD_ITF,RBI_UCB


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of CloudWatch Log Group retention periods in AWS using the AWS Management Console, follow these steps:

1. **Navigate to CloudWatch:**
   - Open the AWS Management Console.
   - In the Services menu, select "CloudWatch" under the "Management & Governance" category.

2. **Access Log Groups:**
   - In the CloudWatch dashboard, click on "Logs" in the left-hand navigation pane.
   - This will display a list of all your log groups.

3. **Review Retention Settings:**
   - Click on the name of a log group to view its details.
   - Check the "Retention settings" to see the current retention period for the log group.

4. **Set Appropriate Retention Period:**
   - If the retention period is not set or needs adjustment, click on the "Actions" dropdown menu and select "Edit retention settings."
   - Choose an appropriate retention period from the dropdown options and save the changes.

By regularly reviewing and setting appropriate retention periods for your CloudWatch log groups, you can ensure that logs are retained for the necessary duration and avoid unnecessary storage costs.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of CloudWatch Log Group retention periods using the AWS CLI, you can follow these steps:

1. **List Existing Log Groups:**
   First, identify the log groups that are currently configured in your AWS account. This will help you determine which log groups need their retention periods reviewed.

   ```sh
   aws logs describe-log-groups
   ```

2. **Set Retention Period for a Log Group:**
   For each log group, set an appropriate retention period. The retention period is specified in days. For example, to set a retention period of 30 days for a log group named `my-log-group`:

   ```sh
   aws logs put-retention-policy --log-group-name my-log-group --retention-in-days 30
   ```

3. **Automate Retention Policy Setting:**
   To ensure that all new log groups have a default retention period, you can create a script that sets the retention period for any new log groups. This script can be run periodically or triggered by an event.

   ```sh
   #!/bin/bash
   LOG_GROUPS=$(aws logs describe-log-groups --query 'logGroups[*].logGroupName' --output text)
   for LOG_GROUP in $LOG_GROUPS; do
       aws logs put-retention-policy --log-group-name $LOG_GROUP --retention-in-days 30
   done
   ```

4. **Monitor and Audit Log Groups:**
   Regularly monitor and audit your log groups to ensure that the retention policies are correctly applied. You can use AWS CloudWatch Events or AWS Config Rules to trigger alerts if a log group does not have the desired retention period.

   ```sh
   aws logs describe-log-groups --query 'logGroups[?retentionInDays!=`30`].logGroupName'
   ```

By following these steps, you can ensure that the retention periods for your CloudWatch log groups are consistently reviewed and set according to your organization's policies.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of CloudWatch Log Group retention periods in AWS using Python scripts, you can follow these steps:

1. **Install AWS SDK for Python (Boto3):**
   Ensure you have Boto3 installed in your environment. If not, you can install it using pip.

   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials:**
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

   ```bash
   aws configure
   ```

3. **Create a Python Script to Check and Set Retention Period:**
   Write a Python script that will check the retention period of CloudWatch Log Groups and set it to a desired value if it is not already set.

   ```python
   import boto3

   # Initialize a session using Amazon CloudWatch
   client = boto3.client('logs')

   # Define the desired retention period in days
   desired_retention_days = 30

   def set_log_group_retention(log_group_name, retention_days):
       try:
           response = client.put_retention_policy(
               logGroupName=log_group_name,
               retentionInDays=retention_days
           )
           print(f"Retention policy set for {log_group_name} to {retention_days} days.")
       except Exception as e:
           print(f"Error setting retention policy for {log_group_name}: {e}")

   def check_and_set_retention():
       try:
           response = client.describe_log_groups()
           for log_group in response['logGroups']:
               log_group_name = log_group['logGroupName']
               retention_days = log_group.get('retentionInDays', None)
               if retention_days is None or retention_days != desired_retention_days:
                   set_log_group_retention(log_group_name, desired_retention_days)
               else:
                   print(f"Log group {log_group_name} already has the desired retention period.")
       except Exception as e:
           print(f"Error describing log groups: {e}")

   if __name__ == "__main__":
       check_and_set_retention()
   ```

4. **Schedule the Script to Run Periodically:**
   To ensure continuous compliance, schedule the script to run periodically using a cron job (Linux/Mac) or Task Scheduler (Windows).

   **For Linux/Mac:**
   - Open the crontab editor:
     ```bash
     crontab -e
     ```
   - Add a cron job to run the script daily (adjust the schedule as needed):
     ```bash
     0 0 * * * /usr/bin/python3 /path/to/your/script.py
     ```

   **For Windows:**
   - Open Task Scheduler.
   - Create a new task and set the trigger to run daily.
   - Set the action to start a program and point it to your Python executable and script path.

By following these steps, you can ensure that the retention period for CloudWatch Log Groups is reviewed and set to the desired value, preventing misconfigurations.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on 'Logs'.

3. In the 'Log groups' section, you will see a list of all your log groups. 

4. For each log group, check the 'Expire Events After' column. This column shows the retention period for each log group. If the retention period is set to 'Never Expire', it means that the log data is kept indefinitely and this could be a potential misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install and configure AWS CLI on your local system. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all CloudWatch Log Groups: Use the following AWS CLI command to list all the CloudWatch Log Groups in your AWS account:

   ```
   aws logs describe-log-groups
   ```

   This command will return a JSON object that contains information about all the CloudWatch Log Groups in your AWS account.

3. Check the retention period: In the returned JSON object, look for the "retentionInDays" attribute for each Log Group. This attribute indicates the retention period for the Log Group. If the "retentionInDays" attribute is not set or is set to a value that is too high or too low, it indicates a misconfiguration.

4. Use a script to automate the process: If you have a large number of Log Groups, it might be more efficient to use a Python script to automate the process of checking the retention period. You can use the boto3 library, which is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, to interact with AWS services. Here is a simple script that lists all Log Groups and their retention periods:

   ```python
   import boto3

   # Create a CloudWatch client
   client = boto3.client('logs')

   # List all log groups
   response = client.describe_log_groups()

   for log_group in response['logGroups']:
       print('Log Group Name:', log_group['logGroupName'])
       print('Retention Period:', log_group.get('retentionInDays', 'Not set'))
   ```
   
   This script will print the name and retention period of each Log Group. If the retention period is not set, it will print "Not set".
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION_NAME'
)
```

3. Use the CloudWatch client from boto3 to list all the log groups:

```python
cloudwatch_logs = session.client('logs')

response = cloudwatch_logs.describe_log_groups()
```

4. Iterate over the log groups and check the retention period. If the retention period is not set or is set to a value that is not acceptable based on your organization's policy, print a message:

```python
for log_group in response['logGroups']:
    if 'retentionInDays' not in log_group or log_group['retentionInDays'] < YOUR_MIN_RETENTION_DAYS:
        print(f"Log group {log_group['logGroupName']} has a misconfigured retention period.")
```

Replace `YOUR_MIN_RETENTION_DAYS` with the minimum acceptable retention period in days according to your organization's policy.

Please note that you need to replace `'YOUR_ACCESS_KEY'`, `'YOUR_SECRET_KEY'`, and `'YOUR_REGION_NAME'` with your actual AWS credentials and region name.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of CloudWatch Log Group retention period in AWS, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/) and login to your account.

2. **Navigate to CloudWatch**: Click on the "Services" dropdown at the top of the page, search for "CloudWatch" in the search bar, and click on the CloudWatch service.

3. **Select Log Groups**: In the CloudWatch dashboard, click on "Log groups" in the left-hand menu to view all the log groups in your account.

4. **Find the Log Group**: Locate the log group for which you want to review or update the retention period. You can use the search bar to find the log group quickly.

5. **Update Retention Period**:
   - Click on the log group name to open the log group details.
   - In the log group details page, click on the "Edit" button next to the "Retention settings" section.
   - Update the retention period as per your requirements. You can choose a value between 1 day to 10 years or select "Never Expire" if you want to retain logs indefinitely.
   - Click on the "Save changes" button to apply the new retention period.

6. **Verify the Changes**: Once you have updated the retention period, you can verify the changes by checking the "Retention settings" section in the log group details.

By following these steps, you can remediate the misconfiguration of the CloudWatch Log Group retention period in AWS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the CloudWatch Loggroup retention period misconfiguration in AWS using the AWS CLI, follow these steps:

1. List all the CloudWatch log groups to identify the ones with retention periods that need to be reviewed:
```bash
aws logs describe-log-groups
```

2. Identify the log group for which you want to update the retention period.

3. Update the retention period for the identified log group using the following command:
```bash
aws logs put-retention-policy --log-group-name YOUR_LOG_GROUP_NAME --retention-in-days YOUR_RETENTION_PERIOD
```
Replace `YOUR_LOG_GROUP_NAME` with the name of the log group you want to update and `YOUR_RETENTION_PERIOD` with the desired retention period in days.

For example, to set the retention period of a log group named "my-log-group" to 30 days, you would run:
```bash
aws logs put-retention-policy --log-group-name my-log-group --retention-in-days 30
```

4. Verify that the retention period has been updated successfully by describing the log group again:
```bash
aws logs describe-log-groups --log-group-name YOUR_LOG_GROUP_NAME
```

By following these steps, you can remediate the CloudWatch Loggroup retention period misconfiguration in AWS using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the CloudWatch Loggroup retention period misconfiguration in AWS using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already:
```
pip install boto3
```

2. Use the following Python script to update the retention period for the CloudWatch Loggroup:

```python
import boto3

# Initialize the CloudWatch Logs client
client = boto3.client('logs')

# Specify the Log Group name and the desired retention period in days
log_group_name = 'YOUR_LOG_GROUP_NAME'
retention_days = YOUR_DESIRED_RETENTION_DAYS

# Update the retention policy for the Log Group
response = client.put_retention_policy(
    logGroupName=log_group_name,
    retentionInDays=retention_days
)

print(f"Retention period for Log Group {log_group_name} updated to {retention_days} days.")
```

3. Replace `'YOUR_LOG_GROUP_NAME'` with the name of the CloudWatch Log Group you want to update and `YOUR_DESIRED_RETENTION_DAYS` with the desired retention period in days.

4. Run the Python script to update the retention period for the specified CloudWatch Log Group.

After following these steps, the retention period for the specified CloudWatch Log Group will be updated to the desired value, remediating the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

