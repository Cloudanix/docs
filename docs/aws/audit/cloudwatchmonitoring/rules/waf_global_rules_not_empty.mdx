---
slug: waf_global_rules_not_empty
title: WAF Global Rules Should Not Be Empty
sidebar_label: WAF Global Rules Should Not Be Empty
---

### More Info:

WAF rule groups should not be empty

### Risk Level

High

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent WAF Global Rules from being empty in AWS CloudWatch using the AWS Management Console, follow these steps:

1. **Navigate to AWS WAF Console:**
   - Sign in to the AWS Management Console.
   - Open the AWS WAF console at [https://console.aws.amazon.com/waf/](https://console.aws.amazon.com/waf/).

2. **Create or Select a Web ACL:**
   - If you don't have a Web ACL, click on "Create web ACL" and follow the prompts to create one.
   - If you already have a Web ACL, select it from the list.

3. **Add Rules to the Web ACL:**
   - In the Web ACL details page, navigate to the "Rules" section.
   - Click on "Add rules" and choose the type of rule you want to add (e.g., managed rule groups, your own rules, or AWS Marketplace rules).
   - Configure the rules as needed and add them to the Web ACL.

4. **Save and Apply Changes:**
   - After adding the necessary rules, review the configuration.
   - Click on "Save" to apply the changes to the Web ACL.

By ensuring that your Web ACL has rules configured, you prevent the WAF Global Rules from being empty, thereby enhancing your security posture.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration "WAF Global Rules Should Not Be Empty" in AWS using the AWS CLI, you need to ensure that your Web Application Firewall (WAF) has rules defined. Here are the steps to achieve this:

1. **Create a Web ACL:**
   First, create a Web ACL if you don't already have one. This Web ACL will be used to associate rules.

   ```sh
   aws wafv2 create-web-acl --name <web-acl-name> --scope GLOBAL --default-action Allow={} --visibility-config SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=<metric-name> --region <region>
   ```

2. **Create a Rule:**
   Create a rule that you want to add to your Web ACL. For example, you can create a rate-based rule to limit the number of requests from a single IP address.

   ```sh
   aws wafv2 create-rule --name <rule-name> --scope GLOBAL --visibility-config SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=<metric-name> --statement RateBasedStatement={Limit=1000,AggregateKeyType=IP} --action Block={} --region <region>
   ```

3. **Associate the Rule with the Web ACL:**
   Once you have created the rule, you need to associate it with your Web ACL.

   ```sh
   aws wafv2 update-web-acl --name <web-acl-name> --scope GLOBAL --default-action Allow={} --visibility-config SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=<metric-name> --rules "RuleArn=<rule-arn>,Priority=1,Action={Block={}},VisibilityConfig={SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=<metric-name>}" --region <region>
   ```

4. **Verify the Configuration:**
   Finally, verify that the Web ACL has the rule associated with it.

   ```sh
   aws wafv2 get-web-acl --name <web-acl-name> --scope GLOBAL --region <region>
   ```

Replace `<web-acl-name>`, `<rule-name>`, `<metric-name>`, `<rule-arn>`, and `<region>` with your specific values. This will ensure that your WAF Global Rules are not empty and are properly configured.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of having empty WAF (Web Application Firewall) Global Rules in AWS CloudWatch using Python scripts, you can follow these steps:

1. **Set Up AWS SDK for Python (Boto3):**
   - Ensure you have the AWS SDK for Python (Boto3) installed. If not, you can install it using pip:
     ```bash
     pip install boto3
     ```

2. **Create a WAF Client:**
   - Initialize a WAF client using Boto3 to interact with AWS WAF.
     ```python
     import boto3

     waf_client = boto3.client('waf')
     ```

3. **Check and Update WAF Global Rules:**
   - Write a function to check if the WAF Global Rules are empty and update them if necessary.
     ```python
     def ensure_waf_global_rules_not_empty(web_acl_id):
         response = waf_client.get_web_acl(
             WebACLId=web_acl_id
         )
         
         rules = response['WebACL']['Rules']
         
         if not rules:
             # Add a default rule or a specific rule to ensure it's not empty
             default_rule = {
                 'Action': {'Type': 'ALLOW'},
                 'Priority': 1,
                 'RuleId': 'example-rule-id',  # Replace with your actual rule ID
                 'Type': 'REGULAR'
             }
             
             waf_client.update_web_acl(
                 WebACLId=web_acl_id,
                 ChangeToken=waf_client.get_change_token()['ChangeToken'],
                 Updates=[
                     {
                         'Action': 'INSERT',
                         'ActivatedRule': default_rule
                     }
                 ]
             )
             print("Added default rule to WAF Global Rules.")
         else:
             print("WAF Global Rules are not empty.")
     ```

4. **Execute the Script:**
   - Call the function with the appropriate WebACL ID to ensure the WAF Global Rules are not empty.
     ```python
     web_acl_id = 'your-web-acl-id'  # Replace with your actual WebACL ID
     ensure_waf_global_rules_not_empty(web_acl_id)
     ```

By following these steps, you can programmatically ensure that your WAF Global Rules are not empty, thus preventing the misconfiguration using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the AWS WAF & Shield service.

2. In the navigation pane, select "WebACLs". This will display a list of all your Web Access Control Lists (WebACLs).

3. Select the WebACL that you want to check. This will open the details page for that WebACL.

4. In the "Rules" section, check if there are any global rules applied. If the section is empty, it means that no global rules are applied, indicating a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "aws waf list-web-acls" command to list all the WebACLs in your AWS account. The command is as follows:

   ```
   aws waf list-web-acls --limit 100
   ```
   This command will return a list of WebACLs with their IDs.

3. Now, for each WebACL ID, you can use the "aws waf get-web-acl" command to get the details of the WebACL. The command is as follows:

   ```
   aws waf get-web-acl --web-acl-id <WebACL_ID>
   ```
   Replace `<WebACL_ID>` with the ID of the WebACL you want to check. This command will return the details of the WebACL including the rules.

4. Finally, you can check the "Rules" field in the output of the previous command. If the "Rules" field is empty, then the WAF Global Rules are empty for that WebACL. If the "Rules" field is not empty, then the WAF Global Rules are not empty for that WebACL.
</Accordion>

<Accordion title='Using Python'>
To check if WAF Global Rules are not empty in AWS CloudWatch using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **Create a Python Script to List WAF Rules:**
   You can use the `list_rules` method of the WAF client in Boto3 to list all the WAF rules. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('waf')

   response = client.list_rules()

   print(response)
   ```
   This script will print all the WAF rules.

3. **Check if WAF Global Rules are Empty:**
   You can modify the above script to check if the WAF Global Rules are empty. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('waf')

   response = client.list_rules()

   for rule in response['Rules']:
       if not rule['Predicates']:
           print(f"Rule {rule['RuleId']} is empty.")
   ```
   This script will print the IDs of all the rules that are empty.

4. **Run the Python Script:**
   Finally, you can run the Python script using the following command:
   ```
   python script_name.py
   ```
   Replace `script_name.py` with the name of your Python script. The script will print the IDs of all the WAF Global Rules that are empty.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of empty WAF Global Rules in AWS CloudWatch using the AWS Management Console, follow these step-by-step instructions:

1. **Login to AWS Console**: Navigate to the AWS Management Console (https://aws.amazon.com/) and log in using your credentials.

2. **Go to AWS WAF Service**: Click on the "Services" dropdown menu at the top of the page, search for "WAF & Shield" under the Security, Identity, & Compliance section, and click on it.

3. **Select the AWS WAF Web ACL**: In the AWS WAF & Shield console, locate and click on the Web ACLs option on the left-hand side menu.

4. **Choose the Web ACL**: Select the Web ACL that you want to update by clicking on its name.

5. **Edit the Web ACL**: In the Web ACL details page, click on the "Edit" button to make changes to the Web ACL configuration.

6. **Add Global Rules**: Scroll down to the Rules section of the Web ACL configuration. If the Global Rules section is empty, click on the "Add rules" button to add new global rules.

7. **Configure Global Rules**: In the Add rules dialog box, configure the necessary rules for your Web ACL. You can add rules based on IP addresses, country, request headers, or other criteria to protect your web applications.

8. **Save Changes**: After adding the required global rules, click on the "Add" or "Save" button to save the changes to the Web ACL.

9. **Review Changes**: Review the updated Web ACL configuration to ensure that the Global Rules are no longer empty.

10. **Test the Web ACL**: Test the updated Web ACL to verify that the global rules are effectively protecting your web applications.

By following these steps, you should be able to remediate the misconfiguration of empty WAF Global Rules in AWS CloudWatch using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of WAF Global Rules being empty in AWS CloudWatch using AWS CLI, follow these steps:

1. List the current WAF global rules in your AWS account to identify if there are any empty rules:
```bash
aws wafv2 list-rules --scope REGIONAL --query 'Rules[?DefaultAction.RuleActionName==`ALLOW` && count(Statements)==`0`]'
```

2. Identify the ARN of the empty WAF global rule that needs to be updated.

3. Update the empty WAF global rule with a valid rule statement. You can create a new rule statement using the AWS CLI or AWS Management Console. Here is an example of creating a new rule statement using AWS CLI:
```bash
aws wafv2 update-rule --name "YOUR_RULE_NAME" --scope REGIONAL --id YOUR_RULE_ID --description "YOUR_RULE_DESCRIPTION" --action "ALLOW" --statements "Statement={YOUR_STATEMENT_HERE}"
```

4. Validate the changes by listing the rules again to ensure the WAF global rule is no longer empty:
```bash
aws wafv2 list-rules --scope REGIONAL --query 'Rules[?RuleId==`YOUR_RULE_ID`]'
```

5. Monitor the WAF global rules regularly to ensure they are not empty and are effectively protecting your resources.

By following these steps, you can remediate the misconfiguration of empty WAF global rules in AWS CloudWatch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of empty WAF Global Rules in AWS CloudWatch using Python, you can follow these steps:

1. Install the necessary Python libraries:
```bash
pip install boto3
```

2. Use the following Python script to check if there are any empty WAF Global Rules and update them if found:

```python
import boto3

# Initialize the AWS WAF client
waf_client = boto3.client('waf')

# Get a list of all WAF Global Rules
response = waf_client.list_rules()

# Check if there are any empty WAF Global Rules
empty_rules = [rule['RuleId'] for rule in response['Rules'] if not rule['Predicates']]

# If there are empty WAF Global Rules, update them
if empty_rules:
    for rule_id in empty_rules:
        # Get the details of the empty rule
        rule_details = waf_client.get_rule(RuleId=rule_id)
        
        # Add a sample predicate to the rule (you can customize this as needed)
        updated_rule = {
            'RuleId': rule_id,
            'ChangeToken': waf_client.get_change_token()['ChangeToken'],
            'Updates': [
                {
                    'Action': 'INSERT',
                    'Predicate': {
                        'Negated': False,
                        'Type': 'IPMatch',
                        'DataId': 'SampleIPSetId'  # Replace this with a valid IPSetId
                    }
                }
            ]
        }
        
        # Update the rule with the sample predicate
        waf_client.update_rule(**updated_rule)
        
        print(f'Updated WAF Global Rule {rule_id} with a sample predicate')

else:
    print('No empty WAF Global Rules found')
```

3. Replace `'SampleIPSetId'` with a valid IPSetId and customize the predicate as needed.

4. Run the Python script to check for and update any empty WAF Global Rules in AWS CloudWatch.

This script will help you identify any empty WAF Global Rules and update them with a sample predicate. Make sure to customize the predicate data according to your specific requirements.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>

