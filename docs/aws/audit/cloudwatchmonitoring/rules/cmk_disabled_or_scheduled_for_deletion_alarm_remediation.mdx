

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Alarms".

3. In the "Alarms" dashboard, you can see all the alarms that have been set up. Look for the CMK Disabled or Scheduled for Deletion Alarm. If it's not there, it means it hasn't been set up.

4. To confirm the alarm's status, click on the alarm name. In the "Alarm details" section, you can see the state of the alarm. If the state is "INSUFFICIENT_DATA", it means the alarm is not receiving data. If the state is "OK", it means the alarm is currently not triggered. If the state is "ALARM", it means the alarm has been triggered.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is installed and configured, you can use the following command to list all the CloudWatch alarms:

   ```
   aws cloudwatch describe-alarms
   ```

   This command will return a list of all the alarms in your AWS account.

3. To check for a specific alarm, you can use the following command:

   ```
   aws cloudwatch describe-alarms --alarm-names "CMK Disabled or Scheduled for Deletion"
   ```

   Replace "CMK Disabled or Scheduled for Deletion" with the name of the alarm you are looking for. This command will return the details of the specified alarm.

4. If the alarm is not found or if it is not in the 'ALARM' state, then it means that the CMK is either disabled or scheduled for deletion. You can check the 'StateValue' field in the output to determine the state of the alarm. If the 'StateValue' is 'ALARM', then the CMK is either disabled or scheduled for deletion. If the 'StateValue' is 'OK', then the CMK is not disabled or scheduled for deletion.

#### Using Python

To check for CMK (Customer Master Key) Disabled or Scheduled for Deletion Alarm in Cloud Watch using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Set up your environment**: Before you start, make sure you have Python and Boto3 installed in your environment. You also need to configure your AWS credentials. You can do this by using the AWS CLI and running `aws configure`.

2. **Import necessary libraries**: Import the necessary Python libraries. You will need the `boto3` library for interacting with AWS services.

    ```python
    import boto3
    ```

3. **Create a CloudWatch client**: Create a CloudWatch client using Boto3. This client will allow you to interact with the CloudWatch service.

    ```python
    cloudwatch = boto3.client('cloudwatch')
    ```

4. **Check for CMK Disabled or Scheduled for Deletion Alarm**: Use the `describe_alarms` function to retrieve information about your alarms. You can filter the results to only include alarms related to CMKs. If the `StateValue` of an alarm is `ALARM`, it means the alarm's conditions are met.

    ```python
    def check_cmk_alarm():
        response = cloudwatch.describe_alarms(
            AlarmNames=['CMK Disabled', 'CMK Scheduled for Deletion']
        )
        for alarm in response['MetricAlarms']:
            if alarm['StateValue'] == 'ALARM':
                print(f"Alarm {alarm['AlarmName']} is in ALARM state")
    check_cmk_alarm()
    ```

This script will print out the names of the alarms that are in the `ALARM` state. If no alarms are in the `ALARM` state, it will not print anything. This means that there are no CMKs that are disabled or scheduled for deletion.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the CMK Disabled or Scheduled for Deletion alarm in AWS using the AWS console, you can follow the below steps:

1. Login to your AWS account and navigate to the AWS KMS console.

2. Click on the "Customer managed keys" option from the left-hand side menu.

3. Identify the key that is disabled or scheduled for deletion.

4. To enable a disabled key, select the key and click on the "Enable" button from the top menu. 

5. To cancel the scheduled deletion of a key, select the key and click on the "Cancel key deletion" button from the top menu.

6. After completing the above steps, verify that the key status has changed to "Enabled" or "Pending import" and the alarm should automatically clear.

7. If the alarm does not clear, check the SNS topic that is associated with the alarm to ensure that it is configured correctly.

By following these steps, you can remediate the CMK Disabled or Scheduled for Deletion alarm in AWS using the AWS console.

#### Using CLI

The CMK (Customer Master Key) Disabled or Scheduled for Deletion alarm indicates that a CMK in AWS has been disabled or scheduled for deletion. This misconfiguration can lead to data loss or unauthorized access to encrypted data. Here are the steps to remediate this issue using AWS CLI:

1. Identify the CMK that has been disabled or scheduled for deletion. You can use the following command to list all the CMKs in your AWS account:

```
aws kms list-keys
```

2. Check the status of each CMK to identify the one that has been disabled or scheduled for deletion. You can use the following command to describe the key state of a CMK:

```
aws kms describe-key --key-id <key-id>
```

Replace `<key-id>` with the ID of the CMK that you want to check.

3. Reactivate the disabled CMK or cancel the scheduled deletion of the CMK. You can use the following command to enable a disabled CMK:

```
aws kms enable-key --key-id <key-id>
```

Replace `<key-id>` with the ID of the disabled CMK that you want to enable.

4. If the CMK has been scheduled for deletion, you can cancel the deletion using the following command:

```
aws kms cancel-key-deletion --key-id <key-id>
```

Replace `<key-id>` with the ID of the CMK that you want to cancel the deletion for.

5. Verify that the CMK is active and not scheduled for deletion. You can use the following command to describe the key state of the CMK again:

```
aws kms describe-key --key-id <key-id>
```

Replace `<key-id>` with the ID of the CMK that you want to verify.

Once you have completed these steps, the CMK Disabled or Scheduled for Deletion alarm should be resolved. It is recommended to regularly monitor your AWS account for this type of misconfiguration and take necessary actions to remediate it.

#### Using Python

To remediate the CMK Disabled or Scheduled for Deletion Alarm in AWS using Python, you can follow the below steps:

1. First, you need to check the status of the CMK using the `describe_key` method of the AWS KMS client. This method returns the metadata for the specified customer master key (CMK).

   ```python
   import boto3

   # Create a KMS client
   kms = boto3.client('kms')

   # Get the CMK metadata
   key_id = 'your-cmk-id'
   key_metadata = kms.describe_key(KeyId=key_id)
   ```

2. Check the `KeyState` attribute of the CMK metadata. If it is set to `Disabled` or `PendingDeletion`, then the CMK is disabled or scheduled for deletion.

   ```python
   key_state = key_metadata['KeyMetadata']['KeyState']

   if key_state == 'Disabled':
       # Enable the CMK
       kms.enable_key(KeyId=key_id)
       print('CMK enabled successfully.')
   elif key_state == 'PendingDeletion':
       # Cancel the scheduled deletion of the CMK
       kms.cancel_key_deletion(KeyId=key_id)
       print('Scheduled deletion of CMK cancelled successfully.')
   else:
       print('CMK is already enabled and not scheduled for deletion.')
   ```

3. If the `KeyState` attribute is not set to `Disabled` or `PendingDeletion`, then the CMK is already enabled and not scheduled for deletion.

   ```python
   else:
       print('CMK is already enabled and not scheduled for deletion.')
   ```

By following these steps, you can remediate the CMK Disabled or Scheduled for Deletion Alarm in AWS using Python.


</Tab>
</Tabs>