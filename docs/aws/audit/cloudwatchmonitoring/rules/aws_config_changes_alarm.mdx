---
slug: aws_config_changes_alarm
title: AWS Config Changes Alarm
sidebar_label: AWS Config Changes Alarm
---

### More Info:

AWS Config configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, AWSWAF, HITRUST, CISAWSF, PCI, GDPR, APRA, MAS, NISTCSF, CBP, NIST4

### Triage and Remediation

<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CloudWatch service. 

2. In the CloudWatch dashboard, click on "Alarms" in the left-hand navigation pane. This will display a list of all the alarms that have been configured.

3. Look for the AWS Config Changes Alarm in the list. If the alarm is in the "ALARM" state, it means that the changes in AWS Config have triggered the alarm. 

4. To get more details about the alarm, click on the alarm name. This will open a new page where you can see the metrics and conditions that are associated with the alarm. You can also see the history of the alarm, which includes the times when the alarm state changed and the reason for the change.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all CloudWatch alarms: You can use the `describe-alarms` command to list all the CloudWatch alarms in your AWS account. The command is as follows:

   ```
   aws cloudwatch describe-alarms
   ```

   This command will return a list of all the CloudWatch alarms along with their details.

3. Filter AWS Config Changes Alarm: If you want to check a specific alarm, for example, AWS Config Changes Alarm, you can filter the results using the `--alarm-names` option followed by the name of the alarm. The command is as follows:

   ```
   aws cloudwatch describe-alarms --alarm-names "AWS Config Changes Alarm"
   ```

   This command will return the details of the AWS Config Changes Alarm.

4. Check the state of the alarm: The state of the alarm can be checked in the output of the above command. Look for the `StateValue` field in the output. If the state is `OK`, it means that no misconfigurations are detected. If the state is `ALARM`, it means that a misconfiguration is detected.
</Accordion>

<Accordion title='Using Python'>
1. **Install AWS SDK for Python (Boto3):** To interact with AWS services, you need to install Boto3. You can install it using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS Credentials:** Before you can interact with AWS services, you need to set up authentication credentials for your AWS account using the AWS CLI. If you have the AWS CLI installed, then you can use it to configure your credentials file:
   ```
   aws configure
   ```
   Alternatively, you can create the credential file yourself. By default, its location is at `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. **Create a Python Script to Check AWS Config Changes Alarm in Cloud Watch:**
   ```python
   import boto3

   def check_config_changes_alarm():
       client = boto3.client('cloudwatch')
       response = client.describe_alarms()
       alarms = response['MetricAlarms']
       for alarm in alarms:
           if alarm['AlarmName'] == 'ConfigChangesAlarm':
               return alarm['StateValue']

   alarm_state = check_config_changes_alarm()
   print(f'ConfigChangesAlarm state: {alarm_state}')
   ```
   This script creates a CloudWatch client, retrieves all the alarms, and checks if there is an alarm named 'ConfigChangesAlarm'. If it exists, it prints the state of the alarm.

4. **Run the Python Script:** Finally, run the python script. If the 'ConfigChangesAlarm' is properly configured and no changes have been detected, the script should print 'OK'. If changes have been detected, it will print 'ALARM'. If the alarm is not configured correctly, it will print 'INSUFFICIENT_DATA'.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
AWS Config Changes Alarm is triggered when certain critical changes are made to the AWS Config settings. To ensure compliance, follow these steps to create a CloudWatch alarm to monitor AWS Config changes:

1. Sign in to the AWS Management Console.

2. Navigate to the **CloudWatch** dashboard at: [https://console.aws.amazon.com/cloudwatch/](https://console.aws.amazon.com/cloudwatch/).

3. In the left navigation panel, select **Logs**.

4. Select the log group created for your CloudTrail event logs and click **Create Metric Filter**.

5. On the **Define Logs Metric Filter** page, enter the following pattern in the **Filter Pattern** box:

```
{
    ($.eventSource = config.amazonaws.com) && (($.eventName = StopConfigurationRecorder)||($.eventName = DeleteDeliveryChannel)||($.eventName = PutDeliveryChannel)||($.eventName = PutConfigurationRecorder))
}
```

6. Review the metric filter configuration and click **Assign Metric**.

7. On the **Create Metric Filter and Assign a Metric** page:

   - In the **Filter Name** box, enter a unique name like `AWSConfigChanges`.
   - In the **Metric Namespace** box, type `CloudTrailMetrics`.
   - In the **Metric Name** box, type `ConfigEventCount`.
   - Click **Show advanced metric settings**, then enter `1` in the **Metric Value** box.

8. Review the details and click **Create Filter** to generate the metric filter.

9. On the next page, click **Create Alarm**.

10. In the **Create Alarm** dialog box:

    - Provide a unique name and short description for the alarm.
    - Under **Whenever: Metric Name**, select `>=` from the dropdown and enter `1` as the threshold value.
    - Under **Actions**, click the `+ Notification` button and choose the SNS topic for alarm notifications.
    - Set the **Period** to `5 Minutes` and **Statistic** to `Sum`.

11. Review the configuration and click **Create Alarm**. Once created, the alarm will be listed on the **Alarms** page.

#

</Accordion>

<Accordion title='Using CLI'>
The AWS Config Changes Alarm checks for specific configuration changes within your AWS account and triggers alerts. You can use the following AWS CLI commands to create the necessary metric filter and alarm:

1. Run the following command to create a CloudWatch metric filter and associate it with the appropriate CloudTrail log group:

```bash
aws logs put-metric-filter
    --region us-east-1
    --log-group-name CloudTrail/CloudWatchLogGroup
    --filter-name AWSConfigChanges
    --filter-pattern '{ ($.eventSource = config.amazonaws.com) && (($.eventName = StopConfigurationRecorder)||($.eventName = DeleteDeliveryChannel)||($.eventName = PutDeliveryChannel)||($.eventName = PutConfigurationRecorder)) }'
    --metric-transformations metricName=ConfigEventCount,metricNamespace=CloudTrailMetrics,metricValue=1
```

2. Run the following command to create the CloudWatch alarm:

```bash
aws cloudwatch put-metric-alarm
    --region us-east-1
    --alarm-name AWSConfigChangesAlarm
    --alarm-description "Triggered by AWS Config changes."
    --metric-name ConfigEventCount
    --namespace CloudTrailMetrics
    --statistic Sum
    --comparison-operator GreaterThanOrEqualToThreshold
    --evaluation-periods 1
    --period 300
    --threshold 1
    --actions-enabled
    --alarm-actions arn:aws:sns:us-east-1:123456789012
```

3. If the rule is non-compliant, create an alarm for AWS Config changes using the AWS CLI:

```
aws cloudwatch put-metric-alarm --alarm-name AWS-Config-Changes-Alarm --alarm-description "Alarm for AWS Config Changes" --metric-name ConfigurationChanges --namespace AWS/Config --statistic Sum --period 300 --threshold 1 --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --alarm-actions <your-SNS-topic-ARN>
```

Note: Replace `<your-SNS-topic-ARN>` with the ARN of the SNS topic you want to receive the alarm notifications.

4. Once completed, verify the alarm setup by listing the alarms:

```
aws cloudwatch describe-alarms --alarm-names AWSConfigChangesAlarm
```

5. Finally, check whether the `AWS Config Changes Alarm` is triggered and working as expected:

```
aws configservice get-compliance-details-by-config-rule --config-rule-name AWS-Config-Changes-Alarm
```

#

</Accordion>

<Accordion title='Using Python'>
You can also automate the monitoring of AWS Config changes by setting up a Python-based Lambda function that triggers based on a CloudWatch alarm. Hereâ€™s an example:

1. Create an AWS Lambda function and use Python 3.x as the runtime.

2. Assign the necessary AWS Config trigger permissions to the Lambda function.

3. Use the following Python code to monitor and act on configuration changes:

```python
import boto3

def lambda_handler(event, context):
    cloudwatch = boto3.client('cloudwatch')

    # Logic to handle AWS Config changes
    if 'detail' in event and 'eventName' in event['detail']:
        event_name = event['detail']['eventName']

        if event_name in ['StopConfigurationRecorder', 'DeleteDeliveryChannel', 'PutDeliveryChannel', 'PutConfigurationRecorder']:
            response = cloudwatch.put_metric_alarm(
                AlarmName='AWSConfigChangesAlarm',
                ComparisonOperator='GreaterThanOrEqualToThreshold',
                EvaluationPeriods=1,
                MetricName='ConfigEventCount',
                Namespace='CloudTrailMetrics',
                Period=300,
                Statistic='Sum',
                Threshold=1,
                ActionsEnabled=True,
                AlarmActions=['arn:aws:sns:us-east-1:123456789012:CloudWatchAlarmSNSTopic'],
                AlarmDescription='Triggered by AWS Config changes.'
            )
            return response
        else:
            print("Event is not related to AWS Config changes.")
    else:
        print("No event details found.")
```

4. Test and deploy the Lambda function. Ensure that the necessary permissions and triggers are configured correctly.

By following these steps, you can automate the monitoring of AWS Config changes using Python and CloudWatch.

</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/config/latest/developerguide/monitor-config-with-cloudwatchevents.html](https://docs.aws.amazon.com/config/latest/developerguide/monitor-config-with-cloudwatchevents.html)
- [https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudWatchLogs/aws-config-changes-alarm.html](https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudWatchLogs/aws-config-changes-alarm.html)
