---
slug: internet_gateway_changes_alarm
title: Internet Gateway Changes Alarm
sidebar_label: Internet Gateway Changes Alarm
---

### More Info:

AWS VPC Customer/Internet Gateway configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, HIPAA, ISO27001, AWSWAF, HITRUST, CISAWS, CBP, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to your AWS Management Console and navigate to the CloudWatch service. 

2. In the CloudWatch dashboard, click on "Alarms" in the left-hand navigation pane. This will display a list of all the alarms that have been configured.

3. Look for the Internet Gateway Changes Alarm in the list. If the alarm is in the "ALARM" state, it means that the changes have been detected in the Internet Gateway. The "INSUFFICIENT_DATA" state means that the alarm has been configured but the metric is not providing data, and the "OK" state means that no changes have been detected.

4. Click on the name of the alarm to view more details about it. This will show you the metric that the alarm is based on, the threshold that triggers the alarm, the actions that are taken when the alarm state changes, and the alarm's history. The alarm's history can be particularly useful for identifying when and why the alarm state changed.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "describe-alarms" command to list all the alarms in your AWS account. The command is as follows:

   ```
   aws cloudwatch describe-alarms
   ```

   This command will return a list of all the alarms in your AWS account, including their names, states, and other information.

3. To check for a specific alarm, you can use the "describe-alarms" command with the "--alarm-names" option followed by the name of the alarm. For example, if the name of the alarm is "InternetGatewayChanges", the command would be:

   ```
   aws cloudwatch describe-alarms --alarm-names "InternetGatewayChanges"
   ```

   This command will return information about the "InternetGatewayChanges" alarm, including its state and any associated actions.

4. If you want to check the history of the alarm, you can use the "describe-alarm-history" command with the "--alarm-name" option followed by the name of the alarm. The command is as follows:

   ```
   aws cloudwatch describe-alarm-history --alarm-name "InternetGatewayChanges"
   ```

   This command will return the history of the "InternetGatewayChanges" alarm, including when it was triggered and any changes to its state or configuration.

#### Using Python

1. **Install Boto3**: Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```python
   pip install boto3
   ```

2. **Configure AWS Credentials**: Before you can begin using Boto3, you need to set up authentication credentials. You can do this by creating a new IAM user in your AWS console, then set your credentials in the AWS credentials file, which is located by default at `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. **Create a Python Script to Check Internet Gateway Changes**: You can use the `describe_alarms` method from the CloudWatch client in Boto3 to retrieve information about your CloudWatch alarms. Here's a simple script that prints out the names of all alarms related to Internet Gateway changes:

   ```python
   import boto3

   # Create a CloudWatch client
   cloudwatch = boto3.client('cloudwatch')

   # List alarms of insufficient data through the pagination interface
   paginator = cloudwatch.get_paginator('describe_alarms')

   for response in paginator.paginate(StateValue='INSUFFICIENT_DATA'):
       for alarm in response['MetricAlarms']:
           if 'InternetGateway' in alarm['AlarmName']:
               print(alarm['AlarmName'])
   ```

4. **Run the Python Script**: Finally, you can run the script using a Python interpreter. If the script doesn't return any results, it means there are no alarms related to Internet Gateway changes. If it does return results, these are the names of the alarms you should investigate further.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the "Internet Gateway Changes Alarm" misconfiguration in AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the CloudWatch service.
3. In the left-hand menu, click on "Alarms".
4. Locate the "Internet Gateway Changes Alarm" from the list of alarms and select it.
5. Click on the "Actions" dropdown menu and select "Disable Alarm".
6. Confirm that you want to disable the alarm by clicking "Yes, Disable".
7. If you want to permanently remove the alarm, select the alarm again and click on the "Actions" dropdown menu and select "Delete Alarm".
8. Confirm that you want to delete the alarm by clicking "Yes, Delete".

Once you have completed these steps, the "Internet Gateway Changes Alarm" will be remediated in AWS. It is important to note that disabling or deleting an alarm will prevent you from receiving notifications if the alarm is triggered in the future. Therefore, it is recommended to review the alarm settings and adjust them accordingly to avoid future misconfigurations.

#### Using CLI

The "Internet Gateway Changes Alarm" indicates that changes have been made to the internet gateway in your AWS environment. To remediate this issue using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to describe the internet gateways in your AWS environment:

```
aws ec2 describe-internet-gateways
```

3. Identify the internet gateway that has been changed by comparing the output of the above command with the previous state of your environment.

4. Run the following command to delete the internet gateway:

```
aws ec2 delete-internet-gateway --internet-gateway-id <internet_gateway_id>
```

Note: Replace `<internet_gateway_id>` with the ID of the internet gateway that has been changed.

5. If the internet gateway was deleted by mistake, run the following command to create a new internet gateway:

```
aws ec2 create-internet-gateway
```

6. Attach the new internet gateway to your VPC using the following command:

```
aws ec2 attach-internet-gateway --internet-gateway-id <new_internet_gateway_id> --vpc-id <vpc_id>
```

Note: Replace `<new_internet_gateway_id>` with the ID of the new internet gateway that was created and `<vpc_id>` with the ID of your VPC.

7. Verify that the internet gateway has been remediated by running the describe-internet-gateways command again and checking that the internet gateway is attached to your VPC.

#### Using Python

The misconfiguration "Internet Gateway Changes Alarm" in AWS can occur when there is a change in the Internet Gateway associated with the VPC. To remediate this, you can follow these steps using Python:

1. Import the necessary modules and define the AWS client:

```
import boto3
client = boto3.client('cloudwatch')
```

2. Define the name of the alarm that needs to be remediated:

```
alarm_name = 'InternetGatewayChangesAlarm'
```

3. Get the alarm details using the `describe_alarms()` method:

```
response = client.describe_alarms(
    AlarmNames=[alarm_name]
)
```

4. Check if the alarm exists and has the correct action:

```
if len(response['MetricAlarms']) == 0:
    print(f"The alarm {alarm_name} does not exist.")
elif response['MetricAlarms'][0]['AlarmActions'] == []:
    print(f"The alarm {alarm_name} has no actions.")
else:
    print(f"The alarm {alarm_name} has actions.")
```

5. If the alarm exists and has no actions, add the necessary action using the `put_metric_alarm()` method:

```
response = client.put_metric_alarm(
    AlarmName=alarm_name,
    AlarmActions=['arn:aws:sns:us-east-1:123456789012:MyTopic'],
    MetricName='InternetGatewayAttached',
    Namespace='AWS/EC2',
    Statistic='Sum',
    Dimensions=[
        {
            'Name': 'VpcId',
            'Value': 'vpc-12345678'
        },
    ],
    Period=300,
    EvaluationPeriods=1,
    Threshold=1,
    ComparisonOperator='GreaterThanOrEqualToThreshold',
    TreatMissingData='notBreaching'
)
```

Note: Replace the `AlarmActions` value with the ARN of the SNS topic that needs to be notified.

6. Verify that the action has been added:

```
response = client.describe_alarms(
    AlarmNames=[alarm_name]
)

if response['MetricAlarms'][0]['AlarmActions'] == []:
    print(f"The alarm {alarm_name} still has no actions.")
else:
    print(f"The alarm {alarm_name} now has actions.")
```

7. If the action was successfully added, print a success message:

```
print(f"The alarm {alarm_name} has been remediated.")
```

This Python script will add an SNS topic as the action for the "Internet Gateway Changes Alarm" in AWS.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway-cloudwatch.html](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway-cloudwatch.html) 


</Tab>
</Tabs>