

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the CloudWatch service.

2. In the CloudWatch dashboard, click on "Rules" under the "Events" section in the left-hand navigation pane.

3. In the Rules page, you will see a list of all the rules that have been created. For each rule, check the "Targets" and "Event Pattern" details. If the "Event Pattern" is set to receive events from all sources (i.e., it is not restricted to specific sources), and the "Targets" include resources that are publicly accessible, then the Event Bus is exposed.

4. Additionally, check the "Permissions" tab for each rule. If the "Principal" is set to "*", this means that the rule is accessible to all AWS accounts and it is a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all the event buses: Use the following command to list all the event buses in your account:

   ```
   aws events list-event-buses
   ```

   This command will return a list of all the event buses in your account, including the default event bus and any custom event buses.

3. Describe the event bus policy: For each event bus, you can use the following command to describe its policy:

   ```
   aws events describe-event-bus --name <event-bus-name>
   ```

   Replace `<event-bus-name>` with the name of the event bus. This command will return the policy of the event bus, which includes who can send events to it.

4. Check the policy: Look at the policy of each event bus. If the policy allows the "events:PutEvents" action for the "*" principal, then the event bus is exposed. This means that any AWS account can send events to this event bus. If the policy does not allow this action for the "*" principal, then the event bus is not exposed.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) in your environment. You can do this by running the command `pip install boto3` in your terminal.

2. Import the necessary libraries and initialize the AWS CloudWatch client. Here is a sample script:

```python
import boto3

# Create CloudWatch client
cloudwatch = boto3.client('cloudwatch')
```

3. Now, you can use the `describe_alarms` method to retrieve information about all the alarms in your AWS account. You can filter the results to only include alarms related to the Event Bus. Here is a sample script:

```python
# Describe alarms
response = cloudwatch.describe_alarms()

# Filter alarms related to Event Bus
event_bus_alarms = [alarm for alarm in response['MetricAlarms'] if 'EventBus' in alarm['AlarmName']]
```

4. Finally, you can check if any of the alarms related to the Event Bus are exposed. If the `ActionsEnabled` attribute of an alarm is set to `True`, it means that the alarm is exposed. Here is a sample script:

```python
# Check if any Event Bus alarms are exposed
exposed_alarms = [alarm for alarm in event_bus_alarms if alarm['ActionsEnabled']]

# Print exposed alarms
for alarm in exposed_alarms:
    print(f"Alarm {alarm['AlarmName']} is exposed.")
```

This script will print the names of all exposed Event Bus alarms. If no alarms are printed, it means that no Event Bus alarms are exposed.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

The following are the steps to remediate the "Event Bus Should Not Be Exposed" misconfiguration on AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the Amazon EventBridge service.
3. Click on the "Event buses" option on the left-hand menu.
4. Select the event bus that is exposed.
5. Click on the "Permissions" tab.
6. Click on the "Edit" button to edit the permissions.
7. Remove any unauthorized principals or accounts from the "Event bus policy" section.
8. Click on the "Save" button to save the changes.

By following these steps, the event bus will no longer be exposed to unauthorized access and will be remediated.

#### Using CLI

To remediate the misconfiguration "Event Bus Should Not Be Exposed" for AWS using AWS CLI, you can follow the below steps:

1. Open your command prompt or terminal and install the AWS CLI if you haven't already done so.

2. Run the following command to list all the Amazon EventBridge event buses in your AWS account:

```
aws events list-event-buses
```

3. Identify the event bus that is exposed and note down its ARN.

4. Run the following command to remove the event bus policy that is allowing public access:

```
aws events remove-permission --event-bus-name <event-bus-name> --statement-id <statement-id>
```

Replace `<event-bus-name>` with the name of the event bus that you want to remediate and `<statement-id>` with the ID of the statement in the event bus policy that is allowing public access.

5. After running the above command, you should receive an output similar to the following:

```
{
    "FailedEntryCount": 0,
    "FailedEntries": []
}
```

This means that the event bus policy has been successfully updated to remove public access.

6. Finally, run the following command to verify that the event bus policy has been updated:

```
aws events describe-event-bus --name <event-bus-name>
```

Replace `<event-bus-name>` with the name of the event bus that you remediated. The output should show that the event bus policy no longer allows public access.

By following these steps, you can remediate the misconfiguration "Event Bus Should Not Be Exposed" for AWS using AWS CLI.

#### Using Python

Remediating the "Event Bus Should Not Be Exposed" misconfiguration in AWS using Python involves the following steps:

1. Identify the AWS account that has the exposed event bus.
2. Create an IAM policy that denies access to the event bus.
3. Attach the IAM policy to the AWS account.
4. Verify that the event bus is no longer exposed.

Here's an example Python code that can be used to remediate this misconfiguration:

```
import boto3

# Set the AWS region
region = 'us-east-1'

# Set the name of the exposed event bus
event_bus_name = 'exposed-event-bus'

# Create an IAM policy that denies access to the event bus
policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Deny",
            "Action": [
                "events:PutEvents",
                "events:PutRule",
                "events:PutTargets"
            ],
            "Resource": [
                "arn:aws:events:{}:{}:event-bus/{}".format(region, aws_account_id, event_bus_name)
            ]
        }
    ]
}

# Create an IAM policy with the policy document
iam = boto3.client('iam')
policy_name = 'deny-event-bus-access-policy'
policy_response = iam.create_policy(
    PolicyName=policy_name,
    PolicyDocument=json.dumps(policy)
)

# Attach the IAM policy to the AWS account
account_id = boto3.client('sts').get_caller_identity().get('Account')
iam.attach_policy(
    PolicyArn='arn:aws:iam::{}:policy/{}'.format(account_id, policy_name),
    TargetId=account_id,
    TargetType='AWSAccount'
)

# Verify that the event bus is no longer exposed
events = boto3.client('events')
try:
    response = events.describe_event_bus(Name=event_bus_name)
    if response['Policy'] != policy_name:
        response = events.put_permission(
            EventBusName=event_bus_name,
            Action='events:PutEvents',
            Principal='*'
        )
except events.exceptions.ResourceNotFoundException:
    pass
```

Note: Replace the `region`, `event_bus_name`, and `policy` variables with the appropriate values for your use case. Also, ensure that you have the necessary permissions to create IAM policies and attach them to the AWS account.


</Tab>
</Tabs>