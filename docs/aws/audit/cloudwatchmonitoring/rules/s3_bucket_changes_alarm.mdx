---
slug: s3_bucket_changes_alarm
title: S3 Bucket Changes Alarm
sidebar_label: S3 Bucket Changes Alarm
---

### More Info:

AWS S3 Buckets configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAWS, CBP, SOC2, NIST, AWSWAF, HITRUST, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent S3 Bucket Changes Alarm in CloudWatch using the AWS Management Console, follow these steps:

1. **Enable CloudTrail Logging:**
   - Go to the AWS Management Console.
   - Navigate to the CloudTrail service.
   - Create a new trail or use an existing one to log S3 bucket changes.
   - Ensure that the trail is configured to log both management and data events for S3.

2. **Create a CloudWatch Log Group:**
   - Navigate to the CloudWatch service in the AWS Management Console.
   - Go to the "Logs" section and create a new log group if one does not already exist for your S3 bucket logs.

3. **Set Up CloudWatch Metric Filter:**
   - In the CloudWatch console, go to the "Logs" section and select the log group created for S3 bucket logs.
   - Create a metric filter to search for specific S3 bucket change events (e.g., PutBucketPolicy, DeleteBucket, etc.).
   - Define the filter pattern to match the events you want to monitor and create a new metric based on this filter.

4. **Create a CloudWatch Alarm:**
   - Navigate to the "Alarms" section in the CloudWatch console.
   - Create a new alarm and select the metric created from the metric filter.
   - Configure the alarm to trigger based on your desired threshold (e.g., any occurrence of the event).
   - Set up notifications (e.g., via SNS) to alert you when the alarm is triggered.

By following these steps, you can effectively monitor and prevent unauthorized or unintended changes to your S3 buckets using CloudWatch alarms.
</Accordion>

<Accordion title='Using CLI'>
To prevent S3 Bucket Changes Alarm in CloudWatch using AWS CLI, you can follow these steps:

1. **Create an IAM Role with Necessary Permissions:**
   Ensure you have an IAM role with the necessary permissions to create CloudWatch alarms and access S3 bucket metrics.

   ```sh
   aws iam create-role --role-name CloudWatchS3Role --assume-role-policy-document file://trust-policy.json
   aws iam attach-role-policy --role-name CloudWatchS3Role --policy-arn arn:aws:iam::aws:policy/CloudWatchFullAccess
   aws iam attach-role-policy --role-name CloudWatchS3Role --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
   ```

2. **Enable S3 Bucket Metrics:**
   Enable the necessary metrics for your S3 bucket to monitor changes. This can be done by enabling the bucket-level metrics.

   ```sh
   aws s3api put-bucket-metrics-configuration --bucket your-bucket-name --id EntireBucket --metrics-configuration '{"Id": "EntireBucket"}'
   ```

3. **Create a CloudWatch Alarm:**
   Create a CloudWatch alarm to monitor the S3 bucket changes. This example sets an alarm for the `NumberOfObjects` metric.

   ```sh
   aws cloudwatch put-metric-alarm --alarm-name S3BucketChangesAlarm --metric-name NumberOfObjects --namespace AWS/S3 --statistic Sum --period 300 --threshold 1 --comparison-operator GreaterThanThreshold --evaluation-periods 1 --alarm-actions arn:aws:sns:region:account-id:your-sns-topic --dimensions Name=BucketName,Value=your-bucket-name
   ```

4. **Verify the Alarm Configuration:**
   Verify that the CloudWatch alarm has been created and is configured correctly.

   ```sh
   aws cloudwatch describe-alarms --alarm-names S3BucketChangesAlarm
   ```

By following these steps, you can set up a CloudWatch alarm to monitor changes in your S3 bucket using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent S3 Bucket Changes Alarm in CloudWatch using Python scripts, you can follow these steps:

1. **Set Up AWS SDK for Python (Boto3):**
   - Ensure you have Boto3 installed. If not, install it using pip:
     ```bash
     pip install boto3
     ```

2. **Create a CloudWatch Alarm for S3 Bucket Changes:**
   - Use Boto3 to create a CloudWatch alarm that triggers on specific S3 bucket changes. This involves setting up a metric filter and an alarm.

3. **Define the Metric Filter:**
   - Create a metric filter to capture S3 bucket changes from CloudTrail logs.

4. **Create the CloudWatch Alarm:**
   - Use the metric filter to create a CloudWatch alarm that triggers when the filter pattern is matched.

Here is a Python script to achieve this:

```python
import boto3

# Initialize boto3 clients
cloudwatch_logs_client = boto3.client('logs')
cloudwatch_client = boto3.client('cloudwatch')

# Define variables
log_group_name = 'your-cloudtrail-log-group'
filter_name = 'S3BucketChangesFilter'
filter_pattern = '{ ($.eventName = CreateBucket) || ($.eventName = DeleteBucket) || ($.eventName = PutBucketAcl) || ($.eventName = PutBucketPolicy) || ($.eventName = PutBucketCors) || ($.eventName = PutBucketLifecycle) || ($.eventName = PutBucketReplication) || ($.eventName = PutBucketTagging) || ($.eventName = PutBucketVersioning) || ($.eventName = PutBucketWebsite) }'
metric_namespace = 'S3BucketChanges'
metric_name = 'S3BucketChangeCount'
alarm_name = 'S3BucketChangesAlarm'
alarm_description = 'Alarm when S3 bucket changes are detected'
alarm_threshold = 1

# Create a metric filter
cloudwatch_logs_client.put_metric_filter(
    logGroupName=log_group_name,
    filterName=filter_name,
    filterPattern=filter_pattern,
    metricTransformations=[
        {
            'metricName': metric_name,
            'metricNamespace': metric_namespace,
            'metricValue': '1'
        }
    ]
)

# Create a CloudWatch alarm
cloudwatch_client.put_metric_alarm(
    AlarmName=alarm_name,
    AlarmDescription=alarm_description,
    ActionsEnabled=True,
    MetricName=metric_name,
    Namespace=metric_namespace,
    Statistic='Sum',
    Period=300,
    EvaluationPeriods=1,
    Threshold=alarm_threshold,
    ComparisonOperator='GreaterThanOrEqualToThreshold',
    AlarmActions=[
        'arn:aws:sns:your-region:your-account-id:your-sns-topic'
    ],
    OKActions=[
        'arn:aws:sns:your-region:your-account-id:your-sns-topic'
    ],
    InsufficientDataActions=[
        'arn:aws:sns:your-region:your-account-id:your-sns-topic'
    ]
)

print("CloudWatch alarm for S3 bucket changes has been created successfully.")
```

### Explanation:
1. **Set Up AWS SDK for Python (Boto3):**
   - Ensure Boto3 is installed and configured with appropriate AWS credentials.

2. **Define the Metric Filter:**
   - The `filter_pattern` captures specific S3 bucket change events from CloudTrail logs.

3. **Create the Metric Filter:**
   - The `put_metric_filter` method creates a metric filter in CloudWatch Logs.

4. **Create the CloudWatch Alarm:**
   - The `put_metric_alarm` method creates a CloudWatch alarm based on the metric filter.

By following these steps, you can prevent S3 bucket changes by setting up an alarm that notifies you whenever such changes occur.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to your AWS Management Console and navigate to the CloudWatch service. 

2. In the CloudWatch dashboard, click on "Alarms" in the left-hand navigation pane. 

3. In the Alarms dashboard, you can see a list of all the alarms that have been configured. Look for the S3 Bucket Changes Alarm in the list. If the alarm is in the "ALARM" state, it means that the changes in the S3 bucket have triggered the alarm.

4. For more details about the alarm, click on the alarm name. This will open a new page where you can see the alarm details, including the metric name, the threshold that triggers the alarm, the state of the alarm, and the actions that are taken when the alarm state changes.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can install AWS CLI using pip (Python package manager) by running the command `pip install awscli`. After installation, you can configure it by running `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List existing CloudWatch alarms: You can use the `describe-alarms` command to list all the existing CloudWatch alarms. The command is as follows:
   ```
   aws cloudwatch describe-alarms
   ```
   This command will return a list of all the alarms along with their details.

3. Check for S3 Bucket Changes Alarm: In the list of alarms, look for the alarm that is set up to monitor changes to your S3 bucket. The name of the alarm will depend on what you named it when you set it up. If the alarm is not present, it means it has not been set up.

4. Check the state of the alarm: If the alarm is present, you can check its state using the `describe-alarm-state` command. Replace `<alarm-name>` with the name of your alarm:
   ```
   aws cloudwatch describe-alarm-state --alarm-name <alarm-name>
   ```
   This command will return the state of the alarm. If the state is "ALARM", it means changes have been detected in your S3 bucket. If the state is "OK", it means no changes have been detected.
</Accordion>

<Accordion title='Using Python'>
1. **Install Boto3:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. To install boto3, use the pip command:

   ```python
   pip install boto3
   ```

2. **Configure AWS Credentials:**
   Before you can begin using Boto3, you should set up authentication credentials. You can do this by using the AWS CLI and then configure it. If you have the AWS CLI installed, then you can use it to configure your credentials file:

   ```bash
   aws configure
   ```

3. **Python Script to Check S3 Bucket Changes Alarm in Cloud Watch:**
   Here is a simple Python script using Boto3 to check if there is an alarm set for S3 bucket changes in CloudWatch:

   ```python
   import boto3

   def check_s3_bucket_changes_alarm():
       cloudwatch = boto3.client('cloudwatch')

       # List all alarms
       alarms = cloudwatch.describe_alarms()

       # Check if there is an alarm for S3 bucket changes
       for alarm in alarms['MetricAlarms']:
           if 'S3' in alarm['Namespace'] and 'BucketSizeBytes' in alarm['MetricName']:
               print(f"Alarm for S3 bucket changes exists: {alarm['AlarmName']}")
               return

       print("No alarm for S3 bucket changes found.")

   check_s3_bucket_changes_alarm()
   ```

4. **Run the Python Script:**
   Save the above script in a file, say `check_s3_alarm.py`, and run it using Python:

   ```bash
   python check_s3_alarm.py
   ```

   This script will print the name of the alarm if it exists, otherwise it will print "No alarm for S3 bucket changes found."
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
When you receive an S3 Bucket Changes Alarm, it means that there has been a change in the configuration of one of your S3 buckets. Here are the steps to remediate this issue in AWS Console:

1. Log in to your AWS Management Console and navigate to the S3 service.

2. Locate the bucket that triggered the alarm and click on it.

3. Click on the "Permissions" tab and then click on "Bucket Policy".

4. Review the bucket policy to identify the misconfiguration that triggered the alarm.

5. Once you have identified the misconfiguration, edit the bucket policy to correct the issue.

6. After making the necessary changes, click on "Save".

7. Verify that the alarm has been cleared by checking the CloudWatch console.

8. If the alarm persists, review the bucket policy again to ensure that all misconfigurations have been corrected.

9. Once you have confirmed that the alarm has been cleared, you can close the ticket for this issue.

#
</Accordion>

<Accordion title='Using CLI'>
The S3 Bucket Changes Alarm is triggered when there are changes made to the S3 bucket, such as creation, deletion, modification of objects, or changes to bucket policies. To remediate this issue, you can follow the below steps using AWS CLI:

1. Login to your AWS account and open the AWS CLI on your local machine.

2. Run the following command to get the details of the S3 bucket changes alarm:

   ```
   aws cloudwatch describe-alarms --alarm-names S3BucketChangesAlarm
   ```

3. Check the alarm status and make sure it is in the "ALARM" state.

4. To remediate the issue, you need to identify the root cause of the changes made to the S3 bucket. You can review the CloudTrail logs to get more information about the changes made to the S3 bucket.

   ```
   aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=PutObject
   ```

5. Once you have identified the root cause of the changes, you can update the S3 bucket policy or access control list (ACL) to restrict access to the bucket.

6. To update the S3 bucket policy, run the following command:

   ```
   aws s3api put-bucket-policy --bucket <bucket-name> --policy file://policy.json
   ```

   Note: Replace `<bucket-name>` with the name of your S3 bucket and policy.json with the name of the JSON file containing the updated policy.

7. To update the S3 bucket ACL, run the following command:

   ```
   aws s3api put-bucket-acl --bucket <bucket-name> --acl public-read
   ```

   Note: Replace `<bucket-name>` with the name of your S3 bucket and public-read with the desired ACL.

8. After updating the S3 bucket policy or ACL, monitor the S3 bucket changes alarm to ensure that the issue has been remediated.

   ```
   aws cloudwatch describe-alarms --alarm-names S3BucketChangesAlarm
   ```

9. If the alarm status is still in the "ALARM" state, repeat the above steps to identify and remediate any remaining issues.
</Accordion>

<Accordion title='Using Python'>
The misconfiguration of an S3 bucket changes alarm can be remediated by following these steps:

Step 1: Identify the S3 Bucket Changes Alarm
- Login to the AWS Console
- Navigate to the CloudWatch service
- Click on Alarms
- Look for the S3 Bucket Changes Alarm that has been triggered

Step 2: Update the S3 Bucket Policy
- Navigate to the S3 service
- Click on the bucket that the S3 Bucket Changes Alarm is monitoring
- Click on the Permissions tab
- Click on Bucket Policy
- Check if there is any policy that is allowing public access to the bucket or its contents
- If there is any such policy, update it to restrict public access

Step 3: Update the S3 Bucket ACL
- Click on the Access Control List (ACL) tab
- Check if there is any grant that is allowing public access to the bucket or its contents
- If there is any such grant, update it to restrict public access

Step 4: Remediate using Python
- Use the AWS SDK for Python (Boto3) to write a script that updates the S3 Bucket Policy and ACL to restrict public access
- The following Python code can be used as a template:

```
import boto3

# Define the S3 bucket name
bucket_name = 'my-bucket'

# Create a client object for S3
s3 = boto3.client('s3')

# Update the bucket policy to restrict public access
bucket_policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Deny",
            "Principal": "*",
            "Action": "s3:*",
            "Resource": [
                f"arn:aws:s3:::{bucket_name}/*",
                f"arn:aws:s3:::{bucket_name}"
            ],
            "Condition": {
                "Bool": {
                    "aws:SecureTransport": "false"
                }
            }
        }
    ]
}
s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(bucket_policy))

# Update the bucket ACL to restrict public access
bucket_acl = s3.get_bucket_acl(Bucket=bucket_name)
for grant in bucket_acl['Grants']:
    if grant['Grantee'].get('URI') == 'http://acs.amazonaws.com/groups/global/AllUsers':
        s3.put_bucket_acl(Bucket=bucket_name, ACL='private')
        break
```

Note: Replace `my-bucket` with the actual name of the S3 bucket.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudwatch-monitoring.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudwatch-monitoring.html) 

