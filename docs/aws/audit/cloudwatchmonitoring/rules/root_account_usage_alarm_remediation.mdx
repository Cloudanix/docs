
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Alarms".

3. In the "Alarms" dashboard, look for an alarm named "RootAccountUsage". This alarm is triggered when the root account is used for AWS Management Console sign-in, AWS API operations, or AWS CLI commands.

4. If the alarm is in the "ALARM" state, it means that the root account has been used recently. If it's in the "INSUFFICIENT_DATA" state, it means that the alarm has not been triggered yet, which is a good sign. If the alarm is in the "OK" state, it means that the root account has not been used recently.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all CloudWatch alarms: Use the following command to list all the CloudWatch alarms in your AWS account.

   ```
   aws cloudwatch describe-alarms
   ```

   This command will return a JSON object that contains information about all the alarms in your account.

3. Filter for Root Account Usage Alarm: You can filter the output of the previous command to check if there is an alarm for Root Account Usage. You can do this by using the `grep` command in Unix-based systems or the `findstr` command in Windows. The command would look something like this:

   ```
   aws cloudwatch describe-alarms | grep "RootAccountUsage"
   ```

   If this command returns any output, it means that there is an alarm for Root Account Usage.

4. Check the state of the alarm: If there is an alarm for Root Account Usage, you can check its state by using the following command:

   ```
   aws cloudwatch describe-alarm-state --alarm-name "RootAccountUsage"
   ```

   This command will return the state of the alarm. If the state is "ALARM", it means that the root account has been used recently. If the state is "OK", it means that the root account has not been used recently. If the state is "INSUFFICIENT_DATA", it means that there is not enough data to determine whether the root account has been used recently.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Use the CloudWatch client from boto3 to list all the alarms:

```python
cloudwatch = session.client('cloudwatch')

def list_alarms():
    response = cloudwatch.describe_alarms()
    return response['MetricAlarms']
```

4. Check for the Root Account Usage Alarm in the list of alarms:

```python
def check_root_account_usage_alarm():
    alarms = list_alarms()
    for alarm in alarms:
        if alarm['AlarmName'] == 'RootAccountUsage':
            return True
    return False
```

This script will return True if the Root Account Usage Alarm is set up and False if it is not. Please replace 'YOUR_ACCESS_KEY', 'YOUR_SECRET_KEY', and 'YOUR_REGION' with your actual AWS credentials and region.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The Root Account Usage Alarm is an AWS Config Rule that checks whether the root account of your AWS account has been used within the last 90 days. If it has been used, it triggers an alarm. To remediate this issue, you can follow the below steps:

1. Log in to the AWS Management Console.
2. Go to the AWS Config service.
3. Click on the Rules tab.
4. Search for the Root Account Usage rule and click on it.
5. Click on the Remediation action dropdown and select the "Remediate" option.
6. In the Remediation action page, select the "Disable root user access keys" option.
7. Click on the "Create remediation exception" checkbox.
8. Click on the "Remediate" button to remediate the issue.

This will disable the root user access keys, which will prevent the root account from being used. The remediation exception will ensure that the rule does not trigger again for the same issue.

#
</Accordion>

<Accordion title='Using CLI'>
The Root Account Usage Alarm is triggered when the root account is used to perform any actions in AWS. This is a security risk as the root account has unrestricted access to all resources in the account. To remediate this misconfiguration, follow these steps:

1. Create a new IAM user with administrative privileges.
   - Use the AWS CLI command `aws iam create-user` to create a new user.
   - Use the `aws iam create-access-key` command to generate an access key and secret key for the user.
   - Use the `aws iam attach-user-policy` command to attach the `AdministratorAccess` policy to the user. This will give the user full administrative privileges.

2. Enable multi-factor authentication (MFA) for the root account.
   - Use the `aws iam create-virtual-mfa-device` command to create a virtual MFA device.
   - Use the `aws iam enable-mfa-device` command to enable MFA for the root account.

3. Remove the access keys for the root account.
   - Use the `aws iam delete-access-key` command to delete the access keys for the root account.

4. Create an AWS CloudWatch alarm to monitor root account usage.
   - Use the AWS CLI command `aws cloudwatch put-metric-alarm` to create an alarm that will trigger if the root account is used to perform any actions in AWS.

By following these steps, you will have created a new IAM user with administrative privileges, enabled MFA for the root account, removed the access keys for the root account, and created an alarm to monitor root account usage. This will help to secure your AWS account and reduce the risk of unauthorized access.
</Accordion>

<Accordion title='Using Python'>
The Root Account Usage Alarm is an AWS CloudWatch alarm that triggers when the root account is used to sign in to the AWS Management Console. This is considered a security risk, as the root account has full access to all AWS resources and should be used only for administrative tasks that cannot be performed by other IAM users.
```python
def create_cloudwatch_alarm(metric_name, namespace, alarm_name, alarm_description, threshold, sns_topic_arn):
   cloudwatch = boto3.client('cloudwatch')
   cloudwatch.put_metric_alarm(
         AlarmName=alarm_name,
         AlarmDescription=alarm_description,
         MetricName=metric_name,
         Namespace=namespace,
         ComparisonOperator='GreaterThanOrEqualToThreshold',
         Threshold=threshold,
         EvaluationPeriods=1,
         Statistic='Sum',
         Period=300,
         ActionsEnabled=True,
         AlarmActions=[sns_topic_arn]
   )

sns_topic_arn = `<SNS topic ARN>`
create_cloudwatch_alarm('RootAccountUsageCount', 'CloudTrailMetrics', 'RootAccountUsageCountAlarm', 'Alarm for Root Account Usage Count', 1, sns_topic_arn)
create_cloudwatch_alarm('RootAccountUsageEventCount', 'CloudTrailMetrics', 'RootAccountUsageEventCountAlarm', 'Alarm for Root Account Usage Event Count', 1, sns_topic_arn)
```
   - Replace `<SNS topic ARN>` with the ARN of the SNS topic where you want to receive alarm notifications.

Ensure that you have the necessary permissions to create and modify CloudWatch alarms using the AWS CLI or Python script.

</Accordion>
</AccordionGroup>
</Tab>
</Tabs>

### Additional Reading:

- [https://aws.amazon.com/blogs/security/how-to-receive-notifications-when-your-aws-accounts-root-access-keys-are-used/](https://aws.amazon.com/blogs/security/how-to-receive-notifications-when-your-aws-accounts-root-access-keys-are-used/) 

