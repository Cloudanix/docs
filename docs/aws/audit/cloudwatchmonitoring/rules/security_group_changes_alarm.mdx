---
slug: security_group_changes_alarm
title: Security Group Changes Alarm
sidebar_label: Security Group Changes Alarm
---

### More Info:

AWS security groups configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NIST, HIPAA, ISO27001, AWSWAF, HITRUST, CISAWS, CBP, NISTCSF


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Alarms". 

3. In the "Alarms" section, you can see all the alarms that have been set up. Look for the alarm that is set up to monitor Security Group changes. It could be named something like "SecurityGroupChangesAlarm".

4. Click on the name of the alarm to view its details. In the "History" tab, you can see the state changes of the alarm. If the state is "ALARM", it means that the alarm condition is met. You can also see the reason for the state change. If there are any changes in the security group, it will be recorded here.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access CloudWatch.

2. Once AWS CLI is installed and configured, you can use the following command to list all the alarms in CloudWatch:

```bash
aws cloudwatch describe-alarms
```

This command will return a list of all the alarms that are currently configured in CloudWatch. 

3. To check for a specific alarm related to Security Group changes, you can filter the results using the `--alarm-names` option followed by the name of the alarm. For example:

```bash
aws cloudwatch describe-alarms --alarm-names "SecurityGroupChanges"
```

This command will return the details of the alarm named "SecurityGroupChanges". 

4. If you want to check the state of this alarm, you can use the `--state-value` option followed by the state you want to check. For example, to check if the alarm is in the "ALARM" state, you can use the following command:

```bash
aws cloudwatch describe-alarms --state-value ALARM --alarm-names "SecurityGroupChanges"
```

This command will return the details of the alarm named "SecurityGroupChanges" if it is currently in the "ALARM" state. If the alarm is not in the "ALARM" state, the command will not return any results.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) in your environment. You can install it using pip:
```python
pip install boto3
```

2. Import the necessary modules and initialize the client for CloudWatch. You will need your AWS access key and secret access key, which you can get from the AWS Management Console.
```python
import boto3

client = boto3.client(
    'cloudwatch',
    region_name='us-west-2',
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY'
)
```

3. Use the `describe_alarms` function to get information about all the alarms in your AWS account. This function returns a dictionary that contains information about each alarm, including its name, state, and the actions that are taken when the alarm changes state.
```python
alarms = client.describe_alarms()
for alarm in alarms['MetricAlarms']:
    print('Name: ' + alarm['AlarmName'])
    print('State: ' + alarm['StateValue'])
    print('Actions: ' + str(alarm['AlarmActions']))
```

4. To specifically check for Security Group Changes Alarm, you can filter the alarms based on the alarm name or any other specific attribute related to the Security Group Changes Alarm.
```python
for alarm in alarms['MetricAlarms']:
    if 'Security Group Changes' in alarm['AlarmName']:
        print('Name: ' + alarm['AlarmName'])
        print('State: ' + alarm['StateValue'])
        print('Actions: ' + str(alarm['AlarmActions']))
```
This script will print the name, state, and actions of the Security Group Changes Alarm if it exists.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step by step instructions to remediate the Security Group Changes Alarm misconfiguration in AWS using AWS console:

1. Login to your AWS console.
2. Go to the CloudWatch service.
3. Click on "Alarms" in the left-hand menu.
4. Select the Security Group Changes Alarm that you want to remediate.
5. Click on "Actions" and select "Disable Alarm".
6. Once the alarm is disabled, you can take the necessary steps to remediate the issue that triggered the alarm.
7. After you have remediated the issue, you can re-enable the alarm by selecting it and clicking on "Actions" and then selecting "Enable Alarm".

It is important to note that disabling the alarm does not fix the underlying issue. You need to identify and remediate the root cause of the misconfiguration to ensure that your infrastructure remains secure.

#
</Accordion>

<Accordion title='Using CLI'>
The Security Group Changes Alarm is triggered when a security group in your AWS account is modified. To remediate this issue, you can follow the below steps using AWS CLI:

1. Firstly, identify the security group that is being modified. You can do this by checking the CloudWatch logs for the Security Group Changes Alarm.

2. Once you have identified the security group, review the changes that were made to the security group. This can be done by checking the security groupâ€™s inbound and outbound rules.

3. If the changes were made intentionally, you can update the Security Group Changes Alarm to ignore these changes in the future. To do this, you can modify the CloudFormation stack that created the Security Group Changes Alarm.

4. If the changes were made unintentionally, you should revert the security group to its previous configuration. To do this, you can use the AWS CLI command `aws ec2 revoke-security-group-ingress` to remove any newly added inbound rules, and `aws ec2 revoke-security-group-egress` to remove any newly added outbound rules.

5. After reverting the security group to its previous configuration, you should update the Security Group Changes Alarm to ensure that it is triggered if any further changes are made to the security group.

6. Finally, you should investigate the cause of the security group changes and take any necessary steps to prevent similar misconfigurations in the future.
</Accordion>

<Accordion title='Using Python'>
To remediate the "Security Group Changes Alarm" misconfiguration in AWS using Python, you can follow the below steps:

1. Identify the security group that triggered the alarm. You can find this information in the CloudWatch alarm details.

2. Check the security group rules to see if any unauthorized changes were made. You can use the `describe_security_groups()` method from the Boto3 library to retrieve the security group rules.

3. If any unauthorized changes were made, revert them by calling the `revoke_security_group_ingress()` or `revoke_security_group_egress()` method from the Boto3 library. You will need to provide the appropriate parameters such as the security group ID, IP permissions, etc.

4. Once the changes have been reverted, update the CloudWatch alarm status to "OK" using the `set_alarm_state()` method from the Boto3 library.

Here's an example Python code snippet that demonstrates how to remediate the "Security Group Changes Alarm" misconfiguration:

```python
import boto3

# Initialize the Boto3 client
ec2 = boto3.client('ec2')

# Specify the security group ID that triggered the alarm
security_group_id = 'sg-0123456789abcdef'

# Retrieve the security group rules
response = ec2.describe_security_groups(GroupIds=[security_group_id])

# Check if any unauthorized changes were made
# If yes, revert the changes
for sg in response['SecurityGroups']:
    for ip_perm in sg['IpPermissions']:
        if 'YOUR_UNAUTHORIZED_IP_RANGE' in ip_perm['IpRanges']:
            ec2.revoke_security_group_ingress(
                GroupId=security_group_id,
                IpPermissions=[ip_perm]
            )

# Update the CloudWatch alarm status to "OK"
cloudwatch = boto3.client('cloudwatch')
cloudwatch.set_alarm_state(
    AlarmName='YOUR_ALARM_NAME',
    StateValue='OK',
    StateReason='Misconfiguration has been remediated'
)
```

Note: Replace `YOUR_UNAUTHORIZED_IP_RANGE`, `YOUR_ALARM_NAME` and `sg-0123456789abcdef` with the appropriate values specific to your environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html#cloudwatch-alarms-for-cloudtrail-security-group](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html#cloudwatch-alarms-for-cloudtrail-security-group) 

