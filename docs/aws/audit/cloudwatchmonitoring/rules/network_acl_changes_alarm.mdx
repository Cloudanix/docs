---
slug: network_acl_changes_alarm
title: Network ACL Changes Alarm
sidebar_label: Network ACL Changes Alarm
---

### More Info:

AWS Network ACLs configuration changes should be monitored using CloudWatch alarms.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, AWSWAF, HITRUST, CISAWS, CBP, NISTCSF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Network ACL Changes Alarm in CloudWatch using the AWS Management Console, follow these steps:

1. **Enable CloudTrail Logging:**
   - Go to the AWS Management Console.
   - Navigate to the CloudTrail service.
   - Ensure that CloudTrail is enabled and configured to log all API calls. This will help in tracking any changes made to Network ACLs.

2. **Create a CloudWatch Log Group:**
   - Navigate to the CloudWatch service in the AWS Management Console.
   - Go to the "Logs" section and create a new log group if one does not already exist for your VPC logs.

3. **Set Up CloudWatch Alarms:**
   - In the CloudWatch console, go to the "Alarms" section.
   - Click on "Create Alarm" and select the metric filter for Network ACL changes from the log group created in the previous step.
   - Configure the alarm to trigger based on the specific conditions you want to monitor (e.g., any changes to Network ACLs).

4. **Configure SNS Notifications:**
   - While setting up the CloudWatch alarm, configure an Amazon SNS topic to send notifications.
   - Create a new SNS topic or use an existing one, and subscribe your email or other endpoints to this topic to receive alerts whenever the alarm is triggered.

By following these steps, you can effectively monitor and prevent unauthorized or unintended changes to Network ACLs in your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To prevent Network ACL Changes Alarm in CloudWatch using AWS CLI, you can follow these steps:

1. **Create a CloudWatch Alarm for Network ACL Changes:**
   Use the `put-metric-alarm` command to create an alarm that triggers when there are changes to Network ACLs.

   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "NetworkACLChangesAlarm" \
   --metric-name "NetworkACLChanges" --namespace "AWS/EC2" \
   --statistic "Sum" --period 300 --threshold 1 \
   --comparison-operator "GreaterThanOrEqualToThreshold" \
   --evaluation-periods 1 --alarm-actions "arn:aws:sns:region:account-id:topic-name" \
   --dimensions Name=InstanceId,Value=i-1234567890abcdef0
   ```

2. **Enable CloudTrail Logging:**
   Ensure CloudTrail is enabled to log API calls related to Network ACL changes. This is necessary for CloudWatch to monitor these changes.

   ```sh
   aws cloudtrail create-trail --name "MyTrail" --s3-bucket-name "my-bucket"
   aws cloudtrail start-logging --name "MyTrail"
   ```

3. **Create a CloudWatch Event Rule:**
   Create a rule to capture changes to Network ACLs and send them to CloudWatch.

   ```sh
   aws events put-rule --name "NetworkACLChangeRule" \
   --event-pattern '{"source": ["aws.ec2"], "detail-type": ["AWS API Call via CloudTrail"], "detail": {"eventName": ["CreateNetworkAcl", "DeleteNetworkAcl", "ReplaceNetworkAclEntry", "ReplaceNetworkAclAssociation"]}}'
   ```

4. **Add Target to CloudWatch Event Rule:**
   Add a target to the CloudWatch Event Rule to send notifications or take actions when the rule is triggered.

   ```sh
   aws events put-targets --rule "NetworkACLChangeRule" \
   --targets "Id"="1","Arn"="arn:aws:sns:region:account-id:topic-name"
   ```

These steps will help you set up monitoring and alerting for Network ACL changes using AWS CLI, ensuring you are notified of any changes and can take appropriate action.
</Accordion>

<Accordion title='Using Python'>
To prevent Network ACL (Access Control List) changes in AWS and set up an alarm in CloudWatch using Python scripts, you can follow these steps:

### 1. Set Up AWS SDK (Boto3)
First, ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip if you haven't already:

```bash
pip install boto3
```

### 2. Create a CloudWatch Alarm for Network ACL Changes
You need to create a CloudWatch alarm that triggers when there are changes to Network ACLs. This involves setting up a CloudTrail to log API calls and then creating a CloudWatch alarm based on those logs.

### 3. Enable CloudTrail
Ensure CloudTrail is enabled to capture API calls related to Network ACL changes.

```python
import boto3

client = boto3.client('cloudtrail')

response = client.create_trail(
    Name='MyTrail',
    S3BucketName='my-cloudtrail-bucket',
    IncludeGlobalServiceEvents=True,
    IsMultiRegionTrail=True,
    EnableLogFileValidation=True
)

client.start_logging(Name='MyTrail')
```

### 4. Create a CloudWatch Alarm
Create a CloudWatch alarm that triggers when there are changes to Network ACLs. This involves setting up a metric filter and an alarm.

```python
import boto3

logs_client = boto3.client('logs')
cloudwatch_client = boto3.client('cloudwatch')

# Create a metric filter for Network ACL changes
logs_client.put_metric_filter(
    logGroupName='CloudTrail/DefaultLogGroup',
    filterName='NetworkACLChanges',
    filterPattern='{ ($.eventName = "CreateNetworkAcl") || ($.eventName = "DeleteNetworkAcl") || ($.eventName = "ReplaceNetworkAclEntry") || ($.eventName = "ReplaceNetworkAclAssociation") }',
    metricTransformations=[
        {
            'metricName': 'NetworkACLChanges',
            'metricNamespace': 'YourNamespace',
            'metricValue': '1'
        }
    ]
)

# Create an alarm based on the metric filter
cloudwatch_client.put_metric_alarm(
    AlarmName='NetworkACLChangesAlarm',
    MetricName='NetworkACLChanges',
    Namespace='YourNamespace',
    Statistic='Sum',
    Period=300,
    EvaluationPeriods=1,
    Threshold=1,
    ComparisonOperator='GreaterThanOrEqualToThreshold',
    AlarmActions=[
        'arn:aws:sns:us-east-1:123456789012:YourSNSTopic'
    ],
    AlarmDescription='Alarm when Network ACL changes are detected',
    ActionsEnabled=True
)
```

### Summary
1. **Set Up AWS SDK (Boto3)**: Ensure Boto3 is installed.
2. **Enable CloudTrail**: Create and start a CloudTrail to log API calls.
3. **Create a Metric Filter**: Set up a metric filter in CloudWatch Logs to capture Network ACL changes.
4. **Create a CloudWatch Alarm**: Create an alarm based on the metric filter to notify you of any changes.

These steps will help you monitor and prevent unauthorized changes to Network ACLs by setting up an alarm that triggers when such changes are detected.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Alarms".

3. In the "Alarms" dashboard, you can see all the alarms that have been set up. Look for the Network ACL Changes Alarm. If it's in the "ALARM" state, it means that the changes in Network ACL have crossed the threshold set for the alarm.

4. For more details, click on the alarm name. In the details pane below, you can see the metrics and conditions set for the alarm, and the recent history of the alarm state. This can help you understand what triggered the alarm.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access CloudWatch.

2. Once AWS CLI is installed and configured, you can use the following command to list all the alarms in CloudWatch:

   ```
   aws cloudwatch describe-alarms
   ```
   This command will return a list of all the alarms that are currently configured in CloudWatch.

3. To specifically check for Network ACL Changes Alarm, you can filter the results using the `--alarm-names` option followed by the name of the alarm. For example:

   ```
   aws cloudwatch describe-alarms --alarm-names "Network ACL Changes Alarm"
   ```
   This command will return the details of the alarm named "Network ACL Changes Alarm".

4. If you want to check the state of this alarm, you can use the `--state-value` option followed by the state you want to check. For example:

   ```
   aws cloudwatch describe-alarms --state-value "ALARM" --alarm-names "Network ACL Changes Alarm"
   ```
   This command will return the details of the alarm named "Network ACL Changes Alarm" only if it is in the "ALARM" state.
</Accordion>

<Accordion title='Using Python'>
1. **Setup AWS SDK (Boto3) in Python Environment:**
   First, you need to set up the AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   After installing boto3, configure your AWS credentials either by setting up environment variables or by using the AWS CLI.

2. **Create a Python Script to Fetch CloudWatch Alarms:**
   You can use the `describe_alarms` method provided by the CloudWatch client in boto3 to fetch all the alarms. Here is a sample script:

   ```python
   import boto3

   def get_cloudwatch_alarms():
       cloudwatch = boto3.client('cloudwatch')
       alarms = cloudwatch.describe_alarms()
       return alarms['MetricAlarms']

   alarms = get_cloudwatch_alarms()
   for alarm in alarms:
       print(alarm['AlarmName'])
   ```
   This script will print the names of all the alarms in your AWS account.

3. **Filter Alarms for Network ACL Changes:**
   Now, you need to filter out the alarms related to Network ACL changes. You can do this by checking the `MetricName` and `Namespace` fields of each alarm. Here is how you can modify the above script to do this:

   ```python
   import boto3

   def get_cloudwatch_alarms():
       cloudwatch = boto3.client('cloudwatch')
       alarms = cloudwatch.describe_alarms()
       return alarms['MetricAlarms']

   alarms = get_cloudwatch_alarms()
   for alarm in alarms:
       if alarm['Namespace'] == 'AWS/NetworkACL' and alarm['MetricName'] == 'NetworkACLChanges':
           print(alarm['AlarmName'])
   ```
   This script will print the names of all the alarms related to Network ACL changes.

4. **Check the State of the Alarms:**
   Finally, you can check the state of these alarms to see if any changes have been made to the Network ACLs. You can do this by checking the `StateValue` field of each alarm. Here is how you can modify the above script to do this:

   ```python
   import boto3

   def get_cloudwatch_alarms():
       cloudwatch = boto3.client('cloudwatch')
       alarms = cloudwatch.describe_alarms()
       return alarms['MetricAlarms']

   alarms = get_cloudwatch_alarms()
   for alarm in alarms:
       if alarm['Namespace'] == 'AWS/NetworkACL' and alarm['MetricName'] == 'NetworkACLChanges':
           print(f"Alarm Name: {alarm['AlarmName']}, State: {alarm['StateValue']}")
   ```
   This script will print the names and states of all the alarms related to Network ACL changes. If the state of any alarm is 'ALARM', it means that a change has been made to the Network ACLs.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The "Network ACL Changes Alarm" indicates that changes have been made to the Network Access Control List (NACL) in your AWS account. To remediate this issue, you can follow the steps below:

1. Open the AWS Management Console and navigate to the VPC service.

2. Select the VPC where the NACL changes were made.

3. Click on the "Network ACLs" option in the left-hand menu.

4. Identify the NACL that has been modified and click on its name.

5. Review the "Inbound Rules" and "Outbound Rules" tabs to identify any unauthorized changes.

6. If unauthorized changes are identified, click the "Edit" button for the relevant rule and modify it as necessary.

7. Click the "Save" button to apply the changes.

8. Once all unauthorized changes have been remediated, update the alarm configuration to ensure that you are alerted if any further unauthorized changes are made to the NACL.

9. To update the alarm configuration, navigate to the CloudWatch service, select the relevant alarm, and click the "Actions" button.

10. Select "Edit" and update the alarm configuration as necessary.

11. Click the "Save" button to apply the changes.

By following these steps, you can remediate the "Network ACL Changes Alarm" issue in your AWS account.

#
</Accordion>

<Accordion title='Using CLI'>
The Network ACL Changes Alarm is triggered when there is a change to the network access control list (ACL) in your AWS account. This could potentially allow unauthorized access to your network resources. To remediate this issue, you can follow these steps:

1. Login to your AWS account and open the AWS CLI.

2. Verify that the Network ACL Changes Alarm is triggered by running the following command:
```
aws cloudwatch describe-alarms --alarm-names Network_ACL_Changes_Alarm
```

3. Identify the network ACL that has been modified by running the following command:
```
aws ec2 describe-network-acls --query "NetworkAcls[?Associations[?SubnetId=='<subnet_id>']]"
```
Replace `<subnet_id>` with the ID of the subnet associated with the modified network ACL.

4. Review the changes made to the network ACL by running the following command:
```
aws ec2 describe-network-acls --network-acl-id <network_acl_id> --query "NetworkAcls[0].Entries"
```
Replace `<network_acl_id>` with the ID of the modified network ACL.

5. If the changes made to the network ACL are unauthorized, you can revert the changes by running the following command:
```
aws ec2 replace-network-acl-entry --network-acl-id <network_acl_id> --rule-number <rule_number> --protocol <protocol> --rule-action <rule_action> --cidr-block <cidr_block> --egress --region <region>
```
Replace `<network_acl_id>` with the ID of the modified network ACL, `<rule_number>` with the number of the rule that was modified, `<protocol>` with the protocol type, `<rule_action>` with the action taken, `<cidr_block>` with the CIDR block affected, and `<region>` with the AWS region where the network ACL is located.

6. Finally, verify that the changes have been reverted by running the following command:
```
aws ec2 describe-network-acls --network-acl-id <network_acl_id> --query "NetworkAcls[0].Entries"
```
Replace `<network_acl_id>` with the ID of the modified network ACL. The output should show the original rules before the unauthorized changes were made.

By following these steps, you can remediate the Network ACL Changes Alarm in AWS using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
The Network ACL Changes Alarm is triggered when there are changes made to the Network Access Control Lists (NACLs) in your AWS environment. To remediate this issue using Python, you can follow these steps:

1. Identify the source of the change: You can use the AWS CloudTrail service to identify the source of the change. CloudTrail logs all API calls made to your AWS account, and you can use it to see who made the change and when it was made.

2. Review the change: Once you have identified the source of the change, you should review the change to ensure that it was made in accordance with your organization's security policies and best practices.

3. Roll back the change: If the change was made in error or is not in compliance with your organization's security policies, you should roll back the change. You can use the AWS CLI or the AWS Management Console to roll back the change.

4. Update NACLs: If the change was made in compliance with your organization's security policies, you should update your NACLs to reflect the change. You can use the AWS CLI or the AWS Management Console to update your NACLs.

5. Monitor for future changes: To prevent future misconfigurations, you should monitor your NACLs for changes and set up alerts to notify you of any unauthorized changes.

Here is some sample Python code to get you started with monitoring NACL changes using AWS CloudWatch:

```
import boto3

client = boto3.client('cloudwatch')

response = client.put_metric_alarm(
    AlarmName='Network ACL Changes',
    AlarmDescription='Alarm triggered when there are changes made to the Network Access Control Lists (NACLs)',
    MetricName='NetworkAclChanges',
    Namespace='AWS/EC2',
    Statistic='Sum',
    Period=300,
    EvaluationPeriods=1,
    Threshold=1,
    ComparisonOperator='GreaterThanOrEqualToThreshold',
    Dimensions=[
        {
            'Name': 'InstanceId',
            'Value': 'i-0123456789abcdef0'
        },
    ],
    AlarmActions=[
        'arn:aws:sns:us-west-2:123456789012:MyTopic'
    ],
    OKActions=[
        'arn:aws:sns:us-west-2:123456789012:MyTopic'
    ],
    InsufficientDataActions=[
        'arn:aws:sns:us-west-2:123456789012:MyTopic'
    ],
    Unit='Count'
)
```

This code sets up a CloudWatch alarm to monitor for changes to NACLs in your AWS environment. When a change is detected, the alarm will trigger an SNS notification to a specified topic. You can customize this code to meet your specific needs and requirements.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html) 

