---
slug: ec2_instance_changes_alarm
title: EC2 Instance Changes Alarm
sidebar_label: EC2 Instance Changes Alarm
---

### More Info:

AWS EC2 instance changes should be monitored using CloudWatch alarms.

### Risk Level

Low

### Address

Security

### Compliance Standards

AWSWAF



### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent EC2 Instance Changes Alarm in CloudWatch using the AWS Management Console, follow these steps:

1. **Navigate to CloudWatch:**
   - Sign in to the AWS Management Console.
   - In the AWS Management Console, open the CloudWatch console by searching for "CloudWatch" in the services search bar and selecting it.

2. **Create an Alarm:**
   - In the CloudWatch console, select "Alarms" from the left-hand navigation pane.
   - Click on the "Create alarm" button.

3. **Select Metric:**
   - Choose the "Select metric" button.
   - In the "Browse" tab, navigate to "EC2" and then "Per-Instance Metrics."
   - Select the metric that you want to monitor (e.g., CPUUtilization, NetworkIn, etc.) for the specific EC2 instance.

4. **Configure Alarm Settings:**
   - Set the conditions for the alarm, such as the threshold value and the period over which the metric should be evaluated.
   - Configure the actions to take when the alarm state is triggered, such as sending a notification to an SNS topic or triggering an Auto Scaling action.
   - Review and create the alarm.

By following these steps, you can set up a CloudWatch alarm to monitor changes in your EC2 instances and take appropriate actions when specific conditions are met.
</Accordion>

<Accordion title='Using CLI'>
To prevent EC2 Instance Changes Alarm in CloudWatch using AWS CLI, you can follow these steps:

1. **Create a CloudWatch Alarm for EC2 Instance State Changes:**
   - Use the `put-metric-alarm` command to create an alarm that monitors the `StatusCheckFailed` metric for your EC2 instances.
   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "EC2_Instance_Changes_Alarm" \
   --metric-name StatusCheckFailed \
   --namespace AWS/EC2 \
   --statistic Average \
   --period 300 \
   --threshold 1 \
   --comparison-operator GreaterThanOrEqualToThreshold \
   --dimensions Name=InstanceId,Value=i-1234567890abcdef0 \
   --evaluation-periods 1 \
   --alarm-actions arn:aws:sns:us-west-2:123456789012:MySNSTopic \
   --unit Count
   ```

2. **Enable Detailed Monitoring for EC2 Instances:**
   - Ensure that detailed monitoring is enabled for your EC2 instances to get more granular metrics.
   ```sh
   aws ec2 monitor-instances --instance-ids i-1234567890abcdef0
   ```

3. **Create an SNS Topic for Alarm Notifications:**
   - Create an SNS topic to receive notifications when the alarm state changes.
   ```sh
   aws sns create-topic --name MySNSTopic
   ```

4. **Subscribe to the SNS Topic:**
   - Subscribe an email endpoint to the SNS topic to receive notifications.
   ```sh
   aws sns subscribe --topic-arn arn:aws:sns:us-west-2:123456789012:MySNSTopic \
   --protocol email \
   --notification-endpoint myemail@example.com
   ```

By following these steps, you can set up a CloudWatch alarm to monitor EC2 instance state changes and receive notifications, helping you to prevent and respond to any unwanted changes.
</Accordion>

<Accordion title='Using Python'>
To prevent EC2 Instance Changes Alarm in CloudWatch using Python scripts, you can follow these steps:

1. **Set Up AWS SDK for Python (Boto3):**
   Ensure you have Boto3 installed and configured with the necessary permissions to interact with AWS CloudWatch and EC2 services.

   ```bash
   pip install boto3
   ```

2. **Create a CloudWatch Client:**
   Initialize a CloudWatch client using Boto3.

   ```python
   import boto3

   cloudwatch = boto3.client('cloudwatch')
   ```

3. **Define the Alarm Configuration:**
   Specify the parameters for the CloudWatch alarm, such as the metric to monitor, threshold, evaluation periods, and actions to take when the alarm state changes.

   ```python
   alarm_name = 'EC2_Instance_Changes_Alarm'
   metric_name = 'StatusCheckFailed_Instance'
   namespace = 'AWS/EC2'
   statistic = 'Average'
   period = 300  # 5 minutes
   evaluation_periods = 1
   threshold = 1.0
   comparison_operator = 'GreaterThanOrEqualToThreshold'
   alarm_actions = ['arn:aws:sns:region:account-id:sns-topic']  # Replace with your SNS topic ARN
   ```

4. **Create the Alarm:**
   Use the `put_metric_alarm` method to create the alarm with the specified configuration.

   ```python
   response = cloudwatch.put_metric_alarm(
       AlarmName=alarm_name,
       MetricName=metric_name,
       Namespace=namespace,
       Statistic=statistic,
       Period=period,
       EvaluationPeriods=evaluation_periods,
       Threshold=threshold,
       ComparisonOperator=comparison_operator,
       AlarmActions=alarm_actions,
       ActionsEnabled=True,
       AlarmDescription='Alarm when EC2 instance changes state',
       Dimensions=[
           {
               'Name': 'InstanceId',
               'Value': 'i-1234567890abcdef0'  # Replace with your EC2 instance ID
           },
       ]
   )

   print("Alarm created successfully:", response)
   ```

By following these steps, you can prevent EC2 instance changes by setting up a CloudWatch alarm that monitors specific metrics and triggers actions when the defined thresholds are breached. This proactive monitoring helps in identifying and addressing potential issues before they escalate.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to your AWS Management Console and navigate to the CloudWatch service. 

2. In the CloudWatch dashboard, click on "Alarms" in the left-hand navigation pane. This will display a list of all the alarms that have been configured.

3. Look for the EC2 Instance Changes Alarm in the list. If the alarm is in the "ALARM" state, it means that the changes in the EC2 instance have triggered the alarm. If the alarm is in the "INSUFFICIENT_DATA" state, it means that CloudWatch is not receiving data for the alarm metric, which could be due to a misconfiguration.

4. Click on the name of the alarm to view its details. In the "History" tab, you can see the changes that triggered the alarm. In the "Configuration" tab, you can check the alarm settings and conditions. If the conditions do not match your expectations, there might be a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List Existing Alarms**: You can check if there are any existing alarms for EC2 instance changes by using the `describe-alarms` command. This command will list all the alarms that are currently set up in your AWS account. The command is as follows:

    ```
    aws cloudwatch describe-alarms
    ```

    This will return a list of all the alarms along with their details. You can look for alarms related to EC2 instance changes in this list.

3. **Filter Alarms for EC2 Instance Changes**: If you have a lot of alarms and you want to specifically check for EC2 instance changes alarms, you can filter the results using the `--alarm-names` option followed by the name of the alarm. For example:

    ```
    aws cloudwatch describe-alarms --alarm-names "EC2 Instance Changes"
    ```

    This will return the details of the alarm named "EC2 Instance Changes".

4. **Check Alarm State**: To check the state of the alarm (whether it is ALARM, OK, or INSUFFICIENT_DATA), you can use the `describe-alarm-state` command followed by the name of the alarm. For example:

    ```
    aws cloudwatch describe-alarm-state --alarm-names "EC2 Instance Changes"
    ```

    This will return the current state of the alarm. If the state is ALARM, it means that the alarm condition is met. If the state is OK, it means that the alarm condition is not met. If the state is INSUFFICIENT_DATA, it means that there is not enough data to determine whether the alarm condition is met or not.
</Accordion>

<Accordion title='Using Python'>
1. Install AWS SDK for Python (Boto3): Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Configure AWS Credentials: Before you can begin using Boto3, you should set up authentication credentials. You can do this by using the AWS CLI:

```bash
aws configure
```

3. Create a Python script to check EC2 Instance Changes Alarm in Cloud Watch:

```python
import boto3

def check_ec2_alarm():
    client = boto3.client('cloudwatch')
    response = client.describe_alarms()
    for alarm in response['MetricAlarms']:
        if 'EC2' in alarm['AlarmName']:
            print(f"Alarm Name: {alarm['AlarmName']}")
            print(f"Alarm Description: {alarm['AlarmDescription']}")
            print(f"Alarm State: {alarm['StateValue']}")
            print(f"Alarm Actions: {alarm['ActionsEnabled']}")
            print("\n")

check_ec2_alarm()
```

This script will list all the alarms related to EC2 instances in your AWS account. It will print the name, description, state, and whether actions are enabled for each alarm.

4. Run the Python script: You can run the Python script using any Python interpreter. The output will give you the details of the EC2 Instance Changes Alarm in Cloud Watch.

```bash
python check_ec2_alarm.py
```
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
When an EC2 instance changes alarm is triggered, it means that there has been a change in the state of an EC2 instance. This could be due to a number of reasons, such as a change in the instance type, security group, or IAM role. Here are the steps to remediate this issue in AWS using the AWS console:

1. Log in to the AWS Management Console and navigate to the CloudWatch service.
2. Click on "Alarms" in the left-hand menu and select the alarm that has been triggered.
3. Click on the "Actions" dropdown and select "Disable Alarm" to stop receiving notifications while you work on remediation.
4. Navigate to the EC2 service and select the instance that has triggered the alarm.
5. Review the instance details to determine what has changed and what needs to be remediated. This could include changes to the instance type, security group, or IAM role.
6. Make the necessary changes to remediate the issue. For example, if the instance type has changed, you may need to stop the instance and modify the instance type in the EC2 console.
7. Once the remediation is complete, navigate back to the CloudWatch service and select the alarm that was triggered.
8. Click on the "Actions" dropdown and select "Enable Alarm" to resume notifications.

By following these steps, you should be able to remediate the EC2 instance changes alarm in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
The "EC2 Instance Changes" alarm is triggered when there is a change in the state of an EC2 instance, such as stopping or terminating the instance. To remediate this issue, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your local machine and run the following command to describe the alarm:

```
aws cloudwatch describe-alarms --alarm-names "EC2 Instance Changes"
```

2. Identify the instance ID(s) that are causing the alarm.

3. Stop or terminate the instance(s) using the following command:

```
aws ec2 stop-instances --instance-ids <instance-id>
```

or

```
aws ec2 terminate-instances --instance-ids <instance-id>
```

4. Once the instance(s) have been stopped or terminated, run the following command to delete the alarm:

```
aws cloudwatch delete-alarms --alarm-names "EC2 Instance Changes"
```

Note: It is recommended to create a new alarm to monitor the state of the EC2 instances to avoid similar issues in the future.
</Accordion>

<Accordion title='Using Python'>
To remediate the "EC2 Instance Changes Alarm" misconfiguration in AWS using Python, follow these steps:

1. Import the necessary libraries:

```python
import boto3
```

2. Create a boto3 client for CloudWatch:

```python
cw_client = boto3.client('cloudwatch')
```

3. List the existing alarms:

```python
existing_alarms = cw_client.describe_alarms()
```

4. Find the alarm that is triggering the "EC2 Instance Changes" alarm:

```python
for alarm in existing_alarms['MetricAlarms']:
    if alarm['AlarmName'] == 'EC2 Instance Changes':
        ec2_alarm = alarm
        break
```

5. Modify the alarm to disable it:

```python
ec2_alarm['ActionsEnabled'] = False
cw_client.put_metric_alarm(AlarmName='EC2 Instance Changes', MetricName='StatusCheckFailed', ActionsEnabled=False)
```

6. Verify that the alarm is disabled:

```python
existing_alarms = cw_client.describe_alarms()
for alarm in existing_alarms['MetricAlarms']:
    if alarm['AlarmName'] == 'EC2 Instance Changes':
        print(alarm['ActionsEnabled'])
```

The output should be `False`, indicating that the alarm is disabled.

Note: This solution assumes that you have the necessary permissions to modify CloudWatch alarms in your AWS account.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/UsingAlarmActions.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/UsingAlarmActions.html) 

