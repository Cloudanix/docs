---
slug: event_bus_cross_account_access
title: EventBus Should Not Allow Cross Account Access
sidebar_label: EventBus Should Not Allow Cross Account Access
---

### More Info:

AWS CloudWatch event buses should not allow unknown cross-account access for delivery of events.

### Risk Level

High

### Address

Security

### Compliance Standards

AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Rules". This will display a list of all the EventBridge rules in your account.

3. Click on the name of the rule that you want to check. This will open the rule details page.

4. In the rule details page, check the "Resource-based policy" section. If the "Principal" field contains an AWS account ID that is not your own, or if it contains a wildcard character (*), then the EventBus is allowing cross-account access.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, make sure you have AWS CLI installed and configured with the necessary permissions. You can install it using pip (Python package installer). 

   ```
   pip install awscli
   ```
   Then configure it using the following command and provide your AWS credentials (Access Key ID and Secret Access Key), default region name, and default output format when prompted.

   ```
   aws configure
   ```

2. List all the Event Buses: Use the following AWS CLI command to list all the Event Buses in your account.

   ```
   aws events list-event-buses
   ```

3. Describe EventBus Policy: For each EventBus returned from the previous step, use the following AWS CLI command to describe the policy of the EventBus. Replace 'event-bus-name' with the name of your EventBus.

   ```
   aws events describe-event-bus --name event-bus-name
   ```

4. Check for Cross Account Access: The output of the previous command will include a Policy. This Policy is a JSON object that describes the permissions of the EventBus. You need to inspect this Policy to see if it allows cross-account access. If the "Principal" field in the Policy is set to a specific AWS account ID or if it is set to '*', then the EventBus allows cross-account access.

#### Using Python

To detect EventBus Should Not Allow Cross Account Access in Cloud Watch using python scripts, you can follow these steps:

1. **Install Boto3:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS Credentials:**
   Before you can begin using Boto3, you should set up authentication credentials for your AWS account using either the AWS CLI or by creating the credentials file yourself. The quickest way to get started is to run the AWS CLI with the `configure` command:
   ```
   aws configure
   ```

3. **Create a Python Script:**
   Create a python script that uses the Boto3 SDK to interact with the CloudWatch service. The script should list all the event buses in your account and check if any of them have a policy that allows cross-account access. Here is a sample script:

   ```python
   import boto3

   def check_event_bus_cross_account_access():
       client = boto3.client('events')
       response = client.list_event_buses()
       for event_bus in response['EventBuses']:
           if 'Policy' in event_bus:
               policy = json.loads(event_bus['Policy'])
               for statement in policy['Statement']:
                   if 'Principal' in statement and statement['Principal'] == '*':
                       print(f"Event Bus {event_bus['Name']} allows cross-account access")

   check_event_bus_cross_account_access()
   ```

4. **Run the Python Script:**
   Run the python script using a python interpreter. If any event buses allow cross-account access, they will be printed to the console. If no output is produced, then no event buses allow cross-account access.

Please note that this script only checks for policies that allow all accounts (`"Principal": "*"`) to access the event bus. If you need to check for specific accounts, you would need to modify the script accordingly.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "EventBus Should Not Allow Cross Account Access" misconfiguration in AWS using the AWS console, follow these steps:

1. Login to the AWS Management Console.
2. Navigate to the Amazon EventBridge service.
3. Select the Event Bus that is allowing cross-account access.
4. Click on the "Permissions" tab.
5. In the "Event bus policies" section, click on the "Edit" button.
6. Remove any statements that grant cross-account access to the Event Bus.
7. Add a new statement that only allows access from the AWS account(s) that require access to the Event Bus.
8. Click on the "Save" button to apply the changes.

After following these steps, the Event Bus will no longer allow cross-account access and will only allow access from the specified AWS account(s).

#### Using CLI

To remediate the "EventBus Should Not Allow Cross Account Access" misconfiguration in AWS using AWS CLI, follow these steps:

1. Open your terminal or command prompt and ensure that you have the AWS CLI installed and configured with the appropriate credentials.

2. Run the following command to list all the Amazon EventBridge event buses in your AWS account:

   ```
   aws events list-event-buses
   ```

3. Identify the event bus that is allowing cross-account access.

4. Run the following command to modify the event bus policy and restrict cross-account access:

   ```
   aws events put-policy --event-bus-name <event-bus-name> --policy '{"Statement":[{"Sid":"RestrictCrossAccountAccess","Effect":"Deny","Principal":"*","Action":"events:PutEvents","Resource":"arn:aws:events:<region>:<account-id>:event-bus/<event-bus-name>"}]}'
   ```

   Replace `<event-bus-name>` with the name of the event bus that is allowing cross-account access, `<region>` with the AWS region where the event bus is located, and `<account-id>` with your AWS account ID.

5. Verify that the policy has been updated by running the following command:

   ```
   aws events describe-event-bus --name <event-bus-name>
   ```

   The output should show the updated policy with the `Deny` statement.

6. Repeat steps 3-5 for any other event buses that are allowing cross-account access.

By following these steps, you have successfully remediated the "EventBus Should Not Allow Cross Account Access" misconfiguration in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration "EventBus Should Not Allow Cross Account Access" in AWS, you can follow the below steps in Python:

1. Create a new EventBridge event bus policy that allows access only to the specific AWS account that should have access to the event bus. 

```python
import boto3
import json

eventbridge = boto3.client('events')

account_id = boto3.client('sts').get_caller_identity().get('Account')

policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowAccountAccess",
            "Effect": "Allow",
            "Principal": {
                "AWS": f"arn:aws:iam::{account_id}:root"
            },
            "Action": "events:*",
            "Resource": "arn:aws:events:us-east-1:<account_id>:event-bus/default"
        }
    ]
}

policy_json = json.dumps(policy)

eventbridge.put_permission(
    Action='events:PutEvents',
    Principal='*',
    StatementId='AllowAccountAccess',
    Condition={
        'ArnEquals': {
            'aws:SourceArn': f'arn:aws:events:us-east-1:<account_id>:event-bus/default'
        }
    }
)

eventbridge.put_event_bus_policy(
    EventBusName='default',
    Policy=policy_json
)
```

2. Remove any existing event bus policies that allow cross-account access. 

```python
policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyCrossAccountAccess",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "events:*",
            "Resource": "arn:aws:events:us-east-1:<account_id>:event-bus/default",
            "Condition": {
                "StringNotEquals": {
                    "aws:PrincipalAccount": "<account_id>"
                }
            }
        }
    ]
}

policy_json = json.dumps(policy)

eventbridge.put_event_bus_policy(
    EventBusName='default',
    Policy=policy_json
)
```

3. Verify that the event bus policy now only allows access to the specific AWS account that should have access to the event bus.

```python
policy = eventbridge.describe_event_bus(
    Name='default'
)['Policy']

print(policy)
```

This should remediate the "EventBus Should Not Allow Cross Account Access" misconfiguration in AWS.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html) 


</Tab>
</Tabs>