---
slug: event_bus_exposed
title: Event Bus Should Not Be Exposed
sidebar_label: Event Bus Should Not Be Exposed
---

### More Info:

Your AWS CloudWatch event bus should not be exposed to everyone.

### Risk Level

High

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the Event Bus from being exposed in CloudWatch using the AWS Management Console, follow these steps:

1. **Navigate to Amazon EventBridge:**
   - Open the AWS Management Console.
   - In the search bar, type "EventBridge" and select "Amazon EventBridge" from the results.

2. **Select Event Buses:**
   - In the EventBridge dashboard, click on "Event buses" in the left-hand navigation pane.

3. **Review Permissions:**
   - Select the event bus you want to review.
   - Click on the "Permissions" tab to view the current permissions associated with the event bus.

4. **Modify Permissions:**
   - Ensure that the event bus policy does not allow public access. 
   - Edit the policy to restrict access to only trusted AWS accounts or IAM roles.
   - Save the changes to apply the updated permissions.

By following these steps, you can ensure that your Event Bus in CloudWatch is not exposed to unauthorized access.
</Accordion>

<Accordion title='Using CLI'>
To prevent the Event Bus from being exposed in CloudWatch using AWS CLI, you can follow these steps:

1. **Create a Policy to Restrict Access:**
   Define a policy that restricts access to the Event Bus. This policy should specify which IAM users or roles are allowed to access the Event Bus.

   ```sh
   aws iam create-policy --policy-name RestrictEventBusAccess --policy-document '{
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Deny",
               "Action": "events:PutEvents",
               "Resource": "arn:aws:events:region:account-id:event-bus/default",
               "Condition": {
                   "StringNotEquals": {
                       "aws:PrincipalArn": "arn:aws:iam::account-id:role/AllowedRole"
                   }
               }
           }
       ]
   }'
   ```

2. **Attach the Policy to the Event Bus:**
   Attach the created policy to the Event Bus to enforce the restrictions.

   ```sh
   aws events put-permission --event-bus-name default --action events:PutEvents --principal arn:aws:iam::account-id:role/AllowedRole --statement-id RestrictEventBusAccess
   ```

3. **Review and Update Resource Policies:**
   Ensure that the resource policies for the Event Bus do not allow public access or overly permissive access.

   ```sh
   aws events describe-event-bus --name default
   ```

   If necessary, update the policy to restrict access:

   ```sh
   aws events put-permission --event-bus-name default --action events:PutEvents --principal arn:aws:iam::account-id:role/AllowedRole --statement-id RestrictEventBusAccess
   ```

4. **Regularly Audit Permissions:**
   Regularly audit the permissions and policies associated with the Event Bus to ensure they remain secure.

   ```sh
   aws events list-permissions --event-bus-name default
   ```

By following these steps, you can prevent the Event Bus from being exposed in CloudWatch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the exposure of an Event Bus in AWS CloudWatch using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that your Event Bus is not exposed:

1. **Set Up Boto3 and AWS Credentials:**
   Ensure you have Boto3 installed and configured with your AWS credentials.

   ```bash
   pip install boto3
   ```

   Configure your AWS credentials:

   ```bash
   aws configure
   ```

2. **Create a Python Script to Check and Update Event Bus Policy:**
   Write a Python script to check the existing policy of the Event Bus and update it to restrict public access.

   ```python
   import boto3
   import json

   # Initialize a session using Amazon EventBridge
   client = boto3.client('events')

   # Define the Event Bus name
   event_bus_name = 'your-event-bus-name'

   # Define a secure policy (example: only allow specific AWS accounts)
   secure_policy = {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Principal": {
                   "AWS": "arn:aws:iam::123456789012:root"
               },
               "Action": "events:PutEvents",
               "Resource": f"arn:aws:events:region:account-id:event-bus/{event_bus_name}"
           }
       ]
   }

   # Convert the policy to JSON format
   secure_policy_json = json.dumps(secure_policy)

   # Apply the secure policy to the Event Bus
   response = client.put_permission(
       EventBusName=event_bus_name,
       Policy=secure_policy_json
   )

   print("Policy applied successfully:", response)
   ```

3. **Validate the Policy:**
   Ensure that the policy has been applied correctly by retrieving and printing the current policy of the Event Bus.

   ```python
   # Retrieve the current policy of the Event Bus
   response = client.describe_event_bus(
       Name=event_bus_name
   )

   print("Current Event Bus Policy:", response['Policy'])
   ```

4. **Automate the Script Execution:**
   Schedule the script to run periodically using a cron job or AWS Lambda to ensure that the Event Bus policy remains secure.

   Example of a cron job entry to run the script daily at midnight:

   ```bash
   0 0 * * * /usr/bin/python3 /path/to/your/script.py
   ```

By following these steps, you can ensure that your Event Bus in AWS CloudWatch is not exposed to unauthorized access.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon CloudWatch console at https://console.aws.amazon.com/cloudwatch/.

2. In the navigation pane, click on "Rules" under the "Events" section. This will display a list of all the rules that are currently configured in your AWS environment.

3. For each rule, click on the rule name to view its details. In the "Targets" section, check if the rule is sending events to an Event Bus.

4. Check the "Event pattern" or "Schedule" section to see if the rule is configured to allow public (unauthenticated) access. If the "Event pattern" or "Schedule" is set to allow public access, then the Event Bus is exposed.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all the event buses: Use the following command to list all the event buses in your account:

   ```
   aws events list-event-buses
   ```

   This command will return a list of all the event buses in your account, including their names and ARNs.

3. Describe the event bus: For each event bus, use the following command to get more details about it:

   ```
   aws events describe-event-bus --name <event-bus-name>
   ```

   Replace `<event-bus-name>` with the name of the event bus you want to inspect. This command will return detailed information about the event bus, including its policy.

4. Check the policy: The policy of the event bus determines who can send events to it. If the policy allows anyone to send events (i.e., it has a Principal of "*"), then the event bus is exposed. You can check this by inspecting the "Policy" field in the output of the previous command. If the "Principal" field in the policy is "*", then the event bus is exposed.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The following are the steps to remediate the "Event Bus Should Not Be Exposed" misconfiguration on AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the Amazon EventBridge service.
3. Click on the "Event buses" option on the left-hand menu.
4. Select the event bus that is exposed.
5. Click on the "Permissions" tab.
6. Click on the "Edit" button to edit the permissions.
7. Remove any unauthorized principals or accounts from the "Event bus policy" section.
8. Click on the "Save" button to save the changes.

By following these steps, the event bus will no longer be exposed to unauthorized access and will be remediated.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Event Bus Should Not Be Exposed" for AWS using AWS CLI, you can follow the below steps:

1. Open your command prompt or terminal and install the AWS CLI if you haven't already done so.

2. Run the following command to list all the Amazon EventBridge event buses in your AWS account:

```
aws events list-event-buses
```

3. Identify the event bus that is exposed and note down its ARN.

4. Run the following command to remove the event bus policy that is allowing public access:

```
aws events remove-permission --event-bus-name <event-bus-name> --statement-id <statement-id>
```

Replace `<event-bus-name>` with the name of the event bus that you want to remediate and `<statement-id>` with the ID of the statement in the event bus policy that is allowing public access.

5. After running the above command, you should receive an output similar to the following:

```
{
    "FailedEntryCount": 0,
    "FailedEntries": []
}
```

This means that the event bus policy has been successfully updated to remove public access.

6. Finally, run the following command to verify that the event bus policy has been updated:

```
aws events describe-event-bus --name <event-bus-name>
```

Replace `<event-bus-name>` with the name of the event bus that you remediated. The output should show that the event bus policy no longer allows public access.

By following these steps, you can remediate the misconfiguration "Event Bus Should Not Be Exposed" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
Remediating the "Event Bus Should Not Be Exposed" misconfiguration in AWS using Python involves the following steps:

1. Identify the AWS account that has the exposed event bus.
2. Create an IAM policy that denies access to the event bus.
3. Attach the IAM policy to the AWS account.
4. Verify that the event bus is no longer exposed.

Here's an example Python code that can be used to remediate this misconfiguration:

```
import boto3

# Set the AWS region
region = 'us-east-1'

# Set the name of the exposed event bus
event_bus_name = 'exposed-event-bus'

# Create an IAM policy that denies access to the event bus
policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Deny",
            "Action": [
                "events:PutEvents",
                "events:PutRule",
                "events:PutTargets"
            ],
            "Resource": [
                "arn:aws:events:{}:{}:event-bus/{}".format(region, aws_account_id, event_bus_name)
            ]
        }
    ]
}

# Create an IAM policy with the policy document
iam = boto3.client('iam')
policy_name = 'deny-event-bus-access-policy'
policy_response = iam.create_policy(
    PolicyName=policy_name,
    PolicyDocument=json.dumps(policy)
)

# Attach the IAM policy to the AWS account
account_id = boto3.client('sts').get_caller_identity().get('Account')
iam.attach_policy(
    PolicyArn='arn:aws:iam::{}:policy/{}'.format(account_id, policy_name),
    TargetId=account_id,
    TargetType='AWSAccount'
)

# Verify that the event bus is no longer exposed
events = boto3.client('events')
try:
    response = events.describe_event_bus(Name=event_bus_name)
    if response['Policy'] != policy_name:
        response = events.put_permission(
            EventBusName=event_bus_name,
            Action='events:PutEvents',
            Principal='*'
        )
except events.exceptions.ResourceNotFoundException:
    pass
```

Note: Replace the `region`, `event_bus_name`, and `policy` variables with the appropriate values for your use case. Also, ensure that you have the necessary permissions to create IAM policies and attach them to the AWS account.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html) 

