---
slug: appsync_cache_encryption_at_rest
title: Encryption At Rest Should Be Enabled For App Sync Cache
sidebar_label: Encryption At Rest Should Be Enabled For App Sync Cache
---

### More Info:

This rule checks whether encryption at rest is enabled for the cache of an AWS AppSync API. Enabling encryption at rest helps protect sensitive data stored in the cache from unauthorized access or tampering. It ensures that data is encrypted while stored, providing an additional layer of security.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the AppSync service.
2. In the AppSync dashboard, select the API for which you want to check the encryption at rest status.
3. In the API settings, navigate to the "Cache" section. Here, you can see the details of the cache configuration for the selected API.
4. Check the "Encryption at Rest" status. If it is not enabled, then it indicates a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the AppSync resources.

2. Once the AWS CLI is set up, you can list all the AppSync GraphQL APIs in your account using the following command:

   ```
   aws appsync list-graphql-apis --region your-region
   ```
   Replace 'your-region' with the region where your resources are located. This command will return a list of all the GraphQL APIs in your account.

3. For each GraphQL API, you can describe the cache using the following command:

   ```
   aws appsync get-api-cache --api-id your-api-id --region your-region
   ```
   Replace 'your-api-id' with the ID of your GraphQL API and 'your-region' with the region where your resources are located. This command will return the details of the cache associated with the specified GraphQL API.

4. In the output of the above command, check the 'EncryptionConfig' field. If the 'EncryptionAtRest' field is set to 'DISABLED' or if the 'EncryptionConfig' field is not present, then encryption at rest is not enabled for the AppSync cache.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) in your local environment. Make sure you have the necessary permissions to access the AppSync resources.

```python
pip install boto3
aws configure
```

2. Create a Python script that uses Boto3 to list all the AppSync GraphQL APIs in your account.

```python
import boto3

def list_appsync_apis():
    client = boto3.client('appsync')
    response = client.list_graphql_apis()
    return response['graphqlApis']

apis = list_appsync_apis()
```

3. For each GraphQL API, get the cache configuration and check if the encryption at rest is enabled.

```python
def check_encryption_at_rest(api):
    client = boto3.client('appsync')
    response = client.get_graphql_api(apiId=api['apiId'])
    cache_config = response['graphqlApi']['cacheConfig']
    return cache_config['atRestEncryptionEnabled']

for api in apis:
    encryption_at_rest_enabled = check_encryption_at_rest(api)
    print(f"API ID: {api['apiId']}, Encryption at rest enabled: {encryption_at_rest_enabled}")
```

4. Run the script. If the encryption at rest is not enabled for any AppSync cache, it will be printed in the console. This way, you can detect the misconfiguration.

Please note that this script assumes that you have the necessary permissions to list and get the details of the AppSync GraphQL APIs. If you don't, you need to adjust the IAM policy accordingly.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of enabling encryption at rest for App Sync cache in AWS, follow these steps using the AWS Management Console:

1. **Navigate to AWS AppSync Console:**
   - Go to the AWS Management Console (https://console.aws.amazon.com).
   - In the "Find services" search bar, type "AppSync" and select "AWS AppSync" from the options.

2. **Select the AppSync API:**
   - In the AWS AppSync console, select the API for which you want to enable encryption at rest.

3. **Configure Data Sources:**
   - In the left navigation pane, click on "Data sources."
   - Select the data source associated with your App Sync cache.

4. **Enable Encryption at Rest:**
   - Under the data source settings, look for the option to enable encryption at rest.
   - Click on the data source configuration and find the setting related to encryption at rest.
   - Enable encryption at rest by selecting the appropriate encryption option (e.g., AWS Key Management Service (KMS) key).

5. **Select KMS Key:**
   - If you choose AWS KMS for encryption, select the KMS key that you want to use for encrypting your data at rest.

6. **Save Changes:**
   - After enabling encryption at rest and selecting the KMS key, save the changes to apply the configuration.

7. **Verify Encryption at Rest:**
   - To verify that encryption at rest is enabled for your App Sync cache, you can check the data source settings or review the encryption settings in the AWS Key Management Service console.

By following these steps, you can remediate the misconfiguration of enabling encryption at rest for App Sync cache in AWS using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of enabling encryption at rest for App Sync cache in AWS using AWS CLI, follow these steps:

1. **Enable Encryption at Rest for the App Sync Cache**:
   
   Run the following AWS CLI command to update the App Sync cache with encryption at rest enabled:
   
   ```bash
   aws appsync update-graphql-api --api-id YOUR_API_ID --additional-authentication-providers "CognitoUserPoolConfig={UserPoolId=YOUR_USER_POOL_ID,AppIdClientRegex=YOUR_APP_CLIENT_ID,DefaultAction=ALLOW}" --log-configs "CloudWatchLogsRoleArn=YOUR_CLOUDWATCH_LOGS_ROLE_ARN,FieldLogLevel=ALL" --xray-enabled --cache-key-parameters "QUERY" --default-resolver "CachingConfig={ttl=300,cachingKeys=[]}" --additional-resolvers "typeName=Query,fieldName=getPost,fieldName=getUser,resolver=YOUR_RESOLVER_ARN" --region YOUR_REGION --authentication-type API_KEY --log-settings "RoleArn=YOUR_LOG_ROLE_ARN,LogLevel=ALL" --name YOUR_API_NAME --default-authentication-type API_KEY --additional-authentication-providers "CognitoUserPoolConfig={UserPoolId=YOUR_USER_POOL_ID,AppIdClientRegex=YOUR_APP_CLIENT_ID,DefaultAction=ALLOW}" --xray-enabled
   ```

   Replace the placeholders `YOUR_API_ID`, `YOUR_USER_POOL_ID`, `YOUR_APP_CLIENT_ID`, `YOUR_CLOUDWATCH_LOGS_ROLE_ARN`, `YOUR_LOG_ROLE_ARN`, `YOUR_RESOLVER_ARN`, `YOUR_REGION`, and `YOUR_API_NAME` with your actual values.

2. **Verify Encryption at Rest**:
   
   After running the command, verify that encryption at rest is enabled for the App Sync cache by checking the cache configuration settings in the AWS Management Console or by running the `describe-graphql-api` command using AWS CLI.

By following these steps, you can remediate the misconfiguration of enabling encryption at rest for App Sync cache in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of enabling encryption at rest for AWS AppSync cache using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the AWS AppSync client:
```python
client = boto3.client('appsync')
```

3. List all the GraphQL APIs in your AWS account:
```python
response = client.list_graphql_apis()
```

4. Identify the specific GraphQL API for which you want to enable encryption at rest for the cache. You can use the API name or ID to filter the API.

5. Update the GraphQL API to enable encryption at rest for the cache:
```python
api_id = 'YOUR_API_ID'
client.update_graphql_api(
    apiId=api_id,
    cachingConfig={
        'cachingKeys': [],
        'ttl': 60,
        'transitEncryptionEnabled': True,  # Enable encryption at rest for the cache
        'cachingCidrBlocks': []
    }
)
```

6. Verify that the encryption at rest for the cache has been enabled successfully by checking the caching configuration of the GraphQL API:
```python
response = client.get_graphql_api(apiId=api_id)
caching_config = response['graphqlApi']['cachingConfig']
transit_encryption_enabled = caching_config.get('transitEncryptionEnabled', False)
print(f"Encryption at rest for cache is enabled: {transit_encryption_enabled}")
```

By following these steps and running the Python script, you can successfully remediate the misconfiguration of enabling encryption at rest for AWS AppSync cache.

</Tab>
</Tabs>