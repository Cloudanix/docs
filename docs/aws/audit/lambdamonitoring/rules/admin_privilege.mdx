---
slug: admin_privilege
title: Lambda Functions Should Not Have Administrative Permissions
sidebar_label: Lambda Functions Should Not Have Administrative Permissions
---

### More Info:

Your Amazon Lambda functions should not have administrative permissions in order to promote the Principle of Least Privilege.

### Risk Level

High

### Address

Security

### Compliance Standards

PCIDSS, HIPAA



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the IAM dashboard by selecting "Services" then "IAM".
3. In the IAM dashboard, select "Policies" from the left-hand navigation menu.
4. In the Policies page, use the Filter policies search box to find the policies attached to your Lambda functions. You can do this by typing "lambda" and pressing enter.
5. Once you have the list of policies, click on each policy to view its permissions. If any policy has "AdministratorAccess" or similar high-level permissions, then your Lambda function has administrative permissions.

#### Using CLI

1. First, you need to list all the Lambda functions in your AWS account. You can do this by using the AWS CLI command `aws lambda list-functions`. This command will return a list of all the Lambda functions in your AWS account.

2. Once you have the list of Lambda functions, you can check the permissions attached to each function. You can do this by using the AWS CLI command `aws lambda get-policy --function-name <function-name>`. Replace `<function-name>` with the name of the Lambda function you want to check. This command will return the policy attached to the specified Lambda function.

3. After getting the policy, you need to parse the policy to check if it has any administrative permissions. You can do this by using a Python script. The script should parse the policy and check if it contains any statements with "Effect": "Allow" and "Action": "*" (which means all actions are allowed) and "Resource": "*" (which means the policy applies to all resources).

4. If the policy contains such statements, then the Lambda function has administrative permissions. If not, then the Lambda function does not have administrative permissions. Repeat the process for all the Lambda functions in your AWS account.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) to interact with AWS services. You can install it using pip:

   ```
   pip install boto3
   ```

2. Connect to AWS: Use your AWS credentials (Access Key ID and Secret Access Key) to connect to AWS. You can set these credentials in your environment variables or in your AWS credentials file.

   ```python
   import boto3

   # Create a session using your AWS credentials
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'  # or your preferred region
   )

   # Create a client for the AWS Lambda service
   lambda_client = session.client('lambda')
   ```

3. List all Lambda functions: Use the `list_functions` method to get a list of all Lambda functions in your account.

   ```python
   response = lambda_client.list_functions()
   functions = response['Functions']
   ```

4. Check the permissions of each function: For each function, get its policy using the `get_policy` method. Then, check if the policy grants administrative permissions. If it does, print a warning message.

   ```python
   for function in functions:
       function_name = function['FunctionName']
       policy_response = lambda_client.get_policy(FunctionName=function_name)
       policy = json.loads(policy_response['Policy'])

       for statement in policy['Statement']:
           if 'Action' in statement and '*' in statement['Action']:
               if 'Effect' in statement and statement['Effect'] == 'Allow':
                   print(f"Warning: Lambda function {function_name} has administrative permissions.")
   ```

This script will print a warning for each Lambda function that has administrative permissions. Note that this is a simple example and does not cover all possible misconfigurations. For a more comprehensive check, you would need to parse the policy more thoroughly and check for other permissions that could grant administrative access.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration of Lambda Functions having administrative permissions in AWS:

1. Open the AWS Management Console and navigate to the AWS Lambda service.

2. Select the Lambda function for which you want to remediate the misconfiguration.

3. In the "Configuration" tab, click on the "Permissions" section.

4. Under the "Execution role" section, click on the role name to open the "IAM Console".

5. In the "IAM Console", click on the "Permissions" tab.

6. Click on the "Attach policies" button.

7. Search for the policy "AWSLambdaBasicExecutionRole" and select it.

8. Click on the "Attach policy" button to attach the policy to the role.

9. Remove any other policies that provide administrative permissions to the Lambda function.

10. Save the changes and exit the "IAM Console".

By following these steps, you will remediate the misconfiguration of Lambda Functions having administrative permissions in AWS.

#### Using CLI

To remediate the misconfiguration "Lambda Functions Should Not Have Administrative Permissions" in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the Lambda functions in your AWS account:

```
aws lambda list-functions
```

3. Identify the Lambda function(s) that have administrative permissions.

4. Run the following command to remove the administrative permissions from the Lambda function(s):

```
aws lambda remove-permission --function-name <function_name> --statement-id <statement_id>
```

Replace `<function_name>` with the name of the Lambda function and `<statement_id>` with the statement ID of the administrative permission.

5. Verify that the administrative permission has been removed by running the following command:

```
aws lambda get-policy --function-name <function_name>
```

This command should return an empty policy, indicating that the Lambda function no longer has administrative permissions.

6. Repeat steps 4 and 5 for all the Lambda functions that have administrative permissions.

7. Once you have removed the administrative permissions from all the Lambda functions, verify the remediation by running a compliance check using a tool like AWS Config.

By following these steps, you can remediate the misconfiguration "Lambda Functions Should Not Have Administrative Permissions" in AWS using AWS CLI.

#### Using Python

To remediate this misconfiguration in AWS, you can follow these steps using Python:

1. Identify the Lambda functions that have administrative permissions by checking the `Role` attached to the function.

2. Create a new IAM Role with the necessary permissions that the Lambda function requires and attach it to the function. This new role should have the least privilege required for the function to operate.

3. Update the function's execution role to the new role using the AWS SDK for Python, `boto3`.

Here's the sample Python code:

```python
import boto3

# Initialize the AWS clients
lambda_client = boto3.client('lambda')
iam_client = boto3.client('iam')

# Get the list of all Lambda functions
functions = lambda_client.list_functions()

# Iterate through each function and check if it has administrative permissions
for function in functions['Functions']:
    role_name = function['Role'].split('/')[-1]
    
    # Check if the role has administrative permissions
    policy = iam_client.get_role_policy(RoleName=role_name, PolicyName='AdministratorAccess')
    
    if 'Statement' in policy['PolicyDocument']:
        # Create a new role with the necessary permissions
        new_role = iam_client.create_role(
            RoleName='new-lambda-role',
            AssumeRolePolicyDocument='''{
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Principal": {
                            "Service": "lambda.amazonaws.com"
                        },
                        "Action": "sts:AssumeRole"
                    }
                ]
            }'''
        )
        
        # Attach the new role to the Lambda function
        lambda_client.update_function_configuration(
            FunctionName=function['FunctionName'],
            Role=new_role['Role']['Arn']
        )
        
        # Update the new role with the necessary permissions
        iam_client.put_role_policy(
            RoleName='new-lambda-role',
            PolicyName='lambda-permissions',
            PolicyDocument='''{
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Action": [
                            "logs:CreateLogGroup",
                            "logs:CreateLogStream",
                            "logs:PutLogEvents"
                        ],
                        "Resource": "arn:aws:logs:*:*:*"
                    },
                    {
                        "Effect": "Allow",
                        "Action": [
                            "s3:GetObject",
                            "s3:PutObject"
                        ],
                        "Resource": "arn:aws:s3:::bucket-name/*"
                    }
                ]
            }'''
        )
```

This code will create a new IAM Role named `new-lambda-role` with the necessary permissions for the Lambda function to operate. It will then update the function's execution role to the new role. Finally, it will update the new role with the necessary permissions.

### Additional Reading:

- [https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html](https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html) 


</Tab>
</Tabs>