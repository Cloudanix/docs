---
slug: publicly_accessible
title: Lambda Functions Should Not Be Publicly Accessible
sidebar_label: Lambda Functions Should Not Be Publicly Accessible
---

### More Info:

Any publicly accessible AWS Lambda functions should be identified and their access policy should be updated in order to protect against unauthorized users that are sending requests to invoke these functions.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, PCIDSS, NIST, SOC2, HITRUST, AWSWAF, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the AWS Lambda console at https://console.aws.amazon.com/lambda/.

2. In the navigation pane, choose "Functions". This will display a list of all your Lambda functions.

3. Select the function you want to check. In the function's detail page, scroll down to the "Designer" section.

4. In the "Designer" section, look for the "Resource-based policy" under the "Function policy" section. If the "Principal" in the policy is set to "*" (which means everyone) and the "Action" is set to "lambda:InvokeFunction", it means the Lambda function is publicly accessible.

#### Using CLI

1. First, you need to list all your Lambda functions. Open your terminal and run the following AWS CLI command:

```bash
aws lambda list-functions --region your-region
```
Replace "your-region" with your actual AWS region. This command will return a list of all your Lambda functions in the specified region.

2. For each function in the list, you need to get its resource policy. Run the following command:

```bash
aws lambda get-policy --function-name your-function-name --region your-region
```
Replace "your-function-name" with the actual name of your Lambda function and "your-region" with your actual AWS region. This command will return the resource policy of the specified Lambda function.

3. In the returned policy, look for the "Statement" array. Each item in this array represents a permission that has been granted to a principal. Check the "Effect" and "Principal" fields of each item. If the "Effect" field is "Allow" and the "Principal" field is "*", this means the Lambda function is publicly accessible.

4. Repeat steps 2 and 3 for each Lambda function in your list. If you find any function that is publicly accessible, you have detected a misconfiguration.

#### Using Python

1. Import the necessary AWS SDK for Python (Boto3) modules in your Python script. You will need the 'boto3' module to interact with AWS services and the 'json' module to parse the AWS service responses.

```python
import boto3
import json
```

2. Create a session using your AWS credentials. Replace 'aws_access_key_id', 'aws_secret_access_key', and 'region_name' with your actual AWS credentials and the region where your Lambda functions are deployed.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a client for AWS Lambda service using the session created in the previous step.

```python
lambda_client = session.client('lambda')
```

4. List all the Lambda functions in your account and check their resource-based policies. If a policy allows the 'lambda:InvokeFunction' action for a principal that is not the account owner, then the Lambda function is publicly accessible.

```python
response = lambda_client.list_functions()
for function in response['Functions']:
    policy = lambda_client.get_policy(FunctionName=function['FunctionName'])
    policy_doc = json.loads(policy['Policy'])
    for statement in policy_doc['Statement']:
        if statement['Action'] == 'lambda:InvokeFunction' and statement['Principal'] != 'ACCOUNT_OWNER':
            print(f"Lambda function {function['FunctionName']} is publicly accessible.")
```

This script will print the names of all Lambda functions that are publicly accessible. Replace 'ACCOUNT_OWNER' with the AWS account ID or IAM user/role ARN that should be the only principal allowed to invoke the Lambda functions.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step-by-step instructions to remediate the issue of publicly accessible Lambda functions in AWS console:

1. Log in to your AWS Management Console.
2. Navigate to the AWS Lambda service.
3. Select the Lambda function that you want to remediate.
4. Click on the "Configuration" tab.
5. Scroll down to the "Network" section.
6. Under "Network", you will see the "Lambda function" section. Click on the "Edit" button.
7. You will see the "Configure Function" page. Under the "General configuration" section, you will see the "VPC" and "Public network access" options.
8. Select the VPC that the Lambda function should be associated with.
9. Under "Public network access", select "Disable" to prevent the Lambda function from being publicly accessible.
10. Click on the "Save" button to save the changes.

Once you have completed these steps, your Lambda function will no longer be publicly accessible and will only be accessible within the specified VPC.

#### Using CLI

To remediate the issue of Lambda Functions being publicly accessible in AWS, you can follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the list of all Lambda Functions in your AWS account:

```
aws lambda list-functions
```

3. Identify the Lambda Function(s) that are publicly accessible.

4. Run the following command to update the access control policy of the identified Lambda Function(s):

```
aws lambda update-function-configuration --function-name <function-name> --vpc-config SubnetIds=<subnet-ids>,SecurityGroupIds=<security-group-ids>
```

Replace `<function-name>` with the name of the identified Lambda Function and `<subnet-ids>` and `<security-group-ids>` with the IDs of the subnets and security groups that you want to associate with the Lambda Function.

5. Once the access control policy is updated, run the following command to verify that the Lambda Function is no longer publicly accessible:

```
aws lambda get-policy --function-name <function-name>
```

This should return the access control policy of the Lambda Function. Verify that the policy restricts public access to the Lambda Function.

6. Repeat steps 4 and 5 for all the identified Lambda Functions that are publicly accessible.

By following the above steps, you can remediate the issue of Lambda Functions being publicly accessible in AWS.

#### Using Python

To remediate the issue of publicly accessible Lambda functions in AWS using Python, you can follow these steps:

Step 1: Open the AWS Lambda function console.

Step 2: Select the Lambda function that you want to remediate.

Step 3: Scroll down to the "Configuration" section and click on the "Permissions" tab.

Step 4: In the "Permissions" tab, you will see a section called "Resource-based policy". Click on the "Edit" button next to it.

Step 5: In the "Edit Resource-based policy" window, you will see the "Principal" section. This section specifies the AWS account or IAM user that is allowed to access the Lambda function.

Step 6: To remediate the issue, you need to remove the "Principal" section or replace it with a specific AWS account or IAM user that is authorized to access the Lambda function.

Step 7: You can use the following Python code to remove the "Principal" section from the Lambda function's resource-based policy:

```
import boto3
import json

# Replace 'lambda_function_name' with your Lambda function name
lambda_function_name = 'my_lambda_function'

lambda_client = boto3.client('lambda')

# Get the current resource-based policy of the Lambda function
response = lambda_client.get_policy(FunctionName=lambda_function_name)
policy = json.loads(response['Policy'])

# Remove the 'Principal' section from the resource-based policy
del policy['Statement'][0]['Principal']

# Update the resource-based policy of the Lambda function
lambda_client.add_permission(
    FunctionName=lambda_function_name,
    StatementId='1',
    Action='lambda:InvokeFunction',
    Principal='',
    SourceArn='',
    SourceAccount='',
    EventSourceToken='',
    Qualifier='',
    RevisionId='',
    Policy=json.dumps(policy)
)

print('Resource-based policy updated successfully')
```

Note: Make sure that you have the necessary permissions to modify the Lambda function's resource-based policy.

### Additional Reading:

- [https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html](https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html) 


</Tab>
</Tabs>