---
slug: lambda_step_functions_logging_enabled
title: Step Functions Should Have Logging Enabled
sidebar_label: Step Functions Should Have Logging Enabled
---
### More Info:

Ensure Step Functions Have Logging Enabled

### Risk Level

Informational

### Address

Security, Operational Maturity

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Step Functions from not having logging enabled in AWS Lambda using the AWS Management Console, follow these steps:

1. **Navigate to Step Functions Console:**
   - Open the AWS Management Console.
   - In the search bar, type "Step Functions" and select it from the dropdown.

2. **Create or Edit a State Machine:**
   - If you are creating a new state machine, click on "Create state machine."
   - If you are editing an existing state machine, select the state machine from the list and click on "Edit."

3. **Configure Logging:**
   - In the "Logging" section, check the box that says "Enable Logging."
   - Choose an existing CloudWatch log group or create a new one where the logs will be stored.
   - Set the logging level (e.g., ALL, ERROR) according to your requirements.

4. **Save Changes:**
   - If you are creating a new state machine, complete the rest of the configuration and click "Create state machine."
   - If you are editing an existing state machine, after enabling logging, click "Save" to apply the changes.

By following these steps, you ensure that logging is enabled for your Step Functions, which helps in monitoring and troubleshooting.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of Step Functions not having logging enabled in AWS Lambda using the AWS CLI, follow these steps:

1. **Create a CloudWatch Log Group:**
   Ensure you have a CloudWatch Log Group where the logs will be stored. If you don't have one, create it using the following command:
   ```sh
   aws logs create-log-group --log-group-name <your-log-group-name>
   ```

2. **Create an IAM Role with Logging Permissions:**
   Create an IAM role that has permissions to write logs to CloudWatch. You can use the following command to create a role with the necessary policy:
   ```sh
   aws iam create-role --role-name StepFunctionsLoggingRole --assume-role-policy-document file://trust-policy.json
   ```
   The `trust-policy.json` should contain:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "Service": "states.amazonaws.com"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```

3. **Attach the CloudWatch Logs Policy to the Role:**
   Attach a policy to the role that allows it to write logs to CloudWatch:
   ```sh
   aws iam put-role-policy --role-name StepFunctionsLoggingRole --policy-name CloudWatchLogsPolicy --policy-document file://cloudwatch-logs-policy.json
   ```
   The `cloudwatch-logs-policy.json` should contain:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "logs:CreateLogStream",
           "logs:PutLogEvents"
         ],
         "Resource": "arn:aws:logs:<region>:<account-id>:log-group:<your-log-group-name>:*"
       }
     ]
   }
   ```

4. **Enable Logging for the Step Function:**
   Finally, enable logging for your Step Function by updating its definition to include the logging configuration:
   ```sh
   aws stepfunctions update-state-machine --state-machine-arn <your-state-machine-arn> --logging-configuration "{
     \"level\": \"ALL\",
     \"includeExecutionData\": true,
     \"destinations\": [
       {
         \"cloudWatchLogsLogGroup\": {
           \"logGroupArn\": \"arn:aws:logs:<region>:<account-id>:log-group:<your-log-group-name>\"
         }
       }
     ]
   }"
   ```

Replace `<your-log-group-name>`, `<region>`, `<account-id>`, and `<your-state-machine-arn>` with your specific details. This will ensure that your Step Functions have logging enabled and are writing logs to the specified CloudWatch Log Group.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of Step Functions not having logging enabled in AWS Lambda using Python scripts, you can follow these steps:

### 1. **Set Up AWS SDK (Boto3)**
First, ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip if you haven't already:

```bash
pip install boto3
```

### 2. **Create a Boto3 Client for Step Functions**
Initialize a Boto3 client to interact with AWS Step Functions.

```python
import boto3

client = boto3.client('stepfunctions')
```

### 3. **Define the Logging Configuration**
Create a logging configuration dictionary that specifies the CloudWatch Logs settings.

```python
logging_configuration = {
    'level': 'ALL',  # Set the logging level (e.g., 'ALL', 'ERROR', 'FATAL', etc.)
    'includeExecutionData': True,  # Include execution data in logs
    'destinations': [
        {
            'cloudWatchLogsLogGroup': {
                'logGroupArn': 'arn:aws:logs:region:account-id:log-group:log-group-name'
            }
        }
    ]
}
```

### 4. **Update the State Machine with Logging Configuration**
Use the `update_state_machine` method to apply the logging configuration to your Step Function.

```python
def enable_logging_for_step_function(state_machine_arn, logging_configuration):
    response = client.update_state_machine(
        stateMachineArn=state_machine_arn,
        loggingConfiguration=logging_configuration
    )
    return response

# Example usage
state_machine_arn = 'arn:aws:states:region:account-id:stateMachine:state-machine-name'
response = enable_logging_for_step_function(state_machine_arn, logging_configuration)
print(response)
```

### Summary
1. **Set Up AWS SDK (Boto3)**: Install and import Boto3.
2. **Create a Boto3 Client for Step Functions**: Initialize the client.
3. **Define the Logging Configuration**: Create a dictionary with the desired logging settings.
4. **Update the State Machine with Logging Configuration**: Apply the logging configuration to your Step Function using the `update_state_machine` method.

By following these steps, you can ensure that logging is enabled for your AWS Step Functions, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS Lambda console.
3. In the navigation pane, choose "Functions".
4. Select the function you want to check for logging.
5. In the function overview page, scroll down to the "Monitoring and operations tools" section.
6. Check if "CloudWatch Logs" is enabled. If it is enabled, you will see a link to "View logs in CloudWatch". If it is not enabled, there will be no such link, indicating that logging is not enabled for this function.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the Lambda functions in your account using the following command:

   ```
   aws lambda list-functions --region your-region-name
   ```

   Replace 'your-region-name' with the name of your AWS region. This command will return a JSON object with all your Lambda functions.

3. To check if a specific Lambda function has logging enabled, you need to describe the function configuration using the following command:

   ```
   aws lambda get-function-configuration --function-name your-function-name --region your-region-name
   ```

   Replace 'your-function-name' with the name of your Lambda function and 'your-region-name' with the name of your AWS region. This command will return a JSON object with the configuration of your Lambda function.

4. In the returned JSON object, look for the 'TracingConfig' field. If the 'Mode' field under 'TracingConfig' is set to 'Active', then logging is enabled for that function. If it's set to 'PassThrough', then logging is not enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your local environment. This will allow you to interact with AWS services including AWS Lambda.

```python
pip install boto3
aws configure
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Use the `boto3` client to interact with AWS Lambda and list all the functions.

```python
lambda_client = session.client('lambda')

response = lambda_client.list_functions()
```

4. Iterate over the list of functions and check if the `TracingConfig` is set to `Active`. If it's not, then the function does not have logging enabled.

```python
for function in response['Functions']:
    if function['TracingConfig']['Mode'] != 'Active':
        print(f"Logging is not enabled for function: {function['FunctionName']}")
```

This script will print out the names of all the Lambda functions that do not have logging enabled. This is a misconfiguration as it's a best practice to enable logging for all Lambda functions to track and debug any issues.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using the AWS console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console and login with your credentials.

2. **Navigate to Step Functions**: In the AWS Management Console, navigate to the Step Functions service by either typing "Step Functions" in the search bar or locating it under the "Services" dropdown menu.

3. **Select the Step Function**: Click on the Step Function that is associated with the AWS Lambda function for which you want to enable logging.

4. **Edit the State**: In the Step Function's graphical representation, find the state that invokes the AWS Lambda function. Click on that state to edit its configuration.

5. **Enable Logging**: Look for an option to enable logging for the state. This option is usually found in the configuration settings of the state. Enable the logging option and configure the desired log settings such as log level, log format, and log destination.

6. **Save the Changes**: After enabling logging and configuring the settings, save the changes to update the state configuration.

7. **Test the Step Function**: Run a test on the Step Function to ensure that logging is now enabled for the AWS Lambda function.

By following these steps, you will successfully remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using AWS CLI, follow these steps:

1. Open your terminal and ensure you have the AWS CLI installed and configured with the necessary permissions to make changes to Step Functions and Lambda functions.

2. Enable logging for your Step Functions by updating the state machine using the AWS CLI command `update-state-machine`. Replace `STATE_MACHINE_ARN` with the ARN of your Step Function and `LOGGING_ARN` with the ARN of the CloudWatch Logs group where you want to store the logs.

```bash
aws stepfunctions update-state-machine --state-machine-arn STATE_MACHINE_ARN --logging-configuration "{ 'level': 'ALL', 'includeExecutionData': true, 'destinations': [{ 'cloudWatchLogsLogGroup': { 'logGroupArn': 'LOGGING_ARN' } }]}"
```

3. Next, you need to update your Lambda function to ensure that it sends logs to CloudWatch Logs. Update the Lambda function configuration using the AWS CLI command `update-function-configuration`. Replace `FUNCTION_NAME` with the name of your Lambda function.

```bash
aws lambda update-function-configuration --function-name FUNCTION_NAME --cli-connect-timeout 60 --cli-read-timeout 60 --logging-config "{ 'logGroupName': 'LOGGING_ARN', 'logType': 'Tail' }"
```

4. Verify that the logging configuration has been successfully updated for both the Step Function and the Lambda function by checking the respective configurations in the AWS Management Console or by using the AWS CLI commands `describe-state-machine` and `get-function-configuration`.

By following these steps, you can remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using Python, follow these steps:

1. Open the AWS Management Console and navigate to the Step Functions service.
2. Click on the Step Function that needs to have logging enabled.
3. Click on the "Edit" button to modify the state machine.
4. In the state machine definition, add a new field called "LoggingConfiguration" with the desired logging configuration. Here is an example of how you can add logging using Python:

```python
{
  "Comment": "A simple AWS Step Functions state machine that logs execution history",
  "StartAt": "HelloWorld",
  "States": {
    "HelloWorld": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:FUNCTION_NAME",
      "End": true
    }
  },
  "LoggingConfiguration": {
      "Level": "ALL"
  }
}
```

Replace `REGION`, `ACCOUNT_ID`, and `FUNCTION_NAME` with your specific values.

5. Click on the "Save" button to save the changes to the state machine.
6. Test the state machine to ensure that logging is now enabled for the AWS Lambda function.

By following these steps and adding the `LoggingConfiguration` field to the state machine definition, you can remediate the misconfiguration of Step Functions not having logging enabled for AWS Lambda using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

