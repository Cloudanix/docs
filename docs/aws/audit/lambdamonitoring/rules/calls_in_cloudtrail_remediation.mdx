

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Lambda service. You can find this by typing 'Lambda' into the search bar at the top of the console.
3. Once in the Lambda service, select the function you want to check for CloudTrail logging.
4. In the function's configuration page, scroll down to the 'Monitoring' section. Here, you should see a 'View logs in CloudWatch' button. If this button is present and active, then CloudTrail is enabled for this Lambda function. If the button is not present or is greyed out, then CloudTrail is not enabled.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account details. You can install AWS CLI by following the instructions provided in the official AWS documentation. After installation, you can configure it by running `aws configure` command and providing your AWS access key ID, secret access key, default region name, and default output format.

2. List all Lambda functions: Use the following AWS CLI command to list all the Lambda functions in your AWS account:

   ```
   aws lambda list-functions --region your-region-name
   ```
   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all the Lambda functions in the specified region.

3. Check CloudTrail for each Lambda function: For each Lambda function, you need to check if CloudTrail is enabled. You can do this by using the following AWS CLI command:

   ```
   aws cloudtrail describe-trails --region your-region-name
   ```
   This command will return a list of all the CloudTrail trails in the specified region. For each trail, check if the 'Lambda' service is included in the 'EventSelectors' field. If it is not included, then CloudTrail is not enabled for that Lambda function.

4. Check CloudTrail logs: For each trail, you can also check the CloudTrail logs to see if there are any events related to the Lambda function. You can do this by using the following AWS CLI command:

   ```
   aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=Invoke --region your-region-name
   ```
   This command will return a list of all the events where the 'EventName' is 'Invoke'. If there are no such events for a Lambda function, then CloudTrail is not enabled for that function.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) on your local system. This will allow you to interact with AWS services using Python.

```python
pip install boto3
aws configure
```

2. Create a Python script that uses Boto3 to interact with AWS Lambda. The script will list all the functions and check if CloudTrail is enabled for each function.

```python
import boto3

def check_cloudtrail_enabled():
    client = boto3.client('lambda')
    response = client.list_functions()
    for function in response['Functions']:
        function_name = function['FunctionName']
        check_cloudtrail_for_function(function_name)

def check_cloudtrail_for_function(function_name):
    client = boto3.client('cloudtrail')
    response = client.describe_trails()
    for trail in response['trailList']:
        if 'Lambda' in trail['Name'] and function_name in trail['Name']:
            print(f"CloudTrail is enabled for function: {function_name}")
            return
    print(f"CloudTrail is not enabled for function: {function_name}")

check_cloudtrail_enabled()
```

3. Run the Python script. The script will print out whether CloudTrail is enabled for each Lambda function.

```python
python check_cloudtrail.py
```

4. Review the output. If CloudTrail is not enabled for a function, the script will print "CloudTrail is not enabled for function: {function_name}". If CloudTrail is enabled, it will print "CloudTrail is enabled for function: {function_name}".

Please note that this script assumes that you have the necessary permissions to list Lambda functions and describe CloudTrail trails. If you do not have these permissions, you will need to update your IAM policy accordingly.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "CloudTrail should be enabled for AWS Lambda" in AWS, follow these steps:

1. Go to the AWS Management Console and log in to your account.
2. Open the AWS Lambda console.
3. Select the function for which you want to enable CloudTrail.
4. Click on the "Configuration" tab.
5. Scroll down to the "Advanced settings" section and click on "Edit".
6. In the "CloudWatch Logs" section, select "Enable CloudWatch Logs".
7. In the "CloudTrail" section, select "Enable CloudTrail logs".
8. Choose the S3 bucket where you want to store the CloudTrail logs.
9. Click on "Save".

Once you complete these steps, CloudTrail will be enabled for AWS Lambda and the logs will be saved to the specified S3 bucket. This will help you to monitor and audit the actions performed on your AWS Lambda functions, which is important for security and compliance purposes.

#### Using CLI

To remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS using AWS CLI, follow these steps:

1. Open your terminal and ensure that you have AWS CLI installed and configured with your AWS account credentials.

2. Run the following command to enable CloudTrail for AWS Lambda:

```
aws lambda update-function-configuration --function-name <function-name> --tracing-config Mode=Active
```

Replace `<function-name>` with the name of the AWS Lambda function for which you want to enable CloudTrail.

3. Verify that CloudTrail is enabled for the Lambda function by running the following command:

```
aws lambda get-function-configuration --function-name <function-name>
```

This should return a JSON object that includes the `TracingConfig` key with a value of `{"Mode": "Active"}`.

4. Repeat the above steps for all other AWS Lambda functions in your account to ensure that CloudTrail is enabled for them as well.

By following these steps, you can remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS, you can follow the below steps using Python:

1. Import the boto3 library to interact with AWS resources using Python.

```
import boto3
```

2. Create a boto3 client for AWS Lambda and CloudTrail.

```
lambda_client = boto3.client('lambda')
cloudtrail_client = boto3.client('cloudtrail')
```

3. Get the ARN of the existing CloudTrail trail.

```
trail_arn = cloudtrail_client.describe_trails()['trailList'][0]['TrailARN']
```

4. Create a new CloudTrail trail if one does not exist.

```
if not trail_arn:
    cloudtrail_client.create_trail(Name='MyCloudTrail')
    trail_arn = cloudtrail_client.describe_trails()['trailList'][0]['TrailARN']
```

5. Check if CloudTrail is enabled for the AWS Lambda function.

```
lambda_function_name = 'MyLambdaFunction'
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn not in trail_arn:
        cloudtrail_client.update_trail(
            Name='MyCloudTrail',
            CloudWatchLogsLogGroupArn=cloud_watch_logs_arn,
            CloudWatchLogsRoleArn='arn:aws:iam::123456789012:role/MyCloudTrailRole'
        )
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

6. If CloudTrail is not enabled for the AWS Lambda function, enable it by adding the CloudWatch log group ARN to the CloudTrail trail.

```
lambda_function_name = 'MyLambdaFunction'
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn not in trail_arn:
        cloudtrail_client.update_trail(
            Name='MyCloudTrail',
            CloudWatchLogsLogGroupArn=cloud_watch_logs_arn,
            CloudWatchLogsRoleArn='arn:aws:iam::123456789012:role/MyCloudTrailRole'
        )
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

7. Verify that CloudTrail is now enabled for the AWS Lambda function.

```
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn in trail_arn:
        print(f'CloudTrail is enabled for Lambda function {lambda_function_name}')
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

These steps will enable CloudTrail for the AWS Lambda function and ensure that logs are being captured.


</Tab>
</Tabs>