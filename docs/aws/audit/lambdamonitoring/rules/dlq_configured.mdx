---
slug: dlq_configured
title: AWS Lambda Should Have DLQ Configured
sidebar_label: AWS Lambda Should Have DLQ Configured
---

### More Info:

You should configure a dead letter queue (DLQ) on AWS Lambda to give you more control over message handling for all asynchronous invocations.

### Risk Level

Informational

### Address

Security

### Compliance Standards

HIPAA, SOC2, PCIDSS, NIST




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the AWS Lambda console.
2. In the navigation pane, choose "Functions".
3. Select the function you want to inspect for DLQ configuration.
4. Scroll down to the "Asynchronous invocation" section. If the function has a DLQ configured, you will see a "Dead-letter queue" section with the ARN of the SQS queue or SNS topic that is set as the DLQ. If this section is not present or is empty, then the function does not have a DLQ configured.

#### Using CLI

1. First, you need to list all your Lambda functions. You can do this by using the AWS CLI command `aws lambda list-functions`. This command will return a JSON object with all your Lambda functions.

2. Once you have the list of all your Lambda functions, you can check each function for a Dead Letter Queue (DLQ) configuration. You can do this by using the AWS CLI command `aws lambda get-function-configuration --function-name FUNCTION_NAME`. Replace `FUNCTION_NAME` with the name of your Lambda function. This command will return a JSON object with the configuration of the specified Lambda function.

3. In the returned JSON object, look for the `DeadLetterConfig` attribute. If this attribute is present, it means that the Lambda function has a DLQ configured. If this attribute is not present, it means that the Lambda function does not have a DLQ configured.

4. Repeat steps 2 and 3 for each Lambda function in your list. If any function does not have a `DeadLetterConfig` attribute, it means that it has a misconfiguration.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) in your environment. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
pip install boto3
```

2. Import the necessary libraries and establish a session with AWS. You will need your AWS access key and secret access key for this step.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2' # or your preferred region
)
```

3. Create a client for AWS Lambda and list all the functions.

```python
lambda_client = session.client('lambda')

response = lambda_client.list_functions()
```

4. Iterate over the functions and check if Dead Letter Queue (DLQ) is configured. If the 'DeadLetterConfig' key is not present in the function configuration, it means DLQ is not configured.

```python
for function in response['Functions']:
    if 'DeadLetterConfig' not in function:
        print(f"DLQ is not configured for function: {function['FunctionName']}")
```

This script will print out the names of all the Lambda functions that do not have DLQ configured.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "AWS Lambda Should Have DLQ Configured" in AWS using AWS console, follow the steps below:

1. Open the AWS Management Console and navigate to the AWS Lambda service.

2. Select the Lambda function that needs to be remediated.

3. In the Configuration tab, scroll down to the "Dead letter queue" section and click on "Edit".

4. In the "Dead letter queue" section, select "Enable" and then select an existing SNS topic or create a new one.

5. Set the maximum number of times the function can retry failed executions. This is the number of times that AWS Lambda attempts to run your function before sending the event to the dead letter queue.

6. Click on "Save" to save the configuration.

7. Verify that the Dead Letter Queue is configured properly by testing the Lambda function with a sample event. 

By following these steps, you have successfully remediated the misconfiguration "AWS Lambda Should Have DLQ Configured" in AWS using the AWS console.

#### Using CLI

Step by step instructions on how to remediate AWS Lambda Should Have DLQ Configured using AWS CLI are:

1. Open the AWS CLI on your local machine.
2. Run the following command to list all the Lambda functions in your AWS account:

   ```
   aws lambda list-functions
   ```

3. Identify the Lambda function that needs to be remediated and note down its name.
4. Run the following command to update the Lambda function and add a Dead Letter Queue (DLQ) configuration:

   ```
   aws lambda update-function-configuration --function-name <function-name> --dead-letter-config TargetArn=<arn-of-the-SQS-queue>
   ```

   Replace `<function-name>` with the name of the Lambda function that needs to be remediated and `<arn-of-the-SQS-queue>` with the ARN of the SQS queue that should be used as the DLQ for this function.

5. Verify that the DLQ configuration has been added to the Lambda function by running the following command:

   ```
   aws lambda get-function-configuration --function-name <function-name>
   ```

   Replace `<function-name>` with the name of the Lambda function that was remediated.

6. Ensure that the SQS queue has the necessary permissions to invoke the Lambda function by adding the following policy to the SQS queue:

   ```
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Principal": {
                   "Service": "lambda.amazonaws.com"
               },
               "Action": "sqs:SendMessage",
               "Resource": "<arn-of-the-SQS-queue>",
               "Condition": {
                   "ArnEquals": {
                       "aws:SourceArn": "<arn-of-the-Lambda-function>"
                   }
               }
           }
       ]
   }
   ```

   Replace `<arn-of-the-SQS-queue>` with the ARN of the SQS queue and `<arn-of-the-Lambda-function>` with the ARN of the Lambda function that was remediated.

7. Verify that the SQS queue has the necessary permissions to invoke the Lambda function by running the following command:

   ```
   aws lambda get-policy --function-name <function-name>
   ```

   Replace `<function-name>` with the name of the Lambda function that was remediated.

With these steps, you have successfully remediated the AWS Lambda Should Have DLQ Configured misconfiguration using AWS CLI.

#### Using Python

To remediate the AWS Lambda misconfiguration of not having a Dead Letter Queue (DLQ) configured, you can follow these steps using Python:

1. Open the AWS Lambda function in the AWS Management Console.

2. Click on the "Configuration" tab.

3. Scroll down to the "Dead Letter Queue" section and click on "Edit".

4. Select the option "Enable Dead Letter Queue" and choose an existing SQS queue or create a new one.

5. Set the "Maximum Receives" value to the desired number of times a message can be unsuccessfully processed before being sent to the DLQ.

6. Click on "Save" to apply the changes.

Alternatively, you can use the AWS SDK for Python (Boto3) to remediate the misconfiguration programmatically. Here's an example code snippet:

```python
import boto3

lambda_client = boto3.client('lambda')

function_name = 'my-lambda-function'
dlq_arn = 'arn:aws:sqs:us-east-1:123456789012:my-dlq'

response = lambda_client.update_function_configuration(
    FunctionName=function_name,
    DeadLetterConfig={
        'TargetArn': dlq_arn,
        'MaxTriggers': 3
    }
)

print(response)
```

In this example, we're using the `update_function_configuration` method to set the DLQ configuration for a Lambda function. The `DeadLetterConfig` parameter takes a dictionary with the `TargetArn` and `MaxTriggers` values. The `TargetArn` is the ARN of the SQS queue to use as the DLQ, and `MaxTriggers` is the maximum number of times a message can be unsuccessfully processed before being sent to the DLQ.


### Additional Reading:

- [https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html](https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html) 


</Tab>
</Tabs>