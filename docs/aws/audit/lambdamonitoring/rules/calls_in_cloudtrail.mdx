---
slug: calls_in_cloudtrail
title: CloudTrail Should Be Enabled For AWS Lambda
sidebar_label: CloudTrail Should Be Enabled For AWS Lambda
---

### More Info:

CloudTrail captures API calls for AWS Lambda as events. The calls captured include calls from the AWS Lambda console and code calls to the AWS Lambda API operations.

### Risk Level

Low

### Address

Operational Maturity, Security

### Compliance Standards

AWSWAF, PCIDSS



### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To ensure that AWS CloudTrail is enabled for AWS Lambda using the AWS Management Console, follow these steps:

1. **Navigate to CloudTrail in the AWS Management Console:**
   - Open the AWS Management Console.
   - In the search bar, type "CloudTrail" and select it from the dropdown list.

2. **Create or Verify a Trail:**
   - If you do not have an existing trail, click on "Create trail."
   - If you already have a trail, ensure it is configured to log all management and data events.

3. **Configure Management Events:**
   - In the "Create trail" or "Edit trail" page, ensure that "Management events" is enabled.
   - Select "Read/Write events" as per your requirement (Read-only, Write-only, or All).

4. **Enable Data Events for Lambda:**
   - Scroll down to the "Data events" section.
   - Click on "Add data event."
   - Select "Lambda function" and specify the Lambda functions you want to monitor.
   - Ensure that the "Read/Write events" option is selected as per your requirement.

By following these steps, you can ensure that CloudTrail is properly configured to log events for AWS Lambda, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
To ensure that AWS CloudTrail is enabled for AWS Lambda using the AWS CLI, follow these steps:

1. **Create a CloudTrail Trail:**
   First, create a CloudTrail trail if you don't already have one. This trail will log all the events, including those from AWS Lambda.

   ```sh
   aws cloudtrail create-trail --name my-trail --s3-bucket-name my-trail-bucket
   ```

2. **Start Logging:**
   Enable logging for the created CloudTrail trail to ensure that it starts capturing events.

   ```sh
   aws cloudtrail start-logging --name my-trail
   ```

3. **Verify CloudTrail Status:**
   Check the status of the CloudTrail to ensure it is enabled and logging events.

   ```sh
   aws cloudtrail get-trail-status --name my-trail
   ```

4. **Ensure Lambda Events are Included:**
   By default, CloudTrail logs all management events, including those from AWS Lambda. However, you can explicitly ensure that Lambda events are included by checking the event selectors.

   ```sh
   aws cloudtrail put-event-selectors --trail-name my-trail --event-selectors '[{"ReadWriteType": "All", "IncludeManagementEvents": true}]'
   ```

By following these steps, you can ensure that CloudTrail is enabled and properly configured to log AWS Lambda events using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To ensure that AWS CloudTrail is enabled for AWS Lambda using Python scripts, you can follow these steps:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed, which is the AWS SDK for Python. You can install it using pip if you haven't already.

   ```bash
   pip install boto3
   ```

2. **Create a Boto3 Session**:
   Initialize a Boto3 session and create a CloudTrail client. This will allow you to interact with the CloudTrail service.

   ```python
   import boto3

   # Initialize a session using Amazon EC2
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )

   # Create CloudTrail client
   cloudtrail_client = session.client('cloudtrail')
   ```

3. **Check if CloudTrail is Enabled**:
   Write a function to check if CloudTrail is enabled. This function will list all trails and check their status.

   ```python
   def is_cloudtrail_enabled():
       trails = cloudtrail_client.describe_trails()
       for trail in trails['trailList']:
           status = cloudtrail_client.get_trail_status(Name=trail['Name'])
           if status['IsLogging']:
               return True
       return False
   ```

4. **Enable CloudTrail if Not Enabled**:
   If CloudTrail is not enabled, create a new trail and start logging.

   ```python
   def enable_cloudtrail():
       if not is_cloudtrail_enabled():
           response = cloudtrail_client.create_trail(
               Name='DefaultTrail',
               S3BucketName='your-s3-bucket-name',
               IncludeGlobalServiceEvents=True,
               IsMultiRegionTrail=True,
               EnableLogFileValidation=True
           )
           cloudtrail_client.start_logging(Name='DefaultTrail')
           print("CloudTrail has been enabled and logging started.")
       else:
           print("CloudTrail is already enabled.")

   # Call the function to enable CloudTrail
   enable_cloudtrail()
   ```

### Summary
1. **Install Boto3 Library**: Ensure Boto3 is installed.
2. **Create a Boto3 Session**: Initialize a session and create a CloudTrail client.
3. **Check if CloudTrail is Enabled**: Write a function to check the status of CloudTrail.
4. **Enable CloudTrail if Not Enabled**: Create a new trail and start logging if CloudTrail is not already enabled.

By following these steps, you can ensure that CloudTrail is enabled for AWS Lambda using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Lambda service. You can find this by typing 'Lambda' into the search bar at the top of the console.
3. Once in the Lambda service, select the function you want to check for CloudTrail.
4. In the function's configuration page, scroll down to the 'Monitoring' section. Here, you should see a 'CloudTrail' tab. If CloudTrail is enabled, you will see a list of CloudTrail events. If it is not enabled, this tab will be empty.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account details. You can install AWS CLI by following the instructions provided in the official AWS documentation. After installation, you can configure it by running `aws configure` command and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Lambda functions: Use the following AWS CLI command to list all the Lambda functions in your AWS account:

   ```
   aws lambda list-functions --region your-region-name
   ```
   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all the Lambda functions in the specified region.

3. Check CloudTrail for each Lambda function: For each Lambda function, you need to check if CloudTrail is enabled. You can do this by using the following AWS CLI command:

   ```
   aws cloudtrail describe-trails
   ```
   This command will return a list of all the CloudTrail trails in your AWS account. You need to check if the Lambda function name appears in the list of trails.

4. Check CloudTrail event selectors: For each trail, you need to check if the event selectors are configured to include Lambda events. You can do this by using the following AWS CLI command:

   ```
   aws cloudtrail get-event-selectors --trail-name your-trail-name
   ```
   Replace 'your-trail-name' with the name of your CloudTrail trail. This command will return the event selectors for the specified trail. You need to check if the 'IncludeManagementEvents' is set to true and 'ReadWriteType' is set to 'All'. If these conditions are not met, then CloudTrail is not properly configured for the Lambda function.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules in your Python script. You will need the 'boto3' module to interact with AWS services and the 'botocore.exceptions' module to handle any exceptions that may occur.

```python
import boto3
from botocore.exceptions import NoCredentialsError, ClientError
```

2. Create a session using your AWS credentials. If you have your AWS credentials set up in your environment, Boto3 will automatically use those. If not, you can manually input your access key, secret access key, and region.

```python
try:
    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='YOUR_REGION'
    )
except NoCredentialsError:
    print("No AWS credentials were found.")
```

3. Create a client for AWS Lambda and AWS CloudTrail. You will use the Lambda client to list all your Lambda functions and the CloudTrail client to check if CloudTrail is enabled for each function.

```python
lambda_client = session.client('lambda')
cloudtrail_client = session.client('cloudtrail')
```

4. Iterate over all your Lambda functions and check if CloudTrail is enabled for each one. If CloudTrail is not enabled for a function, print a message indicating this.

```python
try:
    functions = lambda_client.list_functions()
    for function in functions['Functions']:
        try:
            trails = cloudtrail_client.describe_trails(trailNameList=[function['FunctionName']])
            if not trails['trailList']:
                print(f"CloudTrail is not enabled for the function: {function['FunctionName']}")
        except ClientError as e:
            print(f"Error checking CloudTrail for the function: {function['FunctionName']}. Error: {e}")
except ClientError as e:
    print(f"Error listing Lambda functions. Error: {e}")
```

This script will print a message for each Lambda function that does not have CloudTrail enabled. If there are any errors listing the Lambda functions or checking CloudTrail, those will also be printed.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "CloudTrail should be enabled for AWS Lambda" in AWS, follow these steps:

1. Go to the AWS Management Console and log in to your account.
2. Open the AWS Lambda console.
3. Select the function for which you want to enable CloudTrail.
4. Click on the "Configuration" tab.
5. Scroll down to the "Advanced settings" section and click on "Edit".
6. In the "CloudWatch Logs" section, select "Enable CloudWatch Logs".
7. In the "CloudTrail" section, select "Enable CloudTrail logs".
8. Choose the S3 bucket where you want to store the CloudTrail logs.
9. Click on "Save".

Once you complete these steps, CloudTrail will be enabled for AWS Lambda and the logs will be saved to the specified S3 bucket. This will help you to monitor and audit the actions performed on your AWS Lambda functions, which is important for security and compliance purposes.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS using AWS CLI, follow these steps:

1. Open your terminal and ensure that you have AWS CLI installed and configured with your AWS account credentials.

2. Run the following command to enable CloudTrail for AWS Lambda:

```
aws lambda update-function-configuration --function-name <function-name> --tracing-config Mode=Active
```

Replace `<function-name>` with the name of the AWS Lambda function for which you want to enable CloudTrail.

3. Verify that CloudTrail is enabled for the Lambda function by running the following command:

```
aws lambda get-function-configuration --function-name <function-name>
```

This should return a JSON object that includes the `TracingConfig` key with a value of `{"Mode": "Active"}`.

4. Repeat the above steps for all other AWS Lambda functions in your account to ensure that CloudTrail is enabled for them as well.

By following these steps, you can remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of CloudTrail not being enabled for AWS Lambda in AWS, you can follow the below steps using Python:

1. Import the boto3 library to interact with AWS resources using Python.

```
import boto3
```

2. Create a boto3 client for AWS Lambda and CloudTrail.

```
lambda_client = boto3.client('lambda')
cloudtrail_client = boto3.client('cloudtrail')
```

3. Get the ARN of the existing CloudTrail trail.

```
trail_arn = cloudtrail_client.describe_trails()['trailList'][0]['TrailARN']
```

4. Create a new CloudTrail trail if one does not exist.

```
if not trail_arn:
    cloudtrail_client.create_trail(Name='MyCloudTrail')
    trail_arn = cloudtrail_client.describe_trails()['trailList'][0]['TrailARN']
```

5. Check if CloudTrail is enabled for the AWS Lambda function.

```
lambda_function_name = 'MyLambdaFunction'
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn not in trail_arn:
        cloudtrail_client.update_trail(
            Name='MyCloudTrail',
            CloudWatchLogsLogGroupArn=cloud_watch_logs_arn,
            CloudWatchLogsRoleArn='arn:aws:iam::123456789012:role/MyCloudTrailRole'
        )
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

6. If CloudTrail is not enabled for the AWS Lambda function, enable it by adding the CloudWatch log group ARN to the CloudTrail trail.

```
lambda_function_name = 'MyLambdaFunction'
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn not in trail_arn:
        cloudtrail_client.update_trail(
            Name='MyCloudTrail',
            CloudWatchLogsLogGroupArn=cloud_watch_logs_arn,
            CloudWatchLogsRoleArn='arn:aws:iam::123456789012:role/MyCloudTrailRole'
        )
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

7. Verify that CloudTrail is now enabled for the AWS Lambda function.

```
response = lambda_client.get_function_configuration(FunctionName=lambda_function_name)

if 'CloudWatchLogsLogGroupArn' in response:
    cloud_watch_logs_arn = response['CloudWatchLogsLogGroupArn']
    if cloud_watch_logs_arn in trail_arn:
        print(f'CloudTrail is enabled for Lambda function {lambda_function_name}')
else:
    print(f'CloudTrail is not enabled for Lambda function {lambda_function_name}')
```

These steps will enable CloudTrail for the AWS Lambda function and ensure that logs are being captured.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/lambda/latest/dg/logging-using-cloudtrail.html](https://docs.aws.amazon.com/lambda/latest/dg/logging-using-cloudtrail.html) 

