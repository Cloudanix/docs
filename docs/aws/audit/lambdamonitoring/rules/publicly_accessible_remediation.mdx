
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the AWS Lambda console.

2. In the navigation pane, choose "Functions". This will display a list of all your Lambda functions.

3. Select the function you want to check for public accessibility. 

4. In the function's detail page, scroll down to the "Designer" section and click on "Amazon API Gateway" or "AWS API Gateway". If the API Gateway is attached, it means the function could be publicly accessible. Check the "Resource Policy" in the "Permissions" tab to see if the function allows access from any source ('Principal': '*'). If it does, then the function is publicly accessible.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all your Lambda functions. You can do this by using the AWS CLI command:

```bash
aws lambda list-functions --region your-region
```
Replace "your-region" with your actual AWS region. This command will return a list of all your Lambda functions in the specified region.

2. Once you have the list of Lambda functions, you can check the resource policy of each function. The resource policy controls who can invoke your function. You can retrieve the resource policy by using the following AWS CLI command:

```bash
aws lambda get-policy --function-name your-function-name --region your-region
```
Replace "your-function-name" with the name of your Lambda function and "your-region" with your actual AWS region. This command will return the resource policy of the specified Lambda function.

3. After retrieving the resource policy, you need to check if the policy allows public access. If the "Principal" field in the policy is set to "*", this means the function is publicly accessible. 

4. Repeat steps 2 and 3 for each Lambda function in your list. If any function's resource policy allows public access, then it is a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new client for AWS Lambda:

```python
import boto3
lambda_client = boto3.client('lambda')
```

2. Retrieve a list of all your Lambda functions:

```python
response = lambda_client.list_functions()
```

3. Iterate over each function and check the policy attached to it. If the policy allows the 'lambda:InvokeFunction' action for the 'Principal' '*', then the function is publicly accessible:

```python
for function in response['Functions']:
    policy = lambda_client.get_policy(FunctionName=function['FunctionName'])
    if 'Statement' in policy['Policy']:
        for statement in policy['Policy']['Statement']:
            if statement['Action'] == 'lambda:InvokeFunction' and statement['Principal'] == '*':
                print(f"Function {function['FunctionName']} is publicly accessible.")
```

4. If the script prints out any function names, those functions are publicly accessible and you have detected a misconfiguration. If the script does not print out any function names, then none of your Lambda functions are publicly accessible.

Please note that this script only checks for public accessibility via the 'lambda:InvokeFunction' action. There may be other ways a function can be made publicly accessible, so this script should be part of a larger security review process.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Here are the step-by-step instructions to remediate the issue of publicly accessible Lambda functions in AWS console:

1. Log in to your AWS Management Console.
2. Navigate to the AWS Lambda service.
3. Select the Lambda function that you want to remediate.
4. Click on the "Configuration" tab.
5. Scroll down to the "Network" section.
6. Under "Network", you will see the "Lambda function" section. Click on the "Edit" button.
7. You will see the "Configure Function" page. Under the "General configuration" section, you will see the "VPC" and "Public network access" options.
8. Select the VPC that the Lambda function should be associated with.
9. Under "Public network access", select "Disable" to prevent the Lambda function from being publicly accessible.
10. Click on the "Save" button to save the changes.

Once you have completed these steps, your Lambda function will no longer be publicly accessible and will only be accessible within the specified VPC.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of Lambda Functions being publicly accessible in AWS, you can follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the list of all Lambda Functions in your AWS account:

```
aws lambda list-functions
```

3. Identify the Lambda Function(s) that are publicly accessible.

4. Run the following command to update the access control policy of the identified Lambda Function(s):

```
aws lambda update-function-configuration --function-name <function-name> --vpc-config SubnetIds=<subnet-ids>,SecurityGroupIds=<security-group-ids>
```

Replace `<function-name>` with the name of the identified Lambda Function and `<subnet-ids>` and `<security-group-ids>` with the IDs of the subnets and security groups that you want to associate with the Lambda Function.

5. Once the access control policy is updated, run the following command to verify that the Lambda Function is no longer publicly accessible:

```
aws lambda get-policy --function-name <function-name>
```

This should return the access control policy of the Lambda Function. Verify that the policy restricts public access to the Lambda Function.

6. Repeat steps 4 and 5 for all the identified Lambda Functions that are publicly accessible.

By following the above steps, you can remediate the issue of Lambda Functions being publicly accessible in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of publicly accessible Lambda functions in AWS using Python, you can follow these steps:

Step 1: Open the AWS Lambda function console.

Step 2: Select the Lambda function that you want to remediate.

Step 3: Scroll down to the "Configuration" section and click on the "Permissions" tab.

Step 4: In the "Permissions" tab, you will see a section called "Resource-based policy". Click on the "Edit" button next to it.

Step 5: In the "Edit Resource-based policy" window, you will see the "Principal" section. This section specifies the AWS account or IAM user that is allowed to access the Lambda function.

Step 6: To remediate the issue, you need to remove the "Principal" section or replace it with a specific AWS account or IAM user that is authorized to access the Lambda function.

Step 7: You can use the following Python code to remove the "Principal" section from the Lambda function's resource-based policy:

```
import boto3
import json

# Replace 'lambda_function_name' with your Lambda function name
lambda_function_name = 'my_lambda_function'

lambda_client = boto3.client('lambda')

# Get the current resource-based policy of the Lambda function
response = lambda_client.get_policy(FunctionName=lambda_function_name)
policy = json.loads(response['Policy'])

# Remove the 'Principal' section from the resource-based policy
del policy['Statement'][0]['Principal']

# Update the resource-based policy of the Lambda function
lambda_client.add_permission(
    FunctionName=lambda_function_name,
    StatementId='1',
    Action='lambda:InvokeFunction',
    Principal='',
    SourceArn='',
    SourceAccount='',
    EventSourceToken='',
    Qualifier='',
    RevisionId='',
    Policy=json.dumps(policy)
)

print('Resource-based policy updated successfully')
```

Note: Make sure that you have the necessary permissions to modify the Lambda function's resource-based policy.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
