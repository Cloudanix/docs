---
slug: opensearch_encrypted_at_rest
title: Encryption At Rest Should Be Enabled OpenSearch Service Domains
sidebar_label: Encryption At Rest Should Be Enabled OpenSearch Service Domains
---
### More Info:

This rule checks whether Amazon OpenSearch Service domains have encryption at rest configuration enabled. Encryption at rest helps protect sensitive data stored in OpenSearch domains from unauthorized access. The rule is marked as non-compliant if the EncryptionAtRestOptions field is not enabled.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,SEBI,RBI_UCB


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of "Encryption At Rest Should Be Enabled" for OpenSearch Service Domains in AWS using the AWS Management Console, follow these steps:

1. **Navigate to OpenSearch Service:**
   - Open the AWS Management Console.
   - In the search bar, type "OpenSearch Service" and select it from the dropdown.

2. **Select the Domain:**
   - In the OpenSearch Service dashboard, you will see a list of your OpenSearch domains.
   - Click on the domain name for which you want to enable encryption at rest.

3. **Modify the Domain:**
   - In the domain details page, click on the "Actions" button and select "Modify domain" from the dropdown menu.

4. **Enable Encryption at Rest:**
   - In the "Modify domain" settings, navigate to the "Encryption" section.
   - Check the box for "Enable encryption of data at rest".
   - Choose the AWS Key Management Service (KMS) key you want to use for encryption.
   - Review the changes and click on the "Submit" button to apply the changes.

By following these steps, you can ensure that encryption at rest is enabled for your OpenSearch Service domains, enhancing the security of your data.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of "Encryption At Rest Should Be Enabled" for OpenSearch Service Domains using AWS CLI, follow these steps:

1. **Create a KMS Key:**
   First, create a KMS key that will be used for encryption. This key will be used to encrypt the data at rest in your OpenSearch Service domain.
   ```sh
   aws kms create-key --description "KMS key for OpenSearch Service encryption"
   ```

2. **Create an OpenSearch Service Domain with Encryption Enabled:**
   When creating a new OpenSearch Service domain, specify the KMS key to enable encryption at rest.
   ```sh
   aws opensearch create-domain --domain-name my-domain \
       --encryption-at-rest-options Enabled=true,KmsKeyId=<your-kms-key-id>
   ```

3. **Update an Existing OpenSearch Service Domain to Enable Encryption:**
   If you have an existing domain, you can update it to enable encryption at rest. Note that this operation might require downtime.
   ```sh
   aws opensearch update-domain-config --domain-name my-domain \
       --encryption-at-rest-options Enabled=true,KmsKeyId=<your-kms-key-id>
   ```

4. **Verify Encryption Settings:**
   After creating or updating the domain, verify that encryption at rest is enabled.
   ```sh
   aws opensearch describe-domain --domain-name my-domain \
       --query "DomainStatus.EncryptionAtRestOptions"
   ```

Replace `<your-kms-key-id>` with the actual KMS key ID you created in step 1. These steps ensure that your OpenSearch Service domain has encryption at rest enabled, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To ensure that Encryption At Rest is enabled for OpenSearch Service Domains in AWS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Below are the steps to achieve this:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

3. **Create a Python Script to Enable Encryption At Rest**:
   Below is a Python script that demonstrates how to enable encryption at rest for an OpenSearch Service Domain.

   ```python
   import boto3

   # Initialize a session using Amazon OpenSearch Service
   client = boto3.client('opensearch')

   # Define the domain name
   domain_name = 'your-domain-name'

   # Enable encryption at rest
   response = client.update_domain_config(
       DomainName=domain_name,
       EncryptionAtRestOptions={
           'Enabled': True
       }
   )

   # Print the response
   print(response)
   ```

4. **Run the Script**:
   Execute the script to update the domain configuration and enable encryption at rest.
   ```bash
   python enable_encryption_at_rest.py
   ```

By following these steps, you can ensure that encryption at rest is enabled for your OpenSearch Service Domains using a Python script. This helps in securing your data and complying with security best practices.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the OpenSearch Service dashboard. You can do this by typing "OpenSearch Service" into the search bar at the top of the console, then selecting OpenSearch Service from the dropdown menu.
3. In the OpenSearch Service dashboard, you will see a list of all your OpenSearch Service domains. Click on the name of the domain you want to check.
4. In the domain details page, look for the "Encryption at rest" section. If encryption at rest is enabled, you will see "Enabled" next to "Encryption at rest". If it is not enabled, you will see "Disabled".
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the OpenSearch Service domains in your AWS account. You can do this by using the following AWS CLI command:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all the OpenSearch Service domains in your AWS account.

2. Once you have the list of domains, you can describe each domain to get its configuration details. You can do this by using the following AWS CLI command:

   ```
   aws es describe-elasticsearch-domain --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your OpenSearch Service domain. This command will return the configuration details of the specified domain.

3. From the configuration details, you can check if encryption at rest is enabled for the domain. The `EncryptionAtRestOptions` field in the response indicates whether encryption at rest is enabled. If the `Enabled` field under `EncryptionAtRestOptions` is `true`, then encryption at rest is enabled.

4. Repeat steps 2 and 3 for each domain in your list. If any domain has encryption at rest disabled, then you have detected a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials via the AWS CLI, or by manually adding them to the AWS credentials file (located at ~/.aws/credentials). For example:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check the encryption status: You can use the boto3 library to interact with the AWS OpenSearch Service. Here is a simple script that lists all OpenSearch domains and checks if encryption at rest is enabled:

   ```python
   import boto3

   def check_encryption_at_rest():
       client = boto3.client('es')
       domains = client.list_domain_names()
       for domain in domains['DomainNames']:
           domain_name = domain['DomainName']
           domain_config = client.describe_elasticsearch_domain(DomainName=domain_name)
           domain_encryption_at_rest = domain_config['DomainStatus']['EncryptionAtRestOptions']['Enabled']
           if domain_encryption_at_rest:
               print(f"Domain {domain_name} has encryption at rest enabled.")
           else:
               print(f"Domain {domain_name} does not have encryption at rest enabled.")

   if __name__ == "__main__":
       check_encryption_at_rest()
   ```

4. Run the script: You can run the script from your command line using the Python interpreter. The script will print out the names of all OpenSearch domains and whether they have encryption at rest enabled:

   ```bash
   python check_encryption_at_rest.py
   ```

This script will help you identify any OpenSearch domains that do not have encryption at rest enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of enabling Encryption At Rest for AWS OpenSearch Service Domains, follow these step-by-step instructions using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/) and log in to your account.

2. **Navigate to Amazon OpenSearch Service**: In the AWS Management Console, search for "OpenSearch Service" in the search bar at the top of the page and click on the service.

3. **Select the OpenSearch Domain**: From the list of OpenSearch domains, select the domain for which you want to enable Encryption At Rest.

4. **Click on the Domain Name**: Click on the name of the selected OpenSearch domain to open the domain details page.

5. **Navigate to Security**: In the domain details page, navigate to the "Security" section in the left-hand menu.

6. **Enable Encryption At Rest**: In the "Encryption At Rest" section, click on the "Edit" button to modify the encryption settings.

7. **Enable Encryption**: In the encryption settings, select the option to enable Encryption At Rest. You can choose to use the AWS managed KMS key or provide your custom KMS key for encryption.

8. **Save Changes**: After enabling Encryption At Rest and configuring the encryption settings as per your requirements, click on the "Save changes" button to apply the changes.

9. **Monitor Encryption Status**: Once the changes are saved, monitor the status of Encryption At Rest for the OpenSearch domain to ensure that it is successfully enabled.

By following these steps, you can remediate the misconfiguration of enabling Encryption At Rest for AWS OpenSearch Service Domains using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To enable encryption at rest for an Amazon OpenSearch Service domain in AWS using the AWS CLI, follow these steps:

1. **Identify the OpenSearch Service domain**: First, you need to identify the OpenSearch Service domain for which you want to enable encryption at rest. You can list all the domains using the following AWS CLI command:
   ```
   aws opensearchservice list-domain-names
   ```

2. **Enable encryption at rest**: Once you have identified the domain, you can enable encryption at rest by updating the domain configuration. Use the following AWS CLI command to update the domain configuration and enable encryption at rest:
   ```
   aws opensearchservice update-domain-config --domain-name <your-domain-name> --advanced-security-options Enabled=true,InternalUserDatabaseEnabled=true --node-to-node-encryption-options Enabled=true
   ```
   Replace `<your-domain-name>` with the actual name of your OpenSearch Service domain.

3. **Monitor the domain**: After enabling encryption at rest, monitor the domain to ensure that the configuration change is successfully applied. You can check the status of the domain using the following AWS CLI command:
   ```
   aws opensearchservice describe-elasticsearch-domain --domain-name <your-domain-name> --query "DomainStatus"
   ```
   Replace `<your-domain-name>` with the actual name of your OpenSearch Service domain.

4. **Verify encryption at rest**: Finally, verify that encryption at rest is enabled for the OpenSearch Service domain by checking the domain configuration. You can use the following AWS CLI command to describe the domain configuration:
   ```
   aws opensearchservice describe-elasticsearch-domain-config --domain-name <your-domain-name> --query "DomainConfig.ElasticsearchClusterConfig.NodeToNodeEncryptionOptions"
   ```
   Replace `<your-domain-name>` with the actual name of your OpenSearch Service domain.

By following these steps, you can remediate the misconfiguration and enable encryption at rest for an Amazon OpenSearch Service domain in AWS using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of enabling Encryption At Rest for AWS OpenSearch Service domains using Python, you can use the AWS SDK for Python (Boto3) to update the domain configuration. Here are the step-by-step instructions to enable Encryption At Rest for an AWS OpenSearch Service domain:

1. Install Boto3: If you haven't already installed the Boto3 library, you can do so using pip:

```bash
pip install boto3
```

2. Configure AWS Credentials: Make sure you have your AWS credentials configured either by setting environment variables or using AWS CLI `aws configure`.

3. Write Python script: Create a Python script with the following code to enable Encryption At Rest for the OpenSearch Service domain. Replace `your-domain-name` with the actual domain name of your OpenSearch Service domain:

```python
import boto3

def enable_encryption_at_rest(domain_name):
    client = boto3.client('es')

    response = client.update_elasticsearch_domain_config(
        DomainName=domain_name,
        ElasticsearchClusterConfig={
            'DedicatedMasterEnabled': False,
            'InstanceCount': 1,
            'InstanceType': 't2.small.elasticsearch',
            'ZoneAwarenessEnabled': False
        },
        EBSOptions={
            'EBSEnabled': True,
            'VolumeType': 'gp2',
            'VolumeSize': 10
        },
        EncryptionAtRestOptions={
            'Enabled': True
        }
    )

    print("Encryption at rest has been enabled for the OpenSearch Service domain: {}".format(domain_name))

if __name__ == "__main__":
    domain_name = 'your-domain-name'
    enable_encryption_at_rest(domain_name)
```

4. Run the script: Execute the Python script to enable Encryption At Rest for the specified OpenSearch Service domain:

```bash
python enable_encryption_at_rest.py
```

After running the script, Encryption At Rest should be enabled for the specified AWS OpenSearch Service domain.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

