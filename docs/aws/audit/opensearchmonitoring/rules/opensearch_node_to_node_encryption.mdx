---
slug: opensearch_node_to_node_encryption
title: Node-to-Node Encryption Should Be Enabled OpenSearch Service Domains
sidebar_label: Node-to-Node Encryption Should Be Enabled OpenSearch Service Domains
---
### More Info:

This rule checks whether Amazon OpenSearch Service nodes are encrypted end-to-end. Node-to-node encryption ensures that communication between nodes within the OpenSearch domain is encrypted, enhancing the security of data transmission. The rule is marked as non-compliant if node-to-node encryption is not enabled on the domain.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of Node-to-Node Encryption not being enabled in OpenSearch Service Domains using the AWS Management Console, follow these steps:

1. **Navigate to OpenSearch Service:**
   - Open the AWS Management Console.
   - In the search bar, type "OpenSearch Service" and select it from the list of services.

2. **Select the Domain:**
   - In the OpenSearch Service dashboard, you will see a list of your OpenSearch domains.
   - Click on the domain name for which you want to enable Node-to-Node Encryption.

3. **Edit Domain Settings:**
   - In the domain details page, look for the "Actions" button and click on it.
   - Select "Edit domain" from the dropdown menu.

4. **Enable Node-to-Node Encryption:**
   - In the "Edit domain" settings, navigate to the "Security" section.
   - Find the "Node-to-node encryption" option and check the box to enable it.
   - Review your changes and click on the "Save changes" button to apply the new settings.

By following these steps, you ensure that Node-to-Node Encryption is enabled for your OpenSearch Service domain, enhancing the security of data transmitted between nodes.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where Node-to-Node Encryption should be enabled for OpenSearch Service Domains using AWS CLI, follow these steps:

1. **Check Current Configuration:**
   First, verify the current configuration of your OpenSearch domain to see if node-to-node encryption is enabled.
   ```sh
   aws opensearch describe-domain --domain-name <your-domain-name>
   ```

2. **Enable Node-to-Node Encryption:**
   If node-to-node encryption is not enabled, you need to update the domain configuration to enable it. Use the following command:
   ```sh
   aws opensearch update-domain-config --domain-name <your-domain-name> --node-to-node-encryption-options Enabled=true
   ```

3. **Verify the Update:**
   After updating the domain configuration, verify that the node-to-node encryption has been enabled.
   ```sh
   aws opensearch describe-domain --domain-name <your-domain-name>
   ```

4. **Monitor Configuration Changes:**
   Set up AWS CloudWatch or AWS Config rules to monitor changes to your OpenSearch domain configurations to ensure that node-to-node encryption remains enabled.
   ```sh
   aws configservice put-config-rule --config-rule file://config-rule.json
   ```

   Example `config-rule.json`:
   ```json
   {
     "ConfigRuleName": "opensearch-node-to-node-encryption-enabled",
     "Description": "Checks whether node-to-node encryption is enabled for OpenSearch domains.",
     "Scope": {
       "ComplianceResourceTypes": [
         "AWS::OpenSearch::Domain"
       ]
     },
     "Source": {
       "Owner": "AWS",
       "SourceIdentifier": "OPENSEARCH_NODE_TO_NODE_ENCRYPTION_ENABLED"
     }
   }
   ```

By following these steps, you can ensure that node-to-node encryption is enabled for your OpenSearch Service Domains using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of Node-to-Node Encryption not being enabled in OpenSearch Service Domains using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure Node-to-Node Encryption is enabled:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for OpenSearch Service.
   ```python
   import boto3

   client = boto3.client('opensearch')
   ```

3. **Create or Update OpenSearch Domain with Node-to-Node Encryption Enabled**:
   When creating or updating an OpenSearch domain, ensure that the `NodeToNodeEncryptionOptions` is set to `Enabled=True`.

   ```python
   def create_or_update_opensearch_domain(domain_name):
       response = client.create_domain(
           DomainName=domain_name,
           NodeToNodeEncryptionOptions={
               'Enabled': True
           },
           # Include other necessary configurations here
       )
       return response

   # Example usage
   domain_name = 'your-opensearch-domain'
   create_or_update_opensearch_domain(domain_name)
   ```

4. **Verify Node-to-Node Encryption is Enabled**:
   After creating or updating the domain, you can verify that Node-to-Node Encryption is enabled by describing the domain.

   ```python
   def verify_node_to_node_encryption(domain_name):
       response = client.describe_domain(
           DomainName=domain_name
       )
       encryption_status = response['DomainStatus']['NodeToNodeEncryptionOptions']['Enabled']
       return encryption_status

   # Example usage
   domain_name = 'your-opensearch-domain'
   is_encryption_enabled = verify_node_to_node_encryption(domain_name)
   print(f"Node-to-Node Encryption Enabled: {is_encryption_enabled}")
   ```

By following these steps, you can ensure that Node-to-Node Encryption is enabled for your OpenSearch Service domains using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the OpenSearch Service dashboard. You can do this by typing "OpenSearch Service" into the search bar at the top of the console, then selecting OpenSearch Service from the dropdown menu.
3. In the OpenSearch Service dashboard, you will see a list of your OpenSearch domains. Click on the name of the domain you want to check.
4. In the domain configuration page, look for the "Node-to-Node Encryption" field. If it is set to "Disabled", then Node-to-Node Encryption is not enabled for this domain.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS CLI website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all OpenSearch Service domains: Use the following AWS CLI command to list all the OpenSearch Service domains in your AWS account:

   ```
   aws opensearch describe-domain --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your OpenSearch Service domain.

3. Check Node-to-Node Encryption: The output of the above command will include a section called `NodeToNodeEncryptionOptions`. If the `Enabled` field in this section is set to `false`, then Node-to-Node Encryption is not enabled for the OpenSearch Service domain.

   ```
   "NodeToNodeEncryptionOptions": {
       "Enabled": false
   }
   ```
4. Automate the process: If you have multiple OpenSearch Service domains, you can automate the process by using a script. The script would loop through all the domains and run the `describe-domain` command for each one. If the `Enabled` field in the `NodeToNodeEncryptionOptions` section is set to `false`, the script would print out the name of the domain. This way, you can easily identify all the domains where Node-to-Node Encryption is not enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then input your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

3. Create a Python script to check Node-to-Node Encryption: Now, you can create a Python script that uses boto3 to check if Node-to-Node Encryption is enabled for all OpenSearch Service Domains. Here's a simple script that does this:

   ```python
   import boto3

   def check_node_to_node_encryption():
       client = boto3.client('es')
       domains = client.list_domain_names()
       for domain in domains['DomainNames']:
           domain_name = domain['DomainName']
           domain_config = client.describe_elasticsearch_domain(DomainName=domain_name)
           if 'NodeToNodeEncryptionOptions' in domain_config['DomainStatus']:
               if domain_config['DomainStatus']['NodeToNodeEncryptionOptions']['Enabled']:
                   print(f"Node-to-Node Encryption is enabled for {domain_name}")
               else:
                   print(f"Node-to-Node Encryption is not enabled for {domain_name}")
           else:
               print(f"Node-to-Node Encryption is not enabled for {domain_name}")

   if __name__ == "__main__":
       check_node_to_node_encryption()
   ```

4. Run the Python script: Finally, you can run the Python script from your terminal:

   ```bash
   python check_node_to_node_encryption.py
   ```

   This script will print out whether Node-to-Node Encryption is enabled for each OpenSearch Service Domain. If it's not enabled for a domain, that indicates a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Node-to-Node Encryption not being enabled on an AWS OpenSearch Service domain, you can follow these step-by-step instructions using the AWS Management Console:

1. **Navigate to AWS OpenSearch Service Console:**
   - Go to the AWS Management Console (https://console.aws.amazon.com/)
   - In the "Find services" search bar, type "OpenSearch Service" and select it from the dropdown.

2. **Select the OpenSearch Service Domain:**
   - From the list of OpenSearch Service domains, select the domain for which you want to enable Node-to-Node Encryption.

3. **Enable Node-to-Node Encryption:**
   - In the domain dashboard, click on the domain name to go to the domain details page.
   - In the left-hand navigation pane, click on the "Configure domain" tab.

4. **Edit the Security Configuration:**
   - Scroll down to the "Security" section and click on the "Edit" button next to the "Node-to-Node Encryption" setting.

5. **Enable Node-to-Node Encryption:**
   - Toggle the switch to enable Node-to-Node Encryption.
   - You may also have the option to provide a custom encryption key or use the default AWS managed key.

6. **Save Changes:**
   - Once you have enabled Node-to-Node Encryption, click on the "Save changes" button to apply the configuration.

7. **Verify Node-to-Node Encryption:**
   - To ensure that Node-to-Node Encryption is successfully enabled, you can check the domain status or perform a test query to confirm the encryption is in place.

8. **Monitor the Domain:**
   - After enabling Node-to-Node Encryption, monitor the domain for any issues and ensure that all nodes are communicating securely.

By following these steps, you can successfully remediate the misconfiguration of Node-to-Node Encryption not being enabled on an AWS OpenSearch Service domain using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of enabling Node-to-Node Encryption for AWS OpenSearch Service domains using AWS CLI, you can follow these steps:

1. **Enable Node-to-Node Encryption:**
   
   Run the following AWS CLI command to enable Node-to-Node encryption for your OpenSearch Service domain:
   ```bash
   aws opensearchservice update-domain-config --domain-name YOUR_DOMAIN_NAME --node-to-node-encryption-options Enabled=true
   ```
   Replace `YOUR_DOMAIN_NAME` with the name of your OpenSearch Service domain.

2. **Verify Node-to-Node Encryption:**
   
   You can verify that Node-to-Node encryption is enabled for your OpenSearch Service domain by describing the domain configuration:
   ```bash
   aws opensearchservice describe-domain-config --domain-name YOUR_DOMAIN_NAME
   ```
   Ensure that the `NodeToNodeEncryptionOptions` parameter shows `Enabled: true`.

3. **Monitor the Configuration:**
   
   It is recommended to monitor the OpenSearch Service domain for any issues after enabling Node-to-Node encryption to ensure that the domain continues to function properly.

By following these steps, you can successfully remediate the misconfiguration of enabling Node-to-Node Encryption for AWS OpenSearch Service domains using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of enabling Node-to-Node Encryption for AWS OpenSearch Service domains using Python, you can utilize the AWS SDK for Python (Boto3) to update the domain configuration. Here are the step-by-step instructions to remediate this issue:

1. Install Boto3:
Ensure you have Boto3 installed in your Python environment. You can install it using pip:

```bash
pip install boto3
```

2. Update OpenSearch Domain Configuration:
Create a Python script with the following code to update the OpenSearch domain configuration to enable Node-to-Node Encryption:

```python
import boto3

def update_opensearch_domain_config(domain_name):
    client = boto3.client('es')
    
    response = client.update_elasticsearch_domain_config(
        DomainName=domain_name,
        NodeToNodeEncryptionOptions={
            'Enabled': True
        }
    )
    
    print(f"Node-to-Node Encryption enabled for OpenSearch domain {domain_name}")

# Replace 'your-opensearch-domain-name' with the actual OpenSearch domain name
update_opensearch_domain_config('your-opensearch-domain-name')
```

3. Configure AWS Credentials:
Ensure that your AWS credentials are properly configured either through environment variables, AWS CLI configuration, or IAM roles.

4. Run the Python Script:
Execute the Python script you created in step 2. This script will update the specified OpenSearch domain configuration to enable Node-to-Node Encryption.

After running the script, the Node-to-Node Encryption should be successfully enabled for the specified AWS OpenSearch Service domain.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

