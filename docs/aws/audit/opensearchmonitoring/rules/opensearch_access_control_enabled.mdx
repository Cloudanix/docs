---
slug: opensearch_access_control_enabled
title: Fine-Grained Access Control Should Be Enabled OpenSearch Service Domains
sidebar_label: Fine-Grained Access Control Should Be Enabled OpenSearch Service Domains
---
### More Info:

This rule checks whether Amazon OpenSearch Service domains have fine-grained access control enabled. Fine-grained access control provides enhanced security by allowing more granular control over access to OpenSearch resources. The rule is marked as non-compliant if AdvancedSecurityOptions is not enabled for the OpenSearch Service domain.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the OpenSearch Service dashboard. You can do this by typing "OpenSearch Service" into the search bar at the top of the console, then selecting OpenSearch Service from the dropdown menu.
3. In the OpenSearch Service dashboard, you will see a list of all your OpenSearch domains. Click on the name of the domain you want to check.
4. In the domain configuration page, look for the "Access Policy" section. If the policy is set to "Public access", then fine-grained access control is not enabled. If it is set to "Fine-grained access control", then it is enabled.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all OpenSearch Service domains: Use the following AWS CLI command to list all the OpenSearch Service domains in your AWS account.

   ```
   aws opensearch describe-domain --region your-region-name
   ```

   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all OpenSearch Service domains along with their details.

3. Check for Fine-Grained Access Control: For each domain returned by the previous command, check the 'AdvancedSecurityOptions' field. If the 'Enabled' field under 'AdvancedSecurityOptions' is set to 'false', then Fine-Grained Access Control is not enabled for that domain.

   ```
   aws opensearch describe-domain --region your-region-name --domain-name your-domain-name --query 'DomainStatus.AdvancedSecurityOptions'
   ```

   Replace 'your-region-name' with the name of your AWS region and 'your-domain-name' with the name of your OpenSearch Service domain. This command will return the 'AdvancedSecurityOptions' for the specified domain.

4. Automate the process: If you have many OpenSearch Service domains, it might be more efficient to automate this process using a script. You can use the AWS SDK for Python (Boto3) to write a script that lists all OpenSearch Service domains and checks whether Fine-Grained Access Control is enabled for each one.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3) on your local system. This will allow you to interact with AWS services including OpenSearch Service. You can install it using pip:

```python
pip install boto3
```

2. Once Boto3 is installed, you can use it to list all your OpenSearch domains. Here is a sample script:

```python
import boto3

def list_domains():
    client = boto3.client('es')
    response = client.list_domain_names()
    for domain in response['DomainNames']:
        print(domain['DomainName'])

list_domains()
```

3. After listing all the domains, you can describe each domain to check if Fine-Grained Access Control is enabled or not. Here is a sample script:

```python
import boto3

def check_fine_grained_access_control():
    client = boto3.client('es')
    response = client.list_domain_names()
    for domain in response['DomainNames']:
        domain_config = client.describe_elasticsearch_domain(DomainName=domain['DomainName'])
        if 'AdvancedSecurityOptions' in domain_config['DomainStatus']:
            if domain_config['DomainStatus']['AdvancedSecurityOptions']['Enabled']:
                print(f"Fine-Grained Access Control is enabled for {domain['DomainName']}")
            else:
                print(f"Fine-Grained Access Control is not enabled for {domain['DomainName']}")

check_fine_grained_access_control()
```

4. The above script will print the status of Fine-Grained Access Control for each OpenSearch domain. If it's not enabled for a domain, it means there is a misconfiguration. You can then take necessary actions to enable it.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of enabling Fine-Grained Access Control on an AWS OpenSearch Service domain, you can follow these steps using the AWS Management Console:

1. **Navigate to the Amazon OpenSearch Service Console**:
   - Go to the AWS Management Console (https://aws.amazon.com/console/).
   - In the "Find Services" search bar, type "OpenSearch Service" and click on it to open the OpenSearch Service console.

2. **Select the OpenSearch Service Domain**:
   - In the OpenSearch dashboard, select the domain for which you want to enable Fine-Grained Access Control.

3. **Navigate to the Security Tab**:
   - In the left-hand navigation pane, click on the "Configure access and resource policies" tab under the "Domain" section.

4. **Enable Fine-Grained Access Control**:
   - Under the "Fine-grained access control" section, click on the "Edit" button.

5. **Configure Fine-Grained Access Control**:
   - In the Fine-grained access control configuration, you can define access policies for different resources and actions.
   - Enable the Fine-Grained Access Control by toggling the switch to "Enabled".
   - Define the access policies based on your requirements. You can set access policies for specific indices, actions, and IP addresses.

6. **Save Changes**:
   - After configuring the Fine-Grained Access Control policies, click on the "Save changes" button to apply the changes to the OpenSearch Service domain.

7. **Verify the Configuration**:
   - Once the changes are saved, verify that Fine-Grained Access Control is enabled by checking the settings in the Security tab of the OpenSearch Service domain.

By following these steps, you can remediate the misconfiguration of enabling Fine-Grained Access Control on an AWS OpenSearch Service domain using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of enabling Fine-Grained Access Control on an AWS OpenSearch Service domain using AWS CLI, follow these steps:

1. **Identify the OpenSearch Service Domain**: Use the following AWS CLI command to list all the OpenSearch Service domains in your account:
   ```
   aws opensearchservice list-domain-names
   ```

2. **Update the Access Policy**: Once you have identified the domain, you need to update the access policy to enable Fine-Grained Access Control. You can do this by creating a new access policy JSON file or updating the existing one. Here is an example of an access policy that enables Fine-Grained Access Control:

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Principal": {
                   "AWS": "*"
               },
               "Action": "es:*",
               "Resource": "arn:aws:es:us-west-2:123456789012:domain/my-domain/*",
               "Condition": {
                   "Bool": {
                       "aws:SecureTransport": "true"
                   }
               }
           }
       ]
   }
   ```

3. **Update the Access Policy**: Use the following AWS CLI command to update the access policy for the OpenSearch Service domain:
   ```bash
   aws opensearchservice update-elasticsearch-domain-config --domain-name my-domain --access-policies file://access-policy.json
   ```

4. **Verify the Configuration**: Finally, verify that Fine-Grained Access Control has been successfully enabled on the OpenSearch Service domain by checking the domain configuration:
   ```bash
   aws opensearchservice describe-elasticsearch-domain-config --domain-name my-domain
   ```

By following these steps and updating the access policy for the OpenSearch Service domain, you can remediate the misconfiguration of enabling Fine-Grained Access Control using AWS CLI.

#### Using Python

To remediate the misconfiguration of enabling fine-grained access control for AWS OpenSearch Service domains using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:

```bash
pip install boto3
```

2. Use the following Python script to enable fine-grained access control for your AWS OpenSearch Service domain:

```python
import boto3

# Define the region where your OpenSearch Service domain is located
region = 'your_region'

# Define the name of your OpenSearch Service domain
domain_name = 'your_domain_name'

# Create a boto3 client for OpenSearch Service
client = boto3.client('es', region_name=region)

# Enable fine-grained access control for the specified domain
response = client.update_elasticsearch_domain_config(
    DomainName=domain_name,
    AccessPolicies={
        'Statement': [
            {
                'Effect': 'Allow',
                'Principal': {
                    'AWS': '*'
                },
                'Action': 'es:*',
                'Resource': 'arn:aws:es:{}:{}:domain/{}'.format(region, 'your_aws_account_id', domain_name)
            }
        ]
    }
)

print("Fine-grained access control has been enabled for the OpenSearch Service domain: {}".format(domain_name))
```

3. Replace the placeholders `your_region`, `your_domain_name`, and `your_aws_account_id` with your actual AWS region, OpenSearch Service domain name, and AWS account ID respectively.

4. Run the Python script. After successful execution, fine-grained access control will be enabled for your AWS OpenSearch Service domain.

Please ensure that you have the necessary permissions to modify the OpenSearch Service domain configuration. You may need to run this script with an IAM user or role that has the required permissions.



</Tab>
</Tabs>