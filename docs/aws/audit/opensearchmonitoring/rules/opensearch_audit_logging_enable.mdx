---
slug: opensearch_audit_logging_enable
title: Opensearch Audit Logging Should Be Enabled
sidebar_label: Opensearch Audit Logging Should Be Enabled
---
### More Info:

Ensure audit logging is enabled for opensearch cluster

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001,SEBI,RBI_UCB


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon OpenSearch Service dashboard.
3. In the navigation pane, choose "Domains".
4. For each domain listed, click on the domain name to open its configuration settings. Under the "Cluster Configuration" section, check if the "Enable audit logs" option is enabled. If it's not, then the OpenSearch Audit Logging is not enabled for that particular domain.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "aws es describe-elasticsearch-domain" command to describe the configuration for the specified Elasticsearch domain. Replace 'domain_name' with the name of your domain.

   ```
   aws es describe-elasticsearch-domain --domain-name 'domain_name'
   ```

3. The output of this command will be a JSON object that contains the configuration information for the specified Elasticsearch domain. Look for the "LogPublishingOptions" field in the output. If the "AuditLogs" field under "LogPublishingOptions" is not present or is set to "DISABLED", then audit logging is not enabled for the specified Elasticsearch domain.

   ```
   "LogPublishingOptions": {
       "AUDIT_LOGS": {
           "CloudWatchLogsLogGroupArn": "string",
           "Enabled": false
       }
   }
   ```

4. To check this for all your Elasticsearch domains, you can use the "aws es list-domain-names" command to get a list of all your Elasticsearch domains, and then run the "describe-elasticsearch-domain" command for each domain.

   ```
   for domain in $(aws es list-domain-names --query 'DomainNames[].DomainName' --output text); do aws es describe-elasticsearch-domain --domain-name $domain; done
   ```
   
This will give you the configuration details for all your Elasticsearch domains, and you can check if audit logging is enabled for each domain.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. For this task, you will need the `boto3` library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: To interact with AWS services, you need to set up your AWS credentials. You can do this by configuring them in the AWS CLI or by setting the `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and `AWS_SESSION_TOKEN` environment variables.

3. Write the Python script: Now you can write the Python script that checks if Opensearch Audit Logging is enabled. Here is a simple script that does this:

   ```python
   import boto3

   def check_opensearch_audit_logging(domain_name):
       client = boto3.client('es')
       response = client.describe_elasticsearch_domain(DomainName=domain_name)
       domain_config = response['DomainStatus']
       audit_logs_options = domain_config['AdvancedOptions']
       if 'rest.action.structured_logging.enabled' in audit_logs_options:
           if audit_logs_options['rest.action.structured_logging.enabled'] == 'true':
               print(f"Audit logging is enabled for {domain_name}")
           else:
               print(f"Audit logging is not enabled for {domain_name}")
       else:
           print(f"Audit logging is not enabled for {domain_name}")

   check_opensearch_audit_logging('your_domain_name')
   ```

   Replace `'your_domain_name'` with the name of your OpenSearch domain.

4. Run the script: Finally, you can run the script using the Python interpreter:

   ```bash
   python check_opensearch_audit_logging.py
   ```

   The script will print whether or not Opensearch Audit Logging is enabled for the specified domain.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Opensearch Audit Logging not being enabled in AWS OpenSearch, follow these steps using the AWS Management Console:

1. **Navigate to the Amazon OpenSearch Service Console**: Go to the AWS Management Console and search for "OpenSearch Service" in the services search bar. Click on the service to open the Amazon OpenSearch Service Console.

2. **Select the Domain**: From the list of domains, select the domain for which you want to enable Audit Logging.

3. **Enable Audit Logging**: In the domain dashboard, click on the "Configure access and security" tab in the left-hand navigation menu.

4. **Edit the Advanced Security Settings**: Under the "Advanced security settings" section, click on the "Edit" button.

5. **Enable Audit Logs**: Scroll down to the "Logging" section and toggle the switch to enable "Log publishing" for audit logs.

6. **Configure Log Publishing**: Configure the destination for the audit logs. You can choose to send logs to Amazon CloudWatch Logs, Amazon S3, or both.

7. **Save Changes**: Click on the "Save" button to apply the changes and enable Audit Logging for the OpenSearch domain.

8. **Verify Audit Logging**: To verify that Audit Logging is enabled, you can check the status in the domain dashboard or navigate to the chosen destination (CloudWatch Logs or S3) to ensure that the audit logs are being published successfully.

By following these steps, you have successfully remediated the misconfiguration of Opensearch Audit Logging not being enabled in AWS OpenSearch.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of enabling audit logging for AWS OpenSearch using AWS CLI, follow these steps:

1. **Enable Audit Logging**: Use the following AWS CLI command to enable audit logging for your AWS OpenSearch domain:
   
   ```bash
   aws opensearchservice update-domain-config --domain-name <your-domain-name> --advanced-security-options Enabled=true,InternalUserDatabaseEnabled=true,AuditLogEnabled=true
   ```

   Replace `<your-domain-name>` with the name of your AWS OpenSearch domain.

2. **Verify Audit Logging**: After running the command, verify that audit logging is enabled for your AWS OpenSearch domain by checking the domain configuration settings:

   ```bash
   aws opensearchservice describe-domain-config --domain-name <your-domain-name> --output json
   ```

   Ensure that the `AuditLogEnabled` parameter is set to `true` in the output.

3. **Monitor Audit Logs**: Once audit logging is enabled, monitor the audit logs to ensure that all relevant activities are being logged appropriately. You can access the audit logs through the AWS Management Console or by using the AWS CLI.

By following these steps, you can successfully remediate the misconfiguration of enabling audit logging for AWS OpenSearch using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of enabling Audit Logging for AWS OpenSearch using Python, you can follow these steps:

Step 1: Install boto3 library
```bash
pip install boto3
```

Step 2: Use the following Python script to enable Audit Logging for AWS OpenSearch:

```python
import boto3

def enable_audit_logging(domain_name):
    client = boto3.client('es')

    response = client.update_domain_config(
        DomainName=domain_name,
        AdvancedSecurityOptions={
            'AuditLogs': {
                'AuditLogRoleArn': 'arn:aws:iam::123456789012:role/OpenSearch-Audit-Role',
                'Enabled': True
            }
        }
    )

    print(response)

# Replace 'your-domain-name' with the actual name of your OpenSearch domain
enable_audit_logging('your-domain-name')
```

Step 3: Replace `'your-domain-name'` with the actual name of your OpenSearch domain in the script.

Step 4: Replace `'arn:aws:iam::123456789012:role/OpenSearch-Audit-Role'` with the ARN of the IAM role that should have permission to write audit logs.

Step 5: Run the Python script. This will enable Audit Logging for the specified OpenSearch domain.

After following these steps, Audit Logging should be successfully enabled for your AWS OpenSearch domain.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

