
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Users". This will display a list of all IAM users that are currently set up for your AWS account.

3. For each user, click on the user name to open the user's "Summary" page. Here, you can see the "Access Advisor" tab which shows the service permissions granted to the user and when those services were last accessed.

4. If the "Last accessed" column shows "No activity", it means the user account has not been used to make an AWS request. If the user account has not been used for a long period of time, it may be a misconfiguration and should be reviewed.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation: `pip install awscli`
   
   Configuration: `aws configure`

2. List all IAM users: Use the following command to list all the IAM users in your AWS account:

   `aws iam list-users`

3. Check the last activity of each user: For each user, you can check their last activity date by using the following command:

   `aws iam get-user --user-name <username>`

   Replace `<username>` with the name of the user. This command will return a JSON object that includes the `PasswordLastUsed` field, which indicates the last time the user logged in to the AWS Management Console.

4. Analyze the output: If the `PasswordLastUsed` field is not present or the date is too old, it means the user account has not been used for a long time and should be considered for removal.
</Accordion>

<Accordion title='Using Python'>
1. **Import necessary libraries and establish a connection with AWS:**
   You need to import the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You also need to establish a connection with AWS using your access keys.

   ```python
   import boto3
   import datetime
   from dateutil.tz import tzutc

   # Create IAM client
   iam = boto3.client(
       'iam',
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       aws_session_token='SESSION_TOKEN',
   )
   ```

2. **Fetch all the IAM users:**
   Use the `list_users` function to fetch all the IAM users.

   ```python
   users = iam.list_users()
   ```

3. **Check the last activity of each user:**
   For each user, you need to check their last activity. You can do this by using the `get_user` function and checking the `PasswordLastUsed` field. If this field is not present or the date is older than your threshold (e.g., 90 days), then the user is not active.

   ```python
   for user in users['Users']:
       user_detail = iam.get_user(UserName=user['UserName'])
       if 'PasswordLastUsed' in user_detail['User']:
           last_used = user_detail['User']['PasswordLastUsed']
           if last_used < datetime.datetime.now(tzutc()) - datetime.timedelta(days=90):
               print(f"User {user['UserName']} is inactive")
       else:
           print(f"User {user['UserName']} has never logged in")
   ```

4. **Check for access key usage:**
   Some users might not log in via the console but might use access keys instead. You need to check the last used date of all access keys of each user. If all access keys are inactive, then the user is inactive.

   ```python
   for user in users['Users']:
       access_keys = iam.list_access_keys(UserName=user['UserName'])
       for key in access_keys['AccessKeyMetadata']:
           last_used_response = iam.get_access_key_last_used(AccessKeyId=key['AccessKeyId'])
           if 'LastUsedDate' in last_used_response['AccessKeyLastUsed']:
               last_used = last_used_response['AccessKeyLastUsed']['LastUsedDate']
               if last_used < datetime.datetime.now(tzutc()) - datetime.timedelta(days=90):
                   print(f"Access key {key['AccessKeyId']} of user {user['UserName']} is inactive")
           else:
               print(f"Access key {key['AccessKeyId']} of user {user['UserName']} has never been used")
   ```
   
This script will print out all the users and access keys that are inactive. You can then decide what to do with these users and keys.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of user accounts without any usage in AWS, you can follow the below steps:

1. Login to your AWS account using your credentials.
2. Go to the AWS Management Console and navigate to the IAM service.
3. In the IAM console, click on the "Users" option from the left-hand menu.
4. You will see a list of all the users in your AWS account.
5. Sort the users by the "Last Activity" column to identify the users who have not used their accounts.
6. Select the user accounts that have not been used and click on the "Delete User" button.
7. Confirm the deletion of the user account by clicking on the "Yes, Delete" button.

By following these steps, you can remediate the issue of user accounts without any usage in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of a user account without any usage in AWS, you can follow these steps using AWS CLI:

1. Open the AWS CLI and run the following command to list all the users in the AWS account:
```
aws iam list-users
```

2. Identify the user accounts that have not been used for a long time.

3. Run the following command to get the details of the user account:
```
aws iam get-user --user-name <username>
```
Replace `<username>` with the name of the user account you want to check.

4. Check the output of the command for the `CreateDate` field. If the user account was created a long time ago and has not been used since, it can be considered for removal.

5. Run the following command to delete the user account:
```
aws iam delete-user --user-name <username>
```
Replace `<username>` with the name of the user account you want to delete.

6. Confirm the deletion by typing `yes` when prompted.

Note: Before deleting a user account, make sure that it is not associated with any resources or services in the AWS account.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of having a user account without any usage in AWS, you can use the following steps in Python:

1. First, you need to identify the user accounts that have not been used for a certain period of time. You can use the AWS SDK for Python (Boto3) to list all the IAM users and check their last activity date.

```python
import boto3
from datetime import datetime, timedelta

# Set the threshold for user inactivity (e.g. 90 days)
threshold_days = 90
threshold_date = datetime.now() - timedelta(days=threshold_days)

# Create an IAM client
iam = boto3.client('iam')

# Get a list of all IAM users
users = iam.list_users()['Users']

# Filter out the users that have been active within the threshold period
inactive_users = []
for user in users:
    access_keys = iam.list_access_keys(UserName=user['UserName'])['AccessKeyMetadata']
    if len(access_keys) == 0:
        last_login = user['CreateDate']
    else:
        last_login = access_keys[0]['CreateDate']
    if last_login < threshold_date:
        inactive_users.append(user['UserName'])
```

2. Once you have identified the inactive users, you can remove them from the AWS account using the `delete_user` method of the IAM client.

```python
# Remove the inactive users
for user in inactive_users:
    iam.delete_user(UserName=user)
```

Note: Before removing any user, make sure to review their permissions and check if they have any active resources or services associated with them. It is also recommended to disable the user account first, rather than deleting it immediately, to allow for a grace period in case the account is still needed.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
