
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console as an IAM user or role.
2. In the navigation pane, choose "Users".
3. In the "User Name" list, choose the name of the intended user which will take you to the "Summary" page.
4. In the "Security Credential" section, look for "Access Keys". If any access keys (Access Key ID and Secret Access Key) are listed, it means the root account has access keys.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once you have AWS CLI installed and configured, you can proceed to the next steps.

2. Open your terminal or command prompt and run the following command to list all the users in your AWS account:

   ```
   aws iam list-users
   ```
   This command will return a list of all the IAM users in your AWS account.

3. For each user in the list, run the following command to list the access keys associated with that user:

   ```
   aws iam list-access-keys --user-name <username>
   ```
   Replace `<username>` with the name of the user. This command will return a list of all the access keys associated with the specified user.

4. If the root account is listed in the output of the first command, and it has access keys associated with it (as shown in the output of the third command), then the root account has access keys, which is a misconfiguration. The root account should not have access keys associated with it, as this can pose a security risk.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

3. Now, you can use the IAM client to list all the access keys associated with your root account:

```python
iam = session.client('iam')

response = iam.list_access_keys(UserName='root')

access_keys = response['AccessKeyMetadata']
```

4. Finally, you can check if any access keys are associated with your root account:

```python
if access_keys:
    print("Root account has access keys")
else:
    print("Root account does not have access keys")
```

This script will print "Root account has access keys" if there are any access keys associated with your root account, and "Root account does not have access keys" otherwise. This way, you can easily detect if your root account has access keys, which is a common misconfiguration in AWS.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. **Sign in to the AWS Management Console**.
2. **Navigate to the IAM service**.
3. **Select Users from the navigation pane**.
4. **Identify the root user**:
   - Locate the user with the username "root".
5. **Review Access Keys**:
   - Click on the root user.
   - Go to the Security credentials tab.
   - Review the list of access keys.
6. **Deactivate or Delete Access Keys**:
   - Select the active access key(s) associated with the root user.
   - Choose Deactivate or Delete to make the access key(s) inactive or delete them.
7. **Repeat for other root users**:
   - If you have multiple root users, repeat the above steps for each of them.

#
</Accordion>

<Accordion title='Using CLI'>
1. **List Access Keys**:
```bash
aws iam list-access-keys --user-name root
```
2. **Identify Active Access Keys**:
   - Look for active access keys associated with the root user.
3. **Deactivate or Delete Access Keys**:
```bash
aws iam update-access-key --access-key-id ACCESS_KEY_ID --status Inactive --user-name root
```
Replace `ACCESS_KEY_ID` with the ID of the access key to deactivate.
4. **Repeat for other active access keys**:
   - If there are multiple active access keys associated with the root user, repeat the deactivation command for each of them.
</Accordion>

<Accordion title='Using Python'>
Here's a Python script to identify and deactivate active access keys associated with the root user:

```python
import boto3

class RootAccessKeyChecker:
    def __init__(self):
        self.iam_client = boto3.client('iam')

    def get_active_access_keys(self):
        failures = []
        response = self.iam_client.list_access_keys(UserName='root')
        for key in response['AccessKeyMetadata']:
            if key['Status'] == 'Active':
                failures.append(key)
        return failures

    def deactivate_access_key(self, access_key_id):
        self.iam_client.update_access_key(
            UserName='root',
            AccessKeyId=access_key_id,
            Status='Inactive'
        )
        print(f"Access key {access_key_id} has been deactivated.")

# Instantiate the class
checker = RootAccessKeyChecker()

# Get active access keys for root user
active_access_keys = checker.get_active_access_keys()

# Deactivate active access keys
for key in active_access_keys:
    checker.deactivate_access_key(key['AccessKeyId'])
```

This Python script identifies active access keys associated with the root user and deactivates them.

Make sure to have appropriate IAM permissions for managing access keys if you're using AWS CLI or Python script.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
