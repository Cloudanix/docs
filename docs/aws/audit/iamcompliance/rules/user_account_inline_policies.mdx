---
slug: user_account_inline_policies
title: Users Should Not Have Inline Policies
sidebar_label: Users Should Not Have Inline Policies
---

### More Info:

IAM users should not have Inline policies. It is recommended that IAM policies be applied directly to groups and roles but not users.

### Risk Level

Low

### Address

Security

### Compliance Standards

HIPAA, GDPR, CISAWS, CBP, NIST, SOC2, PCIDSS, HITRUST, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Users".

3. In the "User Name" list, choose the name of the desired user.

4. In the "Permissions" tab, under "Inline Policies", check if there are any policies listed. If there are any inline policies attached, it indicates a misconfiguration as users should not have inline policies in IAM.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once you have AWS CLI installed and configured, you can start using it to interact with AWS services.

2. To list all the IAM users in your AWS account, use the following command:

   ```
   aws iam list-users
   ```

   This command will return a list of all IAM users in your AWS account.

3. To check if a user has any inline policies, you can use the following command:

   ```
   aws iam list-user-policies --user-name <username>
   ```

   Replace `<username>` with the name of the user you want to check. This command will return a list of all inline policies attached to the specified user.

4. If the command returns any policies, it means that the user has inline policies attached. If the command does not return any policies, it means that the user does not have any inline policies. 

   Note: Inline policies are policies that are directly attached to a user, instead of being attached to a group or role that the user is a part of. While inline policies can be useful in certain situations, they can also lead to misconfigurations and security risks if not managed properly. Therefore, it is generally recommended to use managed policies instead of inline policies whenever possible.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary libraries and establish a session: After installing the necessary libraries, you need to import them into your Python script. You also need to establish a session with AWS using your access key and secret access key.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Get a list of all IAM users: You can use the `list_users` method of the IAM client to get a list of all IAM users. 

```python
iam = session.client('iam')
users = iam.list_users()['Users']
```

4. Check for inline policies: For each user, you can use the `list_user_policies` method to get a list of all inline policies. If the list is not empty, then the user has inline policies.

```python
for user in users:
    user_name = user['UserName']
    inline_policies = iam.list_user_policies(UserName=user_name)['PolicyNames']
    if inline_policies:
        print(f"User {user_name} has inline policies: {inline_policies}")
```

This script will print out the names of all users who have inline policies, along with the names of the policies.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Users Should Not Have Inline Policies" in AWS using the AWS console, follow these steps:

1. Log in to your AWS console.

2. Navigate to the IAM (Identity and Access Management) service.

3. Click on the "Users" tab on the left-hand side of the screen.

4. Select the IAM user(s) with inline policies that you want to remediate.

5. Click on the "Permissions" tab for the selected user(s).

6. Scroll down to the "Inline Policies" section and click on the inline policy that you want to remove.

7. Click on the "Delete" button to remove the inline policy.

8. Repeat steps 6 and 7 for all inline policies associated with the user(s).

9. Once all inline policies have been removed, click on the "Groups" tab for the selected user(s).

10. Add the user(s) to a group that has the appropriate permissions.

11. Click on the "Attach Policy" button to attach the necessary policies to the group.

12. Review the user(s) permissions and ensure that they have the appropriate access to resources.

13. Save the changes.

By following these steps, you can remediate the "Users Should Not Have Inline Policies" misconfiguration in AWS using the AWS console.

#### Using CLI

To remediate the misconfiguration "Users Should Not Have Inline Policies" in AWS using AWS CLI, follow the below steps:

1. Identify the users who have inline policies attached to them. You can use the following AWS CLI command to list all the users with inline policies:

   ```
   aws iam list-users | jq -r '.Users[].UserName' | while read user; do aws iam list-user-policies --user-name $user | jq -r ".PolicyNames[] | \"\($user) \(.),\""; done
   ```

   This command will list all the users with their inline policies attached to them.

2. Once you have identified the users with inline policies, create a new IAM policy that defines the required permissions for the user.

   ```
   aws iam create-policy --policy-name <policy-name> --policy-document file://<path-to-policy-file>
   ```

   Replace `<policy-name>` with a name for your new policy and `<path-to-policy-file>` with the path to the policy file that defines the required permissions.

3. Attach the newly created policy to the user. You can use the following AWS CLI command to attach the policy to the user:

   ```
   aws iam attach-user-policy --user-name <user-name> --policy-arn <policy-arn>
   ```

   Replace `<user-name>` with the name of the user you want to attach the policy to and `<policy-arn>` with the ARN of the newly created policy.

4. Once the policy is attached, you can remove the inline policy from the user. You can use the following AWS CLI command to delete the inline policy:

   ```
   aws iam delete-user-policy --user-name <user-name> --policy-name <policy-name>
   ```

   Replace `<user-name>` with the name of the user you want to remove the inline policy from and `<policy-name>` with the name of the inline policy.

5. Repeat steps 2 to 4 for all the users with inline policies attached to them.

By following the above steps, you can remediate the misconfiguration "Users Should Not Have Inline Policies" in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration "Users Should Not Have Inline Policies" in AWS using Python, you can follow the below steps:

1. First, you need to identify the users who have inline policies attached to them. You can use the `boto3` library to get the list of all users and their attached policies.

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# Get all IAM users
users = iam.list_users()

# Loop through each user and get their attached policies
for user in users['Users']:
    policies = iam.list_user_policies(UserName=user['UserName'])
    if policies['PolicyNames']:
        print(f"User {user['UserName']} has inline policies attached to them.")
```

2. Once you have identified the users with inline policies, you can remove the policies using the `delete_user_policy` method.

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# Get all IAM users
users = iam.list_users()

# Loop through each user and get their attached policies
for user in users['Users']:
    policies = iam.list_user_policies(UserName=user['UserName'])
    if policies['PolicyNames']:
        print(f"User {user['UserName']} has inline policies attached to them.")
        for policy in policies['PolicyNames']:
            iam.delete_user_policy(UserName=user['UserName'], PolicyName=policy)
        print(f"All inline policies removed for user {user['UserName']}.")
```

3. After executing the above script, all the inline policies attached to the users will be removed. You can re-run the first script to confirm that no users have inline policies attached to them anymore.

Note: It is always recommended to use managed policies instead of inline policies for better security and easier management of permissions.

### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html) 


</Tab>
</Tabs>