
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Users".

3. In the "User Name" list, choose the name of the desired user, which will take you to the "Summary" page for that user.

4. In the "Security Credentials" section, you can see the access keys and their status. If the access keys are older than 90 days, it indicates that they have not been rotated and this is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation: `pip install awscli`
   
   Configuration: `aws configure`

2. List all IAM users: Use the following command to list all the IAM users in your AWS account:

   `aws iam list-users --query 'Users[*].UserName' --output text`

3. For each user, list all access keys: For each IAM user, you can list all their access keys using the following command:

   `aws iam list-access-keys --user-name <username>`

   Replace `<username>` with the actual username.

4. Check the age of each access key: For each access key, you can check its age using the following command:

   `aws iam get-access-key-last-used --access-key-id <accessKeyId>`

   Replace `<accessKeyId>` with the actual access key ID. The `CreateDate` field in the output indicates when the access key was last rotated. If it's more than 90 days old, it's a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3). You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3
from botocore.exceptions import ClientError

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create an IAM client and retrieve all the users:

```python
# Create an IAM client
iam = session.client('iam')

# Retrieve all users
try:
    users = iam.list_users()
except ClientError as e:
    print(f"Unexpected error: {e}")
```

4. For each user, retrieve the access keys and check the creation date. If the creation date is older than 90 days, print a warning message:

```python
from datetime import datetime, timedelta

# Check each user
for user in users['Users']:
    # Retrieve the access keys
    access_keys = iam.list_access_keys(UserName=user['UserName'])

    # Check each access key
    for key in access_keys['AccessKeyMetadata']:
        # Calculate the age of the key
        age = datetime.now(tz=key['CreateDate'].tzinfo) - key['CreateDate']

        # If the key is older than 90 days, print a warning
        if age > timedelta(days=90):
            print(f"WARNING: The access key {key['AccessKeyId']} for user {user['UserName']} is {age.days} days old and should be rotated.")
```

This script will help you detect if any IAM user's access keys are older than 90 days and should be rotated.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of root account access keys should be rotated in AWS using the AWS console, follow these steps:

1. Login to the AWS Management Console using root account credentials.
2. Go to the IAM dashboard by selecting "Services" from the top navigation bar and selecting "IAM" under the "Security, Identity & Compliance" category.
3. In the IAM dashboard, select "Users" from the left-hand menu and locate the root account user.
4. Click on the root account user to view the details.
5. In the "Security credentials" tab, locate the "Access keys" section and click on "Rotate access key."
6. A dialog box will appear asking you to confirm the rotation of the access keys. Click on "Rotate."
7. The console will generate a new access key pair. Download the new access key and secret key and store them securely.
8. After downloading the new access keys, delete the old access keys by clicking on the "X" next to the key.
9. Repeat this process periodically to ensure that the root account access keys are regularly rotated.

By following these steps, you can remediate the misconfiguration of root account access keys should be rotated in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of Root Account Access Keys Should Be Rotated in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the access keys associated with the root account:

   ```
   aws iam list-access-keys --user-name <root_account_user_name>
   ```

   Replace `<root_account_user_name>` with the name of your root account user.

3. Identify the access key that needs to be rotated.

4. Run the following command to create a new access key:

   ```
   aws iam create-access-key --user-name <root_account_user_name>
   ```

   This command will create a new access key and secret access key pair.

5. Run the following command to delete the old access key:

   ```
   aws iam delete-access-key --user-name <root_account_user_name> --access-key-id <old_access_key_id>
   ```

   Replace `<old_access_key_id>` with the access key ID of the old access key that needs to be rotated.

6. Update any scripts or applications that use the old access key with the new access key.

7. Verify that the new access key is working properly by running a test command.

   ```
   aws s3 ls
   ```

   This command should list all the S3 buckets in your account.

8. Repeat steps 3-7 for any other access keys associated with the root account.

9. Once all the access keys have been rotated, ensure that the root account password is also strong and has been rotated recently.

By following these steps, you can remediate the issue of Root Account Access Keys Should Be Rotated in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Root Account Access Keys Should Be Rotated in AWS using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) using pip.

```
pip install boto3
```

2. Create an AWS IAM client using Boto3.

```
import boto3

# Create an IAM client
iam = boto3.client('iam')
```

3. Get the list of access keys for the root account.

```
# Get the list of access keys for the root account
response = iam.list_access_keys(UserName='root')
access_key_list = response['AccessKeyMetadata']
```

4. Loop through the access keys and check the age of each key. If an access key is older than 90 days, create a new key and delete the old key.

```
# Loop through the access keys and check the age of each key
for access_key in access_key_list:
    access_key_id = access_key['AccessKeyId']
    create_date = access_key['CreateDate']
    age = (datetime.now(create_date.tzinfo) - create_date).days

    # If an access key is older than 90 days, create a new key and delete the old key
    if age > 90:
        new_access_key = iam.create_access_key(UserName='root')['AccessKey']
        iam.delete_access_key(UserName='root', AccessKeyId=access_key_id)
```

5. Save the Python script and run it periodically to ensure that the root account access keys are rotated every 90 days.

Note: It is recommended to use AWS Identity and Access Management (IAM) roles instead of root account access keys for accessing AWS services.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
