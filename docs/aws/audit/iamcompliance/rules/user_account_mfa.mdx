---
slug: user_account_mfa
title: MFA Should Be Enabled On User Accounts
sidebar_label: MFA Should Be Enabled On User Accounts
---

### More Info:

MFA must be enabled on user accounts. AWS recommends that you configure multi-factor authentication (MFA) to help protect your AWS resources.

### Risk Level

Critical

### Address

Security

### Compliance Standards

HIPAA, PCIDSS, GDPR, CISAWS, CBP, NIST, SOC2, ISO27001, AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.
   
2. In the navigation pane, choose "Users". This will display a list of all IAM users associated with the current AWS account.

3. Select a user from the list. This will open the summary page for the selected user.

4. In the "Security Credentials" tab, look for "Assigned MFA device". If the status is "No", then MFA is not enabled for that user. Repeat this process for all users to check if MFA is enabled.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account details. You can install AWS CLI using pip (Python package manager) by running the command `pip install awscli`. After installation, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all IAM users: You can list all the IAM users in your AWS account by running the following command: `aws iam list-users --query 'Users[*].UserName' --output text`. This command will return a list of all IAM user names.

3. Check MFA status for each user: For each user, you can check if MFA is enabled or not by running the following command: `aws iam list-mfa-devices --user-name <username>`. Replace `<username>` with the name of the user. This command will return a list of MFA devices associated with the user. If the list is empty, it means that MFA is not enabled for that user.

4. Repeat step 3 for all users: You need to repeat step 3 for all the users returned in step 2. If any user does not have MFA enabled, it is a misconfiguration.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways. The simplest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   It will prompt you for your access key, secret access key, AWS region. These details will be stored in `~/.aws/credentials`.

3. Write the Python script: Now you can write a Python script to check if MFA is enabled on IAM user accounts. Here is a simple script that does this:

   ```python
   import boto3

   # Create IAM client
   iam = boto3.client('iam')

   # List users
   users = iam.list_users()
   for user in users['Users']:
       user_name = user['UserName']
       # List MFA devices
       mfa_devices = iam.list_mfa_devices(UserName=user_name)
       if not mfa_devices['MFADevices']:
           print(f"MFA not enabled for user: {user_name}")
   ```

   This script first lists all the IAM users. Then for each user, it checks if any MFA devices are associated with the user. If not, it prints that MFA is not enabled for the user.

4. Run the Python script: Finally, you can run the Python script using the Python interpreter:

   ```bash
   python check_mfa.py
   ```

   This will print the usernames of all users who do not have MFA enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of MFA not being enabled on user accounts in AWS, you can follow the below steps:

Step 1: Log in to the AWS Management Console.

Step 2: Navigate to the IAM service.

Step 3: Click on the "Users" tab on the left-hand side of the page.

Step 4: Select the user account that needs MFA enabled.

Step 5: Click on the "Security credentials" tab.

Step 6: Under the "Multi-factor authentication (MFA)" section, click on "Manage".

Step 7: Choose "Virtual MFA device" or "U2F security key" and click on "Continue".

Step 8: Follow the on-screen instructions to complete the MFA setup process.

Step 9: Once the MFA is set up, click on "Activate MFA" to enable it for the user account.

Step 10: Repeat steps 4-9 for all user accounts that require MFA to be enabled.

By following these steps, you can remediate the misconfiguration of MFA not being enabled on user accounts in AWS.

#### Using CLI

To remediate the misconfiguration of MFA not being enabled on user accounts in AWS using AWS CLI, you can follow the below steps:

1. Firstly, you need to install and configure AWS CLI on your local machine.

2. Next, you need to list all the IAM users in your account using the following command:

```
aws iam list-users
```

3. For each user returned in the previous command, you need to check if MFA is enabled or not by running the following command:

```
aws iam list-mfa-devices --user-name <username>
```

4. If MFA is not enabled for a user, you can enable it by running the following command:

```
aws iam enable-mfa-device --user-name <username> --serial-number <serial-number> --authentication-code-1 <code1> --authentication-code-2 <code2>
```

Here, `<serial-number>` is the unique identifier of the MFA device, and `<code1>` and `<code2>` are the two consecutive authentication codes generated by the MFA device.

5. Once you have enabled MFA for all the IAM users in your account, you can verify the configuration by running the following command:

```
aws iam list-mfa-devices
```

This command will list all the MFA-enabled users in your account along with their MFA device information.

By following these steps, you can remediate the misconfiguration of MFA not being enabled on user accounts in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of MFA not being enabled on user accounts in AWS using Python, you can use the following steps:

1. Install the AWS SDK for Python (Boto3) using the following command:

```
pip install boto3
```

2. Create an AWS IAM client using the following code:

```python
import boto3

iam = boto3.client('iam')
```

3. List all the IAM users using the following code:

```python
response = iam.list_users()
users = response['Users']
```

4. Loop through each user and check if MFA is enabled. If it is not enabled, enable it using the following code:

```python
for user in users:
    username = user['UserName']
    response = iam.list_mfa_devices(UserName=username)
    mfa_devices = response['MFADevices']
    if not mfa_devices:
        iam.enable_mfa_device(UserName=username, SerialNumber='arn:aws:iam::<account-id>:mfa/'+username, AuthenticationCode1='<code1>', AuthenticationCode2='<code2>')
```

Replace `<account-id>` with your AWS account ID and `<code1>` and `<code2>` with the MFA codes generated by the user's device.

5. Save the Python file and run it using the following command:

```
python <filename>.py
```

This will remediate the misconfiguration of MFA not being enabled on user accounts in AWS.

### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html) 


</Tab>
</Tabs>