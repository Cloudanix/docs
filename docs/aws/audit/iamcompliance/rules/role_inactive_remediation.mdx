

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Roles". This will display a list of all the IAM roles that are currently configured within your AWS environment.

3. For each role, click on the role name to open its summary page. Here, you can see the "Last activity" section which shows when the role was last used to make an AWS request.

4. If the "Last activity" shows "None", it means the role has not been used to make an AWS request in the tracked time period. This could indicate that the role is inactive and may need to be reviewed or removed.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to execute IAM related commands.

2. Once the AWS CLI is set up, you can list all the IAM roles in your AWS account by running the following command:
   ```
   aws iam list-roles
   ```
   This command will return a JSON object containing all the IAM roles in your account.

3. To check the last activity of each role, you can use the following command:
   ```
   aws iam get-role --role-name {role-name}
   ```
   Replace `{role-name}` with the name of the role you want to check. This command will return a JSON object containing information about the specified role, including the `RoleLastUsed` field which indicates the last time the role was used.

4. You can then write a script to iterate over all the roles and check the `RoleLastUsed` field. If the role hasn't been used for a long time (for example, 90 days), it can be considered as inactive. Here is a simple Python script that does this:
   ```python
   import json
   import subprocess
   import datetime

   # Get the list of all roles
   roles = json.loads(subprocess.getoutput('aws iam list-roles'))

   for role in roles['Roles']:
       # Get the details of each role
       role_details = json.loads(subprocess.getoutput(f'aws iam get-role --role-name {role["RoleName"]}'))

       # Check the last used date
       last_used_date = role_details['Role']['RoleLastUsed'].get('LastUsedDate')
       if last_used_date:
           last_used_date = datetime.datetime.strptime(last_used_date, '%Y-%m-%d %H:%M:%S+00:00')
           # If the role hasn't been used for 90 days, print it
           if (datetime.datetime.now() - last_used_date).days > 90:
               print(f'The role {role["RoleName"]} is inactive.')
   ```
   This script uses the `subprocess` module to execute AWS CLI commands and the `json` module to parse the returned JSON objects. It also uses the `datetime` module to calculate the number of days since the last use of each role.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. For AWS, you will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. You can install it using pip:

```python
pip install boto3
```

2. Set up AWS credentials: Boto3 needs your AWS credentials to interact with AWS services. You can set them up in several ways, but the simplest is to use the AWS CLI:

```bash
aws configure
```

3. Write the Python script: The script will use the IAM client from boto3 to list all the roles and then check the last used timestamp for each role. If a role hasn't been used for a certain period of time, it will be considered inactive.

```python
import boto3
from datetime import datetime, timedelta

# Create IAM client
iam = boto3.client('iam')

# Get the current time
now = datetime.now()

# Define the period of inactivity (e.g., 90 days)
inactive_period = timedelta(days=90)

# List all roles
roles = iam.list_roles()['Roles']

# Check each role
for role in roles:
    # Get the role name
    role_name = role['RoleName']

    # Get the last used timestamp
    last_used = role.get('RoleLastUsed', {}).get('LastUsedDate')

    # If the role hasn't been used for the defined period, it's inactive
    if last_used is None or now - last_used > inactive_period:
        print(f"The role {role_name} is inactive.")
```

4. Run the script: Finally, you can run the script using Python:

```bash
python check_inactive_roles.py
```

This script will print the names of all inactive roles. You can modify it to suit your needs, for example, by sending an alert or report instead of just printing the names.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step by step instructions to remediate the "Inactive Roles Should Be Removed" misconfiguration in AWS:

1. Login to your AWS console.
2. Navigate to the "Identity and Access Management (IAM)" service.
3. Click on "Roles" from the left-hand menu.
4. Review the list of roles and identify any inactive roles.
5. Select the inactive role by clicking on the role name.
6. Click on the "Delete Role" button.
7. Confirm the deletion by clicking on "Yes, delete" button.

Note: Before deleting any role, make sure that the role is not being used by any resources or services in your AWS account. If a role is being used, then removing it can cause disruption to the resources or services.

#### Using CLI

To remediate the misconfiguration "Inactive Roles Should Be Removed" for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your computer.

2. Run the following command to list all the roles in your AWS account:

```
aws iam list-roles
```

3. Identify the inactive roles that have not been used for a long time. You can check the "LastUsedDate" attribute of each role to determine when it was last used.

4. Run the following command to delete the inactive roles:

```
aws iam delete-role --role-name <role-name>
```

Replace `<role-name>` with the name of the inactive role that you want to delete.

5. Repeat steps 3-4 for all the inactive roles that you want to remove.

Note: Before deleting any role, make sure that it is not being used by any resources or applications in your AWS account. Deleting a role that is still in use can cause issues with your applications and services.

#### Using Python

To remediate the misconfiguration of inactive roles in AWS, you can use the following steps using Python:

1. First, you need to list all the roles in your AWS account using the `boto3` library in Python. You can use the following code to achieve this:

```python
import boto3

# Create an IAM client
iam = boto3.client('iam')

# List roles
response = iam.list_roles()
roles = response['Roles']
```

2. Once you have the list of roles, you need to check if any of the roles are inactive. You can do this by checking the `CreateDate` attribute of the role. If the role was created more than a certain number of days ago (e.g. 90 days), you can consider it inactive. You can use the following code to achieve this:

```python
import datetime

# Define the number of days after which a role is considered inactive
inactive_days = 90

# Check if any roles are inactive
for role in roles:
    create_date = role['CreateDate'].replace(tzinfo=None)
    if (datetime.datetime.now() - create_date).days > inactive_days:
        print(f"Role {role['RoleName']} is inactive and should be removed.")
```

3. Finally, to remove the inactive roles, you can use the `delete_role` method of the `boto3` library. You can use the following code to achieve this:

```python
# Delete inactive roles
for role in roles:
    create_date = role['CreateDate'].replace(tzinfo=None)
    if (datetime.datetime.now() - create_date).days > inactive_days:
        iam.delete_role(RoleName=role['RoleName'])
        print(f"Role {role['RoleName']} has been deleted.")
```

Note: Before running the above code, make sure you have the necessary IAM permissions to delete roles.


</Tab>
</Tabs>