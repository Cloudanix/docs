---
slug: root_account_certificates_rotation
title: Root Account Certificates Should Be Rotated
sidebar_label: Root Account Certificates Should Be Rotated
---

### More Info:

Certificates tied with root accounts needs rotation.

### Risk Level

Critical

### Address

Security

### Compliance Standards

NIST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Users". This will display a list of all IAM users associated with the current AWS account.

3. Click on the user name of the root account. This will open the summary page for the selected user.

4. In the "Security Credentials" section, check the "Access Keys" list. If there are any access keys (Access Key ID and Secret Access Key) that are older than 90 days, it indicates that the root account certificates have not been rotated.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all IAM users: Once your AWS CLI is set up, you can list all IAM users in your AWS account by running the following command:

   ```
   aws iam list-users
   ```

   This will return a JSON object containing details of all IAM users.

3. Check the password last used date: For each user, you can check the date when their password was last used by running the following command:

   ```
   aws iam get-login-profile --user-name <username>
   ```

   Replace `<username>` with the name of the user. This will return a JSON object containing the user's login profile, including the date when their password was last used.

4. Check the certificate rotation: For each user, you can check the rotation status of their certificates by running the following command:

   ```
   aws iam list-signing-certificates --user-name <username>
   ```

   Replace `<username>` with the name of the user. This will return a JSON object containing the user's signing certificates, including the rotation status. If the rotation status is 'false', it means the certificate has not been rotated and is a potential misconfiguration.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

3. Now, you can use the IAM client to list all the server certificates:

```python
iam = session.client('iam')

certificates = iam.list_server_certificates()['ServerCertificateMetadataList']
```

4. Finally, you can iterate over the certificates and check the expiration date. If the certificate is close to its expiration date or has already expired, it should be rotated:

```python
from datetime import datetime, timedelta

for certificate in certificates:
    expiration_date = certificate['Expiration']
    if expiration_date < datetime.now() + timedelta(days=30):
        print(f"Certificate {certificate['ServerCertificateName']} should be rotated")
```

This script will print the names of all certificates that should be rotated. You can adjust the number of days in the timedelta function to fit your needs.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

1. **Sign in to the AWS Management Console**.
2. **Navigate to the IAM service**.
3. **Select Server Certificates from the navigation pane**.
4. **Identify the server certificates**:
   - Look for server certificates associated with the root user.
5. **Review Certificate Details**:
   - Click on the certificate.
   - Review the certificate details, including the upload date.
6. **Rotate Certificates**:
   - If a certificate has exceeded the minimum rotation threshold, rotate it using the appropriate method.
7. **Repeat for other certificates**:
   - Repeat the above steps for all certificates associated with the root user.

#### Using CLI

1. **List Server Certificates**:
```bash
aws iam list-server-certificates
```
2. **Identify Certificates for the Root User**:
   - Look for certificates associated with the root user based on the certificate path.
3. **Rotate Certificates**:
   - Rotate the certificates that have exceeded the minimum rotation threshold using the appropriate method.
4. **Repeat for other certificates**:
   - If there are multiple certificates associated with the root user, repeat the rotation process for each of them.

#### Using Python

Here's a Python script to identify and remediate server certificates that have exceeded the minimum rotation threshold for the root user:

```python
import boto3
from datetime import datetime, timedelta

class CertificateRotationChecker:
    def __init__(self):
        self.iam_client = boto3.client('iam')

    def get_certificates_for_root(self):
        root_certificates = []
        response = self.iam_client.list_server_certificates()
        for certificate in response['ServerCertificateMetadataList']:
            if certificate['Path'] == '/':
                root_certificates.append(certificate)
        return root_certificates

    def rotate_certificate(self, certificate_name):
        self.iam_client.update_server_certificate(
            ServerCertificateName=certificate_name,
            NewServerCertificateName=f"{certificate_name}-rotated"
        )
        print(f"Certificate {certificate_name} has been rotated.")

# Instantiate the class
checker = CertificateRotationChecker()

# Get certificates for root user
root_certificates = checker.get_certificates_for_root()

# Define minimum rotation days
minimum_rotation_days = 90  # Example value, adjust as necessary

# Rotate certificates that exceed the minimum rotation threshold
for certificate in root_certificates:
    upload_date = certificate['UploadDate']
    rotation_threshold = datetime.now() - timedelta(days=minimum_rotation_days)
    if upload_date < rotation_threshold:
        checker.rotate_certificate(certificate['ServerCertificateName'])
```

This Python script identifies server certificates associated with the root user and rotates them if they have exceeded the minimum rotation threshold.

Ensure to have appropriate IAM permissions for managing server certificates if you're using AWS CLI or Python script. Adjust the `minimum_rotation_days` variable according to your organization's policy.
### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html) 


</Tab>
</Tabs>