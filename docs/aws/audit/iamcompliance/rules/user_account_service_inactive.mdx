---
slug: user_account_service_inactive
title: User Account Service Inactivity
sidebar_label: User Account Service Inactivity
---

### More Info:

Checks inactivity of any user on a service. Those priviledges should be removed for better security posture.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAWS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Users". This will display a list of all the IAM users in your AWS account.

3. Choose a user name from the list. This will open the summary page for the selected user.

4. In the "User Activity" section, you can see the last activity date. If the last activity date is more than 90 days ago, the user account is considered inactive.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all IAM users: Once AWS CLI is set up, you can list all IAM users in your AWS account by running the following command:
   ```
   aws iam list-users
   ```
   This command will return a JSON object containing details of all IAM users.

3. Get IAM user's last activity date: For each user, you can get the last activity date by running the following command:
   ```
   aws iam get-user --user-name <username>
   ```
   Replace `<username>` with the name of the IAM user. This command will return a JSON object containing details of the specified IAM user, including the `PasswordLastUsed` field which indicates the date and time when the IAM user last used their password for AWS Management Console or AWS CLI operations.

4. Check for inactivity: You can then check if the `PasswordLastUsed` date is older than your inactivity threshold (for example, 90 days). If it is, then the IAM user is considered inactive. You can do this check manually or write a script to automate the process.

#### Using Python

Detecting User Account Service Inactivity in IAM using Python scripts involves using the Boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. Install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this in several ways, but the simplest is to use the AWS CLI:
   ```
   aws configure
   ```
   Enter your Access Key ID, Secret Access Key, and default region when prompted.

2. **Create a Python Script to List IAM Users:**
   Use the Boto3 IAM client to list all IAM users. Here's a simple script that does this:
   ```python
   import boto3

   # Create IAM client
   iam = boto3.client('iam')

   # List all users
   users = iam.list_users()
   for user in users['Users']:
       print("User: {0}\nUserID: {1}\nARN: {2}\nCreatedOn: {3}\n".format(
           user['UserName'],
           user['UserId'],
           user['Arn'],
           user['CreateDate']
       ))
   ```
3. **Create a Python Script to Check User Activity:**
   Use the Boto3 CloudTrail client to look for events related to each user. This can give you an idea of their activity. Here's a script that checks the last 90 days of activity for each user:
   ```python
   import boto3
   from datetime import datetime, timedelta

   # Create CloudTrail client
   cloudtrail = boto3.client('cloudtrail')

   # Get the current time and date
   now = datetime.now()

   # Get the date 90 days ago
   start_date = now - timedelta(days=90)

   # List all users
   users = iam.list_users()
   for user in users['Users']:
       # Look for events related to this user in the last 90 days
       response = cloudtrail.lookup_events(
           LookupAttributes=[
               {
                   'AttributeKey': 'Username',
                   'AttributeValue': user['UserName']
               },
           ],
           StartTime=start_date,
           EndTime=now,
       )

       # Print out whether the user has been active
       if response['Events']:
           print("User {0} has been active in the last 90 days.".format(user['UserName']))
       else:
           print("User {0} has not been active in the last 90 days.".format(user['UserName']))
   ```
4. **Run the Python Script:**
   Finally, run the Python script. It will print out a list of all IAM users and whether they have been active in the last 90 days. This can help you identify any inactive users.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the User Account Service Inactivity issue in AWS using the AWS console, you can follow these steps:

1. Log in to your AWS Management Console.
2. Go to the IAM service.
3. Click on the "Users" option in the left-hand menu.
4. Select the user account that has been inactive.
5. Click on the "Security credentials" tab.
6. Under "Console password", click on "Manage".
7. Follow the prompts to reset the user's password.
8. Click on the "Access keys" tab.
9. Delete any access keys that have not been used in the last 90 days.
10. Click on the "Permissions" tab.
11. Review the user's permissions and remove any that are no longer necessary.
12. Click on the "Groups" tab.
13. Review the groups the user is a member of and remove any that are no longer necessary.
14. Click on the "Policies" tab.
15. Review the policies attached to the user and remove any that are no longer necessary.
16. Click on "Apply" to save the changes.

These steps will remediate the User Account Service Inactivity issue in AWS by resetting the user's password, deleting unused access keys, reviewing and removing unnecessary permissions, groups, and policies.

#### Using CLI

The following steps can be taken to remediate the User Account Service Inactivity misconfiguration in AWS using AWS CLI:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Run the following command to list all the IAM users in your AWS account:

   ```
   aws iam list-users
   ```

3. Identify the inactive users from the list. Inactive users are those who have not logged in to their AWS account for a specified number of days.

4. To set a password policy, run the following command:

   ```
   aws iam update-account-password-policy --minimum-password-length 8 --require-symbols --require-numbers --require-uppercase-characters --require-lowercase-characters --allow-users-to-change-password --max-password-age 90 --password-reuse-prevention 5
   ```

   This command will set a password policy for your AWS account. You can modify the parameters as per your requirement.

5. To force an IAM user to reset their password on next login, run the following command:

   ```
   aws iam update-login-profile --user-name <user-name> --password-reset-required
   ```

   Replace `<user-name>` with the name of the inactive user. This command will force the user to reset their password on their next login.

6. Repeat steps 4 and 5 for all the inactive users in your AWS account.

7. Finally, run the following command to verify that the password policy has been updated successfully:

   ```
   aws iam get-account-password-policy
   ```

   This command will display the current password policy for your AWS account.

By following these steps, you can remediate the User Account Service Inactivity misconfiguration in AWS using AWS CLI.

#### Using Python

To remediate the User Account Service Inactivity misconfiguration in AWS using Python, you can follow these steps:

1. First, you need to identify the user accounts that have been inactive for a specified period. You can use the boto3 library in Python to interact with AWS services.

```
import boto3
from datetime import datetime, timedelta

# Set the time period for inactivity
inactivity_period = 90

# Create a boto3 client for AWS IAM
iam = boto3.client('iam')

# Get the list of all IAM users
users = iam.list_users()['Users']

# Iterate over each user and check their last activity date
for user in users:
    # Get the user's access keys
    access_keys = iam.list_access_keys(UserName=user['UserName'])['AccessKeyMetadata']
    
    # Check if any access keys are active
    for key in access_keys:
        if key['Status'] == 'Active':
            # Get the last time the access key was used
            last_used = iam.get_access_key_last_used(AccessKeyId=key['AccessKeyId'])['AccessKeyLastUsed']['LastUsedDate']
            
            # Check if the access key has been inactive for the specified period
            if last_used < datetime.now() - timedelta(days=inactivity_period):
                # The access key has been inactive for too long, disable it
                iam.update_access_key(AccessKeyId=key['AccessKeyId'], Status='Inactive')
```

2. The code above will disable the access keys for any user that has been inactive for the specified period. You can adjust the inactivity_period variable to suit your needs.

3. You can schedule this script to run periodically using a cron job or a similar scheduling tool. This will ensure that any inactive access keys are disabled automatically.

### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_finding-unused.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_finding-unused.html) 


</Tab>
</Tabs>