---
slug: groups_without_users
title: Groups Without Users Should Be Removed
sidebar_label: Groups Without Users Should Be Removed
---

### More Info:

Empty groups should be cleaned up and should not linger around.

### Risk Level

Informational

### Address

Security

### Compliance Standards

CBP

This rule identifies IAM roles that do not require multi-factor authentication (MFA) or external ID for assumed roles. Roles without MFA or external ID can pose security risks, as they may allow unauthorized access or increase the attack surface for potential breaches. Enforcing MFA and external ID requirements adds an additional layer of security to IAM roles and helps prevent unauthorized access.



### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the IAM dashboard.
2. In the IAM dashboard, click on "Groups" in the left navigation pane. This will display a list of all the IAM groups in your AWS account.
3. Click on each group to view its details. In the "Users" tab, you can see the list of users associated with that group.
4. If the "Users" tab is empty, it means that the group does not have any users associated with it and should be removed.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to execute IAM related commands.

2. Once the AWS CLI is set up, you can list all the IAM groups in your AWS account by running the following command:
   ```
   aws iam list-groups
   ```
   This command will return a JSON object that contains information about all the IAM groups in your AWS account.

3. To list all the users in a specific IAM group, you can use the following command:
   ```
   aws iam get-group --group-name GroupName
   ```
   Replace 'GroupName' with the name of the IAM group you want to check. This command will return a JSON object that contains information about the IAM group, including a list of its users.

4. If the 'Users' array in the returned JSON object is empty, it means that the IAM group has no users. You can use a Python script to automate this check for all IAM groups. Here is a simple example:
   ```python
   import json
   import subprocess

   # Get the list of all IAM groups
   groups = json.loads(subprocess.getoutput('aws iam list-groups'))

   for group in groups['Groups']:
       # Get the details of the group
       group_details = json.loads(subprocess.getoutput(f'aws iam get-group --group-name {group["GroupName"]}'))

       # Check if the group has no users
       if not group_details['Users']:
           print(f'The group {group["GroupName"]} has no users.')
   ```
   This script will print the names of all IAM groups that have no users.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) which allows Python developer to write software that makes use of services like Amazon S3, Amazon EC2, etc.

```python
pip install boto3
```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the files ~/.aws/credentials. At the very least, the credentials file should specify the access key and secret access key. To specify these for the default profile, you can use the following format:

```python
[default]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
```

3. Write a Python script to list all IAM groups and check if they have any users:

```python
import boto3

# Create IAM client
iam = boto3.client('iam')

# List groups
response = iam.list_groups()

# For each group
for group in response['Groups']:
    # Get the group name
    group_name = group['GroupName']

    # List users in the group
    users_response = iam.get_group(GroupName=group_name)

    # If the group has no users
    if not users_response['Users']:
        print(f'Group {group_name} has no users.')
```

4. Run the Python script: You can run the Python script using any Python environment. If the script prints out any group names, those groups have no users and should be removed. If the script doesn't print out anything, then all groups have at least one user.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the "Groups Without Users Should Be Removed" misconfiguration in AWS using AWS console, you can follow these steps:

1. Open the AWS Management Console and navigate to the Identity and Access Management (IAM) service.

2. In the left navigation pane, click on "Groups".

3. Identify any groups that do not have any users assigned to them.

4. Select the group(s) that do not have any users assigned to them.

5. Click on the "Group Actions" dropdown menu and select "Delete Group".

6. Confirm the group deletion by clicking "Yes, Delete" in the pop-up window.

7. Repeat steps 3-6 for any other groups without users.

By following these steps, you will have successfully remediated the "Groups Without Users Should Be Removed" misconfiguration in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI and run the following command to list all the groups in your AWS account:
   ```
   aws iam list-groups
   ```

2. Identify the groups that do not have any users associated with them.

3. Run the following command to delete the group:
   ```
   aws iam delete-group --group-name <group-name>
   ```
   Replace `<group-name>` with the name of the group that you want to delete.

4. Repeat steps 2 and 3 for all the groups that do not have any users associated with them.

5. Verify that all the groups without users have been deleted by running the following command:
   ```
   aws iam list-groups
   ```
   This should return a list of groups that have at least one user associated with them.

By following the above steps, you can remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using Python, follow these steps:

1. Install the AWS SDK for Python (boto3) using pip:

```
pip install boto3
```

2. Create an AWS IAM client using boto3:

```python
import boto3

iam = boto3.client('iam')
```

3. Use the `list_groups` method to get a list of all IAM groups:

```python
response = iam.list_groups()
groups = response['Groups']
```

4. Use a loop to iterate over the list of groups and check if each group has any users:

```python
for group in groups:
    group_name = group['GroupName']
    response = iam.get_group(GroupName=group_name)
    users = response['Users']
    if not users:
        iam.delete_group(GroupName=group_name)
```

5. Use the `delete_group` method to delete any groups that do not have any users.

6. Save the Python script and run it to remediate the misconfiguration.

Note: Before running the script, make sure you have the necessary permissions to delete IAM groups.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_manage_add-remove-users.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_manage_add-remove-users.html) 

