---
slug: groups_without_users
title: Groups Without Users Should Be Removed
sidebar_label: Groups Without Users Should Be Removed
---

### More Info:

Empty groups should be cleaned up and should not linger around.

### Risk Level

Informational

### Address

Security

### Compliance Standards

CBP

This rule identifies IAM roles that do not require multi-factor authentication (MFA) or external ID for assumed roles. Roles without MFA or external ID can pose security risks, as they may allow unauthorized access or increase the attack surface for potential breaches. Enforcing MFA and external ID requirements adds an additional layer of security to IAM roles and helps prevent unauthorized access.




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the IAM console at https://console.aws.amazon.com/iam/.

2. In the navigation pane, choose "Groups". This will display a list of all IAM groups in your AWS account.

3. Click on each group to view its details. In the "Users" tab, you can see the users that are part of the group. If the "Users" tab is empty, it means that the group does not have any users.

4. Repeat this process for all the groups in your AWS account. Make a note of all the groups that do not have any users. These are the groups that are potentially misconfigured and should be removed.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all IAM groups: Use the following AWS CLI command to list all the IAM groups in your AWS account:

   ```
   aws iam list-groups
   ```
   This command will return a JSON object that contains all the IAM groups.

3. List all users in a group: For each group listed in the previous step, use the following AWS CLI command to list all the users in that group:

   ```
   aws iam get-group --group-name <GroupName>
   ```
   Replace `<GroupName>` with the name of the IAM group. This command will return a JSON object that contains all the users in the specified group.

4. Check for groups without users: If the 'Users' array in the JSON object returned by the previous command is empty, then the group does not have any users. You can use a Python script to automate this process. Here is a simple example:

   ```python
   import json
   import subprocess

   # Get the list of all groups
   groups = json.loads(subprocess.check_output(['aws', 'iam', 'list-groups']))

   for group in groups['Groups']:
       # Get the list of users in the group
       users = json.loads(subprocess.check_output(['aws', 'iam', 'get-group', '--group-name', group['GroupName']]))

       # Check if the group has any users
       if not users['Users']:
           print(f"The group {group['GroupName']} does not have any users.")
   ```
   This script will print the names of all the IAM groups that do not have any users.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) to interact with AWS services. You can install it using pip:

   ```
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config. In the credentials file, add your access key and secret key and in the config file, add your region.

   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY

   [default]
   region=us-east-1
   ```

3. Write a Python script to list all IAM groups and check if they have users:

   ```python
   import boto3

   # Create IAM client
   iam = boto3.client('iam')

   # List all IAM groups
   groups = iam.list_groups()['Groups']

   # Iterate over each group
   for group in groups:
       # Get the group name
       group_name = group['GroupName']

       # List all users in the group
       users_in_group = iam.get_group(GroupName=group_name)['Users']

       # Check if the group has no users
       if not users_in_group:
           print(f'Group {group_name} has no users.')
   ```

4. Run the Python script: You can run the Python script using the Python command in your terminal:

   ```
   python check_iam_groups.py
   ```

This script will print out the names of all IAM groups that have no users. If no such groups exist, it will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Groups Without Users Should Be Removed" misconfiguration in AWS using AWS console, you can follow these steps:

1. Open the AWS Management Console and navigate to the Identity and Access Management (IAM) service.

2. In the left navigation pane, click on "Groups".

3. Identify any groups that do not have any users assigned to them.

4. Select the group(s) that do not have any users assigned to them.

5. Click on the "Group Actions" dropdown menu and select "Delete Group".

6. Confirm the group deletion by clicking "Yes, Delete" in the pop-up window.

7. Repeat steps 3-6 for any other groups without users.

By following these steps, you will have successfully remediated the "Groups Without Users Should Be Removed" misconfiguration in AWS using the AWS console.

#### Using CLI

To remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI and run the following command to list all the groups in your AWS account:
   ```
   aws iam list-groups
   ```

2. Identify the groups that do not have any users associated with them.

3. Run the following command to delete the group:
   ```
   aws iam delete-group --group-name <group-name>
   ```
   Replace `<group-name>` with the name of the group that you want to delete.

4. Repeat steps 2 and 3 for all the groups that do not have any users associated with them.

5. Verify that all the groups without users have been deleted by running the following command:
   ```
   aws iam list-groups
   ```
   This should return a list of groups that have at least one user associated with them.

By following the above steps, you can remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration "Groups Without Users Should Be Removed" in AWS using Python, follow these steps:

1. Install the AWS SDK for Python (boto3) using pip:

```
pip install boto3
```

2. Create an AWS IAM client using boto3:

```python
import boto3

iam = boto3.client('iam')
```

3. Use the `list_groups` method to get a list of all IAM groups:

```python
response = iam.list_groups()
groups = response['Groups']
```

4. Use a loop to iterate over the list of groups and check if each group has any users:

```python
for group in groups:
    group_name = group['GroupName']
    response = iam.get_group(GroupName=group_name)
    users = response['Users']
    if not users:
        iam.delete_group(GroupName=group_name)
```

5. Use the `delete_group` method to delete any groups that do not have any users.

6. Save the Python script and run it to remediate the misconfiguration.

Note: Before running the script, make sure you have the necessary permissions to delete IAM groups.


### Additional Reading:

- [https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_manage_add-remove-users.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_manage_add-remove-users.html) 


</Tab>
</Tabs>