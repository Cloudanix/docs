
### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent AWS CloudFormation stacks from being accidentally deleted by enabling termination protection using the AWS Management Console, follow these steps:

1. **Navigate to CloudFormation:**
   - Open the AWS Management Console.
   - In the Services menu, select "CloudFormation" under the "Management & Governance" section.

2. **Select the Stack:**
   - In the CloudFormation dashboard, you will see a list of your stacks.
   - Click on the stack for which you want to enable termination protection.

3. **Enable Termination Protection:**
   - In the stack details page, click on the "Stack actions" dropdown menu.
   - Select "Enable termination protection."

4. **Confirm the Action:**
   - A confirmation dialog will appear. Confirm that you want to enable termination protection by clicking the "Enable" button.

By following these steps, you ensure that the selected CloudFormation stack has termination protection enabled, preventing accidental deletions.
</Accordion>

<Accordion title='Using CLI'>
To prevent AWS CloudFormation stacks from being deleted accidentally by enabling termination protection using the AWS CLI, follow these steps:

1. **Create the CloudFormation Stack with Termination Protection Enabled:**
   When creating a new CloudFormation stack, you can enable termination protection by using the `--enable-termination-protection` flag.

   ```sh
   aws cloudformation create-stack --stack-name my-stack --template-body file://my-template.json --enable-termination-protection
   ```

2. **Enable Termination Protection on an Existing Stack:**
   If you have an existing stack and you want to enable termination protection, you can use the `update-termination-protection` command.

   ```sh
   aws cloudformation update-termination-protection --stack-name my-existing-stack --enable-termination-protection
   ```

3. **Verify Termination Protection Status:**
   To ensure that termination protection is enabled, you can describe the stack and check the `EnableTerminationProtection` field.

   ```sh
   aws cloudformation describe-stacks --stack-name my-stack --query "Stacks[0].EnableTerminationProtection"
   ```

4. **Automate Termination Protection for All Stacks:**
   You can write a script to iterate over all your stacks and enable termination protection for each one. Here is a simple example in bash:

   ```sh
   for stack in $(aws cloudformation list-stacks --query "StackSummaries[?StackStatus=='CREATE_COMPLETE'].StackName" --output text); do
       aws cloudformation update-termination-protection --stack-name $stack --enable-termination-protection
   done
   ```

By following these steps, you can ensure that termination protection is enabled for your AWS CloudFormation stacks, thereby preventing accidental deletions.
</Accordion>

<Accordion title='Using Python'>
To prevent AWS CloudFormation stacks from being created without termination protection enabled using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

3. **Create a Python Script to Enable Termination Protection**:
   Write a Python script that creates a CloudFormation stack with termination protection enabled.

4. **Run the Script**:
   Execute the script to create the stack with the desired configuration.

Here is a sample Python script to create a CloudFormation stack with termination protection enabled:

```python
import boto3

# Initialize a session using Amazon CloudFormation
cf_client = boto3.client('cloudformation')

# Define the stack name and template URL or body
stack_name = 'your-stack-name'
template_url = 'https://path-to-your-template/template.yaml'

# Create the stack with termination protection enabled
response = cf_client.create_stack(
    StackName=stack_name,
    TemplateURL=template_url,
    EnableTerminationProtection=True,
    Capabilities=[
        'CAPABILITY_IAM',  # Add other capabilities if needed
        'CAPABILITY_NAMED_IAM'
    ],
    Parameters=[
        {
            'ParameterKey': 'ParameterName',
            'ParameterValue': 'ParameterValue'
        },
        # Add other parameters if needed
    ],
)

print(f"Stack {stack_name} creation initiated with termination protection enabled.")
```

### Explanation:
1. **Install Boto3 Library**:
   - Ensure you have the Boto3 library installed to interact with AWS services.

2. **Set Up AWS Credentials**:
   - Configure your AWS credentials to allow the script to authenticate with AWS services.

3. **Create a Python Script to Enable Termination Protection**:
   - Use the `boto3.client('cloudformation')` to create a CloudFormation client.
   - Define the stack name and template URL or body.
   - Use the `create_stack` method with the `EnableTerminationProtection` parameter set to `True`.

4. **Run the Script**:
   - Execute the script to create the CloudFormation stack with termination protection enabled.

By following these steps, you can ensure that any CloudFormation stack created using this script will have termination protection enabled, preventing accidental deletions.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the CloudFormation service. You can do this by typing "CloudFormation" into the search bar and selecting it from the dropdown menu.
3. In the CloudFormation console, you will see a list of your stacks. Select the stack you want to check.
4. In the stack details pane, look for the "Termination Protection" field. If it is set to "Enabled", then termination protection is on. If it is set to "Disabled", then termination protection is off.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudFormation stacks: Use the following AWS CLI command to list all the CloudFormation stacks in your AWS account:

   ```
   aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE ROLLBACK_COMPLETE UPDATE_COMPLETE UPDATE_ROLLBACK_COMPLETE
   ```
   This command will return a list of all CloudFormation stacks that are in a completed state.

3. Describe each stack: For each stack returned by the previous command, use the following AWS CLI command to get detailed information about the stack:

   ```
   aws cloudformation describe-stacks --stack-name <StackName>
   ```
   Replace `<StackName>` with the name of the stack. This command will return a JSON object that contains detailed information about the stack.

4. Check termination protection status: In the JSON object returned by the previous command, look for the `EnableTerminationProtection` field. If the value of this field is `false`, then termination protection is not enabled for the stack. If the value is `true`, then termination protection is enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) on your local system. This will allow you to interact with AWS services using Python.

```python
pip install boto3
aws configure
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a CloudFormation client using the session.

```python
cf = session.client('cloudformation')
```

4. Use the `describe_stacks()` method to retrieve all the stacks and check if termination protection is enabled. If termination protection is not enabled, print the stack name.

```python
response = cf.describe_stacks()
for stack in response['Stacks']:
    if not stack['EnableTerminationProtection']:
        print(f"Stack {stack['StackName']} does not have termination protection enabled.")
```

This script will print the names of all stacks that do not have termination protection enabled.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the issue of "AWS CloudFormation Stacks Should Have Termination Protection Enabled" for AWS using the AWS console:

1. Log in to your AWS Management Console.
2. Navigate to the AWS CloudFormation console.
3. In the left navigation pane, select "Stacks".
4. Select the stack for which you want to enable termination protection.
5. Click on the "Actions" button and select "Enable termination protection".
6. A pop-up window will appear, asking you to confirm the action. Click on "Yes, Enable" to confirm.
7. Once you have enabled termination protection, you will see a lock icon next to the stack name indicating that it is now protected from accidental deletion.

That's it! You have successfully remediated the issue of "AWS CloudFormation Stacks Should Have Termination Protection Enabled" for the selected stack.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "AWS CloudFormation Stacks Should Have Termination Protection Enabled" in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Check the status of termination protection for all the CloudFormation stacks in the AWS account by running the following command:

```
aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE UPDATE_COMPLETE UPDATE_ROLLBACK_COMPLETE --query "StackSummaries[?EnableTerminationProtection=='False'].StackName" --output text
```

This command will list all the CloudFormation stacks in the AWS account that have termination protection disabled.

3. Enable termination protection for each of the CloudFormation stacks listed in step 2 by running the following command:

```
aws cloudformation update-termination-protection --stack-name <stack-name> --enable-termination-protection
```

Replace `<stack-name>` with the name of the CloudFormation stack for which you want to enable termination protection.

4. Repeat step 3 for each of the CloudFormation stacks listed in step 2.

5. Verify the termination protection status for all the CloudFormation stacks in the AWS account by running the following command:

```
aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE UPDATE_COMPLETE UPDATE_ROLLBACK_COMPLETE --query "StackSummaries[?EnableTerminationProtection=='True'].StackName" --output text
```

This command will list all the CloudFormation stacks in the AWS account that have termination protection enabled.

By following these steps, you can remediate the misconfiguration "AWS CloudFormation Stacks Should Have Termination Protection Enabled" in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of AWS CloudFormation stacks not having termination protection enabled, you can use the following steps in Python:

1. Import the necessary AWS SDKs and modules:

```python
import boto3
from botocore.exceptions import ClientError
```

2. Create a boto3 session and CloudFormation client:

```python
session = boto3.Session(region_name='your_aws_region')
cfn = session.client('cloudformation')
```

3. Get a list of all CloudFormation stacks:

```python
stacks = cfn.list_stacks(
    StackStatusFilter=[
        'CREATE_COMPLETE',
        'UPDATE_COMPLETE',
        'ROLLBACK_COMPLETE'
    ]
)['StackSummaries']
```

4. Loop through the list of stacks and check if termination protection is enabled:

```python
for stack in stacks:
    stack_name = stack['StackName']
    try:
        response = cfn.describe_termination_protection(
            StackName=stack_name
        )
        if not response['TerminationProtected']:
            print(f"{stack_name} does not have termination protection enabled.")
            # Enable termination protection
            cfn.update_termination_protection(
                StackName=stack_name,
                EnableTerminationProtection=True
            )
            print(f"{stack_name} now has termination protection enabled.")
    except ClientError as e:
        if e.response['Error']['Message'] == 'Stack with id {0} does not exist'.format(stack_name):
            print(f"{stack_name} does not exist.")
        else:
            print(f"Error checking termination protection for {stack_name}: {e}")
```

5. Run the script and verify that termination protection is now enabled for all CloudFormation stacks.

Note: Make sure to replace "your_aws_region" with the region where your AWS resources are located.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
