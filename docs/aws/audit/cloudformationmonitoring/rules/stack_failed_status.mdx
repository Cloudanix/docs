---
slug: stack_failed_status
title: CloudFormation Stacks Should Not Have A Failed Status
sidebar_label: CloudFormation Stacks Should Not Have A Failed Status
---

### More Info:

None of your Amazon CloudFormation stacks should be in Failed mode for more than 6 hours. Any failed CloudFormation stacks that are not fixed on time can lead to application downtime, security issues or unexpected costs on your AWS bill.

### Risk Level

Informational

### Address

Operational Maturity

### Compliance Standards

CBP



### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CloudFormation service.
2. In the CloudFormation dashboard, under the "Stacks" section, you will see a list of all your CloudFormation stacks.
3. Check the "Status" column for each stack. If a stack has a status of "ROLLBACK_FAILED", "UPDATE_ROLLBACK_FAILED", "DELETE_FAILED", or any other status indicating a failure, it means that the stack has a misconfiguration.
4. For more details about the failure, select the stack with the failed status. In the stack details pane, click on the "Events" tab. This will show you a log of all events related to the stack, including any errors that led to the failed status.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install and configure AWS CLI on your local system. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all CloudFormation stacks: Use the following AWS CLI command to list all the CloudFormation stacks in your AWS account:

   ```
   aws cloudformation list-stacks --query 'StackSummaries[?StackStatus==`FAILED`].StackName' --output text
   ```
   This command will return the names of all CloudFormation stacks that have a "FAILED" status.

3. Check the status of a specific CloudFormation stack: If you want to check the status of a specific CloudFormation stack, you can use the following AWS CLI command:

   ```
   aws cloudformation describe-stacks --stack-name <your-stack-name> --query 'Stacks[0].StackStatus' --output text
   ```
   Replace `<your-stack-name>` with the name of your CloudFormation stack. This command will return the status of the specified CloudFormation stack.

4. Analyze the output: If the output of the above commands includes any CloudFormation stacks with a "FAILED" status, it means that those stacks have a misconfiguration. You should investigate further to determine the cause of the failure.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the AWS SDK for Python (Boto3). You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Before you can begin using Boto3, you need to set up authentication credentials for your AWS account using the AWS CLI. Credentials for your AWS account can be found in the IAM Console. You can create or use an existing user. 

   ```bash
   aws configure
   AWS Access Key ID [None]: YOUR_ACCESS_KEY
   AWS Secret Access Key [None]: YOUR_SECRET_KEY
   Default region name [None]: YOUR_REGION_NAME
   Default output format [None]: json
   ```

3. Write a Python script to list all CloudFormation stacks and check their status:

   ```python
   import boto3

   # Create a client for the AWS service
   client = boto3.client('cloudformation')

   # Call the AWS service to get a list of stacks
   response = client.describe_stacks()

   # Iterate over the stacks and check their status
   for stack in response['Stacks']:
       if stack['StackStatus'] == 'ROLLBACK_FAILED' or stack['StackStatus'] == 'CREATE_FAILED' or stack['StackStatus'] == 'DELETE_FAILED' or stack['StackStatus'] == 'UPDATE_ROLLBACK_FAILED':
           print(f"Stack {stack['StackName']} has a failed status: {stack['StackStatus']}")
   ```

4. Run the Python script: Save the script to a file, for example `check_stack_status.py`, and then run it using Python:

   ```bash
   python check_stack_status.py
   ```

This script will print out the names of all CloudFormation stacks that have a failed status. If no such stacks are found, it will not print anything.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate a CloudFormation stack with a failed status in AWS using the AWS console, follow these steps:

1. Open the AWS Management Console and navigate to the CloudFormation service.
2. Select the CloudFormation stack with a failed status that you want to remediate.
3. Click on the "Events" tab to view the events associated with the stack.
4. Review the events to identify the root cause of the failure. The event details will provide information on the resource that failed and the reason for the failure.
5. Once you have identified the root cause of the failure, take the appropriate action to remediate the issue. This may involve updating the CloudFormation template, modifying the resource configuration, or resolving any dependencies or permissions issues.
6. After making the necessary changes, update the CloudFormation stack by clicking on the "Update Stack" button.
7. Follow the prompts to upload the updated template and apply the changes to the stack.
8. Monitor the stack events to ensure that the update is successful and the stack status changes to "CREATE_COMPLETE" or "UPDATE_COMPLETE".

By following these steps, you can remediate a CloudFormation stack with a failed status in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the CloudFormation Stack failed status in AWS using AWS CLI, follow these steps:

1. Identify the CloudFormation Stack that has a failed status by running the following command in the AWS CLI:

```
aws cloudformation describe-stacks --stack-name <stack-name>
```

Replace `<stack-name>` with the name of the CloudFormation Stack that has a failed status.

2. Check the events associated with the failed stack by running the following command:

```
aws cloudformation describe-stack-events --stack-name <stack-name>
```

This will provide information on the events that led to the failed status of the stack.

3. Fix any issues that caused the stack to fail. This may involve updating the CloudFormation template or fixing any resource dependencies.

4. Once the issues are fixed, update the stack by running the following command:

```
aws cloudformation update-stack --stack-name <stack-name> --template-body file://<path-to-template-file> --parameters file://<path-to-parameters-file>
```

Replace `<stack-name>` with the name of the CloudFormation Stack that has a failed status, `<path-to-template-file>` with the path to the updated CloudFormation template file, and `<path-to-parameters-file>` with the path to the updated parameters file.

5. Wait for the stack to update and check its status by running the following command:

```
aws cloudformation describe-stacks --stack-name <stack-name>
```

If the stack status is CREATE_COMPLETE or UPDATE_COMPLETE, then the remediation is successful. If not, repeat steps 2 to 4 until the stack status is successful.
</Accordion>

<Accordion title='Using Python'>
To remediate the "CloudFormation Stacks Should Not Have A Failed Status" misconfiguration in AWS using Python, you can follow the below steps:

1. First, you need to identify the CloudFormation stack(s) that have a failed status. You can use the `boto3` library in Python to get the list of CloudFormation stacks and their status.

```python
import boto3

# Create a CloudFormation client
cf_client = boto3.client('cloudformation')

# Get the list of stacks
stacks = cf_client.list_stacks(StackStatusFilter=['CREATE_FAILED', 'ROLLBACK_COMPLETE'])

# Print the stack names and their status
for stack in stacks['StackSummaries']:
    print(stack['StackName'], stack['StackStatus'])
```

2. Once you have identified the failed stacks, you can delete them using the `delete_stack` method of the CloudFormation client.

```python
# Delete the failed stacks
for stack in stacks['StackSummaries']:
    cf_client.delete_stack(StackName=stack['StackName'])
```

3. You can also update the CloudFormation template and re-create the stack(s) to remediate the misconfiguration.

```python
# Update the CloudFormation template
with open('template.yaml', 'r') as file:
    template_body = file.read()

# Update the stack(s)
for stack in stacks['StackSummaries']:
    cf_client.update_stack(StackName=stack['StackName'], TemplateBody=template_body)
```

Note: Make sure to test the CloudFormation template before updating the stack(s) to avoid any further misconfigurations.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html) 

