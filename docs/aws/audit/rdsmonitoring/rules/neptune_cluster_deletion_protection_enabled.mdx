---
slug: neptune_cluster_deletion_protection_enabled
title: Neptune DB Cluster Should Have Deletion Protection Enabled
sidebar_label: Neptune DB Cluster Should Have Deletion Protection Enabled
---
### More Info:

Checks if an Amazon Neptune DB cluster has deletion protection enabled. The rule is NON_COMPLIANT if an Amazon Neptune cluster has the deletionProtection field set to false.

### Risk Level

High

### Address

Configuration

### Compliance Standards

NIST,CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration where a Neptune DB Cluster should have deletion protection enabled in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to Neptune Dashboard:**
   - Open the AWS Management Console.
   - In the search bar, type "Neptune" and select "Amazon Neptune" from the dropdown.

2. **Select the DB Cluster:**
   - In the Neptune dashboard, click on "Clusters" in the left-hand navigation pane.
   - Select the DB cluster you want to configure by clicking on its identifier.

3. **Modify the Cluster:**
   - With the DB cluster selected, click on the "Actions" dropdown menu.
   - Choose "Modify cluster" from the list of actions.

4. **Enable Deletion Protection:**
   - In the "Modify DB Cluster" page, scroll down to the "Deletion protection" section.
   - Check the box next to "Enable deletion protection."
   - Scroll to the bottom of the page and click "Continue," then review the changes and click "Modify cluster" to apply the settings.

By following these steps, you ensure that deletion protection is enabled for your Neptune DB Cluster, preventing accidental deletion.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where a Neptune DB Cluster should have deletion protection enabled using AWS CLI, follow these steps:

1. **Describe the DB Cluster**:
   First, identify the DB cluster that you want to enable deletion protection for. Use the following command to describe your Neptune DB clusters and get the necessary details like the DBClusterIdentifier.

   ```sh
   aws neptune describe-db-clusters
   ```

2. **Enable Deletion Protection**:
   Use the `modify-db-cluster` command to enable deletion protection on the specified DB cluster. Replace `<db-cluster-identifier>` with your actual DB cluster identifier.

   ```sh
   aws neptune modify-db-cluster --db-cluster-identifier <db-cluster-identifier> --deletion-protection
   ```

3. **Verify the Configuration**:
   After enabling deletion protection, verify that the setting has been applied correctly by describing the DB cluster again.

   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier <db-cluster-identifier>
   ```

4. **Automate with a Script (Optional)**:
   If you want to automate this process, you can create a simple shell script to enable deletion protection for multiple DB clusters. Here is an example script:

   ```sh
   #!/bin/bash

   # List of DB cluster identifiers
   DB_CLUSTERS=("cluster-1" "cluster-2" "cluster-3")

   for CLUSTER in "${DB_CLUSTERS[@]}"; do
       echo "Enabling deletion protection for $CLUSTER"
       aws neptune modify-db-cluster --db-cluster-identifier $CLUSTER --deletion-protection
   done

   echo "Deletion protection enabled for all specified DB clusters."
   ```

By following these steps, you can ensure that deletion protection is enabled for your Neptune DB clusters using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of a Neptune DB Cluster not having Deletion Protection enabled in AWS RDS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Below are the steps to ensure that Deletion Protection is enabled for your Neptune DB Cluster:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for Neptune.
   ```python
   import boto3

   # Initialize a session using Amazon Neptune
   client = boto3.client('neptune')
   ```

3. **Enable Deletion Protection**:
   Use the `modify_db_cluster` method to enable Deletion Protection for your Neptune DB Cluster. Replace `'your-cluster-identifier'` with your actual DB Cluster identifier.
   ```python
   def enable_deletion_protection(cluster_identifier):
       try:
           response = client.modify_db_cluster(
               DBClusterIdentifier=cluster_identifier,
               DeletionProtection=True
           )
           print(f"Deletion Protection enabled for DB Cluster: {cluster_identifier}")
       except Exception as e:
           print(f"Error enabling Deletion Protection: {e}")

   # Example usage
   enable_deletion_protection('your-cluster-identifier')
   ```

4. **Verify Deletion Protection**:
   Optionally, you can verify if Deletion Protection is enabled by describing the DB Cluster.
   ```python
   def verify_deletion_protection(cluster_identifier):
       try:
           response = client.describe_db_clusters(
               DBClusterIdentifier=cluster_identifier
           )
           cluster_info = response['DBClusters'][0]
           if cluster_info['DeletionProtection']:
               print(f"Deletion Protection is enabled for DB Cluster: {cluster_identifier}")
           else:
               print(f"Deletion Protection is NOT enabled for DB Cluster: {cluster_identifier}")
       except Exception as e:
           print(f"Error verifying Deletion Protection: {e}")

   # Example usage
   verify_deletion_protection('your-cluster-identifier')
   ```

By following these steps, you can ensure that Deletion Protection is enabled for your Neptune DB Cluster, thereby preventing accidental deletion.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu, then selecting "RDS" under the "Database" category.
3. In the navigation pane on the left, click on "Databases".
4. In the list of DB instances, click on the name of the Neptune DB cluster that you want to check.
5. In the "Details" section, look for the "Deletion protection" field. If it's set to "Disabled", then the Neptune DB cluster does not have deletion protection enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Neptune DB Clusters: Use the `describe-db-clusters` command to list all the Neptune DB clusters in your AWS account. The command is as follows:
   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text
   ```
   This command will return a list of all Neptune DB cluster identifiers.

3. Check Deletion Protection: For each Neptune DB cluster, use the `describe-db-clusters` command again to check if deletion protection is enabled. Replace `your-db-cluster-identifier` with the actual identifier of your DB cluster.
   ```
   aws rds describe-db-clusters --db-cluster-identifier your-db-cluster-identifier --query 'DBClusters[*].[DeletionProtection]' --output text
   ```
   This command will return `true` if deletion protection is enabled, and `false` if it is not.

4. Analyze the output: If the command returns `false` for any of the DB clusters, it means that those clusters do not have deletion protection enabled. This is a misconfiguration that should be corrected to prevent accidental deletion of the clusters.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your environment. This will allow you to interact with AWS services including RDS.

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a client for 'rds' and use the `describe_db_clusters` method to get a list of all DB clusters.

```python
rds = session.client('rds')

response = rds.describe_db_clusters()
```

4. Iterate over the DB clusters and check the `DeletionProtection` attribute. If it's set to `False`, then the Neptune DB cluster does not have deletion protection enabled.

```python
for db_cluster in response['DBClusters']:
    if not db_cluster['DeletionProtection']:
        print(f"DB Cluster {db_cluster['DBClusterIdentifier']} does not have deletion protection enabled.")
```

This script will print out the identifiers of all Neptune DB clusters that do not have deletion protection enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Neptune DB Cluster not having deletion protection enabled in AWS RDS, you can follow these step-by-step instructions using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login with your credentials.

2. **Navigate to Amazon Neptune Service**: Click on the "Services" dropdown in the top-left corner of the console, then select "Neptune" under the Database category.

3. **Select the DB Cluster**: From the list of Neptune DB Clusters, select the DB Cluster for which you want to enable deletion protection.

4. **Modify DB Cluster**: In the DB Cluster details page, click on the "Actions" dropdown button and select "Modify".

5. **Enable Deletion Protection**: Scroll down to the "Additional configuration" section in the Modify DB Cluster page. Locate the "Deletion protection" option and check the box to enable deletion protection for the DB Cluster.

6. **Review and Apply Changes**: Review the other configuration settings to ensure they are correct. Once you have verified the changes, click on the "Modify cluster" button to apply the changes.

7. **Monitor the Modification**: The modification process may take a few minutes to complete. You can monitor the progress on the DB Cluster details page.

By following these steps, you have successfully enabled deletion protection for the Neptune DB Cluster in AWS RDS, ensuring that accidental deletion of the DB Cluster is prevented.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Neptune DB Cluster not having deletion protection enabled in AWS RDS using AWS CLI, follow these steps:

1. **Install and Configure AWS CLI:**
   - If you haven't already, install the AWS CLI by following the instructions in the AWS documentation (https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html).
   - Configure the AWS CLI with your AWS credentials by running `aws configure` and providing your Access Key ID, Secret Access Key, region, and output format.

2. **Enable Deletion Protection for Neptune DB Cluster:**
   - Run the following AWS CLI command to enable deletion protection for your Neptune DB Cluster:
     ```
     aws neptune modify-db-cluster --db-cluster-identifier <your-db-cluster-identifier> --deletion-protection
     ```
     Replace `<your-db-cluster-identifier>` with the actual identifier of your Neptune DB Cluster.

3. **Verify Deletion Protection Status:**
   - To verify that deletion protection has been successfully enabled for your Neptune DB Cluster, you can describe the cluster using the following command:
     ```
     aws neptune describe-db-clusters --db-cluster-identifier <your-db-cluster-identifier> --query 'DBClusters[*].[DBClusterIdentifier,DeletionProtection]'
     ```
     This command will return the identifier of the DB Cluster and its deletion protection status.

4. **Ensure Deletion Protection Persists:**
   - It is recommended to periodically check the deletion protection status of your Neptune DB Cluster to ensure that it persists over time. You can use the same describe command mentioned in step 3 for this purpose.

By following these steps, you can successfully remediate the misconfiguration of Neptune DB Cluster not having deletion protection enabled in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Neptune DB Cluster not having deletion protection enabled in AWS RDS using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the AWS RDS client:
```python
client = boto3.client('rds')
```

3. Get a list of all Neptune DB Clusters:
```python
response = client.describe_db_clusters()
```

4. Iterate through each DB Cluster and enable deletion protection if it is not already enabled:
```python
for cluster in response['DBClusters']:
    cluster_identifier = cluster['DBClusterIdentifier']
    deletion_protection = cluster['DeletionProtection']

    if not deletion_protection:
        client.modify_db_cluster(
            DBClusterIdentifier=cluster_identifier,
            DeletionProtection=True
        )
        print(f"Deletion protection enabled for DB Cluster: {cluster_identifier}")
    else:
        print(f"Deletion protection is already enabled for DB Cluster: {cluster_identifier}")
```

5. Run the Python script to enable deletion protection for all Neptune DB Clusters in your AWS RDS.

Please ensure that you have the necessary IAM permissions to modify RDS DB Clusters and that your AWS credentials are properly configured for the boto3 library to work.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

