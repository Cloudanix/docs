---
slug: rds_reserved_instance_recent_purchases
title: RDS Reserved Instances Purchases Should Be Reviewed Every 7 Days
sidebar_label: RDS Reserved Instances Purchases Should Be Reviewed Every 7 Days
---

### More Info:

All Amazon RDS Reserved Instance (RI) purchases are reviewed every 7 days in order to confirm that no unwanted reservation purchase has been placed recently.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP



### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the RDS dashboard.
2. In the navigation pane, choose "Reserved Instances". This will display a list of all your reserved instances.
3. Check the "Purchase Date" column for each reserved instance. If the purchase date is more than 7 days ago, it means that the reserved instance purchase has not been reviewed in the last 7 days.
4. Additionally, you can check the "State" column to see if the reserved instance is active, retired, or expired. If the state is not active, it may indicate a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the RDS resources.

2. Once the AWS CLI is installed and configured, you can use the `describe-reserved-db-instances` command to list all the RDS Reserved Instances. The command is as follows:

   ```
   aws rds describe-reserved-db-instances
   ```

   This command will return a JSON output with all the details of the RDS Reserved Instances.

3. To review the RDS Reserved Instances purchases, you need to check the `PurchaseTime` attribute in the output. This attribute indicates the time when the Reserved Instance was purchased.

4. You can use a script to automate this process. The script can parse the JSON output, extract the `PurchaseTime` attribute, and compare it with the current date. If the difference is more than 7 days, the script can raise an alert. Here is a simple Python script that does this:

   ```python
   import json
   import subprocess
   from datetime import datetime, timedelta

   # Run the AWS CLI command
   result = subprocess.run(['aws', 'rds', 'describe-reserved-db-instances'], stdout=subprocess.PIPE)

   # Parse the JSON output
   data = json.loads(result.stdout)

   # Get the current date
   now = datetime.now()

   # Check each Reserved Instance
   for ri in data['ReservedDBInstances']:
       # Parse the purchase time
       purchase_time = datetime.strptime(ri['PurchaseTime'], '%Y-%m-%dT%H:%M:%S.%fZ')

       # Check if it's more than 7 days old
       if now - purchase_time > timedelta(days=7):
           print(f"Reserved Instance {ri['ReservedDBInstanceId']} should be reviewed")
   ```

   This script will print the IDs of the Reserved Instances that should be reviewed.
</Accordion>

<Accordion title='Using Python'>
1. **Setup AWS SDK (Boto3) in Python Environment:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   After installing boto3, you need to configure your AWS credentials. You can do this by creating the credentials file yourself. By default, its location is at `~/.aws/credentials`. At a minimum, the credentials file should look like this:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

2. **Create a Python Script to Fetch RDS Reserved Instances:**
   You can use the `describe_reserved_db_instances` method provided by the RDS client in boto3 to fetch all the reserved instances. Here is a sample script:
   ```python
   import boto3

   def get_rds_reserved_instances():
       client = boto3.client('rds')
       response = client.describe_reserved_db_instances()
       return response['ReservedDBInstances']

   reserved_instances = get_rds_reserved_instances()
   for instance in reserved_instances:
       print(instance)
   ```
   This script will print all the details of the reserved instances in your AWS account.

3. **Check the Purchase Time of Each Reserved Instance:**
   Each reserved instance has a `StartTime` attribute which tells when the instance was purchased. You can compare this time with the current time to check if the instance was purchased more than 7 days ago. Here is how you can do it:
   ```python
   import boto3
   from datetime import datetime, timedelta

   def get_rds_reserved_instances():
       client = boto3.client('rds')
       response = client.describe_reserved_db_instances()
       return response['ReservedDBInstances']

   reserved_instances = get_rds_reserved_instances()
   for instance in reserved_instances:
       purchase_time = instance['StartTime']
       if datetime.now(purchase_time.tzinfo) - purchase_time > timedelta(days=7):
           print(f"Reserved instance {instance['ReservedDBInstanceId']} should be reviewed.")
   ```
   This script will print the IDs of all the reserved instances that were purchased more than 7 days ago.

4. **Schedule the Script:**
   You can schedule this script to run every 7 days using a cron job or any other task scheduler in your system. This way, you will be notified about the instances that need to be reviewed every 7 days.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not reviewing RDS Reserved Instances purchases every 7 days in AWS using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the RDS Service**: Click on the "Services" dropdown menu at the top of the page, then select "RDS" under the Database category.

3. **Review Reserved Instances**: In the RDS dashboard, locate the "Reserved Instances" option in the left-hand menu and click on it.

4. **Check Purchase History**: Review the list of your Reserved Instances to ensure they have been purchased and are being utilized effectively. Look for any instances that may not be optimized or are not in use.

5. **Set Up a Reminder**: To ensure that you review your Reserved Instances every 7 days, you can set up a reminder in the AWS Management Console. You can use AWS CloudWatch Events to create a rule that triggers a reminder notification every 7 days.

6. **Create a CloudWatch Event Rule**:
   - Go to the AWS CloudWatch service in the AWS Management Console.
   - Click on "Rules" in the left-hand menu and then click on "Create rule".
   - Under "Event Source", select "Schedule".
   - Set the schedule to run every 7 days or as per your requirement.
   - Under "Targets", choose the target for your reminder notification (e.g., SNS topic, Lambda function).
   - Click on "Configure details", give your rule a name and description, and then click on "Create rule".

7. **Monitor and Review**: Ensure that you receive the reminder notifications every 7 days to review your RDS Reserved Instances purchases. Make any necessary adjustments to optimize your Reserved Instances based on your usage and requirements.

By following these steps, you can remediate the misconfiguration of not reviewing RDS Reserved Instances purchases every 7 days in AWS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not reviewing RDS Reserved Instances purchases every 7 days in AWS using AWS CLI, follow these steps:

1. **List all the Reserved Instances in AWS RDS**:
   
   Run the following AWS CLI command to list all the Reserved Instances in your AWS account:

   ```bash
   aws rds describe-reserved-db-instances
   ```

2. **Identify the Purchase Date of each Reserved Instance**:

   From the output of the previous command, note down the `OfferingType` and `StartTime` values for each Reserved Instance. The `StartTime` field indicates when the Reserved Instance was purchased.

3. **Calculate the Age of Each Reserved Instance**:

   Calculate the age of each Reserved Instance by comparing the `StartTime` with the current date. If any Reserved Instance is older than 7 days, it needs to be reviewed.

4. **Set up a Scheduled AWS Lambda Function**:

   Create an AWS Lambda function that uses the AWS SDK to list all the Reserved Instances and their purchase dates. The Lambda function should compare the purchase date with the current date and send a notification if any Reserved Instance is older than 7 days.

5. **Create an AWS CloudWatch Event Rule**:

   Set up a CloudWatch Event Rule that triggers the Lambda function on a schedule (e.g., every 7 days). This will automate the process of reviewing RDS Reserved Instances purchases regularly.

6. **Configure Notifications**:

   Configure the Lambda function to send notifications (e.g., via Amazon SNS) to the appropriate stakeholders if any Reserved Instance needs to be reviewed.

By following these steps and automating the process using AWS Lambda and CloudWatch Events, you can ensure that RDS Reserved Instances purchases are reviewed every 7 days in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not reviewing RDS Reserved Instances purchases every 7 days in AWS using Python, you can create a Lambda function that will be triggered by a CloudWatch Events rule on a 7-day schedule. Below are the step-by-step instructions to remediate this misconfiguration:

1. **Create a Lambda Function**:
   
   - Go to the AWS Management Console and navigate to the Lambda service.
   - Click on the "Create function" button.
   - Choose the "Author from scratch" option.
   - Provide a name for your function, select Python as the runtime, and choose an existing role with the necessary permissions or create a new one.
   - Click on the "Create function" button.

2. **Write Python Code**:
   
   - In the Lambda function code editor, write Python code to list all the RDS Reserved Instances and check their purchase date.
   - You can use the AWS SDK for Python (Boto3) to interact with AWS services.
   - Here is an example code snippet to get you started:

    ```python
    import boto3
    from datetime import datetime, timedelta

    def lambda_handler(event, context):
        rds = boto3.client('rds')
        response = rds.describe_reserved_db_instances()

        for reserved_instance in response['ReservedDBInstances']:
            purchase_date = reserved_instance['StartTime'].replace(tzinfo=None)
            if datetime.now() - purchase_date > timedelta(days=7):
                # Send a notification or perform remediation action
                print(f"Review RDS Reserved Instance purchase for {reserved_instance['ReservedDBInstanceId']}")
    ```

3. **Set up CloudWatch Events Rule**:
   
   - Go to the AWS Management Console and navigate to the CloudWatch service.
   - Click on "Rules" in the left-hand menu and then click on "Create rule".
   - Set the schedule expression to run every 7 days.
   - Add a target for the rule and select the Lambda function you created earlier.

4. **Test the Remediation**:
   
   - Manually trigger the Lambda function to ensure that it is correctly listing RDS Reserved Instances that need review.
   - Verify that the CloudWatch Events rule triggers the Lambda function as expected every 7 days.

By following these steps, you can remediate the misconfiguration of not reviewing RDS Reserved Instances purchases every 7 days in AWS using a Python Lambda function triggered by a CloudWatch Events rule.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/rds/reserved-instances/](https://aws.amazon.com/rds/reserved-instances/) 

