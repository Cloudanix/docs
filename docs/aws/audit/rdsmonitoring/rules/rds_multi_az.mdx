---
slug: rds_multi_az
title: Multi-AZ Deployment Should Be Used
sidebar_label: Multi-AZ Deployment Should Be Used
---

### More Info:

Your RDS clusters should be using Multi-AZ deployment configurations for high availability and automatic failover support fully managed by AWS.

### Risk Level

Medium

### Address

Reliability

### Compliance Standards

HIPAA, NIST, HITRUST, AWSWAF, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not using Multi-AZ Deployment in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to RDS Dashboard:**
   - Sign in to the AWS Management Console.
   - Open the Amazon RDS console at [https://console.aws.amazon.com/rds](https://console.aws.amazon.com/rds).

2. **Create or Modify an RDS Instance:**
   - To create a new RDS instance, click on the "Create database" button.
   - To modify an existing RDS instance, select the instance from the list and click on the "Modify" button.

3. **Enable Multi-AZ Deployment:**
   - During the creation or modification process, in the "Availability & durability" section, locate the "Multi-AZ deployment" option.
   - Select the "Create a standby instance" option to enable Multi-AZ deployment.

4. **Save Changes:**
   - If creating a new instance, continue with the rest of the configuration and click on the "Create database" button to launch the instance with Multi-AZ enabled.
   - If modifying an existing instance, review the changes and click on the "Continue" button, then "Modify DB Instance" to apply the changes.

By following these steps, you ensure that your RDS instances are configured to use Multi-AZ deployment, enhancing availability and durability.
</Accordion>

<Accordion title='Using CLI'>
To ensure that Multi-AZ deployment is used in Amazon RDS using the AWS CLI, follow these steps:

1. **Create a New RDS Instance with Multi-AZ Deployment:**
   When creating a new RDS instance, you can specify the `--multi-az` parameter to ensure that the instance is deployed across multiple availability zones.

   ```sh
   aws rds create-db-instance \
       --db-instance-identifier mydbinstance \
       --allocated-storage 20 \
       --db-instance-class db.t2.micro \
       --engine mysql \
       --master-username admin \
       --master-user-password password \
       --multi-az
   ```

2. **Modify an Existing RDS Instance to Enable Multi-AZ Deployment:**
   If you have an existing RDS instance that is not using Multi-AZ, you can modify it to enable Multi-AZ deployment.

   ```sh
   aws rds modify-db-instance \
       --db-instance-identifier mydbinstance \
       --multi-az \
       --apply-immediately
   ```

3. **Ensure Multi-AZ Deployment in RDS Parameter Groups:**
   While parameter groups do not directly control Multi-AZ settings, ensuring that your RDS instances are associated with the correct parameter groups can help maintain consistency. You can list and modify parameter groups as needed.

   ```sh
   aws rds describe-db-parameter-groups
   ```

4. **Automate Multi-AZ Deployment Checks:**
   Use AWS Config rules to automatically check and ensure that all RDS instances are using Multi-AZ deployment. You can create a custom AWS Config rule or use a managed rule like `rds-multi-az-support`.

   ```sh
   aws configservice put-config-rule \
       --config-rule file://rds-multi-az-support.json
   ```

   Example `rds-multi-az-support.json` content:
   ```json
   {
       "ConfigRuleName": "rds-multi-az-support",
       "Description": "Checks whether RDS instances are using Multi-AZ deployment.",
       "Scope": {
           "ComplianceResourceTypes": [
               "AWS::RDS::DBInstance"
           ]
       },
       "Source": {
           "Owner": "AWS",
           "SourceIdentifier": "RDS_MULTI_AZ_SUPPORT"
       }
   }
   ```

By following these steps, you can ensure that your RDS instances are configured to use Multi-AZ deployment, thereby improving their availability and fault tolerance.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not using Multi-AZ Deployment in Amazon RDS using Python scripts, you can follow these steps:

### 1. **Install and Configure AWS SDK for Python (Boto3)**
First, ensure you have Boto3 installed and configured. You can install it using pip:

```bash
pip install boto3
```

Then, configure your AWS credentials:

```bash
aws configure
```

### 2. **Create a Python Script to Check RDS Instances**
Create a Python script to check if your RDS instances are using Multi-AZ deployment. This script will list all RDS instances and check their `MultiAZ` attribute.

```python
import boto3

def check_rds_multi_az():
    rds_client = boto3.client('rds')
    response = rds_client.describe_db_instances()
    
    for db_instance in response['DBInstances']:
        db_instance_id = db_instance['DBInstanceIdentifier']
        multi_az = db_instance['MultiAZ']
        
        if not multi_az:
            print(f"RDS instance {db_instance_id} is not using Multi-AZ deployment.")
        else:
            print(f"RDS instance {db_instance_id} is using Multi-AZ deployment.")

if __name__ == "__main__":
    check_rds_multi_az()
```

### 3. **Enforce Multi-AZ Deployment During RDS Instance Creation**
Modify your RDS instance creation script to enforce Multi-AZ deployment. Ensure that the `MultiAZ` parameter is set to `True`.

```python
import boto3

def create_rds_instance(db_instance_identifier, db_instance_class, engine, master_username, master_user_password):
    rds_client = boto3.client('rds')
    
    response = rds_client.create_db_instance(
        DBInstanceIdentifier=db_instance_identifier,
        DBInstanceClass=db_instance_class,
        Engine=engine,
        MasterUsername=master_username,
        MasterUserPassword=master_user_password,
        MultiAZ=True  # Enforce Multi-AZ deployment
    )
    
    print(f"Creating RDS instance {db_instance_identifier} with Multi-AZ deployment.")
    return response

if __name__ == "__main__":
    create_rds_instance(
        db_instance_identifier='mydbinstance',
        db_instance_class='db.t2.micro',
        engine='mysql',
        master_username='admin',
        master_user_password='password'
    )
```

### 4. **Automate Compliance Checks**
Set up a scheduled task or AWS Lambda function to periodically run the compliance check script. This ensures that any non-compliant RDS instances are identified and can be remediated promptly.

```python
import boto3
import time

def lambda_handler(event, context):
    check_rds_multi_az()

def check_rds_multi_az():
    rds_client = boto3.client('rds')
    response = rds_client.describe_db_instances()
    
    for db_instance in response['DBInstances']:
        db_instance_id = db_instance['DBInstanceIdentifier']
        multi_az = db_instance['MultiAZ']
        
        if not multi_az:
            print(f"RDS instance {db_instance_id} is not using Multi-AZ deployment.")
        else:
            print(f"RDS instance {db_instance_id} is using Multi-AZ deployment.")

# For local testing
if __name__ == "__main__":
    while True:
        check_rds_multi_az()
        time.sleep(3600)  # Run every hour
```

By following these steps, you can ensure that your RDS instances are always using Multi-AZ deployment, thereby enhancing the availability and reliability of your database services.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Databases".

3. In the list of DB instances, choose the name of the DB instance that you want to check.

4. In the "Details" section, look for the "Multi-AZ" field. If the value is "No", then Multi-AZ deployment is not used for the selected RDS instance. If the value is "Yes", then Multi-AZ deployment is used.

5. Repeat the process for all RDS instances in all regions to ensure Multi-AZ deployment is used everywhere.
</Accordion>

<Accordion title='Using Python'>
To check if Multi-AZ Deployment is used in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3**: First, you need to install the Boto3 library in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
2. **Configure AWS Credentials**: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure your credentials in several ways, but the simplest is to use the AWS CLI:
   ```
   aws configure
   ```
   Then, input your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

3. **Create a Python Script**: Now, you can create a Python script that uses Boto3 to check if Multi-AZ Deployment is used in RDS. Here's a simple script that does this:

   ```python
   import boto3

   def check_multi_az():
       client = boto3.client('rds')
       response = client.describe_db_instances()
       for instance in response['DBInstances']:
           if instance['MultiAZ'] == False:
               print(f"RDS instance {instance['DBInstanceIdentifier']} is not Multi-AZ")

   if __name__ == "__main__":
       check_multi_az()
   ```
   This script first creates a client connection to the RDS service. Then, it calls the `describe_db_instances` method to get a list of all RDS instances. For each instance, it checks the `MultiAZ` attribute. If this attribute is `False`, it means that the instance is not configured for Multi-AZ Deployment, and the script prints a message with the instance identifier.

4. **Run the Python Script**: Finally, you can run the Python script from your command line:
   ```
   python check_multi_az.py
   ```
   This will print out the identifiers of all RDS instances that are not configured for Multi-AZ Deployment.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not using Multi-AZ Deployment for an AWS RDS instance, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/) and log in to your account.

2. **Navigate to RDS Service**: Click on the "Services" dropdown menu at the top left corner and select "RDS" under the Database category.

3. **Select the RDS Instance**: From the list of RDS instances, select the instance for which you want to enable Multi-AZ Deployment by clicking on its identifier.

4. **Enable Multi-AZ Deployment**: In the RDS instance details page, click on the "Instance actions" dropdown menu and select "Modify".

5. **Modify the Deployment Options**: Scroll down to the "Deployment options" section and check the box next to "Enable Multi-AZ deployment".

6. **Review and Apply Changes**: Review the other configuration settings to ensure they are correct. Click on the "Continue" button.

7. **Apply Changes**: On the next page, review the summary of changes and click on the "Modify DB Instance" button to apply the changes.

8. **Monitor the Modification**: The modification process will start, and you can monitor the progress on the RDS console. Once the modification is complete, the Multi-AZ Deployment will be enabled for your RDS instance.

By following these steps, you have successfully remediated the misconfiguration of not using Multi-AZ Deployment for your AWS RDS instance.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not using Multi-AZ deployment for an AWS RDS instance using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to modify your RDS instance to enable Multi-AZ deployment:
   
   ```
   aws rds modify-db-instance \
   --db-instance-identifier YOUR_DB_INSTANCE_IDENTIFIER \
   --multi-az \
   --apply-immediately
   ```

   Replace `YOUR_DB_INSTANCE_IDENTIFIER` with the actual identifier of your RDS instance.

3. Wait for the modification to complete. You can check the status of the modification by running the following command:
   
   ```
   aws rds describe-db-instances --db-instance-identifier YOUR_DB_INSTANCE_IDENTIFIER --query 'DBInstances[*].[DBInstanceIdentifier,DBInstanceStatus]'
   ```

4. Once the modification is complete and the status shows as "available", the Multi-AZ deployment for your RDS instance has been successfully enabled.

By following these steps, you can remediate the misconfiguration of not using Multi-AZ deployment for an AWS RDS instance using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not using Multi-AZ deployment for an AWS RDS instance using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Define the AWS region and the RDS instance identifier:
```python
region = 'your_aws_region'
instance_identifier = 'your_rds_instance_identifier'
```

3. Create an RDS client using Boto3:
```python
rds_client = boto3.client('rds', region_name=region)
```

4. Modify the RDS instance to enable Multi-AZ deployment:
```python
response = rds_client.modify_db_instance(
    DBInstanceIdentifier=instance_identifier,
    MultiAZ=True
)
```

5. Check the response to ensure the modification was successful:
```python
if response['DBInstance']['MultiAZ']:
    print(f"Multi-AZ deployment enabled for RDS instance {instance_identifier}")
else:
    print(f"Failed to enable Multi-AZ deployment for RDS instance {instance_identifier}")
```

6. Run the Python script to enable Multi-AZ deployment for the specified RDS instance.

By following these steps, you can remediate the misconfiguration of not using Multi-AZ deployment for an AWS RDS instance using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html) 

