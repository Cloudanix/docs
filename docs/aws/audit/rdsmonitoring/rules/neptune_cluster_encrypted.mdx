---
slug: neptune_cluster_encrypted
title: Neptune DB Clusters Storage Encryption Should Be Enabled
sidebar_label: Neptune DB Clusters Storage Encryption Should Be Enabled
---
### More Info:

This rule checks if storage encryption is enabled for your Amazon Neptune DB clusters. The rule is NON_COMPLIANT if storage encryption is not enabled.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2,NIST,GDPR,ISO27001,HIPAA,HITRUST,NISTCSF,PCIDSS,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Neptune DB Clusters Storage Encryption from being disabled in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to Neptune Service:**
   - Open the AWS Management Console.
   - In the search bar, type "Neptune" and select "Amazon Neptune" from the dropdown.

2. **Create a New DB Cluster:**
   - Click on "Create database" to start the process of creating a new Neptune DB cluster.
   - Choose the appropriate settings for your database, such as engine version, instance class, and other configurations.

3. **Enable Storage Encryption:**
   - In the "Settings" section, look for the "Storage" options.
   - Ensure that the "Enable storage encryption" checkbox is selected. This will ensure that the storage for your Neptune DB cluster is encrypted.

4. **Review and Create:**
   - Review all your settings to ensure they are correct.
   - Click on "Create database" to finalize the creation of your Neptune DB cluster with storage encryption enabled.

By following these steps, you can ensure that storage encryption is enabled for your Neptune DB clusters, thereby preventing misconfigurations related to unencrypted storage.
</Accordion>

<Accordion title='Using CLI'>
To ensure that Neptune DB Clusters have storage encryption enabled using AWS CLI, follow these steps:

1. **Create a KMS Key**:
   First, you need to create a KMS (Key Management Service) key that will be used to encrypt the Neptune DB Cluster storage.
   ```sh
   aws kms create-key --description "Key for Neptune DB Cluster encryption"
   ```

2. **Create a Neptune DB Cluster with Encryption**:
   When creating a new Neptune DB Cluster, specify the KMS key to enable encryption.
   ```sh
   aws neptune create-db-cluster \
       --db-cluster-identifier my-neptune-cluster \
       --engine neptune \
       --kms-key-id <your-kms-key-id>
   ```

3. **Modify an Existing Neptune DB Cluster to Enable Encryption**:
   Note: Neptune DB Clusters cannot be modified to enable encryption after they are created. You must create a new encrypted cluster and migrate your data.

4. **Verify Encryption**:
   Ensure that the Neptune DB Cluster has encryption enabled by describing the cluster.
   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier my-neptune-cluster
   ```

   Look for the `StorageEncrypted` field in the output to confirm that it is set to `true`.

By following these steps, you can ensure that your Neptune DB Clusters have storage encryption enabled using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent Neptune DB Clusters Storage Encryption from being disabled in Amazon RDS using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that storage encryption is enabled for Neptune DB clusters:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Create a Boto3 Session**:
   Initialize a Boto3 session with the necessary AWS credentials and region.

3. **Check Existing Neptune DB Clusters**:
   Retrieve the list of existing Neptune DB clusters and check their storage encryption status.

4. **Create Neptune DB Cluster with Encryption**:
   If creating a new Neptune DB cluster, ensure that the `StorageEncrypted` parameter is set to `True`.

Here is a Python script that demonstrates these steps:

```python
import boto3

# Step 1: Initialize a Boto3 session
session = boto3.Session(
    aws_access_key_id='YOUR_AWS_ACCESS_KEY',
    aws_secret_access_key='YOUR_AWS_SECRET_KEY',
    region_name='YOUR_AWS_REGION'
)

# Step 2: Create a Neptune client
neptune_client = session.client('neptune')

# Step 3: Check existing Neptune DB clusters for encryption
def check_neptune_clusters_encryption():
    response = neptune_client.describe_db_clusters()
    clusters = response['DBClusters']
    for cluster in clusters:
        cluster_id = cluster['DBClusterIdentifier']
        encryption_status = cluster['StorageEncrypted']
        print(f"Cluster ID: {cluster_id}, Storage Encrypted: {encryption_status}")

# Step 4: Create a new Neptune DB cluster with encryption enabled
def create_encrypted_neptune_cluster(cluster_id, db_instance_class, engine, master_username, master_user_password):
    response = neptune_client.create_db_cluster(
        DBClusterIdentifier=cluster_id,
        Engine=engine,
        MasterUsername=master_username,
        MasterUserPassword=master_user_password,
        StorageEncrypted=True  # Ensure encryption is enabled
    )
    print(f"Created Neptune DB Cluster with ID: {response['DBCluster']['DBClusterIdentifier']}")

# Example usage
check_neptune_clusters_encryption()

# Uncomment the following line to create a new encrypted Neptune DB cluster
# create_encrypted_neptune_cluster('my-neptune-cluster', 'db.r5.large', 'neptune', 'admin', 'password123')
```

### Key Points:
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Initialize Boto3 Session**: Set up a session with your AWS credentials and region.
3. **Check Existing Clusters**: Use `describe_db_clusters` to check the encryption status of existing Neptune DB clusters.
4. **Create Encrypted Cluster**: Use `create_db_cluster` with `StorageEncrypted=True` to ensure new clusters are encrypted.

This script helps you ensure that all new Neptune DB clusters are created with storage encryption enabled and allows you to verify the encryption status of existing clusters.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the navigation pane on the left, click on "Databases".
4. This will display a list of all your DB instances. Click on the name of the Neptune DB cluster that you want to check.
5. In the details pane, under the "Configuration" section, look for the "Encryption" field. If it says "Enabled", then storage encryption is enabled for that Neptune DB cluster. If it says "Disabled", then storage encryption is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Neptune DB clusters: Use the `describe-db-clusters` command to list all the Neptune DB clusters in your AWS account. The command is as follows:
   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier,StorageEncrypted]' --output text
   ```
   This command will return a list of all Neptune DB clusters along with their encryption status.

3. Check the encryption status: The second column in the output represents the encryption status of each Neptune DB cluster. If the value is 'false', it means that the Neptune DB cluster storage encryption is not enabled.

4. Automate the process: If you want to automate this process, you can write a Python script using the Boto3 library (AWS SDK for Python) to list all the Neptune DB clusters and check their encryption status. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('rds')

   response = client.describe_db_clusters()

   for db_cluster in response['DBClusters']:
       if db_cluster['Engine'] == 'neptune' and not db_cluster['StorageEncrypted']:
           print(f"Neptune DB cluster {db_cluster['DBClusterIdentifier']} does not have storage encryption enabled.")
   ```
   This script will print the identifiers of all Neptune DB clusters that do not have storage encryption enabled.
</Accordion>

<Accordion title='Using Python'>
To check if Neptune DB Clusters Storage Encryption is enabled in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Import the Boto3 library in Python:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:
   ```python
   pip install boto3
   ```

2. **Create an AWS session:**
   You need to create a session using your AWS credentials. You can configure your credentials in the AWS credentials file located by default at `~/.aws/credentials`.
   ```python
   import boto3
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. **Get a list of all Neptune DB clusters:**
   Use the `describe_db_clusters` method to get a list of all Neptune DB clusters.
   ```python
   neptune = session.client('neptune')
   response = neptune.describe_db_clusters()
   ```

4. **Check if storage encryption is enabled:**
   Iterate over the list of DB clusters and check the `StorageEncrypted` attribute. If it's `False`, then storage encryption is not enabled.
   ```python
   for db_cluster in response['DBClusters']:
       if not db_cluster['StorageEncrypted']:
           print(f"DB Cluster {db_cluster['DBClusterIdentifier']} does not have storage encryption enabled.")
   ```
This script will print out the identifiers of all DB clusters that do not have storage encryption enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Neptune DB Clusters Storage Encryption not being enabled in AWS RDS, you can follow these step-by-step instructions using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/) and login to your account.

2. **Navigate to Amazon Neptune**: In the AWS Management Console, navigate to the Amazon Neptune service by either searching for it in the search bar or locating it under the "Database" category.

3. **Select the Neptune DB Cluster**: From the list of Neptune DB clusters, select the DB cluster for which you want to enable storage encryption.

4. **Enable Encryption**: In the Neptune DB cluster details page, click on the "Configuration" tab.

5. **Modify Cluster**: Under the "Cluster details" section, click on the "Modify" button to change the configuration settings.

6. **Enable Encryption at Rest**: Scroll down to the "Storage" section, and look for the "Storage encryption" option. Check the box next to "Enable storage encryption" to enable encryption at rest for your Neptune DB cluster.

7. **Choose Encryption Key**: If you have an existing AWS Key Management Service (KMS) key that you want to use for encryption, you can select it from the dropdown list. Otherwise, you can choose to create a new KMS key.

8. **Save Changes**: After enabling storage encryption and selecting the encryption key, scroll to the bottom of the page and click on the "Modify cluster" button to apply the changes.

9. **Monitor Progress**: The modification process may take some time to complete. You can monitor the progress in the "Modifications" tab of the Neptune DB cluster details page.

10. **Verification**: Once the modification is completed, verify that storage encryption is enabled for your Neptune DB cluster by checking the "Cluster details" section in the Neptune console.

By following these steps, you can successfully remediate the misconfiguration of Neptune DB Clusters Storage Encryption not being enabled in AWS RDS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Neptune DB Clusters storage encryption not being enabled in AWS RDS using AWS CLI, follow these steps:

1. **Enable Encryption at Rest for Neptune DB Cluster**:
   - Run the following AWS CLI command to enable storage encryption for the Neptune DB cluster:
     ```bash
     aws neptune modify-db-cluster --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER --storage-encrypted
     ```
     Replace `YOUR_DB_CLUSTER_IDENTIFIER` with the actual identifier of your Neptune DB cluster.

2. **Verify Encryption Status**:
   - You can verify that encryption at rest is enabled for the Neptune DB cluster by describing the cluster:
     ```bash
     aws neptune describe-db-clusters --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER --query 'DBClusters[*].StorageEncrypted'
     ```
     Ensure that the output shows `"StorageEncrypted": true`.

3. **Update IAM Policies** (if needed):
   - If the AWS Identity and Access Management (IAM) policies need to be updated to reflect the changes in encryption settings, make sure to update them accordingly.

4. **Monitor Encryption Status**:
   - Regularly monitor the encryption status of your Neptune DB cluster to ensure that encryption at rest remains enabled.

By following these steps, you can successfully remediate the misconfiguration of Neptune DB Clusters storage encryption not being enabled in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Neptune DB Clusters Storage Encryption not being enabled in AWS RDS using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the AWS RDS client:
```python
client = boto3.client('rds')
```

3. Get a list of all Neptune DB clusters:
```python
response = client.describe_db_clusters()
```

4. Iterate through each Neptune DB cluster and enable storage encryption if it is not already enabled:
```python
for cluster in response['DBClusters']:
    cluster_identifier = cluster['DBClusterIdentifier']
    storage_encrypted = cluster['StorageEncrypted']
    
    if not storage_encrypted:
        try:
            client.modify_db_cluster(
                DBClusterIdentifier=cluster_identifier,
                StorageEncrypted=True
            )
            print(f"Storage encryption enabled for {cluster_identifier}")
        except Exception as e:
            print(f"Error enabling storage encryption for {cluster_identifier}: {str(e)}")
```

5. Save the Python script and run it in your AWS environment with appropriate IAM permissions to modify RDS clusters.

After running this script, it will enable storage encryption for all Neptune DB clusters that do not already have it enabled.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

