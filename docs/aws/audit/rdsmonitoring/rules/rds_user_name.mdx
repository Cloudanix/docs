---
slug: rds_user_name
title: Master Username Should Be Unique
sidebar_label: Master Username Should Be Unique
---

### More Info:

It is not a good practice to use awsuser or admin as master username for your database connection. Instead, use unique alphanumeric username.

### Risk Level

Low

### Address

Security

### Compliance Standards

PCIDSS


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the RDS dashboard.
2. In the navigation pane, choose "Databases" to open the Databases page.
3. On the Databases page, you will see a list of all your RDS instances. Click on the name of the RDS instance you want to check.
4. In the instance details page, look for the "Master username" field. This is the master username for the RDS instance. Repeat this process for all RDS instances and ensure that each master username is unique.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all RDS instances: Use the following AWS CLI command to list all the RDS instances in your AWS account:

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier,MasterUsername]'
   ```
   This command will return a list of all RDS instances along with their master usernames.

3. Check for unique master usernames: Now, you need to manually check the output of the above command to see if there are any duplicate master usernames. If there are, it means that the master username is not unique for each RDS instance.

4. Automate the process with a Python script: If you have a large number of RDS instances, it might be more efficient to automate the process with a Python script. You can use the `boto3` library to interact with AWS services. Here is a simple script that checks for unique master usernames:

   ```python
   import boto3

   # Create a client for the AWS RDS service
   rds = boto3.client('rds')

   # Get a list of all RDS instances
   instances = rds.describe_db_instances()

   # Create a set to store the master usernames
   master_usernames = set()

   # Iterate over the instances
   for instance in instances['DBInstances']:
       # If the master username is already in the set, print a warning
       if instance['MasterUsername'] in master_usernames:
           print(f"Warning: Duplicate master username found: {instance['MasterUsername']}")
       else:
           # Otherwise, add the master username to the set
           master_usernames.add(instance['MasterUsername'])
   ```
   This script will print a warning for each RDS instance that has a master username that is not unique.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new RDS client:

```python
import boto3
rds = boto3.client('rds')
```

2. Fetch all the RDS instances and their details:

```python
response = rds.describe_db_instances()
```

3. Create an empty list to store the master usernames:

```python
master_usernames = []
```

4. Iterate over each RDS instance, extract the master username, and add it to the list. If the username is already in the list, print a message indicating a misconfiguration:

```python
for instance in response['DBInstances']:
    master_username = instance['MasterUsername']
    if master_username in master_usernames:
        print(f"Misconfiguration Detected: Master username {master_username} is not unique.")
    else:
        master_usernames.append(master_username)
```

This script will detect if there are any RDS instances that are using the same master username, which is a misconfiguration as each RDS instance should have a unique master username for security reasons.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of the master username not being unique for an AWS RDS instance, you can follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and sign in using your credentials.

2. **Navigate to RDS Service**: Click on the "Services" dropdown menu at the top of the page and select "RDS" under the Database section.

3. **Select the RDS Instance**: From the list of RDS instances, select the instance for which you want to change the master username.

4. **Modify the Master Username**: In the RDS dashboard, locate the "Configuration" section and click on the "Modify" button.

5. **Change the Master Username**: In the Modify DB Instance window, scroll down to the "Master Username" field and enter a unique username that you want to set as the new master username.

6. **Apply the Changes**: Scroll down to the bottom of the page and click on the "Continue" button.

7. **Review and Apply Changes**: Review the changes you are about to make and click on the "Modify DB Instance" button to apply the changes.

8. **Monitor the Modification**: The modification process may take a few minutes to complete. You can monitor the progress in the RDS console.

9. **Verify the Changes**: Once the modification is complete, verify that the master username has been successfully changed to a unique username.

By following these steps, you can remediate the issue of the master username not being unique for an AWS RDS instance using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of the master username not being unique for an AWS RDS instance using the AWS CLI, follow these steps:

1. **Identify the RDS Instance**: First, identify the RDS instance for which you need to change the master username. You can list all your RDS instances using the following AWS CLI command:
   ```bash
   aws rds describe-db-instances
   ```

2. **Modify the Master Username**: Once you have identified the RDS instance, you can modify the master username using the `modify-db-instance` command. Replace `your-db-instance-identifier` with the actual DB instance identifier and `new-master-username` with the unique username you want to set:
   ```bash
   aws rds modify-db-instance --db-instance-identifier your-db-instance-identifier --master-user-password your-new-master-username
   ```

3. **Wait for the Modification to Complete**: The modification process may take some time to complete. You can check the status of the modification using the `describe-db-instances` command:
   ```bash
   aws rds describe-db-instances --db-instance-identifier your-db-instance-identifier --query "DBInstances[*].DBInstanceStatus"
   ```

4. **Verify the Changes**: Once the modification is complete, verify that the master username has been successfully updated by describing the DB instance:
   ```bash
   aws rds describe-db-instances --db-instance-identifier your-db-instance-identifier --query "DBInstances[*].MasterUsername"
   ```

By following these steps, you can successfully remediate the issue of a non-unique master username for an AWS RDS instance using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of non-unique master username for an AWS RDS instance using Python, you can follow these steps:

1. Use the AWS SDK for Python (Boto3) to interact with AWS services programmatically. Make sure you have the Boto3 library installed in your Python environment.

2. Write a Python script that does the following:
   
   a. Import the necessary libraries:
   ```python
   import boto3
   ```

   b. Initialize the RDS client:
   ```python
   rds_client = boto3.client('rds', region_name='your_region')
   ```

   c. List all existing RDS instances:
   ```python
   response = rds_client.describe_db_instances()
   ```

   d. Check if the master username is unique:
   ```python
   master_username = 'your_desired_master_username'
   existing_usernames = [instance['MasterUsername'] for instance in response['DBInstances']]
   
   if master_username in existing_usernames:
       print(f"Master username '{master_username}' is already in use. Please choose a different username.")
       # You can either prompt the user to enter a new unique username or generate a unique username programmatically
   else:
       print(f"Master username '{master_username}' is unique.")
   ```

3. Run the Python script to check if the master username is unique. If it's not unique, prompt the user to enter a new unique username or generate a unique username programmatically.

4. If the user enters a new unique username, update the master username for the RDS instance using the modify_db_instance method:
   ```python
   rds_client.modify_db_instance(
       DBInstanceIdentifier='your_db_instance_id',
       MasterUsername='your_new_master_username',
       ApplyImmediately=True
   )
   ```

5. Verify that the master username has been successfully updated by describing the RDS instance again and checking the master username.

By following these steps, you can remediate the issue of a non-unique master username for an AWS RDS instance using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_BestPractices.html](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_BestPractices.html) 

