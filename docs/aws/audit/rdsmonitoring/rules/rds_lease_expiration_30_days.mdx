---
slug: rds_lease_expiration_30_days
title: Renew RDS Reserved Instances Before Expiration (30 days)
sidebar_label: Renew RDS Reserved Instances Before Expiration (30 days)
---

### More Info:

Your AWS RDS Reserved Instances (RIs) should be renewed before expiration in order to get the appropriate discount on the hourly charge for these instances

### Risk Level

Medium

### Address

Cost Optimisation

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the RDS dashboard. 

2. In the navigation pane, click on 'Reserved Instances'. This will display a list of all your reserved instances.

3. For each reserved instance, check the 'State' and 'End date'. If the state is 'active' and the end date is within the next 30 days, then the reserved instance is due for renewal.

4. You can also set up an alert to notify you when a reserved instance is due for renewal. To do this, go to CloudWatch, create a new alarm, and set the alarm condition to trigger when the 'ReservedInstance' metric is less than 30. This will send you an email notification when any of your reserved instances are due for renewal within the next 30 days.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all RDS Reserved Instances: Use the `describe-reserved-db-instances` command to list all your RDS Reserved Instances. This command returns a JSON object that contains all your RDS Reserved Instances.

   ```
   aws rds describe-reserved-db-instances
   ```

3. Parse the output: The output from the previous command includes a `ReservedDBInstances` field that contains an array of all your RDS Reserved Instances. Each instance has a `LeaseId`, `ReservedDBInstanceId`, `ReservedDBInstancesOfferingId`, `DBInstanceCount`, `Start`, `Duration`, `FixedPrice`, `UsagePrice`, `CurrencyCode`, `DBInstanceClass`, `ProductDescription`, `OfferingType`, `RecurringCharges`, `State`, and `OfferingDescription` field. The `Duration` field indicates the duration of the reservation in seconds, and the `Start` field indicates when the reservation started.

4. Calculate the expiration date: You can calculate the expiration date of each RDS Reserved Instance by adding the `Duration` to the `Start` date. If the current date is within 30 days of the expiration date, then the RDS Reserved Instance is about to expire.

   Here is a sample Python script that uses the `boto3` library to perform this calculation:

   ```python
   import boto3
   from datetime import datetime, timedelta

   # Create a client
   rds = boto3.client('rds')

   # Get the current date
   now = datetime.now()

   # List all RDS Reserved Instances
   response = rds.describe_reserved_db_instances()

   # Iterate over all RDS Reserved Instances
   for instance in response['ReservedDBInstances']:
       # Calculate the expiration date
       expiration_date = instance['Start'] + timedelta(seconds=instance['Duration'])
       # Check if the RDS Reserved Instance is about to expire
       if now > expiration_date - timedelta(days=30):
           print(f"The RDS Reserved Instance {instance['ReservedDBInstanceId']} is about to expire.")
   ```
   This script prints the ID of each RDS Reserved Instance that is about to expire.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary libraries: You will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You will also need the datetime library to work with dates.

```python
import boto3
from datetime import datetime, timedelta
```

2. Create a session using your AWS credentials. You can replace 'aws_access_key_id', 'aws_secret_access_key', and 'region_name' with your own details.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a client for 'rds' and get all the reserved instances.

```python
rds = session.client('rds')
reservations = rds.describe_reserved_db_instances()
```

4. Iterate over each reserved instance and check if it's going to expire in less than 30 days.

```python
for reservation in reservations['ReservedDBInstances']:
    start_time = reservation['StartTime']
    duration = reservation['Duration']
    end_time = start_time + timedelta(seconds=duration)
    if end_time - datetime.now() < timedelta(days=30):
        print(f"RDS Reserved Instance {reservation['ReservedDBInstanceId']} is going to expire in less than 30 days.")
```

This script will print out the IDs of all RDS Reserved Instances that are going to expire in less than 30 days.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To renew RDS Reserved Instances before expiration in AWS RDS using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console at https://aws.amazon.com/ and login with your credentials.

2. **Navigate to RDS Service**: Click on the "Services" dropdown menu at the top of the page, then select "RDS" under the Database section.

3. **Select Reserved Instances**: In the left-hand navigation pane, click on "Reserved Instances" to view the list of your existing reserved instances.

4. **Identify Expiring Reserved Instances**: Look for the Reserved Instances that are nearing expiration (within 30 days) in the list displayed.

5. **Select the Reserved Instance**: Click on the checkbox next to the Reserved Instance that you want to renew before expiration.

6. **Click on Actions**: At the top of the Reserved Instances page, click on the "Actions" dropdown menu.

7. **Select Renew Reserved Instances**: From the Actions dropdown menu, select "Renew Reserved Instances".

8. **Review and Confirm**: Review the details of the renewal, including the term length and payment options. Confirm that you want to renew the Reserved Instance.

9. **Complete the Renewal Process**: Follow the on-screen instructions to complete the renewal process. You may need to provide payment information if the renewal involves additional charges.

10. **Verify Renewal**: Once the renewal process is complete, verify that the Reserved Instance now shows an updated expiration date that is beyond the next 30 days.

By following these steps, you can successfully renew your RDS Reserved Instances before they expire in AWS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To renew RDS Reserved Instances before expiration (30 days) in AWS using AWS CLI, follow these steps:

1. List all the existing reserved instances to identify the ones that are expiring within the next 30 days:
```bash
aws rds describe-reserved-db-instances
```

2. Identify the Reserved Instance that is expiring within the next 30 days and note down its Reserved Instance ID.

3. Modify the existing Reserved Instance to renew it for another term. You can do this by using the `modify-db-instance` command:
```bash
aws rds modify-db-instance --db-instance-identifier your-db-instance-id --reserved-db-instance-id your-reserved-instance-id --reserved-db-instances-offering-id new-reserved-offering-id
```
Replace `your-db-instance-id` with the DB instance identifier, `your-reserved-instance-id` with the Reserved Instance ID, and `new-reserved-offering-id` with the ID of the new Reserved Instance offering.

4. Verify that the Reserved Instance has been successfully renewed by describing the reserved instance again:
```bash
aws rds describe-reserved-db-instances
```

By following these steps, you can renew RDS Reserved Instances before expiration in AWS using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not renewing RDS Reserved Instances before expiration in AWS using Python, you can create a script that checks the expiration date of the reserved instances and automatically renews them if they are set to expire within the next 30 days. Here's a step-by-step guide on how to do this:

1. **Install Boto3**: Make sure you have the Boto3 library installed in your Python environment. Boto3 is the AWS SDK for Python and allows you to interact with AWS services.

   ```bash
   pip install boto3
   ```

2. **Create Python Script**:
   Create a Python script (e.g., `renew_rds_reserved_instances.py`) with the following code:

   ```python
   import boto3
   from datetime import datetime, timedelta

   # Initialize the RDS client
   rds_client = boto3.client('rds')

   # Get a list of all reserved instances
   reserved_instances = rds_client.describe_reserved_db_instances()

   # Check each reserved instance for expiration within the next 30 days
   for reserved_instance in reserved_instances['ReservedDBInstances']:
       expiration_date = reserved_instance['EndTime']
       days_until_expiration = (expiration_date - datetime.now()).days

       if days_until_expiration <= 30:
           # Renew the reserved instance
           response = rds_client.modify_reserved_db_instances(
               ReservedDBInstanceId=reserved_instance['ReservedDBInstanceId'],
               ReservedDBInstancesOfferingId=reserved_instance['ReservedDBInstancesOfferingId'],
               Duration=reserved_instance['Duration'])
           print(f"Renewed reserved instance {reserved_instance['ReservedDBInstanceId']}")

   ```

3. **AWS Credentials**:
   Ensure that your AWS credentials are properly configured either through environment variables or `~/.aws/credentials` file.

4. **Run the Script**:
   Run the Python script using your preferred method (e.g., `python renew_rds_reserved_instances.py`). The script will check all your RDS reserved instances and renew those that are set to expire within the next 30 days.

By following these steps, you can automatically renew RDS Reserved Instances before they expire in AWS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/rds/reserved-instances/](https://aws.amazon.com/rds/reserved-instances/) 

