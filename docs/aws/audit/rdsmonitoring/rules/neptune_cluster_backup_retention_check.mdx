---
slug: neptune_cluster_backup_retention_check
title: Neptune DB Cluster Should Have Backup Retention Check
sidebar_label: Neptune DB Cluster Should Have Backup Retention Check
---
### More Info:

Checks if an Amazon Neptune DB cluster retention period is set to specific number of days. The rule is NON_COMPLIANT if the retention period is less than the value specified by the parameter.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of a Neptune DB Cluster not having a proper backup retention period in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to the Neptune Console:**
   - Open the AWS Management Console.
   - In the search bar, type "Neptune" and select "Amazon Neptune" from the dropdown.

2. **Select the DB Cluster:**
   - In the Neptune dashboard, click on "Clusters" in the left-hand navigation pane.
   - Select the DB cluster you want to configure from the list of clusters.

3. **Modify the DB Cluster:**
   - With the DB cluster selected, click on the "Actions" dropdown menu.
   - Choose "Modify cluster" from the list of actions.

4. **Set Backup Retention Period:**
   - In the "Backup" section of the Modify Cluster page, find the "Backup retention period" setting.
   - Set the desired number of days for the backup retention period (e.g., 7 days).
   - Scroll down and click the "Continue" button, then review the changes and click "Modify cluster" to apply the settings.

By following these steps, you ensure that your Neptune DB Cluster has an appropriate backup retention period configured, which helps in preventing data loss and ensuring data recovery options.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where an Amazon Neptune DB Cluster should have a backup retention period set, you can use the AWS CLI to ensure that the backup retention period is configured correctly. Here are the steps to achieve this:

1. **Describe the Neptune DB Cluster:**
   First, you need to identify the current configuration of your Neptune DB Cluster. Use the following command to describe the cluster and check the current backup retention period.

   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier <your-db-cluster-identifier>
   ```

2. **Modify the Neptune DB Cluster:**
   If the backup retention period is not set or is set to 0 (which means backups are disabled), you need to modify the cluster to set an appropriate backup retention period. Use the following command to set the backup retention period (e.g., 7 days).

   ```sh
   aws neptune modify-db-cluster --db-cluster-identifier <your-db-cluster-identifier> --backup-retention-period 7
   ```

3. **Verify the Changes:**
   After modifying the DB cluster, verify that the changes have been applied correctly by describing the DB cluster again.

   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier <your-db-cluster-identifier>
   ```

4. **Automate the Check (Optional):**
   To ensure that the backup retention period is always set correctly, you can create a script or use AWS Config rules to continuously monitor and enforce this configuration. For example, you can write a simple Python script using Boto3 to check and set the backup retention period if it is not configured correctly.

   ```python
   import boto3

   client = boto3.client('neptune')

   def check_and_set_backup_retention(db_cluster_identifier, retention_period):
       response = client.describe_db_clusters(DBClusterIdentifier=db_cluster_identifier)
       db_clusters = response['DBClusters']
       for cluster in db_clusters:
           if cluster['BackupRetentionPeriod'] < retention_period:
               client.modify_db_cluster(
                   DBClusterIdentifier=db_cluster_identifier,
                   BackupRetentionPeriod=retention_period
               )
               print(f"Backup retention period set to {retention_period} days for cluster {db_cluster_identifier}")

   check_and_set_backup_retention('<your-db-cluster-identifier>', 7)
   ```

By following these steps, you can ensure that your Amazon Neptune DB Cluster has an appropriate backup retention period set, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of a Neptune DB Cluster not having a proper backup retention period in AWS RDS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that your Neptune DB Cluster has a proper backup retention period:

### Step 1: Install Boto3
First, ensure that you have Boto3 installed. You can install it using pip if you haven't already:
```bash
pip install boto3
```

### Step 2: Set Up AWS Credentials
Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

### Step 3: Create a Python Script
Create a Python script to check and set the backup retention period for your Neptune DB Cluster.

```python
import boto3

# Initialize a session using Amazon Neptune
client = boto3.client('neptune')

# Function to check and set backup retention period
def ensure_backup_retention(db_cluster_identifier, retention_period):
    try:
        # Describe the DB cluster to get current settings
        response = client.describe_db_clusters(DBClusterIdentifier=db_cluster_identifier)
        db_clusters = response['DBClusters']
        
        if not db_clusters:
            print(f"No DB cluster found with identifier {db_cluster_identifier}")
            return
        
        db_cluster = db_clusters[0]
        current_retention_period = db_cluster.get('BackupRetentionPeriod', 0)
        
        # Check if the current retention period is less than the desired period
        if current_retention_period < retention_period:
            # Modify the DB cluster to set the desired backup retention period
            client.modify_db_cluster(
                DBClusterIdentifier=db_cluster_identifier,
                BackupRetentionPeriod=retention_period,
                ApplyImmediately=True
            )
            print(f"Backup retention period updated to {retention_period} days for DB cluster {db_cluster_identifier}")
        else:
            print(f"Backup retention period is already set to {current_retention_period} days for DB cluster {db_cluster_identifier}")
    
    except Exception as e:
        print(f"Error: {e}")

# Example usage
db_cluster_identifier = 'your-neptune-db-cluster-identifier'
desired_retention_period = 7  # Set your desired retention period in days
ensure_backup_retention(db_cluster_identifier, desired_retention_period)
```

### Step 4: Run the Script
Run the script to ensure that your Neptune DB Cluster has the desired backup retention period.

```bash
python ensure_backup_retention.py
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed using pip.
2. **Set Up AWS Credentials**: Configure your AWS credentials.
3. **Create a Python Script**: Write a Python script to check and set the backup retention period.
4. **Run the Script**: Execute the script to apply the desired backup retention settings.

By following these steps, you can prevent the misconfiguration of your Neptune DB Cluster not having a proper backup retention period using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu, then selecting "RDS" under the "Database" category.
3. In the navigation pane, click on "DB Clusters". This will display a list of all your DB clusters.
4. Select the Neptune DB cluster you want to check. In the "Details" section, look for the "Backup" field. This will show the current backup retention period for the selected Neptune DB cluster. If the backup retention period is less than the recommended period (usually 7 days), then it indicates a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all DB Clusters: Use the `describe-db-clusters` command to list all the DB clusters in your AWS account. The command is as follows:

   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier,BackupRetentionPeriod]' --output text
   ```

   This command will return a list of all DB clusters along with their backup retention periods.

3. Check Backup Retention Period: The output from the previous command will include the backup retention period for each DB cluster. This is the number of days for which automated backups are retained. If this value is less than your organization's required retention period, then the DB cluster is misconfigured.

4. Automate the process: To automate this process, you can write a Python script that uses the Boto3 library to interact with the AWS RDS service. The script would use the `describe_db_clusters` method to get the information about all DB clusters and then check the `BackupRetentionPeriod` attribute of each DB cluster. If the value of this attribute is less than the required retention period, the script would print a message indicating that the DB cluster is misconfigured.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary libraries: You will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc.

```python
import boto3
```

2. Create a session using your AWS credentials. You can also use the AWS CLI's default configuration.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a client for 'rds' and get the list of all DB clusters.

```python
rds = session.client('rds')
clusters = rds.describe_db_clusters()
```

4. Iterate over the list of DB clusters and check the 'BackupRetentionPeriod' for each cluster. If it's less than the desired value, print a message.

```python
for cluster in clusters['DBClusters']:
    if cluster['BackupRetentionPeriod'] < 7:  # replace 7 with your desired value
        print(f"DB cluster {cluster['DBClusterIdentifier']} has a backup retention period of {cluster['BackupRetentionPeriod']} days.")
```

This script will print a message for each DB cluster whose backup retention period is less than the desired value. You can modify it to suit your needs, for example by raising an exception or sending an alert instead of printing a message.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Neptune DB Cluster not having backup retention check in AWS RDS using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login using your credentials.

2. **Navigate to Amazon Neptune**: Click on the "Services" dropdown in the top menu, then select "Neptune" under the Database section.

3. **Select Neptune DB Cluster**: From the list of Neptune DB Clusters, click on the DB Cluster that you want to configure backup retention for.

4. **Modify Backup Retention**: In the Neptune DB Cluster dashboard, click on the "Modify" button to change the configuration settings.

5. **Set Backup Retention Period**: Scroll down to the "Backup" section and locate the "Backup Retention Period" setting. Set the desired backup retention period in days. Ensure that the checkbox for "Backup Retention" is checked.

6. **Apply Changes**: Scroll to the bottom of the page and click on the "Continue" button.

7. **Review and Apply Changes**: Review the changes you have made to the Neptune DB Cluster configuration. Once you are satisfied, click on the "Modify Cluster" button to apply the changes.

8. **Monitor Configuration Changes**: After applying the changes, monitor the Neptune DB Cluster to ensure that the backup retention check is configured correctly.

By following these steps, you will successfully remediate the misconfiguration of Neptune DB Cluster not having backup retention check in AWS RDS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration for Neptune DB Cluster backup retention check in AWS RDS using AWS CLI, follow these steps:

1. **Check Current Backup Retention Settings**:
   Run the following AWS CLI command to check the current backup retention settings for your Neptune DB Cluster:
   ```
   aws neptune describe-db-cluster --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER
   ```

2. **Update Backup Retention Period**:
   Run the following AWS CLI command to modify the backup retention period for your Neptune DB Cluster. Replace `YOUR_DB_CLUSTER_IDENTIFIER` with the actual identifier of your Neptune DB Cluster and `NEW_RETENTION_PERIOD` with the desired retention period in days:
   ```
   aws neptune modify-db-cluster --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER --backup-retention-period NEW_RETENTION_PERIOD
   ```

3. **Verify Backup Retention Settings**:
   Run the following AWS CLI command to verify that the backup retention period has been updated successfully:
   ```
   aws neptune describe-db-cluster --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER
   ```

4. **Enable Automated Backups** (if not already enabled):
   If automated backups are not already enabled for your Neptune DB Cluster, you can enable them using the following AWS CLI command:
   ```
   aws neptune modify-db-cluster --db-cluster-identifier YOUR_DB_CLUSTER_IDENTIFIER --backup-retention-period NEW_RETENTION_PERIOD --backup-restore-window BACKUP_RESTORE_WINDOW --preferred-backup-window PREFERRED_BACKUP_WINDOW --enable-iam-database-authentication
   ```

5. **Monitor Backup Retention**:
   Regularly monitor the backup retention settings for your Neptune DB Cluster to ensure that the configured retention period meets your data protection and compliance requirements.

By following these steps, you can remediate the misconfiguration for Neptune DB Cluster backup retention check in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Neptune DB Cluster not having backup retention check for AWS RDS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Create a Python script with the following code to enable backup retention for your Neptune DB Cluster:

```python
import boto3

# Define the AWS region where your Neptune DB Cluster is located
region = 'your_region'

# Define the name of your Neptune DB Cluster
cluster_identifier = 'your_neptune_cluster_identifier'

# Create a Neptune client
client = boto3.client('neptune', region_name=region)

# Enable backup retention for the Neptune DB Cluster
response = client.modify_db_cluster(
    DBClusterIdentifier=cluster_identifier,
    BackupRetentionPeriod=7  # Specify the number of days to retain backups
)

print("Backup retention enabled for Neptune DB Cluster: {}".format(cluster_identifier))
```

3. Replace `'your_region'` with the AWS region where your Neptune DB Cluster is located and `'your_neptune_cluster_identifier'` with the actual name of your Neptune DB Cluster.

4. Run the Python script. After successful execution, the backup retention period for your Neptune DB Cluster will be set to the specified number of days (in this case, 7 days).

By following these steps, you can remediate the misconfiguration of Neptune DB Cluster not having backup retention check for AWS RDS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

