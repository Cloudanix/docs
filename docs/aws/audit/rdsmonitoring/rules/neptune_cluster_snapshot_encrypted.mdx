---
slug: neptune_cluster_snapshot_encrypted
title: Neptune Clusters Snapshots Should Encrypted
sidebar_label: Neptune Clusters Snapshots Should Encrypted
---
### More Info:

This rule checks if an Amazon Neptune DB cluster has snapshots encrypted. It marks the rule as NON_COMPLIANT if a Neptune cluster does not have snapshots encrypted.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA,GDPR,NIST,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the navigation pane on the left, click on "DB Snapshots". This will display a list of all the DB snapshots.
4. Select the Neptune Cluster snapshot you want to check. In the "Details" section, look for the "Encryption" field. If the field says "Enabled", then the snapshot is encrypted. If it says "Disabled", then the snapshot is not encrypted.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Neptune Clusters: Use the `describe-db-clusters` command to list all the Neptune clusters in your AWS account. The command is as follows:
   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text
   ```
   This command will return a list of all Neptune cluster identifiers.

3. Check the encryption status of each Neptune Cluster: For each Neptune cluster, use the `describe-db-clusters` command again to get the details of the cluster and check the `StorageEncrypted` field. If the `StorageEncrypted` field is `false`, then the Neptune cluster is not encrypted. The command is as follows:
   ```
   aws rds describe-db-clusters --db-cluster-identifier <your-cluster-identifier>
   ```
   Replace `<your-cluster-identifier>` with your actual Neptune cluster identifier.

4. Check the encryption status of each Neptune Cluster Snapshot: For each Neptune cluster, use the `describe-db-cluster-snapshots` command to get the details of the snapshots and check the `StorageEncrypted` field. If the `StorageEncrypted` field is `false`, then the Neptune cluster snapshot is not encrypted. The command is as follows:
   ```
   aws rds describe-db-cluster-snapshots --db-cluster-identifier <your-cluster-identifier>
   ```
   Replace `<your-cluster-identifier>` with your actual Neptune cluster identifier.

#### Using Python

1. Import the necessary AWS SDK for Python (Boto3) modules and establish a session with AWS using your credentials. 

```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

2. Create a client for Amazon RDS and retrieve all the Neptune DB cluster snapshots.

```python
rds = session.client('rds')

try:
    response = rds.describe_db_cluster_snapshots()
except ClientError as e:
    print(f"Unexpected error: {e}")
```

3. Iterate over the list of DB cluster snapshots and check the 'StorageEncrypted' attribute. If it's False, then the snapshot is not encrypted.

```python
for snapshot in response['DBClusterSnapshots']:
    if not snapshot['StorageEncrypted']:
        print(f"DB Cluster Snapshot {snapshot['DBClusterSnapshotIdentifier']} is not encrypted.")
```

4. The above script will print out the identifiers of all the Neptune DB cluster snapshots that are not encrypted. If no such snapshots exist, it will not print anything. 

Remember to replace 'YOUR_ACCESS_KEY' and 'YOUR_SECRET_KEY' with your actual AWS access key and secret key. Also, you may need to adjust the 'region_name' parameter to match the AWS region that you're working in.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Neptune Cluster snapshots not being encrypted in AWS RDS using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to Amazon Neptune Console**: Once logged in, navigate to the Amazon Neptune console by typing "Neptune" in the search bar at the top of the console and selecting "Amazon Neptune" from the dropdown.

3. **Select your Neptune Cluster**: In the Amazon Neptune console, select the Neptune cluster for which you want to enable encryption for snapshots.

4. **Enable Encryption for Snapshots**:
   - Click on the Neptune cluster name to view its details.
   - In the left-hand navigation pane, click on "Snapshots".
   - Select the snapshot for which you want to enable encryption.
   - Click on the "Actions" dropdown menu and select "Modify Snapshot".
   - In the "Modify Snapshot" window, enable the option for "Encrypt snapshot" and select the appropriate KMS key for encryption.
   - Click on "Modify snapshot" to save the changes.

5. **Verify Encryption**:
   - Once the modification is complete, verify that the snapshot is now encrypted by checking the "Encrypted" column in the list of snapshots.

By following these steps, you have successfully remediated the misconfiguration of Neptune Cluster snapshots not being encrypted in AWS RDS using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of Neptune clusters snapshots not being encrypted in AWS RDS using AWS CLI, you can follow these steps:

1. **List all existing Neptune clusters in your AWS account**:
   Run the following AWS CLI command to list all existing Neptune clusters:
   ```
   aws neptune describe-db-clusters
   ```

2. **Enable encryption for Neptune cluster snapshots**:
   For each Neptune cluster that you identified in the previous step, you need to enable encryption for its snapshots. Run the following AWS CLI command for each cluster:
   ```
   aws neptune modify-db-cluster --db-cluster-identifier <cluster-identifier> --storage-encrypted
   ```

   Replace `<cluster-identifier>` with the actual identifier of the Neptune cluster you want to enable encryption for.

3. **Verify encryption status**:
   To verify that encryption has been enabled for the Neptune cluster snapshots, you can describe the cluster again and check the `StorageEncrypted` attribute. Run the following AWS CLI command:
   ```
   aws neptune describe-db-clusters --db-cluster-identifier <cluster-identifier>
   ```

   Replace `<cluster-identifier>` with the identifier of the Neptune cluster you modified.

4. **Repeat for all Neptune clusters**:
   Repeat steps 2 and 3 for each Neptune cluster in your AWS account to ensure that encryption is enabled for all cluster snapshots.

By following these steps, you can remediate the misconfiguration of Neptune clusters snapshots not being encrypted in AWS RDS using AWS CLI.

#### Using Python

To remediate the misconfiguration of Neptune Cluster snapshots not being encrypted in AWS, you can follow these steps using Python and AWS SDK (boto3):

1. Install the AWS SDK (boto3) if you haven't already:
```bash
pip install boto3
```

2. Write a Python script to enable encryption for Neptune Cluster snapshots:
```python
import boto3

def encrypt_neptune_snapshots():
    # Initialize the Neptune client
    client = boto3.client('neptune')

    # Get a list of all Neptune clusters
    clusters = client.describe_db_clusters()

    for cluster in clusters['DBClusters']:
        # Get the ARN of the cluster
        cluster_arn = cluster['DBClusterArn']
        
        # Enable encryption for snapshots of the cluster
        response = client.modify_db_cluster(
            DBClusterIdentifier=cluster_arn,
            BackupRetentionPeriod=7,  # Set the retention period for snapshots
            StorageEncrypted=True  # Enable encryption for snapshots
        )

        print(f"Encryption enabled for Neptune cluster snapshots: {cluster_arn}")

if __name__ == '__main__':
    encrypt_neptune_snapshots()
```

3. Run the Python script to enable encryption for Neptune Cluster snapshots:
```bash
python encrypt_neptune_snapshots.py
```

This script will iterate through all Neptune clusters in your AWS account and enable encryption for their snapshots. Make sure to have the necessary IAM permissions to modify Neptune clusters.



</Tab>
</Tabs>