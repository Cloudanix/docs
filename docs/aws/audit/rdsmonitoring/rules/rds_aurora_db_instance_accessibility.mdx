---
slug: rds_aurora_db_instance_accessibility
title: Accessibility Should Be Well-defined in Aurora Clusters
sidebar_label: Accessibility Should Be Well-defined in Aurora Clusters
---

### More Info:

All the database instances within your Amazon Aurora clusters should have the same accessibility (either public or private) in order to follow AWS best practices.

### Risk Level

Medium

### Address

Reliability, Security

### Compliance Standards

HITRUST, SOC2, NISTCSF, PCIDSS, FedRAMP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent accessibility misconfigurations in Aurora Clusters in Amazon RDS using the AWS Management Console, follow these steps:

1. **Review and Configure Security Groups:**
   - Navigate to the Amazon RDS console.
   - Select the Aurora cluster you want to configure.
   - Under the "Connectivity & security" tab, review the associated security groups.
   - Ensure that the security groups have the appropriate inbound and outbound rules. Limit access to only trusted IP addresses and specific ports (e.g., 3306 for MySQL).

2. **Set Up VPC and Subnet Groups:**
   - Ensure that your Aurora cluster is deployed within a Virtual Private Cloud (VPC).
   - Verify that the subnet groups associated with the cluster are correctly configured to restrict access. Use private subnets for enhanced security.

3. **Enable IAM Database Authentication:**
   - In the "Configuration" tab of your Aurora cluster, enable IAM database authentication.
   - This allows you to manage database access through AWS Identity and Access Management (IAM) roles and policies, providing fine-grained access control.

4. **Configure Parameter Groups:**
   - Go to the "Parameter groups" section in the RDS console.
   - Create or modify a parameter group associated with your Aurora cluster.
   - Ensure that parameters related to security, such as `rds.force_ssl`, are appropriately configured to enforce SSL connections.

By following these steps, you can ensure that the accessibility of your Aurora clusters is well-defined and secure.
</Accordion>

<Accordion title='Using CLI'>
To prevent misconfigurations related to accessibility in Aurora Clusters in Amazon RDS using AWS CLI, you can follow these steps:

1. **Ensure VPC Security Group Configuration:**
   - Make sure that the security groups associated with your Aurora cluster are properly configured to restrict access.
   - Use the following command to describe the security groups and review their rules:
     ```sh
     aws ec2 describe-security-groups --group-ids <security-group-id>
     ```

2. **Modify DB Cluster to Use Specific VPC Security Groups:**
   - If necessary, modify the DB cluster to use specific VPC security groups that have well-defined access rules.
   - Use the following command to modify the DB cluster:
     ```sh
     aws rds modify-db-cluster --db-cluster-identifier <db-cluster-identifier> --vpc-security-group-ids <security-group-id-1> <security-group-id-2>
     ```

3. **Set Publicly Accessible to False:**
   - Ensure that the Aurora cluster is not publicly accessible unless absolutely necessary.
   - Use the following command to modify the DB instance within the cluster to set `PubliclyAccessible` to `false`:
     ```sh
     aws rds modify-db-instance --db-instance-identifier <db-instance-identifier> --publicly-accessible false
     ```

4. **Review and Configure DB Subnet Group:**
   - Ensure that the DB subnet group associated with your Aurora cluster is properly configured to use private subnets.
   - Use the following command to describe the DB subnet group:
     ```sh
     aws rds describe-db-subnet-groups --db-subnet-group-name <db-subnet-group-name>
     ```

By following these steps, you can ensure that the accessibility of your Aurora clusters in RDS is well-defined and secure.
</Accordion>

<Accordion title='Using Python'>
To prevent misconfigurations related to accessibility in Aurora Clusters in Amazon RDS using Python scripts, you can follow these steps:

1. **Install and Configure AWS SDK (Boto3):**
   Ensure you have the AWS SDK for Python (Boto3) installed and configured with the necessary permissions to manage RDS resources.

   ```bash
   pip install boto3
   ```

   Configure your AWS credentials:

   ```bash
   aws configure
   ```

2. **Define a Python Script to Check and Update Aurora Cluster Accessibility:**
   Create a Python script that will check the accessibility settings of your Aurora Clusters and update them if necessary.

   ```python
   import boto3

   # Initialize a session using Amazon RDS
   client = boto3.client('rds')

   def check_and_update_cluster_accessibility(cluster_identifier):
       try:
           # Describe the Aurora Cluster
           response = client.describe_db_clusters(DBClusterIdentifier=cluster_identifier)
           clusters = response['DBClusters']
           
           for cluster in clusters:
               # Check the current accessibility settings
               publicly_accessible = cluster['PubliclyAccessible']
               
               # If the cluster is publicly accessible, update it to be private
               if publicly_accessible:
                   print(f"Cluster {cluster_identifier} is publicly accessible. Updating to private.")
                   client.modify_db_cluster(
                       DBClusterIdentifier=cluster_identifier,
                       PubliclyAccessible=False,
                       ApplyImmediately=True
                   )
                   print(f"Cluster {cluster_identifier} accessibility updated to private.")
               else:
                   print(f"Cluster {cluster_identifier} is already private.")
       except Exception as e:
           print(f"Error checking/updating cluster {cluster_identifier}: {e}")

   # Example usage
   cluster_identifier = 'your-aurora-cluster-identifier'
   check_and_update_cluster_accessibility(cluster_identifier)
   ```

3. **Automate the Script Execution:**
   To ensure continuous compliance, you can automate the execution of this script using AWS Lambda or a scheduled task on your local machine or server.

   For AWS Lambda:
   - Create a Lambda function and upload the script.
   - Set up a CloudWatch Events rule to trigger the Lambda function periodically.

4. **Logging and Monitoring:**
   Implement logging and monitoring to track the changes made by the script. You can use AWS CloudWatch Logs to capture the logs generated by the script.

   ```python
   import logging
   import boto3

   # Configure logging
   logging.basicConfig(level=logging.INFO)
   logger = logging.getLogger()

   # Initialize a session using Amazon RDS
   client = boto3.client('rds')

   def check_and_update_cluster_accessibility(cluster_identifier):
       try:
           # Describe the Aurora Cluster
           response = client.describe_db_clusters(DBClusterIdentifier=cluster_identifier)
           clusters = response['DBClusters']
           
           for cluster in clusters:
               # Check the current accessibility settings
               publicly_accessible = cluster['PubliclyAccessible']
               
               # If the cluster is publicly accessible, update it to be private
               if publicly_accessible:
                   logger.info(f"Cluster {cluster_identifier} is publicly accessible. Updating to private.")
                   client.modify_db_cluster(
                       DBClusterIdentifier=cluster_identifier,
                       PubliclyAccessible=False,
                       ApplyImmediately=True
                   )
                   logger.info(f"Cluster {cluster_identifier} accessibility updated to private.")
               else:
                   logger.info(f"Cluster {cluster_identifier} is already private.")
       except Exception as e:
           logger.error(f"Error checking/updating cluster {cluster_identifier}: {e}")

   # Example usage
   cluster_identifier = 'your-aurora-cluster-identifier'
   check_and_update_cluster_accessibility(cluster_identifier)
   ```

By following these steps, you can ensure that the accessibility of your Aurora Clusters in RDS is well-defined and compliant with your security policies.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the navigation pane, click on "Databases".
4. In the list of database instances, select the Aurora DB cluster that you want to examine.
5. In the details pane, under the "Connectivity & security" tab, check the "Public accessibility" setting. If it is set to "Yes", then the Aurora cluster is publicly accessible, which may be a misconfiguration if the database should not be publicly accessible.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer). The command to install AWS CLI is `pip install awscli`. After installation, you can configure it using `aws configure` command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. **List all RDS Instances**: Use the `describe-db-instances` command to list all your RDS instances. The command is as follows:
   ```
   aws rds describe-db-instances
   ```
   This command will return a JSON output with details of all your RDS instances.

3. **Check Public Accessibility**: In the JSON output, look for the `PubliclyAccessible` attribute for each instance. If the value of this attribute is `true`, then the RDS instance is publicly accessible, which is a misconfiguration. The command to filter out the instances with public accessibility is:
   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier,PubliclyAccessible]' --output text
   ```
   This command will return a list of all RDS instances along with their public accessibility status.

4. **Check for Aurora Clusters**: If you specifically want to check for Aurora clusters, you can use the `describe-db-clusters` command. The command is as follows:
   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier,Engine,PubliclyAccessible]' --output text
   ```
   This command will return a list of all RDS clusters along with their engine type and public accessibility status. Look for clusters with the engine type as 'aurora'.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new RDS client:
```python
import boto3
rds = boto3.client('rds')
```

2. Fetch all the Aurora clusters in your AWS account:
```python
clusters = rds.describe_db_clusters()['DBClusters']
```

3. Iterate over each cluster and check the `PubliclyAccessible` attribute. If it's set to `True`, then the accessibility is not well-defined:
```python
for cluster in clusters:
    if cluster['PubliclyAccessible']:
        print(f"Cluster {cluster['DBClusterIdentifier']} is publicly accessible.")
```

4. To further check the accessibility, you can also check the VPC security groups associated with the cluster. If any security group allows unrestricted inbound or outbound access, then the accessibility is not well-defined:
```python
for cluster in clusters:
    for vpc_security_group in cluster['VpcSecurityGroups']:
        sg_id = vpc_security_group['VpcSecurityGroupId']
        sg = boto3.resource('ec2').SecurityGroup(sg_id)
        for permission in sg.ip_permissions:
            for ip_range in permission['IpRanges']:
                if ip_range['CidrIp'] == '0.0.0.0/0':
                    print(f"Security group {sg_id} associated with cluster {cluster['DBClusterIdentifier']} allows unrestricted inbound access.")
        for permission in sg.ip_permissions_egress:
            for ip_range in permission['IpRanges']:
                if ip_range['CidrIp'] == '0.0.0.0/0':
                    print(f"Security group {sg_id} associated with cluster {cluster['DBClusterIdentifier']} allows unrestricted outbound access.")
```
This script will print out the identifiers of all Aurora clusters that are publicly accessible or associated with a security group that allows unrestricted access.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the accessibility misconfiguration in an Aurora cluster in AWS RDS using the AWS console, follow these steps:

1. **Navigate to the AWS RDS Console:**
   - Go to the AWS Management Console (https://console.aws.amazon.com/).
   - Open the RDS console by selecting "RDS" under the "Database" section.

2. **Select the Aurora Cluster:**
   - In the RDS dashboard, select the Aurora cluster that you want to remediate the accessibility settings for.

3. **Modify the Cluster:**
   - Click on the "Modify" button in the top right corner of the cluster details page.

4. **Update the Accessibility Settings:**
   - Scroll down to the "Network & Security" section of the modify cluster page.
   - Here, you can update the following settings:
     - **VPC Security Group:** Ensure that the appropriate VPC security group is selected to control inbound and outbound traffic to the cluster.
     - **Public Accessibility:** If the cluster needs to be publicly accessible, set the "Publicly Accessible" option to "Yes". Otherwise, set it to "No" for private accessibility.
     - **VPC:** Verify that the cluster is deployed in the correct VPC.

5. **Apply the Changes:**
   - After updating the accessibility settings, scroll to the bottom of the page and click on the "Continue" button.

6. **Review and Apply the Changes:**
   - Review the modifications you have made to the cluster's accessibility settings.
   - Once you are satisfied with the changes, click on the "Modify Cluster" button to apply the new settings.

7. **Monitor the Modification Progress:**
   - The modification process may take some time to complete. You can monitor the progress in the RDS console.

8. **Verify the Accessibility Settings:**
   - Once the modification is complete, verify that the accessibility settings for the Aurora cluster have been updated as intended.

By following these steps, you can remediate the accessibility misconfiguration in an Aurora cluster in AWS RDS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the accessibility misconfiguration in an Aurora cluster in AWS RDS using AWS CLI, follow these steps:

1. **Identify the Misconfigured Aurora Cluster**:
   - Use the AWS CLI command to list all the Aurora clusters in your AWS account:
     ```
     aws rds describe-db-clusters --query "DBClusters[*].[DBClusterIdentifier,Endpoint]" --output table
     ```
   - Identify the Aurora cluster that has accessibility misconfiguration.

2. **Update the Cluster's VPC Security Group**:
   - Use the AWS CLI command to modify the Aurora cluster to specify the correct VPC security group that allows the desired accessibility:
     ```
     aws rds modify-db-cluster --db-cluster-identifier <cluster-identifier> --vpc-security-group-ids <security-group-ids>
     ```
     Replace `<cluster-identifier>` with the identifier of the Aurora cluster and `<security-group-ids>` with the IDs of the VPC security groups that should have access to the cluster.

3. **Verify the Accessibility Changes**:
   - Use the AWS CLI command to describe the Aurora cluster and verify that the VPC security group has been updated successfully:
     ```
     aws rds describe-db-clusters --db-cluster-identifier <cluster-identifier> --query "DBClusters[*].[DBClusterIdentifier,VpcSecurityGroups]" --output table
     ```
     Ensure that the correct VPC security group is now associated with the Aurora cluster.

4. **Test the Accessibility**:
   - Verify that the accessibility to the Aurora cluster is now as desired by connecting to the cluster using a client application or tool.

By following these steps, you can remediate the accessibility misconfiguration in an Aurora cluster in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of undefined accessibility in Aurora clusters in AWS RDS using Python, follow these steps:

Step 1: Import the necessary Python libraries
```python
import boto3
```

Step 2: Define the AWS region and create an RDS client
```python
region = 'your_aws_region'
rds = boto3.client('rds', region_name=region)
```

Step 3: List all the Aurora clusters in the AWS account
```python
response = rds.describe_db_clusters()
clusters = response['DBClusters']
```

Step 4: For each Aurora cluster, check if the `VpcSecurityGroups` parameter is defined
```python
for cluster in clusters:
    cluster_identifier = cluster['DBClusterIdentifier']
    vpc_security_groups = cluster['VpcSecurityGroups']
    
    if not vpc_security_groups:
        # If accessibility is not well-defined, update the cluster's security group
        new_security_group_id = 'your_security_group_id'
        rds.modify_db_cluster(
            DBClusterIdentifier=cluster_identifier,
            VpcSecurityGroupIds=[new_security_group_id]
        )
        print(f"Accessibility is now well-defined for Aurora cluster {cluster_identifier}")
    else:
        print(f"Accessibility is already well-defined for Aurora cluster {cluster_identifier}")
```

Step 5: Replace `'your_aws_region'` with your AWS region and `'your_security_group_id'` with the desired security group ID that allows access to the Aurora cluster.

Step 6: Run the Python script to remediate the misconfiguration of undefined accessibility in Aurora clusters in AWS RDS.

By following these steps, you can remediate the misconfiguration of undefined accessibility in Aurora clusters in AWS RDS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Modifying.html](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Modifying.html) 

