---
slug: aurora_last_backup_recovery_point_created
title: Aurora DB Clusters Should Have Recovery Point
sidebar_label: Aurora DB Clusters Should Have Recovery Point
---
### More Info:

Checks if a recovery point was created for Amazon Aurora DB clusters. The rule is NON_COMPLIANT if the Amazon Relational Database Service (Amazon RDS) DB Cluster does not have a corresponding recovery point.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Aurora DB Clusters from lacking a recovery point in RDS using the AWS Management Console, follow these steps:

1. **Enable Automated Backups:**
   - Navigate to the Amazon RDS console.
   - In the navigation pane, choose "Databases."
   - Select the Aurora DB cluster you want to configure.
   - Choose the "Modify" button.
   - In the "Backup" section, ensure that "Enable automated backups" is selected.
   - Set the "Backup retention period" to a value greater than 0 days.
   - Click "Continue" and then "Modify DB Cluster" to save the changes.

2. **Configure Backup Window:**
   - While still in the "Modify" section of your Aurora DB cluster, scroll down to the "Backup window" section.
   - Specify a preferred backup window that aligns with your maintenance schedule to ensure backups do not interfere with peak usage times.
   - Click "Continue" and then "Modify DB Cluster" to apply the changes.

3. **Enable Multi-AZ Deployment:**
   - In the "Modify" section of your Aurora DB cluster, look for the "Availability & durability" section.
   - Ensure that "Multi-AZ deployment" is enabled to enhance data durability and availability.
   - Click "Continue" and then "Modify DB Cluster" to save the changes.

4. **Monitor Backup Status:**
   - Regularly check the "Events" section in the RDS console to monitor the status of automated backups.
   - Set up Amazon CloudWatch alarms to notify you of any backup failures or issues.

By following these steps, you can ensure that your Aurora DB clusters have a recovery point, thereby enhancing data protection and availability.
</Accordion>

<Accordion title='Using CLI'>
To prevent Aurora DB Clusters from lacking a recovery point in RDS using AWS CLI, you can ensure that automated backups are enabled and configured correctly. Here are the steps to achieve this:

1. **Enable Automated Backups:**
   Ensure that automated backups are enabled for your Aurora DB cluster. This can be done by setting the `BackupRetentionPeriod` parameter to a value greater than 0.

   ```sh
   aws rds modify-db-cluster \
       --db-cluster-identifier <your-db-cluster-identifier> \
       --backup-retention-period <number-of-days> \
       --apply-immediately
   ```

   Replace `<your-db-cluster-identifier>` with your actual DB cluster identifier and `<number-of-days>` with the desired number of days to retain backups (e.g., 7).

2. **Configure Backup Window:**
   Set a preferred backup window to ensure that backups are taken during a period of low database activity.

   ```sh
   aws rds modify-db-cluster \
       --db-cluster-identifier <your-db-cluster-identifier> \
       --preferred-backup-window <hh24:mi-hh24:mi> \
       --apply-immediately
   ```

   Replace `<your-db-cluster-identifier>` with your actual DB cluster identifier and `<hh24:mi-hh24:mi>` with the desired backup window (e.g., `02:00-03:00`).

3. **Enable Copying of Backups to Another Region (Optional but Recommended):**
   To enhance disaster recovery, you can enable copying of automated backups to another AWS region.

   ```sh
   aws rds modify-db-cluster \
       --db-cluster-identifier <your-db-cluster-identifier> \
       --copy-tags-to-snapshot \
       --apply-immediately
   ```

   Replace `<your-db-cluster-identifier>` with your actual DB cluster identifier.

4. **Verify Backup Configuration:**
   Verify that the backup settings are correctly applied to your Aurora DB cluster.

   ```sh
   aws rds describe-db-clusters \
       --db-cluster-identifier <your-db-cluster-identifier>
   ```

   Check the output to ensure that `BackupRetentionPeriod` is set to the desired value and that other backup-related settings are correctly configured.

By following these steps, you can ensure that your Aurora DB clusters have a recovery point in RDS, thereby preventing misconfigurations related to backup and recovery.
</Accordion>

<Accordion title='Using Python'>
To prevent Aurora DB Clusters from lacking a recovery point in RDS using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that your Aurora DB Clusters have automated backups enabled, which will create recovery points:

### Step 1: Install Boto3
Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
```bash
pip install boto3
```

### Step 2: Initialize Boto3 Client
Initialize the Boto3 RDS client to interact with the RDS service.
```python
import boto3

rds_client = boto3.client('rds')
```

### Step 3: Describe Aurora DB Clusters
Fetch the list of Aurora DB clusters to check their backup configurations.
```python
def describe_db_clusters():
    response = rds_client.describe_db_clusters()
    return response['DBClusters']

db_clusters = describe_db_clusters()
```

### Step 4: Ensure Backup Retention Period is Set
Loop through the DB clusters and ensure that the `BackupRetentionPeriod` is set to a value greater than 0.
```python
def ensure_backup_retention(db_clusters):
    for cluster in db_clusters:
        if cluster['Engine'].startswith('aurora'):
            if cluster['BackupRetentionPeriod'] == 0:
                print(f"Cluster {cluster['DBClusterIdentifier']} has no backup retention period set. Updating...")
                rds_client.modify_db_cluster(
                    DBClusterIdentifier=cluster['DBClusterIdentifier'],
                    BackupRetentionPeriod=7  # Set to desired retention period
                )
            else:
                print(f"Cluster {cluster['DBClusterIdentifier']} already has a backup retention period of {cluster['BackupRetentionPeriod']} days.")

ensure_backup_retention(db_clusters)
```

### Full Script
Here is the complete script combining all the steps:
```python
import boto3

# Initialize Boto3 RDS client
rds_client = boto3.client('rds')

# Describe Aurora DB Clusters
def describe_db_clusters():
    response = rds_client.describe_db_clusters()
    return response['DBClusters']

# Ensure Backup Retention Period is Set
def ensure_backup_retention(db_clusters):
    for cluster in db_clusters:
        if cluster['Engine'].startswith('aurora'):
            if cluster['BackupRetentionPeriod'] == 0:
                print(f"Cluster {cluster['DBClusterIdentifier']} has no backup retention period set. Updating...")
                rds_client.modify_db_cluster(
                    DBClusterIdentifier=cluster['DBClusterIdentifier'],
                    BackupRetentionPeriod=7  # Set to desired retention period
                )
            else:
                print(f"Cluster {cluster['DBClusterIdentifier']} already has a backup retention period of {cluster['BackupRetentionPeriod']} days.")

# Main Execution
db_clusters = describe_db_clusters()
ensure_backup_retention(db_clusters)
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Initialize Boto3 Client**: Set up the Boto3 RDS client.
3. **Describe Aurora DB Clusters**: Fetch the list of Aurora DB clusters.
4. **Ensure Backup Retention Period**: Check and set the `BackupRetentionPeriod` for each Aurora DB cluster to ensure recovery points are created.

This script will help you automate the process of ensuring that all your Aurora DB clusters have a backup retention period set, thereby creating recovery points.
</Accordion>
</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the RDS dashboard, select "Databases" from the left-hand side menu. This will display a list of all your DB instances.
4. For each Aurora DB cluster, check the "Latest restorable time" field under the "Details" section. This field indicates the most recent time to which you can restore the DB cluster. If this field is not recent or does not exist, it means the DB cluster does not have a recovery point.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local machine. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List all DB Clusters**: Use the `describe-db-clusters` command to list all the DB clusters in your AWS account. The command is as follows:

    ```
    aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text
    ```

    This command will return a list of all DB cluster identifiers.

3. **Check Recovery Point**: For each DB cluster identifier returned from the previous step, use the `describe-db-cluster-snapshots` command to list all the snapshots of the DB cluster. The command is as follows:

    ```
    aws rds describe-db-cluster-snapshots --db-cluster-identifier <DBClusterIdentifier> --query 'DBClusterSnapshots[*].[SnapshotCreateTime]' --output text
    ```

    Replace `<DBClusterIdentifier>` with the actual DB cluster identifier. This command will return a list of snapshot creation times.

4. **Analyze the Output**: If the `describe-db-cluster-snapshots` command returns no results or the latest snapshot is older than your recovery point objective, then the DB cluster does not have a recovery point. If the command returns at least one snapshot and the latest snapshot is within your recovery point objective, then the DB cluster has a recovery point.
</Accordion>

<Accordion title='Using Python'>
1. **Import Necessary Libraries**: The first step is to import the necessary libraries in your Python script. You will need the `boto3` library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc.

```python
import boto3
```

2. **Create a Session**: The next step is to create a session using your AWS credentials. You can do this by using the `Session` function in the `boto3` library. Replace `'my_access_key'`, `'my_secret_key'`, and `'my_region'` with your actual AWS credentials.

```python
session = boto3.Session(
    aws_access_key_id='my_access_key',
    aws_secret_access_key='my_secret_key',
    region_name='my_region'
)
```

3. **Connect to the RDS Service**: Now that you have a session, you can connect to the RDS service. You can do this by using the `client` function in your session object.

```python
rds = session.client('rds')
```

4. **Check for Recovery Point**: Finally, you can check for the recovery point of your Aurora DB clusters. You can do this by using the `describe_db_clusters` function in your RDS client object. This function returns a list of DB clusters. For each DB cluster, you can check the `EarliestRestorableTime` attribute. If this attribute is not set, then the DB cluster does not have a recovery point.

```python
clusters = rds.describe_db_clusters()
for cluster in clusters['DBClusters']:
    if 'EarliestRestorableTime' not in cluster:
        print(f"DB cluster {cluster['DBClusterIdentifier']} does not have a recovery point.")
```

This script will print out the identifiers of all DB clusters that do not have a recovery point.
</Accordion>
</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Aurora DB Clusters not having a recovery point in AWS RDS using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://console.aws.amazon.com/) and login using your credentials.

2. **Navigate to RDS Dashboard**: Once logged in, navigate to the Amazon RDS console by clicking on the "Services" dropdown in the top left corner and selecting "RDS" under the Database category.

3. **Select Aurora DB Cluster**: From the list of DB instances, select the Aurora DB cluster that you want to configure a recovery point for by clicking on its identifier.

4. **Enable Backtrack**: In the Aurora DB cluster details page, click on the "Modify" button in the top right corner.

5. **Configure Backtrack**: Scroll down to the "Backup" section of the Modify DB Cluster page. Look for the "Backtrack" option and check the box to enable it.

6. **Set Backtrack Window**: Set the backtrack window to the desired number of seconds or minutes. This will determine how far back in time you can backtrack the cluster.

7. **Review and Apply Changes**: Review the other configuration settings to ensure they are correct. Once you have configured the backtrack settings, click on the "Continue" button.

8. **Apply Changes**: On the next page, review the summary of changes and click on the "Modify DB Cluster" button to apply the changes.

9. **Monitor Progress**: The modification process will start, and you can monitor the progress on the RDS dashboard. Once the modification is complete, the Aurora DB cluster will have a recovery point enabled.

By following these steps, you can successfully remediate the misconfiguration of Aurora DB Clusters not having a recovery point in AWS RDS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Aurora DB clusters not having a recovery point in AWS RDS using AWS CLI, you can follow these steps:

1. **Create a DB Cluster Snapshot:**
   - Use the following AWS CLI command to create a manual snapshot of your Aurora DB cluster:
     ```
     aws rds create-db-cluster-snapshot --db-cluster-identifier <your-db-cluster-identifier> --db-cluster-snapshot-identifier <your-snapshot-name>
     ```
   - Replace `<your-db-cluster-identifier>` with the identifier of your Aurora DB cluster and `<your-snapshot-name>` with the name you want to give to the snapshot.

2. **Enable Automated Backups:**
   - To ensure that automated backups are enabled for your Aurora DB cluster, use the following AWS CLI command:
     ```
     aws rds modify-db-cluster --db-cluster-identifier <your-db-cluster-identifier> --backup-retention-period <retention-period-in-days>
     ```
   - Replace `<your-db-cluster-identifier>` with the identifier of your Aurora DB cluster and `<retention-period-in-days>` with the number of days you want to retain automated backups.

3. **Verify Backup Configuration:**
   - Confirm that automated backups are enabled and the backup retention period is set correctly by running the following AWS CLI command:
     ```
     aws rds describe-db-clusters --db-cluster-identifier <your-db-cluster-identifier> --query "DBClusters[*].{DBClusterIdentifier:DBClusterIdentifier, BackupRetentionPeriod:BackupRetentionPeriod, BackupWindow:PreferredBackupWindow, BackupRetentionPeriod:BackupRetentionPeriod}"
     ```
   - This command will display the backup configuration details of your Aurora DB cluster.

By following these steps and ensuring that you have created a manual snapshot, enabled automated backups, and verified the backup configuration, you can remediate the misconfiguration of Aurora DB clusters not having a recovery point in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Aurora DB clusters not having a recovery point in AWS RDS using Python, you can follow these steps:

1. **Install Boto3**: Ensure that you have the Boto3 library installed in your Python environment. Boto3 is the AWS SDK for Python, which allows you to interact with AWS services.

```bash
pip install boto3
```

2. **Create a Python script**: Create a Python script with the following code to enable point-in-time recovery for your Aurora DB clusters.

```python
import boto3

# Specify the AWS region where your Aurora DB cluster is located
region = 'your_aws_region'

# Specify the name of your Aurora DB cluster
db_cluster_identifier = 'your_db_cluster_identifier'

# Create a Boto3 RDS client
client = boto3.client('rds', region_name=region)

# Enable point-in-time recovery for the Aurora DB cluster
response = client.modify_db_cluster(
    DBClusterIdentifier=db_cluster_identifier,
    BackupRetentionPeriod=7,  # Specify the number of days to retain automated backups
    PreferredBackupWindow='04:00-04:30'  # Specify the preferred backup window
)

print("Point-in-time recovery enabled for Aurora DB cluster")
```

3. **Replace placeholders**: Replace `your_aws_region` with the AWS region where your Aurora DB cluster is located and `your_db_cluster_identifier` with the name of your Aurora DB cluster.

4. **Run the script**: Execute the Python script in your environment. This will enable point-in-time recovery for your Aurora DB cluster, ensuring that recovery points are available for data restoration.

By following these steps and running the Python script, you can remediate the misconfiguration of Aurora DB clusters not having a recovery point in AWS RDS.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

