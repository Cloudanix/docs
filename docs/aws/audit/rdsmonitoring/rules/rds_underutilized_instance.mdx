---
slug: rds_underutilized_instance
title: RDS Instances Should Not Be Underutilized
sidebar_label: RDS Instances Should Not Be Underutilized
---

### More Info:

Identify any Amazon RDS database instances that appear to be underutilized and downsize (resize) them to help lower the cost of your monthly AWS bill

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Login to AWS Management Console: First, you need to log in to your AWS Management Console. Make sure you have the necessary permissions to access the RDS dashboard.

2. Navigate to RDS Dashboard: Once you are logged in, navigate to the RDS service from the list of services provided by AWS. This will take you to the RDS dashboard where you can see all your RDS instances.

3. Check RDS Instances: In the RDS dashboard, you will see a list of all your RDS instances. Click on the instance that you want to check for underutilization. This will take you to the instance details page.

4. Check Utilization Metrics: In the instance details page, navigate to the "Monitoring" tab. Here, you can see various metrics related to the utilization of your RDS instance. Check the "CPU Utilization" and "Freeable Memory" metrics. If the CPU Utilization is consistently low (less than 20%) and the Freeable Memory is high, it indicates that the RDS instance is underutilized.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI:** Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer) with the command `pip install awscli`. After installation, you can configure it using `aws configure` command and provide your AWS credentials (Access Key ID, Secret Access Key, Default region name, Default output format).

2. **List all RDS Instances:** Use the AWS CLI command `aws rds describe-db-instances` to list all the RDS instances. This command will return a JSON output with the details of all RDS instances.

    ```
    aws rds describe-db-instances
    ```

3. **Check CPU Utilization:** For each RDS instance, you can check the CPU utilization using the `aws cloudwatch get-metric-statistics` command. You need to provide the namespace as 'AWS/RDS', the metric name as 'CPUUtilization', the start and end time for the period you want to check, the period in seconds (for example, 3600 for one hour), the statistics as 'Average', and the dimensions as the DB instance identifier.

    ```
    aws cloudwatch get-metric-statistics --namespace AWS/RDS --metric-name CPUUtilization --start-time 2021-01-01T00:00:00 --end-time 2021-01-01T01:00:00 --period 3600 --statistics Average --dimensions Name=DBInstanceIdentifier,Value=mydbinstance
    ```

4. **Analyze the Output:** The command will return a JSON output with the average CPU utilization for the specified period. If the CPU utilization is consistently low (for example, less than 20%), the RDS instance may be underutilized. You can automate this process using a Python script that iterates over all RDS instances and checks their CPU utilization.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   First, you need to install Boto3. You can do this by running the command `pip install boto3`. After installing Boto3, you need to configure it. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. Import necessary libraries and establish a session:
   In your Python script, you need to import the necessary libraries and establish a session with AWS. Here is an example:

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. Connect to the RDS service and retrieve all RDS instances:
   Next, you need to connect to the RDS service and retrieve all RDS instances. Here is an example:

   ```python
   rds = session.client('rds')

   response = rds.describe_db_instances()

   for instance in response['DBInstances']:
       print(instance['DBInstanceIdentifier'])
   ```

4. Check the utilization of each RDS instance:
   Finally, you need to check the utilization of each RDS instance. You can do this by using the CloudWatch service to retrieve the CPUUtilization metric for each instance. Here is an example:

   ```python
   cloudwatch = session.client('cloudwatch')

   for instance in response['DBInstances']:
       metrics = cloudwatch.get_metric_statistics(
           Namespace='AWS/RDS',
           MetricName='CPUUtilization',
           Dimensions=[
               {
                   'Name': 'DBInstanceIdentifier',
                   'Value': instance['DBInstanceIdentifier']
               },
           ],
           StartTime=datetime.datetime.utcnow() - datetime.timedelta(seconds=600),
           EndTime=datetime.datetime.utcnow(),
           Period=60,
           Statistics=['Average']
       )

       if metrics['Datapoints']:
           avg_cpu_utilization = metrics['Datapoints'][0]['Average']
           if avg_cpu_utilization < 20:  # or any threshold you consider underutilization
               print(f"RDS instance {instance['DBInstanceIdentifier']} is underutilized with average CPU utilization of {avg_cpu_utilization}%")
   ```
   
This script will print out the identifiers of all RDS instances that are underutilized, i.e., their average CPU utilization over the last 10 minutes is less than 20%. You can adjust the threshold and the time period as needed.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of underutilized RDS instances in AWS, follow these steps using the AWS Management Console:

1. **Identify Underutilized RDS Instances**:
   - Navigate to the AWS Management Console and open the Amazon RDS console.
   - Click on "Databases" from the left-hand menu to view all your RDS instances.
   - Look for instances with low CPU utilization, low memory usage, or low storage usage compared to their allocated resources.

2. **Modify Instance Type**:
   - Select the underutilized RDS instance that you want to remediate.
   - Click on the "Modify" button at the top to change the instance type.
   - Choose a more appropriate instance type based on the workload requirements and expected usage patterns.
   - Click on "Apply immediately" to apply the changes.

3. **Enable Auto Scaling**:
   - In the RDS console, select the RDS instance that you want to enable Auto Scaling for.
   - Click on the "Modify" button to make changes to the instance.
   - Scroll down to the "Auto Scaling" section and click on "Enable Auto Scaling".
   - Configure the minimum and maximum values for CPU utilization that should trigger scaling actions.
   - Click on "Apply immediately" to save the changes.

4. **Implement Performance Insights**:
   - Performance Insights helps you identify performance issues and underutilized resources in your RDS instance.
   - In the RDS console, select the instance you want to monitor.
   - Click on the "Modify" button and scroll down to the "Enable Performance Insights" section.
   - Enable Performance Insights and set the data retention period.
   - Click on "Apply immediately" to save the changes.

5. **Monitor and Optimize**:
   - Regularly monitor the performance metrics of your RDS instances using CloudWatch or Performance Insights.
   - Adjust the instance type, storage, and other configurations based on the actual workload requirements.
   - Consider implementing RDS Proxy for connection pooling and better resource utilization.

By following these steps, you can remediate the issue of underutilized RDS instances in AWS and optimize your resources for better performance and cost-efficiency.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of underutilized RDS instances in AWS using AWS CLI, you can follow these steps:

1. **Identify Underutilized RDS Instances**:
   - Use the AWS CLI command `describe-db-instances` to get information about all your RDS instances.
   - Look for instances with low CPU utilization, low memory utilization, or high idle time.

2. **Modify RDS Instance**:
   - Use the AWS CLI command `modify-db-instance` to resize the instance to a more appropriate size based on your workload requirements.
   - Increase the instance size to utilize more CPU and memory resources if the current instance is underutilized.

3. **Enable Auto Scaling**:
   - Configure Auto Scaling for your RDS instances to automatically adjust the instance size based on the workload.
   - Use the AWS CLI command `modify-db-instance` with the `--enable-auto-scaling` parameter to enable Auto Scaling for the RDS instance.

4. **Monitor and Optimize**:
   - Regularly monitor the performance metrics of your RDS instances using CloudWatch.
   - Optimize the database configuration, queries, and indexes to improve performance and resource utilization.

5. **Implement Cost Optimization**:
   - Consider Reserved Instances or Savings Plans to reduce costs for your RDS instances.
   - Use the AWS CLI command `purchase-reserved-db-instances-offering` to purchase Reserved Instances for your RDS instances.

By following these steps, you can remediate the issue of underutilized RDS instances in AWS and ensure efficient resource utilization and cost optimization.
</Accordion>

<Accordion title='Using Python'>
To remediate underutilized RDS instances in AWS using Python, you can automate the process by creating a Lambda function that checks the CPU utilization of the RDS instances and modifies the instance class if the utilization is consistently low. Here's a step-by-step guide on how to achieve this:

1. **Setting Up AWS Lambda Function:**
   - Create a new Lambda function in the AWS Management Console.
   - Choose Python as the runtime for your function.

2. **IAM Role for Lambda Function:**
   - Create a new IAM role with the necessary permissions to describe RDS instances and modify them.
   - Attach the IAM role to the Lambda function.

3. **Code for Lambda Function:**
   - Write Python code in the Lambda function to describe RDS instances and check their CPU utilization.
   - If the CPU utilization is consistently low, modify the instance class using the modify_db_instance API.

   ```python
   import boto3

   def lambda_handler(event, context):
       rds = boto3.client('rds')
       db_instances = rds.describe_db_instances()

       for instance in db_instances['DBInstances']:
           if instance['DBInstanceClass'] == 'db.t2.micro' and instance['DBInstanceStatus'] == 'available':
               # Check CPU utilization using CloudWatch metrics
               # Modify the instance class if CPU utilization is consistently low
               rds.modify_db_instance(DBInstanceIdentifier=instance['DBInstanceIdentifier'], DBInstanceClass='db.t2.small')
   ```

4. **CloudWatch Alarms:**
   - Set up CloudWatch alarms to monitor the CPU utilization of RDS instances.
   - Trigger the Lambda function when the utilization is consistently low.

5. **Testing and Monitoring:**
   - Test the Lambda function to ensure it correctly identifies and modifies underutilized RDS instances.
   - Monitor the performance of RDS instances after modification to verify the effectiveness of the remediation.

By following these steps, you can automate the remediation of underutilized RDS instances in AWS using Python and Lambda functions.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/whitepapers/latest/cost-optimization-right-sizing/tips-for-right-sizing-your-workloads.html](https://docs.aws.amazon.com/whitepapers/latest/cost-optimization-right-sizing/tips-for-right-sizing-your-workloads.html) 

