---
slug: rds_instance_deletion_protection
title: Instance Deletion Protection Should Be Enabled
sidebar_label: Instance Deletion Protection Should Be Enabled
---

### More Info:

Amazon RDS provides a Deletion Protection Flag which should be enabled to prevent accidental prevention of the database.

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

NIST


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having Instance Deletion Protection enabled in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to RDS Dashboard:**
   - Open the AWS Management Console.
   - In the search bar, type "RDS" and select "RDS" from the dropdown to go to the Amazon RDS Dashboard.

2. **Select the DB Instance:**
   - In the RDS Dashboard, click on "Databases" in the left-hand menu.
   - From the list of DB instances, select the DB instance for which you want to enable deletion protection.

3. **Modify the DB Instance:**
   - With the DB instance selected, click on the "Modify" button located at the top right of the instance details page.

4. **Enable Deletion Protection:**
   - In the "Modify DB Instance" page, scroll down to the "Deletion protection" section.
   - Check the box next to "Enable deletion protection."
   - Scroll to the bottom of the page and click the "Continue" button, then review the changes and click "Modify DB Instance" to apply the changes.

By following these steps, you ensure that deletion protection is enabled for your RDS instance, preventing accidental deletion.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of not having Instance Deletion Protection enabled in Amazon RDS using the AWS CLI, follow these steps:

1. **Describe the RDS Instances**:
   First, identify the RDS instances for which you want to enable deletion protection.
   ```sh
   aws rds describe-db-instances
   ```

2. **Modify the RDS Instance**:
   Use the `modify-db-instance` command to enable deletion protection for a specific RDS instance. Replace `<db-instance-identifier>` with your actual DB instance identifier.
   ```sh
   aws rds modify-db-instance --db-instance-identifier <db-instance-identifier> --deletion-protection
   ```

3. **Verify the Configuration**:
   Confirm that deletion protection has been enabled by describing the RDS instance again.
   ```sh
   aws rds describe-db-instances --db-instance-identifier <db-instance-identifier>
   ```

4. **Automate for Multiple Instances**:
   If you have multiple RDS instances, you can use a loop to enable deletion protection for all of them. Here is an example using a shell script:
   ```sh
   for instance in $(aws rds describe-db-instances --query 'DBInstances[*].DBInstanceIdentifier' --output text); do
       aws rds modify-db-instance --db-instance-identifier $instance --deletion-protection
   done
   ```

By following these steps, you can ensure that deletion protection is enabled for your RDS instances using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not having Instance Deletion Protection enabled in Amazon RDS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Below are the steps to ensure that Deletion Protection is enabled for your RDS instances:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.
   ```bash
   aws configure
   ```

3. **Python Script to Enable Deletion Protection**:
   Use the following Python script to enable Deletion Protection for your RDS instances.

   ```python
   import boto3

   # Initialize a session using Amazon RDS
   client = boto3.client('rds')

   # List all RDS instances
   response = client.describe_db_instances()

   # Iterate over each instance
   for db_instance in response['DBInstances']:
       db_instance_identifier = db_instance['DBInstanceIdentifier']
       
       # Check if Deletion Protection is enabled
       if not db_instance['DeletionProtection']:
           print(f"Enabling Deletion Protection for instance: {db_instance_identifier}")
           
           # Enable Deletion Protection
           client.modify_db_instance(
               DBInstanceIdentifier=db_instance_identifier,
               DeletionProtection=True
           )
       else:
           print(f"Deletion Protection is already enabled for instance: {db_instance_identifier}")

   print("Deletion Protection has been enabled for all applicable RDS instances.")
   ```

4. **Run the Script**:
   Execute the script in your Python environment to ensure that Deletion Protection is enabled for all your RDS instances.

   ```bash
   python enable_rds_deletion_protection.py
   ```

By following these steps, you can ensure that Deletion Protection is enabled for your RDS instances, thereby preventing accidental deletion.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Databases".

3. Choose the name of the DB instance that you want to check.

4. In the "Details" section, look for the "Deletion protection" field. If the field is set to "Yes", then the deletion protection is enabled. If the field is set to "No", then the deletion protection is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the RDS instances.

2. Once the AWS CLI is installed and configured, you can list all the RDS instances in your account by running the following command:

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier]' --output text
   ```

   This command will return a list of all RDS instance identifiers.

3. For each RDS instance identifier, you can check if deletion protection is enabled by running the following command:

   ```
   aws rds describe-db-instances --db-instance-identifier <DBInstanceIdentifier> --query 'DBInstances[*].[DeletionProtection]' --output text
   ```

   Replace `<DBInstanceIdentifier>` with the actual RDS instance identifier. This command will return `true` if deletion protection is enabled, and `false` otherwise.

4. Repeat step 3 for each RDS instance identifier. If any instance returns `false`, it means that instance deletion protection is not enabled for that instance.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new RDS client:

```python
import boto3
rds = boto3.client('rds')
```

2. Fetch all the RDS instances in your AWS account:

```python
response = rds.describe_db_instances()
```

3. Iterate over each RDS instance and check if the `DeletionProtection` attribute is set to `True`. If it's not, print a message indicating that the instance does not have deletion protection enabled:

```python
for instance in response['DBInstances']:
    if not instance['DeletionProtection']:
        print(f"RDS instance {instance['DBInstanceIdentifier']} does not have deletion protection enabled.")
```

4. The above script will provide you with a list of all RDS instances that do not have deletion protection enabled. This is a misconfiguration as it could lead to accidental deletion of important databases. 

Remember to replace `'rds'` with the appropriate AWS region code if necessary. Also, ensure that your AWS credentials are correctly configured on the machine where you're running this script. You can do this by setting the `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and `AWS_SESSION_TOKEN` environment variables, or by using the AWS CLI's `aws configure` command.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of "Instance Deletion Protection Should Be Enabled" for an AWS RDS instance using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the RDS Console**: Click on the "Services" dropdown menu at the top of the page, then select "RDS" under the Database category.

3. **Select the RDS Instance**: From the list of RDS instances, select the instance for which you want to enable deletion protection by clicking on its identifier.

4. **Enable Deletion Protection**:
   - In the RDS instance details page, click on the "Modify" button located in the top right corner.

   - Scroll down to the "Backup" section of the Modify DB Instance page.

   - Find the "Deletion protection" option and check the box next to it to enable deletion protection for the RDS instance.

5. **Apply Changes**: Scroll down to the bottom of the Modify DB Instance page and click on the "Continue" button.

6. **Review and Apply Changes**: Review the changes you are about to make, and if everything looks correct, click on the "Modify DB Instance" button to apply the changes.

7. **Verify Deletion Protection**: Once the modification is complete, go back to the list of RDS instances, select the instance you modified, and verify that deletion protection is enabled by checking the instance details.

By following these steps, you will successfully enable deletion protection for the AWS RDS instance, thereby remedying the misconfiguration of "Instance Deletion Protection Should Be Enabled".

#
</Accordion>

<Accordion title='Using CLI'>
To enable instance deletion protection for an AWS RDS instance using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable deletion protection for the RDS instance:
   
```bash
aws rds modify-db-instance --db-instance-identifier your-db-instance-name --no-deletion-protection
```

Replace `your-db-instance-name` with the actual name of your RDS instance.

2. Verify that the deletion protection has been enabled for the RDS instance by running the following command:

```bash
aws rds describe-db-instances --db-instance-identifier your-db-instance-name --query 'DBInstances[*].[DBInstanceIdentifier,DeletionProtection]'
```

This command will return the information about the specified RDS instance, including the status of deletion protection.

By following these steps, you can successfully enable instance deletion protection for an AWS RDS instance using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Instance Deletion Protection not being enabled for an AWS RDS instance using Python, you can use the AWS SDK for Python (Boto3). Follow these steps:

1. Install Boto3: If you haven't already installed the Boto3 library, you can do so using pip:
   ```
   pip install boto3
   ```

2. Configure AWS Credentials: Make sure you have configured your AWS credentials either by setting environment variables or using the AWS CLI `aws configure` command.

3. Write Python script: Create a Python script with the following code to enable Instance Deletion Protection for an AWS RDS instance:

   ```python
   import boto3

   # Define the AWS region and the RDS instance identifier
   region = 'your_aws_region'
   rds_instance_identifier = 'your_rds_instance_identifier'

   # Create a RDS client
   rds_client = boto3.client('rds', region_name=region)

   # Enable Instance Deletion Protection for the RDS instance
   try:
       response = rds_client.modify_db_instance(
           DBInstanceIdentifier=rds_instance_identifier,
           DeletionProtection=True
       )
       print(f"Instance Deletion Protection enabled for RDS instance {rds_instance_identifier}")
   except Exception as e:
       print(f"Error enabling Instance Deletion Protection: {str(e)}")
   ```

4. Replace `your_aws_region` and `your_rds_instance_identifier` with the appropriate values for your AWS environment.

5. Run the Python script: Execute the Python script to enable Instance Deletion Protection for the specified AWS RDS instance.

By following these steps and running the Python script, you will be able to remediate the misconfiguration of Instance Deletion Protection not being enabled for an AWS RDS instance.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/](https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/) 

