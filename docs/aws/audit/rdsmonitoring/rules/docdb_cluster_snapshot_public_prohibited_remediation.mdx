

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Snapshots". This will display a list of all the snapshots that have been created for your AWS account.

3. Select the snapshot that you want to check. In the "Snapshot Details" section, look for the "Public" attribute. If the value of this attribute is "Yes", then the snapshot is publicly accessible.

4. To check all snapshots, repeat the process for each snapshot in your account. If any snapshot has the "Public" attribute set to "Yes", it means that the DocumentDB Cluster snapshot is public.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all DocumentDB Clusters: Use the `describe-db-clusters` command to list all the DocumentDB clusters in your AWS account. The command is as follows:

   ```
   aws docdb describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text
   ```
   This command will return a list of all DocumentDB cluster identifiers.

3. Check the PubliclyAccessible attribute: For each DocumentDB cluster, check the `PubliclyAccessible` attribute. If the attribute is set to true, the DocumentDB cluster snapshot is public. Use the following command:

   ```
   aws docdb describe-db-clusters --db-cluster-identifier <DBClusterIdentifier> --query 'DBClusters[*].[DBClusterIdentifier,PubliclyAccessible]' --output text
   ```
   Replace `<DBClusterIdentifier>` with the identifier of the DocumentDB cluster you want to check. This command will return the identifier of the DocumentDB cluster and the value of the `PubliclyAccessible` attribute.

4. Repeat the process: Repeat step 3 for each DocumentDB cluster in your AWS account. If any of the clusters have the `PubliclyAccessible` attribute set to true, they are misconfigured and the snapshots are public.

#### Using Python

To check if DocumentDB Cluster Snapshots are public in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Import the necessary libraries and establish a session with AWS:**

```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-1' # or your preferred region
)
```

2. **Create a client for RDS and get the list of DB snapshots:**

```python
# Create a low-level service client by name using the session
rds = session.client('rds')

try:
    # Call RDS to list available DB snapshots in your account
    response = rds.describe_db_cluster_snapshots()
except ClientError as e:
    print(f"Unexpected error: {e}")
```

3. **Iterate over the snapshots and check their attributes:**

```python
# Iterate over DB snapshots
for snapshot in response['DBClusterSnapshots']:
    # Check if the snapshot is public
    if 'Public' in snapshot['Attributes'] and snapshot['Attributes']['Public'] == 'true':
        print(f"Snapshot {snapshot['DBClusterSnapshotIdentifier']} is public")
```

4. **Handle exceptions:**

```python
# Handle any errors that occurred while trying to execute your commands
except BotoCoreError as e:
    print(f"Error: {e}")
```

This script will print out the identifiers of all public DocumentDB Cluster Snapshots. If no such snapshots exist, it will not print anything.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of DocumentDB Cluster Snapshots being public in AWS RDS using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in with your credentials.

2. **Navigate to DocumentDB Service**: Click on the "Services" dropdown menu at the top left corner of the console, then select "DocumentDB" under the Database category.

3. **Select DocumentDB Cluster**: From the DocumentDB dashboard, select the DocumentDB cluster for which you want to remediate the public snapshot issue.

4. **Modify Snapshot Settings**:
   - In the left-hand navigation pane, click on "Snapshots" to view the list of snapshots associated with the selected cluster.
   - Identify the public snapshot(s) that need to be remediated.
   - Select the public snapshot by clicking on the checkbox next to it.

5. **Update Snapshot Permissions**:
   - Click on the "Actions" dropdown menu above the list of snapshots.
   - Select "Modify Snapshot Attribute" from the dropdown menu.
   - In the Modify Snapshot Attribute window, uncheck the option for "Public" to make the snapshot private.
   - Click on the "Modify Snapshot Attribute" button to save the changes.

6. **Verify Changes**:
   - Once the modification is complete, verify that the snapshot is no longer public by checking the snapshot permissions.
   - You can also try accessing the snapshot URL to confirm that it is no longer accessible publicly.

7. **Repeat for Other Public Snapshots**: If there are multiple public snapshots across different clusters, repeat the above steps for each affected snapshot to ensure all snapshots are private.

By following these steps, you can remediate the issue of DocumentDB Cluster Snapshots being public in AWS RDS using the AWS Management Console.

#### Using CLI

To remediate the issue of DocumentDB Cluster Snapshots being public in AWS RDS, you can follow these steps using the AWS CLI:

Step 1: List all the DocumentDB Cluster Snapshots
```bash
aws rds describe-db-cluster-snapshots --query 'DBClusterSnapshots[*].[DBClusterSnapshotIdentifier]' --output text
```

Step 2: Modify the permissions of the DocumentDB Cluster Snapshots to make them private
```bash
aws rds modify-db-cluster-snapshot-attribute --db-cluster-snapshot-identifier <snapshot-identifier> --attribute-name restore --values-to-add all
```

Replace `<snapshot-identifier>` with the identifier of the DocumentDB Cluster Snapshot you want to modify.

Step 3: Verify that the permissions have been modified successfully
```bash
aws rds describe-db-cluster-snapshot-attributes --db-cluster-snapshot-identifier <snapshot-identifier>
```

Repeat steps 2 and 3 for each DocumentDB Cluster Snapshot that needs to be remediated.

By following these steps, you can ensure that your DocumentDB Cluster Snapshots are no longer public and have the appropriate permissions set to maintain the security of your AWS RDS resources.

#### Using Python

To remediate the issue of DocumentDB cluster snapshots being public in AWS RDS using Python, you can follow these steps:

1. **Identify the Public Snapshots**: Use the AWS SDK for Python (Boto3) to list all the DocumentDB cluster snapshots in your account and identify which snapshots are public.

2. **Modify Snapshot Permissions**: For each public snapshot identified, modify the permissions to make them private. You can do this by removing the "all" permission grants and adding specific AWS account IDs or IAM roles that should have access to the snapshots.

Here is a sample Python script to help you achieve this:

```python
import boto3

def remediate_public_snapshots():
    client = boto3.client('rds')

    # List all DocumentDB cluster snapshots
    response = client.describe_db_cluster_snapshots()

    for snapshot in response['DBClusterSnapshots']:
        snapshot_identifier = snapshot['DBClusterSnapshotIdentifier']
        snapshot_arn = snapshot['DBClusterSnapshotArn']
        
        # Check if the snapshot is public
        if snapshot['PubliclyAccessible']:
            print(f"Snapshot {snapshot_identifier} is public. Modifying permissions...")
            
            # Revoke public access
            response = client.modify_db_cluster_snapshot_attribute(
                DBClusterSnapshotIdentifier=snapshot_identifier,
                AttributeName='restore',
                ValuesToRemove=['all']
            )
            
            print(f"Snapshot {snapshot_identifier} permissions updated.")
        else:
            print(f"Snapshot {snapshot_identifier} is private.")

if __name__ == '__main__':
    remediate_public_snapshots()
```

Make sure to install the `boto3` library by running `pip install boto3` before executing the script.

This script will identify all public DocumentDB cluster snapshots and modify their permissions to make them private. Make sure to run this script with appropriate AWS credentials and permissions to modify the snapshot attributes.


</Tab>
</Tabs>