---
slug: docdb_cluster_deletion_protection_enabled
title: DocumentDB Cluster Should Have Deletion Protection Enabled
sidebar_label: DocumentDB Cluster Should Have Deletion Protection Enabled
---
### More Info:

Checks if an Amazon DocumentDB (with MongoDB compatibility) cluster has deletion protection enabled. The rule is NON_COMPLIANT if an Amazon DocumentDB cluster has the deletionProtection field set to false.

### Risk Level

High

### Address

Configuration

### Compliance Standards

NIST,CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having Deletion Protection enabled for a DocumentDB Cluster in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to the Amazon RDS Console:**
   - Open the AWS Management Console.
   - In the search bar, type "RDS" and select "RDS" from the dropdown.

2. **Select the DocumentDB Cluster:**
   - In the RDS dashboard, click on "Clusters" in the left-hand navigation pane.
   - Locate and select the DocumentDB cluster you want to configure.

3. **Modify the Cluster:**
   - With the cluster selected, click on the "Modify" button at the top of the page.

4. **Enable Deletion Protection:**
   - Scroll down to the "Deletion protection" section.
   - Check the box next to "Enable deletion protection."
   - Click the "Continue" button, review the changes, and then click "Modify cluster" to apply the changes.

By following these steps, you ensure that Deletion Protection is enabled for your DocumentDB cluster, preventing accidental deletion.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of not having Deletion Protection enabled for a DocumentDB cluster in Amazon RDS using AWS CLI, follow these steps:

1. **Create a DocumentDB Cluster with Deletion Protection Enabled:**
   When creating a new DocumentDB cluster, you can enable deletion protection by using the `create-db-cluster` command with the `--deletion-protection` parameter set to `true`.

   ```sh
   aws rds create-db-cluster \
       --db-cluster-identifier my-docdb-cluster \
       --engine docdb \
       --master-username myusername \
       --master-user-password mypassword \
       --deletion-protection
   ```

2. **Modify an Existing DocumentDB Cluster to Enable Deletion Protection:**
   If you have an existing DocumentDB cluster, you can modify it to enable deletion protection using the `modify-db-cluster` command with the `--deletion-protection` parameter set to `true`.

   ```sh
   aws rds modify-db-cluster \
       --db-cluster-identifier my-docdb-cluster \
       --deletion-protection \
       --apply-immediately
   ```

3. **Verify Deletion Protection Status:**
   To ensure that deletion protection is enabled, you can describe the cluster and check the `DeletionProtection` attribute using the `describe-db-clusters` command.

   ```sh
   aws rds describe-db-clusters \
       --db-cluster-identifier my-docdb-cluster \
       --query 'DBClusters[0].DeletionProtection'
   ```

4. **Automate Deletion Protection for New Clusters:**
   To ensure that all new DocumentDB clusters have deletion protection enabled by default, you can create a script or use AWS Config rules to enforce this policy. Here is an example of a simple script to create a cluster with deletion protection:

   ```sh
   #!/bin/bash
   CLUSTER_IDENTIFIER=$1
   USERNAME=$2
   PASSWORD=$3

   aws rds create-db-cluster \
       --db-cluster-identifier $CLUSTER_IDENTIFIER \
       --engine docdb \
       --master-username $USERNAME \
       --master-user-password $PASSWORD \
       --deletion-protection
   ```

   Save this script as `create_docdb_cluster.sh` and run it with the necessary parameters.

By following these steps, you can ensure that your DocumentDB clusters in Amazon RDS have deletion protection enabled, preventing accidental deletion.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not having Deletion Protection enabled for a DocumentDB cluster in Amazon RDS using Python scripts, you can follow these steps:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed, which is the AWS SDK for Python. You can install it using pip if you haven't already.

   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

   ```bash
   aws configure
   ```

3. **Create a Python Script to Enable Deletion Protection**:
   Write a Python script that will enable Deletion Protection for your DocumentDB cluster. Below is an example script:

   ```python
   import boto3

   # Initialize a session using Amazon DocumentDB
   client = boto3.client('rds')

   # Specify the DocumentDB cluster identifier
   cluster_identifier = 'your-cluster-identifier'

   try:
       # Enable Deletion Protection
       response = client.modify_db_cluster(
           DBClusterIdentifier=cluster_identifier,
           DeletionProtection=True
       )
       print(f"Deletion Protection enabled for cluster: {cluster_identifier}")
   except Exception as e:
       print(f"Error enabling Deletion Protection: {e}")
   ```

4. **Run the Script**:
   Execute the script to enable Deletion Protection for your DocumentDB cluster.

   ```bash
   python enable_deletion_protection.py
   ```

By following these steps, you can ensure that Deletion Protection is enabled for your DocumentDB cluster, thereby preventing accidental deletion.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu, then selecting "RDS" under the "Database" category.
3. In the navigation pane on the left, click on "Databases".
4. Select the DocumentDB cluster that you want to check. This will open the details page for the selected cluster.
5. In the "Details" section, look for the "Deletion protection" field. If the value is "Disabled", then the DocumentDB cluster does not have deletion protection enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation: `pip install awscli`
   
   Configuration: `aws configure`

2. List all DocumentDB clusters: Use the `describe-db-clusters` command to list all the DocumentDB clusters in your AWS account. The command is as follows:

   `aws docdb describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text`

3. Check Deletion Protection status: For each DocumentDB cluster, check the Deletion Protection status. You can do this by running the following command:

   `aws docdb describe-db-clusters --db-cluster-identifier <your_db_cluster_identifier> --query 'DBClusters[*].[DBClusterIdentifier,DeletionProtection]' --output text`

   Replace `<your_db_cluster_identifier>` with the identifier of your DocumentDB cluster.

4. Analyze the output: The output of the above command will show the Deletion Protection status for each DocumentDB cluster. If the status is 'false', it means that Deletion Protection is not enabled for that cluster.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials for use by Boto3 in several ways. They are ordered by recommendation:

   - Configuration files (`.aws/credentials`)
   - Environment variables (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`)

3. Write the Python script: Now you can write a Python script that uses Boto3 to interact with the AWS RDS service and check if the DocumentDB cluster has deletion protection enabled. Here is a simple script that does this:

   ```python
   import boto3

   def check_deletion_protection():
       client = boto3.client('rds')
       response = client.describe_db_clusters()

       for db_cluster in response['DBClusters']:
           if db_cluster['Engine'] == 'docdb':
               if 'DeletionProtection' in db_cluster and db_cluster['DeletionProtection']:
                   print(f"DocumentDB Cluster {db_cluster['DBClusterIdentifier']} has deletion protection enabled.")
               else:
                   print(f"DocumentDB Cluster {db_cluster['DBClusterIdentifier']} does not have deletion protection enabled.")

   if __name__ == "__main__":
       check_deletion_protection()
   ```

4. Run the Python script: Finally, you can run the Python script. It will print out the DocumentDB clusters and whether they have deletion protection enabled or not. If a cluster does not have deletion protection enabled, it means there is a misconfiguration.

   ```bash
   python check_deletion_protection.py
   ```
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of DocumentDB cluster not having deletion protection enabled in AWS RDS, you can follow these step-by-step instructions using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the Amazon DocumentDB Console**: Click on the "Services" dropdown menu at the top of the page, then select "DocumentDB" under the Database category.

3. **Select the DocumentDB Cluster**: In the DocumentDB dashboard, locate the DocumentDB cluster that you want to enable deletion protection for, and click on its name to access its details.

4. **Enable Deletion Protection**: In the cluster details page, click on the "Modify" button at the top right corner.

5. **Enable Deletion Protection Option**: Scroll down to the "Deletion protection" section in the Modify cluster settings page.

6. **Enable Deletion Protection**: Check the box next to "Enable deletion protection" to turn on deletion protection for the DocumentDB cluster.

7. **Save Changes**: Scroll down to the bottom of the page and click on the "Modify cluster" button to save the changes.

8. **Verify Deletion Protection**: Once the modification is completed, go back to the DocumentDB cluster details page and ensure that the deletion protection status is now enabled.

By following these steps, you have successfully enabled deletion protection for the DocumentDB cluster in AWS RDS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of a DocumentDB cluster not having deletion protection enabled in AWS RDS using AWS CLI, follow these steps:

1. **Install and Configure AWS CLI:**
   If you haven't already, install the AWS CLI and configure it with the necessary credentials by running:
   ```
   aws configure
   ```
   Follow the prompts to input your AWS Access Key ID, Secret Access Key, default region, and default output format.

2. **Enable Deletion Protection for the DocumentDB Cluster:**
   Run the following AWS CLI command to enable deletion protection for your DocumentDB cluster:
   ```
   aws docdb modify-db-cluster --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER --deletion-protection
   ```
   Replace `YOUR_CLUSTER_IDENTIFIER` with the actual identifier of your DocumentDB cluster.

3. **Verify the Deletion Protection Status:**
   To verify that deletion protection has been successfully enabled for your DocumentDB cluster, you can describe the cluster using the following command:
   ```
   aws docdb describe-db-clusters --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER
   ```
   Ensure that the `DeletionProtection` attribute in the output is set to `true`.

By following these steps, you can successfully remediate the misconfiguration of a DocumentDB cluster not having deletion protection enabled in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having deletion protection enabled for an Amazon DocumentDB cluster in AWS using Python, you can use the AWS SDK for Python (boto3) to update the cluster configuration. Here are the step-by-step instructions:

1. Install the AWS SDK for Python (boto3) if you haven't already:
```bash
pip install boto3
```

2. Create a Python script with the following code to enable deletion protection for the DocumentDB cluster:

```python
import boto3

# Initialize the DocumentDB client
client = boto3.client('docdb')

# Specify the DocumentDB cluster identifier
cluster_identifier = 'your-cluster-identifier'

# Enable deletion protection for the DocumentDB cluster
response = client.modify_db_cluster(
    DBClusterIdentifier=cluster_identifier,
    DeletionProtection=True
)

# Print the response
print(response)
```

3. Replace `'your-cluster-identifier'` with the actual identifier of your DocumentDB cluster.

4. Run the Python script. This will enable deletion protection for the specified DocumentDB cluster.

After following these steps, deletion protection will be enabled for your Amazon DocumentDB cluster, preventing accidental deletion of the cluster.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

