### Remediation

How to use KMS CMK instead of AWS managed keys?

#### Using AWS Console

- Step 1: In the left navigation panel, click Encryption Keys and select the appropriate AWS region from the Filter menu:
  (must match the region where the AWS resource that will use the key was created).

- Step 2: Click Create Key button from the top menu and enter an alias and a description for the new CMK, Then click Next.

- Step 3: Under the Key Administrators section, select which IAM users or roles can administer the CMK, then click Next.

- Step 4: Under This Account section, select which IAM users or roles can use the CMK to encrypt/decrypt data with the AWS KMS API.

- Step 5: (Optional) Under External Accounts section, click Add an External Account and enter an external account ID in order to add another AWS account that can use this CMK to encrypt/decrypt data. The owners of the external AWS accounts must also provide access to this CMK by creating policies for their IAM users.

- Step 6: Click Next. Under the preview key policy section, click Finish to create new CMK. Once its created. The KMS dashboard will display a confirmation message: "Your master key was created successfully. Alias: the CMK display name".

- Step 7: Under Preview Key Policy section, click Finish to create your new CMK. Once the key is created, the KMS dashboard will display a confirmation message: "Your master key was created successfully. Alias: the CMK display name".

- Step 8: Click on the newly created CMK alias and copy the key full ARN displayed in the Summary section:
- Step 9: Now the new CMK must be applied to encrypt/decrypt the RDS instance data. In order to start the process, navigate to the RDS dashboard at https://console.aws.amazon.com/rds/.

- Step 10: In the navigation panel, under RDS Dashboard, click Instances and select the RDS DB instance to encrypt.

- Step 11: Click Instance Actions button from the dashboard top menu and select Take Snapshot.

- Step 12: On the Take DB Snapshot page, enter a name for the instance snapshot in the Snapshot Name field and click Take Snapshot (the backup process may take few minutes and depends on your instance storage size).

- Step 13: Select the new created snapshot and click the Copy Snapshot button from the dashboard top menu.

- Step 14: On the Make Copy of DB Snapshot page, perform the following:
  A: In the New DB Snapshot Identifier field, enter a name for the new snapshot (copy).
  B: Check Copy Tags so the new snapshot can have the same tags as the source snapshot.
  C: In the Master Key dropdown list, select Enter a key ARN to provide your own CMK ARN.
  D: In the ARN field, paste the CMK ARN copied at step no. 12 (e.g. arn:aws:kms:::key/).

- Step 15: Click Copy Snapshot to create an encrypted copy of the selected instance snapshot.

- Step 16: Select the new snapshot copy and click Restore Snapshot button from the dashboard top menu.

- Step 17: On the Restore DB Instance page, enter a unique name for the new database instance in the DB Instance Identifier\* field.

- Step 18: Review the instance configuration details and click Restore DB Instance.

- Step 19: As soon as the new instance provisioning process is completed (the instance status becomes available), you can update your application configuration to refer to the endpoint (e.g. mysql-prod-db-encrypted.cdi32cpelkwh.us-east-1.rds.amazonaws.com) of the new database instance (encrypted with your own CMK). Once the database endpoint is changed at your application level, you can remove the instance encrypted with the AWS KMS default key.
