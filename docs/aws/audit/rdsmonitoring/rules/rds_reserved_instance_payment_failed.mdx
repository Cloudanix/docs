---
slug: rds_reserved_instance_payment_failed
title: RDS Reserved Instances Should Not Have Status - Payment Failed
sidebar_label: RDS Reserved Instances Should Not Have Status - Payment Failed
---

### More Info:

Identify any failed RDS Reserved Instances (RIs) available within your AWS account. A failed RDS RI is an unsuccessful reservation that received the "payment-failed" status during the purchase process.

### Risk Level

High

### Address

Cost Optimisation

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the RDS dashboard.
2. In the navigation pane, choose "Reserved Instances". This will display a list of all your reserved instances.
3. In the list of reserved instances, look for any instances that have their status listed as "Payment Failed". This status indicates that the payment for the reserved instance has failed.
4. For more details about the payment failure, you can select the instance and view its "Details" pane. This will provide more information about the payment failure, such as the reason for the failure and the date and time it occurred.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all RDS Reserved Instances: Use the `describe-reserved-db-instances` command to list all your RDS Reserved Instances. The command is as follows:

   ```
   aws rds describe-reserved-db-instances
   ```

   This command will return a JSON output with details of all your RDS Reserved Instances.

3. Filter RDS Reserved Instances with Payment Failed status: You can filter the output of the previous command to only show instances with a Payment Failed status. This can be done using the `jq` command-line JSON processor. If you don't have `jq` installed, you can download it from the official `jq` website. The command is as follows:

   ```
   aws rds describe-reserved-db-instances | jq -r '.ReservedDBInstances[] | select(.State=="payment-failed")'
   ```

4. Review the output: The output of the previous command will show all RDS Reserved Instances with a Payment Failed status. Each instance will be displayed with its details, including the DB Instance ID, DB Instance Class, Engine, Multi AZ, Offering Type, and more. You can review this output to identify any instances with payment issues.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, AWS DynamoDB, and much more. To install Boto3, you can use pip:

   ```
   pip install boto3
   ```

   You also need to configure your AWS credentials. You can do this in several ways, but the simplest is to use the AWS CLI:

   ```
   aws configure
   ```

   Then follow the prompts to input your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. Use Boto3 to interact with AWS RDS: You can use Boto3 to create, configure, and manage AWS services. For example, you can create an RDS instance, modify its attributes, and delete it. Here is a simple script to list all RDS instances:

   ```python
   import boto3

   def list_rds_instances():
       rds = boto3.client('rds')
       response = rds.describe_db_instances()
       for instance in response['DBInstances']:
           print(instance['DBInstanceIdentifier'])

   list_rds_instances()
   ```

3. Check the status of RDS Reserved Instances: You can use the `describe_reserved_db_instances` method to retrieve information about reserved DB instances for this AWS account, and check if the status is "payment-failed". Here is a script to do this:

   ```python
   import boto3

   def check_rds_reserved_instances_status():
       rds = boto3.client('rds')
       response = rds.describe_reserved_db_instances()
       for instance in response['ReservedDBInstances']:
           if instance['State'] == 'payment-failed':
               print(f"RDS Reserved Instance {instance['ReservedDBInstanceId']} has payment failed status")

   check_rds_reserved_instances_status()
   ```

4. Handle the output: The script will print the identifiers of all RDS Reserved Instances that have a "payment-failed" status. You can modify the script to handle the output as needed, for example, by sending an email notification, logging the output to a file, or triggering a remediation process.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of RDS Reserved Instances having a status of "Payment Failed" in AWS, you can follow these steps using the AWS Management Console:

1. **Identify the RDS Reserved Instances with Payment Failed Status:**
   - Go to the AWS Management Console and navigate to the RDS service.
   - Click on the "Reserved Instances" option in the left-hand menu to view all your reserved instances.
   - Look for any instances with a status of "Payment Failed".

2. **Cancel the Reserved Instance with Payment Failed Status:**
   - Select the RDS Reserved Instance with the "Payment Failed" status that you want to remediate.
   - Click on the "Actions" dropdown menu and select "Modify Reserved Instances".
   - In the Modify Reserved Instances wizard, select the option to "Cancel Reserved Instance" and follow the on-screen instructions to cancel the instance.

3. **Purchase a New Reserved Instance:**
   - Once you have canceled the Reserved Instance with the Payment Failed status, you can purchase a new Reserved Instance to replace it.
   - Click on the "Purchase Reserved Instances" button in the Reserved Instances dashboard.
   - Follow the on-screen instructions to select the desired instance type, term length, and quantity for the new Reserved Instance.

4. **Verify the New Reserved Instance Status:**
   - After purchasing the new Reserved Instance, verify that its status is "Active" and not "Payment Failed".
   - You can check the status of the new Reserved Instance in the Reserved Instances dashboard.

By following these steps, you can remediate the misconfiguration of RDS Reserved Instances having a status of "Payment Failed" in AWS RDS using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of an RDS Reserved Instance having a status of "Payment Failed" in AWS using AWS CLI, follow these steps:

1. Identify the RDS Reserved Instance with the "Payment Failed" status:
```bash
aws rds describe-reserved-db-instances --query "ReservedDBInstances[?State=='payment-failed']"
```

2. Take note of the Reserved Instance ID of the RDS instance with the "Payment Failed" status.

3. Modify the RDS Reserved Instance to update the payment method:
```bash
aws rds modify-reserved-db-instances --reserved-db-instance-id <RESERVED_INSTANCE_ID> --reserved-db-instances-offering-id <OFFERING_ID>
```
Replace `<RESERVED_INSTANCE_ID>` with the Reserved Instance ID noted in step 2 and `<OFFERING_ID>` with the new offering ID for the Reserved Instance. You can find the available offering IDs by listing the available Reserved DB Instances offerings using the following command:
```bash
aws rds describe-reserved-db-instances-offerings
```

4. Confirm the changes by describing the updated Reserved Instance:
```bash
aws rds describe-reserved-db-instances --reserved-db-instance-id <RESERVED_INSTANCE_ID>
```

By following these steps, you should be able to remediate the misconfiguration of an RDS Reserved Instance with a status of "Payment Failed" in AWS using AWS CLI.

#### Using Python

To remediate the issue of RDS Reserved Instances having a status of "Payment Failed" in AWS using Python, you can follow these steps:

1. **Identify Reserved Instances with Payment Failed Status**:
   - Use the AWS SDK for Python (Boto3) to describe all the RDS Reserved Instances.
   - Filter the instances that have a status of "Payment Failed".

2. **Modify the Reserved Instances**:
   - For each Reserved Instance with a status of "Payment Failed", you can modify the instance to update the payment details.
   - Use the `modify_reserved_db_instances` method from the Boto3 RDS client to update the payment details for the Reserved Instance.

3. **Update Payment Information**:
   - You will need to provide valid payment information to update the status of the Reserved Instance.
   - Use the `modify_db_instance` method to update the payment details of the Reserved Instance.

4. **Verify the Status**:
   - After updating the payment information, describe the Reserved Instance again to verify that the status is no longer "Payment Failed".

Here is a sample Python script to remediate the issue:

```python
import boto3

# Initialize the RDS client
rds_client = boto3.client('rds')

# Describe all Reserved Instances
reserved_instances = rds_client.describe_reserved_db_instances()

# Filter Reserved Instances with Payment Failed status
payment_failed_instances = [instance for instance in reserved_instances['ReservedDBInstances'] if instance['State'] == 'payment-failed']

# Update payment information for each Reserved Instance with Payment Failed status
for instance in payment_failed_instances:
    # Modify the Reserved Instance to update payment details
    rds_client.modify_reserved_db_instances(ReservedDBInstanceId=instance['ReservedDBInstanceId'], PaymentType='POSTPAID')

    # Describe the modified Reserved Instance to verify the status
    modified_instance = rds_client.describe_reserved_db_instances(ReservedDBInstanceId=instance['ReservedDBInstanceId'])
    print(f"Reserved Instance {modified_instance['ReservedDBInstances'][0]['ReservedDBInstanceId']} status updated to {modified_instance['ReservedDBInstances'][0]['State']}")
```

Make sure to replace the placeholders in the script with actual values as per your AWS account configuration. Also, ensure that you have the necessary permissions to modify RDS Reserved Instances in your AWS account.

### Additional Reading:

- [https://aws.amazon.com/rds/reserved-instances/](https://aws.amazon.com/rds/reserved-instances/) 


</Tab>
</Tabs>