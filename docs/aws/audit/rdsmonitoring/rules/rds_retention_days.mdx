---
slug: rds_retention_days
title: Backup Retention Duration Should Be Present
sidebar_label: Backup Retention Duration Should Be Present
---

### More Info:

As an organization you should have a backup policy with atleast minimum 7 days.

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Databases".

3. Choose the name of the DB instance that you want to check.

4. In the "Details" section, look for the "Backup" section. Here, you can see the "Backup retention period" setting. 

5. If the "Backup retention period" is set to "0" days, it means that the backup retention duration is not present. This is a misconfiguration as it means that no automated backups are being taken.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all RDS instances: Use the following command to list all the RDS instances in your AWS account.

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier]' --output text
   ```

3. Check backup retention period for each RDS instance: For each RDS instance, you can check the backup retention period using the following command. Replace `DBInstanceIdentifier` with the actual identifier of your RDS instance.

   ```
   aws rds describe-db-instances --db-instance-identifier DBInstanceIdentifier --query 'DBInstances[*].[BackupRetentionPeriod]' --output text
   ```

4. Analyze the output: The output of the above command will be the number of days for which backups are retained. If the output is 0, it means that backups are not being retained for the RDS instance. If the output is a number less than the desired retention period, it means that the backup retention period is not sufficient.

#### Using Python

1. Import the necessary libraries: You will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others.

```python
import boto3
```

2. Create a session using your AWS credentials. You can configure credentials in several ways. You can load them from a JSON configuration file, or from environment variables. Here's an example of loading from environment variables:

```python
session = boto3.Session(
    aws_access_key_id=YOUR_ACCESS_KEY,
    aws_secret_access_key=YOUR_SECRET_KEY,
    aws_session_token=SESSION_TOKEN,
)
```

3. Create an RDS client and retrieve all DB instances:

```python
rds = session.client('rds')
response = rds.describe_db_instances()
```

4. Iterate over the DB instances and check the backup retention period. If the backup retention period is not set or less than the desired period, print a message:

```python
for instance in response['DBInstances']:
    backup_retention_period = instance['BackupRetentionPeriod']
    if backup_retention_period is None or backup_retention_period < DESIRED_PERIOD:
        print(f"DB instance {instance['DBInstanceIdentifier']} has a misconfigured backup retention period.")
```

Replace `YOUR_ACCESS_KEY`, `YOUR_SECRET_KEY`, `SESSION_TOKEN`, and `DESIRED_PERIOD` with your actual AWS access key, secret key, session token, and the desired backup retention period respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the backup retention duration misconfiguration for an AWS RDS instance using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console:**
   - Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to the RDS Console:**
   - In the AWS Management Console, navigate to the Amazon RDS console by clicking on "Services" at the top of the page and then selecting "RDS" under the Database section.

3. **Select the RDS Instance:**
   - From the list of RDS instances, select the instance for which you want to set the backup retention duration.

4. **Modify the Backup Retention Period:**
   - Click on the instance name to open its details page.
   - In the navigation pane on the left, click on "Modify".
   - Scroll down to the "Backup" section.
   - Locate the "Backup retention period" option and set the desired backup retention duration in days. The valid values range from 0 (for disabling automated backups) to a maximum of 35 days.
  
5. **Apply the Changes:**
   - Scroll to the bottom of the page and click on the "Continue" button.
   - Review the summary of changes and click on the "Modify DB Instance" button to apply the new backup retention duration.

6. **Monitor the Modification:**
   - Once the modification is complete, you can monitor the progress in the RDS console. The instance may undergo a brief downtime during the modification process.

By following these steps, you can remediate the backup retention duration misconfiguration for an AWS RDS instance using the AWS Management Console.

#### Using CLI

To remediate the issue of missing Backup Retention Duration for an AWS RDS instance using AWS CLI, you can follow these steps:

1. **List Current Backup Retention Settings**:
   Run the following AWS CLI command to list the current backup retention settings for your RDS instance:
   ```bash
   aws rds describe-db-instances --db-instance-identifier YOUR_DB_INSTANCE_IDENTIFIER
   ```

2. **Update Backup Retention Duration**:
   Run the following AWS CLI command to modify the backup retention period for your RDS instance. Replace `YOUR_DB_INSTANCE_IDENTIFIER` with the actual identifier of your RDS instance and `NEW_RETENTION_PERIOD` with the desired retention period in days:
   ```bash
   aws rds modify-db-instance --db-instance-identifier YOUR_DB_INSTANCE_IDENTIFIER --backup-retention-period NEW_RETENTION_PERIOD
   ```

3. **Verify the Changes**:
   Run the `describe-db-instances` command again to verify that the backup retention period has been updated successfully:
   ```bash
   aws rds describe-db-instances --db-instance-identifier YOUR_DB_INSTANCE_IDENTIFIER
   ```

4. **Monitor the Backup Retention**:
   Monitor the backup retention settings periodically to ensure that the changes are applied correctly and the backups are retained for the specified duration.

By following these steps, you can remediate the issue of missing Backup Retention Duration for an AWS RDS instance using AWS CLI.

#### Using Python

To remediate the backup retention duration misconfiguration for AWS RDS using Python, you can use the AWS SDK for Python (Boto3). Here are the step-by-step instructions:

1. Install Boto3:
   If you haven't already installed Boto3, you can install it using pip:
   ```
   pip install boto3
   ```

2. Write a Python script to update the backup retention duration for the desired RDS instance. Here's an example script:

```python
import boto3

# Define the RDS instance identifier and the desired backup retention period
rds_instance_identifier = 'your_rds_instance_identifier'
backup_retention_period = 7  # Set the desired retention period in days

# Create an RDS client
rds_client = boto3.client('rds')

# Update the backup retention period for the specified RDS instance
response = rds_client.modify_db_instance(
    DBInstanceIdentifier=rds_instance_identifier,
    BackupRetentionPeriod=backup_retention_period
)

print(f"Backup retention period updated for RDS instance {rds_instance_identifier}")
```

3. Replace `'your_rds_instance_identifier'` with the actual identifier of your RDS instance.
   
4. Set the `backup_retention_period` variable to the desired retention period in days.

5. Run the Python script. This script will update the backup retention period for the specified RDS instance to the value you set.

By following these steps, you can remediate the backup retention duration misconfiguration for AWS RDS using Python and ensure that your RDS instances have the correct backup retention period set.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_CommonTasks.BackupRestore.html](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_CommonTasks.BackupRestore.html) 


</Tab>
</Tabs>