---
slug: rds_lease_expiration_7_days
title: Renew RDS Reserved Instances Before Expiration (7 days)
sidebar_label: Renew RDS Reserved Instances Before Expiration (7 days)
---

### More Info:

Your AWS RDS Reserved Instances (RIs) should be renewed before expiration in order to get the appropriate discount on the hourly charge for these instances

### Risk Level

High

### Address

Cost Optimisation

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Reserved Instances". This will display a list of all your reserved instances.

3. Check the "Expiration Date" column for each of your reserved instances. If the expiration date is within the next 7 days, then the RDS reserved instance is about to expire.

4. You can also set up an alert in AWS CloudWatch to notify you when the expiration date of a reserved instance is approaching. This can be done by creating a new rule in CloudWatch Events, selecting the "RDS" service, and then selecting the "Reserved Instance" event type. Then, specify the desired threshold for the expiration date (e.g., 7 days) and the desired action (e.g., sending an email notification).
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all RDS Reserved Instances: Use the `describe-reserved-db-instances` command to list all your RDS Reserved Instances. This command returns a JSON object that contains all your RDS Reserved Instances.

   ```
   aws rds describe-reserved-db-instances
   ```

3. Parse the output: The output from the previous command includes a `ReservedDBInstances` field that contains an array of all your RDS Reserved Instances. Each instance in this array includes a `LeaseExpirationTime` field that indicates when the instance will expire. You can use the `jq` command-line JSON processor to parse this output and extract the `LeaseExpirationTime` for each instance.

   ```
   aws rds describe-reserved-db-instances | jq -r '.ReservedDBInstances[].LeaseExpirationTime'
   ```

4. Check for instances that will expire within 7 days: Now that you have the expiration time for each instance, you can write a script that checks if any of these times are within the next 7 days. Here is a simple Python script that does this:

   ```python
   import subprocess
   from datetime import datetime, timedelta

   # Run the AWS CLI command and get the output
   output = subprocess.check_output([
       'aws', 'rds', 'describe-reserved-db-instances'
   ])

   # Parse the output as JSON
   instances = json.loads(output)['ReservedDBInstances']

   # Get the current time
   now = datetime.now()

   # Check each instance
   for instance in instances:
       # Parse the expiration time as a datetime object
       expiration_time = datetime.strptime(
           instance['LeaseExpirationTime'],
           '%Y-%m-%dT%H:%M:%SZ'
       )

       # Check if the instance will expire within the next 7 days
       if now + timedelta(days=7) > expiration_time:
           print(f"Instance {instance['ReservedDBInstanceId']} will expire soon")
   ```
   This script prints the ID of each instance that will expire within the next 7 days.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary libraries: You will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. 

```python
import boto3
from datetime import datetime, timedelta
```

2. Create a session using your AWS credentials. You can also use the AWS CLI's default session.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a client for 'rds' and get all the reserved instances.

```python
rds = session.client('rds')
reservations = rds.describe_reserved_db_instances()
```

4. Iterate over the instances and check the expiration date. If the expiration date is within the next 7 days, print the instance.

```python
for instance in reservations['ReservedDBInstances']:
    if instance['State'] == 'active':
        expiration_date = instance['ReservedDBInstancesOffering']['OfferingExpirationDate']
        if expiration_date - datetime.now() <= timedelta(days=7):
            print(f"Instance {instance['ReservedDBInstanceId']} is expiring soon.")
```

This script will print out the IDs of all RDS reserved instances that are expiring within the next 7 days. You can modify it to take different actions as needed.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To renew RDS Reserved Instances before expiration (7 days) in AWS using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login using your credentials.

2. **Navigate to RDS Dashboard**: Click on the "Services" dropdown menu at the top of the console, select "RDS" under the Database section.

3. **Select Reserved Instances**: In the RDS dashboard, select the "Reserved Instances" option from the left-hand menu.

4. **Identify Expiring Reserved Instances**: Look for the Reserved Instances that are expiring within the next 7 days. You can identify them by checking the "Expiration" column in the Reserved Instances table.

5. **Renew Reserved Instance**: Click on the checkbox next to the Reserved Instance that you want to renew. Then, click on the "Actions" dropdown menu above the table and select "Renew Reserved Instances".

6. **Select Renewal Options**: In the Renew Reserved Instances wizard, you will be prompted to select the duration for the renewal (1 year or 3 years) and the payment option (All Upfront, Partial Upfront, or No Upfront). Choose the appropriate options based on your requirements.

7. **Review and Confirm**: Review the details of the renewal, including the total cost and the new expiration date. Once you are satisfied with the selections, click on the "Purchase Reserved Instances" button to confirm the renewal.

8. **Verification**: After completing the renewal process, verify that the Reserved Instance now shows the updated expiration date in the RDS dashboard.

By following these steps, you can successfully renew RDS Reserved Instances before their expiration date in AWS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To renew RDS Reserved Instances before expiration in AWS RDS using AWS CLI, follow these steps:

1. List all the existing reserved instances in your AWS account to identify the ones that are expiring within the next 7 days:
```
aws rds describe-reserved-db-instances
```

2. Identify the Reserved Instance that is expiring within the next 7 days and note down its Reserved Instance ID.

3. Purchase a new Reserved Instance with the same specifications as the expiring one using the following command:
```
aws rds purchase-reserved-db-instances-offering --reserved-db-instances-offering-id <offering-id> --instance-count 1
```
Replace `<offering-id>` with the ID of the offering that matches the specifications of the expiring Reserved Instance.

4. Once the new Reserved Instance is purchased, modify your existing RDS instance to apply the new Reserved Instance using the following command:
```
aws rds modify-db-instance --db-instance-identifier <instance-id> --reserved-db-instance-id <new-reserved-instance-id>
```
Replace `<instance-id>` with the identifier of your RDS instance and `<new-reserved-instance-id>` with the ID of the newly purchased Reserved Instance.

5. Verify that the modification was successful by checking the details of your RDS instance:
```
aws rds describe-db-instances --db-instance-identifier <instance-id>
```
Replace `<instance-id>` with the identifier of your RDS instance.

By following these steps, you can successfully renew RDS Reserved Instances before their expiration in AWS RDS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not renewing RDS Reserved Instances before expiration in AWS using Python, you can create a script that will check the expiration dates of your RDS Reserved Instances and automatically renew them if they are set to expire within 7 days. Here's a step-by-step guide on how to do this:

1. Install the Boto3 library:
Ensure you have the Boto3 library installed in your Python environment. You can install it using pip:

```bash
pip install boto3
```

2. Create a Python script:
Create a Python script (e.g., `renew_rds_reserved_instances.py`) and import the necessary libraries:

```python
import boto3
from datetime import datetime, timedelta
```

3. Initialize the AWS SDK:
Initialize the AWS SDK with your credentials:

```python
client = boto3.client('rds', region_name='your_region', aws_access_key_id='your_access_key', aws_secret_access_key='your_secret_key')
```

4. Retrieve a list of your RDS Reserved Instances:
Get a list of your RDS Reserved Instances:

```python
response = client.describe_reserved_db_instances()
reserved_instances = response['ReservedDBInstances']
```

5. Check the expiration date of each Reserved Instance:
Iterate through each Reserved Instance and check if it is set to expire within 7 days:

```python
for reserved_instance in reserved_instances:
    expiration_date = reserved_instance['StartTime'] + reserved_instance['Duration']
    days_until_expiration = (expiration_date - datetime.now()).days
    
    if days_until_expiration <= 7:
        # Renew the Reserved Instance
        response = client.modify_reserved_db_instances(
            ReservedDBInstanceId=reserved_instance['ReservedDBInstanceId'],
            ReservedDBInstancesOfferingId=reserved_instance['ReservedDBInstancesOfferingId'],
            DBInstanceClass=reserved_instance['DBInstanceClass'],
            MultiAZ=reserved_instance['MultiAZ'],
            Duration=reserved_instance['Duration'],
            OfferingType=reserved_instance['OfferingType'],
            ProductDescription=reserved_instance['ProductDescription'],
            Tags=reserved_instance['Tags']
        )
```

6. Run the script:
Save the script and run it periodically using a scheduler like cron to check and renew your RDS Reserved Instances before expiration.

Please ensure to replace `'your_region'`, `'your_access_key'`, and `'your_secret_key'` with your actual AWS region, access key, and secret key. Also, make sure your IAM user has the necessary permissions to describe and modify RDS Reserved Instances.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/rds/reserved-instances/](https://aws.amazon.com/rds/reserved-instances/) 

