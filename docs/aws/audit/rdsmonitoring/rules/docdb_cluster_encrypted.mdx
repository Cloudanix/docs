---
slug: docdb_cluster_encrypted
title: DocumentDB Clusters Should Be Encrypted
sidebar_label: DocumentDB Clusters Should Be Encrypted
---
### More Info:

This rule checks whether storage encryption is enabled for your Amazon DocumentDB (with MongoDB compatibility) clusters. Enabling storage encryption helps protect your data at rest. The rule is marked as non-compliant if storage encryption is not enabled.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2,NIST,GDPR,ISO27001,HIPAA,HITRUST,NISTCSF,PCIDSS,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the navigation pane, click on "Databases".
4. In the list of database instances, select the DocumentDB cluster that you want to check.
5. In the details pane, under the "Configuration" section, look for the "Encryption" field. If the value is "Disabled" or "Not Enabled", then the DocumentDB cluster is not encrypted.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. Make sure you have the necessary permissions to access and manage RDS resources.

2. Once the AWS CLI is set up, you can list all the DocumentDB clusters using the following command:

   ```
   aws docdb describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier,StorageEncrypted]' --output text
   ```
   This command will return a list of all DocumentDB clusters along with their encryption status. The 'StorageEncrypted' field indicates whether the cluster is encrypted or not.

3. To filter out the unencrypted clusters, you can use the following command:

   ```
   aws docdb describe-db-clusters --query 'DBClusters[?StorageEncrypted==`false`].[DBClusterIdentifier]' --output text
   ```
   This command will return a list of all DocumentDB clusters that are not encrypted.

4. If the output of the above command is not empty, it means there are unencrypted DocumentDB clusters in your AWS account. You should take necessary actions to encrypt these clusters to ensure the security of your data.

#### Using Python

To check if DocumentDB clusters are encrypted in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install and Configure Boto3:**
   First, you need to install and configure Boto3. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can configure your credentials either by exporting them directly into your environment or by setting them in the AWS credentials file.

2. **Import Boto3 in Your Python Script:**
   Start your Python script by importing the Boto3 library. You will also need to create an RDS client.
   ```python
   import boto3
   rds = boto3.client('rds')
   ```

3. **List All DocumentDB Clusters:**
   Use the `describe_db_clusters` function to list all DocumentDB clusters.
   ```python
   clusters = rds.describe_db_clusters()
   ```

4. **Check Encryption for Each Cluster:**
   Iterate over each cluster and check the `StorageEncrypted` attribute. If it's set to `False`, the cluster is not encrypted.
   ```python
   for cluster in clusters['DBClusters']:
       if not cluster['StorageEncrypted']:
           print(f"Cluster {cluster['DBClusterIdentifier']} is not encrypted.")
   ```
   This script will print out the identifiers of all unencrypted DocumentDB clusters. If no output is produced, it means all your clusters are encrypted.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using the AWS Management Console, you can follow these step-by-step instructions:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in to your AWS account.

2. **Navigate to Amazon DocumentDB**: In the AWS Management Console, navigate to the Amazon DocumentDB service by either searching for "DocumentDB" in the search bar or locating it under the "Database" section.

3. **Select the DocumentDB Cluster**: From the DocumentDB dashboard, select the DocumentDB cluster that you want to encrypt.

4. **Enable Encryption**: Click on the selected DocumentDB cluster, and then click on the "Modify" button to make changes to the cluster configuration.

5. **Enable Encryption at Rest**: In the cluster configuration settings, scroll down to the "Encryption" section. Here, you will find an option to enable encryption at rest. Select the option to enable encryption.

6. **Choose the Encryption Key**: Choose the AWS Key Management Service (KMS) key that you want to use for encrypting the DocumentDB cluster. You can either use the default AWS-managed key or choose a custom KMS key.

7. **Save Changes**: After selecting the encryption key, scroll down to the bottom of the configuration page and click on the "Apply immediately" checkbox if you want the changes to take effect immediately. Then click on the "Modify cluster" button to save the changes.

8. **Monitor Encryption Status**: Once the modification is initiated, monitor the status of the encryption process in the DocumentDB cluster dashboard. The encryption process may take some time to complete depending on the size of the cluster.

9. **Verification**: After the encryption process is completed, verify that the DocumentDB cluster is now encrypted by checking the cluster details and ensuring that the encryption status is showing as "Encrypted".

By following these steps, you can successfully remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using AWS CLI, follow these steps:

Step 1: Enable encryption for the DocumentDB cluster using the AWS CLI command below:

```bash
aws rds modify-db-cluster --db-cluster-identifier your-cluster-id --storage-encrypted
```

Replace `your-cluster-id` with the actual identifier of your DocumentDB cluster.

Step 2: Verify the encryption status of the DocumentDB cluster to ensure that it is now encrypted. You can do this by describing the cluster using the following AWS CLI command:

```bash
aws rds describe-db-clusters --db-cluster-identifier your-cluster-id --query "DBClusters[*].StorageEncrypted"
```

Step 3: Once you have confirmed that the encryption is enabled for the DocumentDB cluster, ensure that all future DocumentDB clusters are also encrypted by default. You can do this by modifying the RDS cluster parameter group as follows:

```bash
aws rds modify-db-cluster-parameter-group --db-cluster-parameter-group-name your-parameter-group-name --parameters "ParameterName=aws_docdb_encryption_support,ParameterValue=true,ApplyMethod=immediate"
```

Replace `your-parameter-group-name` with the actual name of your RDS cluster parameter group.

By following these steps, you can successfully remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using the AWS CLI.

#### Using Python

To remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   
   ```bash
   pip install boto3
   ```

2. Write a Python script to enable encryption for your DocumentDB clusters. Here's an example script that uses Boto3 to enable encryption for all DocumentDB clusters in your AWS account:

```python
import boto3

# Initialize the DocumentDB client
client = boto3.client('docdb')

# Get a list of all DocumentDB clusters
response = client.describe_db_clusters()

# Iterate through each cluster and enable encryption
for cluster in response['DBClusters']:
    cluster_identifier = cluster['DBClusterIdentifier']
    
    # Enable encryption for the cluster
    client.modify_db_cluster(
        DBClusterIdentifier=cluster_identifier,
        StorageEncrypted=True
    )
    
    print(f"Encryption enabled for DocumentDB cluster: {cluster_identifier}")
```

3. Run the Python script in your local environment or AWS Lambda function with appropriate IAM permissions to modify DocumentDB clusters.

4. Monitor the script output to ensure that encryption is enabled for all DocumentDB clusters. You can also verify this in the AWS Management Console by checking the encryption status of each cluster.

By following these steps, you can remediate the misconfiguration of DocumentDB clusters not being encrypted in AWS RDS using Python.



</Tab>
</Tabs>