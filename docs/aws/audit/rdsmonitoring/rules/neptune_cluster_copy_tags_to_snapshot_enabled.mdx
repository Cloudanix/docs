---
slug: neptune_cluster_copy_tags_to_snapshot
title: Neptune Cluster Should Have Copy Tags For Snapshots Enabled
sidebar_label: Neptune Cluster Should Have Copy Tags For Snapshots Enabled
---
### More Info:

Checks if an Amazon Neptune cluster is configured to copy all tags to snapshots when the snapshots are created. The rule is NON_COMPLIANT if 'copyTagsToSnapshot' is set to false.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration "Neptune Cluster Should Have Copy Tags For Snapshots Enabled" in Amazon RDS using the AWS Management Console, follow these steps:

1. **Navigate to Neptune Clusters:**
   - Open the AWS Management Console.
   - In the navigation pane, choose **Services** and then select **Amazon Neptune** under the **Database** category.
   - In the Neptune dashboard, click on **Clusters** to view your Neptune clusters.

2. **Select the Cluster:**
   - From the list of Neptune clusters, select the cluster for which you want to enable the "Copy Tags to Snapshots" feature.

3. **Modify the Cluster:**
   - With the cluster selected, click on the **Actions** dropdown menu.
   - Choose **Modify Cluster** from the list of actions.

4. **Enable Copy Tags to Snapshots:**
   - In the **Modify Cluster** page, scroll down to the **Backup** section.
   - Check the box next to **Copy Tags to Snapshots**.
   - Review your changes and click on the **Continue** button.
   - Finally, click on **Modify Cluster** to apply the changes.

By following these steps, you ensure that tags associated with your Neptune cluster are copied to any snapshots, helping with better resource management and cost allocation.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where a Neptune Cluster should have "Copy Tags to Snapshots" enabled in Amazon RDS using AWS CLI, follow these steps:

1. **Describe the Neptune Cluster:**
   First, identify the Neptune cluster for which you want to enable the "Copy Tags to Snapshots" setting. Use the following command to describe the cluster and get its details:
   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier <your-cluster-identifier>
   ```

2. **Modify the Neptune Cluster:**
   Use the `modify-db-cluster` command to enable the "Copy Tags to Snapshots" setting for the specified Neptune cluster. This setting ensures that tags are copied to snapshots when they are created.
   ```sh
   aws neptune modify-db-cluster --db-cluster-identifier <your-cluster-identifier> --copy-tags-to-snapshot
   ```

3. **Verify the Configuration:**
   After modifying the cluster, verify that the "Copy Tags to Snapshots" setting is enabled by describing the cluster again:
   ```sh
   aws neptune describe-db-clusters --db-cluster-identifier <your-cluster-identifier>
   ```

4. **Automate the Process (Optional):**
   To ensure that this setting is always enabled for new clusters, you can create a script or use AWS Config rules to automatically enforce this configuration. For example, you can use a Python script with Boto3 to check and set this configuration for all existing and new clusters.

By following these steps, you can ensure that the "Copy Tags to Snapshots" setting is enabled for your Neptune clusters, helping to prevent misconfigurations.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where a Neptune Cluster should have "Copy Tags to Snapshots" enabled in Amazon RDS using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for Neptune. This will allow you to interact with the Neptune service.
   ```python
   import boto3

   neptune_client = boto3.client('neptune')
   ```

3. **Describe Neptune Clusters**:
   Retrieve the list of Neptune clusters to check their current configuration.
   ```python
   def describe_neptune_clusters():
       response = neptune_client.describe_db_clusters()
       return response['DBClusters']

   clusters = describe_neptune_clusters()
   ```

4. **Enable Copy Tags to Snapshots**:
   Iterate through the clusters and enable the "Copy Tags to Snapshots" setting if it is not already enabled.
   ```python
   def enable_copy_tags_to_snapshots(cluster_identifier):
       neptune_client.modify_db_cluster(
           DBClusterIdentifier=cluster_identifier,
           CopyTagsToSnapshot=True,
           ApplyImmediately=True
       )

   for cluster in clusters:
       if not cluster.get('CopyTagsToSnapshot', False):
           enable_copy_tags_to_snapshots(cluster['DBClusterIdentifier'])
           print(f"Enabled Copy Tags to Snapshots for cluster: {cluster['DBClusterIdentifier']}")
       else:
           print(f"Copy Tags to Snapshots already enabled for cluster: {cluster['DBClusterIdentifier']}")
   ```

This script will ensure that the "Copy Tags to Snapshots" setting is enabled for all Neptune clusters in your AWS account. Hereâ€™s a summary of the steps:

1. **Install Boto3**: Ensure Boto3 is installed.
2. **Initialize Boto3 Client**: Set up the Boto3 client for Neptune.
3. **Describe Neptune Clusters**: Retrieve the list of Neptune clusters.
4. **Enable Copy Tags to Snapshots**: Modify each cluster to enable the "Copy Tags to Snapshots" setting if it is not already enabled.

By following these steps, you can programmatically ensure that the "Copy Tags to Snapshots" setting is enabled for all Neptune clusters in your AWS environment.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to RDS Dashboard: On the AWS Management Console, click on "Services" at the top of the page. In the drop-down menu, under "Database", click on "RDS" to navigate to the RDS Dashboard.
3. Open Neptune Clusters: On the left-hand side of the RDS Dashboard, click on "Databases". This will open a list of all your database instances. Look for your Neptune clusters in this list.
4. Check Copy Tags to Snapshots: Click on the name of your Neptune cluster to open its details. Under the "Configuration" tab, look for the "Copy tags to snapshots" setting. If it is set to "Yes", then the Neptune Cluster has Copy Tags for Snapshots enabled. If it is set to "No", then it is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the RDS resources.

2. Once the AWS CLI is set up, you can list all the Neptune DB clusters using the following command:

   ```
   aws rds describe-db-clusters --query 'DBClusters[?Engine==`neptune`].{DBClusterIdentifier:DBClusterIdentifier}' --output text
   ```
   This command will return the identifiers of all the Neptune DB clusters.

3. For each Neptune DB cluster, you can check if the CopyTagsToSnapshot parameter is enabled or not using the following command:

   ```
   aws rds describe-db-clusters --db-cluster-identifier <DBClusterIdentifier> --query 'DBClusters[0].CopyTagsToSnapshot'
   ```
   Replace `<DBClusterIdentifier>` with the identifier of the DB cluster you want to check. This command will return `true` if the CopyTagsToSnapshot parameter is enabled, and `false` otherwise.

4. Repeat step 3 for each Neptune DB cluster. If any of the clusters return `false`, it means that the CopyTagsToSnapshot parameter is not enabled for that cluster, which is a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To check if Neptune Cluster Should Have Copy Tags For Snapshots Enabled in RDS using python scripts, you can follow these steps:

1. **Import the necessary AWS SDK for Python (Boto3) modules:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. For this task, you will need to import boto3 and botocore exceptions.

   ```python
   import boto3
   from botocore.exceptions import NoCredentialsError
   ```

2. **Create a session using your AWS credentials:**
   You can create a session in boto3 using your AWS credentials - Access key and Secret key. This session will be used to interact with AWS services.

   ```python
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. **Create an RDS client using the session:**
   You can create an RDS client using the session created in the previous step. This client will be used to interact with RDS service.

   ```python
   rds = session.client('rds')
   ```

4. **Check the CopyTagsToSnapshot attribute for each Neptune cluster:**
   You can use the `describe_db_clusters` method of the RDS client to get a list of all Neptune clusters. Then, for each cluster, check the `CopyTagsToSnapshot` attribute. If it's set to `False`, then the cluster does not have Copy Tags For Snapshots enabled.

   ```python
   try:
       response = rds.describe_db_clusters()
       for cluster in response['DBClusters']:
           if 'Engine' in cluster and cluster['Engine'] == 'neptune':
               if 'CopyTagsToSnapshot' in cluster and cluster['CopyTagsToSnapshot'] == False:
                   print(f"Neptune Cluster {cluster['DBClusterIdentifier']} does not have Copy Tags For Snapshots enabled.")
   except NoCredentialsError:
       print("No AWS credentials found.")
   ```

This script will print out the identifiers of all Neptune clusters that do not have Copy Tags For Snapshots enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Neptune Cluster not having copy tags for snapshots enabled in AWS RDS using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to the Amazon Neptune Console**: Click on the "Services" dropdown at the top left corner of the AWS Management Console, then select "Neptune" under the Database category.

3. **Select the Neptune Cluster**: From the list of Neptune clusters, click on the name of the cluster that needs to have copy tags for snapshots enabled.

4. **Enable Copy Tags for Snapshots**:
   - In the Neptune Cluster dashboard, click on the "Snapshots" tab in the navigation pane on the left.
   - Click on the "Modify" button at the top of the page to modify the cluster settings.
   - In the Modify cluster page, scroll down to the "Backup" section.
   - Look for the option "Copy tags to snapshots" and check the box to enable this feature.
   - Click on the "Apply immediately" checkbox if you want the changes to take effect immediately.
   - Click on the "Modify Cluster" button to save the changes.

5. **Verify Configuration**:
   - Once the modification is complete, go back to the Neptune Cluster dashboard.
   - Click on the "Snapshots" tab again and select an existing snapshot or create a new one.
   - Verify that the tags from the Neptune Cluster are copied to the snapshot.

By following these steps, you have successfully enabled copy tags for snapshots for the Neptune Cluster in AWS RDS using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Neptune Cluster not having Copy Tags For Snapshots enabled in AWS RDS using AWS CLI, you can follow these steps:

1. **Identify the Neptune Cluster**: First, you need to identify the Neptune Cluster for which you want to enable the Copy Tags For Snapshots option. You can do this by running the following AWS CLI command:
   ```
   aws neptune describe-db-clusters --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER
   ```

2. **Enable Copy Tags For Snapshots**: Once you have identified the Neptune Cluster, you can enable the Copy Tags For Snapshots option by running the following AWS CLI command:
   ```
   aws neptune modify-db-cluster --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER --copy-tags-to-snapshot
   ```

3. **Verify the Configuration**: To verify that the Copy Tags For Snapshots option has been successfully enabled for the Neptune Cluster, you can run the following AWS CLI command:
   ```
   aws neptune describe-db-clusters --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER
   ```

By following these steps and using the AWS CLI commands provided, you can successfully remediate the misconfiguration of Neptune Cluster not having Copy Tags For Snapshots enabled in AWS RDS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Neptune Cluster not having Copy Tags for Snapshots enabled in AWS RDS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Use the following Python script to enable the "Copy Tags for Snapshots" attribute for your Neptune Cluster:

```python
import boto3

# Initialize the RDS client
client = boto3.client('rds')

# Specify the name of your Neptune Cluster
neptune_cluster_identifier = 'your-neptune-cluster-identifier'

# Enable the Copy Tags for Snapshots attribute
response = client.modify_db_cluster(
    DBClusterIdentifier=neptune_cluster_identifier,
    CopyTagsToSnapshot=True
)

print('Copy Tags for Snapshots attribute has been enabled for the Neptune Cluster.')
```

3. Replace `'your-neptune-cluster-identifier'` with the actual identifier of your Neptune Cluster.

4. Run the Python script. After successful execution, the "Copy Tags for Snapshots" attribute will be enabled for your Neptune Cluster.

By following these steps, you can remediate the misconfiguration of Neptune Cluster not having Copy Tags for Snapshots enabled in AWS RDS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

