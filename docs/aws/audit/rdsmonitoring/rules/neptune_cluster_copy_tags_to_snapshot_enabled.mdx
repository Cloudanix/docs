---
slug: neptune_cluster_copy_tags_to_snapshot
title: Neptune Cluster Should Have Copy Tags For Snapshots Enabled
sidebar_label: Neptune Cluster Should Have Copy Tags For Snapshots Enabled
---
### More Info:

Checks if an Amazon Neptune cluster is configured to copy all tags to snapshots when the snapshots are created. The rule is NON_COMPLIANT if 'copyTagsToSnapshot' is set to false.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to RDS Dashboard: On the AWS Management Console, click on "Services" at the top of the page. In the drop-down menu, under "Database", click on "RDS" to navigate to the RDS Dashboard.
3. Open RDS Instances: On the RDS Dashboard, in the navigation pane, click on "Databases". This will open a list of all your RDS instances.
4. Check Copy Tags to Snapshots: For each Neptune Cluster, click on the instance name to open its details. Scroll down to the "Backup" section. Look for the "Copy tags to snapshots" field. If it is set to "No", then the Neptune Cluster does not have Copy Tags for Snapshots enabled.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the RDS resources.

2. Once the AWS CLI is set up, you can list all the Neptune DB clusters using the following command:

   ```
   aws rds describe-db-clusters --query 'DBClusters[*].[DBClusterIdentifier]' --output text
   ```

   This command will return a list of all the Neptune DB cluster identifiers.

3. For each of the returned DB cluster identifiers, you can check if the CopyTagsToSnapshot property is enabled or not using the following command:

   ```
   aws rds describe-db-clusters --db-cluster-identifier <DBClusterIdentifier> --query 'DBClusters[*].[CopyTagsToSnapshot]' --output text
   ```

   Replace `<DBClusterIdentifier>` with the actual DB cluster identifier. This command will return true if the CopyTagsToSnapshot property is enabled, and false otherwise.

4. Repeat step 3 for each DB cluster identifier. If any of the DB clusters have the CopyTagsToSnapshot property set to false, it means that the Neptune Cluster does not have Copy Tags for Snapshots enabled.

#### Using Python

To check if Neptune Cluster Should Have Copy Tags For Snapshots Enabled in RDS using python scripts, you can follow these steps:

1. **Import Necessary Libraries**: Import the necessary libraries in your Python script. You will need the `boto3` library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc.

    ```python
    import boto3
    ```

2. **Create a Session**: Create a session using your AWS credentials. You can also use the AWS CLI's named profiles.

    ```python
    session = boto3.Session(profile_name='my_profile')
    rds = session.client('rds')
    ```

3. **List all Neptune Clusters**: Use the `describe_db_clusters` function to get a list of all Neptune clusters.

    ```python
    clusters = rds.describe_db_clusters()
    ```

4. **Check CopyTagsToSnapshot Property**: For each cluster, check the `CopyTagsToSnapshot` property. If it's set to `False`, then the cluster has the misconfiguration.

    ```python
    for cluster in clusters['DBClusters']:
        if 'neptune' in cluster['Engine']:
            if not cluster['CopyTagsToSnapshot']:
                print(f"Neptune Cluster {cluster['DBClusterIdentifier']} does not have Copy Tags for Snapshots enabled.")
    ```

This script will print out the identifiers of all Neptune clusters that do not have Copy Tags for Snapshots enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Neptune Cluster not having copy tags for snapshots enabled in AWS RDS using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to the Amazon Neptune Console**: Click on the "Services" dropdown at the top left corner of the AWS Management Console, then select "Neptune" under the Database category.

3. **Select the Neptune Cluster**: From the list of Neptune clusters, click on the name of the cluster that needs to have copy tags for snapshots enabled.

4. **Enable Copy Tags for Snapshots**:
   - In the Neptune Cluster dashboard, click on the "Snapshots" tab in the navigation pane on the left.
   - Click on the "Modify" button at the top of the page to modify the cluster settings.
   - In the Modify cluster page, scroll down to the "Backup" section.
   - Look for the option "Copy tags to snapshots" and check the box to enable this feature.
   - Click on the "Apply immediately" checkbox if you want the changes to take effect immediately.
   - Click on the "Modify Cluster" button to save the changes.

5. **Verify Configuration**:
   - Once the modification is complete, go back to the Neptune Cluster dashboard.
   - Click on the "Snapshots" tab again and select an existing snapshot or create a new one.
   - Verify that the tags from the Neptune Cluster are copied to the snapshot.

By following these steps, you have successfully enabled copy tags for snapshots for the Neptune Cluster in AWS RDS using the AWS Management Console.

#### Using CLI

To remediate the misconfiguration of Neptune Cluster not having Copy Tags For Snapshots enabled in AWS RDS using AWS CLI, you can follow these steps:

1. **Identify the Neptune Cluster**: First, you need to identify the Neptune Cluster for which you want to enable the Copy Tags For Snapshots option. You can do this by running the following AWS CLI command:
   ```
   aws neptune describe-db-clusters --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER
   ```

2. **Enable Copy Tags For Snapshots**: Once you have identified the Neptune Cluster, you can enable the Copy Tags For Snapshots option by running the following AWS CLI command:
   ```
   aws neptune modify-db-cluster --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER --copy-tags-to-snapshot
   ```

3. **Verify the Configuration**: To verify that the Copy Tags For Snapshots option has been successfully enabled for the Neptune Cluster, you can run the following AWS CLI command:
   ```
   aws neptune describe-db-clusters --db-cluster-identifier YOUR_CLUSTER_IDENTIFIER
   ```

By following these steps and using the AWS CLI commands provided, you can successfully remediate the misconfiguration of Neptune Cluster not having Copy Tags For Snapshots enabled in AWS RDS.

#### Using Python

To remediate the misconfiguration of Neptune Cluster not having Copy Tags for Snapshots enabled in AWS RDS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Use the following Python script to enable the "Copy Tags for Snapshots" attribute for your Neptune Cluster:

```python
import boto3

# Initialize the RDS client
client = boto3.client('rds')

# Specify the name of your Neptune Cluster
neptune_cluster_identifier = 'your-neptune-cluster-identifier'

# Enable the Copy Tags for Snapshots attribute
response = client.modify_db_cluster(
    DBClusterIdentifier=neptune_cluster_identifier,
    CopyTagsToSnapshot=True
)

print('Copy Tags for Snapshots attribute has been enabled for the Neptune Cluster.')
```

3. Replace `'your-neptune-cluster-identifier'` with the actual identifier of your Neptune Cluster.

4. Run the Python script. After successful execution, the "Copy Tags for Snapshots" attribute will be enabled for your Neptune Cluster.

By following these steps, you can remediate the misconfiguration of Neptune Cluster not having Copy Tags for Snapshots enabled in AWS RDS using Python.




</Tab>
</Tabs>