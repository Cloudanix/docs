---
slug: rds_default_port
title: RDS Database Instances Should Not Use Default Ports
sidebar_label: RDS Database Instances Should Not Use Default Ports
---

### More Info:

Port obfuscation is as an additional layer of defense against non-targeted attacks. In order to leverage this, your Amazon RDS databases instances should not use their default ports (MySQL/Aurora port 3306, SQL Server port 1433, PostgreSQL port 5432)

### Risk Level

Low

### Address

Security

### Compliance Standards

PCIDSS



### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by choosing "Services" from the navigation bar and then selecting "RDS" under the Database section.
3. In the navigation pane, click on "Databases". This will display a list of all your RDS instances.
4. For each database instance, look at the "Port" column. If the port number is 3306 for MySQL, 5432 for PostgreSQL, or 1433 for SQL Server, then the RDS instance is using the default port.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. List all RDS instances: Use the `describe-db-instances` command to list all your RDS instances. The command is as follows:

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier,Engine,DBInstanceStatus,Endpoint.Address,Endpoint.Port]' --output table
   ```

   This command will return a table that includes the DB instance identifier, the engine, the status, the endpoint address, and the endpoint port for each DB instance.

3. Check the port number: From the output of the previous command, check the port number of each RDS instance. The default port for MySQL and MariaDB is 3306, for PostgreSQL is 5432, for Oracle is 1521, for SQL Server is 1433, and for Aurora is also 3306. If any of your RDS instances are using these default ports, then they are misconfigured.

4. Automate the process: If you have a large number of RDS instances, it might be more efficient to automate this process with a script. You can use the AWS SDK for Python (Boto3) to write a script that lists all your RDS instances and checks their port numbers. If any instances are using the default ports, the script can print a warning message.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary libraries: You will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc.

```python
import boto3
```

2. Create a session using your AWS credentials. You can configure credentials in the AWS credentials profile file on your local system. The default location for the file is `~/.aws/credentials`.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

3. Create an RDS client using the session.

```python
rds = session.client('rds')
```

4. Now, you can use the `describe_db_instances()` function to get a list of all RDS instances. Then, iterate over each instance and check the `Engine` and `Endpoint` properties. If the `Engine` is 'mysql' and the `Endpoint`'s `Port` is 3306, or if the `Engine` is 'postgres' and the `Endpoint`'s `Port` is 5432, then the RDS instance is using the default port.

```python
response = rds.describe_db_instances()
for instance in response['DBInstances']:
    engine = instance['Engine']
    port = instance['Endpoint']['Port']
    if (engine == 'mysql' and port == 3306) or (engine == 'postgres' and port == 5432):
        print(f"RDS instance {instance['DBInstanceIdentifier']} is using default port")
```

This script will print out the identifiers of all RDS instances that are using the default ports.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of RDS Database Instances using default ports in AWS, follow these step-by-step instructions using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console.

2. **Navigate to RDS Service**: Click on the "Services" dropdown menu at the top left corner of the console, then select "RDS" under the Database category.

3. **Select the RDS Instance**: From the list of RDS instances, select the instance that is currently using default ports.

4. **Modify the RDS Instance**: Click on the instance name to open the details page. Then, click on the "Modify" button at the top of the page.

5. **Update the Port Configuration**: In the "Network & Security" section, locate the "Public accessibility" setting. If the RDS instance is publicly accessible, you will see an option to specify the "Publicly accessible" setting and the "Port" number.

6. **Change the Port Number**: Update the "Port" number to a non-default port number of your choice. Ensure that the new port number is not commonly used or reserved for other services.

7. **Save the Changes**: Scroll down to the bottom of the page and click on the "Continue" button. Review the summary of changes, and then click on the "Modify DB Instance" button to apply the changes.

8. **Verify the Configuration**: Once the modification is complete, verify that the RDS instance is now using the updated port number. You can also test the connectivity to the RDS instance using the new port number to ensure that it is working correctly.

By following these steps, you have successfully remediated the misconfiguration of RDS Database Instances using default ports in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of RDS database instances using default ports in AWS, you can follow these steps using AWS CLI:

1. Identify the RDS instances that are using default ports:
   
   Run the following AWS CLI command to list all your RDS instances and their associated configurations:
   
   ```
   aws rds describe-db-instances
   ```

   Look for instances that are using default ports (3306 for MySQL, 5432 for PostgreSQL, 1433 for SQL Server, etc.).

2. Modify the RDS instance to use a non-default port:
   
   Run the following AWS CLI command to modify the RDS instance to use a non-default port (replace `your-db-instance-identifier` and `new-port-number` with your actual values):
   
   ```
   aws rds modify-db-instance --db-instance-identifier your-db-instance-identifier --port new-port-number
   ```

3. Update the security group settings:
   
   If you have security groups attached to your RDS instance, you will need to update the inbound rules to allow traffic on the new port. Run the following AWS CLI command to update the inbound rules of the security group (replace `your-security-group-id` and `new-port-number` with your actual values):
   
   ```
   aws ec2 authorize-security-group-ingress --group-id your-security-group-id --protocol tcp --port new-port-number --cidr 0.0.0.0/0
   ```

4. Verify the changes:
   
   Run the following AWS CLI command to describe the modified RDS instance and ensure that the port has been updated successfully:
   
   ```
   aws rds describe-db-instances --db-instance-identifier your-db-instance-identifier
   ```

By following these steps, you can remediate the misconfiguration of RDS database instances using default ports in AWS and enhance the security of your RDS instances.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of RDS Database Instances using default ports in AWS, you can use the AWS SDK for Python (Boto3) to modify the security group associated with the RDS instance to restrict access to a specific port. Here are the step-by-step instructions to remediate this issue:

1. Install the Boto3 library:
```bash
pip install boto3
```

2. Configure your AWS credentials by either setting environment variables or using the AWS CLI `aws configure` command.

3. Use the following Python script to modify the security group associated with the RDS instance to restrict access to a specific port (e.g., 3306):

```python
import boto3

# Initialize the RDS client
rds_client = boto3.client('rds')

# Specify the RDS instance identifier and the desired port
db_instance_identifier = 'YOUR_DB_INSTANCE_IDENTIFIER'
desired_port = 3306

# Get the current security group of the RDS instance
response = rds_client.describe_db_instances(DBInstanceIdentifier=db_instance_identifier)
security_group_id = response['DBInstances'][0]['VpcSecurityGroups'][0]['VpcSecurityGroupId']

# Authorize inbound traffic on the desired port for the security group
ec2_client = boto3.client('ec2')
response = ec2_client.authorize_security_group_ingress(
    GroupId=security_group_id,
    IpPermissions=[
        {
            'FromPort': desired_port,
            'ToPort': desired_port,
            'IpProtocol': 'tcp',
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)

print('Security group updated to allow inbound traffic on port', desired_port)
```

4. Replace `YOUR_DB_INSTANCE_IDENTIFIER` with the identifier of your RDS instance.

5. Run the Python script. It will modify the security group associated with the RDS instance to allow inbound traffic only on the specified port (3306 in this case).

By following these steps, you can remediate the misconfiguration of RDS Database Instances using default ports in AWS.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_BestPractices.html](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_BestPractices.html) 

