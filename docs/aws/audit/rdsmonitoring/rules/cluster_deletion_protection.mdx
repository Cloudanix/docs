---
slug: cluster_deletion_protection
title: Cluster Deletion Protection Should Be Enabled
sidebar_label: Cluster Deletion Protection Should Be Enabled
---

### More Info:

Amazon Aurora databases should be protected from accidental deletion. This is done by having Deletion Protection feature enabled at the database cluster level.

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

HIPAA



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon RDS console at https://console.aws.amazon.com/rds/.

2. In the navigation pane, choose "Databases".

3. In the list of DB instances, choose the name of the DB instance that you want to check.

4. In the "Details" section, look for the "Deletion protection" field. If the field is set to "Yes", then the deletion protection is enabled. If the field is set to "No", then the deletion protection is not enabled. 

5. Repeat steps 3 and 4 for each DB instance in your account.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all RDS instances: Use the following AWS CLI command to list all the RDS instances in your AWS account.

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier]' --output text
   ```

3. Check Cluster Deletion Protection: For each RDS instance, use the following AWS CLI command to check if Cluster Deletion Protection is enabled. Replace 'db-instance-identifier' with the actual identifier of your RDS instance.

   ```
   aws rds describe-db-instances --db-instance-identifier db-instance-identifier --query 'DBInstances[*].[DeletionProtection]' --output text
   ```

4. Analyze the output: If the output of the above command is 'true', it means that Cluster Deletion Protection is enabled for the RDS instance. If the output is 'false', it means that Cluster Deletion Protection is not enabled. Repeat steps 3 and 4 for each RDS instance in your AWS account.

#### Using Python

To check if Cluster Deletion Protection is enabled in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3**: First, you need to install the Boto3 library in your Python environment. You can do this using pip:
   ```python
   pip install boto3
   ```

2. **Configure AWS Credentials**: Boto3 needs your AWS credentials (Access Key ID and Secret Access Key) to interact with AWS services. You can configure it in several ways, but the simplest is to use the AWS CLI:
   ```bash
   aws configure
   ```
   Then, input your credentials as they are requested.

3. **Create a Python Script**: Now, you can create a Python script that uses Boto3 to interact with RDS and check if Cluster Deletion Protection is enabled. Here is a simple script that does this:
   ```python
   import boto3

   def check_cluster_deletion_protection():
       client = boto3.client('rds')
       response = client.describe_db_clusters()

       for cluster in response['DBClusters']:
           if not cluster['DeletionProtection']:
               print(f"Cluster {cluster['DBClusterIdentifier']} does not have deletion protection enabled.")

   if __name__ == "__main__":
       check_cluster_deletion_protection()
   ```
   This script first creates a client for RDS. Then, it calls the `describe_db_clusters` method to get a list of all DB clusters. It iterates over each cluster and checks the `DeletionProtection` attribute. If this attribute is `False`, it prints a message indicating that the cluster does not have deletion protection enabled.

4. **Run the Python Script**: Finally, you can run the Python script using the Python interpreter:
   ```bash
   python check_deletion_protection.py
   ```
   This will print out the identifiers of all RDS clusters that do not have deletion protection enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the RDS Service**: Click on the "Services" dropdown menu at the top of the console, and then select "RDS" under the Database category.

3. **Select the RDS Cluster**: From the list of RDS clusters, select the cluster for which you want to enable deletion protection by clicking on its name.

4. **Enable Deletion Protection**: In the cluster details page, click on the "Modify" button located at the top of the page.

5. **Enable Deletion Protection Option**: Scroll down to the "Backup" section of the Modify Cluster page, and locate the "Deletion protection" option.

6. **Check the Box**: Check the box next to "Enable deletion protection" to enable this feature for the RDS cluster.

7. **Save Changes**: Scroll to the bottom of the page and click on the "Continue" button.

8. **Apply Changes**: Review the changes you have made, and then click on the "Modify cluster" button to apply the changes.

9. **Verify Deletion Protection**: Once the modification is complete, go back to the cluster details page, and confirm that the "Deletion protection" status is now enabled for the RDS cluster.

By following these steps, you have successfully enabled deletion protection for the AWS RDS cluster, ensuring that accidental deletion of the cluster is prevented.

#### Using CLI

To remediate the misconfiguration "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable deletion protection for the RDS cluster:
   
   ```
   aws rds modify-db-cluster --db-cluster-identifier your-cluster-name --deletion-protection
   ```

   Replace `your-cluster-name` with the actual identifier of your RDS cluster.

2. After running the command, AWS will return the configuration details of the modified RDS cluster. Verify that the `DeletionProtection` parameter is set to `true` to confirm that deletion protection has been enabled successfully.

3. You can also verify the deletion protection status of the RDS cluster by running the following command:

   ```
   aws rds describe-db-clusters --db-cluster-identifier your-cluster-name
   ```

   Replace `your-cluster-name` with the actual identifier of your RDS cluster.

4. Check the output of the command to ensure that the `DeletionProtection` parameter is set to `true`.

By following these steps, you can remediate the misconfiguration "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using AWS CLI.

#### Using Python

To remediate the misconfiguration of Cluster Deletion Protection not being enabled for an AWS RDS cluster using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the RDS client:
```python
rds_client = boto3.client('rds')
```

3. Identify the RDS cluster for which you want to enable deletion protection. You can specify the cluster identifier or use describe_db_clusters to list all clusters and choose the one you want to update.

4. Enable deletion protection for the identified RDS cluster:
```python
response = rds_client.modify_db_cluster(
    DBClusterIdentifier='your-cluster-identifier',
    DeletionProtection=True
)
```

5. Verify the modification was successful:
```python
response = rds_client.describe_db_clusters(
    DBClusterIdentifier='your-cluster-identifier'
)

if response['DBClusters'][0]['DeletionProtection']:
    print('Deletion protection has been successfully enabled for the RDS cluster.')
else:
    print('Failed to enable deletion protection for the RDS cluster.')
```

By following these steps, you can remediate the misconfiguration of Cluster Deletion Protection not being enabled for an AWS RDS cluster using Python.

### Additional Reading:

- [https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/](https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/) 


</Tab>
</Tabs>