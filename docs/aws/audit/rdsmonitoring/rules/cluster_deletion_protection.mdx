---
slug: cluster_deletion_protection
title: Cluster Deletion Protection Should Be Enabled
sidebar_label: Cluster Deletion Protection Should Be Enabled
---

### More Info:

Amazon Aurora databases should be protected from accidental deletion. This is done by having Deletion Protection feature enabled at the database cluster level.

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

HIPAA


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the RDS dashboard by selecting "Services" from the top menu and then selecting "RDS" under the "Database" category.
3. In the navigation pane, click on "Databases".
4. Select the RDS instance that you want to check. In the "Details" section, look for the "Deletion protection" field. If the field is set to "Yes", then the Cluster Deletion Protection is enabled. If it is set to "No", then it is not enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all RDS instances: Use the following AWS CLI command to list all the RDS instances in your AWS account:

   ```
   aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier]' --output text
   ```
   This command will return a list of all RDS instance identifiers.

3. Check Cluster Deletion Protection status: For each RDS instance, use the following AWS CLI command to check the status of the Cluster Deletion Protection:

   ```
   aws rds describe-db-instances --db-instance-identifier <DBInstanceIdentifier> --query 'DBInstances[*].[DeletionProtection]' --output text
   ```
   Replace `<DBInstanceIdentifier>` with the identifier of the RDS instance you want to check. This command will return `true` if the Cluster Deletion Protection is enabled, and `false` otherwise.

4. Analyze the results: If the command returns `false` for any RDS instance, it means that the Cluster Deletion Protection is not enabled for that instance. This is a misconfiguration that should be fixed to prevent accidental deletion of the RDS instance.
</Accordion>

<Accordion title='Using Python'>
To check if Cluster Deletion Protection is enabled in RDS using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3**: First, you need to install the Boto3 library in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
2. **Configure AWS Credentials**: Boto3 needs your AWS credentials (access key and secret access key) to perform any operations. You can configure your credentials in several ways, but the simplest is to use the AWS CLI:
   ```
   aws configure
   ```
   Then, input your access key, secret access key, and your region when prompted.

3. **Create a Python Script**: Now, you can create a Python script that uses Boto3 to check if Cluster Deletion Protection is enabled in RDS. Here's a simple script that does this:

   ```python
   import boto3

   def check_cluster_deletion_protection():
       client = boto3.client('rds')
       response = client.describe_db_clusters()

       for cluster in response['DBClusters']:
           if not cluster['DeletionProtection']:
               print(f"Cluster {cluster['DBClusterIdentifier']} does not have deletion protection enabled.")

   if __name__ == "__main__":
       check_cluster_deletion_protection()
   ```
   This script first creates a client for the RDS service. Then, it calls the `describe_db_clusters` method to get a list of all DB clusters. For each cluster, it checks if the `DeletionProtection` attribute is False. If it is, it prints a message indicating that the cluster does not have deletion protection enabled.

4. **Run the Python Script**: Finally, you can run the Python script using your Python interpreter:
   ```
   python check_deletion_protection.py
   ```
   This will print out the identifiers of all RDS clusters that do not have deletion protection enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using the AWS Management Console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the RDS Service**: Click on the "Services" dropdown menu at the top of the console, and then select "RDS" under the Database category.

3. **Select the RDS Cluster**: From the list of RDS clusters, select the cluster for which you want to enable deletion protection by clicking on its name.

4. **Enable Deletion Protection**: In the cluster details page, click on the "Modify" button located at the top of the page.

5. **Enable Deletion Protection Option**: Scroll down to the "Backup" section of the Modify Cluster page, and locate the "Deletion protection" option.

6. **Check the Box**: Check the box next to "Enable deletion protection" to enable this feature for the RDS cluster.

7. **Save Changes**: Scroll to the bottom of the page and click on the "Continue" button.

8. **Apply Changes**: Review the changes you have made, and then click on the "Modify cluster" button to apply the changes.

9. **Verify Deletion Protection**: Once the modification is complete, go back to the cluster details page, and confirm that the "Deletion protection" status is now enabled for the RDS cluster.

By following these steps, you have successfully enabled deletion protection for the AWS RDS cluster, ensuring that accidental deletion of the cluster is prevented.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable deletion protection for the RDS cluster:
   
   ```
   aws rds modify-db-cluster --db-cluster-identifier your-cluster-name --deletion-protection
   ```

   Replace `your-cluster-name` with the actual identifier of your RDS cluster.

2. After running the command, AWS will return the configuration details of the modified RDS cluster. Verify that the `DeletionProtection` parameter is set to `true` to confirm that deletion protection has been enabled successfully.

3. You can also verify the deletion protection status of the RDS cluster by running the following command:

   ```
   aws rds describe-db-clusters --db-cluster-identifier your-cluster-name
   ```

   Replace `your-cluster-name` with the actual identifier of your RDS cluster.

4. Check the output of the command to ensure that the `DeletionProtection` parameter is set to `true`.

By following these steps, you can remediate the misconfiguration "Cluster Deletion Protection Should Be Enabled" for an AWS RDS cluster using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Cluster Deletion Protection not being enabled for an AWS RDS cluster using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the RDS client:
```python
rds_client = boto3.client('rds')
```

3. Identify the RDS cluster for which you want to enable deletion protection. You can specify the cluster identifier or use describe_db_clusters to list all clusters and choose the one you want to update.

4. Enable deletion protection for the identified RDS cluster:
```python
response = rds_client.modify_db_cluster(
    DBClusterIdentifier='your-cluster-identifier',
    DeletionProtection=True
)
```

5. Verify the modification was successful:
```python
response = rds_client.describe_db_clusters(
    DBClusterIdentifier='your-cluster-identifier'
)

if response['DBClusters'][0]['DeletionProtection']:
    print('Deletion protection has been successfully enabled for the RDS cluster.')
else:
    print('Failed to enable deletion protection for the RDS cluster.')
```

By following these steps, you can remediate the misconfiguration of Cluster Deletion Protection not being enabled for an AWS RDS cluster using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/](https://aws.amazon.com/about-aws/whats-new/2018/09/amazon-rds-now-provides-database-deletion-protection/) 

