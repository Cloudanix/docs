---
slug: es_general_purpose_ssd
title: Elasticsearch Should Use General Purpose SSD
sidebar_label: Elasticsearch Should Use General Purpose SSD
---

### More Info:

Your Amazon Elasticsearch (ES) clusters should be using General Purpose SSD (gp2) data nodes instead of Provisioned IOPS SSD (io1) nodes for cost-effective storage that fits a broad range of workloads

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Amazon Elasticsearch Service dashboard.

2. In the navigation pane, choose "Domains". This will display a list of all Elasticsearch domains that are currently available in your AWS account.

3. Select the Elasticsearch domain that you want to examine. This will open the domain dashboard where you can view the configuration details of the selected domain.

4. In the "EBS Options" section, check the "EBS Volume Type". If the value is not set to "General Purpose SSD (gp2)", then Elasticsearch is not using General Purpose SSD.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. After installation, configure it with your AWS account credentials using the command `aws configure`.

2. List all Elasticsearch domains: Use the following AWS CLI command to list all the Elasticsearch domains in your AWS account:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all Elasticsearch domain names.

3. Describe Elasticsearch domain: For each domain, use the following command to get detailed configuration information:

   ```
   aws es describe-elasticsearch-domain --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your Elasticsearch domain. This command will return a JSON output with detailed information about the specified Elasticsearch domain.

4. Check the EBS volume type: In the JSON output, look for the `EBSOptions` field. Under this field, check the `VolumeType` value. If the value is not `gp2`, it means that the Elasticsearch domain is not using General Purpose SSD (gp2) for EBS volumes, indicating a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the boto3 library. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a credentials file at ~/.aws/credentials. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the default profile, you can use the following format:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check the Elasticsearch configuration: You can use the boto3 library to interact with the Elasticsearch service and check the configuration of your instances. Here is a simple script that checks if the Elasticsearch instances are using General Purpose SSD:

   ```python
   import boto3

   # Create a client for the AWS Elasticsearch service
   es = boto3.client('es')

   # List all Elasticsearch domains
   domains = es.list_domain_names()

   for domain in domains['DomainNames']:
       # Describe the Elasticsearch domain
       response = es.describe_elasticsearch_domain(
           DomainName=domain['DomainName']
       )

       # Check the instance type
       instance_type = response['DomainStatus']['ElasticsearchClusterConfig']['InstanceType']

       # Check the EBS options
       ebs_options = response['DomainStatus']['EBSOptions']

       # If EBS is enabled and the volume type is not gp2, print a warning
       if ebs_options['EBSEnabled'] and ebs_options['VolumeType'] != 'gp2':
           print(f"Elasticsearch domain {domain['DomainName']} is not using General Purpose SSD.")
   ```

4. Run the script: You can run the script using a Python interpreter. If the script prints any warnings, that means there are Elasticsearch instances that are not using General Purpose SSD.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the Elasticsearch misconfiguration in AWS using the AWS console, follow these steps:

1. Log in to your AWS console.
2. Navigate to the Elasticsearch service and select the Elasticsearch domain that is misconfigured.
3. Click on the "Modify" button to modify the domain.
4. In the "EBS Options" section, select "General Purpose SSD" as the volume type for your Elasticsearch domain.
5. Click on the "Save Changes" button to save the changes to your Elasticsearch domain.

After completing these steps, your Elasticsearch domain will be using the recommended "General Purpose SSD" volume type. This will help optimize your Elasticsearch performance and ensure that it is running smoothly in your AWS environment.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the Elasticsearch misconfiguration "Elasticsearch should use General Purpose SSD" for AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI and run the following command to get the list of Elasticsearch domains in your AWS account:

   `aws es list-domain-names`

2. Identify the Elasticsearch domain that needs to be remediated.

3. Run the following command to update the Elasticsearch domain configuration to use General Purpose SSD:

   `aws es update-elasticsearch-domain-config --domain-name <domain-name> --ebs-options EBSEnabled=true,VolumeType=gp2`

   Replace `<domain-name>` with the name of the Elasticsearch domain that needs to be remediated.

4. Verify that the Elasticsearch domain configuration has been updated by running the following command:

   `aws es describe-elasticsearch-domain --domain-name <domain-name>`

   Replace `<domain-name>` with the name of the Elasticsearch domain that was remediated.

5. Verify that the Elasticsearch domain is now using General Purpose SSD by checking the value of the `EBSOptions.VolumeType` parameter in the output of the above command. It should be set to `gp2`.

By following these steps, you can successfully remediate the Elasticsearch misconfiguration "Elasticsearch should use General Purpose SSD" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the Elasticsearch should use General Purpose SSD misconfiguration in AWS using Python, you can follow the below steps:

1. Install the AWS SDK for Python (Boto3) using pip install boto3 command.

2. Create an EC2 client using boto3.client('ec2') method.

3. Use the describe_volumes() method of the EC2 client to get the list of all the volumes in your AWS account.

4. Loop through the list of volumes and check if the volume is attached to an Elasticsearch instance.

5. If the volume is attached to an Elasticsearch instance, check the volume type.

6. If the volume type is not "gp2" (General Purpose SSD), modify the volume type to "gp2" using the modify_volume() method of the EC2 client.

7. Repeat steps 4-6 for all the Elasticsearch instances in your AWS account.

Here's the Python code to remediate the Elasticsearch should use General Purpose SSD misconfiguration in AWS:

```
import boto3

# Create an EC2 client
ec2 = boto3.client('ec2')

# Get the list of all the volumes in your AWS account
volumes = ec2.describe_volumes()

# Loop through the list of volumes
for volume in volumes['Volumes']:
    # Check if the volume is attached to an Elasticsearch instance
    if 'Tags' in volume:
        for tag in volume['Tags']:
            if tag['Key'] == 'Name' and tag['Value'].startswith('elasticsearch-'):
                # Check the volume type
                if volume['VolumeType'] != 'gp2':
                    # Modify the volume type to "gp2"
                    ec2.modify_volume(VolumeId=volume['VolumeId'], VolumeType='gp2')
``` 

Note: This code assumes that your Elasticsearch instances are named with a prefix "elasticsearch-". You can modify the code based on your naming convention.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createupdatedomains.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createupdatedomains.html) 

