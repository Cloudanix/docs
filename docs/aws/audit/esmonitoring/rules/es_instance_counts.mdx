---
slug: es_instance_counts
title: Elasticsearch Instance Count
sidebar_label: Elasticsearch Instance Count
---

### More Info:

The number of Amazon Elasticsearch cluster instances provisioned in your AWS account should not have reached the limit quota established by your organization

### Risk Level

Low

### Address

Operational Maturity

### Compliance Standards

AWSWAF


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to your AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard. You can do this by typing "Elasticsearch Service" into the search bar and selecting it from the dropdown menu.
3. Once you're on the Elasticsearch Service dashboard, you'll see a list of your Elasticsearch domains. Click on the name of the domain you want to check.
4. On the domain dashboard, you can see the instance count under the "Elasticsearch cluster" section. It will show the number of instances currently running for that domain.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Elasticsearch domains: Use the following AWS CLI command to list all the Elasticsearch domains in your AWS account.

   ```
   aws es list-domain-names
   ```

   This command will return a list of all Elasticsearch domains in your AWS account.

3. Describe the Elasticsearch domain: Once you have the list of all Elasticsearch domains, you can describe a specific domain to get more details about it, including the instance count. Use the following AWS CLI command to describe a specific Elasticsearch domain.

   ```
   aws es describe-elasticsearch-domain --domain-name your_domain_name
   ```

   Replace 'your_domain_name' with the name of your Elasticsearch domain. This command will return a JSON output with all the details about the specified Elasticsearch domain.

4. Check the instance count: In the JSON output returned by the previous command, look for the 'ElasticsearchClusterConfig' field. Under this field, you will find the 'InstanceCount' field which shows the number of instances in the specified Elasticsearch domain.

   ```
   "ElasticsearchClusterConfig": {
       "InstanceType": "m3.medium.elasticsearch",
       "InstanceCount": 1,
       "DedicatedMasterEnabled": false,
       "ZoneAwarenessEnabled": false,
       "ZoneAwarenessConfig": {
           "AvailabilityZoneCount": 2
       }
   }
   ```

   In this example, the 'InstanceCount' is 1, which means there is only one instance in this Elasticsearch domain.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with Elasticsearch in AWS, you need to install the `boto3` and `requests` libraries. You can install them using pip:

```python
pip install boto3 requests
```

2. Set up AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by setting the `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and `AWS_SESSION_TOKEN` environment variables, or by using the `boto3` library's `Session` object:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

3. Connect to the Elasticsearch service: Once your credentials are set up, you can connect to the Elasticsearch service. You can do this by creating an `Elasticsearch` object:

```python
from requests_aws4auth import AWS4Auth
from elasticsearch import Elasticsearch, RequestsHttpConnection

host = 'YOUR_ELASTICSEARCH_ENDPOINT'
region = 'us-west-1' # for example

service = 'es'
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

es = Elasticsearch(
    hosts = [{'host': host, 'port': 443}],
    http_auth = awsauth,
    use_ssl = True,
    verify_certs = True,
    connection_class = RequestsHttpConnection
)
```

4. Check the instance count: Now that you're connected to the Elasticsearch service, you can check the instance count. You can do this by calling the `count` method on the `Elasticsearch` object:

```python
response = es.count(index='YOUR_INDEX_NAME')
print('Instance count:', response['count'])
```

This will print the number of instances in the specified index. If the count is higher than expected, it may indicate a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The ElasticSearch instance count misconfiguration can cause issues with performance and availability. Here are the steps to remediate this issue in AWS using the AWS console:

1. Open the AWS Management Console and navigate to the ElasticSearch service.

2. Select the ElasticSearch domain for which you want to modify the instance count.

3. In the domain dashboard, click on the "Modify Cluster" button.

4. In the "Modify Cluster" page, scroll down to the "Instance Count" section.

5. Update the instance count to the desired number. It is recommended to have at least three instances for high availability.

6. Click on the "Review and Submit" button to review your changes.

7. Review the changes and click on the "Modify Cluster" button to apply the changes.

8. Wait for the changes to be applied. This may take several minutes.

9. Once the changes are applied, verify that the ElasticSearch cluster is running smoothly.

By following these steps, you can remediate the ElasticSearch instance count misconfiguration in AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
The Elasticsearch Instance Count misconfiguration in AWS means that there are either too many or too few Elasticsearch instances running. To remediate this issue using AWS CLI, follow these steps:

1. Open the AWS CLI and connect to your AWS account.

2. Run the following command to describe the current Elasticsearch domain:

```
aws es describe-elasticsearch-domain --domain-name <your-domain-name>
```

3. Check the value of the `ElasticsearchClusterConfig.InstanceCount` parameter. This parameter specifies the number of instances in the Elasticsearch cluster.

4. If the value of the `ElasticsearchClusterConfig.InstanceCount` parameter is too high or too low, you can update it using the following command:

```
aws es update-elasticsearch-domain-config --domain-name <your-domain-name> --elasticsearch-cluster-config InstanceCount=<new-instance-count>
```

Replace `<your-domain-name>` with the name of your Elasticsearch domain, and `<new-instance-count>` with the desired number of instances.

5. After running the `update-elasticsearch-domain-config` command, wait for a few minutes for the changes to take effect.

6. Run the `describe-elasticsearch-domain` command again to verify that the `ElasticsearchClusterConfig.InstanceCount` parameter has been updated.

7. Finally, test the Elasticsearch cluster to ensure that it is functioning correctly with the new instance count.

By following these steps, you can remediate the Elasticsearch Instance Count misconfiguration in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
The misconfiguration of Elasticsearch Instance Count in AWS can be remediated using the following steps:

1. Open the AWS Management Console and navigate to the Elasticsearch service.
2. Click on the Elasticsearch domain that you want to remediate.
3. Click on the "Edit" button in the "Instance Settings" section.
4. In the "Instance Count" field, enter the desired number of instances for your Elasticsearch domain.
5. Click on the "Save Changes" button to apply the new instance count.

To automate this process using Python, you can use the AWS SDK for Python (Boto3) to update the instance count programmatically. Here's an example code snippet:

```python
import boto3

# Replace <your-domain-name> with the name of your Elasticsearch domain
domain_name = '<your-domain-name>'
new_instance_count = 2

# Create an Elasticsearch client using Boto3
es_client = boto3.client('es')

# Update the instance count for the specified domain
response = es_client.update_elasticsearch_domain_config(
    DomainName=domain_name,
    ElasticsearchClusterConfig={
        'InstanceCount': new_instance_count
    }
)

# Print the response from the API
print(response)
```

This code will update the instance count for your Elasticsearch domain to the specified value. You can run this code as a script or integrate it into your existing Python application.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/blogs/database/get-started-with-amazon-elasticsearch-service-how-many-data-instances-do-i-need/](https://aws.amazon.com/blogs/database/get-started-with-amazon-elasticsearch-service-how-many-data-instances-do-i-need/) 

