

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard.
3. In the navigation pane, choose "Domains".
4. For each domain listed, check the "Domain Status" page. Under the "Network Configuration" section, check the "Encryption" subsection. If the "HTTPS" option is not enabled, then the ElasticSearch is not using HTTPS only.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all the Elasticsearch domains: Use the following AWS CLI command to list all the Elasticsearch domains in your AWS account:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all Elasticsearch domain names.

3. Describe the Elasticsearch domain: For each domain, use the following AWS CLI command to get detailed information about the domain:

   ```
   aws es describe-elasticsearch-domain --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your Elasticsearch domain. This command will return a JSON object that contains detailed information about the domain.

4. Check if HTTPS is enabled: In the JSON object returned by the previous command, look for the `DomainEndpointOptions` field. If the `EnforceHTTPS` field under `DomainEndpointOptions` is set to `true`, then HTTPS is enabled for the domain. If it's set to `false`, then HTTPS is not enabled.

#### Using Python

1. Install the necessary Python libraries: You will need the `boto3` library to interact with AWS services. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You can set up your AWS credentials by configuring them in your environment or through the AWS CLI. Here is how you can do it through the AWS CLI:

   ```bash
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID and Secret Access Key, which you can get from your AWS console.

3. Write a Python script to check if ElasticSearch is using HTTPS only:

   ```python
   import boto3

   def check_https_only(domain_name):
       es = boto3.client('es')
       response = es.describe_elasticsearch_domain(DomainName=domain_name)
       domain_config = response['DomainStatus']
       if domain_config['DomainEndpointOptions']['EnforceHTTPS']:
           print(f"{domain_name} is using HTTPS only.")
       else:
           print(f"{domain_name} is not using HTTPS only.")

   # Replace 'your_domain_name' with the name of your ElasticSearch domain
   check_https_only('your_domain_name')
   ```

   This script uses the `describe_elasticsearch_domain` method of the `boto3` client for ElasticSearch to get the configuration of the specified domain. It then checks the `EnforceHTTPS` attribute of the `DomainEndpointOptions` to determine if the domain is using HTTPS only.

4. Run the script: You can run the script using any Python interpreter. If the script prints "your_domain_name is using HTTPS only.", then your ElasticSearch domain is correctly configured to use HTTPS only. If it prints "your_domain_name is not using HTTPS only.", then your domain is misconfigured.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using the AWS console, you can follow the below steps:

1. Log in to the AWS Management Console and navigate to the ElasticSearch service.

2. Select the misconfigured ElasticSearch domain.

3. In the domain dashboard, click on the "Edit" button in the "Encryption" section.

4. In the "Encryption" section, select the "Require HTTPS" option.

5. Click on the "Save Changes" button to apply the new configuration.

6. Once the changes are saved, ElasticSearch will only be accessible through HTTPS.

7. Verify the changes by attempting to access the ElasticSearch domain using HTTP. It should not be accessible and should return an error message.

By following these steps, you can remediate the misconfiguration of ElasticSearch not using HTTPS only in AWS.

#### Using CLI

To remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI and run the following command to get the current status of the ElasticSearch domain:

   ```
   aws es describe-elasticsearch-domain --domain-name <domain-name>
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

2. Check the output of the above command for the value of the `EncryptionAtRestOptions` parameter. If it is not set to `Enabled`, then run the following command to enable encryption at rest:

   ```
   aws es update-elasticsearch-domain-config --domain-name <domain-name> --encryption-at-rest-options Enabled=true
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

3. Next, run the following command to update the ElasticSearch domain to use HTTPS only:

   ```
   aws es update-elasticsearch-domain-config --domain-name <domain-name> --advanced-security-options Enabled=true,InternalUserDatabaseEnabled=false,MasterUserOptions.Enabled=false,NodeToNodeEncryptionOptions.Enabled=false,EncryptionAtRestOptions.Enabled=true,HTTPSEnabled=true
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

4. After running the above command, wait for a few minutes for the changes to take effect. You can check the status of the ElasticSearch domain again by running the `describe-elasticsearch-domain` command.

   ```
   aws es describe-elasticsearch-domain --domain-name <domain-name>
   ```

   If the output of this command shows that the `HTTPSEnabled` parameter is set to `true`, then the ElasticSearch domain is now using HTTPS only.

By following these steps, you can remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using AWS CLI.

#### Using Python

To remediate this misconfiguration on AWS using Python, you can follow the steps below:

1. Install the AWS SDK for Python (Boto3) by running the following command in your terminal:

```python
pip install boto3
```

2. Create an AWS ElasticSearch client using the Boto3 library:

```python
import boto3

es_client = boto3.client('es')
```

3. Get the ElasticSearch domain configuration using the `describe_elasticsearch_domain` method:

```python
domain_name = 'your-domain-name'
domain_config = es_client.describe_elasticsearch_domain(DomainName=domain_name)
```

4. Check if the ElasticSearch domain is using HTTPS only by looking at the `DomainStatus` dictionary:

```python
domain_status = domain_config['DomainStatus']
if domain_status['EncryptionAtRestOptions']['Enabled'] and domain_status['NodeToNodeEncryptionOptions']['Enabled'] and domain_status['AdvancedSecurityOptions']['Enabled']:
    print('ElasticSearch domain is already using HTTPS only')
else:
    # Remediate the misconfiguration
```

5. If the ElasticSearch domain is not using HTTPS only, update the domain configuration using the `update_elasticsearch_domain_config` method:

```python
from botocore.exceptions import ClientError

try:
    response = es_client.update_elasticsearch_domain_config(
        DomainName=domain_name,
        AdvancedSecurityOptions={
            'Enabled': True,
            'InternalUserDatabaseEnabled': False,
            'MasterUserOptions': {
                'MasterUserARN': 'arn:aws:iam::123456789012:user/elasticsearch-master-user',
                'MasterUserName': 'elasticsearch-master-user',
                'MasterUserPassword': 'your-password'
            }
        }
    )
    print('ElasticSearch domain configuration updated successfully')
except ClientError as e:
    print('Error updating ElasticSearch domain configuration: {}'.format(e))
```

6. Verify that the ElasticSearch domain is now using HTTPS only by checking the `DomainStatus` dictionary again:

```python
domain_config = es_client.describe_elasticsearch_domain(DomainName=domain_name)
domain_status = domain_config['DomainStatus']
if domain_status['EncryptionAtRestOptions']['Enabled'] and domain_status['NodeToNodeEncryptionOptions']['Enabled'] and domain_status['AdvancedSecurityOptions']['Enabled']:
    print('ElasticSearch domain is now using HTTPS only')
else:
    print('Failed to remediate ElasticSearch misconfiguration')
```

Note: In the code above, we assume that the ElasticSearch domain is not using VPC and that you have an IAM user with the necessary permissions to update the ElasticSearch domain configuration. Also, make sure to replace `your-domain-name` and `your-password` with the actual values for your ElasticSearch domain.


</Tab>
</Tabs>