---
slug: elastic_cache_with_encryption
title: Elasticcache should be encrypted at rest and in transit
sidebar_label: Elasticcache should be encrypted at rest and in transit
---

### More Info:

Ensure that your AWS ElastiCache Redis clusters are encrypted in order to meet security and compliance requirements (keep Personally Identifiable Information safe). Data encryption helps prevent unauthorized users from reading sensitive data available on your Redis clusters and their associated cache storage systems. This includes data saved to persistent media, known as data at-rest, and data that can be intercepted as it travels through the network, between clients and cache servers, known as data in-transit.

### Risk Level

High

### Address

Security

### Compliance Standards

GDPR, SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to AWS Management Console: First, you need to log in to your AWS Management Console. Make sure you have the necessary permissions to access the Elasticache dashboard.

2. Navigate to Elasticache Dashboard: From the AWS Management Console, navigate to the Elasticache service. This can be done by typing "Elasticache" in the search bar and selecting it from the dropdown menu.

3. Select the Elasticache Cluster: Once you are in the Elasticache dashboard, you will see a list of all your Elasticache clusters. Select the cluster you want to check for encryption at rest and in transit.

4. Check Encryption Settings: After selecting the cluster, you will be directed to a page with details about the cluster. Here, you can check the encryption settings under the "Security" section. If the "Encryption at-rest" and "Encryption in-transit" are enabled, it means that the Elasticache cluster is encrypted at rest and in transit. If not, it indicates a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elasticache resources.

2. Once the AWS CLI is set up, you can use the following command to list all the Elasticache clusters:

   ```
   aws elasticache describe-cache-clusters --region your-region
   ```

   Replace 'your-region' with the region where your Elasticache clusters are located. This command will return a JSON output with details about all the Elasticache clusters.

3. To check if the Elasticache clusters are encrypted at rest, look for the 'AtRestEncryptionEnabled' field in the JSON output. If it is set to 'true', then the cluster is encrypted at rest. If it is 'false' or the field is not present, then the cluster is not encrypted at rest.

4. To check if the Elasticache clusters are encrypted in transit, look for the 'TransitEncryptionEnabled' field in the JSON output. If it is set to 'true', then the cluster is encrypted in transit. If it is 'false' or the field is not present, then the cluster is not encrypted in transit.

#### Using Python

To check if ElasticCache is encrypted at rest and in transit in Elastic Search using Python scripts, you can use the Boto3 library, which allows you to write software that makes use of services like Amazon S3, Amazon EC2, and others. Here are the steps:

1. **Install Boto3:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. Install it using pip:
   ```
   pip install boto3
   ```

2. **Configure AWS Credentials:**
   Before you can begin using Boto3, you should set up authentication credentials. You can do this in several ways, but the easiest is to use the AWS CLI tool to configure everything. If you've already done this, you're good to go; otherwise, you may need to install the AWS CLI. Run this command and follow the prompts:
   ```
   aws configure
   ```

3. **Create a Python Script to Check Encryption at Rest:**
   Here is a sample Python script that uses Boto3 to check if ElasticCache is encrypted at rest:
   ```python
   import boto3

   def check_elasticache_encryption_at_rest():
       client = boto3.client('elasticache')
       response = client.describe_cache_clusters()
       for cluster in response['CacheClusters']:
           if 'AtRestEncryptionEnabled' in cluster:
               if cluster['AtRestEncryptionEnabled']:
                   print(f"Cluster {cluster['CacheClusterId']} is encrypted at rest.")
               else:
                   print(f"Cluster {cluster['CacheClusterId']} is NOT encrypted at rest.")
           else:
               print(f"Cluster {cluster['CacheClusterId']} does not support encryption at rest.")

   check_elasticache_encryption_at_rest()
   ```
   
4. **Create a Python Script to Check Encryption in Transit:**
   Here is a sample Python script that uses Boto3 to check if ElasticCache is encrypted in transit:
   ```python
   import boto3

   def check_elasticache_encryption_in_transit():
       client = boto3.client('elasticache')
       response = client.describe_cache_clusters()
       for cluster in response['CacheClusters']:
           if 'TransitEncryptionEnabled' in cluster:
               if cluster['TransitEncryptionEnabled']:
                   print(f"Cluster {cluster['CacheClusterId']} is encrypted in transit.")
               else:
                   print(f"Cluster {cluster['CacheClusterId']} is NOT encrypted in transit.")
           else:
               print(f"Cluster {cluster['CacheClusterId']} does not support encryption in transit.")

   check_elasticache_encryption_in_transit()
   ```
These scripts will print out the cluster ID and whether it is encrypted at rest and in transit. If a cluster does not support encryption, it will also print that out.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Elasticache not being encrypted at rest and in transit in AWS, you can follow the below steps:

1. Log in to your AWS console.
2. Go to the Elasticache service.
3. Select the cluster that you want to encrypt.
4. Click on the "Modify" button.
5. Scroll down to the "Advanced Redis Settings" section.
6. Enable the "Encryption in transit" option.
7. Select the "Require encryption" option.
8. Enable the "Encryption at rest" option.
9. Select the "AWS managed CMK" option.
10. Click on the "Save Changes" button.

After completing the above steps, your Elasticache cluster will be encrypted at rest and in transit using AWS managed CMK.

#### Using CLI

To remediate Elasticache misconfiguration for AWS using AWS CLI, you can follow the below steps:

1. First, you need to enable encryption at rest for Elasticache using AWS CLI. You can do this by running the following command:

```
aws elasticache modify-cache-cluster --cache-cluster-id <CACHE_CLUSTER_ID> --transit-encryption-enabled --at-rest-encryption-enabled --security-group-ids <SECURITY_GROUP_IDS>
```

In the above command, replace `<CACHE_CLUSTER_ID>` with the ID of the Elasticache cluster that you want to modify and `<SECURITY_GROUP_IDS>` with the IDs of the security groups that you want to associate with the cluster.

2. After enabling encryption at rest, you need to enable encryption in transit for Elasticache using AWS CLI. You can do this by running the following command:

```
aws elasticache modify-cache-cluster --cache-cluster-id <CACHE_CLUSTER_ID> --cache-security-group-names <CACHE_SECURITY_GROUP_NAMES> --security-group-ids <SECURITY_GROUP_IDS> --apply-immediately
```

In the above command, replace `<CACHE_CLUSTER_ID>` with the ID of the Elasticache cluster that you want to modify, `<CACHE_SECURITY_GROUP_NAMES>` with the names of the cache security groups that you want to associate with the cluster, and `<SECURITY_GROUP_IDS>` with the IDs of the security groups that you want to associate with the cluster.

3. Finally, verify that the Elasticache cluster is encrypted at rest and in transit. You can do this by running the following command:

```
aws elasticache describe-cache-clusters --cache-cluster-id <CACHE_CLUSTER_ID>
```

In the output of the above command, verify that the `TransitEncryptionEnabled` and `AtRestEncryptionEnabled` values are set to `true`.

By following the above steps, you can remediate the Elasticache misconfiguration for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration in AWS Elasticache, you can use Python and follow these steps:

1. Open the AWS Elasticache console and select the cluster that you want to remediate.

2. Click on the "Security" tab and select the "Encryption in transit" option.

3. Enable encryption in transit by selecting the "Enable encryption in transit" checkbox.

4. Select the appropriate security group for your cluster.

5. Choose the SSL/TLS certificate that you want to use for encryption in transit.

6. Click on the "Save" button to save the changes.

7. Next, click on the "Encryption at rest" option.

8. Enable encryption at rest by selecting the "Enable encryption at rest" checkbox.

9. Choose the KMS key that you want to use for encryption at rest.

10. Click on the "Save" button to save the changes.

11. To automate the remediation process using Python, you can use the AWS SDK for Python (Boto3).

12. Install the Boto3 library using pip: `pip install boto3`

13. Create an AWS session using the `boto3.Session()` method.

14. Create an Elasticache client using the `session.client('elasticache')` method.

15. Use the `modify_cache_cluster()` method of the Elasticache client to update the cluster configuration.

16. Set the `TransitEncryptionEnabled` parameter to `True` to enable encryption in transit.

17. Set the `AtRestEncryptionEnabled` parameter to `True` to enable encryption at rest.

18. Set the `KmsKeyId` parameter to the ARN of the KMS key that you want to use for encryption at rest.

19. Call the `modify_cache_cluster()` method to apply the changes to the cluster.

Here's some sample Python code that you can use to remediate the misconfiguration:

```python
import boto3

# Create an AWS session
session = boto3.Session()

# Create an Elasticache client
elasticache = session.client('elasticache')

# Update the cluster configuration
response = elasticache.modify_cache_cluster(
    CacheClusterId='my-cluster',
    TransitEncryptionEnabled=True,
    AtRestEncryptionEnabled=True,
    KmsKeyId='arn:aws:kms:us-west-2:123456789012:key/abcd1234-abcd-1234-abcd-1234abcd1234'
)

# Print the response
print(response)
```

Note: Replace `my-cluster` with the name of your Elasticache cluster and `arn:aws:kms:us-west-2:123456789012:key/abcd1234-abcd-1234-abcd-1234abcd1234` with the ARN of your KMS key.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html](https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html) 


</Tab>
</Tabs>