---
slug: es_https_only
title: ElasticSearch Should Use HTTPS Only
sidebar_label: ElasticSearch Should Use HTTPS Only
---

### More Info:

ElasticSearch domains are configured to enforce HTTPS connections. ElasticSearch domains should be configured to enforce HTTPS connections for all clients to ensure encryption of data in transit.

### Risk Level

Low

### Address

Security

### Compliance Standards

AWSWAF, HITRUST, SOC2, PCIDSS


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service (Amazon ES) dashboard.
3. In the navigation pane, choose "Domains".
4. In the "Domains" list, select the Elasticsearch domain that you want to examine.
5. In the "Domain overview" section, check the "Domain endpoint" value. If the protocol is not HTTPS, then the selected Amazon Elasticsearch domain is not using secure communication (HTTPS) for all the traffic to and from the domain.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "describe-elasticsearch-domain-config" command to retrieve the configuration information of the specified Elasticsearch domain. The command syntax is as follows:

   ```
   aws es describe-elasticsearch-domain-config --domain-name <your_domain_name>
   ```

   Replace "<your_domain_name>" with the name of your Elasticsearch domain.

3. The output of the command will be in JSON format. You need to check the "DomainConfig" section in the output. Under this section, look for the "ElasticsearchClusterConfig" field. This field contains the configuration settings for the Elasticsearch domain.

4. Specifically, you need to check the "TLSSecurityPolicy" field under the "DomainEndpointOptions" section. If the value of this field is not "Policy-Min-TLS-1-2-2019-07", it means that the Elasticsearch domain is not using HTTPS only.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary libraries: You will need the boto3 library for AWS services and the requests library to make HTTP requests.

```python
import boto3
import requests
```

2. Create a session using your AWS credentials and initialize the ElasticSearch client:

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)

es_client = session.client('es')
```

3. Get the list of all ElasticSearch domains and check the domain configuration:

```python
response = es_client.list_domain_names()

for domain in response['DomainNames']:
    domain_name = domain['DomainName']
    domain_config = es_client.describe_elasticsearch_domain(DomainName=domain_name)
```

4. Check if HTTPS is enabled for the domain:

```python
domain_endpoint = domain_config['DomainStatus']['Endpoints']['vpc']
response = requests.get('http://' + domain_endpoint)

if response.status_code == 200:
    print(f"Domain {domain_name} is not using HTTPS.")
else:
    print(f"Domain {domain_name} is using HTTPS.")
```

This script will print out the names of all ElasticSearch domains that are not using HTTPS. If a domain is using HTTPS, a GET request to the HTTP endpoint should fail, indicating that HTTPS is being used.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using the AWS console, you can follow the below steps:

1. Log in to the AWS Management Console and navigate to the ElasticSearch service.

2. Select the misconfigured ElasticSearch domain.

3. In the domain dashboard, click on the "Edit" button in the "Encryption" section.

4. In the "Encryption" section, select the "Require HTTPS" option.

5. Click on the "Save Changes" button to apply the new configuration.

6. Once the changes are saved, ElasticSearch will only be accessible through HTTPS.

7. Verify the changes by attempting to access the ElasticSearch domain using HTTP. It should not be accessible and should return an error message.

By following these steps, you can remediate the misconfiguration of ElasticSearch not using HTTPS only in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI and run the following command to get the current status of the ElasticSearch domain:

   ```
   aws es describe-elasticsearch-domain --domain-name <domain-name>
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

2. Check the output of the above command for the value of the `EncryptionAtRestOptions` parameter. If it is not set to `Enabled`, then run the following command to enable encryption at rest:

   ```
   aws es update-elasticsearch-domain-config --domain-name <domain-name> --encryption-at-rest-options Enabled=true
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

3. Next, run the following command to update the ElasticSearch domain to use HTTPS only:

   ```
   aws es update-elasticsearch-domain-config --domain-name <domain-name> --advanced-security-options Enabled=true,InternalUserDatabaseEnabled=false,MasterUserOptions.Enabled=false,NodeToNodeEncryptionOptions.Enabled=false,EncryptionAtRestOptions.Enabled=true,HTTPSEnabled=true
   ```

   Replace `<domain-name>` with the name of your ElasticSearch domain.

4. After running the above command, wait for a few minutes for the changes to take effect. You can check the status of the ElasticSearch domain again by running the `describe-elasticsearch-domain` command.

   ```
   aws es describe-elasticsearch-domain --domain-name <domain-name>
   ```

   If the output of this command shows that the `HTTPSEnabled` parameter is set to `true`, then the ElasticSearch domain is now using HTTPS only.

By following these steps, you can remediate the ElasticSearch misconfiguration of using HTTPS only in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate this misconfiguration on AWS using Python, you can follow the steps below:

1. Install the AWS SDK for Python (Boto3) by running the following command in your terminal:

```python
pip install boto3
```

2. Create an AWS ElasticSearch client using the Boto3 library:

```python
import boto3

es_client = boto3.client('es')
```

3. Get the ElasticSearch domain configuration using the `describe_elasticsearch_domain` method:

```python
domain_name = 'your-domain-name'
domain_config = es_client.describe_elasticsearch_domain(DomainName=domain_name)
```

4. Check if the ElasticSearch domain is using HTTPS only by looking at the `DomainStatus` dictionary:

```python
domain_status = domain_config['DomainStatus']
if domain_status['EncryptionAtRestOptions']['Enabled'] and domain_status['NodeToNodeEncryptionOptions']['Enabled'] and domain_status['AdvancedSecurityOptions']['Enabled']:
    print('ElasticSearch domain is already using HTTPS only')
else:
    # Remediate the misconfiguration
```

5. If the ElasticSearch domain is not using HTTPS only, update the domain configuration using the `update_elasticsearch_domain_config` method:

```python
from botocore.exceptions import ClientError

try:
    response = es_client.update_elasticsearch_domain_config(
        DomainName=domain_name,
        AdvancedSecurityOptions={
            'Enabled': True,
            'InternalUserDatabaseEnabled': False,
            'MasterUserOptions': {
                'MasterUserARN': 'arn:aws:iam::123456789012:user/elasticsearch-master-user',
                'MasterUserName': 'elasticsearch-master-user',
                'MasterUserPassword': 'your-password'
            }
        }
    )
    print('ElasticSearch domain configuration updated successfully')
except ClientError as e:
    print('Error updating ElasticSearch domain configuration: {}'.format(e))
```

6. Verify that the ElasticSearch domain is now using HTTPS only by checking the `DomainStatus` dictionary again:

```python
domain_config = es_client.describe_elasticsearch_domain(DomainName=domain_name)
domain_status = domain_config['DomainStatus']
if domain_status['EncryptionAtRestOptions']['Enabled'] and domain_status['NodeToNodeEncryptionOptions']['Enabled'] and domain_status['AdvancedSecurityOptions']['Enabled']:
    print('ElasticSearch domain is now using HTTPS only')
else:
    print('Failed to remediate ElasticSearch misconfiguration')
```

Note: In the code above, we assume that the ElasticSearch domain is not using VPC and that you have an IAM user with the necessary permissions to update the ElasticSearch domain configuration. Also, make sure to replace `your-domain-name` and `your-password` with the actual values for your ElasticSearch domain.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createupdatedomains.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createupdatedomains.html) 

