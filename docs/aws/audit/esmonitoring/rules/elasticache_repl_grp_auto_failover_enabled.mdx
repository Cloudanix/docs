---
slug: elasticache_repl_grp_auto_failover_enabled
title: Elasticache Automatic Failover Should Be Enabled  
sidebar_label: Elasticache Automatic Failover Should Be Enabled  
---

### More Info:

This rule checks if Amazon ElastiCache Redis replication groups have automatic failover enabled. The rule is NON_COMPLIANT for an ElastiCache replication group if ‘AutomaticFailover’ is not set to ‘enabled’.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having Automatic Failover enabled in Amazon ElastiCache for Redis using the AWS Management Console, follow these steps:

1. **Navigate to ElastiCache Dashboard:**
   - Sign in to the AWS Management Console.
   - In the Services menu, select "ElastiCache" under the "Database" category.

2. **Select the Redis Cluster:**
   - In the ElastiCache dashboard, click on "Redis" to view your Redis clusters.
   - Select the Redis cluster for which you want to enable Automatic Failover.

3. **Modify the Cluster:**
   - With the cluster selected, click on the "Actions" dropdown menu.
   - Choose "Modify" from the list of actions.

4. **Enable Automatic Failover:**
   - In the Modify Cluster settings, look for the "Automatic Failover" option.
   - Check the box to enable Automatic Failover.
   - Click on the "Modify" button at the bottom of the page to save your changes.

By following these steps, you ensure that Automatic Failover is enabled for your ElastiCache Redis cluster, enhancing its availability and resilience.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of not having Automatic Failover enabled in Amazon ElastiCache for Redis using AWS CLI, follow these steps:

1. **Check Current Configuration:**
   First, verify the current configuration of your ElastiCache replication group to see if Automatic Failover is enabled.
   ```sh
   aws elasticache describe-replication-groups --replication-group-id <replication-group-id>
   ```

2. **Modify Replication Group to Enable Automatic Failover:**
   If Automatic Failover is not enabled, you can modify the replication group to enable it.
   ```sh
   aws elasticache modify-replication-group \
       --replication-group-id <replication-group-id> \
       --automatic-failover-enabled
   ```

3. **Verify Changes:**
   After modifying the replication group, verify that the changes have been applied successfully.
   ```sh
   aws elasticache describe-replication-groups --replication-group-id <replication-group-id>
   ```

4. **Monitor Replication Group:**
   Continuously monitor the replication group to ensure that Automatic Failover remains enabled.
   ```sh
   aws elasticache describe-events --source-identifier <replication-group-id> --source-type replication-group
   ```

By following these steps, you can ensure that Automatic Failover is enabled for your ElastiCache replication group, thereby preventing potential misconfigurations.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of Elasticache Automatic Failover not being enabled in Amazon Elasticache using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that Automatic Failover is enabled:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

3. **Check and Enable Automatic Failover**:
   Use the following Python script to check if Automatic Failover is enabled for your Elasticache replication groups and enable it if it is not.

   ```python
   import boto3

   # Initialize a session using Amazon ElastiCache
   client = boto3.client('elasticache')

   # List all replication groups
   response = client.describe_replication_groups()

   for replication_group in response['ReplicationGroups']:
       replication_group_id = replication_group['ReplicationGroupId']
       automatic_failover_status = replication_group['AutomaticFailover']

       # Check if Automatic Failover is enabled
       if automatic_failover_status != 'enabled':
           print(f"Enabling Automatic Failover for replication group: {replication_group_id}")
           # Modify the replication group to enable Automatic Failover
           client.modify_replication_group(
               ReplicationGroupId=replication_group_id,
               AutomaticFailoverEnabled=True,
               ApplyImmediately=True
           )
       else:
           print(f"Automatic Failover is already enabled for replication group: {replication_group_id}")
   ```

4. **Run the Script**:
   Execute the script to ensure that Automatic Failover is enabled for all your Elasticache replication groups.

   ```bash
   python enable_automatic_failover.py
   ```

This script will iterate through all your Elasticache replication groups, check if Automatic Failover is enabled, and enable it if it is not. This ensures that your Elasticache clusters are configured correctly to handle failovers automatically.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the ElastiCache dashboard.

2. In the navigation pane, choose "Redis" to access the Redis clusters page.

3. On the Redis clusters page, select the Redis cluster that you want to examine.

4. In the lower panel, under the "Details" tab, check the "Automatic Failover" configuration attribute. If the attribute value is set to "disabled", the selected Redis cluster does not have automatic failover enabled.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account using the command `aws configure`. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Elasticache clusters: Use the following command to list all the Elasticache clusters in your AWS account.

   ```
   aws elasticache describe-cache-clusters --query 'CacheClusters[*].[CacheClusterId]'
   ```

   This command will return a list of all the CacheClusterIds in your AWS account.

3. Check the Automatic Failover status: For each CacheClusterId, you need to check the Automatic Failover status. Use the following command to do this:

   ```
   aws elasticache describe-replication-groups --query 'ReplicationGroups[*].[ReplicationGroupId, AutomaticFailover]'
   ```

   This command will return a list of all the ReplicationGroupIds and their Automatic Failover status.

4. Analyze the output: If the Automatic Failover status is 'enabled' for all the ReplicationGroupIds, then there is no misconfiguration. If any ReplicationGroupId has the Automatic Failover status as 'disabled', then it is a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To check if Automatic Failover is enabled for AWS ElastiCache, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Import the necessary modules and create a session:**

    You need to import Boto3 and create a session using your AWS credentials.

    ```python
    import boto3

    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='us-west-2'
    )
    ```

2. **Create an ElastiCache client:**

    Use the session to create a client for ElastiCache.

    ```python
    elasticache = session.client('elasticache')
    ```

3. **List all replication groups:**

    Use the `describe_replication_groups()` method to get a list of all replication groups.

    ```python
    replication_groups = elasticache.describe_replication_groups()
    ```

4. **Check if Automatic Failover is enabled:**

    Iterate over the replication groups and check the `AutomaticFailover` attribute. If it's 'enabled', then Automatic Failover is enabled. If it's 'disabled', then it's not.

    ```python
    for group in replication_groups['ReplicationGroups']:
        if group['AutomaticFailover'] != 'enabled':
            print(f"Automatic Failover is not enabled for replication group {group['ReplicationGroupId']}")
    ```

This script will print out the IDs of all replication groups where Automatic Failover is not enabled. You can modify it to suit your needs, for example by raising an exception or sending an alert if any such groups are found.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Elasticache Automatic Failover not being enabled for AWS ElastiCache using the AWS Management Console, follow these step-by-step instructions:

1. **Access AWS Management Console**: Go to the AWS Management Console at https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to ElastiCache Dashboard**: Click on the "Services" dropdown menu at the top left corner of the console and select "ElastiCache" under the "Database" section.

3. **Select Redis Cluster**: In the ElastiCache dashboard, select the Redis cluster for which you want to enable automatic failover.

4. **Modify the Cluster**: Click on the name of the Redis cluster to access its details. In the cluster details page, click on the "Modify" button at the top.

5. **Enable Automatic Failover**: Scroll down to the "Advanced Redis settings" section in the modify cluster settings page. Look for the "Automatic Failover" option and set it to "Enabled".

6. **Review and Apply Changes**: Review the other settings to ensure they are correct. Once you have confirmed that automatic failover is enabled and other settings are as desired, click on the "Modify" button at the bottom of the page.

7. **Monitor the Cluster**: After modifying the cluster settings, monitor the cluster to ensure that the changes have been successfully applied. You can do this by checking the cluster status in the ElastiCache dashboard.

By following these steps, you have successfully enabled automatic failover for your AWS ElastiCache Redis cluster, helping to ensure high availability and reliability for your cache system.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Elasticache Automatic Failover not being enabled for AWS ElastiCache using AWS CLI, follow these steps:

1. **Enable Automatic Failover for ElastiCache Cluster**:
   
   Run the following AWS CLI command to modify the ElastiCache cluster to enable automatic failover:
   ```
   aws elasticache modify-replication-group --replication-group-id <your-replication-group-id> --automatic-failover-enabled
   ```

   Replace `<your-replication-group-id>` with the ID of your ElastiCache replication group.

2. **Verify Automatic Failover Configuration**:

   To confirm that the automatic failover has been enabled successfully, describe the ElastiCache replication group using the following command:
   ```
   aws elasticache describe-replication-groups --replication-group-id <your-replication-group-id>
   ```

   Ensure that the `AutomaticFailover` parameter is set to `enabled` in the output.

3. **Monitor and Test Failover**:

   It is recommended to monitor the ElastiCache cluster after enabling automatic failover to ensure that it functions as expected. You can simulate a failover scenario to test the automatic failover capability.

By following these steps, you can successfully remediate the misconfiguration of Elasticache Automatic Failover not being enabled for AWS ElastiCache using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Elasticache Automatic Failover not being enabled for AWS Elasticache using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   
   ```
   pip install boto3
   ```

2. Use the following Python script to enable Automatic Failover for your Elasticache cluster:

```python
import boto3

# Initialize the Elasticache client
elasticache_client = boto3.client('elasticache')

# Specify the cluster identifier of your Elasticache cluster
cluster_id = 'your-cluster-id'

# Enable Automatic Failover for the specified cluster
response = elasticache_client.modify_replication_group(
    ReplicationGroupId=cluster_id,
    AutomaticFailoverEnabled=True
)

print("Automatic Failover has been enabled for the Elasticache cluster.")
```

3. Replace `'your-cluster-id'` with the actual identifier of your Elasticache cluster.

4. Run the Python script. It will enable Automatic Failover for the specified Elasticache cluster.

By following these steps and running the Python script, you can remediate the misconfiguration of Elasticache Automatic Failover not being enabled for your AWS Elasticache cluster.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

