---
slug: es_dedicated_master_enabled
title: Elasticsearch Clusters Should Have Dedicated Master Enabled
sidebar_label: Elasticsearch Clusters Should Have Dedicated Master Enabled
---

### More Info:

Your AWS Elasticsearch Service (ES) clusters should be using dedicated master nodes to improve their environmental stability by offloading all the management tasks from the cluster data nodes.

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard. 
3. In the navigation pane, choose "Elasticsearch Service" and then select "Domains".
4. In the "Domains" panel, select the Elasticsearch domain that you want to examine.
5. In the selected domain's configuration settings, look for the "Dedicated Master" option under the "Cluster Configuration" section. If the "Dedicated Master" option is not enabled, it indicates that the Elasticsearch cluster does not have a dedicated master node, which is a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Elasticsearch domains: Use the following AWS CLI command to list all the Elasticsearch domains in your AWS account:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all Elasticsearch domain names.

3. Describe Elasticsearch domain configuration: For each domain name from the previous step, use the following AWS CLI command to describe the domain configuration:

   ```
   aws es describe-elasticsearch-domain-config --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your Elasticsearch domain. This command will return the configuration details of the specified Elasticsearch domain.

4. Check Dedicated Master Enabled: In the output of the previous command, look for the `ElasticsearchClusterConfig` section. If the `DedicatedMasterEnabled` field is set to `false`, then the Elasticsearch cluster does not have a dedicated master enabled. If it's set to `true`, then a dedicated master is enabled.

#### Using Python

1. Install the necessary Python libraries: To interact with AWS Elasticsearch, you need to install the `boto3` library. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by setting the following environment variables:

   ```python
   import os
   os.environ["AWS_ACCESS_KEY_ID"] = "your_access_key_id"
   os.environ["AWS_SECRET_ACCESS_KEY"] = "your_secret_access_key"
   os.environ["AWS_SESSION_TOKEN"] = "your_session_token" # if you have one
   ```

3. Connect to AWS Elasticsearch: Now, you can connect to AWS Elasticsearch and list all your Elasticsearch domains:

   ```python
   import boto3

   es = boto3.client('es')

   response = es.list_domain_names()
   domains = [domain['DomainName'] for domain in response['DomainNames']]
   ```

4. Check if dedicated master is enabled: For each domain, you can check if the dedicated master is enabled:

   ```python
   for domain in domains:
       response = es.describe_elasticsearch_domain(DomainName=domain)
       domain_config = response['DomainStatus']
       if 'ElasticsearchClusterConfig' in domain_config:
           cluster_config = domain_config['ElasticsearchClusterConfig']
           if 'DedicatedMasterEnabled' in cluster_config:
               if cluster_config['DedicatedMasterEnabled']:
                   print(f"Dedicated master is enabled for {domain}")
               else:
                   print(f"Dedicated master is not enabled for {domain}")
           else:
               print(f"Dedicated master is not enabled for {domain}")
       else:
           print(f"Dedicated master is not enabled for {domain}")
   ```
   
This script will print out whether the dedicated master is enabled for each of your Elasticsearch domains. If it is not enabled for a domain, that is a misconfiguration.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions on how to remediate the Elasticsearch cluster misconfiguration in AWS:

1. Log in to your AWS Management Console.
2. Go to the Elasticsearch service dashboard.
3. Select the Elasticsearch cluster that needs remediation.
4. Click on the "Modify" button.
5. Scroll down to the "Dedicated master nodes" section.
6. Enable the "Dedicated master nodes" option.
7. Select the instance type for the dedicated master nodes.
8. Choose the number of dedicated master nodes you want to have.
9. Click on the "Review and Submit" button.
10. Review the changes you made and click on the "Submit" button to apply the changes.

Once you have completed these steps, your Elasticsearch cluster will have dedicated master nodes enabled, which will help to improve the cluster's stability and reliability.

#### Using CLI

To remediate the Elasticsearch cluster misconfiguration in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local computer or EC2 instance.

2. Get the Elasticsearch domain name using the following command:

```
aws es list-domain-names
```

3. Get the Elasticsearch cluster configuration using the following command:

```
aws es describe-elasticsearch-domain --domain-name <your_domain_name>
```

4. Check if the Dedicated Master is enabled or not. If it is not enabled, you will see "false" in the output of the above command.

5. To enable the Dedicated Master, use the following command:

```
aws es update-elasticsearch-domain-config --domain-name <your_domain_name> --elasticsearch-cluster-config '{"DedicatedMasterEnabled":true,"ZoneAwarenessEnabled":true,"DedicatedMasterCount":3,"InstanceType":"m4.large.elasticsearch","ZoneAwarenessConfig":{"AvailabilityZoneCount":2}}'
```

6. Wait for a few minutes for the changes to take effect.

7. Verify the configuration by running the same command as step 3.

8. Check if the Dedicated Master is enabled or not. If it is enabled, you will see "true" in the output of the above command.

By following these steps, you can remediate the Elasticsearch cluster misconfiguration of not having Dedicated Master enabled in AWS using AWS CLI.

#### Using Python

To remediate the Elasticsearch cluster misconfiguration for AWS using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) using the following command:

```
pip install boto3
```

2. Create an AWS Elastic Cloud Compute (EC2) instance and install Elasticsearch on it. You can use the following code to create an EC2 instance:

```python
import boto3

ec2 = boto3.resource('ec2', region_name='your_region')

instance = ec2.create_instances(
    ImageId='your_ami_id',
    InstanceType='your_instance_type',
    KeyName='your_key_pair_name',
    MinCount=1,
    MaxCount=1
)
```

3. Install the Elasticsearch Python client using the following command:

```
pip install elasticsearch
```

4. Use the Elasticsearch Python client to enable dedicated master nodes for the Elasticsearch cluster. You can use the following code:

```python
from elasticsearch import Elasticsearch

es = Elasticsearch([
    {'host': 'your_elasticsearch_host', 'port': 'your_elasticsearch_port'}
])

# Enable dedicated master nodes
es.cluster.put_settings(body={
    "persistent": {
        "discovery": {
            "zen": {
                "minimum_master_nodes": 2
            }
        }
    }
})
```

5. Verify that dedicated master nodes have been enabled by checking the Elasticsearch cluster settings using the following code:

```python
# Get Elasticsearch cluster settings
settings = es.cluster.get_settings()

# Check if dedicated master nodes are enabled
if settings['persistent']['discovery']['zen']['minimum_master_nodes'] == 2:
    print("Dedicated master nodes enabled")
else:
    print("Dedicated master nodes not enabled")
```

6. Delete the EC2 instance that you created in step 2 using the following code:

```python
# Get EC2 instance ID
instance_id = instance[0].instance_id

# Terminate EC2 instance
ec2.instances.filter(InstanceIds=[instance_id]).terminate()
```

By following these steps, you can remediate the Elasticsearch cluster misconfiguration for AWS using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-managedomains-dedicatedmasternodes.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-managedomains-dedicatedmasternodes.html) 


</Tab>
</Tabs>