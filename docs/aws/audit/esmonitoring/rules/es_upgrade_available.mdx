---
slug: es_upgrade_available
title: ElasticSearch Domains Should Use The Latest Service Software
sidebar_label: ElasticSearch Domains Should Use The Latest Service Software
---

### More Info:

ElasticSearch domains should be running the latest service software. ElasticSearch domains should be configured to run the latest service software which often contains security updates.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

AWSWAF, SOC2, NISTCSF




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard. You can do this by typing "Elasticsearch Service" into the search bar at the top of the console, then selecting "Elasticsearch Service" from the dropdown menu.
3. In the Elasticsearch Service dashboard, you will see a list of your Elasticsearch domains. Click on the name of the domain you want to check.
4. In the domain overview page, look for the "Elasticsearch version" field. This will tell you the current version of the Elasticsearch service software that the domain is using. If this is not the latest version, then the domain is not using the latest service software.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS CLI website. Once installed, you can configure it by running `aws configure` and providing your AWS credentials.

2. List all Elasticsearch domains: Use the following command to list all the Elasticsearch domains in your AWS account:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all Elasticsearch domains.

3. Describe Elasticsearch domain configuration: For each domain listed in the previous step, use the following command to get the detailed configuration:

   ```
   aws es describe-elasticsearch-domain-config --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your Elasticsearch domain. This command will return a JSON object that contains the configuration of the specified domain.

4. Check the Elasticsearch version: In the output of the previous command, look for the `ElasticsearchVersion` field. This field indicates the version of Elasticsearch that is currently being used by the domain. If this version is not the latest, then the domain is using outdated service software.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The `boto3` library is the Amazon Web Services (AWS) SDK for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Import the necessary libraries and establish a session: In your Python script, you need to import the `boto3` library and establish a session with AWS. You also need to create an Elasticsearch client.

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )

   es_client = session.client('es')
   ```

3. List all Elasticsearch domains: Use the `list_domain_names` method to get a list of all Elasticsearch domains.

   ```python
   domains = es_client.list_domain_names()
   ```

4. Check the service software version for each domain: For each domain in the list, use the `describe_elasticsearch_domain` method to get the domain configuration. Then, check the `ElasticsearchVersion` field in the response. If the version is not the latest, then the domain is using outdated service software.

   ```python
   for domain in domains['DomainNames']:
       domain_config = es_client.describe_elasticsearch_domain(DomainName=domain['DomainName'])
       version = domain_config['DomainStatus']['ElasticsearchVersion']
       if version < '7.10':  # replace '7.10' with the latest version number
           print(f"Domain {domain['DomainName']} is using outdated service software version {version}")
   ```

Please replace `'YOUR_ACCESS_KEY'`, `'YOUR_SECRET_KEY'` with your actual AWS access key and secret key. Also, replace `'us-west-2'` with the actual region that you are using. The version '7.10' is just an example, replace it with the actual latest version number.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step by step instructions to remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using the AWS console:

1. Open the AWS Management Console and navigate to the Amazon Elasticsearch Service dashboard.

2. Select the Elasticsearch domain that you want to update.

3. Click on the "Actions" button and select "Upgrade Elasticsearch Version".

4. In the "Upgrade Elasticsearch Version" dialog box, select the latest version of Elasticsearch that you want to upgrade to.

5. Choose the "Schedule Upgrade" option to schedule the upgrade for a later time or choose the "Upgrade Immediately" option to upgrade Elasticsearch immediately.

6. Review the upgrade details and click on the "Confirm" button to start the upgrade process.

7. Wait for the upgrade process to complete. The Elasticsearch domain will be unavailable during the upgrade process.

8. Once the upgrade process is complete, verify that the Elasticsearch domain is using the latest version of Elasticsearch.

That's it! By following these steps, you can remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using the AWS console.

#### Using CLI

To remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the list of Elasticsearch domains in your AWS account:

```
aws es list-domain-names
```

3. Identify the Elasticsearch domain that needs to be updated to the latest service software.

4. Run the following command to get the details of the Elasticsearch domain:

```
aws es describe-elasticsearch-domain --domain-name <domain-name>
```

Replace `<domain-name>` with the name of the Elasticsearch domain that needs to be updated.

5. Check the value of the `ElasticsearchVersion` parameter in the output. If it is not the latest version, proceed to the next step.

6. Run the following command to update the Elasticsearch domain to the latest service software:

```
aws es update-elasticsearch-domain-config --domain-name <domain-name> --elasticsearch-version "7.10"
```

Replace `<domain-name>` with the name of the Elasticsearch domain that needs to be updated. The `--elasticsearch-version` parameter should be set to the latest version available at the time of remediation. In this example, we have used version 7.10.

7. Wait for the update to complete. You can check the status of the update by running the following command:

```
aws es describe-elasticsearch-domain --domain-name <domain-name>
```

Replace `<domain-name>` with the name of the Elasticsearch domain that was updated.

8. Verify that the Elasticsearch domain is now using the latest service software by checking the value of the `ElasticsearchVersion` parameter in the output of the `describe-elasticsearch-domain` command.

With these steps, you have successfully remediated the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of ElasticSearch Domains Should Use The Latest Service Software in AWS using python, you can follow the below steps:

1. Import the necessary Python libraries: boto3 and json.
```
import boto3
import json
```

2. Create an AWS ElasticSearch client using boto3.
```
client = boto3.client('es')
```

3. Get the list of all Elasticsearch domains in the account using the `list_domain_names()` method.
```
domains = client.list_domain_names()['DomainNames']
```

4. Loop through each domain and check if the domain is using the latest service software version. You can get the latest Elasticsearch version using the `describe_elasticsearch_version()` method.
```
for domain in domains:
    domain_name = domain['DomainName']
    response = client.describe_elasticsearch_version(
        DomainName=domain_name,
        )
    latest_version = response['ElasticsearchVersions'][0]
    domain_info = client.describe_elasticsearch_domain(
        DomainName=domain_name
        )
    current_version = domain_info['DomainStatus']['ElasticsearchVersion']
    if current_version != latest_version:
        print(f"Updating {domain_name} from {current_version} to {latest_version}")
        response = client.update_elasticsearch_domain_config(
            DomainName=domain_name,
            ElasticsearchClusterConfig={
                'ElasticsearchVersion': latest_version,
            }
        )
```

5. Finally, run the Python script to remediate the misconfiguration in AWS ElasticSearch domains. 

Note: You need to have appropriate AWS credentials configured in your environment to run this script.


### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-version-migration.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-version-migration.html) 


</Tab>
</Tabs>