---
slug: es_upgrade_available
title: ElasticSearch Domains Should Use The Latest Service Software
sidebar_label: ElasticSearch Domains Should Use The Latest Service Software
---

### More Info:

ElasticSearch domains should be running the latest service software. ElasticSearch domains should be configured to run the latest service software which often contains security updates.

### Risk Level

Low

### Address

Security, Operational Maturity

### Compliance Standards

AWSWAF, SOC2, NISTCSF



### Triage and Remediation
<Tabs>



<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of ElasticSearch Domains not using the latest service software in AWS, follow these steps using the AWS Management Console:

1. **Navigate to the Amazon Elasticsearch Service:**
   - Open the AWS Management Console.
   - In the search bar, type "Elasticsearch Service" and select it from the dropdown.

2. **Select Your Domain:**
   - In the Amazon Elasticsearch Service dashboard, you will see a list of your Elasticsearch domains.
   - Click on the domain name that you want to check or update.

3. **Check Service Software Version:**
   - In the domain details page, look for the "Service software version" section.
   - Ensure that the version listed is the latest available. AWS usually provides a notification if an update is available.

4. **Enable Auto-Update (Optional but Recommended):**
   - To ensure your domain always uses the latest service software, you can enable auto-updates.
   - In the domain details page, look for the "Service software update" section.
   - If auto-update is not enabled, you can enable it by following the on-screen instructions.

By following these steps, you can ensure that your Elasticsearch domains are using the latest service software, thereby preventing potential misconfigurations and security vulnerabilities.
</Accordion>

<Accordion title='Using CLI'>
To ensure that your Amazon Elasticsearch Service (now known as Amazon OpenSearch Service) domains are using the latest service software, you can follow these steps using the AWS CLI:

1. **List All Elasticsearch Domains:**
   First, you need to list all the Elasticsearch domains in your account to identify which ones need to be updated.
   ```sh
   aws es list-domain-names
   ```

2. **Check the Current Service Software Version:**
   For each domain, check the current service software version to determine if an update is needed.
   ```sh
   aws es describe-elasticsearch-domain --domain-name <domain-name>
   ```

3. **Upgrade the Service Software:**
   If the domain is not using the latest service software, you can initiate an upgrade. Note that this command will start the upgrade process.
   ```sh
   aws es upgrade-elasticsearch-domain --domain-name <domain-name> --target-version <latest-version>
   ```

4. **Monitor the Upgrade Status:**
   After initiating the upgrade, monitor the status to ensure it completes successfully.
   ```sh
   aws es describe-elasticsearch-domain --domain-name <domain-name> --query 'DomainStatus.UpgradeProcessing'
   ```

By following these steps, you can ensure that your Elasticsearch domains are using the latest service software, thereby preventing misconfigurations related to outdated software versions.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of ElasticSearch Domains not using the latest service software in AWS ElasticSearch using Python scripts, you can follow these steps:

1. **Install and Configure Boto3**:
   Ensure you have the AWS SDK for Python (Boto3) installed and configured with the necessary permissions to interact with AWS ElasticSearch.

   ```bash
   pip install boto3
   ```

   Configure your AWS credentials:

   ```bash
   aws configure
   ```

2. **List All ElasticSearch Domains**:
   Use Boto3 to list all the ElasticSearch domains in your AWS account.

   ```python
   import boto3

   es_client = boto3.client('es')

   def list_elasticsearch_domains():
       response = es_client.list_domain_names()
       return [domain['DomainName'] for domain in response['DomainNames']]

   domains = list_elasticsearch_domains()
   print(domains)
   ```

3. **Check Service Software Version**:
   For each domain, check the current service software version and compare it with the latest available version.

   ```python
   def get_domain_service_software_version(domain_name):
       response = es_client.describe_elasticsearch_domain(DomainName=domain_name)
       return response['DomainStatus']['ServiceSoftwareOptions']

   for domain in domains:
       service_software_options = get_domain_service_software_version(domain)
       print(f"Domain: {domain}, Service Software Options: {service_software_options}")
   ```

4. **Automate Updates**:
   If the service software is not up-to-date, automate the update process.

   ```python
   def update_service_software(domain_name):
       response = es_client.update_elasticsearch_domain_config(
           DomainName=domain_name,
           ServiceSoftwareOptions={
               'PerformCheckOnly': False
           }
       )
       return response

   for domain in domains:
       service_software_options = get_domain_service_software_version(domain)
       if not service_software_options['NewVersionAvailable']:
           print(f"Domain {domain} is already using the latest service software.")
       else:
           print(f"Updating service software for domain {domain}...")
           update_response = update_service_software(domain)
           print(f"Update initiated for domain {domain}: {update_response}")
   ```

By following these steps, you can ensure that your ElasticSearch domains are always using the latest service software, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard. You can do this by typing "Elasticsearch Service" into the search bar at the top of the console, then selecting "Elasticsearch Service" from the dropdown menu.
3. In the Elasticsearch Service dashboard, you will see a list of your Elasticsearch domains. Click on the name of the domain you want to check.
4. In the domain overview page, look for the "Elasticsearch version" field. This will tell you the current version of the Elasticsearch service software that the domain is using. If it is not the latest version, then this is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. Make sure you have the necessary permissions to access the ElasticSearch domains.

2. Once the AWS CLI is set up, you can list all the ElasticSearch domains using the following command:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all the ElasticSearch domains.

3. To get the detailed configuration of each domain, use the following command:

   ```
   aws es describe-elasticsearch-domain --domain-name your_domain_name
   ```
   Replace 'your_domain_name' with the actual domain name from the list obtained in the previous step. This command will return a detailed configuration of the specified ElasticSearch domain.

4. In the output of the above command, look for the 'ElasticsearchVersion' field. This field indicates the version of the ElasticSearch service software used by the domain. If the version is not the latest, it indicates a misconfiguration. You need to manually compare this version with the latest version available on the official ElasticSearch website.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. For this task, you will need the boto3 library, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary libraries and establish a session: After installing the necessary libraries, you need to import them into your script and establish a session with AWS.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Connect to the ElasticSearch service: Now that you have a session, you can connect to the ElasticSearch service. You can do this by creating a client for the service.

```python
es_client = session.client('es')
```

4. Check the ElasticSearch domains for the latest service software: Now that you have a client for the ElasticSearch service, you can use it to list all of your ElasticSearch domains and check if they are using the latest service software.

```python
response = es_client.list_domain_names()

for domain in response['DomainNames']:
    domain_info = es_client.describe_elasticsearch_domain(DomainName=domain['DomainName'])
    if not domain_info['DomainStatus']['ServiceSoftwareOptions']['UpdateAvailable']:
        print(f"The domain {domain['DomainName']} is using the latest service software.")
    else:
        print(f"The domain {domain['DomainName']} is not using the latest service software.")
```

This script will print out the names of all ElasticSearch domains that are not using the latest service software.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step by step instructions to remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using the AWS console:

1. Open the AWS Management Console and navigate to the Amazon Elasticsearch Service dashboard.

2. Select the Elasticsearch domain that you want to update.

3. Click on the "Actions" button and select "Upgrade Elasticsearch Version".

4. In the "Upgrade Elasticsearch Version" dialog box, select the latest version of Elasticsearch that you want to upgrade to.

5. Choose the "Schedule Upgrade" option to schedule the upgrade for a later time or choose the "Upgrade Immediately" option to upgrade Elasticsearch immediately.

6. Review the upgrade details and click on the "Confirm" button to start the upgrade process.

7. Wait for the upgrade process to complete. The Elasticsearch domain will be unavailable during the upgrade process.

8. Once the upgrade process is complete, verify that the Elasticsearch domain is using the latest version of Elasticsearch.

That's it! By following these steps, you can remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the list of Elasticsearch domains in your AWS account:

```
aws es list-domain-names
```

3. Identify the Elasticsearch domain that needs to be updated to the latest service software.

4. Run the following command to get the details of the Elasticsearch domain:

```
aws es describe-elasticsearch-domain --domain-name <domain-name>
```

Replace `<domain-name>` with the name of the Elasticsearch domain that needs to be updated.

5. Check the value of the `ElasticsearchVersion` parameter in the output. If it is not the latest version, proceed to the next step.

6. Run the following command to update the Elasticsearch domain to the latest service software:

```
aws es update-elasticsearch-domain-config --domain-name <domain-name> --elasticsearch-version "7.10"
```

Replace `<domain-name>` with the name of the Elasticsearch domain that needs to be updated. The `--elasticsearch-version` parameter should be set to the latest version available at the time of remediation. In this example, we have used version 7.10.

7. Wait for the update to complete. You can check the status of the update by running the following command:

```
aws es describe-elasticsearch-domain --domain-name <domain-name>
```

Replace `<domain-name>` with the name of the Elasticsearch domain that was updated.

8. Verify that the Elasticsearch domain is now using the latest service software by checking the value of the `ElasticsearchVersion` parameter in the output of the `describe-elasticsearch-domain` command.

With these steps, you have successfully remediated the misconfiguration "ElasticSearch Domains Should Use The Latest Service Software" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of ElasticSearch Domains Should Use The Latest Service Software in AWS using python, you can follow the below steps:

1. Import the necessary Python libraries: boto3 and json.
```
import boto3
import json
```

2. Create an AWS ElasticSearch client using boto3.
```
client = boto3.client('es')
```

3. Get the list of all Elasticsearch domains in the account using the `list_domain_names()` method.
```
domains = client.list_domain_names()['DomainNames']
```

4. Loop through each domain and check if the domain is using the latest service software version. You can get the latest Elasticsearch version using the `describe_elasticsearch_version()` method.
```
for domain in domains:
    domain_name = domain['DomainName']
    response = client.describe_elasticsearch_version(
        DomainName=domain_name,
        )
    latest_version = response['ElasticsearchVersions'][0]
    domain_info = client.describe_elasticsearch_domain(
        DomainName=domain_name
        )
    current_version = domain_info['DomainStatus']['ElasticsearchVersion']
    if current_version != latest_version:
        print(f"Updating {domain_name} from {current_version} to {latest_version}")
        response = client.update_elasticsearch_domain_config(
            DomainName=domain_name,
            ElasticsearchClusterConfig={
                'ElasticsearchVersion': latest_version,
            }
        )
```

5. Finally, run the Python script to remediate the misconfiguration in AWS ElasticSearch domains. 

Note: You need to have appropriate AWS credentials configured in your environment to run this script.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-version-migration.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-version-migration.html) 

