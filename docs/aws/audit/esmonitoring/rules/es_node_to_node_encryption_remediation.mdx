### Remediation

How to enable node-to-node encryption for your existing Amazon ElasticSearch domains?

#### Using AWS Console

- Step 1: Choose the ES domain that you want to re-create (see Audit section part I to identify the right resource), then click on the domain name (link) to access its configuration page.

- Step 2: On the selected domain configuration page, perform the following actions:
  A: Select the Overview tab and copy the domain configuration information such as Instance count, Instance type, Dedicated master instance type, Dedicated master instance count, Storage Type, EBS volume type, EBS volume size and so on.
  B: Select the VPC tab and copy the network configuration information such as VPC ID, Security groups ID(s), IAM role name and AZs and Subnets IDs.
  C: Click on Modify access policy button from the dashboard top menu and copy the policy document available in the Add or edit the access policy textbox.

- Step 3: Go back to the AWS ElasticSearch service dashboard and click Create new domain to launch a new ES domain. On Define domain page, perform the following:
  A: Provide a unique name for the new ES domain in the Elasticsearch domain name box.
  B: Select the appropriate version of the Elasticsearch engine from the Elasticsearch version dropdown list. Note that node-to-node encryption can be enabled only for domains with ElasticSearch version 6.0 and above.
  C: Click Next to continue the domain setup process.

- Step 4: On Configure cluster page, set the new domain parameters using the configuration details copied at step no. 4, a. from the source ES domain, then click Next.

- Step 5: On the Set up access page, perform the following:
  A: Configure the network access for the new ES domain by using the same parameters copied at step no. 4 b.
  B: Select node-to-node encryption checkbox to enable the node-to-node encryption feature for the new domain (cluster).
  C:Paste the access policy copied at step no. 4 c. into the Add or edit the access policy textbox to use the same access policy as the source domain. Then click Next.

- Step 6: On Review page, verify the domain configuration details then click Confirm to launch your new AWS ElasticSearch cluster with node-to-node encryption enabled. Once the new AWS ES domain is created, upload the data from the source AWS ES domain to the new (destination) domain.

- Step 7: Now you can remove the source ElasticSearch domain in order to avoid further charges for this AWS resource. To delete the required domain, perform the following actions:
  A: Click on the name of the domain that you want to remove (see Audit section part I to identify the right ElasticSearch resource).
  B: On the selected domain description page, click Delete domain to start the removal process.
  C: Inside the Delete domain dialog box, check Delete the domain \<domain_name\> then click the Delete button to confirm the action.
