---
slug: es_node_to_node_encryption
title: ElasticSearch Domains Should Have Node To Node Encryption
sidebar_label: ElasticSearch Domains Should Have Node To Node Encryption
---

### More Info:

ElasticSearch domain traffic should be encrypted in transit between nodes. ElasticSearch domains should use node-to-node encryption to ensure data in transit remains encrypted using TLS 1.2.

### Risk Level

High

### Address

Security

### Compliance Standards

HIPAA, GDPR, NIST, HITRUST, SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the Amazon Elasticsearch Service dashboard. You can do this by typing "Elasticsearch Service" in the search bar and selecting it from the dropdown menu.
3. In the Amazon Elasticsearch Service dashboard, you will see a list of your Elasticsearch domains. Click on the name of the domain you want to check.
4. In the domain configuration page, look for the "Node-to-node encryption" setting under the "Encryption" section. If it's set to "Disabled", then node-to-node encryption is not enabled for this domain.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. Make sure you have the necessary permissions to access the ElasticSearch domains.

2. Once the AWS CLI is set up, you can list all the ElasticSearch domains using the following command:

   ```
   aws es list-domain-names
   ```
   This command will return a list of all the ElasticSearch domains.

3. Now, for each domain, you can describe the ElasticSearch domain configuration using the following command:

   ```
   aws es describe-elasticsearch-domain --domain-name <your-domain-name>
   ```
   Replace `<your-domain-name>` with the name of your ElasticSearch domain. This command will return the configuration details of the specified ElasticSearch domain.

4. In the output of the above command, look for the `NodeToNodeEncryptionOptions` field. If the `Enabled` field under `NodeToNodeEncryptionOptions` is set to `false`, it means that Node to Node Encryption is not enabled for that ElasticSearch domain.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. You will need the `boto3` library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: To interact with AWS services, you need to set up your AWS credentials. You can do this by setting the AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables. Alternatively, you can use the AWS CLI and configure your credentials with `aws configure`.

3. Write the Python script: Now you can write the Python script that checks if Node to Node Encryption is enabled for all ElasticSearch domains. Here is a simple script that does this:

   ```python
   import boto3

   def check_node_to_node_encryption():
       client = boto3.client('es')
       domains = client.list_domain_names()
       for domain in domains['DomainNames']:
           domain_name = domain['DomainName']
           domain_config = client.describe_elasticsearch_domain(DomainName=domain_name)
           if not domain_config['DomainStatus']['NodeToNodeEncryptionOptions']['Enabled']:
               print(f"Node to Node Encryption is not enabled for domain: {domain_name}")

   if __name__ == "__main__":
       check_node_to_node_encryption()
   ```
   
   This script first creates a client for the ElasticSearch service. It then retrieves a list of all ElasticSearch domains. For each domain, it checks the configuration to see if Node to Node Encryption is enabled. If it is not, it prints a message with the domain name.

4. Run the script: Finally, you can run the script using Python. If there are any domains where Node to Node Encryption is not enabled, they will be printed to the console. If no such domains exist, the script will not output anything. 

   ```python
   python check_node_to_node_encryption.py
   ```
   
   This will give you the list of all the domains where Node to Node Encryption is not enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the ElasticSearch Domain misconfiguration for AWS using the AWS console:

1. Login to your AWS console and navigate to the ElasticSearch service.

2. Select the ElasticSearch domain that you want to remediate.

3. Click on the "Edit" button to edit the domain configuration.

4. Under the "Encryption" section, select the "Require node-to-node encryption" option.

5. Click on the "Save changes" button to save the updated configuration.

6. Wait for a few minutes for the changes to take effect.

7. Verify that the ElasticSearch domain now has node-to-node encryption enabled by checking the "Encryption" section in the domain configuration.

That's it! You have successfully remediated the ElasticSearch Domain misconfiguration by enabling node-to-node encryption for AWS using the AWS console.

#### Using CLI

To remediate the ElasticSearch Domains should have Node to Node Encryption misconfiguration in AWS using AWS CLI, follow the below steps:

1. Open your terminal and install the AWS CLI if you haven't already installed it.

2. Authenticate the AWS CLI using your AWS credentials.

3. Run the following command to enable Node to Node Encryption for your ElasticSearch domain:

```
aws es update-elasticsearch-domain-config --domain-name <your-domain-name> --node-to-node-encryption-options Enabled=true
```

4. Replace `<your-domain-name>` with the name of your ElasticSearch domain.

5. After running the above command, AWS will update the configuration of your ElasticSearch domain to enable Node to Node Encryption.

6. Verify the configuration by running the following command:

```
aws es describe-elasticsearch-domain --domain-name <your-domain-name> --query "DomainStatus.NodeToNodeEncryptionOptions"
```

7. If the output of the above command shows that Node to Node Encryption is enabled, then the remediation is successful.

Note: Node to Node Encryption is available only in Elasticsearch version 6.0 or later. If your ElasticSearch domain is using an older version, you need to upgrade it to version 6.0 or later before enabling Node to Node Encryption.

#### Using Python

To remediate the misconfiguration that ElasticSearch domains should have node to node encryption in AWS using Python, you can follow these steps:

1. Open the AWS Management Console and navigate to the ElasticSearch service.

2. Select the ElasticSearch domain that requires node to node encryption.

3. In the domain dashboard, click on the "Configure" button.

4. In the "Node-to-Node Encryption" section, click on the "Edit" button.

5. Enable node-to-node encryption by setting the "Enabled" option to "Yes".

6. Click on the "Save Changes" button to apply the changes.

7. To automate this process using Python, you can use the AWS SDK for Python (Boto3) to update the domain configuration. Here's an example code snippet:

```
import boto3

# Set the AWS region and ElasticSearch domain name
region_name = 'your_aws_region'
domain_name = 'your_elasticsearch_domain_name'

# Create a client for the ElasticSearch service
es_client = boto3.client('es', region_name=region_name)

# Update the domain configuration to enable node-to-node encryption
response = es_client.update_elasticsearch_domain_config(
    DomainName=domain_name,
    NodeToNodeEncryptionOptions={
        'Enabled': True
    }
)

# Print the response
print(response)
```

Note: You will need to have the appropriate IAM permissions to update the ElasticSearch domain configuration using Boto3.

### Additional Reading:

- [https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html](https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html) 


</Tab>
</Tabs>