---
slug: guardduty_enabled_centralized
title: GuardDuty Centralized Enablement.
sidebar_label: GuardDuty Centralized Enablement.
---

### More Info:

This rule checks if Amazon GuardDuty is enabled in your AWS account and AWS Region. If you provide an AWS account for centralization, the rule evaluates the GuardDuty results in the centralized account. The rule is COMPLIANT when GuardDuty is enabled.

### Risk Level

Low

### Addresses

Security

### Compliance Standards

CBP,RBI_MD_ITF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon GuardDuty console at https://console.aws.amazon.com/guardduty/.

2. In the navigation pane, choose "Settings". 

3. Under "General", check the status of "Amazon GuardDuty". If it is not enabled, it indicates a misconfiguration.

4. To ensure centralized enablement, check if the GuardDuty is set up to send findings to the master account. This can be verified under "Accounts" in the GuardDuty settings. If the member accounts are not associated with the master account, it indicates a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can use the AWS CLI, you need to install it on your system and configure it with your AWS account credentials. You can install it by using the command `pip install awscli` and configure it by using the command `aws configure`.

2. List all the AWS accounts: You can list all the AWS accounts by using the command `aws organizations list-accounts --output text --query 'Accounts[*].[Id,Email]'`. This command will return a list of all the AWS accounts and their corresponding email addresses.

3. Check the status of GuardDuty: For each AWS account, you can check the status of GuardDuty by using the command `aws guardduty get-detector --detector-id <detector-id>`. Replace `<detector-id>` with the ID of the detector that you want to check. This command will return the status of the detector.

4. Check for centralized enablement: If GuardDuty is enabled, you can check for centralized enablement by using the command `aws guardduty list-members --detector-id <detector-id>`. This command will return a list of all the AWS accounts that are members of the current AWS account's GuardDuty. If the list includes all the AWS accounts, then GuardDuty is centrally enabled.

#### Using Python

1. **Setup AWS SDK (Boto3) in Python Environment:**
   First, you need to set up the AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   After installing boto3, configure your AWS credentials. You can configure your credentials either by setting up environment variables or by using the AWS CLI.

2. **Create a Python Script to Check GuardDuty Centralized Enablement:**
   Create a Python script that uses the Boto3 AWS SDK to interact with the GuardDuty service. The script will list all the detectors in your AWS account and check if GuardDuty is enabled.

   ```python
   import boto3

   def check_guardduty_enablement():
       client = boto3.client('guardduty')
       detectors = client.list_detectors()
       if not detectors['DetectorIds']:
           print("GuardDuty is not enabled.")
       else:
           for detector in detectors['DetectorIds']:
               detector_status = client.get_detector(DetectorId=detector)
               if detector_status['Status'] == 'ENABLED':
                   print(f"GuardDuty is enabled with Detector ID: {detector}")
               else:
                   print(f"GuardDuty is disabled with Detector ID: {detector}")

   check_guardduty_enablement()
   ```

3. **Run the Python Script:**
   Run the Python script in your environment. If GuardDuty is enabled, the script will print the Detector ID and status. If GuardDuty is not enabled, it will print a message indicating that GuardDuty is not enabled.

4. **Interpret the Results:**
   Review the output of the script. If GuardDuty is enabled, you will see the Detector ID and status. If it is not enabled, you will see a message indicating that GuardDuty is not enabled. This will help you identify any misconfigurations in GuardDuty centralized enablement.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of GuardDuty Centralized Enablement for AWS Shield using the AWS console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to the GuardDuty Service**: In the AWS Management Console, search for "GuardDuty" in the search bar at the top of the page and select the GuardDuty service from the search results.

3. **Enable GuardDuty**: If GuardDuty is not already enabled, click on the "Enable GuardDuty" button to enable the service in your AWS account.

4. **Configure GuardDuty**: Follow the on-screen instructions to configure GuardDuty for your account. Make sure to select the appropriate settings based on your requirements.

5. **Enable Centralized Management**: In the GuardDuty console, navigate to the "Settings" tab on the left-hand side menu.

6. **Enable Centralized Management**: In the Settings page, locate the "Enable Centralized Management" option and click on the "Edit" button next to it.

7. **Enable Centralized Management**: In the Edit Centralized Management Settings page, select the option to enable centralized management for GuardDuty.

8. **Save Changes**: Click on the "Save" button to save the changes and enable centralized management for GuardDuty.

9. **Verify Centralized Management**: Once the changes are saved, verify that centralized management is enabled by checking the status in the GuardDuty console.

By following these steps, you will be able to remediate the misconfiguration of GuardDuty Centralized Enablement for AWS Shield using the AWS console.

#### Using CLI

To remediate the misconfiguration of GuardDuty Centralized Enablement for AWS Shield using AWS CLI, follow these steps:

1. **List all regions where GuardDuty is not enabled:**
```bash
aws guardduty list-detectors --region <region-name>
```

2. **Enable GuardDuty in the desired region:**
```bash
aws guardduty create-detector --enable --region <region-name>
```

3. **Enable Centralized GuardDuty Management:**
    - Open the AWS Management Console.
    - Go to the GuardDuty service.
    - Click on the "Settings" tab.
    - Enable the "Enable GuardDuty Centralized Management" option.

4. **Enable AWS Shield Advanced:**
    - Open the AWS Management Console.
    - Go to the AWS Shield service.
    - Click on "Activate AWS Shield Advanced".
    - Follow the on-screen instructions to complete the activation.

5. **Verify GuardDuty and AWS Shield configuration:**
    - Use the following command to verify that GuardDuty is enabled in all regions:
    ```bash
    aws guardduty list-detectors
    ```
    - Use the following command to verify that AWS Shield Advanced is enabled:
    ```bash
    aws shield describe-attack
    ```

By following these steps, you can remediate the misconfiguration of GuardDuty Centralized Enablement for AWS Shield using AWS CLI.

#### Using Python

To remediate the "GuardDuty Centralized Enablement" misconfiguration for AWS Shield using Python, you can follow these steps:

1. Import the necessary Python libraries:
```python
import boto3
```

2. Connect to AWS using the Boto3 library:
```python
client = boto3.client('shield')
```

3. Disable GuardDuty Centralized Enablement:
```python
response = client.update_subscription(
    AutoRenew=True,
    Enabled=False
)
```

4. Verify that GuardDuty Centralized Enablement has been successfully disabled:
```python
if response['ResponseMetadata']['HTTPStatusCode'] == 200:
    print("GuardDuty Centralized Enablement has been successfully disabled.")
else:
    print("Failed to disable GuardDuty Centralized Enablement.")
```

By following these steps, you can remediate the "GuardDuty Centralized Enablement" misconfiguration for AWS Shield using Python.



</Tab>
</Tabs>