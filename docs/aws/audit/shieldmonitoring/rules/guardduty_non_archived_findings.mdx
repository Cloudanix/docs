---
slug: guardduty_non_archived_findings
title: Non Archived Findings Enabled For Guardduty
sidebar_label: Non Archived Findings Enabled For Guardduty
---

### More Info:

Checks if Amazon GuardDuty has findings that are non-archived. The rule is NON_COMPLIANT if GuardDuty has non-archived low/medium/high severity findings older than the specified number in the daysLowSev/daysMediumSev/daysHighSev parameter.

### Risk Level

Low

### Addresses

Configuration

### Compliance Standards

CBP,RBI_MD_ITF,RBI_UCB


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon GuardDuty console at https://console.aws.amazon.com/guardduty/.

2. In the navigation pane, choose "Settings".

3. Under "Finding Publishing Frequency", check if "Auto-archive findings" is enabled or not. If it is enabled, it means that the findings are being archived automatically. If it is not enabled, it means that the findings are not being archived.

4. You can also check the status of the "Non Archived Findings" by going to the "Findings" section in the navigation pane. If there are any findings that are not archived, they will be listed here.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List GuardDuty Detectors**: The first step to check if Non Archived Findings are enabled for GuardDuty is to list all the GuardDuty detectors in your AWS account. You can do this by running the following command: `aws guardduty list-detectors`. This command will return a list of detector IDs.

3. **Get Detector Details**: For each detector ID returned in the previous step, you can get the details of the detector by running the following command: `aws guardduty get-detector --detector-id <detector-id>`. Replace `<detector-id>` with the actual detector ID. This command will return the details of the detector including the status of the "Finding Publishing Frequency" which indicates if Non Archived Findings are enabled or not.

4. **Check Finding Publishing Frequency**: In the output of the previous command, look for the "FindingPublishingFrequency" field. If the value of this field is "FIFTEEN_MINUTES", "ONE_HOUR", or "SIX_HOURS", it means that Non Archived Findings are enabled. If the value is "TWENTY_FOUR_HOURS" or "FORTY_EIGHT_HOURS", it means that Non Archived Findings are not enabled.
</Accordion>

<Accordion title='Using Python'>
1. **Import necessary libraries and establish a session**: To start with, you need to import the necessary libraries in your Python script. Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. Here is how you can do it:

```python
import boto3
import json

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2' # or any other region where you have your resources
)
```

2. **Create a GuardDuty client**: After establishing a session, you need to create a GuardDuty client. This client will allow you to interact with the GuardDuty service and perform various operations.

```python
# Create GuardDuty client
gd_client = session.client('guardduty')
```

3. **List detectors**: GuardDuty uses detectors to monitor the activity in your AWS environment. You need to list all the detectors in your environment to check their configurations.

```python
# List detectors
response = gd_client.list_detectors()
detectors = response['DetectorIds']
```

4. **Check for non-archived findings**: Now, you can iterate over all the detectors and check if they have non-archived findings enabled. If the `FindingPublishingFrequency` attribute of a detector is set to `FIFTEEN_MINUTES`, `ONE_HOUR`, or `SIX_HOURS`, it means that the detector is configured to automatically archive findings after the specified time period.

```python
# Check for non-archived findings
for detector in detectors:
    detector_config = gd_client.get_detector(DetectorId=detector)
    if detector_config['FindingPublishingFrequency'] in ['FIFTEEN_MINUTES', 'ONE_HOUR', 'SIX_HOURS']:
        print(f"Detector {detector} has non-archived findings enabled.")
```

This script will print the IDs of all detectors that have non-archived findings enabled. If you want to take any action based on this information, you can modify the script accordingly.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the non-archived findings enabled for GuardDuty in AWS Shield, you can follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to https://aws.amazon.com/ and login to your AWS account using your credentials.

2. **Navigate to GuardDuty Service**: In the AWS Management Console, search for "GuardDuty" in the services search bar and click on the GuardDuty service.

3. **Select the GuardDuty Detector**: In the GuardDuty console, select the GuardDuty detector for which you want to remediate the non-archived findings.

4. **Navigate to Settings**: Click on the "Settings" tab in the GuardDuty console to view the settings for the selected detector.

5. **Disable Non-Archived Findings**: In the settings page, locate the "Non-Archived Findings" section and toggle the switch to disable it. This will ensure that findings are automatically archived after 90 days.

6. **Save Changes**: Once you have disabled the non-archived findings, click on the "Save" button to apply the changes.

7. **Verify Configuration**: You can verify that the non-archived findings are disabled by checking the settings page again and ensuring that the switch is in the off position.

By following these steps, you have successfully remediated the non-archived findings enabled for GuardDuty in AWS Shield using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the non-archived findings enabled for GuardDuty in AWS Shield using AWS CLI, you can follow these steps:

1. Open the AWS CLI and run the following command to disable the non-archived findings in GuardDuty:

```bash
aws guardduty update-organization-configuration --detector-id <detector-id> --auto-enable --data-sources "s3Logs={enable=false}"
```

Replace `<detector-id>` with the ID of the GuardDuty detector for which you want to disable the non-archived findings.

2. Verify that the non-archived findings are disabled by running the following command:

```bash
aws guardduty get-detector --detector-id <detector-id> --query DataSources.S3Logs
```

This command will return the current configuration of S3 logs for the specified GuardDuty detector.

3. Once you have verified that the non-archived findings are disabled, you have successfully remediated the misconfiguration in AWS Shield for GuardDuty.

By following these steps, you can remediate the non-archived findings enabled for GuardDuty in AWS Shield using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the non-archived findings enabled for GuardDuty in AWS Shield using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Create a Boto3 client for GuardDuty:
```python
guardduty = boto3.client('guardduty')
```

3. List all the detectors in GuardDuty:
```python
detectors = guardduty.list_detectors()
```

4. Iterate through each detector and update the findingPublishingFrequency to "ARCHIVE":
```python
for detector in detectors['DetectorIds']:
    guardduty.update_detector(
        DetectorId=detector,
        FindingPublishingFrequency='ARCHIVE'
    )
```

5. Verify that the findings are now being archived by checking the FindingPublishingFrequency of each detector:
```python
for detector in detectors['DetectorIds']:
    response = guardduty.get_detector(
        DetectorId=detector
    )
    print(f"Detector {detector} finding publishing frequency: {response['FindingPublishingFrequency']}")
```

By following these steps and running the Python script, you can remediate the non-archived findings enabled for GuardDuty in AWS Shield.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

