---
slug: apigateway_tracing_enabled
title: Active Tracing Should Be Enabled For API Gateway Stages
sidebar_label: Active Tracing Should Be Enabled For API Gateway Stages
---

### More Info:

Active tracing should be enabled for your Amazon API Gateway API stages to sample incoming requests and send traces to AWS X-Ray. Then X-Ray can provide you an end-to-end view of an entire HTTP request, so you can analyze latencies in your APIs and their backend services.

### Risk Level

Low

### Address

Operational Maturity, Security

### Compliance Standards

CBP

### Remediation

#### Using Console

To remediate the misconfiguration "Active Tracing Should Be Enabled For API Gateway Stages" in AWS console, follow these steps:

1. Login to your AWS console and navigate to the API Gateway service.

2. Select the API Gateway that you want to remediate.

3. Click on the Stages option from the left-hand side menu.

4. Select the stage that you want to remediate.

5. Click on the Settings tab.

6. Scroll down to the "Tracing" section.

7. Enable the "Enable CloudWatch Logs" option.

8. Enable the "Enable X-Ray Tracing" option.

9. Click on the Save Changes button.

10. Repeat steps 4 to 9 for all the stages that you want to remediate.

11. Once you have enabled active tracing for all the stages, verify the remediation by checking the CloudWatch logs and X-Ray traces for the API Gateway.

#### Using CLI

To remediate the misconfiguration "Active Tracing Should Be Enabled For API Gateway Stages" in AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable active tracing for the API Gateway stages:

```
aws apigateway update-stage --rest-api-id <rest-api-id> --stage-name <stage-name> --patch-operations op=replace,path=/tracingEnabled,value=true
```

Note: Replace `<rest-api-id>` with the ID of the API Gateway and `<stage-name>` with the name of the stage.

2. Run the following command to verify if the tracing is enabled for the API Gateway stages:

```
aws apigateway get-stage --rest-api-id <rest-api-id> --stage-name <stage-name>
```

This will return the details of the stage, including the tracingEnabled attribute.

3. Repeat the above steps for all the stages of the API Gateway to ensure that active tracing is enabled for all stages.

By following these steps, you can remediate the misconfiguration "Active Tracing Should Be Enabled For API Gateway Stages" in AWS CLI.

#### Using Python

To remediate the misconfiguration "Active Tracing Should Be Enabled For API Gateway Stages" in AWS API Gateway using Python, you can follow these steps:

1. Import the necessary AWS SDK modules for Python. You can use `boto3` module for this.

```python
import boto3
```

2. Create a `boto3` client for API Gateway.

```python
client = boto3.client('apigateway')
```

3. List all the APIs available in your account.

```python
response = client.get_rest_apis()
apis = response['items']
```

4. For each API, list all the stages available.

```python
for api in apis:
    stages = client.get_stages(restApiId=api['id'])['item']
```

5. For each stage, check if active tracing is enabled. If not, enable it.

```python
for stage in stages:
    tracingEnabled = client.get_stage(restApiId=api['id'], stageName=stage['stageName'])['tracingEnabled']
    if not tracingEnabled:
        response = client.update_stage(restApiId=api['id'], stageName=stage['stageName'], patchOperations=[{'op' : 'replace', 'path' : '/tracingEnabled', 'value' : 'True'}])
```

6. Once the above steps are executed, active tracing will be enabled for all the stages of all the APIs in your account.

Note: Make sure you have the necessary permissions to perform the above actions.

### Additional Reading:

- [https://docs.aws.amazon.com/xray/latest/devguide/xray-services-apigateway.html](https://docs.aws.amazon.com/xray/latest/devguide/xray-services-apigateway.html) 

