

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon API Gateway console at https://console.aws.amazon.com/apigateway/.

2. In the navigation pane, choose APIs.

3. In the APIs pane, choose the API you want to check.

4. In the API details pane, choose Stages.

5. In the Stages pane, choose the stage you want to check.

6. In the Stage Editor pane, choose the Logs/Tracing tab.

7. Under the Data Trace setting, check if the Encrypt Data Trace checkbox is selected. If it's not selected, then EFS encryption is not enabled for the API Gateway.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the API Gateways: Use the following command to list all the API Gateways in your AWS account:

   ```
   aws apigateway get-rest-apis
   ```
   This command will return a list of all the Rest APIs in your AWS account.

3. Get the details of each API Gateway: For each API Gateway, use the following command to get its details:

   ```
   aws apigateway get-rest-api --rest-api-id {rest-api-id}
   ```
   Replace `{rest-api-id}` with the ID of the API Gateway you want to check. This command will return the details of the specified API Gateway.

4. Check the EFS Encryption: In the details of each API Gateway, look for the `efsConfig` field. If the `encryptionEnabled` field under `efsConfig` is set to `true`, then EFS encryption is enabled for that API Gateway. If it's set to `false` or if the `efsConfig` field is not present, then EFS encryption is not enabled.

#### Using Python

To check if EFS Encryption is enabled in API Gateway using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Import the necessary modules and create a session**:
   You need to import Boto3 and create a session using your AWS credentials.

   ```python
   import boto3
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

2. **Create a client for API Gateway**:
   Use the session to create a client for API Gateway.

   ```python
   client = session.client('apigateway')
   ```

3. **Get the list of Rest APIs**:
   Use the `get_rest_apis` method to get a list of all Rest APIs.

   ```python
   rest_apis = client.get_rest_apis()
   ```

4. **Check if EFS Encryption is enabled**:
   Iterate over the list of Rest APIs and use the `get_rest_api` method to get the details of each API. Check the `encryptionEnabled` attribute to see if EFS Encryption is enabled.

   ```python
   for api in rest_apis['items']:
       api_details = client.get_rest_api(restApiId=api['id'])
       if 'encryptionEnabled' in api_details and api_details['encryptionEnabled']:
           print(f"EFS Encryption is enabled for API: {api['name']}")
       else:
           print(f"EFS Encryption is not enabled for API: {api['name']}")
   ```

Please note that you need to replace `'YOUR_ACCESS_KEY'` and `'YOUR_SECRET_KEY'` with your actual AWS access key and secret key. Also, the region name should be the region where your API Gateway is located.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the EFS Encryption Enabled misconfiguration in AWS, you can follow the below steps:

1. Open the AWS Management Console and navigate to the Amazon Elastic File System (EFS) service.

2. Select the EFS file system that needs to be remediated.

3. Click on the "Actions" button and select "Modify file system".

4. In the "Modify file system" window, scroll down to the "Encryption" section.

5. Disable the encryption by selecting "No" for the "Encrypt file system" option.

6. Click on the "Modify" button to save the changes.

7. Once the changes are saved, the EFS file system will be unencrypted.

Note: If you need to encrypt the EFS file system, you can follow the same steps and select "Yes" for the "Encrypt file system" option in step 5.

#### Using CLI

To remediate the misconfiguration of EFS Encryption Enabled in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get a list of all the EFS file systems in your AWS account:

```
aws efs describe-file-systems
```

3. Identify the EFS file system that has encryption disabled.

4. Run the following command to enable encryption for the identified EFS file system:

```
aws efs update-file-system --file-system-id <file-system-id> --encrypted
```

Replace `<file-system-id>` with the ID of the EFS file system that you want to enable encryption for.

5. Verify that encryption is enabled for the EFS file system by running the following command:

```
aws efs describe-file-systems --file-system-id <file-system-id> --query "FileSystems[*].Encrypted"
```

Replace `<file-system-id>` with the ID of the EFS file system that you enabled encryption for.

6. Repeat the above steps for all the EFS file systems in your AWS account that have encryption disabled.

By following these steps, you can remediate the misconfiguration of EFS Encryption Enabled in AWS using AWS CLI.

#### Using Python

To remediate the EFS Encryption Enabled misconfiguration in AWS using Python, follow these steps:

1. Open the AWS console and navigate to the EFS service.
2. Select the EFS file system that has encryption enabled.
3. Click on the “Modify” button in the top menu bar.
4. Scroll down to the “Encryption” section and select “No” in the “Encryption” dropdown menu.
5. Click on the “Save” button to disable encryption for the EFS file system.

To do this programmatically using Python, you can use the AWS SDK for Python (Boto3) to modify the encryption setting for the EFS file system. Here's an example code snippet to disable encryption for an EFS file system:

```
import boto3

# Create an EFS client
efs = boto3.client('efs')

# Set the EFS file system ID
file_system_id = 'fs-12345678'

# Disable encryption for the EFS file system
response = efs.modify_file_system(
    FileSystemId=file_system_id,
    Encrypted=False
)

# Print the response
print(response)
```

Make sure to replace `fs-12345678` with the actual ID of the EFS file system that you want to remediate.


</Tab>
</Tabs>