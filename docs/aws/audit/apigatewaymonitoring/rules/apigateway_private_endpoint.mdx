---
slug: apigateway_private_endpoint
title: Only Private End-Points Should Access APIs
sidebar_label: Only Private End-Points Should Access APIs
---

### More Info:

Amazon API Gateway APIs should be accessible only through private API endpoints and must not be visible to the public Internet.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NISTCSF, PCIDSS



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the API Gateway service.

2. In the API Gateway dashboard, select the API you want to inspect.

3. In the API details page, select the "Resources" option from the left-hand side menu. This will display all the resources and methods associated with the selected API.

4. For each method, click on the method request to view its settings. Under the "Settings" tab, check the "Endpoint Type" field. If the endpoint type is set to "Edge Optimized" or "Regional", it means that the API is accessible from the public internet, which is a misconfiguration. The endpoint type should be set to "Private" to ensure that only private endpoints can access the API.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once you have AWS CLI installed and configured, you can start checking the API Gateway configurations.

2. To list all the APIs in API Gateway, use the following command:
   ```
   aws apigateway get-rest-apis
   ```
   This command will return a list of all the APIs in your AWS account.

3. For each API, you need to check the endpoint configuration. You can do this by using the following command:
   ```
   aws apigateway get-rest-api --rest-api-id <api-id>
   ```
   Replace `<api-id>` with the ID of the API you want to check. This command will return the configuration of the specified API.

4. In the returned configuration, look for the `endpointConfiguration` field. If the `types` field under `endpointConfiguration` is set to `PRIVATE`, then the API is configured to be accessed only from private endpoints. If it's set to `EDGE` or `REGIONAL`, then the API can be accessed from public endpoints, which is a misconfiguration if you want your APIs to be accessed only from private endpoints.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) in your environment. This can be done using pip:

   ```python
   pip install boto3
   ```

2. Establish a session with AWS: You need to establish a session with AWS using your access key ID and secret access key. This can be done using the following Python script:

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. Get a list of all APIs: You can get a list of all APIs in your AWS account using the get_rest_apis() method. This method returns a dictionary that contains information about all APIs.

   ```python
   client = session.client('apigateway')
   response = client.get_rest_apis()
   ```

4. Check if APIs have private endpoints: You can check if an API has a private endpoint by checking the 'endpointConfiguration' field in the dictionary returned by the get_rest_apis() method. If the 'types' field in the 'endpointConfiguration' dictionary contains 'PRIVATE', then the API has a private endpoint.

   ```python
   for api in response['items']:
       if 'PRIVATE' not in api['endpointConfiguration']['types']:
           print(f"API {api['name']} does not have a private endpoint.")
   ```
   
This script will print the names of all APIs that do not have a private endpoint.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Only Private End-Points Should Access APIs" in AWS, you can follow the steps below:

1. Login to your AWS Console.

2. Navigate to the Amazon API Gateway service.

3. Select the API that you want to remediate.

4. Click on the "Settings" tab.

5. Under the "Endpoint Type" section, select the "Private" option.

6. If you have not already created a VPC endpoint for the API Gateway, create one by clicking on the "Create VPC Link" button.

7. In the "Create VPC Link" dialog box, select the VPC that you want to use for the endpoint.

8. Choose the security groups that will be associated with the VPC endpoint.

9. Click on the "Create" button.

10. Once the VPC endpoint is created, go back to the API Gateway "Settings" tab.

11. Under the "Endpoint Configuration" section, select the VPC endpoint that you just created.

12. Click on the "Save Changes" button.

13. Test the API to ensure that it is only accessible through the private endpoint.

By following these steps, you have remediated the misconfiguration "Only Private End-Points Should Access APIs" in AWS.

#### Using CLI

To remediate the misconfiguration "Only Private Endpoints Should Access APIs" for AWS using AWS CLI, follow the below steps:

1. Identify the APIs that are publicly accessible by running the following command:

```
aws apigateway get-rest-apis --query "items[?endpointConfiguration.types[0]=='EDGE'].name"
```

This command will list all the APIs that are publicly accessible via the internet.

2. For each of the APIs identified in step 1, update the endpoint configuration to make it private by running the following command:

```
aws apigateway update-rest-api --rest-api-id <rest-api-id> --patch-operations op=replace,path=/endpointConfiguration/types/0,value=PRIVATE
```

Replace `<rest-api-id>` with the ID of the API that you want to update.

3. Verify that the endpoint configuration has been updated by running the following command:

```
aws apigateway get-rest-api --rest-api-id <rest-api-id> --query "endpointConfiguration.types"
```

This command will return the endpoint configuration of the API. Verify that the first element in the array is "PRIVATE".

4. Repeat steps 2 and 3 for all the APIs that were identified in step 1.

5. Once you have updated all the APIs, verify that they are no longer publicly accessible by running the following command:

```
aws apigateway get-rest-apis --query "items[?endpointConfiguration.types[0]=='EDGE'].name"
```

This command should not return any APIs.

#### Using Python

To remediate the misconfiguration "Only Private End-Points Should Access APIs" in AWS using Python, you can follow the below steps:

Step 1: Identify the APIs which are not restricted to private endpoints only.

Step 2: For each API, check if it is currently accessible from a public endpoint.

Step 3: If the API is accessible from a public endpoint, restrict its access to private endpoints only.

Step 4: To restrict the access of an API to private endpoints only, you can use the following Python code:

```python
import boto3

# Create a boto3 client for the API Gateway service
apigateway = boto3.client('apigateway')

# Get the ID of the API which you want to restrict to private endpoints only
api_id = 'your_api_id'

# Get the current settings of the API
response = apigateway.get_rest_api(restApiId=api_id)

# Check if the API is currently accessible from a public endpoint
if response['endpointConfiguration']['types'][0] == 'EDGE':
    # If the API is accessible from a public endpoint, restrict its access to private endpoints only
    apigateway.update_rest_api(
        restApiId=api_id,
        patchOperations=[
            {
                'op': 'replace',
                'path': '/endpointConfiguration/types/0',
                'value': 'PRIVATE'
            }
        ]
    )
```

Step 5: Run this code for all the APIs which are not restricted to private endpoints only.

By following these steps, you can remediate the misconfiguration "Only Private End-Points Should Access APIs" in AWS using Python.

### Additional Reading:

- [https://aws.amazon.com/blogs/compute/introducing-amazon-api-gateway-private-endpoints/](https://aws.amazon.com/blogs/compute/introducing-amazon-api-gateway-private-endpoints/) 


</Tab>
</Tabs>