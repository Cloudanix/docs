---
slug: apigateway_content_encoding
title: Content Encoding Should Be Enabled For APIs
sidebar_label: Content Encoding Should Be Enabled For APIs
---

### More Info:

Content Encoding feature should be enabled for your Amazon API Gateway APIs in order to facilitate API payload compression.

### Risk Level

Low

### Address

Reliability, Security

### Compliance Standards

CBP

### Remediation

#### Using Console

To remediate the "Content Encoding Should Be Enabled For APIs" misconfiguration in AWS console, follow the below steps:

1. Open the Amazon API Gateway console.
2. From the left-hand menu, select the API that needs to be remediated.
3. Select the "Stages" option from the left-hand menu.
4. Select the stage for which you want to enable content encoding.
5. Click on the "Settings" tab.
6. Under "Advanced Settings", select "Enable Content Encoding" checkbox.
7. Click on "Save Changes" button to save the changes.

This will enable content encoding for the selected API in AWS console.

#### Using CLI

To remediate the "Content Encoding Should Be Enabled For APIs" misconfiguration in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the APIs Gateway in your AWS account:

```
aws apigateway get-rest-apis
```

3. From the output, identify the API Gateway that you want to enable content encoding for.

4. Run the following command to update the API Gateway configuration to enable content encoding:

```
aws apigateway update-rest-api --rest-api-id <rest_api_id> --patch-operations op=replace,path=/binaryMediaTypes,application~1json,application~1xml,application~1x-www-form-urlencoded,application~1zip,application~1pdf,application~1msword,application~1vnd.ms-excel,application~1vnd.ms-powerpoint,application~1octet-stream,application~1ogg,application~1mp4-video,application~1mpeg,application~1mp3,a
```

Note: Replace `<rest_api_id>` with the ID of the API Gateway that you want to enable content encoding for.

5. Verify that content encoding is enabled by running the following command:

```
aws apigateway get-rest-api --rest-api-id <rest_api_id> --query binaryMediaTypes
```

Note: Replace `<rest_api_id>` with the ID of the API Gateway that you enabled content encoding for.

6. The output should show the list of binary media types that you enabled content encoding for.

By following these steps, you can remediate the "Content Encoding Should Be Enabled For APIs" misconfiguration in AWS using CLI.

#### Using Python

To remediate the "Content Encoding Should Be Enabled For APIs" misconfiguration in Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
from botocore.exceptions import ClientError
```

2. Create a boto3 client for the AWS API Gateway:
```python
client = boto3.client('apigateway')
```

3. List all the APIs in your account:
```python
response = client.get_rest_apis()
```

4. Iterate through each API and enable content encoding:
```python
for api in response['items']:
    rest_api_id = api['id']
    try:
        client.update_rest_api(
            restApiId=rest_api_id,
            patchOperations=[
                {
                    'op': 'replace',
                    'path': '/minimumCompressionSize',
                    'value': '0'
                }
            ]
        )
        print(f"Content encoding enabled for API {rest_api_id}")
    except ClientError as e:
        print(f"Error enabling content encoding for API {rest_api_id}: {e}")
```

This code will enable content encoding for all APIs in your account by setting the `minimumCompressionSize` property to 0. This will compress the response payloads for all requests that meet the minimum size threshold and improve the performance of your APIs.

### Additional Reading:

- [https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-enable-compression.html](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-enable-compression.html) 

