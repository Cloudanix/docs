---
slug: apigateway_detailed_cloudwatch_metrics
title: Cloudwatch Metrics Must Be Enabled For All APIs
sidebar_label: Cloudwatch Metrics Must Be Enabled For All APIs
---

### More Info:

Detailed CloudWatch metrics should be enabled for all APIs created with AWS API Gateway service in order to monitor API stages caching, latency and detected errors at a more granular level and set alarms accordingly.

### Risk Level

Low

### Address

Operational Maturity

### Compliance Standards

HIPAA, SOC2, HITRUST, NISTCSF, PCIDSS

### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the "Cloudwatch Metrics Must Be Enabled For All APIs" misconfiguration in AWS console:

1. Log in to your AWS Management Console.
2. Navigate to the Amazon API Gateway service.
3. Select the API for which you want to enable CloudWatch Metrics.
4. In the left-hand menu, select "Stages".
5. Select the stage for which you want to enable CloudWatch Metrics.
6. Click on the "Logs/Tracing" tab.
7. Under "CloudWatch Settings", select "Enable CloudWatch Metrics".
8. Choose the appropriate "Metric Name" and "Namespace" for your API.
9. Click on "Save Changes" to enable CloudWatch Metrics for your API.

Once you have completed these steps, CloudWatch Metrics will be enabled for your API and you will be able to view metrics related to your API in the CloudWatch console.

#### Using CLI

To remediate the misconfiguration "Cloudwatch Metrics Must Be Enabled For All APIs" in AWS using CLI, follow the below steps:

Step 1: Open the AWS CLI and run the following command to enable CloudWatch metrics for all APIs in the AWS account:

```
aws apigateway update-account --patch-operations op=replace,path=/features/metrics/enabled,value=true
```

Step 2: Verify that the CloudWatch metrics are enabled for all APIs by running the following command:

```
aws apigateway get-account --query "features.metrics.enabled"
```

This command should return "true" as the output, indicating that the CloudWatch metrics are enabled for all APIs in the AWS account.

Step 3: Repeat the above steps for all regions where the API Gateway service is being used.

By following the above steps, you can remediate the misconfiguration "Cloudwatch Metrics Must Be Enabled For All APIs" in AWS using CLI.

#### Using Python

To remediate the misconfiguration "Cloudwatch Metrics Must Be Enabled For All APIs" in AWS using Python, you can follow the below steps:

1. Install the AWS SDK (boto3) for Python using pip:

```
pip install boto3
```

2. Create an AWS client object for API Gateway using the boto3 library:

```
import boto3

client = boto3.client('apigateway')
```

3. List all the APIs in your AWS account:

```
apis = client.get_rest_apis()
```

4. For each API, check if Cloudwatch metrics are enabled using the `get_metrics()` method:

```
for api in apis['items']:
    metrics = client.get_metrics(restApiId=api['id'])
    if not metrics['metrics']:
        # Enable Cloudwatch metrics for the API
        client.update_rest_api(restApiId=api['id'], patchOperations=[{'op': 'replace', 'path': '/metrics/enabled', 'value': 'true'}])
```

5. The above code will enable Cloudwatch metrics for all APIs that do not have it enabled. You can run this code periodically to ensure that all APIs have Cloudwatch metrics enabled.

Note: You will need to have appropriate AWS credentials (access key and secret access key) configured to run this code.

### Additional Reading:

- [https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-metrics-and-dimensions.html](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-metrics-and-dimensions.html) 

