---
slug: codebuild_project_artifact_encryption
title: Artifact Encryption Should Be Enabled CodeBuild Project
sidebar_label: Artifact Encryption Should Be Enabled CodeBuild Project
---

### More Info:

This rule verifies whether encryption is enabled for all artifacts of an AWS CodeBuild project. Enabling encryption for artifacts helps protect sensitive data stored in the artifacts from unauthorized access or tampering. It ensures that artifacts are encrypted while stored, providing an additional layer of security.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,SEBI,RBI_UCB


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration "Artifact Encryption Should Be Enabled" in AWS CodeBuild using the AWS Management Console, follow these steps:

1. **Navigate to CodeBuild:**
   - Open the AWS Management Console.
   - In the search bar, type "CodeBuild" and select it from the dropdown list.

2. **Create or Edit a Build Project:**
   - To create a new build project, click on the "Create build project" button.
   - To edit an existing build project, select the project from the list and click on the project name to open its details.

3. **Configure Artifacts:**
   - In the "Create build project" or "Edit build project" page, scroll down to the "Artifacts" section.
   - Ensure that the "Type" is set to "Amazon S3" or another supported type that allows encryption.

4. **Enable Encryption:**
   - In the "Encryption" settings within the "Artifacts" section, check the box for "Enable artifact encryption".
   - Optionally, you can specify a KMS key for encryption by selecting "KMS" and choosing an existing key or creating a new one.

By following these steps, you ensure that the artifacts produced by your CodeBuild project are encrypted, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of "Artifact Encryption Should Be Enabled" in AWS CodeBuild using the AWS CLI, follow these steps:

1. **Create or Update a CodeBuild Project with Encryption Enabled:**
   Ensure that the `encryptionDisabled` parameter is set to `false` when creating or updating a CodeBuild project. This ensures that the build artifacts are encrypted.

   ```sh
   aws codebuild create-project \
       --name my-codebuild-project \
       --source type=GITHUB,location=https://github.com/my-repo/my-project \
       --artifacts type=S3,location=my-artifact-bucket,encryptionDisabled=false \
       --environment type=LINUX_CONTAINER,image=aws/codebuild/standard:4.0,computeType=BUILD_GENERAL1_SMALL \
       --service-role arn:aws:iam::123456789012:role/service-role/codebuild-service-role
   ```

2. **Update an Existing CodeBuild Project to Enable Encryption:**
   If you have an existing CodeBuild project, you can update it to ensure that artifact encryption is enabled.

   ```sh
   aws codebuild update-project \
       --name my-codebuild-project \
       --artifacts type=S3,location=my-artifact-bucket,encryptionDisabled=false
   ```

3. **Verify the Configuration:**
   After creating or updating the project, verify that the `encryptionDisabled` parameter is set to `false` to ensure that artifact encryption is enabled.

   ```sh
   aws codebuild batch-get-projects --names my-codebuild-project
   ```

   Look for the `encryptionDisabled` field in the output and ensure it is set to `false`.

4. **Use IAM Policies to Enforce Encryption:**
   Ensure that your IAM policies enforce the use of encryption for CodeBuild artifacts. This can be done by creating a policy that denies the creation or update of CodeBuild projects with `encryptionDisabled` set to `true`.

   ```sh
   aws iam create-policy \
       --policy-name EnforceCodeBuildArtifactEncryption \
       --policy-document '{
           "Version": "2012-10-17",
           "Statement": [
               {
                   "Effect": "Deny",
                   "Action": [
                       "codebuild:CreateProject",
                       "codebuild:UpdateProject"
                   ],
                   "Resource": "*",
                   "Condition": {
                       "Bool": {
                           "codebuild:Artifacts.encryptionDisabled": "true"
                       }
                   }
               }
           ]
       }'
   ```

By following these steps, you can ensure that artifact encryption is enabled for your AWS CodeBuild projects using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of "Artifact Encryption Should Be Enabled" in AWS CodeBuild using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps to ensure that artifact encryption is enabled for your CodeBuild projects:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by configuring the `~/.aws/credentials` file.

3. **Create a Python Script**:
   Write a Python script to create or update a CodeBuild project with artifact encryption enabled.

4. **Enable Artifact Encryption**:
   Use the `create_project` or `update_project` method from Boto3 to ensure artifact encryption is enabled.

Here is a sample Python script to achieve this:

```python
import boto3

def ensure_artifact_encryption(project_name, bucket_name, encryption_disabled=False):
    client = boto3.client('codebuild')

    # Define the artifact configuration with encryption enabled
    artifacts = {
        'type': 'S3',
        'location': bucket_name,
        'packaging': 'ZIP',
        'encryptionDisabled': encryption_disabled  # Set to False to enable encryption
    }

    # Check if the project already exists
    try:
        response = client.batch_get_projects(names=[project_name])
        if response['projects']:
            # Update the existing project
            client.update_project(
                name=project_name,
                artifacts=artifacts
            )
            print(f"Updated project '{project_name}' to ensure artifact encryption is enabled.")
        else:
            # Create a new project
            client.create_project(
                name=project_name,
                source={
                    'type': 'GITHUB',
                    'location': 'https://github.com/your-repo/your-project'
                },
                artifacts=artifacts,
                environment={
                    'type': 'LINUX_CONTAINER',
                    'image': 'aws/codebuild/standard:4.0',
                    'computeType': 'BUILD_GENERAL1_SMALL'
                },
                serviceRole='arn:aws:iam::your-account-id:role/your-service-role'
            )
            print(f"Created project '{project_name}' with artifact encryption enabled.")
    except Exception as e:
        print(f"Error ensuring artifact encryption: {e}")

# Example usage
ensure_artifact_encryption('my-codebuild-project', 'my-artifact-bucket')
```

### Key Points:
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Set Up AWS Credentials**: Configure your AWS credentials.
3. **Create/Update Project**: Use the `create_project` or `update_project` method to configure artifact encryption.
4. **Artifact Configuration**: Set `encryptionDisabled` to `False` to enable encryption for the artifacts.

This script checks if the CodeBuild project exists and either updates it or creates a new one with artifact encryption enabled. Adjust the parameters such as `project_name`, `bucket_name`, and other configurations as needed.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CodeBuild service.
2. In the navigation pane, select "Build projects". This will display a list of all the CodeBuild projects in your AWS account.
3. Select the CodeBuild project that you want to check for Artifact Encryption. This will open the project details page.
4. In the project details page, scroll down to the "Artifacts" section. Check if the "Encryption key" field is set to a specific AWS Key Management Service (KMS) key. If this field is set to "AWS Managed Key" or a specific KMS key, then Artifact Encryption is enabled for the CodeBuild project. If this field is not set or is set to "Disabled", then Artifact Encryption is not enabled for the CodeBuild project.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the CodeBuild projects in your account using the following command:

   ```
   aws codebuild list-projects
   ```

   This command will return a list of all the CodeBuild project names in your account.

3. Next, you can describe a specific CodeBuild project to get its details. Replace 'project-name' with the name of your project:

   ```
   aws codebuild batch-get-projects --names project-name
   ```

   This command will return a JSON object that contains the details of the specified CodeBuild project.

4. Finally, you can check if artifact encryption is enabled for the project by looking at the 'encryptionKey' field in the returned JSON object. If the 'encryptionKey' field is set to 'aws/s3', it means that the default S3 key is being used, which is not recommended. If the 'encryptionKey' field is set to a specific KMS key, it means that artifact encryption is enabled.
</Accordion>

<Accordion title='Using Python'>
To check if Artifact Encryption is enabled for CodeBuild Project in AWS, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Set up AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. Install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **Create a Python script to list all CodeBuild projects:**
   Use the `list_projects` method to get a list of all CodeBuild projects. Here's a sample script:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.list_projects()

   for project in response['projects']:
       print(project)
   ```

3. **Create a Python script to get project details:**
   Use the `batch_get_projects` method to get details of the projects. Here's a sample script:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.list_projects()

   project_details = client.batch_get_projects(names=response['projects'])

   for project in project_details['projects']:
       print(project)
   ```

4. **Check if Artifact Encryption is enabled:**
   In the project details, check the `encryptionKey` field under `artifacts`. If it's set to 'aws/s3', it means that AWS Key Management Service (KMS) is used to encrypt the build output artifacts, and hence, Artifact Encryption is enabled. Here's how you can modify the above script to check this:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.list_projects()

   project_details = client.batch_get_projects(names=response['projects'])

   for project in project_details['projects']:
       if 'artifacts' in project and 'encryptionKey' in project['artifacts']:
           if project['artifacts']['encryptionKey'] == 'aws/s3':
               print(f"Artifact Encryption is enabled for project {project['name']}")
           else:
               print(f"Artifact Encryption is not enabled for project {project['name']}")
   ```
   This script will print whether Artifact Encryption is enabled for each CodeBuild project.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of artifact encryption not being enabled for an AWS CodeBuild project, you can follow these steps using the AWS Management Console:

1. **Open the AWS Management Console**: Go to the AWS Management Console (https://aws.amazon.com/console/).

2. **Navigate to CodeBuild**: Click on the "Services" dropdown menu at the top of the page, then select "CodeBuild" under the Developer Tools section.

3. **Select the CodeBuild Project**: From the CodeBuild dashboard, select the CodeBuild project for which you want to enable artifact encryption by clicking on the project name.

4. **Edit the Project Settings**: In the CodeBuild project details page, click on the "Edit" button in the top right corner to modify the project settings.

5. **Enable Artifact Encryption**: Scroll down to the "Artifacts" section in the project settings, and check the box next to "Encryption". This will enable artifact encryption for the CodeBuild project.

6. **Save the Changes**: After enabling artifact encryption, scroll to the bottom of the page and click on the "Save" button to apply the changes to the CodeBuild project.

7. **Verify Encryption Configuration**: Once the changes are saved, it's a good practice to verify that artifact encryption is indeed enabled for the CodeBuild project. You can do this by running a test build and checking the artifact encryption settings.

By following these steps, you can remediate the misconfiguration of artifact encryption not being enabled for an AWS CodeBuild project using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of enabling artifact encryption for an AWS CodeBuild project using the AWS CLI, you can follow these steps:

1. **Enable artifact encryption for the CodeBuild project**:
   
   Run the following AWS CLI command to update the CodeBuild project configuration and enable artifact encryption:
   
   ```bash
   aws codebuild update-project --name <project-name> --encryptionKey <encryption-key-arn> --artifactsEncryptionEnabled true
   ```
   
   Replace `<project-name>` with the name of your CodeBuild project and `<encryption-key-arn>` with the ARN of the KMS key to be used for artifact encryption.

2. **Verify artifact encryption is enabled**:
   
   To confirm that artifact encryption is enabled for the CodeBuild project, you can describe the project using the following AWS CLI command:
   
   ```bash
   aws codebuild describe-projects --names <project-name>
   ```
   
   Ensure that the `artifactsEncryptionEnabled` property is set to `true` in the output.

By following these steps, you can successfully remediate the misconfiguration of enabling artifact encryption for an AWS CodeBuild project using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of artifact encryption not being enabled for an AWS CodeBuild project using Python, you can follow these steps:

1. Import the necessary Python libraries:
```python
import boto3
```

2. Initialize the AWS CodeBuild client:
```python
codebuild_client = boto3.client('codebuild')
```

3. Get the list of existing CodeBuild projects:
```python
response = codebuild_client.list_projects()
projects = response['projects']
```

4. For each project, check if artifact encryption is enabled. If not, update the project configuration to enable artifact encryption:
```python
for project_name in projects:
    project = codebuild_client.batch_get_projects(names=[project_name])['projects'][0]
    
    if not project.get('encryptionKey'):
        project['encryptionKey'] = 'arn:aws:kms:us-east-1:123456789012:key/your-kms-key-id'
        
        codebuild_client.update_project(
            name=project_name,
            encryptionKey=project['encryptionKey']
        )
```
Replace `'arn:aws:kms:us-east-1:123456789012:key/your-kms-key-id'` with the ARN of the KMS key you want to use for artifact encryption.

5. Run the Python script to enable artifact encryption for all CodeBuild projects that do not have it enabled.

By following these steps, you can remediate the misconfiguration of artifact encryption not being enabled for an AWS CodeBuild project using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

