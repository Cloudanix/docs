---
slug: codebuild_project_source_repo_url
title: Sign-in Credentials Should Not Be In Bitbucket Source Repository URL CodeBuild
sidebar_label: Sign-in Credentials Should Not Be In Bitbucket Source Repository URL CodeBuild
---

### More Info:

This rule examines the Bitbucket source repository URL configured for an AWS CodeBuild project and checks for the presence of sign-in credentials. Storing sign-in credentials within the repository URL poses a security risk as it can potentially expose sensitive information. It is recommended to use SSH keys or OAuth tokens for authentication with Bitbucket repositories instead of embedding credentials in URLs.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CodeBuild service.
2. In the navigation pane, select "Build projects". This will display a list of all the build projects in your AWS account.
3. Select the build project you want to inspect and click on it to view its details.
4. In the build project details page, check the "Source" section. If the "Repository URL" field contains any sign-in credentials (username and password), then it is a misconfiguration. The URL should not contain any credentials.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the CodeBuild projects in your account using the following command:

   ```
   aws codebuild list-projects --region <region-name>
   ```

   Replace `<region-name>` with the name of the AWS region where your CodeBuild projects are located.

3. After getting the list of projects, you can describe each project to get its details. Use the following command to do this:

   ```
   aws codebuild batch-get-projects --names <project-name> --region <region-name>
   ```

   Replace `<project-name>` with the name of your CodeBuild project and `<region-name>` with the name of the AWS region where your CodeBuild project is located.

4. In the output of the above command, look for the `source` field. This field contains the information about the source repository of the CodeBuild project. If the `type` field under `source` is `BITBUCKET` and the `location` field contains the sign-in credentials, then the CodeBuild project is misconfigured. The `location` field should not contain the sign-in credentials.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) and GitPython. You can install these libraries using pip:

   ```python
   pip install boto3
   pip install GitPython
   ```

2. Connect to AWS CodeBuild: Use the Boto3 library to connect to AWS CodeBuild. You will need your AWS access key ID, secret access key, and the region where your CodeBuild project is located.

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )

   codebuild = session.client('codebuild')
   ```

3. Retrieve and analyze the CodeBuild project configuration: Use the `batch_get_projects` method to retrieve the configuration of your CodeBuild project. Then, check if the source repository URL contains any sign-in credentials.

   ```python
   response = codebuild.batch_get_projects(names=['YOUR_PROJECT_NAME'])

   for project in response['projects']:
       source = project['source']
       if 'auth' in source:
           auth = source['auth']
           if auth['type'] == 'OAUTH' and 'resource' in auth:
               print(f"Sign-in credentials found in source repository URL: {auth['resource']}")
   ```

4. If the script prints out a message, it means that sign-in credentials are found in the source repository URL, which is a misconfiguration. If the script doesn't print anything, it means that no sign-in credentials are found in the source repository URL, which is the correct configuration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of sign-in credentials being stored in a Bitbucket source repository URL in AWS CodeBuild, follow these steps using the AWS Management Console:

1. **Access AWS CodeBuild Console**:
   - Log in to your AWS Management Console.
   - Go to the AWS CodeBuild console by navigating to the "Services" menu and selecting "CodeBuild" under the Developer Tools section.

2. **Select the Project**:
   - In the CodeBuild console, select the project where the Bitbucket source repository URL is configured with sign-in credentials.

3. **Edit Source Settings**:
   - In the project details page, click on the "Edit" button next to the source section where the Bitbucket repository is configured.

4. **Update Repository URL**:
   - In the source settings, locate the field where the Bitbucket repository URL is configured.
   - Remove the sign-in credentials from the repository URL. Instead of including credentials in the URL, consider using SSH keys or OAuth tokens for authentication.

5. **Configure Authentication**:
   - If you were using sign-in credentials in the URL for authentication, set up a secure method for authentication like SSH keys or OAuth tokens.
   - For SSH keys, you can generate a new SSH key pair and add the public key to your Bitbucket account.
   - For OAuth tokens, create a personal access token in Bitbucket with the necessary permissions and use it for authentication.

6. **Save Changes**:
   - After updating the repository URL and authentication method, save the changes in the CodeBuild project settings.

7. **Test the Build**:
   - Trigger a new build in the CodeBuild project to ensure that the source code is fetched without any issues after the remediation.

By following these steps, you can remediate the issue of storing sign-in credentials in the Bitbucket source repository URL in AWS CodeBuild and ensure secure and best practices for handling source code authentication.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of sign-in credentials being in the Bitbucket source repository URL in AWS CodeBuild, you can follow these steps using AWS CLI:

1. **Create a Bitbucket App Password**: Instead of using your Bitbucket account password in the repository URL, create an App Password specifically for CodeBuild. This will allow CodeBuild to access the repository without exposing your actual account password.

2. **Update CodeBuild Project Source**: Update the CodeBuild project source settings to use the App Password instead of your account password.

3. **Update CodeBuild Project using AWS CLI**:
   
   - Use the `update-project` command to update the source settings of your CodeBuild project. You will need to specify the project name and the new source settings with the App Password.

   ```bash
   aws codebuild update-project --name YOUR_PROJECT_NAME --source-auth BITBUCKET --source-auth-access-token YOUR_APP_PASSWORD
   ```

4. **Remove Credentials from Bitbucket Source URL**: Make sure to remove any sign-in credentials from the Bitbucket source repository URL in your CodeBuild project settings.

By following these steps, you have remediated the issue of sign-in credentials being in the Bitbucket source repository URL in AWS CodeBuild and improved the security of your AWS environment.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of sign-in credentials being in the Bitbucket source repository URL in AWS CodeBuild, you can follow these steps using Python:

1. **Store Credentials Securely**: Do not store any sensitive information such as sign-in credentials in your source code or repository. Instead, you can use AWS Secrets Manager to securely store and retrieve credentials.

2. **Update CodeBuild Environment Variables**: In your CodeBuild project settings, update the environment variables to securely pass the credentials to your build process. You can use the AWS SDK for Python (Boto3) to update the environment variables.

```python
import boto3

client = boto3.client('codebuild')

response = client.update_project(
    name='your-codebuild-project-name',
    environment={
        'environmentVariables': [
            {
                'name': 'BITBUCKET_USERNAME',
                'value': 'your-username',
                'type': 'PLAINTEXT'
            },
            {
                'name': 'BITBUCKET_PASSWORD',
                'value': 'your-password',
                'type': 'PLAINTEXT'
            }
        ]
    }
)
```

3. **Use IAM Roles**: Instead of using hardcoded credentials, configure an IAM role with the necessary permissions for your CodeBuild project to access Bitbucket repositories. Attach this IAM role to your CodeBuild project.

4. **Implement CodeBuild Source Credentials**: You can use Source Credential Override in CodeBuild to securely store and retrieve Bitbucket credentials. You can set this up in the CodeBuild project settings or via the AWS CLI.

```python
import boto3

client = boto3.client('codebuild')

response = client.update_project(
    name='your-codebuild-project-name',
    source={
        'type': 'BITBUCKET',
        'location': 'your-bitbucket-repository-url',
        'auth': {
            'type': 'OAUTH',
            'resource': 'your-oauth-token'
        }
    }
)
```

5. **Monitor and Rotate Credentials**: Regularly monitor and rotate your credentials stored in AWS Secrets Manager or IAM roles to enhance security and compliance.

By following these steps and best practices, you can remediate the issue of sign-in credentials being in the Bitbucket source repository URL in AWS CodeBuild securely and effectively.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

