---
slug: codepipeline_deployment_count
title: CodePipeline Deployment Limit Check Should Be Reviewed
sidebar_label: CodePipeline Deployment Limit Check Should Be Reviewed
---

### More Info:

This rule checks if the first deployment stage of AWS CodePipeline performs more than one deployment. Optionally checks if each of the subsequent remaining stages deploy to more than the specified number of deployments (deploymentLimit).

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CodePipeline service.
2. In the navigation pane, select "Pipelines". This will display a list of all the pipelines in your AWS account.
3. Select the pipeline you want to review. This will open the pipeline details page.
4. In the pipeline details page, check the "Deployment Limit" section. If the limit is set to a high number or unlimited, it indicates a potential misconfiguration. The deployment limit should be set to a reasonable number to prevent accidental over-deployment.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all CodePipeline pipelines: Use the following AWS CLI command to list all the pipelines in your AWS CodePipeline:

   ```
   aws codepipeline list-pipelines
   ```
   This command will return a list of all the pipelines in your AWS CodePipeline.

3. Describe each pipeline: For each pipeline returned by the previous command, use the following AWS CLI command to get detailed information about the pipeline:

   ```
   aws codepipeline get-pipeline --name <pipeline-name>
   ```
   Replace `<pipeline-name>` with the name of the pipeline you want to inspect. This command will return a JSON object that contains detailed information about the pipeline.

4. Check the deployment limit: In the JSON object returned by the previous command, look for the `limit` field under the `stages` > `actions` > `configuration` > `DeploymentGroupName` path. This field indicates the maximum number of concurrent deployments that can be made by the pipeline. If this field is set to a high value, it may indicate a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your local environment. This will allow you to interact with AWS services including CodePipeline and CodeBuild.

```python
pip install boto3
aws configure
```

2. Create a Python script that uses Boto3 to interact with AWS CodePipeline and CodeBuild. The script will list all pipelines, then for each pipeline, it will get the details of each stage and action. If the action type is 'AWS CodeBuild', it will get the project details and check the 'timeoutInMinutes' property.

```python
import boto3

def check_codepipeline_deployment_limit():
    client = boto3.client('codepipeline')

    # List all pipelines
    pipelines = client.list_pipelines()

    for pipeline in pipelines['pipelines']:
        # Get pipeline details
        pipeline_state = client.get_pipeline_state(name=pipeline['name'])

        for stage in pipeline_state['stageStates']:
            for action in stage['actionStates']:
                if action['actionState']['actionName'] == 'AWS CodeBuild':
                    check_codebuild_project(action['actionState']['currentRevision']['revisionId'])

def check_codebuild_project(project_name):
    client = boto3.client('codebuild')

    # Get project details
    project = client.batch_get_projects(names=[project_name])

    # Check 'timeoutInMinutes' property
    if project['projects'][0]['timeoutInMinutes'] > 60:
        print(f"CodeBuild project {project_name} has a timeout limit greater than 60 minutes.")
```

3. Run the Python script. If there are any CodeBuild projects with a 'timeoutInMinutes' property greater than 60 minutes, they will be printed to the console.

```python
check_codepipeline_deployment_limit()
```

4. Regularly run this script to monitor your AWS CodePipeline and CodeBuild configurations. You can schedule it to run at regular intervals using a cron job or similar scheduling tool.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild using the AWS console, follow these step-by-step instructions:

1. **Sign in to the AWS Management Console:**
   - Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the CodePipeline service:**
   - In the AWS Management Console, search for "CodePipeline" in the services search bar and click on the CodePipeline service.

3. **Locate the CodePipeline that needs to be remediated:**
   - In the CodePipeline dashboard, locate the CodePipeline for which the deployment limit needs to be reviewed and updated.

4. **Click on the Edit button for the CodePipeline:**
   - Select the CodePipeline that needs to be remediated and click on the "Edit" button to make changes to the pipeline.

5. **Review the deployment stage configuration:**
   - In the CodePipeline editor, navigate to the stage where the deployment action is configured.

6. **Check the deployment configuration:**
   - Review the deployment action configuration within the stage to ensure that the deployment settings are correctly configured.

7. **Update the deployment settings:**
   - If the deployment limit needs to be reviewed and updated, click on the deployment action within the stage and navigate to the settings or configuration section.

8. **Adjust the deployment settings:**
   - Update the deployment settings as needed, including any limits on the number of deployments, deployment frequency, or other relevant parameters.

9. **Save the changes:**
   - Once you have updated the deployment settings, click on the "Save" or "Update" button to apply the changes to the CodePipeline configuration.

10. **Test the updated configuration:**
    - After saving the changes, trigger a test run of the CodePipeline to ensure that the updated deployment settings are working as expected.

11. **Monitor the deployment process:**
    - Monitor the deployment process in the CodePipeline dashboard to verify that the updated deployment settings are being applied correctly.

By following these steps, you can remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild using AWS CLI, follow these steps:

Step 1: List all the existing AWS CodeBuild projects to identify the projects that are contributing to the deployment limit.

```bash
aws codebuild list-projects
```

Step 2: Get the details of a specific CodeBuild project to check if it is used in any CodePipeline deployments.

```bash
aws codebuild batch-get-projects --names <project-name>
```

Step 3: Review the CodePipeline configurations to identify the deployments associated with the CodeBuild projects.

```bash
aws codepipeline list-pipelines
```

Step 4: Get the details of a specific CodePipeline to check if it is using the CodeBuild project.

```bash
aws codepipeline get-pipeline --name <pipeline-name>
```

Step 5: If the CodeBuild project is contributing to the deployment limit, consider splitting the project into multiple smaller projects or optimizing the build process to reduce the number of deployments.

Step 6: Update the CodePipeline configurations to use the optimized CodeBuild projects.

Step 7: Monitor the deployments and the CodeBuild projects regularly to ensure they are within the deployment limit.

By following these steps, you can remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild using Python, you can follow these steps:

1. **Identify the Issue**: The CodePipeline Deployment Limit Check misconfiguration typically occurs when the deployment actions in the CodePipeline exceed the deployment limits set by AWS.

2. **Update CodePipeline Configuration**:
   - Open the AWS Management Console and navigate to the CodePipeline service.
   - Select the CodePipeline that is experiencing the deployment limit issue.
   - Review the deployment actions in the pipeline and identify the actions that are causing the limit to be exceeded.
   - Modify the pipeline configuration to optimize the deployment actions and ensure they comply with the deployment limits.

3. **Implement CodeBuild Python Script**:
   - Create a Python script that utilizes the AWS SDK (boto3) to programmatically interact with the CodePipeline service.
   - Install the boto3 library if you haven't already:
     ```bash
     pip install boto3
     ```
   - Use the following Python script as a template to get the deployment limit information and take necessary actions to remediate the issue:
     ```python
     import boto3

     def get_pipeline_deployment_limit(pipeline_name):
         codepipeline = boto3.client('codepipeline')
         response = codepipeline.get_pipeline(name=pipeline_name)
         return response['pipeline']['artifactStore']['type']

     def remediate_deployment_limit(pipeline_name):
         # Implement remediation steps here
         pass

     if __name__ == '__main__':
         pipeline_name = 'YOUR_PIPELINE_NAME'
         deployment_limit = get_pipeline_deployment_limit(pipeline_name)
         if deployment_limit > YOUR_DESIRED_LIMIT:
             remediate_deployment_limit(pipeline_name)
     ```
   - Update the script with your pipeline name and desired deployment limit.
   - Implement the `remediate_deployment_limit` function to perform the necessary actions to bring the deployment actions within the desired limit.

4. **Execute the Python Script**:
   - Run the Python script on your local machine or an AWS Lambda function to remediate the deployment limit issue for the specified CodePipeline.

By following these steps and customizing the Python script as needed, you can remediate the CodePipeline Deployment Limit Check misconfiguration for AWS CodeBuild.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

