---
slug: codedeploy_auto_rollback_monitor_enabled
title: CodeDeploy Auto Deploy And Monitoring Should Be Enabled
sidebar_label: CodeDeploy Auto Deploy And Monitoring Should Be Enabled
---

### More Info:

Ensure Code build code deploy has auto rollback and monitoring enabled

### Risk Level

Medium

### Address

Performance Efficiency, Operational Excellence, Reliability, Security

### Compliance Standards

HITRUST,SOC2


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the CodeBuild service.
2. In the navigation pane, select "Build projects". This will display a list of all your build projects.
3. Select the build project you want to check for CodeDeploy Auto Deploy and Monitoring. This will open the project details page.
4. In the project details page, check the "Build details" section. If "Auto Deploy" and "Monitoring" are enabled, they will be listed here. If they are not listed, it means they are not enabled for this build project.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the CodeBuild projects in your account using the following command:

   ```
   aws codebuild list-projects
   ```

   This command will return a list of all the CodeBuild projects in your account.

3. For each project, you can describe the project to get more details about it. Use the following command:

   ```
   aws codebuild batch-get-projects --names project-name
   ```

   Replace 'project-name' with the name of your project. This command will return a JSON object with all the details about the project.

4. In the returned JSON object, look for the 'triggers' section. If the 'webhook' field is set to 'true' and 'filterGroups' field contains 'EVENT: PUSH' and 'HEAD_REF: refs/heads/master', it means that Auto Deploy is enabled. If the 'cloudWatchLogs' field under 'logsConfig' is set to 'ENABLED', it means that Monitoring is enabled.

   If these fields are not set as described, it means that Auto Deploy and Monitoring are not enabled in the CodeBuild project.
</Accordion>

<Accordion title='Using Python'>
To check if CodeDeploy Auto Deploy and Monitoring is enabled in CodeBuild using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **List all CodeBuild projects:**
   Use the `list_projects` method to get a list of all CodeBuild projects. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.list_projects()

   for project in response['projects']:
       print(project)
   ```

3. **Get project details:**
   For each project, use the `batch_get_projects` method to get the project details. This will include information about the build configuration, including whether CodeDeploy is enabled. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.batch_get_projects(
       names=[
           'project_name',
       ]
   )

   for project in response['projects']:
       print(project['name'], project['serviceRole'], project['artifacts'])
   ```

4. **Check if CodeDeploy is enabled:**
   In the project details, check if the `artifacts` field has a `namespaceType` of `BUILD_ID` and an `overrideArtifactName` of `True`. This indicates that CodeDeploy is enabled. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('codebuild')

   response = client.batch_get_projects(
       names=[
           'project_name',
       ]
   )

   for project in response['projects']:
       if project['artifacts']['namespaceType'] == 'BUILD_ID' and project['artifacts']['overrideArtifactName'] == True:
           print("CodeDeploy is enabled for project", project['name'])
       else:
           print("CodeDeploy is not enabled for project", project['name'])
   ```

Please note that you need to replace `'project_name'` with the actual name of your CodeBuild project. Also, you need to have the necessary permissions to list and get details of CodeBuild projects.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of CodeDeploy Auto Deploy and Monitoring not being enabled for AWS CodeBuild using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console and login to your AWS account.

2. **Navigate to CodeBuild**: In the AWS Management Console, navigate to the CodeBuild service.

3. **Select the Project**: Select the CodeBuild project for which you want to enable CodeDeploy Auto Deploy and Monitoring.

4. **Edit the Project**: Click on the project name to open the project details.

5. **Edit the Build**: In the project details page, click on the "Edit" button to modify the project settings.

6. **Enable CodeDeploy Auto Deploy**: In the project settings, scroll down to the "Deploy" section. Enable the "Enable automated deployments" option to enable CodeDeploy Auto Deploy.

7. **Configure Deployment**: Configure the deployment settings as per your requirements. You can choose the deployment type, deployment group, and other deployment settings.

8. **Enable Monitoring**: In the project settings, navigate to the "Monitoring" section. Enable the "Enable CloudWatch Logs" option to enable monitoring for the CodeBuild project.

9. **Save Changes**: Once you have enabled CodeDeploy Auto Deploy and Monitoring, click on the "Save" button to save the changes.

10. **Verify Configuration**: Verify that CodeDeploy Auto Deploy and Monitoring are enabled for the CodeBuild project by checking the project settings and configurations.

By following these steps, you can remediate the misconfiguration of CodeDeploy Auto Deploy and Monitoring not being enabled for AWS CodeBuild using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of enabling CodeDeploy Auto Deploy and Monitoring for AWS CodeBuild using AWS CLI, you can follow these step-by-step instructions:

1. **Enable CodeDeploy Auto Deploy and Monitoring for AWS CodeBuild**:
   
   Run the following AWS CLI command to update the CodeBuild project to enable CodeDeploy Auto Deploy and Monitoring:

   ```bash
   aws codebuild update-project --name <codebuild-project-name> --environment "type=CODEPIPELINE,computeType=BUILD_GENERAL1_SMALL,image=aws/codebuild/standard:4.0,environmentVariablesOverride=[{name=CODEDEPLOY_AUTO_DEPLOY,value=true},{name=CODEDEPLOY_DEPLOYMENT_CONFIG,value=CodeDeployDefault.AllAtOnce},{name=CODEDEPLOY_APPLICATION_NAME,value=<codedeploy-application-name>},{name=CODEDEPLOY_DEPLOYMENT_GROUP_NAME,value=<codedeploy-deployment-group-name>}]"
   ```

   - Replace `<codebuild-project-name>` with the name of your CodeBuild project.
   - Replace `<codedeploy-application-name>` with the name of your CodeDeploy application.
   - Replace `<codedeploy-deployment-group-name>` with the name of your CodeDeploy deployment group.

2. **Verify Configuration**:

   Run the following AWS CLI command to describe the updated CodeBuild project and verify that the CodeDeploy Auto Deploy and Monitoring settings are enabled:

   ```bash
   aws codebuild batch-get-projects --names <codebuild-project-name>
   ```

   This command will return the details of the CodeBuild project, including the environment settings.

3. **Monitor Deployment**:

   After enabling CodeDeploy Auto Deploy and Monitoring for AWS CodeBuild, you can monitor the deployment process through the AWS CodeDeploy console or CLI.

By following these steps, you can remediate the misconfiguration and enable CodeDeploy Auto Deploy and Monitoring for AWS CodeBuild using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of enabling CodeDeploy auto deploy and monitoring for AWS CodeBuild using Python, you can follow these steps:

Step 1: Import necessary libraries
```python
import boto3
```

Step 2: Define the CodeBuild project name and the CodeDeploy application name
```python
codebuild_project_name = 'YOUR_CODEBUILD_PROJECT_NAME'
codedeploy_application_name = 'YOUR_CODEDEPLOY_APPLICATION_NAME'
```

Step 3: Get the CodeBuild project information
```python
codebuild_client = boto3.client('codebuild')
response = codebuild_client.batch_get_projects(names=[codebuild_project_name])
codebuild_project = response['projects'][0]
```

Step 4: Update the CodeBuild project to enable CodeDeploy auto deploy and monitoring
```python
codebuild_project['environment']['computeType'] = 'BUILD_GENERAL1_SMALL'
codebuild_project['environment']['privilegedMode'] = True
codebuild_project['serviceRole'] = 'arn:aws:iam::YOUR_ACCOUNT_ID:role/YOUR_CODEBUILD_SERVICE_ROLE'
codebuild_project['artifacts']['type'] = 'CODEPIPELINE'
codebuild_project['environment']['type'] = 'LINUX_CONTAINER'
codebuild_project['environment']['image'] = 'aws/codebuild/standard:4.0'
codebuild_project['environment']['imagePullCredentialsType'] = 'CODEBUILD'
codebuild_project['environment']['environmentVariablesOverride'] = [
    {
        'name': 'CODEBUILD_BUILD_ID',
        'type': 'PLAINTEXT',
        'value': '$CODEBUILD_BUILD_ID'
    }
]
codebuild_project['environment']['privilegedMode'] = True
codebuild_project['triggers']['webhook'] = True

codebuild_client.update_project(
    name=codebuild_project_name,
    source=codebuild_project['source'],
    artifacts=codebuild_project['artifacts'],
    environment=codebuild_project['environment'],
    serviceRole=codebuild_project['serviceRole'],
    encryptionKey=codebuild_project['encryptionKey'],
    tags=codebuild_project['tags'],
    timeoutInMinutes=codebuild_project['timeoutInMinutes'],
    queuedTimeoutInMinutes=codebuild_project['queuedTimeoutInMinutes'],
    buildBatchConfig=codebuild_project['buildBatchConfig'],
    fileSystemLocations=codebuild_project['fileSystemLocations'],
    vpcConfig=codebuild_project['vpcConfig'],
    badgeEnabled=codebuild_project['badgeEnabled'],
    logsConfig=codebuild_project['logsConfig'],
    s3LogsConfig=codebuild_project['s3LogsConfig'],
    concurrentBuildLimit=codebuild_project['concurrentBuildLimit'],
    buildTimeout=codebuild_project['buildTimeout'],
    queuedTimeout=codebuild_project['queuedTimeout'],
    environmentVariablesOverride=codebuild_project['environmentVariablesOverride'],
    sourceVersion=codebuild_project['sourceVersion'],
    secondaryArtifacts=codebuild_project['secondaryArtifacts'],
    secondarySources=codebuild_project['secondarySources'],
    cache=codebuild_project['cache'],
    description=codebuild_project['description'],
    fileSystemLocations=codebuild_project['fileSystemLocations'],
    reportBuildStatus=codebuild_project['reportBuildStatus'],
    buildStatusConfig=codebuild_project['buildStatusConfig'],
    badgeEnabled=codebuild_project['badgeEnabled'],
    logsConfig=codebuild_project['logsConfig'],
    fileSystemLocations=codebuild_project['fileSystemLocations'],
    buildStatusConfig=codebuild_project['buildStatusConfig'],
    environmentType=codebuild_project['environmentType'],
    imagePullCredentialsType=codebuild_project['imagePullCredentialsType'],
    computeType=codebuild_project['computeType'],
    webhook=codebuild_project['webhook']
)
```

Step 5: Create a new deployment group in CodeDeploy
```python
codedeploy_client = boto3.client('codedeploy')
response = codedeploy_client.create_deployment_group(
    applicationName=codedeploy_application_name,
    deploymentGroupName='YOUR_DEPLOYMENT_GROUP_NAME',
    deploymentConfigName='CodeDeployDefault.AllAtOnce',
    ec2TagFilters=[
        {
            'Key': 'YOUR_EC2_TAG_KEY',
            'Value': 'YOUR_EC2_TAG_VALUE',
            'Type': 'KEY_AND_VALUE'
        },
    ],
    serviceRoleArn='arn:aws:iam::YOUR_ACCOUNT_ID:role/YOUR_CODEDEPLOY_SERVICE_ROLE',
    autoScalingGroups=[
        'YOUR_AUTO_SCALING_GROUP_NAME',
    ],
    deploymentStyle={
        'deploymentType': 'BLUE_GREEN',
        'deploymentOption': 'WITH_TRAFFIC_CONTROL'
    },
    blueGreenDeploymentConfiguration={
        'terminateBlueInstancesOnDeploymentSuccess': {
            'action': 'TERMINATE',
            'terminationWaitTimeInMinutes': 5
        },
        'deploymentReadyOption': {
            'actionOnTimeout': 'CONTINUE_DEPLOYMENT'
        }
    }
)
```

Please replace placeholders like `YOUR_CODEBUILD_PROJECT_NAME`, `YOUR_CODEDEPLOY_APPLICATION_NAME`, `YOUR_ACCOUNT_ID`, `YOUR_CODEBUILD_SERVICE_ROLE`, `YOUR_EC2_TAG_KEY`, `YOUR_EC2_TAG_VALUE`, `YOUR_CODEDEPLOY_SERVICE_ROLE`, `YOUR_AUTO_SCALING_GROUP_NAME`, and `YOUR_DEPLOYMENT_GROUP_NAME` with your actual values.

These steps will help you remediate the misconfiguration of enabling CodeDeploy auto deploy and monitoring for AWS CodeBuild using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

