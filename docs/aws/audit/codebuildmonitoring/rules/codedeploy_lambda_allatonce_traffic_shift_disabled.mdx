---
slug: codedeploy_lambda_allatonce_traffic_shift_disabled
title: Lambda Compute Platform Should Not Use Default Deployment Configuration
sidebar_label: Lambda Compute Platform Should Not Use Default Deployment Configuration
---

### More Info:

Ensure  Lambda compute platform is not using default configuration

### Risk Level

Medium

### Address

Performance Efficiency, Operational Excellence, Reliability, Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration where the Lambda Compute Platform should not use the default deployment configuration in AWS CodeBuild using the AWS Management Console, follow these steps:

1. **Navigate to CodeBuild:**
   - Open the AWS Management Console.
   - In the search bar, type "CodeBuild" and select it from the dropdown list.

2. **Create or Edit a Build Project:**
   - If you are creating a new build project, click on "Create build project."
   - If you are editing an existing build project, select the project from the list and click on the project name to open its details.

3. **Configure Buildspec File:**
   - In the "Buildspec" section, ensure you have a custom buildspec file defined. This file should include specific deployment configurations rather than relying on default settings.
   - Example buildspec.yml snippet:
     ```yaml
     version: 0.2
     phases:
       build:
         commands:
           - echo Build started on `date`
           - echo Compiling the code...
           - echo Build completed on `date`
     ```

4. **Specify Deployment Configuration:**
   - In the "Deploy" phase of your buildspec file, specify the deployment configuration explicitly.
   - Example:
     ```yaml
     phases:
       post_build:
         commands:
           - echo Deploying the application...
           - aws lambda update-function-code --function-name MyLambdaFunction --zip-file fileb://my-deployment-package.zip --publish
     ```

By following these steps, you ensure that your Lambda functions are deployed with a specific configuration rather than the default, reducing the risk of misconfigurations.
</Accordion>

<Accordion title='Using CLI'>
To prevent Lambda Compute Platform from using the default deployment configuration in CodeBuild using AWS CLI, you can follow these steps:

1. **Create a Custom Deployment Configuration:**
   - Use the `create-deployment-config` command to create a custom deployment configuration.
   ```sh
   aws deploy create-deployment-config --deployment-config-name CustomDeploymentConfig --minimum-healthy-hosts type=FLEET_PERCENT,value=75
   ```

2. **Update the CodeBuild Project to Use the Custom Deployment Configuration:**
   - Use the `update-project` command to update your CodeBuild project to use the custom deployment configuration.
   ```sh
   aws codebuild update-project --name MyCodeBuildProject --deployment-config-name CustomDeploymentConfig
   ```

3. **Verify the Deployment Configuration:**
   - Use the `get-deployment-config` command to verify that the custom deployment configuration is correctly set.
   ```sh
   aws deploy get-deployment-config --deployment-config-name CustomDeploymentConfig
   ```

4. **List All Deployment Configurations to Ensure Compliance:**
   - Use the `list-deployment-configs` command to list all deployment configurations and ensure that the default configuration is not being used.
   ```sh
   aws deploy list-deployment-configs
   ```

By following these steps, you can ensure that your Lambda Compute Platform does not use the default deployment configuration in CodeBuild.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where the Lambda Compute Platform should not use the default deployment configuration in CodeBuild using Python scripts, you can follow these steps:

1. **Set Up AWS SDK for Python (Boto3):**
   Ensure you have Boto3 installed and configured with the necessary permissions to interact with AWS CodeBuild and Lambda.

   ```bash
   pip install boto3
   ```

2. **Create a Custom Deployment Configuration:**
   Use Boto3 to create a custom deployment configuration for your Lambda function. This configuration will specify the deployment settings you want to use instead of the default.

   ```python
   import boto3

   client = boto3.client('codedeploy')

   response = client.create_deployment_config(
       deploymentConfigName='CustomLambdaDeploymentConfig',
       computePlatform='Lambda',
       trafficRoutingConfig={
           'type': 'TimeBasedCanary',
           'timeBasedCanary': {
               'canaryPercentage': 10,
               'canaryInterval': 5
           }
       }
   )

   print(response)
   ```

3. **Update Lambda Function to Use Custom Deployment Configuration:**
   Modify your Lambda function to use the custom deployment configuration created in the previous step.

   ```python
   lambda_client = boto3.client('lambda')

   response = lambda_client.update_function_configuration(
       FunctionName='YourLambdaFunctionName',
       DeploymentConfigName='CustomLambdaDeploymentConfig'
   )

   print(response)
   ```

4. **Verify the Deployment Configuration:**
   Ensure that the Lambda function is now using the custom deployment configuration by retrieving its configuration details.

   ```python
   response = lambda_client.get_function_configuration(
       FunctionName='YourLambdaFunctionName'
   )

   print(response)
   ```

By following these steps, you can prevent the misconfiguration of using the default deployment configuration in AWS Lambda by creating and applying a custom deployment configuration using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS CodeBuild dashboard. You can do this by typing "CodeBuild" into the search bar and selecting it from the dropdown menu.
3. Once you're in the CodeBuild dashboard, select "Build projects" from the left-hand navigation menu.
4. In the list of build projects, select the project you want to check. In the project details page, look for the "Environment" section. If the "Compute" field is set to "Use the default image", it means the Lambda Compute Platform is using the default deployment configuration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install AWS CLI on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account using the command `aws configure`. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CodeBuild projects: Use the following command to list all the CodeBuild projects in your AWS account.

   ```
   aws codebuild list-projects --region your-region-name
   ```

   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all CodeBuild project names.

3. Describe CodeBuild project: For each project in the list, use the following command to get detailed information about the project.

   ```
   aws codebuild batch-get-projects --names project-name --region your-region-name
   ```

   Replace 'project-name' with the name of your CodeBuild project and 'your-region-name' with the name of your AWS region. This command will return a JSON object containing detailed information about the project.

4. Check the deployment configuration: In the JSON object returned by the previous command, look for the 'environment' field. This field contains information about the deployment environment of the project. If the 'computeType' field under 'environment' is set to 'BUILD_GENERAL1_SMALL', it means that the project is using the default deployment configuration.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, ensure that you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials to allow your script to access the AWS services. You can do this by setting up the AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables. Alternatively, you can use the AWS CLI's configure command:

   ```bash
   aws configure
   ```

3. Write a Python script to check the Lambda Compute Platform configuration: You can use the boto3 library to interact with the AWS CodeBuild service. The following script retrieves all the CodeBuild projects in your account and checks if they are using the default deployment configuration:

   ```python
   import boto3

   # Create a client for the AWS CodeBuild service
   codebuild = boto3.client('codebuild')

   # Retrieve all the CodeBuild projects
   response = codebuild.list_projects()

   # Iterate over each project
   for project_name in response['projects']:
       # Retrieve the project configuration
       project = codebuild.batch_get_projects(names=[project_name])

       # Check if the project is using the default configuration
       if project['projects'][0]['environment']['computeType'] == 'BUILD_GENERAL1_SMALL':
           print(f"The project {project_name} is using the default deployment configuration.")
   ```

4. Run the script: You can run the script using the Python interpreter. The script will print the names of the CodeBuild projects that are using the default deployment configuration:

   ```bash
   python check_codebuild_config.py
   ```

This script will help you identify the CodeBuild projects that are using the default deployment configuration. However, it's important to note that using the default configuration is not necessarily a misconfiguration. It depends on the specific requirements and constraints of your project.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Lambda Compute Platform using default deployment configuration for AWS CodeBuild in AWS console, follow these steps:

1. **Access AWS CodeBuild Console:**
   - Go to the AWS Management Console and navigate to the AWS CodeBuild service.

2. **Select the Project:**
   - Select the CodeBuild project that is used for building and deploying the Lambda function.

3. **Edit Build Project:**
   - Click on the project name to access the project details.

4. **Update Buildspec File:**
   - Update the buildspec file to include the necessary configurations for Lambda deployment. Make sure to specify the deployment configurations for Lambda function in the buildspec file.

5. **Update Deployment Configuration:**
   - In the CodeBuild project settings, navigate to the deployment configuration section and ensure that the deployment configuration is set up correctly for Lambda function deployment. You can specify the deployment settings such as the Lambda function name, runtime, handler, memory size, timeout, etc.

6. **Save Changes:**
   - Save the changes made to the CodeBuild project settings.

7. **Trigger Build:**
   - Trigger a new build for the CodeBuild project to deploy the Lambda function with the updated deployment configuration.

By following these steps, you can remediate the misconfiguration of Lambda Compute Platform using default deployment configuration for AWS CodeBuild in the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Lambda Compute Platform using default deployment configuration in AWS CodeBuild using AWS CLI, follow these steps:

1. Open your terminal or command prompt.

2. Run the following command to update the AWS CodeBuild project to ensure that Lambda Compute Platform does not use default deployment configuration:
   
   ```bash
   aws codebuild update-project --name <project-name> --environment type=LINUX_CONTAINER,computeType=BUILD_GENERAL1_SMALL,image=aws/codebuild/standard:4.0
   ```
   Replace `<project-name>` with the actual name of your AWS CodeBuild project.

3. This command will update the AWS CodeBuild project's environment settings to use a specific compute type (BUILD_GENERAL1_SMALL) and a specific Docker image (aws/codebuild/standard:4.0) which ensures that Lambda Compute Platform does not use default deployment configuration.

4. Once the command is executed successfully, the AWS CodeBuild project will be updated with the remediated configuration.

By following these steps, you can remediate the misconfiguration of Lambda Compute Platform using default deployment configuration in AWS CodeBuild using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration where the Lambda Compute Platform is using the default deployment configuration for AWS CodeBuild, you can follow these steps in Python:

1. **Create a CodeBuild Project with Custom Deployment Configuration**:
   
   Use the AWS SDK for Python (Boto3) to create a new CodeBuild project with a custom deployment configuration. You can specify the deployment configuration in the `environment` parameter when creating the project.

   ```python
   import boto3

   codebuild = boto3.client('codebuild')

   response = codebuild.create_project(
       name='your-project-name',
       source={
           'type': 'CODEPIPELINE',
           'buildspec': 'buildspec.yml'
       },
       environment={
           'type': 'LINUX_CONTAINER',
           'image': 'aws/codebuild/standard:4.0',
           'computeType': 'BUILD_GENERAL1_SMALL',
           'environmentVariables': [
               {
                   'name': 'CUSTOM_DEPLOYMENT_CONFIG',
                   'value': 'your-custom-deployment-config'
               }
           ]
       },
       serviceRole='arn:aws:iam::123456789012:role/service-role/codebuild-your-service-role',
       artifacts={
           'type': 'CODEPIPELINE',
       }
   )
   ```

2. **Update Existing CodeBuild Project**:

   If you already have an existing CodeBuild project that is using the default deployment configuration, you can update the project to use a custom deployment configuration.

   ```python
   import boto3

   codebuild = boto3.client('codebuild')

   response = codebuild.update_project(
       name='your-project-name',
       environment={
           'type': 'LINUX_CONTAINER',
           'image': 'aws/codebuild/standard:4.0',
           'computeType': 'BUILD_GENERAL1_SMALL',
           'environmentVariables': [
               {
                   'name': 'CUSTOM_DEPLOYMENT_CONFIG',
                   'value': 'your-custom-deployment-config'
               }
           ]
       }
   )
   ```

3. **Verify the Deployment Configuration**:

   After creating or updating the CodeBuild project with the custom deployment configuration, verify that the project is using the specified deployment configuration by checking the project settings in the AWS Management Console or using the AWS CLI or SDK.

By following these steps and providing a custom deployment configuration for your Lambda Compute Platform in AWS CodeBuild, you can remediate the misconfiguration and ensure that your Lambda functions are deployed securely and efficiently.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
.