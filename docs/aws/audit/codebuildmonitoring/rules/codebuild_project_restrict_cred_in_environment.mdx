---
slug: codebuild_project_restrict_cred_in_environment
title: Plaintext AWS Credentials In Environment Variables CodeBuild Project Should Not Be Set
sidebar_label: Plaintext AWS Credentials In Environment Variables CodeBuild Project Should Not Be Set
---

### More Info:

This rule checks AWS CodeBuild projects for environment variables that contain plaintext AWS credentials (AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY). Storing AWS credentials in plaintext within environment variables poses a significant security risk, as it can lead to unauthorized access if the credentials are exposed. It is recommended to use IAM roles or encrypted secrets management services like AWS Secrets Manager to handle credentials securely.

### Risk Level

High

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the AWS CodeBuild dashboard.
2. In the navigation pane, select "Build projects". This will display a list of all your CodeBuild projects.
3. Select the CodeBuild project you want to inspect for plaintext AWS credentials. This will open the project details page.
4. In the project details page, check the "Environment" section. If there are any environment variables with names like 'AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY', or 'AWS_SESSION_TOKEN', it indicates that plaintext AWS credentials are being set in the CodeBuild project.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the required resources.

2. Once the AWS CLI is set up, you can list all the CodeBuild projects in your account using the following command:

   ```
   aws codebuild list-projects --region your-region-name
   ```

   Replace 'your-region-name' with the name of your AWS region. This command will return a list of all CodeBuild project names.

3. For each project, you can get the environment variables using the following command:

   ```
   aws codebuild batch-get-projects --names project-name --region your-region-name
   ```

   Replace 'project-name' with the name of your CodeBuild project and 'your-region-name' with the name of your AWS region. This command will return the details of the specified CodeBuild project, including the environment variables.

4. You can then inspect the output of the above command to check if any environment variables contain plaintext AWS credentials. The environment variables are listed under the 'environmentVariables' field in the output. If any environment variables contain 'AWS_ACCESS_KEY_ID' or 'AWS_SECRET_ACCESS_KEY', it means that plaintext AWS credentials are set in the CodeBuild project.

#### Using Python

1. Import the necessary AWS SDK for Python (Boto3) and other necessary libraries. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
import boto3
from botocore.exceptions import BotoCoreError, ClientError
```

2. Create a session using your AWS credentials. Replace 'aws_access_key_id', 'aws_secret_access_key', and 'aws_session_token' with your actual AWS credentials.

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

3. Create a CodeBuild client from the session.

```python
client = session.client('codebuild')
```

4. List all the CodeBuild projects and check if any of them have plaintext AWS credentials set in environment variables. 

```python
try:
    response = client.list_projects()
    for project in response['projects']:
        project_details = client.batch_get_projects(names=[project])
        for project in project_details['projects']:
            env_vars = project['environment']['environmentVariables']
            for var in env_vars:
                if 'AWS_ACCESS_KEY_ID' in var['name'] or 'AWS_SECRET_ACCESS_KEY' in var['name']:
                    if var['type'] != 'PARAMETER_STORE':
                        print(f"Plaintext AWS credentials detected in project: {project['name']}")
except ClientError as e:
    print(f"Unexpected error: {e}")
```

This script will print the names of all the CodeBuild projects that have plaintext AWS credentials set in environment variables.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate plaintext AWS credentials in environment variables in an AWS CodeBuild project, follow these steps using the AWS Management Console:

1. **Access AWS CodeBuild Console**:
   - Log in to your AWS Management Console.
   - Navigate to the AWS CodeBuild console.

2. **Identify the Project**:
   - Locate the CodeBuild project where plaintext AWS credentials are set in environment variables.

3. **Update Environment Variables**:
   - Click on the CodeBuild project name to access its details.
   - In the project details, navigate to the "Environment" section.

4. **Modify Environment Settings**:
   - Look for the environment variables section where plaintext AWS credentials are set.
   - Remove any environment variables that contain AWS credentials in plaintext.

5. **Use AWS Secrets Manager**:
   - Instead of storing credentials in plaintext, consider using AWS Secrets Manager to securely store and retrieve sensitive information.
   - Create a secret in AWS Secrets Manager to store the AWS credentials securely.

6. **Update Build Specification**:
   - If the AWS credentials are being passed through a buildspec file, ensure that the credentials are not hardcoded in the file.
   - Modify the buildspec file to fetch the credentials securely from AWS Secrets Manager or other secure storage mechanisms.

7. **Test the Build**:
   - Save the changes to the CodeBuild project configuration.
   - Trigger a build to ensure that the project can still build successfully without the plaintext AWS credentials.

8. **Monitor and Audit**:
   - Regularly monitor and audit your CodeBuild projects for any insecure configurations.
   - Implement automated checks to prevent plaintext AWS credentials from being introduced in the future.

By following these steps, you can remediate the issue of plaintext AWS credentials in environment variables in an AWS CodeBuild project and ensure that sensitive information is handled securely.

#### Using CLI

To remediate the issue of plaintext AWS credentials in environment variables in an AWS CodeBuild project using AWS CLI, you can follow these steps:

1. **Identify the CodeBuild project**: Use the AWS CLI command `aws codebuild list-projects` to list all the CodeBuild projects in your account. Identify the project where plaintext AWS credentials are set in environment variables.

2. **Update the CodeBuild project**: Use the AWS CLI command `aws codebuild update-project` to update the CodeBuild project configuration. You will need to specify the project name or ARN in the command.

3. **Remove plaintext AWS credentials from environment variables**: In the `environment` section of the CodeBuild project configuration, locate the environment variables that contain plaintext AWS credentials. Remove these environment variables or replace them with secure methods of providing credentials, such as using AWS Systems Manager Parameter Store or AWS Secrets Manager.

4. **Store AWS credentials securely**: If the CodeBuild project requires AWS credentials to access AWS resources, it is recommended to store these credentials securely in AWS Secrets Manager or AWS Systems Manager Parameter Store. Retrieve the credentials securely during the build process instead of passing them as plaintext environment variables.

5. **Update the buildspec file**: If the build process requires AWS credentials, update the buildspec file to include the necessary steps to retrieve the credentials securely from AWS Secrets Manager or AWS Systems Manager Parameter Store.

6. **Test the updated CodeBuild project**: Trigger a build in the CodeBuild project to ensure that the changes made to remove plaintext AWS credentials from environment variables do not impact the build process.

By following these steps, you can remediate the issue of plaintext AWS credentials in environment variables in an AWS CodeBuild project using AWS CLI.

#### Using Python

To remediate the issue of having plaintext AWS credentials in environment variables in an AWS CodeBuild project, you should follow these steps:

1. **Create an IAM Role**: Create an IAM role with the necessary permissions for your CodeBuild project to access AWS resources securely. This role will be assumed by the CodeBuild service when running your build.

2. **Update CodeBuild Project Configuration**:
   - Open the AWS Management Console and navigate to the CodeBuild service.
   - Select your CodeBuild project that contains the plaintext AWS credentials in environment variables.
   - Click on "Edit" to modify the project configuration.
   - In the project configuration, under the "Environment" section, set the "Service role" to the IAM role you created in step 1.
   - Remove any plaintext AWS credentials present in the environment variables.

3. **Use AWS SDK for Python (Boto3)**: Instead of using plaintext AWS credentials in environment variables, utilize the AWS SDK for Python (Boto3) to interact with AWS services securely using the IAM role assigned to your CodeBuild project.

4. **Update Build Spec**: If you are using a `buildspec.yml` file to define the build steps, ensure that you update the build spec to use the AWS SDK for Python (Boto3) to interact with AWS services securely.

5. **Test the Build**: After making these changes, run a test build to ensure that your CodeBuild project can access AWS resources securely without using plaintext AWS credentials in environment variables.

By following these steps, you can remediate the issue of having plaintext AWS credentials in environment variables in an AWS CodeBuild project and ensure secure access to AWS resources.

</Tab>
</Tabs>