
### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of Route 53 domains not being locked in AWS Route 53 using the AWS Management Console, follow these steps:

1. **Navigate to Route 53:**
   - Sign in to the AWS Management Console.
   - Open the Route 53 console by searching for "Route 53" in the AWS services search bar and selecting it.

2. **Select the Domain:**
   - In the Route 53 dashboard, click on "Registered Domains" in the left-hand navigation pane.
   - Select the domain you want to lock from the list of registered domains.

3. **Enable Domain Lock:**
   - In the domain details page, look for the "Domain Lock" section.
   - Click on the "Enable" button to lock the domain. This will prevent unauthorized changes to the domain settings.

4. **Confirm the Action:**
   - A confirmation dialog will appear. Confirm that you want to enable domain lock by clicking the "Enable" button again.

By following these steps, you can ensure that your Route 53 domains are locked, thereby preventing unauthorized modifications.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of Route 53 domains not being locked in AWS, you can use the AWS CLI to ensure that your domains are locked. Here are the steps to achieve this:

1. **List All Registered Domains:**
   First, you need to list all the domains registered in Route 53 to identify which domains need to be locked.
   ```sh
   aws route53domains list-domains
   ```

2. **Check Domain Lock Status:**
   For each domain, check the current lock status to determine if it needs to be locked.
   ```sh
   aws route53domains get-domain-detail --domain-name example.com
   ```

3. **Enable Domain Transfer Lock:**
   If the domain is not locked, enable the transfer lock to prevent unauthorized transfers.
   ```sh
   aws route53domains enable-domain-transfer-lock --domain-name example.com
   ```

4. **Verify Lock Status:**
   After enabling the lock, verify that the domain is now locked.
   ```sh
   aws route53domains get-domain-detail --domain-name example.com
   ```

By following these steps, you can ensure that your Route 53 domains are locked, thereby preventing unauthorized transfers and enhancing security.
</Accordion>

<Accordion title='Using Python'>
To prevent Route 53 domains from being unlocked in AWS Route 53 using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that your Route 53 domains are locked:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Python Script to Lock Domains**:
   Use the following Python script to lock your Route 53 domains. This script will iterate through all your Route 53 domains and ensure they are locked.

   ```python
   import boto3

   # Initialize a session using Amazon Route 53
   client = boto3.client('route53domains')

   def lock_domain(domain_name):
       try:
           response = client.enable_domain_transfer_lock(
               DomainName=domain_name
           )
           print(f"Domain {domain_name} is now locked.")
       except Exception as e:
           print(f"Error locking domain {domain_name}: {e}")

   def main():
       try:
           # List all domains
           response = client.list_domains()
           domains = response['Domains']

           for domain in domains:
               domain_name = domain['DomainName']
               # Check if the domain is already locked
               domain_detail = client.get_domain_detail(DomainName=domain_name)
               if not domain_detail['TransferLock']:
                   lock_domain(domain_name)
               else:
                   print(f"Domain {domain_name} is already locked.")
       except Exception as e:
           print(f"Error listing domains: {e}")

   if __name__ == "__main__":
       main()
   ```

4. **Run the Script**:
   Execute the script to ensure all your Route 53 domains are locked.
   ```bash
   python lock_route53_domains.py
   ```

This script will ensure that all your Route 53 domains are locked, preventing unauthorized transfers. Make sure to run this script periodically or integrate it into your CI/CD pipeline to maintain the security of your domains.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Route 53 console at https://console.aws.amazon.com/route53/.
   
2. In the navigation pane, click on "Registered domains".

3. This will open a list of all the domains that are registered with Route 53. Click on the domain name that you want to check.

4. In the domain details page, check the "Domain lock" status. If the status is "Locked", the domain is secure. If the status is "Unlocked", the domain is not secure and is vulnerable to unauthorized domain transfers.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS website. Once installed, you can configure it by running `aws configure` and providing your AWS credentials.

2. List all domains: Use the following command to list all the domains in your AWS account.

   ```
   aws route53domains list-domains
   ```

   This command will return a list of all the domains in your AWS account. 

3. Get domain details: For each domain, you can get more details including whether the domain is locked or not by using the following command:

   ```
   aws route53domains get-domain-detail --domain-name <your-domain-name>
   ```

   Replace `<your-domain-name>` with the name of your domain. This command will return a lot of information about the domain including the `DomainTransferLock` field which indicates whether the domain is locked or not.

4. Check DomainTransferLock: If the `DomainTransferLock` field is set to `false`, then the domain is not locked. If it is set to `true`, then the domain is locked. 

Remember to replace `<your-domain-name>` with the actual name of your domain.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call any AWS services. You can pass these credentials directly in your python script (not recommended for production) or configure it in your system using AWS CLI.

3. Create a Python script: Now, you can create a Python script that uses boto3 to interact with Route 53. The script will list all the domains and check if they are locked.

   ```python
   import boto3

   # Create a client
   client = boto3.client('route53domains')

   # List all the domains
   response = client.list_domains()

   # Iterate over each domain
   for domain in response['Domains']:
       # Get domain detail
       domain_detail = client.get_domain_detail(DomainName=domain['DomainName'])
       # Check if the domain is locked
       if not domain_detail['StatusList']:
           print(f"Domain {domain['DomainName']} is not locked.")
       elif 'CLIENT_TRANSFER_PROHIBITED' not in domain_detail['StatusList']:
           print(f"Domain {domain['DomainName']} is not locked.")
   ```

4. Run the Python script: Finally, you can run the Python script. It will print out the names of all domains that are not locked. If all domains are locked, it will not print anything. This way, you can easily detect if any Route 53 domains are not locked.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the steps to remediate the misconfiguration of unlocked Route 53 domains in AWS:

1. Open the AWS Management Console and go to the Route 53 service.

2. In the left navigation pane, click on the Registered domains option.

3. Select the domain that you want to lock.

4. In the domain details page, click on the "Add/Edit Tags" button.

5. In the "Add/Edit Tags" dialog box, click on the "Add tag" button.

6. In the "Key" field, enter "LockDomain" and in the "Value" field, enter "True".

7. Click on the "Save changes" button to save the tag.

8. After adding the tag, click on the "Lock domain" button to lock the domain.

9. In the "Lock domain" dialog box, review the information and click on the "Lock domain" button to confirm.

10. Once the domain is locked, you will see the "Domain lock enabled" message on the domain details page.

Congratulations! You have successfully remediated the misconfiguration of unlocked Route 53 domains in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of unlocked Route 53 domains in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get a list of your Route 53 domains:

```
aws route53domains list-domains
```

3. For each domain in the list, run the following command to check if it is locked:

```
aws route53domains get-domain-detail --domain-name <domain-name> | grep "Status: LOCKED"
```

If the output of this command shows that the domain is already locked, then no further action is needed for that domain.

4. If the domain is not locked, run the following command to lock it:

```
aws route53domains update-domain-nameservers --domain-name <domain-name> --nameservers LOCKED
```

This command will update the nameservers for the domain to be locked. 

5. Finally, run the following command to verify that the domain is now locked:

```
aws route53domains get-domain-detail --domain-name <domain-name> | grep "Status: LOCKED"
```

If the output of this command shows that the domain is now locked, then the remediation is complete.
</Accordion>

<Accordion title='Using Python'>
To remediate the Route 53 Domains Should Be Locked misconfiguration in AWS using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) using the following command:
```
pip install boto3
```

2. Create an AWS IAM user with the necessary permissions to manage Route 53 domains. 

3. Configure the AWS CLI with the IAM user credentials using the following command:
```
aws configure
```

4. Write a Python script to enable domain locking for all Route 53 domains using the following code:

```python
import boto3

# Create a Route 53 client
client = boto3.client('route53domains')

# Get a list of all domains
response = client.list_domains()

# Loop through each domain and enable domain locking
for domain in response['Domains']:
    client.update_domain_dnssec(
        DomainName=domain['DomainName'],
        EnableSuggestion=False,
        KeyTag='12345',
        KmsArn='arn:aws:kms:us-west-2:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab',
        SecretKey='1234567890123456789012345678901234567890123456789012345678901234',
        Validation='EMAIL'
    )
```

5. Save the script and run it using the following command:
```
python script.py
```

This will enable domain locking for all Route 53 domains in your AWS account.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
