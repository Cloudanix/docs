---
slug: aws_cloudfront_distribution_cname_records_without_s3_origin
title: AWS Cloudfront Distribution CNAME Record Has No S3 origin
sidebar_label: AWS Cloudfront Distribution CNAME Record Has No S3 origin
---

### More Info:

Ensures that the CloudFront distribution CNAME record has S3 origin

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent an AWS CloudFront Distribution CNAME record from having no S3 origin in Route 53 using the AWS Management Console, follow these steps:

1. **Create an S3 Bucket:**
   - Navigate to the S3 service in the AWS Management Console.
   - Click on "Create bucket."
   - Provide a unique bucket name and select the appropriate region.
   - Configure the bucket settings as needed and click "Create bucket."

2. **Configure the S3 Bucket for Static Website Hosting:**
   - Select the newly created S3 bucket.
   - Go to the "Properties" tab.
   - Enable "Static website hosting" and specify the index document (e.g., `index.html`).
   - Save the changes.

3. **Create a CloudFront Distribution with S3 Origin:**
   - Navigate to the CloudFront service in the AWS Management Console.
   - Click on "Create Distribution."
   - Choose "Web" and click "Get Started."
   - Under "Origin Settings," set the "Origin Domain Name" to the S3 bucket you created.
   - Configure other settings as needed and click "Create Distribution."

4. **Update Route 53 with CloudFront Distribution CNAME:**
   - Navigate to the Route 53 service in the AWS Management Console.
   - Select the hosted zone for your domain.
   - Click on "Create Record Set."
   - Enter the name (CNAME) you want to use.
   - Set the "Type" to "CNAME - Canonical name."
   - In the "Value" field, enter the CloudFront distribution domain name (e.g., `d1234567890.cloudfront.net`).
   - Click "Create" to save the record.

By following these steps, you ensure that the CNAME record in Route 53 points to a CloudFront distribution that has an S3 bucket as its origin, thus preventing the misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
To prevent an AWS CloudFront distribution CNAME record from having no S3 origin in Route 53 using AWS CLI, follow these steps:

1. **Create an S3 Bucket:**
   Ensure you have an S3 bucket that will serve as the origin for your CloudFront distribution.
   ```sh
   aws s3 mb s3://your-bucket-name
   ```

2. **Create a CloudFront Distribution with S3 Origin:**
   Create a CloudFront distribution and specify the S3 bucket as the origin.
   ```sh
   aws cloudfront create-distribution --origin-domain-name your-bucket-name.s3.amazonaws.com --default-root-object index.html
   ```

3. **Update Route 53 Record Set:**
   Create or update a Route 53 record set to point to the CloudFront distribution.
   ```sh
   aws route53 change-resource-record-sets --hosted-zone-id Z3M3LMPEXAMPLE --change-batch '{
     "Changes": [{
       "Action": "UPSERT",
       "ResourceRecordSet": {
         "Name": "your-cname.example.com",
         "Type": "CNAME",
         "TTL": 300,
         "ResourceRecords": [{
           "Value": "your-distribution-id.cloudfront.net"
         }]
       }
     }]
   }'
   ```

4. **Verify the Configuration:**
   Ensure that the CloudFront distribution is correctly associated with the S3 bucket and the Route 53 CNAME record is pointing to the CloudFront distribution.
   ```sh
   aws cloudfront get-distribution --id your-distribution-id
   aws route53 list-resource-record-sets --hosted-zone-id Z3M3LMPEXAMPLE
   ```

By following these steps, you can ensure that your CloudFront distribution CNAME record has an S3 origin configured in Route 53 using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent an AWS CloudFront Distribution CNAME record from having no S3 origin in Route 53 using Python scripts, you can follow these steps:

### 1. Install Required Libraries
First, ensure you have the `boto3` library installed, which is the AWS SDK for Python.

```bash
pip install boto3
```

### 2. Initialize Boto3 Clients
Initialize the Boto3 clients for CloudFront and Route 53.

```python
import boto3

cloudfront_client = boto3.client('cloudfront')
route53_client = boto3.client('route53')
```

### 3. Validate CloudFront Distribution CNAMEs
Fetch the CloudFront distributions and validate that each CNAME has a corresponding S3 origin.

```python
def validate_cloudfront_cnames():
    distributions = cloudfront_client.list_distributions()
    for distribution in distributions['DistributionList']['Items']:
        distribution_id = distribution['Id']
        cnames = distribution['Aliases']['Items']
        origins = distribution['Origins']['Items']
        
        s3_origins = [origin for origin in origins if origin['DomainName'].endswith('.s3.amazonaws.com')]
        
        if not s3_origins:
            print(f"Distribution {distribution_id} has CNAMEs but no S3 origin.")
            # Add logic to handle this case, e.g., notify, log, or remediate

validate_cloudfront_cnames()
```

### 4. Ensure Route 53 Records Point to S3 Origin
Check that the Route 53 records for the CNAMEs point to the S3 origin.

```python
def ensure_route53_records(cname, s3_origin):
    hosted_zones = route53_client.list_hosted_zones()
    for zone in hosted_zones['HostedZones']:
        zone_id = zone['Id']
        records = route53_client.list_resource_record_sets(HostedZoneId=zone_id)
        
        for record in records['ResourceRecordSets']:
            if record['Name'] == cname and record['Type'] == 'CNAME':
                if record['ResourceRecords'][0]['Value'] != s3_origin:
                    print(f"Route 53 record for {cname} does not point to the S3 origin {s3_origin}.")
                    # Add logic to update the record, notify, log, or remediate

def validate_and_ensure_route53():
    distributions = cloudfront_client.list_distributions()
    for distribution in distributions['DistributionList']['Items']:
        cnames = distribution['Aliases']['Items']
        origins = distribution['Origins']['Items']
        
        s3_origins = [origin for origin in origins if origin['DomainName'].endswith('.s3.amazonaws.com')]
        
        if s3_origins:
            s3_origin = s3_origins[0]['DomainName']
            for cname in cnames:
                ensure_route53_records(cname, s3_origin)

validate_and_ensure_route53()
```

### Summary
1. **Install Required Libraries**: Ensure `boto3` is installed.
2. **Initialize Boto3 Clients**: Set up clients for CloudFront and Route 53.
3. **Validate CloudFront Distribution CNAMEs**: Check that each CloudFront distribution with CNAMEs has an S3 origin.
4. **Ensure Route 53 Records Point to S3 Origin**: Verify that Route 53 records for the CNAMEs point to the S3 origin and take necessary actions if they do not.

These steps will help you prevent the misconfiguration where a CloudFront distribution CNAME record has no S3 origin in Route 53 using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Route 53 dashboard. 

2. In the Route 53 dashboard, select "Hosted zones" from the left-hand side menu. This will display a list of all the domains that you have registered with Route 53.

3. Click on the domain name that you want to check. This will open a list of all the record sets associated with that domain.

4. Look for the CNAME record that points to your CloudFront distribution. Click on it to view its details. Check the "Value/Route traffic to" field. If it's pointing to an S3 bucket, then the CloudFront distribution CNAME record has an S3 origin. If it's not, then it doesn't.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the CloudFront distributions using the AWS CLI. You can do this by running the following command:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].[Id,Origins.Items[*].DomainName]' --output text
   ```
   This command will return a list of all CloudFront distributions and their origin domain names.

2. Next, you need to list all the Route53 hosted zones using the AWS CLI. You can do this by running the following command:

   ```
   aws route53 list-hosted-zones --query 'HostedZones[*].Id' --output text
   ```
   This command will return a list of all hosted zone IDs.

3. For each hosted zone ID, you need to list all the record sets. You can do this by running the following command:

   ```
   aws route53 list-resource-record-sets --hosted-zone-id <hosted-zone-id> --query 'ResourceRecordSets[*].[Name,Type,ResourceRecords[*].Value]' --output text
   ```
   Replace `<hosted-zone-id>` with the ID of the hosted zone. This command will return a list of all record sets in the hosted zone.

4. Finally, you need to compare the CNAME records in Route53 with the origin domain names in CloudFront. If a CNAME record in Route53 does not have a corresponding S3 origin in CloudFront, then it is a misconfiguration. This comparison can be done manually or by using a script.
</Accordion>

<Accordion title='Using Python'>
1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, you can use the Route53 and CloudFront clients to list all the hosted zones and distributions respectively:

```python

route53_client = session.client('route53')
cloudfront_client = session.client('cloudfront')

hosted_zones = route53_client.list_hosted_zones()
distributions = cloudfront_client.list_distributions()
```

4. Finally, you can iterate over the hosted zones and distributions to check if there is a CNAME record in Route53 that doesn't have a corresponding S3 origin in CloudFront:

```python
for zone in hosted_zones['HostedZones']:
    record_sets = route53_client.list_resource_record_sets(HostedZoneId=zone['Id'])
    for record_set in record_sets['ResourceRecordSets']:
        if record_set['Type'] == 'CNAME':
            cname = record_set['Name']
            found = False
            for distribution in distributions['DistributionList']['Items']:
                for origin in distribution['Origins']['Items']:
                    if origin['DomainName'] == cname and 's3' in origin['DomainName']:
                        found = True
                        break
                if found:
                    break
            if not found:
                print(f"CNAME record {cname} has no S3 origin in CloudFront")
```

This script will print all the CNAME records in Route53 that don't have a corresponding S3 origin in CloudFront.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin, you can follow these step-by-step instructions using the AWS Management Console:

1. Open the AWS Management Console and navigate to the Route 53 service.

2. In the Route 53 dashboard, click on "Hosted zones" in the left-hand navigation pane.

3. Select the hosted zone associated with the domain name used for the CloudFront distribution.

4. In the list of records, locate the CNAME record pointing to the CloudFront distribution.

5. Click on the record to select it.

6. Click on the "Edit" button above the record list.

7. In the "Value/Route traffic to" field, enter the S3 bucket endpoint as the value. You can find the S3 bucket endpoint by navigating to the S3 service, selecting the bucket used as the origin for the CloudFront distribution, and copying the bucket's endpoint URL.

8. After entering the S3 bucket endpoint, click on the "Save Record Set" button to save the changes.

9. Once the changes are saved, the CNAME record will be updated to point to the S3 bucket as the origin for the CloudFront distribution.

10. Verify the changes by accessing your website or application through the CloudFront distribution URL. The content should now be served from the S3 bucket.

By following these steps, you will successfully remediate the misconfiguration of the AWS CloudFront distribution CNAME record having no S3 origin using the AWS Management Console in Route 53.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the issue of an AWS CloudFront distribution CNAME record having no S3 origin using AWS CLI, you can follow these step-by-step instructions:

1. Install and configure the AWS CLI if you haven't already. You can refer to the AWS CLI documentation for instructions on installation and configuration.

2. Open your command-line interface (CLI) and ensure that you have the necessary permissions to make changes to AWS resources.

3. Identify the CloudFront distribution that needs to be remediated. You can use the following command to list all your CloudFront distributions:

   ```
   aws cloudfront list-distributions
   ```

   Note down the distribution ID of the affected CloudFront distribution.

4. Retrieve the current configuration of the CloudFront distribution using the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   Replace `<distribution-id>` with the actual distribution ID you noted down in the previous step.

5. The output of the previous command will provide a JSON representation of the distribution configuration. Look for the `"Origins"` section and identify the origin that is missing the S3 bucket.

6. To add an S3 origin to the CloudFront distribution, you need to update the distribution configuration. Create a JSON file with the updated configuration, including the missing S3 origin. For example:

   ```json
   {
     "DistributionConfig": {
       "Origins": {
         "Items": [
           {
             "Id": "S3-origin",
             "DomainName": "your-s3-bucket.s3.amazonaws.com",
             "S3OriginConfig": {
               "OriginAccessIdentity": ""
             }
           }
         ],
         "Quantity": 1
       },
       "Enabled": true,
       "Comment": "Your distribution comment",
       ...
     }
   }
   ```

   Replace `"your-s3-bucket"` with the name of your actual S3 bucket.

7. Save the JSON file with the updated configuration.

8. Update the CloudFront distribution configuration using the following command:

   ```
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://<path-to-json-file>
   ```

   Replace `<distribution-id>` with the actual distribution ID, and `<path-to-json-file>` with the path to the JSON file you created in the previous step.

9. Wait for the CloudFront distribution to be updated. You can monitor the progress by using the following command:

   ```
   aws cloudfront wait distribution-deployed --id <distribution-id>
   ```

   Replace `<distribution-id>` with the actual distribution ID.

10. Once the distribution is deployed, the CNAME record will be updated automatically with the S3 origin.

By following these steps, you should be able to remediate the AWS CloudFront distribution CNAME record misconfiguration by adding the missing S3 origin.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin using Python, follow these steps:

1. Import the required AWS SDK libraries:
```python
import boto3
```

2. Initialize the AWS Route53 client:
```python
route53_client = boto3.client('route53')
```

3. Get the hosted zone ID for your domain:
```python
response = route53_client.list_hosted_zones_by_name(
    DNSName='yourdomain.com'
)

hosted_zone_id = response['HostedZones'][0]['Id']
```

4. Retrieve the existing CNAME record:
```python
response = route53_client.list_resource_record_sets(
    HostedZoneId=hosted_zone_id,
    StartRecordName='yourdomain.com',
    StartRecordType='CNAME',
    MaxItems='1'
)

cname_record = response['ResourceRecordSets'][0]
```

5. Update the CNAME record to point to the CloudFront distribution:
```python
cname_record['ResourceRecords'][0]['Value'] = 'your-cloudfront-distribution-domain.com'

response = route53_client.change_resource_record_sets(
    HostedZoneId=hosted_zone_id,
    ChangeBatch={
        'Changes': [
            {
                'Action': 'UPSERT',
                'ResourceRecordSet': cname_record
            }
        ]
    }
)

print('CNAME record updated successfully.')
```

Make sure to replace `'yourdomain.com'` with your actual domain name and `'your-cloudfront-distribution-domain.com'` with the domain name of your CloudFront distribution.

By following these steps, you can remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin using Python and AWS Route53.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

