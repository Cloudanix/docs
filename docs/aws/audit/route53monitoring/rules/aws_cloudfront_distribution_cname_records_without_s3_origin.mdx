---
slug: aws_cloudfront_distribution_cname_records_without_s3_origin
title: AWS Cloudfront Distribution CNAME Record Has No S3 origin
sidebar_label: AWS Cloudfront Distribution CNAME Record Has No S3 origin
---

### More Info:

Ensures that the CloudFront distribution CNAME record has S3 origin

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the Route 53 dashboard.
2. In the Route 53 dashboard, select "Hosted zones" from the left-hand menu. This will display a list of all the domains that you have registered with Route 53.
3. Click on the domain name that you want to check. This will open a list of all the record sets associated with that domain.
4. Look for a CNAME record that points to a CloudFront distribution. If the CNAME record's value is a CloudFront URL (e.g., d12345abcdefg.cloudfront.net), then it is pointing to a CloudFront distribution. To check if this distribution has an S3 origin, you need to go to the CloudFront dashboard.
5. In the CloudFront dashboard, click on the ID of the distribution that matches the CNAME record's value. This will open the distribution's settings.
6. In the distribution's settings, click on the "Origins and Origin Groups" tab. This will display a list of all the origins associated with the distribution.
7. If there is no S3 bucket listed as an origin, then the CloudFront distribution CNAME record has no S3 origin in Route 53.

#### Using CLI

1. First, you need to list all the CloudFront distributions using the AWS CLI. You can do this by running the following command:

   ```
   aws cloudfront list-distributions --query 'DistributionList.Items[*].[Id,Origins.Items[*].DomainName]' --output text
   ```
   This command will return a list of all CloudFront distributions and their origin domain names.

2. Next, you need to list all the Route53 hosted zones using the AWS CLI. You can do this by running the following command:

   ```
   aws route53 list-hosted-zones --query 'HostedZones[*].Id' --output text
   ```
   This command will return a list of all hosted zone IDs.

3. For each hosted zone ID, you need to list all the record sets. You can do this by running the following command:

   ```
   aws route53 list-resource-record-sets --hosted-zone-id <hosted-zone-id> --query 'ResourceRecordSets[*].[Name,Type,ResourceRecords[*].Value]' --output text
   ```
   Replace `<hosted-zone-id>` with the ID of the hosted zone. This command will return a list of all record sets in the hosted zone.

4. Finally, you need to compare the CNAME records in Route53 with the origin domain names in CloudFront. If a CNAME record in Route53 does not have a corresponding S3 origin in CloudFront, then it is a misconfiguration. This comparison can be done manually or by using a script.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) to interact with AWS services. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2' # or your preferred region
)
```

3. Now, create a client for Route53 and CloudFront:

```python
route53 = session.client('route53')
cloudfront = session.client('cloudfront')
```

4. Now, you can list all the hosted zones in Route53 and for each hosted zone, list all the record sets. For each record set, if the type is 'CNAME', check if the corresponding CloudFront distribution has an S3 origin:

```python
hosted_zones = route53.list_hosted_zones()

for zone in hosted_zones['HostedZones']:
    record_sets = route53.list_resource_record_sets(HostedZoneId=zone['Id'])
    
    for record_set in record_sets['ResourceRecordSets']:
        if record_set['Type'] == 'CNAME':
            distribution_id = record_set['ResourceRecords'][0]['Value'].split('.')[0]
            distribution_config = cloudfront.get_distribution_config(Id=distribution_id)
            
            for origin in distribution_config['DistributionConfig']['Origins']['Items']:
                if 's3' not in origin['DomainName']:
                    print(f"CloudFront distribution {distribution_id} with CNAME record in Route53 has no S3 origin.")
```

This script will print out the IDs of all CloudFront distributions that have a CNAME record in Route53 but do not have an S3 origin.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin, you can follow these step-by-step instructions using the AWS Management Console:

1. Open the AWS Management Console and navigate to the Route 53 service.

2. In the Route 53 dashboard, click on "Hosted zones" in the left-hand navigation pane.

3. Select the hosted zone associated with the domain name used for the CloudFront distribution.

4. In the list of records, locate the CNAME record pointing to the CloudFront distribution.

5. Click on the record to select it.

6. Click on the "Edit" button above the record list.

7. In the "Value/Route traffic to" field, enter the S3 bucket endpoint as the value. You can find the S3 bucket endpoint by navigating to the S3 service, selecting the bucket used as the origin for the CloudFront distribution, and copying the bucket's endpoint URL.

8. After entering the S3 bucket endpoint, click on the "Save Record Set" button to save the changes.

9. Once the changes are saved, the CNAME record will be updated to point to the S3 bucket as the origin for the CloudFront distribution.

10. Verify the changes by accessing your website or application through the CloudFront distribution URL. The content should now be served from the S3 bucket.

By following these steps, you will successfully remediate the misconfiguration of the AWS CloudFront distribution CNAME record having no S3 origin using the AWS Management Console in Route 53.

#### Using CLI

To remediate the issue of an AWS CloudFront distribution CNAME record having no S3 origin using AWS CLI, you can follow these step-by-step instructions:

1. Install and configure the AWS CLI if you haven't already. You can refer to the AWS CLI documentation for instructions on installation and configuration.

2. Open your command-line interface (CLI) and ensure that you have the necessary permissions to make changes to AWS resources.

3. Identify the CloudFront distribution that needs to be remediated. You can use the following command to list all your CloudFront distributions:

   ```
   aws cloudfront list-distributions
   ```

   Note down the distribution ID of the affected CloudFront distribution.

4. Retrieve the current configuration of the CloudFront distribution using the following command:

   ```
   aws cloudfront get-distribution-config --id <distribution-id>
   ```

   Replace `<distribution-id>` with the actual distribution ID you noted down in the previous step.

5. The output of the previous command will provide a JSON representation of the distribution configuration. Look for the `"Origins"` section and identify the origin that is missing the S3 bucket.

6. To add an S3 origin to the CloudFront distribution, you need to update the distribution configuration. Create a JSON file with the updated configuration, including the missing S3 origin. For example:

   ```json
   {
     "DistributionConfig": {
       "Origins": {
         "Items": [
           {
             "Id": "S3-origin",
             "DomainName": "your-s3-bucket.s3.amazonaws.com",
             "S3OriginConfig": {
               "OriginAccessIdentity": ""
             }
           }
         ],
         "Quantity": 1
       },
       "Enabled": true,
       "Comment": "Your distribution comment",
       ...
     }
   }
   ```

   Replace `"your-s3-bucket"` with the name of your actual S3 bucket.

7. Save the JSON file with the updated configuration.

8. Update the CloudFront distribution configuration using the following command:

   ```
   aws cloudfront update-distribution --id <distribution-id> --distribution-config file://<path-to-json-file>
   ```

   Replace `<distribution-id>` with the actual distribution ID, and `<path-to-json-file>` with the path to the JSON file you created in the previous step.

9. Wait for the CloudFront distribution to be updated. You can monitor the progress by using the following command:

   ```
   aws cloudfront wait distribution-deployed --id <distribution-id>
   ```

   Replace `<distribution-id>` with the actual distribution ID.

10. Once the distribution is deployed, the CNAME record will be updated automatically with the S3 origin.

By following these steps, you should be able to remediate the AWS CloudFront distribution CNAME record misconfiguration by adding the missing S3 origin.

#### Using Python

To remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin using Python, follow these steps:

1. Import the required AWS SDK libraries:
```python
import boto3
```

2. Initialize the AWS Route53 client:
```python
route53_client = boto3.client('route53')
```

3. Get the hosted zone ID for your domain:
```python
response = route53_client.list_hosted_zones_by_name(
    DNSName='yourdomain.com'
)

hosted_zone_id = response['HostedZones'][0]['Id']
```

4. Retrieve the existing CNAME record:
```python
response = route53_client.list_resource_record_sets(
    HostedZoneId=hosted_zone_id,
    StartRecordName='yourdomain.com',
    StartRecordType='CNAME',
    MaxItems='1'
)

cname_record = response['ResourceRecordSets'][0]
```

5. Update the CNAME record to point to the CloudFront distribution:
```python
cname_record['ResourceRecords'][0]['Value'] = 'your-cloudfront-distribution-domain.com'

response = route53_client.change_resource_record_sets(
    HostedZoneId=hosted_zone_id,
    ChangeBatch={
        'Changes': [
            {
                'Action': 'UPSERT',
                'ResourceRecordSet': cname_record
            }
        ]
    }
)

print('CNAME record updated successfully.')
```

Make sure to replace `'yourdomain.com'` with your actual domain name and `'your-cloudfront-distribution-domain.com'` with the domain name of your CloudFront distribution.

By following these steps, you can remediate the misconfiguration of an AWS CloudFront distribution CNAME record having no S3 origin using Python and AWS Route53.



</Tab>
</Tabs>