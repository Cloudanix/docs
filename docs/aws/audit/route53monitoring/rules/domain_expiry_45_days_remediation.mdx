
### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Route 53 domain expiry in 45 days using the AWS Management Console, follow these steps:

1. **Enable Domain Auto-Renewal:**
   - Open the [Amazon Route 53 console](https://console.aws.amazon.com/route53/).
   - In the navigation pane, choose **Registered Domains**.
   - Select the domain that you want to auto-renew.
   - In the **Domain details** section, ensure that the **Auto Renew** option is enabled. If it is not, click **Enable Auto Renew**.

2. **Set Up Billing Alerts:**
   - Open the [AWS Billing and Cost Management Dashboard](https://console.aws.amazon.com/billing/home).
   - In the navigation pane, choose **Billing preferences**.
   - Under **Billing alerts**, select **Receive Billing Alerts**.
   - Set up an alert to notify you when your billing exceeds a certain threshold, ensuring you have funds available for domain renewal.

3. **Monitor Domain Expiry Notifications:**
   - Ensure that the email address associated with your AWS account is up-to-date and monitored regularly.
   - AWS sends domain renewal notifications to this email address. Make sure to act on these notifications promptly.

4. **Review Domain Expiry Dates Regularly:**
   - Periodically review the expiry dates of your registered domains.
   - In the Route 53 console, under **Registered Domains**, check the **Expiration Date** column to keep track of when each domain is set to expire.

By following these steps, you can help ensure that your domains do not expire unexpectedly.
</Accordion>

<Accordion title='Using CLI'>
To prevent Route 53 domain expiry in 45 days using AWS CLI, you can follow these steps:

1. **Enable Domain Auto-Renewal:**
   Ensure that the domain is set to auto-renew to prevent it from expiring. This can be done using the `update-domain-contact` command.

   ```sh
   aws route53domains update-domain-contact --domain-name example.com --auto-renew
   ```

2. **Set Up Billing Alerts:**
   Configure billing alerts to notify you when your AWS account reaches a certain threshold. This helps ensure you have sufficient funds to cover domain renewals.

   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "BillingAlarm" --metric-name "EstimatedCharges" --namespace "AWS/Billing" --statistic "Maximum" --period 21600 --threshold 100 --comparison-operator "GreaterThanOrEqualToThreshold" --dimensions Name=Currency,Value=USD --evaluation-periods 1 --alarm-actions arn:aws:sns:us-east-1:123456789012:YourSNSTopic
   ```

3. **Monitor Domain Expiry:**
   Regularly check the expiry date of your domains to ensure they are not close to expiring. You can list your domains and their expiry dates using the `list-domains` and `get-domain-detail` commands.

   ```sh
   aws route53domains list-domains
   aws route53domains get-domain-detail --domain-name example.com
   ```

4. **Set Up Notifications:**
   Configure notifications to alert you when a domain is nearing its expiry date. This can be done by integrating with Amazon SNS (Simple Notification Service).

   ```sh
   aws sns create-topic --name DomainExpiryNotifications
   aws sns subscribe --topic-arn arn:aws:sns:us-east-1:123456789012:DomainExpiryNotifications --protocol email --notification-endpoint your-email@example.com
   ```

By following these steps, you can effectively prevent your Route 53 domains from expiring unexpectedly.
</Accordion>

<Accordion title='Using Python'>
To prevent Route 53 domain expiry in 45 days using Python scripts, you can automate the monitoring and renewal process. Here are the steps to achieve this:

### Step 1: Set Up AWS SDK for Python (Boto3)
First, ensure you have Boto3 installed and configured with the necessary AWS credentials.

```bash
pip install boto3
```

### Step 2: Create a Python Script to Check Domain Expiry

Create a Python script to check the expiry date of your Route 53 domains. This script will list all domains and their expiry dates.

```python
import boto3
from datetime import datetime, timedelta

# Initialize a session using Amazon Route 53
client = boto3.client('route53domains')

# Function to check domain expiry
def check_domain_expiry():
    response = client.list_domains()
    domains = response['Domains']
    
    for domain in domains:
        domain_name = domain['DomainName']
        expiry_date = domain['Expiry']
        
        # Calculate the days until expiry
        days_until_expiry = (expiry_date - datetime.now().date()).days
        
        if days_until_expiry <= 45:
            print(f"Domain {domain_name} is expiring in {days_until_expiry} days.")
            # Here you can add logic to renew the domain or send a notification

if __name__ == "__main__":
    check_domain_expiry()
```

### Step 3: Automate Domain Renewal

Extend the script to automatically renew domains that are expiring within 45 days.

```python
import boto3
from datetime import datetime, timedelta

# Initialize a session using Amazon Route 53
client = boto3.client('route53domains')

# Function to check domain expiry and renew if necessary
def check_and_renew_domain():
    response = client.list_domains()
    domains = response['Domains']
    
    for domain in domains:
        domain_name = domain['DomainName']
        expiry_date = domain['Expiry']
        
        # Calculate the days until expiry
        days_until_expiry = (expiry_date - datetime.now().date()).days
        
        if days_until_expiry <= 45:
            print(f"Domain {domain_name} is expiring in {days_until_expiry} days. Renewing now.")
            renew_response = client.renew_domain(
                DomainName=domain_name,
                DurationInYears=1
            )
            print(f"Renewal status: {renew_response['OperationId']}")

if __name__ == "__main__":
    check_and_renew_domain()
```

### Step 4: Schedule the Script

Use a scheduling tool like cron (on Unix-based systems) or Task Scheduler (on Windows) to run the script periodically (e.g., daily).

#### Example for Unix-based systems (cron job):

1. Open the crontab editor:

    ```bash
    crontab -e
    ```

2. Add a cron job to run the script daily:

    ```bash
    0 0 * * * /usr/bin/python3 /path/to/your/script.py
    ```

This setup ensures that your domains are monitored and renewed automatically, preventing them from expiring within 45 days.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to your AWS Management Console.
2. Navigate to the Route 53 dashboard. You can do this by typing "Route 53" into the search bar at the top of the console and selecting it from the dropdown menu.
3. Once you're in the Route 53 dashboard, click on "Registered domains" in the navigation pane on the left side of the screen.
4. Here, you will see a list of all your registered domains. Check the "Expiration date" column for each domain. If a domain is set to expire in 45 days or less, it is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List hosted zones: The first step to check the domain expiry is to list all the hosted zones in your AWS account. You can do this by running the following command: `aws route53 list-hosted-zones`. This will return a list of all the hosted zones along with their details.

3. Get domain details: Once you have the list of hosted zones, you can get the details of a specific domain by running the following command: `aws route53domains get-domain-detail --domain-name yourdomain.com`. Replace 'yourdomain.com' with the actual domain name. This command will return all the details of the domain including the expiry date.

4. Check domain expiry: Now that you have the domain details, you can check the expiry date. The expiry date is returned in the 'Expiry' field of the domain details. You can write a simple script to compare this date with the current date and alert you if the domain is set to expire in less than 45 days.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the AWS SDK for Python (Boto3). You can install it using pip:

   ```
   pip install boto3
   ```

2. Configure AWS credentials: Before you can start writing Python scripts to interact with AWS services, you need to configure your AWS credentials. You can do this by creating a file at ~/.aws/credentials:

   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to list all the domains and their expiry dates:

   ```python
   import boto3
   from datetime import datetime, timedelta

   # Create a client for the AWS Route 53 service
   client = boto3.client('route53domains')

   # Get the list of domain names
   response = client.list_domains()

   # Iterate over the domains
   for domain in response['Domains']:
       # Get the expiry date of the domain
       expiry_date = domain['Expiry']

       # Calculate the number of days until the domain expires
       days_until_expiry = (expiry_date - datetime.now()).days

       # If the domain is expiring in less than 45 days, print a warning
       if days_until_expiry < 45:
           print(f"Domain {domain['DomainName']} is expiring in {days_until_expiry} days.")
   ```

4. Run the Python script: You can run the Python script from the command line using the python command:

   ```
   python check_expiry.py
   ```

   This will print a warning for each domain that is expiring in less than 45 days.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the Route 53 Domain Expiry in 45 days issue on AWS using the AWS console, follow the below steps:

1. Log in to the AWS Management Console and navigate to the Route 53 service.
2. Click on the Registered Domains option from the left-hand menu.
3. Select the domain name that is expiring in 45 days.
4. Click on the Renew Domain button.
5. Select the number of years you want to renew the domain for and click on the Add to cart button.
6. Review the order details and click on the Complete Purchase button.
7. Follow the on-screen instructions to complete the payment process.

Once the payment process is complete, the domain will be renewed for the selected number of years and the Route 53 Domain Expiry issue will be resolved. It is recommended to set up auto-renewal for the domain to avoid such issues in the future.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the Route 53 Domain Expiry In 45 Days issue for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to get a list of your Route 53 domains and their expiration dates:
```
aws route53domains list-domains
```

2. Identify the domain that is expiring within the next 45 days.

3. Renew the domain by running the following command:
```
aws route53domains renew-domain --domain-name <domain_name> --duration-in-years <number_of_years>
```
Replace `<domain_name>` with the name of the expiring domain and `<number_of_years>` with the number of years you want to renew the domain for.

4. Verify that the domain has been renewed by running the following command:
```
aws route53domains get-domain-detail --domain-name <domain_name>
```
Replace `<domain_name>` with the name of the renewed domain.

5. Check the new expiration date of the domain to ensure that it has been extended by the desired number of years.

By following these steps, you should be able to successfully remediate the Route 53 Domain Expiry In 45 Days issue for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the Route 53 Domain Expiry issue in AWS using Python, you can follow the below steps:

Step 1: Install the required Python libraries boto3 and datetime by running the following command in your terminal:

```
pip install boto3 datetime
```

Step 2: Create an AWS IAM user with programmatic access and Route 53 read-only access. Generate an access key and secret access key for the user.

Step 3: In your Python script, import the required libraries and set up the AWS credentials using the access key and secret access key generated in Step 2:

```python
import boto3
import datetime

# Set up AWS credentials
aws_access_key_id = 'YOUR_ACCESS_KEY_ID'
aws_secret_access_key = 'YOUR_SECRET_ACCESS_KEY'
client = boto3.client('route53', aws_access_key_id=aws_access_key_id, aws_secret_access_key=aws_secret_access_key)
```

Step 4: Use the `list_hosted_zones()` method to get a list of all the hosted zones in your AWS account:

```python
response = client.list_hosted_zones()
hosted_zones = response['HostedZones']
```

Step 5: Iterate through the hosted zones and use the `get_hosted_zone()` method to get the details of each hosted zone:

```python
for hosted_zone in hosted_zones:
    hosted_zone_id = hosted_zone['Id']
    hosted_zone_name = hosted_zone['Name']
    response = client.get_hosted_zone(Id=hosted_zone_id)
    hosted_zone_details = response['HostedZone']
```

Step 6: Check the `Expiration` field in the `hosted_zone_details` dictionary to see if the domain is expiring in the next 45 days:

```python
expiration_date = hosted_zone_details['Expiration']
expiration_date_obj = datetime.datetime.strptime(expiration_date, '%Y-%m-%dT%H:%M:%S.%fZ')
today = datetime.datetime.utcnow()
if (expiration_date_obj - today).days <= 45:
    print(f"The domain {hosted_zone_name} is expiring in {expiration_date_obj - today} days.")
```

Step 7: If the domain is expiring in the next 45 days, you can take appropriate action such as renewing the domain or transferring it to another registrar.

Note: You can schedule this Python script to run periodically using a cron job or a similar scheduling mechanism to ensure that you are notified of any expiring domains in a timely manner.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
