---
slug: config_delivery_failing
title: AWS Config Log File Deliverity Should Be Configured
sidebar_label: AWS Config Log File Deliverity Should Be Configured
---

### More Info:

Ensure that the log files (history files and snapshots) generated by AWS Config are delivered without any failures to designated S3 bucket in order to store logging data for auditing purposes.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the Route 53 dashboard.
2. In the navigation pane, select "Hosted zones". 
3. Select the hosted zone you want to check. 
4. In the "Record sets" section, look for a record set with the name "_Route53-Health-Check-Service" and type "NS". If this record set is not present, it indicates that AWS Config Log File Delivery is not configured for Route 53.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS CLI website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List hosted zones: Use the following command to list all the hosted zones in your AWS account. This will give you the IDs of all the hosted zones, which you will need in the next step.
   ```
   aws route53 list-hosted-zones
   ```
3. Get DNSSEC status: For each hosted zone ID from the previous step, run the following command to get the DNSSEC status. If DNSSEC is not configured, the command will return an error.
   ```
   aws route53 get-dnssec --hosted-zone-id <YourHostedZoneID>
   ```
4. Check AWS Config Log File Delivery: AWS Config is a service that enables you to assess, audit, and evaluate the configurations of your AWS resources. You can use the following command to check if AWS Config Log File Delivery is configured for Route53.
   ```
   aws configservice describe-delivery-channels
   ```
   If the output does not include a delivery channel for Route53, then AWS Config Log File Delivery is not configured for Route53.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Now, create a client for Route53 and AWS Config:

```python
route53_client = session.client('route53')
config_client = session.client('config')
```

4. Now, you can use the `list_hosted_zones()` function to get all the hosted zones in Route53 and then check if AWS Config is configured for each of them:

```python
hosted_zones = route53_client.list_hosted_zones()

for zone in hosted_zones['HostedZones']:
    zone_id = zone['Id']
    config_rules = config_client.describe_config_rules(ConfigRuleNames=[zone_id])
    if not config_rules['ConfigRules']:
        print(f"Config log file delivery is not configured for hosted zone: {zone_id}")
```

This script will print out the IDs of all the hosted zones in Route53 for which AWS Config log file delivery is not configured.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "AWS Config Log File Delivery Should Be Configured" in AWS, you can follow the below steps:

1. Open the AWS Management Console and navigate to the AWS Config service.
2. Click on the "Settings" button in the left-hand menu.
3. Scroll down to the "Resource Types to Record" section and click on the "Edit" button.
4. Check the box next to "AWS::S3::Bucket" to enable logging for S3 buckets.
5. Click on the "Save" button to save the changes.

This will enable AWS Config to log all changes made to S3 buckets in your AWS account. You can also configure logging for other resource types by checking the appropriate boxes in the "Resource Types to Record" section.

#### Using CLI

To remediate the misconfiguration of AWS Config Log File Delivery, please follow the below steps:

Step 1: Open the AWS CLI and run the following command to create an S3 bucket that will store the AWS Config logs:

```
aws s3 mb s3://<bucket-name> --region <region>
```

Note: Replace `<bucket-name>` with a unique name for your S3 bucket and `<region>` with the region where you want to create the bucket.

Step 2: Run the following command to create an IAM role that AWS Config will use to access the S3 bucket:

```
aws iam create-role --role-name AWSConfigServiceRole --assume-role-policy-document file://trust-policy.json
```

Note: Create a file named `trust-policy.json` with the following content:

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "",
      "Effect": "Allow",
      "Principal": {
        "Service": "config.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

Step 3: Run the following command to attach the required policy to the IAM role:

```
aws iam attach-role-policy --policy-arn arn:aws:iam::aws:policy/service-role/AWSConfigRole --role-name AWSConfigServiceRole
```

Step 4: Run the following command to enable AWS Config and specify the S3 bucket and IAM role:

```
aws configservice put-delivery-channel --delivery-channel '{"s3BucketName":"<bucket-name>","snsTopicARN":"","configSnapshotDeliveryProperties":{"deliveryFrequency":"Six_Hours"}}' --name default --s3-key-prefix logs/ --role-arn arn:aws:iam::<account-id>:role/AWSConfigServiceRole
```

Note: Replace `<bucket-name>` with the name of the S3 bucket you created in Step 1 and `<account-id>` with your AWS account ID.

Step 5: Verify that AWS Config is enabled and the S3 bucket and IAM role are configured correctly by running the following command:

```
aws configservice describe-delivery-channels
```

This should return a JSON object that includes the details of the delivery channel you just created.

By following the above steps, you can remediate the misconfiguration of AWS Config Log File Delivery.

#### Using Python

To remediate the AWS Config Log File Delivery misconfiguration using Python, you can follow these steps:

1. Import the necessary AWS SDK libraries in your Python script. For example, you can use the `boto3` library to interact with AWS services.

```python
import boto3
```

2. Create a `boto3` client for AWS Config service.

```python
config_client = boto3.client('config')
```

3. Check if the AWS Config Log File Delivery is enabled or not.

```python
response = config_client.describe_delivery_channels()
if len(response['DeliveryChannels']) == 0:
    print("AWS Config Log File Delivery is not enabled.")
else:
    print("AWS Config Log File Delivery is enabled.")
```

4. If AWS Config Log File Delivery is not enabled, create a new delivery channel.

```python
response = config_client.put_delivery_channel(
    DeliveryChannel={
        'name': 'my-delivery-channel', # replace with your own delivery channel name
        's3BucketName': 'my-s3-bucket', # replace with your own S3 bucket name
        'configSnapshotDeliveryProperties': {
            'deliveryFrequency': 'One_Hour' # or 'Three_Hours', 'Six_Hours', 'Twelve_Hours', 'TwentyFour_Hours'
        }
    }
)
print("AWS Config Log File Delivery is enabled now.")
```

Note: Replace `my-delivery-channel` and `my-s3-bucket` with your own delivery channel name and S3 bucket name respectively.

5. Verify that the AWS Config Log File Delivery is enabled.

```python
response = config_client.describe_delivery_channels()
if len(response['DeliveryChannels']) == 0:
    print("AWS Config Log File Delivery is not enabled.")
else:
    print("AWS Config Log File Delivery is enabled.")
```

6. Run the Python script to remediate the AWS Config Log File Delivery misconfiguration.

This should enable the AWS Config Log File Delivery and remediate the misconfiguration.

### Additional Reading:

- [https://docs.aws.amazon.com/config/latest/developerguide/security-logging-and-monitoring.html](https://docs.aws.amazon.com/config/latest/developerguide/security-logging-and-monitoring.html) 


</Tab>
</Tabs>