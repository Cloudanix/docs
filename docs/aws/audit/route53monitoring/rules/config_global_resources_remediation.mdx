### Triage and Remediation

<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS Config console. You can do this by typing "AWS Config" into the search bar and selecting it from the dropdown menu.
3. In the AWS Config dashboard, select "Rules" from the left-hand navigation pane.
4. In the Rules page, look for the rule named "route53-global-resource-record-sets". If this rule is present and enabled, AWS Config is checking for global resources in Route53. If the rule is not present or is disabled, AWS Config is not checking for global resources in Route53.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List AWS Config Rules: Once AWS CLI is set up, you can list all the AWS Config rules in your account by running the following command:
   ```
   aws configservice describe-config-rules
   ```
   This command will return a list of all the AWS Config rules in your account.

3. Check for Global Resources Rule: Look for a rule with the name "route53-global-resource-record-sets". This rule checks whether AWS Config includes global resources in Route53. If this rule is not present, it means that AWS Config is not configured to include global resources in Route53.

4. Check Rule Compliance: If the "route53-global-resource-record-sets" rule is present, you can check its compliance status by running the following command:
   ```
   aws configservice get-compliance-details-by-config-rule --config-rule-name route53-global-resource-record-sets
   ```
   This command will return the compliance status of the rule. If the status is "NON_COMPLIANT", it means that AWS Config is not including global resources in Route53.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Use the AWS Config service client to describe the configuration recorder:

```python
config = session.client('config')

response = config.describe_configuration_recorder_status(
    ConfigurationRecorderNames=[
        'default',
    ]
)

print(response)
```

4. Check the 'recordingGroup' field in the response. If 'includeGlobalResourceTypes' is set to False, then global resources are not included in AWS Config:

```python
if not response['ConfigurationRecordersStatus'][0]['recordingGroup']['includeGlobalResourceTypes']:
    print("AWS Config does not include global resources.")
else:
    print("AWS Config includes global resources.")
```

This script will print a message indicating whether or not AWS Config includes global resources. If it does not, then there is a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "AWS Config Should Include Global Resources" for AWS using the AWS console, follow these steps:

1. Sign in to the AWS Management Console.

2. Navigate to the AWS Config console at [AWS Config Console](https://console.aws.amazon.com/config/).

3. In the main navigation panel, under AWS Config, choose **Settings**.

4. Choose **Edit** to access the configuration settings available for AWS Config in the selected AWS region.

5. In the **General settings** section, ensure that **Record all resources supported in this region** option is selected, select the **Include global resources (e.g., AWS IAM resources)** checkbox, and choose **Save** to apply the changes. This will enable you to keep track of configuration changes made to global AWS resources such as IAM resources.

6. Change the AWS cloud region from the navigation bar and repeat the remediation process for other regions.

#

</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "AWS Config should include global resources" using the AWS CLI, follow these steps:

1. Run the following command to describe the role ARN of the IAM role set for the AWS Config recorder:

```bash
aws configservice describe-configuration-recorders \
    --region us-east-1 \
    --query 'ConfigurationRecorders[*].roleARN'
```

2. The command output should return the ARN of the requested IAM role:

```
[
	"arn:aws:iam::123456789012:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig"
]
```

3. Use the role ARN returned in the previous step to create a new configuration recorder for AWS Config to track configuration changes made to global AWS resources:

```bash
aws configservice put-configuration-recorder \
    --region us-east-1 \
    --configuration-recorder name=default,roleARN=arn:aws:iam::123456789012:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig \
    --recording-group allSupported=true,includeGlobalResourceTypes=true
```

4. If you need to enable AWS Config for other regions, change the AWS cloud region from the navigation bar and repeat the above steps.

</Accordion>

<Accordion title='Using Python'>
1. To remediate the misconfiguration "AWS Config Should Include Global Resources" using Python, you can use the AWS SDK for Python (Boto3) to create a Lambda function that enables AWS Config in all regions and ensures that global resources are included.

Here's an example Python script to remediate the policy.

```python
import boto3

# Create a Boto3 client for AWS Config
config = boto3.client('config')

# Get a list of all regions in the AWS account
ec2 = boto3.client('ec2')
regions = [region['RegionName'] for region in ec2.describe_regions()['Regions']]

# Enable AWS Config for all regions
for region in regions:
    # Describe the IAM role for AWS Config
    role_arn_response = config.describe_configuration_recorders()
    role_arn = role_arn_response['ConfigurationRecorders'][0]['roleARN']

    # Create configuration recorder
    config.put_configuration_recorder(
        ConfigurationRecorder={
            'name': 'default',
            'roleARN': role_arn,
            'recordingGroup': {
                'allSupported': True,
                'includeGlobalResourceTypes': True,
                'resourceTypes': []
            }
        }
    )
    print(f"Enabled AWS Config in region {region}")

    # Start the evaluation
    config.start_config_rules_evaluation(config_rule_names=['global-resources'])
```

2. Once you run this code, AWS Config will be enabled for all regions in your AWS account, and the misconfiguration "AWS Config Should Include Global Resources" will be remediated.

</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
