

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to AWS Management Console: First, you need to log in to your AWS Management Console. Make sure you have the necessary permissions to access Route53 and the domains you want to check.

2. Navigate to Route53: Once you are logged in, navigate to the Route53 service. You can do this by typing "Route53" into the search bar at the top of the console and selecting it from the dropdown menu.

3. Check Domain List: In the Route53 dashboard, click on "Hosted zones" in the left navigation pane. This will bring up a list of all the domains that are currently being managed by Route53 in your account.

4. Check NS Records: Click on the domain name you want to check. This will bring up a list of all the record sets for that domain. Look for the NS (Name Server) record set. If the NS record is pointing to a subdomain of the domain itself, it is considered vulnerable. This is because an attacker can potentially take over the subdomain and gain control of the NS records, which would allow them to redirect traffic intended for your domain to their own servers.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List Hosted Zones: Use the following command to list all the hosted zones in your AWS account. This will give you a list of all the domains that you have registered with Route53.
   ```
   aws route53 list-hosted-zones
   ```
   This command will return a list of all the hosted zones along with their ID, Name, and other details.

3. Get Hosted Zone details: Once you have the ID of the hosted zone that you want to check, you can use the following command to get the details of that hosted zone.
   ```
   aws route53 get-hosted-zone --id <Hosted Zone ID>
   ```
   This command will return the details of the hosted zone including the DelegationSet which contains the NS records for that domain.

4. Check NS Records: Now, you can check the NS records in the DelegationSet for any vulnerabilities. If the NS records are pointing to a domain that you do not control, then your subdomain is vulnerable. You can do this manually by checking the NS records in the DelegationSet or you can use a script to automate this process.

#### Using Python

1. Install the necessary Python libraries: Before you can start, you need to install the necessary Python libraries. You can do this by running the following command in your terminal:

```python
pip install boto3
```

2. Import the necessary Python libraries: After you have installed the necessary Python libraries, you need to import them into your Python script. You can do this by adding the following lines at the top of your script:

```python
import boto3
```

3. Create a session with AWS: Before you can interact with AWS, you need to create a session. You can do this by adding the following lines to your script:

```python
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

Replace 'YOUR_ACCESS_KEY' and 'YOUR_SECRET_KEY' with your actual AWS access key and secret key.

4. Check the NS records: Now you can check the NS records for your subdomain. You can do this by adding the following lines to your script:

```python
route53 = session.client('route53')
response = route53.list_resource_record_sets(
    HostedZoneId='YOUR_HOSTED_ZONE_ID',
    StartRecordName='YOUR_SUBDOMAIN',
    StartRecordType='NS',
    MaxItems='1'
)

for record_set in response['ResourceRecordSets']:
    if record_set['Type'] == 'NS':
        for record in record_set['ResourceRecords']:
            print(record['Value'])
```

Replace 'YOUR_HOSTED_ZONE_ID' with the ID of your hosted zone and 'YOUR_SUBDOMAIN' with the name of your subdomain. This script will print the NS records for your subdomain. If the NS records are vulnerable, you will need to take action to secure them.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the vulnerability of AWS Subdomain NS Records in AWS Route53 using the AWS console, follow these steps:

1. Log in to the AWS Management Console.
2. Open the Route53 service.
3. In the navigation pane, select "Hosted zones".
4. Choose the hosted zone that contains the vulnerable subdomain NS records.
5. Select the checkbox next to the vulnerable subdomain NS record(s) that you want to remediate.
6. Click on the "Delete record set" button at the top of the page.
7. Confirm the deletion by clicking on the "Delete" button in the pop-up window.
8. Repeat steps 5-7 for all the vulnerable subdomain NS records.
9. Once the vulnerable subdomain NS records are deleted, click on the "Create record set" button at the top of the page.
10. In the "Name" field, enter the name of the subdomain for which you want to create NS records.
11. Select "NS - Name Server" from the "Type" dropdown menu.
12. In the "Value" field, enter the name servers (NS records) provided by your DNS hosting provider.
13. Click on the "Create" button to create the new NS records.
14. Repeat steps 10-13 for each subdomain that requires NS records.
15. Once all the necessary NS records are created, verify that the subdomain NS records are no longer vulnerable by performing a vulnerability scan or using a DNS tool.

By following these steps, you will be able to remediate the vulnerability of AWS Subdomain NS Records in AWS Route53 using the AWS console.

#### Using CLI

To remediate the vulnerable NS records in AWS Route53 using AWS CLI, follow these steps:

1. Install and configure the AWS CLI on your local machine if you haven't already. Ensure that you have appropriate permissions to manage Route53 resources.

2. Verify the domain ownership in the AWS Route53 console. This step is crucial to ensure that you have the necessary permissions to make changes to the DNS records.

3. Open the AWS CLI on your local machine and run the following command to list all hosted zones in your AWS account:

   ```
   aws route53 list-hosted-zones
   ```

   Identify the hosted zone that contains the vulnerable NS records you want to remediate. Note down the `Id` of the hosted zone.

4. Run the following command to retrieve the existing NS records for the hosted zone:

   ```
   aws route53 list-resource-record-sets --hosted-zone-id <hosted-zone-id>
   ```

   Replace `<hosted-zone-id>` with the actual `Id` of the hosted zone obtained in the previous step.

5. Review the output and identify the NS records that need to be removed or updated. Note down the `Name` of each vulnerable NS record.

6. Run the following command to delete each vulnerable NS record:

   ```
   aws route53 change-resource-record-sets --hosted-zone-id <hosted-zone-id> --change-batch '{
     "Changes": [
       {
         "Action": "DELETE",
         "ResourceRecordSet": {
           "Name": "<vulnerable-ns-record-name>",
           "Type": "NS",
           "TTL": 300,
           "ResourceRecords": [
             {
               "Value": "<vulnerable-ns-record-value>"
             }
           ]
         }
       }
     ]
   }'
   ```

   Replace `<hosted-zone-id>` with the actual `Id` of the hosted zone, `<vulnerable-ns-record-name>` with the name of the vulnerable NS record, and `<vulnerable-ns-record-value>` with the value of the vulnerable NS record.

   Repeat this command for each vulnerable NS record identified in step 5.

7. After deleting the vulnerable NS records, you can optionally add or update the NS records with the correct values. Run the following command to add or update an NS record:

   ```
   aws route53 change-resource-record-sets --hosted-zone-id <hosted-zone-id> --change-batch '{
     "Changes": [
       {
         "Action": "UPSERT",
         "ResourceRecordSet": {
           "Name": "<ns-record-name>",
           "Type": "NS",
           "TTL": 300,
           "ResourceRecords": [
             {
               "Value": "<ns-record-value>"
             }
           ]
         }
       }
     ]
   }'
   ```

   Replace `<hosted-zone-id>` with the actual `Id` of the hosted zone, `<ns-record-name>` with the name of the NS record, and `<ns-record-value>` with the value of the NS record.

   Repeat this command for each NS record you want to add or update.

8. Verify the changes by running the command in step 4 again. Ensure that the vulnerable NS records are no longer present, and the correct NS records are added or updated.

By following these steps, you can remediate the vulnerable NS records in AWS Route53 using the AWS CLI.

#### Using Python

To remediate the vulnerability of vulnerable NS records in AWS Route53 using Python, follow these steps:

1. Install the required libraries:
   - Install the AWS SDK for Python (Boto3) using the command: `pip install boto3`

2. Set up AWS credentials:
   - Configure AWS CLI using the command: `aws configure`
   - Enter your AWS Access Key ID and Secret Access Key.
   - Set the default region name and output format.

3. Write a Python script to remediate the vulnerability:
   ```python
   import boto3

   def remediate_vulnerable_ns_records():
       # Create a Route53 client
       route53_client = boto3.client('route53')

       # List all hosted zones
       response = route53_client.list_hosted_zones()

       # Iterate through each hosted zone
       for hosted_zone in response['HostedZones']:
           hosted_zone_id = hosted_zone['Id']
           hosted_zone_name = hosted_zone['Name']

           # Get the NS records for the hosted zone
           ns_records = route53_client.list_resource_record_sets(
               HostedZoneId=hosted_zone_id,
               StartRecordType='NS',
               MaxItems='1'
           )

           # Check if NS records are vulnerable
           if ns_records['ResourceRecordSets'][0]['Name'] == hosted_zone_name and len(ns_records['ResourceRecordSets']) > 1:
               vulnerable_ns_record_set = ns_records['ResourceRecordSets'][0]

               # Delete the vulnerable NS record set
               route53_client.change_resource_record_sets(
                   HostedZoneId=hosted_zone_id,
                   ChangeBatch={
                       'Changes': [
                           {
                               'Action': 'DELETE',
                               'ResourceRecordSet': vulnerable_ns_record_set
                           }
                       ]
                   }
               )

               print(f"Vulnerable NS record set deleted for hosted zone: {hosted_zone_name}")

   # Run the function to remediate the vulnerability
   remediate_vulnerable_ns_records()
   ```

4. Save the script to a file, for example, `remediate_ns_records.py`.

5. Execute the Python script:
   - Open a terminal or command prompt.
   - Navigate to the directory where the script is saved.
   - Run the command: `python remediate_ns_records.py`

   The script will connect to AWS Route53, identify the vulnerable NS records, and delete them. It will print a message for each hosted zone where the vulnerability is remediated.

Note: Make sure you have appropriate permissions to access and modify Route53 resources in your AWS account.


</Tab>
</Tabs>