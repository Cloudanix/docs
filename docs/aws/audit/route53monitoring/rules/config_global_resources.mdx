---
slug: config_global_resources
title: AWS Config Should Include Global Resources
sidebar_label: AWS Config Should Include Global Resources
---

### More Info:

Ensure that AWS Config service is configured to include Global resources in order to have complete visibility over the configuration changes made within your AWS account. Global resources are not tied to a specific AWS region and can be used in all regions. Supported Global resource types are IAM users, groups, roles and customer managed policies.

### Risk Level

Medium

### Address

Security

### Compliance Standards

GDPR, APRA, MAS, NIST4

### Triage and Remediation

<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration where AWS Config should include global resources in Route 53 using the AWS Management Console, follow these steps:

1. **Navigate to AWS Config:**
   - Sign in to the AWS Management Console.
   - Open the AWS Config console at [https://console.aws.amazon.com/config/](https://console.aws.amazon.com/config/).

2. **Access Settings:**
   - In the AWS Config console, click on the "Settings" option in the left-hand navigation pane.

3. **Enable Global Resource Recording:**
   - In the Settings page, look for the section titled "Resource types to record."
   - Ensure that the checkbox for "Include global resources (e.g., AWS IAM resources, Amazon Route 53 resources)" is checked.

4. **Save Changes:**
   - After ensuring the checkbox is selected, click the "Save" button at the bottom of the page to apply the changes.

By following these steps, you ensure that AWS Config includes global resources such as Route 53 in its configuration recording.
</Accordion>

<Accordion title='Using CLI'>
To ensure that AWS Config includes global resources such as Route 53, you need to enable the recording of global resources in your AWS Config settings. Here are the steps to do this using the AWS CLI:

1. **Check Current Configuration**:
   First, check the current configuration to see if global resource recording is enabled.
   ```sh
   aws configservice describe-configuration-recorder-status
   ```

2. **Update Configuration Recorder**:
   If global resource recording is not enabled, you need to update the configuration recorder to include global resources.
   ```sh
   aws configservice put-configuration-recorder --configuration-recorder name=default,roleARN=arn:aws:iam::YOUR_ACCOUNT_ID:role/AWSConfigRole,recordingGroup={allSupported=true,includeGlobalResourceTypes=true}
   ```

3. **Start Configuration Recorder**:
   Ensure that the configuration recorder is started to begin recording the configuration changes.
   ```sh
   aws configservice start-configuration-recorder --configuration-recorder-name default
   ```

4. **Verify Configuration**:
   Finally, verify that the configuration recorder is now set to include global resources.
   ```sh
   aws configservice describe-configuration-recorder-status
   ```

Replace `YOUR_ACCOUNT_ID` with your actual AWS account ID and ensure that the IAM role `AWSConfigRole` has the necessary permissions to allow AWS Config to record configurations.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where AWS Config should include global resources in Route 53 using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to ensure that AWS Config includes global resources:

### Step 1: Install Boto3
Ensure you have Boto3 installed in your Python environment. You can install it using pip if you haven't already:
```bash
pip install boto3
```

### Step 2: Initialize Boto3 Client
Initialize the Boto3 client for AWS Config:
```python
import boto3

config_client = boto3.client('config')
```

### Step 3: Describe Configuration Recorder
Check the current configuration of the AWS Config recorder to see if it includes global resources:
```python
response = config_client.describe_configuration_recorders()
config_recorder = response['ConfigurationRecorders'][0]
```

### Step 4: Update Configuration Recorder to Include Global Resources
If the configuration recorder does not include global resources, update it to include them:
```python
if not config_recorder['recordingGroup']['includeGlobalResourceTypes']:
    config_recorder['recordingGroup']['includeGlobalResourceTypes'] = True
    config_client.put_configuration_recorder(
        ConfigurationRecorder=config_recorder
    )
    print("Updated configuration recorder to include global resources.")
else:
    print("Configuration recorder already includes global resources.")
```

### Full Script
Here is the complete script combining all the steps:
```python
import boto3

# Initialize Boto3 client for AWS Config
config_client = boto3.client('config')

# Describe the current configuration recorder
response = config_client.describe_configuration_recorders()
config_recorder = response['ConfigurationRecorders'][0]

# Check and update the configuration recorder to include global resources
if not config_recorder['recordingGroup']['includeGlobalResourceTypes']:
    config_recorder['recordingGroup']['includeGlobalResourceTypes'] = True
    config_client.put_configuration_recorder(
        ConfigurationRecorder=config_recorder
    )
    print("Updated configuration recorder to include global resources.")
else:
    print("Configuration recorder already includes global resources.")
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed.
2. **Initialize Boto3 Client**: Set up the AWS Config client.
3. **Describe Configuration Recorder**: Retrieve the current configuration recorder settings.
4. **Update Configuration Recorder**: Modify the configuration recorder to include global resources if it doesn't already.

This script ensures that AWS Config is set to include global resources, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS Config console. You can do this by typing "AWS Config" into the search bar and selecting it from the dropdown menu.
3. In the AWS Config dashboard, select "Rules" from the left-hand navigation pane.
4. In the Rules page, look for the rule named "route53-global-resource-record-sets". If this rule is present and enabled, AWS Config is checking for global resources in Route53. If the rule is not present or is disabled, AWS Config is not checking for global resources in Route53.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List AWS Config Rules: Once AWS CLI is set up, you can list all the AWS Config rules in your account by running the following command:
   ```
   aws configservice describe-config-rules
   ```
   This command will return a list of all the AWS Config rules in your account.

3. Check for Global Resources Rule: Look for a rule with the name "route53-global-resource-record-sets". This rule checks whether AWS Config includes global resources in Route53. If this rule is not present, it means that AWS Config is not configured to include global resources in Route53.

4. Check Rule Compliance: If the "route53-global-resource-record-sets" rule is present, you can check its compliance status by running the following command:
   ```
   aws configservice get-compliance-details-by-config-rule --config-rule-name route53-global-resource-record-sets
   ```
   This command will return the compliance status of the rule. If the status is "NON_COMPLIANT", it means that AWS Config is not including global resources in Route53.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Use the AWS Config service client to describe the configuration recorder:

```python
config = session.client('config')

response = config.describe_configuration_recorder_status(
    ConfigurationRecorderNames=[
        'default',
    ]
)

print(response)
```

4. Check the 'recordingGroup' field in the response. If 'includeGlobalResourceTypes' is set to False, then global resources are not included in AWS Config:

```python
if not response['ConfigurationRecordersStatus'][0]['recordingGroup']['includeGlobalResourceTypes']:
    print("AWS Config does not include global resources.")
else:
    print("AWS Config includes global resources.")
```

This script will print a message indicating whether or not AWS Config includes global resources. If it does not, then there is a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "AWS Config Should Include Global Resources" for AWS using the AWS console, follow these steps:

1. Sign in to the AWS Management Console.

2. Navigate to the AWS Config console at [AWS Config Console](https://console.aws.amazon.com/config/).

3. In the main navigation panel, under AWS Config, choose **Settings**.

4. Choose **Edit** to access the configuration settings available for AWS Config in the selected AWS region.

5. In the **General settings** section, ensure that **Record all resources supported in this region** option is selected, select the **Include global resources (e.g., AWS IAM resources)** checkbox, and choose **Save** to apply the changes. This will enable you to keep track of configuration changes made to global AWS resources such as IAM resources.

6. Change the AWS cloud region from the navigation bar and repeat the remediation process for other regions.

#

</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "AWS Config should include global resources" using the AWS CLI, follow these steps:

1. Run the following command to describe the role ARN of the IAM role set for the AWS Config recorder:

```bash
aws configservice describe-configuration-recorders \
    --region us-east-1 \
    --query 'ConfigurationRecorders[*].roleARN'
```

2. The command output should return the ARN of the requested IAM role:

```
[
	"arn:aws:iam::123456789012:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig"
]
```

3. Use the role ARN returned in the previous step to create a new configuration recorder for AWS Config to track configuration changes made to global AWS resources:

```bash
aws configservice put-configuration-recorder \
    --region us-east-1 \
    --configuration-recorder name=default,roleARN=arn:aws:iam::123456789012:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig \
    --recording-group allSupported=true,includeGlobalResourceTypes=true
```

4. If you need to enable AWS Config for other regions, change the AWS cloud region from the navigation bar and repeat the above steps.

</Accordion>

<Accordion title='Using Python'>
1. To remediate the misconfiguration "AWS Config Should Include Global Resources" using Python, you can use the AWS SDK for Python (Boto3) to create a Lambda function that enables AWS Config in all regions and ensures that global resources are included.

Here's an example Python script to remediate the policy.

```python
import boto3

# Create a Boto3 client for AWS Config
config = boto3.client('config')

# Get a list of all regions in the AWS account
ec2 = boto3.client('ec2')
regions = [region['RegionName'] for region in ec2.describe_regions()['Regions']]

# Enable AWS Config for all regions
for region in regions:
    # Describe the IAM role for AWS Config
    role_arn_response = config.describe_configuration_recorders()
    role_arn = role_arn_response['ConfigurationRecorders'][0]['roleARN']

    # Create configuration recorder
    config.put_configuration_recorder(
        ConfigurationRecorder={
            'name': 'default',
            'roleARN': role_arn,
            'recordingGroup': {
                'allSupported': True,
                'includeGlobalResourceTypes': True,
                'resourceTypes': []
            }
        }
    )
    print(f"Enabled AWS Config in region {region}")

    # Start the evaluation
    config.start_config_rules_evaluation(config_rule_names=['global-resources'])
```

2. Once you run this code, AWS Config will be enabled for all regions in your AWS account, and the misconfiguration "AWS Config Should Include Global Resources" will be remediated.

</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/config/latest/developerguide/select-resources.html](https://docs.aws.amazon.com/config/latest/developerguide/select-resources.html)
- [https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/Config/global-resources.html](https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/Config/global-resources.html)
