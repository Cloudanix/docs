---
slug: config_referencing_missing_s3_bucket
title: AWS Config Should Have S3 Bucket Configured
sidebar_label: AWS Config Should Have S3 Bucket Configured
---

### More Info:

Ensure that Amazon Config service is referencing an active S3 bucket in order to save configuration information (history files and snapshots) for auditing purposes.

### Risk Level

High

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Route 53 dashboard.
2. In the Route 53 dashboard, select "Hosted zones" from the left-hand side menu.
3. Select the domain name for which you want to check the S3 bucket configuration.
4. In the "Records" section, look for the record that should be pointing to the S3 bucket. The value of this record should be the endpoint of the S3 bucket. If it's not, then there is a misconfiguration.
5. To confirm, navigate to the S3 service in the AWS console, select the bucket and under the "Properties" tab, check the "Static website hosting" section. The endpoint listed here should match the value in the Route 53 record. If it doesn't, then the S3 bucket is not correctly configured in Route 53.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the S3 buckets in your AWS account. You can do this by using the AWS CLI command `aws s3api list-buckets --query "Buckets[].Name"`. This command will return a list of all the S3 bucket names in your account.

2. Next, you need to list all the hosted zones in your Route53. You can do this by using the AWS CLI command `aws route53 list-hosted-zones`. This command will return a list of all the hosted zones in your Route53.

3. For each hosted zone, list all the record sets. You can do this by using the AWS CLI command `aws route53 list-resource-record-sets --hosted-zone-id <HostedZoneId>`. Replace `<HostedZoneId>` with the ID of the hosted zone. This command will return a list of all the record sets in the hosted zone.

4. Finally, check if any of the record sets in the hosted zones point to any of the S3 buckets. You can do this by checking if the `ResourceRecords` or `AliasTarget` of the record sets contain the S3 bucket name or the S3 bucket website endpoint. If none of the record sets point to the S3 bucket, then AWS Config does not have the S3 bucket configured in Route53.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) in your environment. This will allow you to interact with AWS services including S3 and Route53.

```python
pip install boto3
```

2. Use the Boto3 to list all the S3 buckets and Route53 hosted zones. 

```python
import boto3

s3 = boto3.client('s3')
route53 = boto3.client('route53')

# List all S3 buckets
buckets = s3.list_buckets()
bucket_names = [bucket['Name'] for bucket in buckets['Buckets']]

# List all Route53 hosted zones
hosted_zones = route53.list_hosted_zones()
hosted_zone_names = [zone['Name'] for zone in hosted_zones['HostedZones']]
```

3. Check if the S3 bucket is configured in Route53 by checking if the bucket name is in the list of hosted zone names.

```python
for bucket_name in bucket_names:
    if bucket_name not in hosted_zone_names:
        print(f"S3 bucket {bucket_name} is not configured in Route53")
```

4. If the bucket name is not in the list of hosted zone names, then it is not configured in Route53. This script will print out the names of all S3 buckets that are not configured in Route53.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of AWS Config not having S3 bucket configured, please follow the below steps:

1. Login to your AWS console.
2. Navigate to the AWS Config service.
3. Click on the "Settings" button in the left navigation pane.
4. Scroll down to the "Amazon S3 Bucket" section and click on the "Edit" button.
5. Select the S3 bucket that you want to use for storing AWS Config data.
6. If you do not have an S3 bucket, create a new one by clicking on the "Create a new S3 bucket" button.
7. Enter a unique name for the bucket and select the region where you want to create it.
8. Click on the "Create bucket" button to create the S3 bucket.
9. After selecting the S3 bucket, click on the "Save" button to save the changes.

Once you have completed these steps, AWS Config will start storing configuration data in the specified S3 bucket. This will remediate the misconfiguration of AWS Config not having S3 bucket configured.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate this misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. First, you need to install and configure the AWS CLI on your local machine.

2. Once the AWS CLI is installed, you need to run the following command to enable AWS Config in your AWS account:

```
aws configservice put-configuration-recorder --configuration-recorder name=default --recording-group allSupported=true --recording-group includeGlobalResourceTypes=true
```

3. After enabling AWS Config, you need to create an S3 bucket to store the AWS Config snapshots. You can use the following command to create an S3 bucket:

```
aws s3api create-bucket --bucket <bucket-name> --region <region-name>
```

Note: Replace `<bucket-name>` and `<region-name>` with your desired values.

4. Once the S3 bucket is created, you need to configure AWS Config to use this bucket. You can use the following command to configure AWS Config:

```
aws configservice put-delivery-channel --delivery-channel '{"name":"default","s3BucketName":"<bucket-name>","s3KeyPrefix":"AWSConfig","snsTopicARN":""}'
```

Note: Replace `<bucket-name>` with the name of the S3 bucket you created in step 3.

5. Finally, you need to start the AWS Config recorder by running the following command:

```
aws configservice start-configuration-recorder --configuration-recorder-name default
```

After following these steps, AWS Config will be properly configured to monitor and record changes to your AWS resources.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of AWS Config not having S3 bucket configured, you can follow these steps using Python:

1. Create an S3 bucket in the desired region where you want to store the AWS Config data. You can use the following Python code to create an S3 bucket:

```python
import boto3

s3 = boto3.client('s3')
response = s3.create_bucket(Bucket='my-aws-config-bucket', CreateBucketConfiguration={'LocationConstraint': 'us-east-1'})
```

2. Once the S3 bucket is created, you can configure AWS Config to use this S3 bucket as the delivery channel for the configuration data. You can use the following Python code to configure AWS Config:

```python
import boto3

config = boto3.client('config')

response = config.put_delivery_channel(
    DeliveryChannel={
        'name': 'my-aws-config-delivery-channel',
        's3BucketName': 'my-aws-config-bucket',
        'configSnapshotDeliveryProperties': {
            'deliveryFrequency': 'Six_Hours'
        }
    }
)
```

3. Verify that the AWS Config is properly configured by checking the AWS Config dashboard. You should see the S3 bucket as the delivery channel for the configuration data.

With these steps, you have successfully remediated the misconfiguration of AWS Config not having S3 bucket configured.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/config/latest/developerguide/s3-bucket-policy.html](https://docs.aws.amazon.com/config/latest/developerguide/s3-bucket-policy.html) 

