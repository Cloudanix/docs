---
slug: route53_query_logging_enabled
title: Route 53 Query Logging Should Be Enabled
sidebar_label: Route 53 Query Logging Should Be Enabled
---

### More Info:

Route 53 query logging should be enabled

### Risk Level

Low

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

CBP,SEBI,GDPR,HIPAA,ISO27001



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Route 53 console at https://console.aws.amazon.com/route53/.

2. In the navigation pane, choose "Hosted zones".

3. In the list of hosted zones, choose the name of the hosted zone that you want to check.

4. In the right pane, under "Hosted Zone Details", check if "Query logging" is enabled. If it's not enabled, it means Route 53 Query Logging is not enabled for this hosted zone.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to execute the commands.

2. Once AWS CLI is installed and configured, you can use the following command to list all the hosted zones in Route 53:

   ```
   aws route53 list-hosted-zones
   ```

   This command will return a list of all the hosted zones in your AWS account.

3. For each hosted zone, you can check if query logging is enabled by using the following command:

   ```
   aws route53 get-query-logging-config --id <HostedZoneId>
   ```

   Replace `<HostedZoneId>` with the ID of the hosted zone you want to check. If query logging is enabled, this command will return the logging configuration for the hosted zone. If it's not enabled, the command will return an error.

4. To automate the process, you can use a Python script that uses the boto3 library to interact with AWS. The script would list all the hosted zones, check the query logging configuration for each one, and print out the ones where it's not enabled. Here's a basic example:

   ```python
   import boto3

   client = boto3.client('route53')

   response = client.list_hosted_zones()

   for zone in response['HostedZones']:
       try:
           logging_config = client.get_query_logging_config(Id=zone['Id'])
           print(f"Query logging is enabled for {zone['Name']}")
       except:
           print(f"Query logging is NOT enabled for {zone['Name']}")
   ```
   
   This script will print out the names of all the hosted zones and whether query logging is enabled for each one.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Create a Route53 client and list all the hosted zones:

```python
route53_client = session.client('route53')
hosted_zones = route53_client.list_hosted_zones()
```

4. For each hosted zone, check if query logging is enabled:

```python/python
for zone in hosted_zones['HostedZones']:
    logging_status = route53_client.get_query_logging_config(
        Id=zone['Id']
    )
    if 'QueryLoggingConfig' not in logging_status:
        print(f"Query logging is not enabled for hosted zone: {zone['Name']}")
```

This script will print out the names of all hosted zones where query logging is not enabled. If no output is produced, it means that query logging is enabled for all hosted zones.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Route 53 Query Logging not being enabled in AWS, follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to Route 53**: Click on the 'Services' dropdown menu at the top of the console, then select 'Route 53' under the 'Networking & Content Delivery' section.

3. **Enable Query Logging**: In the Route 53 console, click on 'Query logging' in the left-hand navigation pane.

4. **Create a Query Logging Configuration**: Click on the 'Create query logging configuration' button.

5. **Configure Query Logging**: 
   - **Log group**: Select an existing CloudWatch Logs log group or create a new one where the query logs will be stored.
   - **Log group role**: Choose an IAM role that grants Route 53 permission to write logs to the selected log group.
   - **Destination**: Choose whether you want to log queries for all hosted zones or specific hosted zones.
   - **Filter**: You can optionally add a filter to log only specific queries based on criteria like domain name, query type, etc.
   - **Enable query logging**: Check the box to enable query logging.

6. **Review and Create**: Review the configuration settings to ensure they are correct, then click on the 'Create' button to enable query logging.

7. **Verify Configuration**: Once the query logging configuration is created, you can verify that query logging is enabled by checking the status in the Route 53 console.

By following these steps, you can remediate the misconfiguration of Route 53 Query Logging not being enabled in AWS Route 53 using the AWS Management Console.

#### Using CLI

To enable Route 53 query logging for AWS Route 53 using AWS CLI, follow these steps:

1. **Enable Query Logging**: Use the following AWS CLI command to enable query logging for your Route 53 hosted zone. Replace `HOSTED_ZONE_ID` with the ID of your hosted zone.

```bash
aws route53 create-query-logging-config --hosted-zone-id HOSTED_ZONE_ID --cloud-watch-logs-log-group /aws/route53/QUERY_LOGS
```

2. **Verify Configuration**: To verify that query logging has been enabled successfully, you can describe the query logging configuration using the following AWS CLI command:

```bash
aws route53 list-query-logging-configs --hosted-zone-id HOSTED_ZONE_ID
```

3. **Review Query Logs**: Once query logging is enabled, you can review the query logs in the CloudWatch Logs group `/aws/route53/QUERY_LOGS`.

By following these steps, you can remediate the misconfiguration of enabling Route 53 query logging for AWS Route 53 using AWS CLI.

#### Using Python

To remediate the misconfiguration of Route 53 Query Logging not being enabled in AWS using Python, you can use the AWS SDK for Python (Boto3) to enable query logging. Here are the step-by-step instructions to remediate this issue:

1. Install Boto3:
   If you haven't already installed Boto3, you can install it using pip:
   ```
   pip install boto3
   ```

2. Configure AWS Credentials:
   Make sure you have configured your AWS credentials either by setting environment variables or using the AWS CLI `aws configure` command.

3. Write Python script:
   Create a Python script with the following code to enable query logging for Route 53:

   ```python
   import boto3

   def enable_query_logging():
       client = boto3.client('route53')

       hosted_zones = client.list_hosted_zones()['HostedZones']
       for zone in hosted_zones:
           hosted_zone_id = zone['Id'].split('/')[-1]
           response = client.get_hosted_zone(Id=hosted_zone_id)
           if response['HostedZone']['QueryLoggingConfig']['CloudWatchLogsLogGroupArn'] == '':
               client.create_query_logging_config(
                   HostedZoneId=hosted_zone_id,
                   CloudWatchLogsLogGroupArn='YOUR_CLOUDWATCH_LOG_GROUP_ARN'
               )
               print(f"Query logging enabled for hosted zone {hosted_zone_id}")

   if __name__ == '__main__':
       enable_query_logging()
   ```

   Replace `'YOUR_CLOUDWATCH_LOG_GROUP_ARN'` with the ARN of the CloudWatch Logs log group where you want to store the query logs.

4. Run the Python script:
   Execute the Python script to enable query logging for all hosted zones in your AWS account:
   ```
   python enable_query_logging.py
   ```

5. Verify the configuration:
   After running the script, verify that query logging has been enabled for all hosted zones by checking the Route 53 console or using the Boto3 SDK to confirm the configuration.

By following these steps and running the Python script, you can remediate the misconfiguration of Route 53 Query Logging not being enabled in AWS.



</Tab>
</Tabs>