
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to your AWS Management Console.
2. Navigate to the Route 53 dashboard. You can do this by typing "Route 53" into the search bar at the top of the console and selecting it from the dropdown menu.
3. Once you're in the Route 53 dashboard, click on "Registered domains" in the left-hand menu. This will bring up a list of all the domains you have registered with Route 53.
4. Check the "Expiration date" column for each domain. If a domain is set to expire in the next 7 days, it will be listed here.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the hosted zones: Use the following AWS CLI command to list all the hosted zones in your AWS account:

   ```
   aws route53 list-hosted-zones
   ```
   This command will return a list of all the hosted zones along with their details.

3. List all the domain names: For each hosted zone, use the following AWS CLI command to list all the domain names:

   ```
   aws route53domains list-domains
   ```
   This command will return a list of all the domain names along with their details.

4. Check the expiry date: For each domain name, check the Expiry date. If the Expiry date is within the next 7 days, then the domain is about to expire. You can do this by parsing the output of the previous command using a script. Here is a simple Python script that does this:

   ```python
   import json
   import datetime

   # Load the output of the 'aws route53domains list-domains' command
   with open('domains.json') as f:
       domains = json.load(f)

   # Check each domain
   for domain in domains['Domains']:
       # Parse the expiry date
       expiry_date = datetime.datetime.strptime(domain['Expiry'], '%Y-%m-%dT%H:%M:%S.%fZ')
       # Check if the domain is about to expire
       if (expiry_date - datetime.datetime.now()).days <= 7:
           print(f"The domain {domain['DomainName']} is about to expire")
   ```
   Replace 'domains.json' with the actual path to the file containing the output of the 'aws route53domains list-domains' command.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. At the very least, the contents of the file should be:

   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check the domain expiry date: Here is a simple script that uses Boto3 to interact with Route 53 and check the domain expiry date.

   ```python
   import boto3
   from datetime import datetime, timedelta

   # Create a client
   route53domains = boto3.client('route53domains')

   # Get a list of all domains
   domains = route53domains.list_domains()

   # Check each domain
   for domain in domains['Domains']:
       # Get the domain info
       info = route53domains.get_domain_detail(DomainName=domain['DomainName'])
       # Get the expiry date
       expiry = info['Expiry']
       # Check if the domain expires in less than 7 days
       if expiry - datetime.now() < timedelta(days=7):
           print(f"The domain {domain['DomainName']} expires in less than 7 days!")
   ```

4. Run the script: You can run the script using the Python interpreter. If the script prints out any domain names, those domains are set to expire in less than 7 days. If no domain names are printed, none of your domains are set to expire in the next week.

   ```
   python check_expiry.py
   ```
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the Route 53 Domain Expiry in 7 Days issue in AWS using AWS console, follow the below steps:

1. Log in to the AWS Management Console.
2. Navigate to the Route 53 service.
3. Click on the Registered Domains option in the left-hand menu.
4. Select the domain that has an expiry date in 7 days.
5. Click on the Renew button.
6. Follow the on-screen instructions to complete the renewal process.
7. Once the renewal is complete, verify that the expiry date has been extended to a later date.

Note: It is recommended to set up auto-renewal for your domain to avoid such issues in the future.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the Route 53 Domain Expiry in 7 days issue in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Check the expiration date of the domain by running the following command:

```
aws route53domains get-domain-detail --domain-name <your-domain-name>
```

3. If the domain is set to expire in 7 days or less, you need to renew it. Run the following command to renew the domain:

```
aws route53domains renew-domain --domain-name <your-domain-name> --duration-in-years <number-of-years-to-renew>
```

Note: You can specify the number of years you want to renew the domain for by replacing `<number-of-years-to-renew>` with the desired value.

4. After running the renew command, you will receive a confirmation message with the details of the renewal. Verify the details and confirm the renewal.

5. Once the renewal is confirmed, the domain will be renewed for the specified number of years and the expiration date will be updated.

6. Verify that the domain has been successfully renewed by running the `get-domain-detail` command again.

7. You have successfully remediated the Route 53 Domain Expiry in 7 Days issue.
</Accordion>

<Accordion title='Using Python'>
To remediate the Route 53 Domain Expiry in 7 days issue in AWS using Python, you can follow the below steps:

1. Install the `boto3` library using the following command:

```
pip install boto3
```

2. Create an AWS IAM user with Route53 read-only access and generate the access key and secret key.

3. Create a Python script with the following code:

```
import boto3
from datetime import datetime, timedelta

# Set the AWS access key and secret key
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

# Create a Route53 client
client = boto3.client('route53', aws_access_key_id=access_key, aws_secret_access_key=secret_key)

# Get all the hosted zones
response = client.list_hosted_zones()

# Loop through each hosted zone
for zone in response['HostedZones']:
    zone_id = zone['Id']
    zone_name = zone['Name']

    # Get the details of the hosted zone
    zone_details = client.get_hosted_zone(Id=zone_id)

    # Get the expiration date of the domain
    domain_expiration_date = zone_details['DelegationSet']['NameServers'][0].split('.')[0]

    # Calculate the number of days left for the domain to expire
    days_left = (datetime.strptime(domain_expiration_date, '%Y%m%d') - datetime.now()).days

    # If the domain is expiring in 7 days or less, update the domain
    if days_left <= 7:
        # Update the domain registration
        response = client.update_domain_registration(
            DomainName=zone_name
        )

        # Print the status of the update
        print(f"Domain registration for {zone_name} has been updated. Status: {response['OperationStatus']}")
```

4. Replace the `YOUR_ACCESS_KEY` and `YOUR_SECRET_KEY` placeholders with the actual access key and secret key.

5. Run the script using the following command:

```
python remediate_route53_expiry.py
```

This script will update the domain registration for all the hosted zones that are expiring in 7 days or less and print the status of the update.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
