---
slug: mq_automatic_minor_version_upgrade_enabled
title: MQ Has Automatic Minor Version Upgrades.
sidebar_label: MQ Has Automatic Minor Version Upgrades.
---

### More Info:

This rule checks if automatic minor version upgrades are enabled for Amazon MQ brokers. The rule is NON_COMPLIANT if the 'AutoMinorVersionUpgrade' field is not enabled for an Amazon MQ broker.

### Risk Level

Low

### Address

Configuration

### Compliance Standards

CBP,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of "MQ Has Automatic Minor Version Upgrades" in AWS using the AWS Management Console, follow these steps:

1. **Navigate to Amazon MQ Console:**
   - Sign in to the AWS Management Console.
   - Open the Amazon MQ console by searching for "Amazon MQ" in the services search bar.

2. **Select the Broker:**
   - In the Amazon MQ console, select the broker for which you want to configure the settings.
   - Click on the broker name to open its details page.

3. **Edit Broker Configuration:**
   - On the broker details page, look for the "Configuration" section.
   - Click on the "Edit" button to modify the broker configuration settings.

4. **Disable Automatic Minor Version Upgrades:**
   - In the configuration settings, locate the option for "Automatic Minor Version Upgrades."
   - Uncheck or disable this option to prevent automatic minor version upgrades.
   - Save the changes by clicking the "Save" or "Apply" button.

By following these steps, you can ensure that automatic minor version upgrades are disabled for your Amazon MQ broker, thereby preventing potential misconfigurations.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of "MQ Has Automatic Minor Version Upgrades" in AWS using the AWS CLI, you can follow these steps:

1. **Check Current Configuration:**
   First, you need to check the current configuration of your Amazon MQ broker to see if automatic minor version upgrades are enabled.

   ```sh
   aws mq describe-broker --broker-id <your-broker-id>
   ```

2. **Modify Broker Configuration:**
   If automatic minor version upgrades are enabled, you can modify the broker configuration to disable it. Create a JSON file (e.g., `broker-config.json`) with the desired configuration. Set `AutoMinorVersionUpgrade` to `false`.

   ```json
   {
     "AutoMinorVersionUpgrade": false
   }
   ```

3. **Apply the Configuration:**
   Use the `update-broker` command to apply the new configuration to your broker.

   ```sh
   aws mq update-broker --broker-id <your-broker-id> --configuration file://broker-config.json
   ```

4. **Verify the Changes:**
   Finally, verify that the changes have been applied correctly by describing the broker again.

   ```sh
   aws mq describe-broker --broker-id <your-broker-id>
   ```

By following these steps, you can ensure that automatic minor version upgrades are disabled for your Amazon MQ broker using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of "MQ Has Automatic Minor Version Upgrades" in Security Groups using Python scripts, you can follow these steps:

### 1. **Set Up AWS SDK (Boto3)**
First, ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip if you haven't already:

```bash
pip install boto3
```

### 2. **Create a Python Script to Check and Disable Automatic Minor Version Upgrades**

Here's a Python script that checks and disables automatic minor version upgrades for Amazon MQ:

```python
import boto3

# Initialize a session using Amazon MQ
client = boto3.client('mq')

def disable_automatic_minor_version_upgrades(broker_id):
    try:
        # Describe the broker to get its current configuration
        response = client.describe_broker(BrokerId=broker_id)
        
        # Check if automatic minor version upgrades are enabled
        if response['AutoMinorVersionUpgrade']:
            print(f"Disabling automatic minor version upgrades for broker: {broker_id}")
            
            # Update the broker to disable automatic minor version upgrades
            client.update_broker(
                BrokerId=broker_id,
                AutoMinorVersionUpgrade=False
            )
            print(f"Automatic minor version upgrades disabled for broker: {broker_id}")
        else:
            print(f"Automatic minor version upgrades already disabled for broker: {broker_id}")
    except Exception as e:
        print(f"Error disabling automatic minor version upgrades for broker {broker_id}: {e}")

# List all brokers and disable automatic minor version upgrades for each
def main():
    try:
        brokers = client.list_brokers()
        for broker in brokers['BrokerSummaries']:
            disable_automatic_minor_version_upgrades(broker['BrokerId'])
    except Exception as e:
        print(f"Error listing brokers: {e}")

if __name__ == "__main__":
    main()
```

### 3. **Run the Script**
Execute the script to ensure that automatic minor version upgrades are disabled for all your Amazon MQ brokers.

```bash
python disable_mq_auto_minor_version_upgrade.py
```

### 4. **Automate the Script Execution**
To ensure continuous compliance, you can set up a scheduled job (e.g., using AWS Lambda with CloudWatch Events) to run this script periodically.

### Summary
1. **Install Boto3**: Ensure you have the AWS SDK for Python installed.
2. **Create the Script**: Write a Python script to check and disable automatic minor version upgrades for Amazon MQ brokers.
3. **Run the Script**: Execute the script to apply the changes.
4. **Automate**: Set up a scheduled job to run the script periodically for continuous compliance.

This approach ensures that your Amazon MQ brokers do not have automatic minor version upgrades enabled, thereby preventing potential misconfigurations.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon MQ console at https://console.aws.amazon.com/amazon-mq/.

2. In the navigation pane, choose "Broker" to view the list of your brokers.

3. Select the broker that you want to check for automatic minor version upgrades.

4. In the details pane, under the "Configuration" section, look for the "Auto minor version upgrade" setting. If it's set to "Yes", then automatic minor version upgrades are enabled. If it's set to "No", then they are not enabled. 

5. Repeat the process for all the brokers in your AWS environment to ensure they all have the correct configuration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Amazon MQ Brokers: Use the following AWS CLI command to list all the Amazon MQ brokers in your account.

   ```
   aws mq list-brokers
   ```

   This command will return a list of all the Amazon MQ brokers in your account, along with their details.

3. Describe Broker: For each broker listed in the previous step, use the following AWS CLI command to get more details about the broker, including whether it has automatic minor version upgrades enabled.

   ```
   aws mq describe-broker --broker-id <Broker-ID>
   ```

   Replace `<Broker-ID>` with the ID of the broker you want to check. This command will return a JSON object with details about the broker.

4. Check Automatic Minor Version Upgrades: In the JSON object returned in the previous step, look for the `AutoMinorVersionUpgrade` field. If this field is set to `true`, then the broker has automatic minor version upgrades enabled. If it is set to `false`, then the broker does not have automatic minor version upgrades enabled.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, you need to install the necessary Python libraries. You can use pip, a package installer for Python, to install the boto3 library. Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using the following command:

```python
pip install boto3
```

2. Configure AWS Credentials: You need to configure your AWS credentials. You can configure credentials by using the AWS CLI or by directly placing them in the AWS credentials file. The default location for the file is `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the default profile, you can use the following format:

```python
[default]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
```

3. Write a Python script to check for MQ Automatic Minor Version Upgrades: You can use the boto3 library to interact with AWS services. Here is a simple script that checks if MQ has automatic minor version upgrades enabled:

```python
import boto3

def check_mq_minor_version_upgrade():
    client = boto3.client('mq')
    response = client.list_brokers()
    for broker in response['BrokerSummaries']:
        broker_response = client.describe_broker(BrokerId=broker['BrokerId'])
        if not broker_response['AutoMinorVersionUpgrade']:
            print(f"MQ Broker {broker['BrokerId']} does not have automatic minor version upgrades enabled.")

check_mq_minor_version_upgrade()
```

4. Run the Python script: You can run the Python script using any Python environment. If the script is saved in a file named `check_mq.py`, you can run it with the following command:

```python
python check_mq.py
```

This script will print out the Broker IDs of all MQ Brokers that do not have automatic minor version upgrades enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of having MQ (Message Queue) with automatic minor version upgrades enabled for AWS Security Groups using the AWS Management Console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in to your account.

2. **Navigate to Amazon MQ**: Click on the "Services" dropdown menu at the top left corner of the console, then select "Amazon MQ" under the "Messaging" section.

3. **Select the Amazon MQ Instance**: From the Amazon MQ dashboard, select the Amazon MQ instance for which you want to disable automatic minor version upgrades.

4. **Modify Configuration**: In the Amazon MQ console, navigate to the "Configuration" tab for the selected Amazon MQ instance.

5. **Edit the Configuration**: Click on the "Edit" button to modify the configuration settings of the Amazon MQ instance.

6. **Disable Automatic Minor Version Upgrades**: Scroll down to the "Maintenance" section of the configuration settings. Look for the option related to automatic minor version upgrades and uncheck the box or toggle the setting to disable this feature.

7. **Save Changes**: After disabling automatic minor version upgrades, click on the "Save Changes" or "Apply Changes" button to apply the new configuration settings to the Amazon MQ instance.

8. **Verify Configuration**: Once the changes are saved, verify that automatic minor version upgrades are successfully disabled for the AWS Security Groups associated with the Amazon MQ instance.

By following these steps, you can remediate the misconfiguration of having automatic minor version upgrades enabled for AWS Security Groups in Amazon MQ using the AWS Management Console.
</Accordion>

<Accordion title='Using CLI'>
#

To remediate the misconfiguration of having MQ Automatic Minor Version Upgrades enabled for AWS Security Groups using AWS CLI, you can follow these steps:

1. **Identify the AWS Security Group associated with your MQ service**:
   - You can use the following AWS CLI command to list all the security groups associated with your MQ service:
     ```
     aws mq describe-broker --broker-id <your-broker-id> --query 'BrokerInstances[0].SecurityGroups'
     ```

2. **Update the Security Group to block all outbound traffic to the internet**:
   - Use the following AWS CLI command to update the outbound rules of the Security Group associated with your MQ service to block all traffic to 0.0.0.0/0:
     ```
     aws ec2 revoke-security-group-egress --group-id <your-security-group-id> --protocol all --port all --cidr 0.0.0.0/0
     ```

3. **Verify the changes**:
   - You can verify that the outbound rules have been updated successfully by describing the Security Group:
     ```
     aws ec2 describe-security-groups --group-ids <your-security-group-id>
     ```

4. **Disable Automatic Minor Version Upgrades for your MQ Broker**:
   - Use the following AWS CLI command to update your MQ Broker configuration and disable Automatic Minor Version Upgrades:
     ```
     aws mq update-broker --broker-id <your-broker-id> --auto-minor-version-upgrade false
     ```

5. **Verify the changes**:
   - You can verify that the Automatic Minor Version Upgrades setting has been disabled by describing the broker configuration:
     ```
     aws mq describe-broker --broker-id <your-broker-id> --query 'BrokerInstances[0].AutoMinorVersionUpgrade'
     ```

By following these steps, you can remediate the misconfiguration of having MQ Automatic Minor Version Upgrades enabled for AWS Security Groups using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of MQ having automatic minor version upgrades enabled for AWS Security Groups using Python, you can follow these steps:

1. **Install Boto3**: Ensure that you have Boto3 installed in your Python environment. Boto3 is the AWS SDK for Python that allows you to interact with AWS services.

```bash
pip install boto3
```

2. **Write Python Script**: Create a Python script that will disable automatic minor version upgrades for the MQ broker in the specified security group. Here is an example script to achieve this:

```python
import boto3

# Initialize the MQ client
client = boto3.client('mq')

# Specify the security group ID of the MQ broker
security_group_id = 'YOUR_SECURITY_GROUP_ID'

# Disable automatic minor version upgrades for the specified MQ broker
response = client.update_broker(
    BrokerId='YOUR_BROKER_ID',
    Configuration={
        'Id': 'autoMinorVersionUpgrade',
        'Value': 'false'
    }
)

print("Automatic minor version upgrades disabled for the MQ broker in the specified security group.")
```

3. **Replace the placeholders**:
   - Replace `YOUR_SECURITY_GROUP_ID` with the actual Security Group ID where the MQ broker is deployed.
   - Replace `YOUR_BROKER_ID` with the ID of the MQ broker for which you want to disable automatic minor version upgrades.

4. **Run the Script**: Execute the Python script to disable automatic minor version upgrades for the specified MQ broker in the Security Group.

```bash
python remediate_mq_auto_minor_version_upgrade.py
```

By following these steps, you can remediate the misconfiguration of MQ having automatic minor version upgrades enabled for AWS Security Groups using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

