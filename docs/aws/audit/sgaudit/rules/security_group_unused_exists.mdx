---
slug: security_group_unused_exists
title: Unused Security Groups Should Be Removed
sidebar_label: Unused Security Groups Should Be Removed
---

### More Info:

Non-default security groups were defined which were unused and may not be required. This being the case, their existence in the configuration increases the risk that they may be inappropriately assigned. The unused security groups should be reviewed and removed if no longer required.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent unused Security Groups in AWS using the AWS Management Console, follow these steps:

1. **Identify Unused Security Groups:**
   - Navigate to the **EC2 Dashboard** in the AWS Management Console.
   - In the left-hand menu, select **Security Groups** under the **Network & Security** section.
   - Review the list of security groups and identify those that are not associated with any network interfaces, instances, or other resources.

2. **Filter Unused Security Groups:**
   - Use the **filter options** to display only the security groups that are not in use. You can do this by selecting the **"Unused"** filter or by manually checking the **"Associated Instances"** column for a value of zero.

3. **Tagging for Review:**
   - For better management, tag the identified unused security groups with a specific tag (e.g., `Key: Status, Value: Unused`) to mark them for review or deletion. This helps in tracking and managing them easily.

4. **Automate Monitoring:**
   - Set up AWS Config rules or CloudWatch alarms to continuously monitor and alert you about unused security groups. AWS Config provides a managed rule called `ec2-security-group-attached` that can help in identifying security groups that are not associated with any resources.

By following these steps, you can effectively manage and prevent the accumulation of unused security groups in your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To prevent unused security groups in AWS using the AWS CLI, you can follow these steps:

1. **List All Security Groups:**
   Use the following command to list all security groups in your AWS account. This will help you identify which security groups are currently in use and which are not.

   ```sh
   aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupId,GroupName]' --output table
   ```

2. **Identify Unused Security Groups:**
   To identify unused security groups, you need to check which security groups are not associated with any network interfaces. Use the following command to list all network interfaces and their associated security groups:

   ```sh
   aws ec2 describe-network-interfaces --query 'NetworkInterfaces[*].Groups[*].GroupId' --output text
   ```

   Compare the output with the list of all security groups to identify the unused ones.

3. **Tag Security Groups:**
   To prevent future misconfigurations, you can tag your security groups with metadata indicating their purpose. This helps in identifying and managing them more effectively. Use the following command to tag a security group:

   ```sh
   aws ec2 create-tags --resources <SecurityGroupId> --tags Key=Purpose,Value=<Description>
   ```

4. **Automate Monitoring:**
   Set up a scheduled AWS Lambda function or a CloudWatch rule to periodically check for unused security groups and alert you. This can be done using a Python script executed by AWS Lambda. Here is a basic example of how you might set up such a script:

   ```python
   import boto3

   ec2 = boto3.client('ec2')

   def lambda_handler(event, context):
       all_sgs = ec2.describe_security_groups()['SecurityGroups']
       used_sgs = set()
       
       for ni in ec2.describe_network_interfaces()['NetworkInterfaces']:
           for group in ni['Groups']:
               used_sgs.add(group['GroupId'])
       
       unused_sgs = [sg for sg in all_sgs if sg['GroupId'] not in used_sgs]
       
       if unused_sgs:
           print("Unused Security Groups:")
           for sg in unused_sgs:
               print(f"GroupId: {sg['GroupId']}, GroupName: {sg['GroupName']}")
   ```

   Deploy this script as a Lambda function and set up a CloudWatch rule to trigger it periodically.

By following these steps, you can effectively prevent unused security groups from lingering in your AWS environment, thereby reducing potential security risks.
</Accordion>

<Accordion title='Using Python'>
To prevent unused security groups from lingering in your cloud environment, you can use Python scripts to identify and remove them. Below are the steps to achieve this for AWS, Azure, and GCP:

### AWS

1. **Install Boto3 Library**:
   ```bash
   pip install boto3
   ```

2. **Identify Unused Security Groups**:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   # Get all security groups
   all_security_groups = ec2.describe_security_groups()['SecurityGroups']

   # Get all network interfaces
   all_network_interfaces = ec2.describe_network_interfaces()['NetworkInterfaces']

   # Find used security groups
   used_security_groups = set()
   for interface in all_network_interfaces:
       for group in interface['Groups']:
           used_security_groups.add(group['GroupId'])

   # Find unused security groups
   unused_security_groups = [sg['GroupId'] for sg in all_security_groups if sg['GroupId'] not in used_security_groups]

   print("Unused Security Groups:", unused_security_groups)
   ```

3. **Remove Unused Security Groups**:
   ```python
   for sg_id in unused_security_groups:
       try:
           ec2.delete_security_group(GroupId=sg_id)
           print(f"Deleted Security Group: {sg_id}")
       except Exception as e:
           print(f"Error deleting {sg_id}: {e}")
   ```

### Azure

1. **Install Azure SDK**:
   ```bash
   pip install azure-mgmt-network
   ```

2. **Identify Unused Security Groups**:
   ```python
   from azure.identity import DefaultAzureCredential
   from azure.mgmt.network import NetworkManagementClient

   credential = DefaultAzureCredential()
   subscription_id = 'your_subscription_id'
   network_client = NetworkManagementClient(credential, subscription_id)

   # Get all network security groups
   all_nsgs = network_client.network_security_groups.list_all()

   # Get all network interfaces
   all_nics = network_client.network_interfaces.list_all()

   # Find used security groups
   used_nsgs = set()
   for nic in all_nics:
       if nic.network_security_group:
           used_nsgs.add(nic.network_security_group.id)

   # Find unused security groups
   unused_nsgs = [nsg.id for nsg in all_nsgs if nsg.id not in used_nsgs]

   print("Unused Security Groups:", unused_nsgs)
   ```

3. **Remove Unused Security Groups**:
   ```python
   for nsg_id in unused_nsgs:
       try:
           resource_group_name = nsg_id.split('/')[4]
           nsg_name = nsg_id.split('/')[-1]
           network_client.network_security_groups.begin_delete(resource_group_name, nsg_name)
           print(f"Deleted Security Group: {nsg_id}")
       except Exception as e:
           print(f"Error deleting {nsg_id}: {e}")
   ```

### GCP

1. **Install Google Cloud SDK**:
   ```bash
   pip install google-cloud-compute
   ```

2. **Identify Unused Security Groups**:
   ```python
   from google.cloud import compute_v1

   client = compute_v1.FirewallsClient()

   # Get all firewall rules
   all_firewalls = client.list(project='your_project_id')

   # Get all instances
   instances_client = compute_v1.InstancesClient()
   all_instances = instances_client.aggregated_list(project='your_project_id')

   # Find used security groups
   used_firewalls = set()
   for instance in all_instances:
       for network_interface in instance.network_interfaces:
           for access_config in network_interface.access_configs:
               used_firewalls.add(access_config.name)

   # Find unused security groups
   unused_firewalls = [fw.name for fw in all_firewalls if fw.name not in used_firewalls]

   print("Unused Security Groups:", unused_firewalls)
   ```

3. **Remove Unused Security Groups**:
   ```python
   for fw_name in unused_firewalls:
       try:
           client.delete(project='your_project_id', firewall=fw_name)
           print(f"Deleted Security Group: {fw_name}")
       except Exception as e:
           print(f"Error deleting {fw_name}: {e}")
   ```

These scripts will help you identify and remove unused security groups in AWS, Azure, and GCP, thereby preventing potential security risks associated with unused security groups.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the EC2 dashboard by selecting "Services" from the top menu, then selecting "EC2" under the "Compute" category.
3. In the EC2 dashboard, under the "Network & Security" section in the left-hand navigation pane, click on "Security Groups".
4. Here, you can see all the security groups associated with your AWS account. To identify unused security groups, you need to check each security group individually. Click on a security group to view its details. In the "Description" tab, look for the "Inbound Rules" and "Outbound Rules". If there are no associated rules or instances, it means the security group is unused and should be removed.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the security groups in your AWS account using the following command:

   ```
   aws ec2 describe-security-groups --query 'SecurityGroups[*].GroupId' --output text
   ```
   This command will return a list of all security group IDs.

3. To find out if a security group is being used, you can use the following command:

   ```
   aws ec2 describe-network-interfaces --query 'NetworkInterfaces[*].Groups[*].GroupId' --output text
   ```
   This command will return a list of all security group IDs that are currently being used by network interfaces.

4. By comparing the two lists, you can identify the security groups that are not being used. You can do this manually or write a script to automate the process. Here is a simple example using Python:

   ```python
   all_groups = set(run_aws_cli_command("aws ec2 describe-security-groups --query 'SecurityGroups[*].GroupId' --output text").split())
   used_groups = set(run_aws_cli_command("aws ec2 describe-network-interfaces --query 'NetworkInterfaces[*].Groups[*].GroupId' --output text").split())
   unused_groups = all_groups - used_groups
   print("Unused security groups:", unused_groups)
   ```
   In this script, `run_aws_cli_command` is a hypothetical function that runs an AWS CLI command and returns its output as a string. You would need to implement this function yourself, for example by using the `subprocess` module in Python.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) on your local system. Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, and more.

2. Use the following Python script to detect unused security groups. This script uses the Boto3 library to interact with the AWS environment. It first retrieves all security groups and then checks if they are being used by any instances. If a security group is not associated with any instance, it is considered unused.

```python
import boto3

def get_all_security_groups():
    ec2 = boto3.resource('ec2')
    return [sg.group_id for sg in ec2.security_groups.all()]

def get_all_instances_security_groups():
    ec2 = boto3.resource('ec2')
    return [sg['GroupId'] for instance in ec2.instances.all() for sg in instance.security_groups]

def get_unused_security_groups():
    all_sg = set(get_all_security_groups())
    used_sg = set(get_all_instances_security_groups())
    return all_sg - used_sg

print(get_unused_security_groups())
```

3. Run the script. If there are any unused security groups, their IDs will be printed to the console. If no unused security groups are found, the script will not output anything.

4. Regularly run this script to monitor your AWS environment for unused security groups. You can schedule it to run at specific intervals using a task scheduler like cron on Unix-based systems or Task Scheduler on Windows. This will help you keep your environment clean and secure.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of unused security groups in AWS, follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the EC2 Dashboard**: Click on the "Services" dropdown menu at the top of the page, select "EC2" under the Compute section.

3. **View Security Groups**: In the EC2 Dashboard, locate the "Security Groups" option in the navigation pane on the left and click on it.

4. **Identify Unused Security Groups**: Review the list of security groups to identify the ones that are not associated with any running instances or resources. You can check the "Description" tab of each security group to see if it is actively being used.

5. **Check Rules and Dependencies**: Before deleting a security group, ensure that there are no dependencies on it. Check if any other resources are using the security group for inbound/outbound rules.

6. **Delete Unused Security Groups**: To delete a security group, select the checkbox next to the security group(s) you want to remove, click on the "Actions" dropdown menu, and select "Delete security group".

7. **Confirm Deletion**: A confirmation dialog will appear asking you to confirm the deletion. Review the security group details once more and click "Yes, Delete" to confirm.

8. **Verify Deletion**: Once the security group is deleted, verify that it has been removed from the list of security groups. Also, ensure that there are no adverse effects on any resources due to the deletion.

9. **Repeat if Necessary**: Repeat the above steps for any other unused security groups that need to be removed.

By following these steps, you can identify and remove unused security groups in AWS using the AWS Management Console. This helps in maintaining a clean and secure environment by reducing the attack surface and minimizing the risk of misconfigurations.
</Accordion>

<Accordion title='Using CLI'>
#

To remediate the issue of unused security groups in AWS using AWS CLI, follow these steps:

1. List all the security groups that are not associated with any EC2 instances:
```bash
aws ec2 describe-security-groups --query "SecurityGroups[?length(Instances) == '0'].{Name:GroupName, ID:GroupId}"
```

2. Identify the security group that you want to delete from the list obtained in the previous step.

3. Delete the unused security group using the following command:
```bash
aws ec2 delete-security-group --group-id YOUR_SECURITY_GROUP_ID
```
Make sure to replace `YOUR_SECURITY_GROUP_ID` with the actual ID of the security group you want to delete.

4. Confirm the deletion by listing the security groups again:
```bash
aws ec2 describe-security-groups --query "SecurityGroups[?length(Instances) == '0'].{Name:GroupName, ID:GroupId}"
```

By following these steps, you can remediate the issue of unused security groups in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of unused security groups in AWS using Python, you can follow these steps:

1. Install the Boto3 library:
```bash
pip install boto3
```

2. Use the following Python script to identify and delete unused security groups:

```python
import boto3

def get_unused_security_groups():
    ec2 = boto3.client('ec2')
    
    # Get all security groups
    response = ec2.describe_security_groups()
    security_groups = response['SecurityGroups']
    
    # Get all instances
    response = ec2.describe_instances()
    instances = []
    for reservation in response['Reservations']:
        instances.extend(reservation['Instances'])
    
    # Get security group IDs attached to instances
    used_security_groups = set()
    for instance in instances:
        for sg in instance.get('SecurityGroups', []):
            used_security_groups.add(sg['GroupId'])
    
    # Identify unused security groups
    unused_security_groups = [sg for sg in security_groups if sg['GroupId'] not in used_security_groups]
    
    return unused_security_groups

def delete_security_group(group_id):
    ec2 = boto3.client('ec2')
    
    # Delete the security group
    response = ec2.delete_security_group(GroupId=group_id)
    print(f"Deleted security group: {group_id}")

if __name__ == '__main__':
    unused_security_groups = get_unused_security_groups()
    for sg in unused_security_groups:
        delete_security_group(sg['GroupId'])
```

3. Replace the AWS credentials in the AWS CLI configuration file located at `~/.aws/credentials` or use an IAM role that has the necessary permissions to list and delete security groups.

4. Run the Python script to identify and delete the unused security groups.

Please ensure that you have the necessary permissions to delete security groups before running this script.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html) 

