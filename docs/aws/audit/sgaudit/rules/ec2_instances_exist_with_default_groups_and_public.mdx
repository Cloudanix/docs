---
slug: ec2_instances_exist_with_default_groups_and_public
title: Default Security Group Should Not Be Publicly Accessible
sidebar_label: Default Security Group Should Not Be Publicly Accessible
---

### More Info:

Default security groups should block all traffic by default. EC2 instances should not be associated with default security groups with public access.

### Risk Level

Medium

### Address

Security

### Compliance Standards

NIST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon VPC console at https://console.aws.amazon.com/vpc/.

2. In the navigation pane, choose 'Security Groups'. This will display a list of all security groups associated with your account.

3. Select the default security group for the VPC. The details pane at the bottom of the screen displays the details of the selected security group.

4. In the 'Inbound Rules' tab, check if it allows unrestricted access (0.0.0.0/0) to any port. If it does, then the default security group is publicly accessible.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once you have AWS CLI installed and configured, you can proceed to the next steps.

2. List all the security groups in your AWS account using the following command:
   ```
   aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupId,GroupName]' --output text
   ```
   This command will return a list of all security groups along with their GroupId and GroupName.

3. For each security group, check the inbound rules to see if it allows unrestricted access. You can do this using the following command:
   ```
   aws ec2 describe-security-groups --group-ids <Security_Group_Id> --query 'SecurityGroups[*].IpPermissions[*].IpRanges[*].CidrIp' --output text
   ```
   Replace `<Security_Group_Id>` with the ID of the security group you want to check. This command will return a list of all IP ranges that are allowed to access the security group. If the list contains '0.0.0.0/0', it means the security group is publicly accessible.

4. Repeat step 3 for each security group in your AWS account. If any security group is publicly accessible, it is a misconfiguration.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. For AWS, you would need boto3, for Azure, you would need azure-mgmt-network, and for GCP, you would need google-cloud-securitycenter. You can install these libraries using pip.

```python
pip install boto3 azure-mgmt-network google-cloud-securitycenter
```

2. AWS: Use the boto3 library to check the default security group. Here is a sample script:

```python
import boto3

def check_default_security_group(region_name):
    ec2 = boto3.resource('ec2', region_name=region_name)
    default_sg = list(ec2.security_groups.filter(Filters=[{'Name': 'group-name', 'Values': ['default']}]))[0]
    for permission in default_sg.ip_permissions:
        for ip_range in permission['IpRanges']:
            if ip_range['CidrIp'] == '0.0.0.0/0':
                print(f"Default security group in {region_name} is publicly accessible")

check_default_security_group('us-west-2')
```

3. Azure: Use the azure-mgmt-network library to check the default security group. Here is a sample script:

```python
from azure.mgmt.network import NetworkManagementClient
from azure.identity import DefaultAzureCredential

def check_default_security_group(subscription_id):
    credential = DefaultAzureCredential()
    network_client = NetworkManagementClient(credential, subscription_id)
    for sg in network_client.network_security_groups.list_all():
        if sg.name == 'default':
            for rule in sg.security_rules:
                if rule.destination_address_prefix == '*' and rule.access == 'Allow':
                    print(f"Default security group in {subscription_id} is publicly accessible")

check_default_security_group('your-subscription-id')
```

4. GCP: Use the google-cloud-securitycenter library to check the default security group. Here is a sample script:

```python
from google.cloud import securitycenter_v1

def check_default_security_group(organization_id):
    client = securitycenter_v1.SecurityCenterClient()
    source_name = client.organization_source_path(organization_id, "-")
    for finding in client.list_findings(source_name):
        if 'firewall_rule' in finding.finding_class and finding.finding_class['firewall_rule']['target_tags'] == ['default-allow-all']:
            print("Default security group is publicly accessible")

check_default_security_group('your-organization-id')
```

Please replace 'your-subscription-id' and 'your-organization-id' with your actual Azure subscription ID and GCP organization ID respectively.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of the default security group being publicly accessible in AWS, follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the EC2 Dashboard**: Click on the "Services" dropdown menu at the top left corner of the console, select "EC2" under the Compute section.

3. **Access the Security Groups**: In the EC2 Dashboard, locate and click on the "Security Groups" option in the left-hand navigation pane.

4. **Identify the Default Security Group**: Look for the default security group in the list of security groups. The default security group has the name "default" and is associated with all new instances that are launched in the VPC.

5. **Edit Inbound Rules**: Click on the default security group to select it, and then navigate to the "Inbound Rules" tab at the bottom of the console.

6. **Remove Publicly Accessible Rules**: Identify any inbound rules that allow unrestricted access from the internet (0.0.0.0/0 or ::/0) and remove them. This includes rules allowing SSH (port 22), RDP (port 3389), HTTP (port 80), HTTPS (port 443), etc.

7. **Add Necessary Rules**: Add specific inbound rules that allow access only from trusted sources, such as your organization's IP addresses or specific security groups within your VPC.

8. **Save the Changes**: After making the necessary changes to the inbound rules, click on the "Save rules" button to apply the changes to the default security group.

9. **Verify Changes**: Double-check the inbound rules to ensure that only necessary and restricted access is allowed to the default security group.

By following these steps, you can remediate the misconfiguration of the default security group being publicly accessible in AWS and enhance the security of your cloud environment.

#### Using CLI

To remediate the misconfiguration of the default security group being publicly accessible in AWS, you can follow these steps using the AWS CLI:

1. List all the security groups in your AWS account to identify the default security group:
```
aws ec2 describe-security-groups --query "SecurityGroups[?GroupName=='default']"
```

2. Get the Group ID of the default security group from the output of the above command.

3. Update the inbound rules of the default security group to restrict access. You can remove the existing rules or update them to allow access only from specific IP ranges or security groups. For example, to remove all inbound rules from the default security group:
```
aws ec2 revoke-security-group-ingress --group-id <YOUR_DEFAULT_SECURITY_GROUP_ID> --protocol -1 --source-group all
```

4. Verify that the inbound rules have been updated successfully by describing the security group:
```
aws ec2 describe-security-groups --group-ids <YOUR_DEFAULT_SECURITY_GROUP_ID>
```

By following these steps, you can ensure that the default security group in your AWS account is no longer publicly accessible.

#### Using Python

To remediate the misconfiguration of the default security group being publicly accessible in AWS using Python, you can follow these steps:

1. Use the AWS SDK for Python (Boto3) to programmatically update the inbound rules of the default security group to restrict access.

2. Here's a sample Python script that demonstrates how to update the default security group to allow only specific IP ranges or ports:

```python
import boto3

# Initialize the EC2 client
ec2 = boto3.client('ec2')

# Get the default security group ID
response = ec2.describe_security_groups(GroupNames=['default'])
default_security_group_id = response['SecurityGroups'][0]['GroupId']

# Revoke existing inbound rules that allow all traffic
ec2.revoke_security_group_ingress(
    GroupId=default_security_group_id,
    IpPermissions=[
        {
            'IpProtocol': '-1',
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)

# Add new inbound rules to allow specific IP ranges or ports
ec2.authorize_security_group_ingress(
    GroupId=default_security_group_id,
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 22,
            'ToPort': 22,
            'IpRanges': [{'CidrIp': 'YOUR_IP_RANGE'}]
        },
        {
            'IpProtocol': 'tcp',
            'FromPort': 80,
            'ToPort': 80,
            'IpRanges': [{'CidrIp': 'YOUR_IP_RANGE'}]
        }
    ]
)

print('Default security group remediated successfully.')
```

3. Replace `'YOUR_IP_RANGE'` with the specific IP range or port that you want to allow access to. You can add multiple rules as needed.

4. Run this Python script in your AWS environment with the necessary IAM permissions to update security groups.

By following these steps, you can remediate the misconfiguration of the default security group being publicly accessible in AWS using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html#default-security-group](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html#default-security-group) 


</Tab>
</Tabs>