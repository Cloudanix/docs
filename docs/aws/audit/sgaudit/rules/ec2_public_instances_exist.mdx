---
slug: ec2_public_instances_exist
title: EC2 instances Should Not Be Publicly Accessible
sidebar_label: EC2 instances Should Not Be Publicly Accessible
---

### More Info:

Unknown EC2 instances should not be publicly accessible. It is good practice to maintain a list of known, publicly accessible instances and flag all other instances that meet this criteria.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, NIST, SOC2



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon EC2 dashboard.

2. In the navigation pane, under "NETWORK & SECURITY", click on "Security Groups".

3. In the Security Groups page, you will see a list of all security groups. Click on the security group that you want to check.

4. In the details pane at the bottom, click on the "Inbound" tab. This tab shows all the inbound rules that are associated with the security group.

5. Check the "Source" column for any rules that have "0.0.0.0/0" or "::/0" as their source. This means that the associated protocol and port range are open to the entire internet, which means the EC2 instances associated with this security group are publicly accessible.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Security Groups: Use the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text
   ```
   This command will return a list of all security group IDs.

3. Check Security Group Rules: For each security group ID returned by the previous command, check the inbound rules to see if they allow unrestricted access. You can do this with the following command:

   ```
   aws ec2 describe-security-groups --group-ids <Security_Group_ID> --query "SecurityGroups[*].IpPermissions[*].IpRanges[*].CidrIp" --output text
   ```
   Replace `<Security_Group_ID>` with the ID of the security group you want to check. This command will return a list of IP ranges that are allowed to access resources in the security group.

4. Detect Publicly Accessible EC2 Instances: If the previous command returns `0.0.0.0/0`, it means that the security group allows unrestricted access from any IP address. This indicates that EC2 instances associated with this security group are publicly accessible, which is a misconfiguration.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to list all EC2 instances and their security groups:
   You can use the `describe_instances` method to get information about all EC2 instances. Then, for each instance, you can get its security groups using the `describe_security_groups` method. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_instances()

   for reservation in response["Reservations"]:
       for instance in reservation["Instances"]:
           for sg in instance['SecurityGroups']:
               sg_response = ec2.describe_security_groups(GroupIds=[sg['GroupId']])
               print(sg_response)
   ```

3. Check if the security groups allow public access:
   For each security group, you can check its inbound rules. If there is a rule that allows traffic from 0.0.0.0/0 (which means all IP addresses), then the EC2 instance is publicly accessible. Here is how you can modify the script to check this:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_instances()

   for reservation in response["Reservations"]:
       for instance in reservation["Instances"]:
           for sg in instance['SecurityGroups']:
               sg_response = ec2.describe_security_groups(GroupIds=[sg['GroupId']])
               for rule in sg_response['SecurityGroups'][0]['IpPermissions']:
                   for ip_range in rule['IpRanges']:
                       if ip_range['CidrIp'] == '0.0.0.0/0':
                           print(f"Instance {instance['InstanceId']} is publicly accessible")
   ```

4. Run the script and review the output:
   You can run the script using a Python interpreter. The script will print the IDs of all EC2 instances that are publicly accessible. If there are no such instances, the script will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of EC2 instances being publicly accessible in AWS Security Groups, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in to your account.

2. **Navigate to EC2 Dashboard**: Go to the EC2 Dashboard by clicking on the "Services" dropdown menu at the top left corner, selecting "EC2" under the Compute section.

3. **Identify the EC2 Instance**: Identify the EC2 instance(s) that are publicly accessible. You can do this by checking the "Instance State" and "Instance Type" columns in the EC2 Dashboard.

4. **Identify Security Group**: Click on the EC2 instance that you want to remediate and scroll down to the "Description" tab. Under the Security group section, you will see the security group associated with the EC2 instance.

5. **Edit Security Group Rules**: Click on the security group associated with the EC2 instance. This will take you to the "Inbound" tab of the security group.

6. **Remove Public Access**: Identify the rule that allows public access (e.g., SSH port 22 or HTTP port 80) and click on the "Edit" button.

7. **Modify Rule**: In the Edit inbound rules window, select the rule that allows public access and click on the "Delete" button to remove it.

8. **Save Changes**: Click on the "Save rules" button to apply the changes to the security group.

9. **Verify Changes**: Go back to the EC2 Dashboard, select the EC2 instance, and verify that it is no longer publicly accessible by checking the public IP address field.

10. **Repeat for Other Instances**: Repeat the above steps for any other EC2 instances that are publicly accessible.

By following these steps, you have successfully remediated the misconfiguration of EC2 instances being publicly accessible in AWS Security Groups.

#### Using CLI

To remediate the issue of EC2 instances being publicly accessible in AWS using the AWS CLI, follow these steps:

1. Identify the security group associated with the EC2 instance that is publicly accessible. You can do this by describing the instance and noting the security group ID.

```bash
aws ec2 describe-instances --instance-ids <instance-id> --query 'Reservations[*].Instances[*].SecurityGroups[*].GroupId' --output text
```

2. Describe the inbound rules of the identified security group to check if there are any rules allowing public access.

```bash
aws ec2 describe-security-groups --group-ids <security-group-id>
```

3. Remove the inbound rule that allows public access (usually with `0.0.0.0/0` as the source) using the revoke-security-group-ingress command.

```bash
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port <port-number> --cidr 0.0.0.0/0
```

Replace `<security-group-id>` with the actual security group ID, `<port-number>` with the specific port number (e.g., 22 for SSH, 80 for HTTP, 443 for HTTPS), and `0.0.0.0/0` with the appropriate source IP range if needed.

4. Verify that the inbound rule has been successfully removed by describing the security group again.

```bash
aws ec2 describe-security-groups --group-ids <security-group-id>
```

By following these steps, you can remediate the issue of EC2 instances being publicly accessible in AWS by updating the security group rules to restrict access as needed.

#### Using Python

To remediate the misconfiguration of EC2 instances being publicly accessible in AWS using Python, you can create a script that will update the security group rules to restrict access only to specific IP addresses or ranges. Here are the steps to remediate this issue:

1. Install the Boto3 library:
   - Make sure you have the Boto3 library installed in your Python environment. You can install it using pip:
     ```
     pip install boto3
     ```

2. Write a Python script to update the security group rules:
   - Use the following Python script as a template to update the security group rules for your EC2 instances:

     ```python
     import boto3

     # Initialize the EC2 client
     ec2 = boto3.client('ec2')

     # Define the security group ID of the EC2 instance
     security_group_id = 'your_security_group_id'

     # Define the IP ranges that should have access to the EC2 instance
     ip_ranges = [{'CidrIp': 'x.x.x.x/32'}, {'CidrIp': 'y.y.y.y/32'}]  # Add your desired IP ranges

     # Update the security group rules
     response = ec2.authorize_security_group_ingress(
         GroupId=security_group_id,
         IpPermissions=[
             {
                 'IpProtocol': '-1',
                 'IpRanges': ip_ranges
             }
         ]
     )

     print('Security group rules updated successfully.')
     ```

3. Replace 'your_security_group_id' with the actual security group ID of your EC2 instance.
   
4. Define the IP ranges that should have access to the EC2 instance in the `ip_ranges` variable.

5. Run the Python script:
   - Save the Python script in a file, for example, `update_security_group.py`, and run it using the Python interpreter:
     ```
     python update_security_group.py
     ```

6. Verify the changes:
   - After running the script, verify that the security group rules have been updated to restrict access to the specified IP ranges only.

By following these steps and customizing the script with your specific security group ID and IP ranges, you can remediate the misconfiguration of EC2 instances being publicly accessible in AWS.

### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html) 


</Tab>
</Tabs>