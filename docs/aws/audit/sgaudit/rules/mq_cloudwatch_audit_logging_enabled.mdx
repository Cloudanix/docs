---
slug: mq_cloudwatch_audit_logging_enabled
title: MQ Brokers Has Cloudwatch Audit Logging.
sidebar_label: MQ Brokers Has Cloudwatch Audit Logging.
---

### More Info:

This rule checks if Amazon MQ brokers have Amazon CloudWatch audit logging enabled. The rule is NON_COMPLIANT if a broker does not have audit logging enabled.

### Risk Level

Low

### Address

Monitoring

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent MQ Brokers from lacking CloudWatch audit logging in Security Groups using the AWS Management Console, follow these steps:

1. **Navigate to Amazon MQ:**
   - Open the AWS Management Console.
   - In the search bar, type "Amazon MQ" and select it from the dropdown list.

2. **Select the Broker:**
   - In the Amazon MQ dashboard, locate and select the broker for which you want to enable CloudWatch audit logging.

3. **Configure Logging:**
   - In the broker details page, find the "Logs" section.
   - Ensure that the "Audit logs" option is enabled. This will send audit logs to CloudWatch Logs.

4. **Review and Save:**
   - Review the logging configuration to ensure it meets your requirements.
   - Click "Save" or "Update" to apply the changes.

By following these steps, you can ensure that your MQ Brokers have CloudWatch audit logging enabled, which helps in monitoring and auditing activities.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of MQ Brokers not having CloudWatch audit logging enabled in AWS using the AWS CLI, follow these steps:

1. **Enable CloudWatch Logs for MQ Broker:**
   Ensure that CloudWatch Logs are enabled for your MQ Broker. This can be done by specifying the `--logs` parameter when creating or updating the MQ Broker.

   ```sh
   aws mq create-broker --broker-name MyBroker --engine-type ACTIVEMQ --engine-version 5.15.0 --host-instance-type mq.t2.micro --logs audit=true
   ```

2. **Update Existing MQ Broker to Enable CloudWatch Logs:**
   If you have an existing MQ Broker, you can update it to enable CloudWatch Logs.

   ```sh
   aws mq update-broker --broker-id <broker-id> --logs audit=true
   ```

3. **Verify CloudWatch Logs Configuration:**
   Check the configuration of your MQ Broker to ensure that CloudWatch Logs are enabled.

   ```sh
   aws mq describe-broker --broker-id <broker-id>
   ```

   Look for the `Logs` section in the output to confirm that `audit` logging is set to `true`.

4. **Set Up IAM Role for CloudWatch Logs:**
   Ensure that the MQ Broker has the necessary IAM role with permissions to publish logs to CloudWatch. Attach the `CloudWatchLogsFullAccess` policy to the IAM role associated with your MQ Broker.

   ```sh
   aws iam attach-role-policy --role-name <role-name> --policy-arn arn:aws:iam::aws:policy/CloudWatchLogsFullAccess
   ```

By following these steps, you can prevent the misconfiguration of MQ Brokers not having CloudWatch audit logging enabled using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of MQ Brokers not having CloudWatch audit logging enabled in AWS using Python scripts, you can follow these steps:

### Step 1: Install AWS SDK for Python (Boto3)
Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip:
```bash
pip install boto3
```

### Step 2: Set Up AWS Credentials
Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables:
```bash
aws configure
```

### Step 3: Create a Python Script to Enable CloudWatch Logging for MQ Brokers
Here's a Python script to enable CloudWatch logging for all MQ Brokers:

```python
import boto3

# Initialize the MQ client
mq_client = boto3.client('mq')

# List all MQ brokers
brokers = mq_client.list_brokers()

# Iterate through each broker and enable CloudWatch logging
for broker in brokers['BrokerSummaries']:
    broker_id = broker['BrokerId']
    
    # Get the current configuration of the broker
    broker_info = mq_client.describe_broker(BrokerId=broker_id)
    
    # Check if CloudWatch logging is enabled
    if not broker_info['Logs']['Audit']:
        # Enable CloudWatch logging
        response = mq_client.update_broker(
            BrokerId=broker_id,
            Logs={
                'Audit': True,
                'General': broker_info['Logs']['General']  # Preserve existing General logging setting
            }
        )
        print(f"Enabled CloudWatch audit logging for broker: {broker_id}")
    else:
        print(f"CloudWatch audit logging already enabled for broker: {broker_id}")
```

### Step 4: Run the Script
Execute the script to ensure that CloudWatch audit logging is enabled for all MQ Brokers.

```bash
python enable_mq_cloudwatch_logging.py
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed in your Python environment.
2. **Set Up AWS Credentials**: Configure your AWS credentials.
3. **Create Python Script**: Write a Python script to enable CloudWatch logging for MQ Brokers.
4. **Run the Script**: Execute the script to apply the changes.

This script will iterate through all MQ Brokers in your AWS account and enable CloudWatch audit logging if it is not already enabled.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Amazon MQ console.

2. In the navigation pane, select "Brokers". This will display a list of all your MQ brokers.

3. Select the broker you want to check for CloudWatch Audit Logging. This will open the broker's details page.

4. In the broker's details page, look for the "Logs" section. If CloudWatch Audit Logging is enabled, you will see "Audit" listed under "Log Type" and "Enabled" under "Log Status". If you do not see this, then CloudWatch Audit Logging is not enabled for this broker.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all your Amazon MQ brokers using the following command:

   ```
   aws mq list-brokers
   ```
   This command will return a list of all your brokers.

3. For each broker, you can describe it to get more details. Replace 'broker-id' with your actual broker id from the previous step:

   ```
   aws mq describe-broker --broker-id broker-id
   ```
   This command will return a JSON object with details about the broker.

4. To check if CloudWatch audit logging is enabled, you need to look at the 'Logs' field in the returned JSON. If the 'Audit' field is set to 'true', then CloudWatch audit logging is enabled. If it's 'false' or the 'Audit' field is not present, then CloudWatch audit logging is not enabled. 

   You can use the following command to extract the 'Audit' field from the JSON:

   ```
   aws mq describe-broker --broker-id broker-id | jq '.Logs.Audit'
   ```
   This command uses the 'jq' tool to parse the JSON. If you don't have 'jq' installed, you can install it using your package manager.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) in your environment. This can be done using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the credentials file yourself. By default, its location is at `~/.aws/credentials`. At a minimum, it should look like this:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check if Amazon MQ Brokers have CloudWatch audit logging enabled:

   ```python
   import boto3

   def check_mq_broker_cloudwatch_logging():
       client = boto3.client('mq')
       brokers = client.list_brokers()
       for broker in brokers['BrokerSummaries']:
           broker_id = broker['BrokerId']
           logs = client.describe_broker(BrokerId=broker_id)['Logs']
           if not logs['Audit']:
               print(f"Broker {broker_id} does not have CloudWatch audit logging enabled.")

   check_mq_broker_cloudwatch_logging()
   ```
   
   This script lists all Amazon MQ Brokers in your account and checks if they have CloudWatch audit logging enabled. If a broker does not have audit logging enabled, it prints a message with the broker's ID.

4. Run the script: You can run the script using any Python interpreter. Make sure that the AWS credentials are correctly set up in your environment. If a broker does not have CloudWatch audit logging enabled, you will see a message in the console.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups using the AWS console, follow these steps:

1. **Access AWS Console**: Log in to your AWS Management Console using your credentials.

2. **Navigate to Amazon MQ Service**: Go to the Amazon MQ service by either searching for it in the AWS services search bar or locating it under the "Messaging & Queueing" section.

3. **Select the MQ Broker**: Select the MQ Broker for which you want to remediate the CloudWatch audit logging configuration.

4. **Modify Broker**: Click on the "Actions" dropdown menu and select "Modify Broker".

5. **Update Broker Configuration**: In the "Broker Details" section, scroll down to the "Logs" section.

6. **Disable CloudWatch Audit Logging**: Locate the "CloudWatch Audit Logging" option and disable it by unchecking the box or selecting "Disabled" from the dropdown menu.

7. **Save Changes**: Scroll to the bottom of the page and click on the "Modify" button to save the changes.

8. **Verify Configuration**: Once the changes are saved, verify that CloudWatch audit logging is disabled for the MQ Broker by checking the broker's configuration settings.

By following these steps, you will successfully remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups using the AWS console.
</Accordion>

<Accordion title='Using CLI'>
#

To remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups using AWS CLI, follow these steps:

1. **Identify the AWS Security Groups associated with the MQ Brokers**:
   - Run the following AWS CLI command to list all the AWS Security Groups associated with the MQ Brokers:
     ```
     aws mq list-brokers
     ```
   - Note down the Security Group IDs associated with the MQ Brokers.

2. **Disable CloudWatch audit logging for the identified Security Groups**:
   - Run the following AWS CLI command for each Security Group ID to disable CloudWatch audit logging:
     ```
     aws mq update-broker --broker-id <BROKER_ID> --logging { "audit": false }
     ```
   Replace `<BROKER_ID>` with the actual ID of the MQ Broker associated with the Security Group.

3. **Verify the changes**:
   - Run the following AWS CLI command to describe the MQ Broker and verify that CloudWatch audit logging is disabled for the Security Group:
     ```
     aws mq describe-broker --broker-id <BROKER_ID>
     ```
   Replace `<BROKER_ID>` with the actual ID of the MQ Broker associated with the Security Group.

4. **Repeat for other Security Groups**:
   - If there are multiple Security Groups associated with the MQ Brokers, repeat steps 2 and 3 for each Security Group.

By following these steps, you can remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups using Python, you can follow these steps:

1. **Identify the Security Groups**: First, you need to identify the Security Groups associated with your MQ Brokers.

2. **Disable CloudWatch Audit Logging**: You can use the AWS SDK for Python (Boto3) to disable CloudWatch audit logging for the identified Security Groups. Here is a sample Python code snippet to achieve this:

```python
import boto3

# Initialize the AWS clients
ec2_client = boto3.client('ec2')

# Specify the Security Group IDs of the MQ Brokers
security_group_ids = ['sg-12345678', 'sg-87654321']

# Disable CloudWatch Audit Logging for each Security Group
for sg_id in security_group_ids:
    response = ec2_client.modify_flow_logs(
        DeliverLogsPermissionArn='',
        LogGroupName='',
        ResourceIds=[sg_id],
        ResourceType='VPC',
        TrafficType='ALL',
        LogDestinationType='cloud-watch-logs',
        LogDestination=''
    )
    print(f"CloudWatch Audit Logging disabled for Security Group {sg_id}")
```

3. **Run the Python Script**: Save the above Python script in a file (e.g., `remediate_security_groups.py`) and execute it using Python. Make sure you have the necessary IAM permissions to modify the Security Groups.

By following these steps and executing the Python script, you can remediate the misconfiguration of MQ Brokers having CloudWatch audit logging enabled for AWS Security Groups.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

