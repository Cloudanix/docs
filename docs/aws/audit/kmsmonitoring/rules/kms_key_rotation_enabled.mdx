---
slug: kms_key_rotation_enabled
title: KMS Key Rotation Should Be Enabled
sidebar_label: KMS Key Rotation Should Be Enabled
---

### More Info:

When you enable automatic key rotation, AWS KMS rotates the CMK 365 days after the enable date and every 365 days thereafter.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, GDPR, NIST, HITRUST, AWSWAF, CISAWS, CBP, SOC2, NISTCSF, PCIDSS


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having KMS Key Rotation enabled in AWS using the AWS Management Console, follow these steps:

1. **Navigate to the KMS Dashboard:**
   - Sign in to the AWS Management Console.
   - Open the AWS Key Management Service (KMS) console by searching for "KMS" in the search bar and selecting it from the results.

2. **Select the Key:**
   - In the KMS console, click on "Customer managed keys" in the left-hand navigation pane.
   - Locate and select the KMS key for which you want to enable key rotation.

3. **Enable Key Rotation:**
   - In the key details page, find the "Key rotation" section.
   - Check the box next to "Automatically rotate this CMK every year."

4. **Save Changes:**
   - Click the "Save changes" button to apply the key rotation setting.

By following these steps, you ensure that the selected KMS key will have automatic key rotation enabled, enhancing the security of your encryption keys.
</Accordion>

<Accordion title='Using CLI'>
To ensure that KMS Key Rotation is enabled in AWS using the AWS CLI, follow these steps:

1. **Identify the Key ID or ARN**:
   - First, you need to identify the Key ID or ARN (Amazon Resource Name) of the KMS key for which you want to enable key rotation.
   ```sh
   aws kms list-keys
   ```

2. **Describe the Key**:
   - Verify the current status of key rotation for the specific key.
   ```sh
   aws kms get-key-rotation-status --key-id <key-id>
   ```

3. **Enable Key Rotation**:
   - Enable key rotation for the specified KMS key.
   ```sh
   aws kms enable-key-rotation --key-id <key-id>
   ```

4. **Verify Key Rotation Status**:
   - Confirm that key rotation has been successfully enabled.
   ```sh
   aws kms get-key-rotation-status --key-id <key-id>
   ```

Replace `<key-id>` with the actual Key ID or ARN of your KMS key. These steps will help ensure that key rotation is enabled, enhancing the security of your KMS keys.
</Accordion>

<Accordion title='Using Python'>
To ensure that KMS Key Rotation is enabled in AWS KMS using Python scripts, you can use the AWS SDK for Python (Boto3). Below are the steps to achieve this:

1. **Install Boto3**:
   Ensure you have Boto3 installed in your Python environment. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for KMS. This client will be used to interact with the AWS KMS service.
   ```python
   import boto3

   # Initialize a session using Amazon KMS
   kms_client = boto3.client('kms')
   ```

3. **List Keys**:
   Retrieve the list of KMS keys in your account. This will help you identify which keys need to have rotation enabled.
   ```python
   def list_keys():
       keys = []
       response = kms_client.list_keys()
       keys.extend(response['Keys'])

       while 'NextMarker' in response:
           response = kms_client.list_keys(Marker=response['NextMarker'])
           keys.extend(response['Keys'])

       return keys
   ```

4. **Enable Key Rotation**:
   For each key, check if key rotation is enabled. If not, enable it.
   ```python
   def enable_key_rotation(key_id):
       response = kms_client.get_key_rotation_status(KeyId=key_id)
       if not response['KeyRotationEnabled']:
           kms_client.enable_key_rotation(KeyId=key_id)
           print(f"Enabled key rotation for key: {key_id}")
       else:
           print(f"Key rotation already enabled for key: {key_id}")

   def main():
       keys = list_keys()
       for key in keys:
           enable_key_rotation(key['KeyId'])

   if __name__ == "__main__":
       main()
   ```

This script will ensure that key rotation is enabled for all KMS keys in your AWS account. Hereâ€™s a summary of the steps:

1. **Install Boto3**: Ensure Boto3 is installed.
2. **Initialize Boto3 Client**: Set up the KMS client.
3. **List Keys**: Retrieve all KMS keys.
4. **Enable Key Rotation**: Check and enable key rotation for each key.

By following these steps, you can programmatically ensure that KMS key rotation is enabled for all your keys in AWS.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the KMS dashboard at https://console.aws.amazon.com/kms.
3. In the navigation pane, choose "Customer managed keys".
4. For each key listed, check the "Key rotation" column. If it says "Disabled", then KMS Key Rotation is not enabled for that key.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to list all the keys in your AWS account. You can do this by using the AWS CLI command `list-keys`. The command is as follows:

   ```
   aws kms list-keys --region your-region
   ```

   Replace 'your-region' with the region you want to check. This command will return a list of all the KMS keys in your account.

2. Once you have the list of keys, you can check the rotation status of each key. You can do this by using the `get-key-rotation-status` command. The command is as follows:

   ```
   aws kms get-key-rotation-status --key-id your-key-id --region your-region
   ```

   Replace 'your-key-id' with the ID of the key you want to check and 'your-region' with the region the key is in. This command will return the rotation status of the key.

3. Repeat step 2 for each key in your list. If any of the keys have rotation disabled, then you have a misconfiguration.

4. To automate this process, you can use a script. Here is a simple Python script that uses the AWS SDK (boto3) to check the rotation status of all keys:

   ```python
   import boto3

   def check_key_rotation(region):
       client = boto3.client('kms', region_name=region)
       keys = client.list_keys()
       for key in keys['Keys']:
           rotation_status = client.get_key_rotation_status(KeyId=key['KeyId'])
           if not rotation_status['KeyRotationEnabled']:
               print(f"Key {key['KeyId']} in region {region} has rotation disabled")

   # Replace 'your-region' with the region you want to check
   check_key_rotation('your-region')
   ```

   This script will print out the IDs of all keys that have rotation disabled.
</Accordion>

<Accordion title='Using Python'>
To check if Key Management Service (KMS) key rotation is enabled in AWS, Azure, and GCP using Python scripts, you can follow these steps:

1. AWS:
   - Install and configure AWS SDK for Python (Boto3).
   - Use the `list_keys` method to retrieve all the KMS keys.
   - For each key, use the `get_key_rotation_status` method to check if the key rotation is enabled.
   - Python script example:
     ```python
     import boto3
     client = boto3.client('kms')
     response = client.list_keys()
     for key in response['Keys']:
         rotation_status = client.get_key_rotation_status(KeyId=key['KeyId'])
         print(key['KeyId'], rotation_status['KeyRotationEnabled'])
     ```

2. Azure:
   - Install and configure Azure SDK for Python.
   - Use the `list_keys` method to retrieve all the Key Vault keys.
   - For each key, use the `get_key_rotation_policy` method to check if the key rotation is enabled.
   - Python script example:
     ```python
     from azure.keyvault.keys import KeyClient
     from azure.identity import DefaultAzureCredential
     credential = DefaultAzureCredential()
     key_client = KeyClient(vault_url="https://my-key-vault.vault.azure.net/", credential=credential)
     keys = key_client.list_properties_of_keys()
     for key in keys:
         rotation_policy = key_client.get_key_rotation_policy(name=key.name)
         print(key.name, rotation_policy.lifetime_actions)
     ```

3. GCP:
   - Install and configure Google Cloud SDK for Python.
   - Use the `list_crypto_keys` method to retrieve all the KMS keys.
   - For each key, use the `get_crypto_key` method to check if the key rotation period and next rotation time are set.
   - Python script example:
     ```python
     from google.cloud import kms_v1
     client = kms_v1.KeyManagementServiceClient()
     parent = client.location_path('[PROJECT_ID]', '[LOCATION]')
     keys = client.list_crypto_keys(parent)
     for key in keys:
         key_detail = client.get_crypto_key(key.name)
         print(key.name, key_detail.rotation_period, key_detail.next_rotation_time)
     ```
Please replace '[PROJECT_ID]' and '[LOCATION]' with your actual GCP project ID and location.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the KMS Key Rotation misconfiguration in AWS using the AWS console:

1. Log in to your AWS Management Console.
2. Navigate to the AWS Key Management Service (KMS) dashboard.
3. Select the KMS key that needs to be remediated.
4. Click on the "Key policy" button to view the key policy.
5. In the key policy, locate the "KeyRotationEnabled" statement. If it is not present, add it to the key policy.
6. Set the value of "KeyRotationEnabled" to "true".
7. Click on the "Save changes" button to save the updated key policy.

After completing these steps, KMS key rotation will be enabled for the selected key. It is recommended to perform this remediation for all KMS keys used in your AWS environment.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "KMS Key Rotation Should Be Enabled" for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine or in the AWS Management Console.

2. Check if the KMS key rotation is enabled or not using the following command:
```
aws kms get-key-rotation-status --key-id <key-id>
```
Note: Replace `<key-id>` with the ID of the KMS key for which you want to check the rotation status.

3. If the key rotation is not enabled, enable it using the following command:
```
aws kms enable-key-rotation --key-id <key-id>
```
Note: Replace `<key-id>` with the ID of the KMS key for which you want to enable the rotation.

4. Verify if the key rotation is enabled using the following command:
```
aws kms get-key-rotation-status --key-id <key-id>
```
Note: Replace `<key-id>` with the ID of the KMS key for which you want to check the rotation status.

5. Repeat steps 2-4 for all the KMS keys in your AWS account.

By following these steps, you can remediate the misconfiguration "KMS Key Rotation Should Be Enabled" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate KMS Key Rotation Should Be Enabled in AWS, you can use the following steps in Python:

1. Import the necessary libraries:

```
import boto3
```

2. Create a boto3 client for AWS Key Management Service:

```
kms_client = boto3.client('kms')
```

3. Get a list of all KMS keys:

```
keys = kms_client.list_keys()
```

4. Loop through each key and check if key rotation is enabled:

```
for key in keys['Keys']:
    key_id = key['KeyId']
    key_rotation_status = kms_client.get_key_rotation_status(KeyId=key_id)
    if not key_rotation_status['KeyRotationEnabled']:
        # Enable key rotation
        kms_client.enable_key_rotation(KeyId=key_id)
```

5. Save the Python script and run it to enable key rotation for all KMS keys.

Note: Make sure you have appropriate AWS credentials with required permissions to perform this operation.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html](https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html) 

