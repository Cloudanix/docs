---
slug: secret_rotation
title: Secret Manager Secrets Rotation Enabled
sidebar_label: Secret Manager Secrets Rotation Enabled
---

### More Info:

Ensure that AWS Secrets Manager service is configured to automatically rotate your service or database secrets (i.e. enable automatic rotation feature for your secrets). Secrets Manager rotation is the automatic process that periodically change your secrets data to make it more difficult for an attacker to access the services and resources secured with these secrets. With Amazon Secrets Manager you don't have to manually change the secret and update it on all of your clients. Instead, the Secrets Manager service uses an AWS Lambda function to perform for you all of the steps required for rotation, on a regular schedule (predefined or custom).

### Risk Level

Medium

### Address

Security

### Compliance Standards

ISO27001, AWSWAF, SOC2, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the AWS Key Management Service (KMS) dashboard.
3. In the navigation pane, choose "Customer managed keys".
4. In the list of keys, select the key that you want to check.
5. Under the "Key rotation" section, check if "Automatically rotate this CMK every year" is enabled. If it's not enabled, then Secret Manager Secrets Rotation is not enabled for this key.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can list all the secrets in the Secret Manager by running the following command:

   ```
   aws secretsmanager list-secrets --region your-region-name
   ```

   Replace 'your-region-name' with the name of your AWS region. This command will return a list of secrets in the specified region.

3. To check if a secret is configured for rotation, you can describe the secret by running the following command:

   ```
   aws secretsmanager describe-secret --secret-id your-secret-id --region your-region-name
   ```

   Replace 'your-secret-id' with the ID of your secret and 'your-region-name' with the name of your AWS region. This command will return the details of the specified secret.

4. In the output of the above command, look for the 'RotationEnabled' field. If the value of this field is 'True', then the secret is configured for rotation. If the value is 'False', then the secret is not configured for rotation.

#### Using Python

To check if Secret Manager Secrets Rotation is enabled in KMS using Python scripts, you can follow these steps:

1. **Install the necessary libraries**: You need to install the `google-cloud-secret-manager` library. You can install it using pip:
   ```python
   pip install google-cloud-secret-manager
   ```

2. **Set up authentication**: Before you can interact with GCP services, you need to set up authentication. You can do this by setting the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the path of your service account key JSON file.
   ```python
   import os
   os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "/path/to/your/service-account-file.json"
   ```

3. **Create a Secret Manager client**: Use the `secretmanager` module to create a client. This client will allow you to interact with the Secret Manager API.
   ```python
   from google.cloud import secretmanager
   client = secretmanager.SecretManagerServiceClient()
   ```

4. **Check for secret rotation**: You can use the `list_secrets` method to get a list of all secrets in a project. For each secret, you can check the `rotation_period` and `next_rotation_time` fields to see if rotation is enabled.
   ```python
   parent = f"projects/{project_id}"
   for secret in client.list_secrets(request={"parent": parent}):
       if secret.rotation:
           print(f"Secret {secret.name} has rotation enabled.")
       else:
           print(f"Secret {secret.name} does not have rotation enabled.")
   ```
   Replace `{project_id}` with your GCP project ID. If `rotation_period` and `next_rotation_time` are not set, then rotation is not enabled for the secret.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Secret Manager Secrets Rotation Enabled" misconfiguration for AWS using the AWS console, please follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the AWS Secrets Manager service from the Services menu.
3. Select the secret for which you want to disable rotation.
4. Click on the "Disable rotation" button in the "Rotation configuration" section.
5. In the confirmation dialog box, click on the "Disable rotation" button to confirm the action.

Once you have completed these steps, the secret will no longer be set to rotate automatically, and you will need to manually rotate the secret when necessary.

#### Using CLI

The AWS Secret Manager is a service that enables you to store and manage secrets such as database credentials, API keys, and other sensitive data. One of the key features of Secret Manager is the ability to rotate secrets automatically, which helps to prevent unauthorized access to sensitive data.

If the misconfiguration is "Secret Manager Secrets Rotation Enabled", it means that secrets rotation is not enabled for the AWS Secret Manager. To remediate this misconfiguration, you can follow these steps using the AWS CLI:

Step 1: List all the secrets in the Secret Manager

```
aws secretsmanager list-secrets
```

Step 2: Enable rotation for each secret

```
aws secretsmanager rotate-secret --secret-id <SECRET_ID> --rotation-rules '{"AutomaticallyAfterDays": 30}'
```

Note: Replace `<SECRET_ID>` with the actual ID of the secret.

Step 3: Verify that rotation is enabled for the secret

```
aws secretsmanager describe-secret --secret-id <SECRET_ID>
```

This command should return the details of the secret, including the rotation configuration.

Step 4: Repeat steps 2 and 3 for all the secrets in the Secret Manager

Enabling secret rotation is an important security best practice, and it helps to ensure that sensitive data is protected from unauthorized access.

#### Using Python

To remediate the "Secrets Manager Secrets Rotation Enabled" misconfiguration in AWS using Python, follow these steps:

1. Open the AWS Management Console and navigate to the AWS Secrets Manager service.

2. Identify the secret(s) that have rotation enabled and note their ARN(s).

3. Use the AWS SDK for Python (Boto3) to disable rotation for each identified secret. Here's an example code snippet:

```python
import boto3

# Replace <SECRET_ARN> with the ARN of the secret to remediate
secret_arn = '<SECRET_ARN>'

# Create a Secrets Manager client
client = boto3.client('secretsmanager')

# Disable rotation for the secret
response = client.update_secret(
    SecretId=secret_arn,
    RotationLambdaARN='',
    RotationRules={
        'AutomaticallyAfterDays': None
    }
)

print(response)
```

4. Repeat step 3 for each identified secret with rotation enabled.

5. Verify that rotation is now disabled for each secret by checking their configuration in the AWS Management Console or using the Boto3 SDK.

Note: Disabling rotation for a secret means that it will no longer automatically rotate its credentials. You may need to manually rotate the credentials periodically to maintain security.

### Additional Reading:

- [https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html](https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html) 


</Tab>
</Tabs>