---
slug: secret_rotation_interval
title: Secrets Manager Secrets Should Be Rotated Frequently
sidebar_label: Secrets Manager Secrets Should Be Rotated Frequently
---

### More Info:

Ensure that the rotation interval for your AWS Secrets Manager secrets is configured to meet security and compliance requirements. Prior to running this rule by the Cloud Conformity engine, the rotation interval (in days) must be configured in the rule settings, on your Cloud Conformity account dashboard. Amazon Secrets Manager rotation feature represents the automatic process that periodically change your secrets information to make it more difficult for attackers to access the services and resources secured with these secrets.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, PCIDSS, ISO27001


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS Key Management Service (KMS) dashboard.
3. In the navigation pane, choose "Customer managed keys".
4. For each KMS key listed in the dashboard, check the "Rotation status" column. If the rotation status is set to "Disabled", it means the Secrets Manager secrets are not being rotated frequently.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Secrets Manager and KMS services.

2. Once the AWS CLI is set up, you can list all the secrets stored in the Secrets Manager by running the following command:

   ```
   aws secretsmanager list-secrets
   ```

   This command will return a JSON object containing all the secrets. You can parse this JSON object to get the list of secrets.

3. For each secret, you can get the rotation configuration by running the following command:

   ```
   aws secretsmanager describe-secret --secret-id <secret-id>
   ```

   Replace `<secret-id>` with the actual ID of the secret. This command will return a JSON object containing the details of the secret, including the rotation configuration.

4. To check if the secret is rotated frequently, you need to look at the `RotationRules` field in the returned JSON object. If the `AutomaticallyAfterDays` field is set to a high value, it means the secret is not rotated frequently. If the `RotationEnabled` field is set to `false`, it means the secret rotation is not enabled.

   Note: AWS recommends rotating secrets every 30 days. So, if the `AutomaticallyAfterDays` field is set to a value greater than 30, it can be considered as a misconfiguration.
</Accordion>

<Accordion title='Using Python'>
1. Import the necessary AWS SDK for Python (Boto3) modules and initialize a new client for the AWS Key Management Service (KMS):

```python
import boto3
kms_client = boto3.client('kms')
```

2. List all the keys in your AWS account:

```python
response = kms_client.list_keys()
keys = response['Keys']
```

3. For each key, get the key rotation status:

```python
for key in keys:
    key_id = key['KeyId']
    response = kms_client.get_key_rotation_status(KeyId=key_id)
    print(f"Key ID: {key_id}, Rotation Status: {response['KeyRotationEnabled']}")
```

4. If the rotation status is False, then the key is not being rotated frequently. This is a misconfiguration. The script should flag these keys for further investigation or remediation.

Note: This script assumes that you have the necessary permissions to list and get the rotation status of KMS keys in your AWS account. If you don't, you'll need to update your IAM policies accordingly. Also, make sure to handle any exceptions that might occur during the execution of the script, such as `botocore.exceptions.BotoCoreError` and `botocore.exceptions.ClientError`.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of Secrets Manager secrets not being rotated frequently in AWS using the AWS console, follow these steps:

1. Open the AWS Secrets Manager console.
2. Select the secret that needs to be rotated.
3. Click on the "Rotation" tab.
4. Click on the "Edit rotation" button.
5. In the "Configure rotation" section, select the rotation frequency and the number of days to keep the previous version of the secret.
6. Click on the "Enable rotation" checkbox.
7. Choose the Lambda function or AWS Secrets Manager to rotate the secret.
8. Click on the "Save changes" button.

By following these steps, the Secrets Manager secret will be automatically rotated according to the selected frequency, and the previous versions of the secret will be kept for the specified number of days.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Secrets Manager Secrets not being rotated frequently in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the secrets available in the Secrets Manager service:

```
aws secretsmanager list-secrets
```
3. Identify the secret that needs to be rotated frequently.

4. Run the following command to rotate the secret:

```
aws secretsmanager rotate-secret --secret-id <secret-id>
```

Note: Replace `<secret-id>` with the ID of the secret that needs to be rotated.

5. After running the above command, the Secrets Manager service will create a new version of the secret and update the old version with a new password or other credentials.

6. Update the applications or services that use the secret with the new credentials.

7. Delete the old version of the secret using the following command:

```
aws secretsmanager delete-secret --secret-id <secret-id> --force-delete-without-recovery
```

Note: Replace `<secret-id>` with the ID of the old version of the secret.

8. Repeat the above steps periodically to ensure that secrets are rotated frequently. It is recommended to set up automated rotation using AWS Lambda or other automation tools.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of Secrets Manager Secrets not being rotated frequently in AWS, you can use the following steps using Python:

1. Import the Boto3 library for AWS:

```python
import boto3
```

2. Create an AWS Secrets Manager client:

```python
client = boto3.client('secretsmanager')
```

3. Get a list of all secrets in AWS Secrets Manager:

```python
secrets = client.list_secrets()
```

4. Loop through the list of secrets and check if each secret has been rotated within the last 30 days:

```python
for secret in secrets['SecretList']:
    if 'RotationRules' in secret:
        rotation_days = secret['RotationRules']['AutomaticallyAfterDays']
        last_rotated_date = secret['LastRotatedDate']
        if (datetime.now() - last_rotated_date).days > rotation_days:
            # Secret has not been rotated within the last 30 days
            # Code to rotate the secret goes here
```

5. If a secret has not been rotated within the last 30 days, use the `rotate_secret` function to rotate the secret:

```python
client.rotate_secret(SecretId=secret['ARN'])
```

6. Add logging and error handling to the script as needed.

7. Schedule the script to run on a regular basis (e.g. daily) using AWS Lambda or a cron job.

By following these steps, you can ensure that all secrets in AWS Secrets Manager are rotated frequently, which helps to improve the security of your AWS environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html](https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html) 

