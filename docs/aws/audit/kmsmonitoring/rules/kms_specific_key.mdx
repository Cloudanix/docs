---
slug: kms_specific_key
title: Existence Of Specific AWS KMS CMKs
sidebar_label: Existence Of Specific AWS KMS CMKs
---

### More Info:

Ensure that a specific list of AWS KMS Customer Master Keys (CMKs) are available for use in your AWS account in order to meet strict security and compliance requirements in your organization.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP



### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the existence of specific AWS KMS Customer Master Keys (CMKs) in AWS KMS using the AWS Management Console, follow these steps:

1. **Access the AWS KMS Console:**
   - Sign in to the AWS Management Console.
   - Navigate to the AWS Key Management Service (KMS) by searching for "KMS" in the search bar and selecting it from the results.

2. **Review Existing Keys:**
   - In the AWS KMS console, click on "Customer managed keys" in the left-hand navigation pane.
   - Review the list of existing CMKs to identify any specific keys that should not exist.

3. **Set Key Policies:**
   - Select the CMK you want to manage.
   - Go to the "Key Policy" tab and review the key policy to ensure it aligns with your organization's security requirements.
   - Modify the key policy to restrict the creation of specific CMKs by limiting permissions to authorized users only.

4. **Enable Key Deletion Protection:**
   - For keys that should not be deleted, ensure that key deletion protection is enabled.
   - Select the key, go to the "Key actions" dropdown, and choose "Enable key deletion protection."

By following these steps, you can prevent the existence of unauthorized or specific AWS KMS CMKs in your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To prevent the existence of specific AWS KMS Customer Master Keys (CMKs) using the AWS CLI, you can follow these steps:

1. **List Existing CMKs:**
   First, identify the existing CMKs in your account to ensure you are aware of all keys and can manage them appropriately.
   ```sh
   aws kms list-keys
   ```

2. **Enable Key Policies:**
   Ensure that key policies are in place to restrict the creation of specific CMKs. You can attach a key policy to an existing CMK to restrict its usage.
   ```sh
   aws kms put-key-policy --key-id <key-id> --policy-name default --policy file://key-policy.json
   ```

3. **Use IAM Policies to Restrict CMK Creation:**
   Create or update IAM policies to restrict users or roles from creating specific CMKs. This can be done by specifying conditions in the policy.
   ```sh
   aws iam put-user-policy --user-name <user-name> --policy-name RestrictCMKCreation --policy-document file://restrict-cmk-creation-policy.json
   ```

4. **Monitor and Audit CMK Usage:**
   Enable AWS CloudTrail to monitor and audit the creation and usage of CMKs. This helps in ensuring compliance and detecting any unauthorized creation of CMKs.
   ```sh
   aws cloudtrail create-trail --name <trail-name> --s3-bucket-name <s3-bucket-name>
   aws cloudtrail start-logging --name <trail-name>
   ```

By following these steps, you can effectively prevent the existence of specific AWS KMS CMKs and ensure that your key management practices are secure and compliant.
</Accordion>

<Accordion title='Using Python'>
To prevent the existence of specific AWS KMS Customer Master Keys (CMKs) using Python scripts, you can follow these steps:

1. **Set Up AWS SDK for Python (Boto3):**
   - Ensure you have Boto3 installed. If not, install it using pip:
     ```bash
     pip install boto3
     ```

2. **Create a Python Script to List Existing CMKs:**
   - This script will list all existing CMKs and check for specific CMKs that should not exist.
   ```python
   import boto3

   def list_kms_keys():
       kms_client = boto3.client('kms')
       response = kms_client.list_keys()
       keys = response['Keys']
       return keys

   def describe_key(key_id):
       kms_client = boto3.client('kms')
       response = kms_client.describe_key(KeyId=key_id)
       return response['KeyMetadata']

   def check_for_specific_keys():
       specific_keys = ['arn:aws:kms:region:account-id:key/key-id-1', 'arn:aws:kms:region:account-id:key/key-id-2']
       keys = list_kms_keys()
       for key in keys:
           key_metadata = describe_key(key['KeyId'])
           if key_metadata['Arn'] in specific_keys:
               print(f"Specific key found: {key_metadata['Arn']}")
               # Add logic to handle the existence of specific keys
               # For example, you can disable or schedule deletion of the key
               # kms_client.schedule_key_deletion(KeyId=key['KeyId'], PendingWindowInDays=7)

   if __name__ == "__main__":
       check_for_specific_keys()
   ```

3. **Implement Preventive Measures:**
   - Modify the script to disable or schedule the deletion of the specific CMKs if they are found.
   ```python
   def disable_key(key_id):
       kms_client = boto3.client('kms')
       kms_client.disable_key(KeyId=key_id)

   def schedule_key_deletion(key_id, pending_window_in_days=7):
       kms_client = boto3.client('kms')
       kms_client.schedule_key_deletion(KeyId=key_id, PendingWindowInDays=pending_window_in_days)

   def check_for_specific_keys():
       specific_keys = ['arn:aws:kms:region:account-id:key/key-id-1', 'arn:aws:kms:region:account-id:key/key-id-2']
       keys = list_kms_keys()
       for key in keys:
           key_metadata = describe_key(key['KeyId'])
           if key_metadata['Arn'] in specific_keys:
               print(f"Specific key found: {key_metadata['Arn']}")
               disable_key(key['KeyId'])
               schedule_key_deletion(key['KeyId'])

   if __name__ == "__main__":
       check_for_specific_keys()
   ```

4. **Automate and Monitor:**
   - Schedule the script to run periodically using a cron job or AWS Lambda to ensure continuous monitoring and prevention.
   - Example of scheduling with cron (Linux):
     ```bash
     crontab -e
     ```
     Add the following line to run the script every day at midnight:
     ```bash
     0 0 * * * /usr/bin/python3 /path/to/your/script.py
     ```

By following these steps, you can prevent the existence of specific AWS KMS CMKs using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the AWS Key Management Service (KMS) dashboard at https://console.aws.amazon.com/kms/.
3. In the navigation pane, choose "Customer managed keys". This will display a list of all the Customer Master Keys (CMKs) that are currently available within your AWS account.
4. Search for the specific CMK by its alias or key ID in the search bar. If the CMK is present, it will be displayed in the list. If it's not, then it's likely that the CMK does not exist or there is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Open your terminal or command prompt.
2. Run the following command to list all the keys in your AWS KMS:

```bash
aws kms list-keys --region your-region-name
```
Replace 'your-region-name' with the name of the AWS region where you want to check for the existence of specific AWS KMS CMKs.

3. From the output, you can see the list of all the keys in your AWS KMS. Each key is represented by its ARN and KeyId. 

4. To check for the existence of a specific key, you can use the KeyId or ARN of the key. Run the following command:

```bash
aws kms describe-key --key-id your-key-id --region your-region-name
```
Replace 'your-key-id' with the KeyId or ARN of the key you want to check for its existence. Replace 'your-region-name' with the name of the AWS region where the key is located.

If the key exists, the command will return the metadata of the key. If the key does not exist, the command will return an error.
</Accordion>

<Accordion title='Using Python'>
1. Install Boto3: Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

```python
pip install boto3
```

2. Configure AWS Credentials: Before you can begin using Boto3, you should set up authentication credentials. You can do this by using the AWS CLI:

```bash
aws configure
```

3. Create a Python script to list all the KMS keys:

```python
import boto3

def list_keys():
    client = boto3.client('kms')
    response = client.list_keys()
    return response['Keys']

print(list_keys())
```

This script will print out all the KMS keys in your AWS account.

4. To check for the existence of a specific KMS CMK, you can modify the script like this:

```python
import boto3

def check_key_existence(key_id):
    client = boto3.client('kms')
    response = client.list_keys()
    for key in response['Keys']:
        if key['KeyId'] == key_id:
            return True
    return False

print(check_key_existence('your-key-id'))
```

This script will return True if the specified key exists, and False otherwise. Replace 'your-key-id' with the ID of the key you want to check.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The misconfiguration of "Existence of specific AWS KMS CMKs" means that there are AWS KMS Customer Master Keys (CMKs) that should not exist in your AWS account. To remediate this issue, follow the below steps:

1. Login to your AWS Management Console.
2. Go to the AWS KMS console.
3. Click on "Customer managed keys" in the left-hand navigation menu.
4. Identify the CMKs that should not exist in your account.
5. Select the CMKs that should not exist in your account.
6. Click on the "Schedule key deletion" button.
7. In the "Schedule key deletion" dialog box, specify the number of days after which the key will be deleted.
8. Click on the "Schedule deletion" button.

Once the keys are scheduled for deletion, you can monitor the progress of the deletion process in the AWS KMS console. It is recommended to delete the CMKs that are no longer required to avoid any potential security risks.

#
</Accordion>

<Accordion title='Using CLI'>
The following steps can be taken to remediate the "Existence Of Specific AWS KMS CMKs" misconfiguration for AWS using AWS CLI:

1. Identify the specific AWS KMS CMKs that should not exist in your account.
2. Use the AWS CLI command `aws kms list-keys` to list all the AWS KMS CMKs in your account.
3. Review the list of AWS KMS CMKs returned by the command and identify any that should not exist.
4. Use the AWS CLI command `aws kms schedule-key-deletion` to schedule the deletion of any unwanted AWS KMS CMKs. The command requires the ARN of the AWS KMS CMK to be deleted and the number of days until the key is permanently deleted. For example, the command to schedule the deletion of an AWS KMS CMK with the ARN `arn:aws:kms:us-east-1:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab` in 30 days would be:

```
aws kms schedule-key-deletion --key-id arn:aws:kms:us-east-1:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab --pending-window-in-days 30
```

5. Repeat steps 4 and 5 for any other unwanted AWS KMS CMKs.

Note: Before deleting any AWS KMS CMKs, ensure that they are not being used by any resources in your account. Otherwise, deleting the key may cause those resources to stop functioning.
</Accordion>

<Accordion title='Using Python'>
The misconfiguration of "Existence Of Specific AWS KMS CMKs" means that certain AWS KMS Customer Master Keys (CMKs) that are required for encryption or decryption of data are missing. To remediate this issue in AWS using python, follow the below steps:

1. Identify the missing AWS KMS CMKs that are required for encryption or decryption of data. This can be done by checking the logs or by analyzing the code.

2. Create the missing AWS KMS CMKs using the AWS KMS console or AWS CLI. You can use the following AWS CLI command to create a CMK:

```
aws kms create-key --description "My CMK" --key-usage ENCRYPT_DECRYPT
```

3. Once the CMKs are created, grant the necessary permissions to the AWS services or IAM users that require access to the CMKs. This can be done using the AWS KMS console or AWS CLI. You can use the following AWS CLI command to grant permissions to an IAM user:

```
aws kms create-grant --key-id <key-id> --grantee-principal <IAM-user-ARN> --operations Encrypt Decrypt
```

4. Update the code or configuration to use the newly created AWS KMS CMKs for encryption or decryption of data.

5. Test the updated code or configuration to ensure that the data is encrypted or decrypted correctly using the new AWS KMS CMKs.

6. Finally, monitor the logs and alerts to ensure that the issue does not occur again in the future.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html](https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html) 

