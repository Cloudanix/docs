---
slug: kms_specific_key
title: Existence Of Specific AWS KMS CMKs
sidebar_label: Existence Of Specific AWS KMS CMKs
---

### More Info:

Ensure that a specific list of AWS KMS Customer Master Keys (CMKs) are available for use in your AWS account in order to meet strict security and compliance requirements in your organization.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the AWS Key Management Service (KMS) dashboard by typing "KMS" in the search bar and selecting "Key Management Service".
3. In the KMS dashboard, click on "Customer managed keys" under the "Key Management" section on the left side of the page.
4. Here, you can see a list of all the Customer Master Keys (CMKs) that are currently in your AWS account. You can check for the existence of specific CMKs by looking at the "Key ID" or "Alias" columns.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List all KMS CMKs**: Use the AWS CLI `list-keys` command to list all the AWS KMS customer master keys (CMKs) in your account. The command is as follows:
   ```
   aws kms list-keys
   ```
   This command will return a list of all the CMKs in your account, including their Key Id and ARN.

3. **Check for Specific CMK**: If you are looking for a specific CMK, you can filter the results of the `list-keys` command using the `grep` command in Unix or Linux, or the `findstr` command in Windows. For example, if you are looking for a CMK with the Key Id "1234abcd-12ab-34cd-56ef-1234567890ab", you can use the following command:
   ```
   aws kms list-keys | grep "1234abcd-12ab-34cd-56ef-1234567890ab"
   ```
   If the CMK exists, this command will return the Key Id and ARN of the CMK. If the CMK does not exist, this command will return nothing.

4. **Check CMK Details**: If you want to check the details of a specific CMK, you can use the `describe-key` command with the Key Id or ARN of the CMK. The command is as follows:
   ```
   aws kms describe-key --key-id "1234abcd-12ab-34cd-56ef-1234567890ab"
   ```
   This command will return the details of the CMK, including its creation date, key state, key usage, and key policy.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can do this by running the command `pip install boto3` in your terminal.

2. Import the necessary modules and establish a session with AWS using your credentials. Here's a sample script:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, create a client for AWS Key Management Service (KMS). 

```python
kms = session.client('kms')
```

4. To check for the existence of a specific AWS KMS CMK, you can list all keys and then check if the specific key is in the list. Here's a sample script:

```python
def check_key_exists(key_id):
    response = kms.list_keys()
    for key in response['Keys']:
        if key['KeyId'] == key_id:
            return True
    return False

# Replace 'your-key-id' with the id of the key you want to check
print(check_key_exists('your-key-id'))
```

This script will return `True` if the key exists and `False` if it doesn't. Replace `'your-key-id'` with the id of the key you want to check.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

The misconfiguration of "Existence of specific AWS KMS CMKs" means that there are AWS KMS Customer Master Keys (CMKs) that should not exist in your AWS account. To remediate this issue, follow the below steps:

1. Login to your AWS Management Console.
2. Go to the AWS KMS console.
3. Click on "Customer managed keys" in the left-hand navigation menu.
4. Identify the CMKs that should not exist in your account.
5. Select the CMKs that should not exist in your account.
6. Click on the "Schedule key deletion" button.
7. In the "Schedule key deletion" dialog box, specify the number of days after which the key will be deleted.
8. Click on the "Schedule deletion" button.

Once the keys are scheduled for deletion, you can monitor the progress of the deletion process in the AWS KMS console. It is recommended to delete the CMKs that are no longer required to avoid any potential security risks.

#### Using CLI

The following steps can be taken to remediate the "Existence Of Specific AWS KMS CMKs" misconfiguration for AWS using AWS CLI:

1. Identify the specific AWS KMS CMKs that should not exist in your account.
2. Use the AWS CLI command `aws kms list-keys` to list all the AWS KMS CMKs in your account.
3. Review the list of AWS KMS CMKs returned by the command and identify any that should not exist.
4. Use the AWS CLI command `aws kms schedule-key-deletion` to schedule the deletion of any unwanted AWS KMS CMKs. The command requires the ARN of the AWS KMS CMK to be deleted and the number of days until the key is permanently deleted. For example, the command to schedule the deletion of an AWS KMS CMK with the ARN `arn:aws:kms:us-east-1:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab` in 30 days would be:

```
aws kms schedule-key-deletion --key-id arn:aws:kms:us-east-1:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab --pending-window-in-days 30
```

5. Repeat steps 4 and 5 for any other unwanted AWS KMS CMKs.

Note: Before deleting any AWS KMS CMKs, ensure that they are not being used by any resources in your account. Otherwise, deleting the key may cause those resources to stop functioning.

#### Using Python

The misconfiguration of "Existence Of Specific AWS KMS CMKs" means that certain AWS KMS Customer Master Keys (CMKs) that are required for encryption or decryption of data are missing. To remediate this issue in AWS using python, follow the below steps:

1. Identify the missing AWS KMS CMKs that are required for encryption or decryption of data. This can be done by checking the logs or by analyzing the code.

2. Create the missing AWS KMS CMKs using the AWS KMS console or AWS CLI. You can use the following AWS CLI command to create a CMK:

```
aws kms create-key --description "My CMK" --key-usage ENCRYPT_DECRYPT
```

3. Once the CMKs are created, grant the necessary permissions to the AWS services or IAM users that require access to the CMKs. This can be done using the AWS KMS console or AWS CLI. You can use the following AWS CLI command to grant permissions to an IAM user:

```
aws kms create-grant --key-id <key-id> --grantee-principal <IAM-user-ARN> --operations Encrypt Decrypt
```

4. Update the code or configuration to use the newly created AWS KMS CMKs for encryption or decryption of data.

5. Test the updated code or configuration to ensure that the data is encrypted or decrypted correctly using the new AWS KMS CMKs.

6. Finally, monitor the logs and alerts to ensure that the issue does not occur again in the future.


### Additional Reading:

- [https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html](https://docs.aws.amazon.com/kms/latest/developerguide/best-practices.html) 


</Tab>
</Tabs>