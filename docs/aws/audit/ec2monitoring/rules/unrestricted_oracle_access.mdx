---
slug: unrestricted_oracle_access
title: Unrestricted Oracle Access Should Not Be Allowed
sidebar_label: Unrestricted Oracle Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted inbound access to TCP port 1521 (Oracle Database).

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, HITRUST, AWSWAF, NISTCSF, PCIDSS, FedRAMP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, select 'Security Groups' under the 'Network & Security' section.
3. In the 'Security Groups' page, you will see a list of all security groups associated with your EC2 instances. Select the security group you want to inspect.
4. In the 'Inbound rules' tab of the selected security group, check for any rules that allow unrestricted access (0.0.0.0/0) to Oracle ports (typically TCP 1521). If such a rule exists, it indicates that unrestricted Oracle access is allowed.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all security groups: The next step is to list all the security groups in your AWS account. You can do this by running the following command:

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].{Name:GroupName,ID:GroupId}"
   ```
   This command will return a list of all security groups along with their names and IDs.

3. Check for unrestricted Oracle access: Now, for each security group, you need to check if it allows unrestricted Oracle access. Oracle Database typically uses port 1521, so you need to check if this port is open to the world (0.0.0.0/0). You can do this by running the following command for each security group:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions[*].{FromPort:FromPort,ToPort:ToPort,IpRanges:IpRanges[*].CidrIp}"
   ```
   Replace `<security-group-id>` with the ID of the security group you want to check.

4. Analyze the output: The command in step 3 will return a list of all IP ranges that are allowed to access each port in the security group. If you see an entry where `FromPort` is 1521, `ToPort` is 1521, and `IpRanges` includes 0.0.0.0/0, then that security group allows unrestricted Oracle access.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   To interact with AWS services, you need to install Boto3. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can configure your credentials either by exporting them directly into your shell or by storing them in a credentials file. You can create the credentials file yourself, the default location for the file is `~/.aws/credentials`. At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

2. Use Boto3 to interact with AWS EC2 service:
   You can use Boto3 to create, configure, and manage AWS services. For example, you can start or stop EC2 instances, create security groups, and so on. Here is a simple script to list all EC2 instances:
   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   for instance in ec2.instances.all():
       print(instance.id, instance.state)
   ```

3. Check the security group rules for Oracle access:
   Oracle Database typically uses TCP port 1521. So, you need to check if there are any security group rules that allow unrestricted (0.0.0.0/0) access to this port. Here is a script to do this:
   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           for ip_range in permission['IpRanges']:
               if '1521' in permission['ToPort'] and ip_range['CidrIp'] == '0.0.0.0/0':
                   print(f"Security Group {security_group.id} allows unrestricted Oracle access")
   ```

4. Run the script and review the output:
   Run the script in your shell. If there are any security groups that allow unrestricted Oracle access, they will be printed out. Review the output and take necessary actions to restrict the access.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of unrestricted Oracle access in AWS, you can follow the below steps:

1. Open the AWS Management Console and navigate to the RDS service.

2. Select the affected RDS instance and click on the "Modify" button.

3. Scroll down to the "Network & Security" section and click on the "Additional Configuration" tab.

4. In the "Additional Configuration" tab, locate the "Publicly Accessible" option and set it to "No".

5. Next, locate the "VPC Security Group" option and select the appropriate security group that allows access only to the required IP addresses or CIDR ranges.

6. Click on the "Continue" button and review the changes. If everything is correct, click on the "Modify DB Instance" button to apply the changes.

7. After the changes have been applied, verify that the RDS instance is no longer publicly accessible and that access is restricted to the required IP addresses or CIDR ranges.

By following these steps, you can remediate the issue of unrestricted Oracle access in AWS and ensure that your RDS instance is secure.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the unrestricted Oracle access issue in AWS, you can follow the below steps using AWS CLI:

1. Connect to your AWS account using AWS CLI.

2. Identify the security group that allows unrestricted Oracle access. You can use the following command to list all security groups in your AWS account:

```
aws ec2 describe-security-groups
```

3. Once you have identified the security group, use the following command to update the inbound rules of the security group to restrict access to Oracle:

```
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 1521 --cidr 0.0.0.0/0
```

This command will remove the inbound rule that allows unrestricted access to Oracle on port 1521 from any IP address.

4. After running the above command, you can verify that the rule has been removed by running the following command:

```
aws ec2 describe-security-groups --group-ids <security-group-id>
```

This command will display the details of the security group, including the inbound rules.

5. Finally, you should test the Oracle access to ensure that it is restricted as expected. If necessary, you can modify the security group rules further to allow access only from specific IP addresses or networks.
</Accordion>

<Accordion title='Using Python'>
To remediate the "Unrestricted Oracle Access Should Not Be Allowed" misconfiguration in AWS using Python, you can follow these steps:

1. Install the Boto3 AWS SDK for Python:

```python
!pip install boto3
```

2. Use Boto3 to connect to the AWS account:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY_ID',
    aws_secret_access_key='YOUR_SECRET_ACCESS_KEY',
    region_name='YOUR_REGION'
)

ec2 = session.client('ec2')
```

3. Use the `describe_security_groups` method to get a list of all the security groups in the account:

```python
response = ec2.describe_security_groups()
security_groups = response['SecurityGroups']
```

4. Loop through the security groups and check if any of them have unrestricted Oracle access:

```python
for sg in security_groups:
    for rule in sg['IpPermissions']:
        if rule['IpProtocol'] == 'tcp' and rule['FromPort'] == 1521 and rule['ToPort'] == 1521 and rule['IpRanges'] == [{'CidrIp': '0.0.0.0/0'}]:
            print(f"Security group {sg['GroupId']} has unrestricted Oracle access!")
```

5. If you find a security group with unrestricted Oracle access, use the `revoke_security_group_ingress` method to remove the rule:

```python
ec2.revoke_security_group_ingress(
    GroupId=sg['GroupId'],
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 1521,
            'ToPort': 1521,
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)
```

This will remove the unrestricted Oracle access from the security group.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 

