---
slug: reserved_instance_recent_purchase
title: EC2 Reserved Instances Recent Purchases Should Be Reviewed
sidebar_label: EC2 Reserved Instances Recent Purchases Should Be Reviewed
---

### More Info:

For regularly reviewing your EC2 Reserved Instance purchases for cost optimization (informational).

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, click on "Reserved Instances" in the left-hand navigation pane. This will display a list of all the Reserved Instances that have been purchased.
3. Review the list of Reserved Instances. Pay particular attention to the "Start" and "End" dates, the "Instance Type", and the "State" of each Reserved Instance. 
4. If there are any Reserved Instances that have been recently purchased (i.e., within the last 30 days), these should be reviewed to ensure that they are being utilized effectively and that they are not being wasted. This can be done by comparing the usage of these Reserved Instances with the usage of On-Demand Instances. If the Reserved Instances are not being fully utilized, this could indicate a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure to configure it with the necessary access keys and region.

2. Once the AWS CLI is set up, you can use the `describe-reserved-instances` command to list all the reserved instances in your account. The command is as follows:

   ```
   aws ec2 describe-reserved-instances
   ```

3. This command will return a JSON output with all the details of your reserved instances. You can review this output to check the recent purchases. Look for the "Start" field in the output which indicates the date and time the Reserved Instance was purchased.

4. To filter out the recent purchases, you can use the `--query` option with the `describe-reserved-instances` command. For example, to list all the reserved instances purchased in the last 30 days, you can use the following command:

   ```
   aws ec2 describe-reserved-instances --query "ReservedInstances[?Start>=`date -v-30d`]"
   ```

   This command uses the `date -v-30d` command to get the date 30 days ago and filters out the reserved instances that were purchased after this date.

#### Using Python

To check EC2 Reserved Instances Recent Purchases in AWS using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to install and configure Boto3. You can install it using pip:

   ```
   pip install boto3
   ```

   Then, configure your AWS credentials. You can do this by setting the following environment variables:

   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **Create a Python Script to Connect to AWS EC2:**
   You need to create a Python script that uses Boto3 to connect to the AWS EC2 service. Here is a basic example:

   ```python
   import boto3

   # Create a session using your AWS credentials
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
   )

   # Create an EC2 resource object using the session
   ec2 = session.resource('ec2')
   ```

3. **Get the List of Reserved Instances:**
   You can use the `describe_reserved_instances` method to get a list of all reserved instances. Here is an example:

   ```python
   # Get the list of all reserved instances
   reserved_instances = ec2.describe_reserved_instances()

   for ri in reserved_instances['ReservedInstances']:
       print("ID: {}, State: {}, Start: {}, End: {}".format(
           ri['ReservedInstancesId'],
           ri['State'],
           ri['Start'],
           ri['End']
       ))
   ```

4. **Review the Recent Purchases:**
   You can filter the list of reserved instances based on the start date to review the recent purchases. Here is an example:

   ```python
   from datetime import datetime, timedelta

   # Get the current date and time
   now = datetime.now()

   # Get the list of all reserved instances
   reserved_instances = ec2.describe_reserved_instances()

   for ri in reserved_instances['ReservedInstances']:
       # Convert the start date to a datetime object
       start_date = datetime.strptime(ri['Start'], '%Y-%m-%dT%H:%M:%S.%fZ')

       # Check if the reserved instance was purchased in the last 30 days
       if now - start_date < timedelta(days=30):
           print("ID: {}, State: {}, Start: {}, End: {}".format(
               ri['ReservedInstancesId'],
               ri['State'],
               ri['Start'],
               ri['End']
           ))
   ```

This script will print the ID, state, start date, and end date of all reserved instances that were purchased in the last 30 days.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step-by-step instructions to remediate the "EC2 Reserved Instances Recent Purchases Should Be Reviewed" misconfiguration in AWS using the AWS console:

1. Login to your AWS account and go to the AWS EC2 console.
2. Click on the "Reserved Instances" link in the left-hand navigation menu.
3. Review the list of recently purchased reserved instances to identify any that were purchased in error or are no longer needed.
4. Select the reserved instances that need to be modified or cancelled.
5. Click on the "Actions" button and select "Modify Reserved Instances" or "Cancel Reserved Instances" depending on the action you want to take.
6. Follow the prompts to modify or cancel the selected reserved instances.
7. After making the necessary changes, review the list of reserved instances again to ensure that all recent purchases have been reviewed and remediated.

By following these steps, you can remediate the "EC2 Reserved Instances Recent Purchases Should Be Reviewed" misconfiguration in AWS using the AWS console.

#### Using CLI

The EC2 Reserved Instances Recent Purchases Should Be Reviewed misconfiguration can be remediated in AWS using the following steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all active Reserved Instances:

```
aws ec2 describe-reserved-instances --filters "Name=state,Values=active"
```

3. Review the output of the above command and identify any recently purchased Reserved Instances that are not being utilized.

4. Run the following command to modify or cancel the unused Reserved Instances:

```
aws ec2 modify-reserved-instances --reserved-instances-id <ID> --target-configuration "InstanceCount=<COUNT>,OfferingId=<OFFERING_ID>"
```

Note: Replace `<ID>` with the Reserved Instance ID and `<COUNT>` with the desired instance count. `<OFFERING_ID>` can be obtained from the Reserved Instance description.

5. Alternatively, to cancel the unused Reserved Instances, run the following command:

```
aws ec2 cancel-reserved-instances-listings --reserved-instances-listing-ids <ID>
```

Note: Replace `<ID>` with the Reserved Instance Listing ID.

6. Repeat step 4 and 5 for all unused Reserved Instances.

7. Finally, run the following command to verify that all unused Reserved Instances have been modified or cancelled:

```
aws ec2 describe-reserved-instances --filters "Name=state,Values=active"
```

This should remediate the EC2 Reserved Instances Recent Purchases Should Be Reviewed misconfiguration in AWS.

#### Using Python

The misconfiguration "EC2 Reserved Instances Recent Purchases Should Be Reviewed" typically refers to a situation where an AWS account has recently purchased EC2 Reserved Instances, but they are not being fully utilized. To remediate this, you can use the following steps:

1. Identify the underutilized EC2 Reserved Instances using the AWS SDK for Python (boto3) by calling the `describe_reserved_instances()` method of the EC2 client object. This method returns information about the specified Reserved Instances, including the number of instances that are currently in use.

```python
import boto3

ec2_client = boto3.client('ec2')

reserved_instances = ec2_client.describe_reserved_instances()
```

2. Filter the results to only include Reserved Instances that are not being fully utilized. You can do this by comparing the `InstanceCount` attribute to the `InstanceCount` attribute of the `State` object for each Reserved Instance.

```python
underutilized_instances = []

for reserved_instance in reserved_instances['ReservedInstances']:
    state = ec2_client.describe_reserved_instances_modifications(
        ReservedInstancesModificationIds=[reserved_instance['ReservedInstancesId']]
    )['ReservedInstancesModifications'][0]['TargetConfigurations'][0]['ReservedInstancesConfiguration']['Scope']

    if reserved_instance['InstanceCount'] > state['InstanceCount']:
        underutilized_instances.append(reserved_instance)
```

3. Review the list of underutilized EC2 Reserved Instances and take appropriate action. This could include modifying the instance type or family to better match your workload, or selling the underutilized Reserved Instances on the Reserved Instance Marketplace.

```python
for instance in underutilized_instances:
    print(f"Underutilized EC2 Reserved Instance: {instance['ReservedInstancesId']}")
```

By following these steps, you can identify and remediate underutilized EC2 Reserved Instances in your AWS account using Python and the boto3 SDK.


### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html) 


</Tab>
</Tabs>