---
slug: ec2_instance_generation
title: EC2 Instances Should Use Latest Generation
sidebar_label: EC2 Instances Should Use Latest Generation
---

### More Info:

Your AWS servers should be using the latest generation of EC2 instances for price-performance improvements.

### Risk Level

Low

### Address

Cost optimization

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under "Instances", click on "Instances".
3. In the "Instances" page, you will see a list of all your EC2 instances. Click on the instance that you want to check.
4. In the "Description" tab at the bottom of the page, look for the "Instance type" field. This field will tell you the generation of the instance. If the instance type starts with "t2", "m4", "c4", or "r3", it is not the latest generation. The latest generation instances start with "t3", "m5", "c5", or "r5".

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the AWS CLI command `aws ec2 describe-instances` to list all the EC2 instances in your account. This command will return a JSON output with details about all your EC2 instances.

3. Extract instance types and instance IDs: From the JSON output, you can extract the instance types and instance IDs using the command `aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId, InstanceType]' --output text`. This command will return a list of instance IDs along with their instance types.

4. Check for outdated instance types: Now, you can manually check if any of the instance types listed in the previous step are outdated. AWS regularly releases new instance types with better performance and cost-efficiency. You can check the AWS EC2 documentation to find out the latest generation of instance types. If any of your instances are using an outdated type, it means they are not using the latest generation.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary libraries and establish a session: In your Python script, you'll need to import the necessary libraries and establish a session with your AWS account. You'll need your access key, secret access key, and the region you're working in.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Connect to the EC2 resource and retrieve instance information: Now that you've established a session, you can connect to the EC2 resource and retrieve information about your instances. You can do this by calling the `describe_instances()` method.

```python
ec2_resource = session.resource('ec2')

for instance in ec2_resource.instances.all():
    print('ID: {}, State: {}, Type: {}'.format(instance.id, instance.state, instance.instance_type))
```

4. Check the instance type: Now that you have the instance information, you can check the instance type to see if it's the latest generation. AWS has a list of current generation instance types that you can refer to. If the instance type is not in this list, it's not the latest generation.

```python
latest_generation_types = ['m5', 'm6g', 'c5', 'c6g', 'r5', 'r6g', 'x1e', 'z1d', 'a1', 't3', 't4g']

for instance in ec2_resource.instances.all():
    instance_type = instance.instance_type.split('.')[0]
    if instance_type not in latest_generation_types:
        print('Instance {} is not using the latest generation instance type.'.format(instance.id))
```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "EC2 Instances Should Use Latest Generation" for AWS using AWS console, follow these steps:

1. Login to your AWS console.
2. Navigate to the EC2 dashboard.
3. Click on the "Instances" option from the left-hand side menu.
4. Identify the instances that are not using the latest generation.
5. Stop the instances by selecting them and clicking on the "Instance State" option from the top menu, then selecting "Stop".
6. Once the instances are stopped, select them again and click on the "Actions" button from the top menu, then select "Instance Settings" and "Change Instance Type".
7. Select the latest generation instance type from the list and click on "Apply".
8. Start the instances again by selecting them and clicking on the "Instance State" option from the top menu, then selecting "Start".

After completing these steps, your EC2 instances will be using the latest generation.

#### Using CLI

To remediate the misconfiguration "EC2 Instances Should Use Latest Generation" for AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the EC2 instances in your AWS account:

```
aws ec2 describe-instances
```

3. Identify the instances that are not using the latest generation.

4. Stop the instance using the following command:

```
aws ec2 stop-instances --instance-ids <instance-id>
```

Make sure to replace `<instance-id>` with the actual ID of the instance that needs to be stopped.

5. Once the instance is stopped, update the instance type to the latest generation using the following command:

```
aws ec2 modify-instance-attribute --instance-id <instance-id> --instance-type <instance-type>
```

Replace `<instance-id>` with the actual ID of the instance that needs to be updated, and `<instance-type>` with the latest generation instance type.

6. Start the instance using the following command:

```
aws ec2 start-instances --instance-ids <instance-id>
```

Make sure to replace `<instance-id>` with the actual ID of the instance that needs to be started.

7. Verify that the instance is running and using the latest generation instance type.

Repeat the above steps for all the instances that are not using the latest generation.

#### Using Python

To remediate the EC2 Instances Should Use Latest Generation misconfiguration for AWS using Python, you can follow these steps:

1. Identify all the EC2 instances running in your AWS account that are not using the latest generation.

2. Use the AWS SDK for Python (Boto3) to create a list of all the instances that are not using the latest generation.

3. Use the Boto3 EC2 client to stop the instances that are not using the latest generation.

4. Use the Boto3 EC2 client to modify the instance type to the latest generation.

5. Use the Boto3 EC2 client to start the instances again.

Here is a sample Python code that can be used to remediate the EC2 Instances Should Use Latest Generation misconfiguration in AWS:

```python
import boto3

# Create a Boto3 EC2 client
ec2 = boto3.client('ec2')

# Get a list of all the instances in the account
response = ec2.describe_instances()

# Loop through all the instances and check if they are using the latest generation
for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        instance_type = instance['InstanceType']
        latest_generation_instance_types = ['t3', 'm5', 'c5', 'r5']
        if not any(instance_type.startswith(prefix) for prefix in latest_generation_instance_types):
            instance_id = instance['InstanceId']
            # Stop the instance
            ec2.stop_instances(InstanceIds=[instance_id])
            # Modify the instance type to the latest generation
            ec2.modify_instance_attribute(InstanceId=instance_id, Attribute='instanceType', Value='t3.micro')
            # Start the instance
            ec2.start_instances(InstanceIds=[instance_id])
```

Note: This code assumes that the latest generation instance type is `t3.micro`. You may need to modify the instance type value based on your specific requirements.

### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/migrating-latest-types.html](https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/migrating-latest-types.html) 


</Tab>
</Tabs>