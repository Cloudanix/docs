---
slug: ec2_last_backup_recovery_point_created
title: Elastic Compute Cloud Should Have Recovery Point
sidebar_label: Elastic Compute Cloud Should Have Recovery Point
---

### More Info:

This rule checks if a recovery point was created for Amazon Elastic Compute Cloud (Amazon EC2) instances. The rule is NON_COMPLIANT if the Amazon EC2 instance does not have a corresponding recovery point created .

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Elastic Compute Cloud (EC2) instances from lacking a recovery point in AWS using the AWS Management Console, follow these steps:

1. **Enable Automated Backups:**
   - Navigate to the **EC2 Dashboard** in the AWS Management Console.
   - Select **Instances** from the left-hand menu.
   - Choose the instance you want to configure.
   - Click on the **Actions** dropdown menu, then select **Create Image (EBS AMI)** to create an initial backup.
   - To automate this process, go to the **Lifecycle Manager** under the **Elastic Block Store (EBS)** section and create a new lifecycle policy to automate the creation of snapshots.

2. **Configure Amazon Data Lifecycle Manager (DLM):**
   - In the AWS Management Console, go to the **EC2 Dashboard**.
   - Under **Elastic Block Store**, select **Lifecycle Manager**.
   - Click on **Create lifecycle policy**.
   - Define the policy details, such as the resource type (EBS volumes), target tags, and schedule for creating snapshots.
   - Set retention rules to ensure that snapshots are kept for a specified period.

3. **Enable AWS Backup:**
   - Navigate to the **AWS Backup** service in the AWS Management Console.
   - Click on **Create backup plan**.
   - Choose a predefined plan or create a custom plan.
   - Add a backup rule specifying the frequency and retention period for backups.
   - Assign resources (EC2 instances) to the backup plan by tagging them appropriately.

4. **Tagging for Backup Policies:**
   - Ensure that your EC2 instances are properly tagged to be included in backup policies.
   - Go to the **EC2 Dashboard** and select **Instances**.
   - Select the instance you want to tag.
   - Click on the **Tags** tab, then **Add/Edit Tags**.
   - Add tags that match the criteria defined in your backup policies (e.g., `Backup=true`).

By following these steps, you can ensure that your EC2 instances have regular recovery points, reducing the risk of data loss due to misconfigurations.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where Elastic Compute Cloud (EC2) instances should have a recovery point in AWS, you can ensure that regular snapshots are taken of your EC2 instances. Here are the steps to set up automated snapshots using AWS CLI:

1. **Create an IAM Role for EC2 to Access AWS Services:**
   Ensure that your EC2 instances have the necessary permissions to create snapshots. Create an IAM role with the required permissions.

   ```sh
   aws iam create-role --role-name EC2SnapshotRole --assume-role-policy-document file://trust-policy.json
   aws iam attach-role-policy --role-name EC2SnapshotRole --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess
   ```

   The `trust-policy.json` should contain:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "Service": "ec2.amazonaws.com"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```

2. **Create a Snapshot Policy Using AWS CLI:**
   Use the AWS CLI to create a Data Lifecycle Manager (DLM) policy that automates the creation of snapshots.

   ```sh
   aws dlm create-lifecycle-policy --execution-role-arn arn:aws:iam::<account-id>:role/EC2SnapshotRole --description "Daily snapshot policy" --state ENABLED --policy-details file://policy-details.json
   ```

   The `policy-details.json` should contain:
   ```json
   {
     "ResourceTypes": ["VOLUME"],
     "TargetTags": [
       {
         "Key": "Backup",
         "Value": "true"
       }
     ],
     "Schedules": [
       {
         "Name": "DailySnapshots",
         "CreateRule": {
           "Interval": 24,
           "IntervalUnit": "HOURS",
           "Times": ["00:00"]
         },
         "RetainRule": {
           "Count": 7
         }
       }
     ]
   }
   ```

3. **Tag EC2 Volumes for Backup:**
   Ensure that the volumes you want to back up are tagged appropriately so that the DLM policy can identify them.

   ```sh
   aws ec2 create-tags --resources <volume-id> --tags Key=Backup,Value=true
   ```

4. **Verify the Snapshot Policy:**
   Verify that the lifecycle policy has been created and is in the enabled state.

   ```sh
   aws dlm get-lifecycle-policies
   ```

By following these steps, you can ensure that your EC2 instances have regular recovery points through automated snapshots, thus preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of Elastic Compute Cloud (EC2) instances not having a recovery point in AWS, you can use Python scripts to automate the creation of snapshots or AMIs (Amazon Machine Images) for your EC2 instances. Here are the steps to achieve this:

### Step 1: Install AWS SDK for Python (Boto3)
First, ensure you have Boto3 installed. Boto3 is the Amazon Web Services (AWS) SDK for Python, which allows Python developers to write software that makes use of Amazon services.

```bash
pip install boto3
```

### Step 2: Configure AWS Credentials
Make sure your AWS credentials are configured. You can do this by setting up the `~/.aws/credentials` file or by using environment variables.

```bash
aws configure
```

### Step 3: Write Python Script to Create Snapshots
Create a Python script that will create snapshots for your EC2 instances. Below is an example script:

```python
import boto3
from datetime import datetime

# Initialize a session using Amazon EC2
ec2 = boto3.client('ec2')

# Function to create a snapshot
def create_snapshot(volume_id, description):
    response = ec2.create_snapshot(
        VolumeId=volume_id,
        Description=description
    )
    return response

# Function to get all volumes and create snapshots
def create_snapshots_for_all_volumes():
    volumes = ec2.describe_volumes()
    for volume in volumes['Volumes']:
        volume_id = volume['VolumeId']
        description = f"Snapshot of {volume_id} taken on {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}"
        snapshot = create_snapshot(volume_id, description)
        print(f"Created snapshot: {snapshot['SnapshotId']} for volume: {volume_id}")

if __name__ == "__main__":
    create_snapshots_for_all_volumes()
```

### Step 4: Automate the Script Execution
To ensure that snapshots are created regularly, you can automate the execution of the script using AWS Lambda and CloudWatch Events.

#### Create a Lambda Function
1. Go to the AWS Lambda console.
2. Create a new Lambda function.
3. Upload the Python script as the Lambda function code.
4. Set up the necessary IAM role with permissions to create snapshots.

#### Schedule the Lambda Function
1. Go to the CloudWatch console.
2. Create a new rule under "Events" to trigger the Lambda function on a schedule (e.g., daily).
3. Select the Lambda function you created as the target.

By following these steps, you can ensure that your EC2 instances have regular recovery points, thereby preventing the misconfiguration of not having recovery points.
</Accordion>
</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under "INSTANCES", click on "Instances".
3. Select the EC2 instance that you want to check for recovery points.
4. In the bottom pane, click on the "Tags" tab. Look for a tag named "Recovery Point". If it doesn't exist or if it's not properly configured, then there is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following command to list all the EC2 instances in your AWS account.

   ```
   aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId]' --output text
   ```

3. Check for recovery points: For each instance ID obtained from the previous step, check if there are any recovery points. You can do this by using the following command:

   ```
   aws ec2 describe-instance-recovery-alarms --instance-id <instance-id>
   ```

   Replace `<instance-id>` with the actual instance ID. If the command returns an empty list, it means there are no recovery points for that instance.

4. Repeat step 3 for all instance IDs: You need to repeat the previous step for all the instance IDs obtained in step 2. This will help you identify all the EC2 instances that do not have any recovery points.
</Accordion>

<Accordion title='Using Python'>
1. **Setup AWS SDK (Boto3) in Python Environment:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   After installing boto3, you need to configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config. In the credentials file, you should put your access key and secret key. In the config file, you should put your region.

2. **Import Necessary Libraries:**
   Import the necessary libraries into your Python script. You will need boto3 for interacting with AWS and json for parsing the data.
   ```python
   import boto3
   import json
   ```

3. **Create a Session and EC2 Resource Object:**
   Create a session using your AWS credentials and create an EC2 resource object using this session.
   ```python
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )
   ec2 = session.resource('ec2')
   ```

4. **Check for Recovery Points:**
   Iterate over all your EC2 instances and check if they have a recovery point. If an instance does not have a recovery point, print its ID.
   ```python
   for instance in ec2.instances.all():
       try:
           recovery_point = instance.create_recovery_point(
               Description='Recovery point for instance {}'.format(instance.id)
           )
           print('Recovery point for instance {}: {}'.format(instance.id, recovery_point['RecoveryPointArn']))
       except Exception as e:
           print('Instance {} does not have a recovery point. Error: {}'.format(instance.id, str(e)))
   ```
   This script will create a recovery point for each instance and print its ARN. If it fails to create a recovery point, it will print the instance ID and the error message.
</Accordion>
</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of AWS Elastic Compute Cloud (EC2) instances not having a recovery point, you can set up automated backups using Amazon EC2's built-in feature called Amazon EC2 Instance Recovery. Here's a step-by-step guide on how to remediate this issue using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and log in to your AWS account.

2. **Navigate to EC2 Dashboard**: From the AWS Management Console, navigate to the EC2 Dashboard by clicking on "Services" at the top of the page and selecting "EC2" under the Compute section.

3. **Select EC2 Instances**: In the EC2 Dashboard, select the EC2 instance for which you want to enable recovery points by clicking on the checkbox next to the instance ID.

4. **Enable Instance Recovery**: With the instance selected, click on the "Actions" dropdown menu at the top of the page, navigate to the "Instance Settings" option, and then select "Enable Instance Recovery" from the submenu.

5. **Configure Recovery Settings**: In the Enable Instance Recovery dialog box, you can configure the recovery settings such as the "Recovery Time Objective (RTO)" which specifies the maximum time in minutes that the instance can be unavailable during recovery. Set the RTO value based on your recovery point objective.

6. **Enable Recovery**: After configuring the recovery settings, click on the "Enable Instance Recovery" button to enable automated recovery points for the selected EC2 instance.

7. **Verify Recovery Point**: To verify that the recovery point feature is enabled for the EC2 instance, you can check the instance details and look for the "Instance Recovery" status under the "Description" tab.

By following these steps, you have successfully remediated the misconfiguration of not having a recovery point for the AWS EC2 instance by enabling the Amazon EC2 Instance Recovery feature through the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not having a recovery point for an AWS EC2 instance using AWS CLI, follow these steps:

1. **Create an Amazon EBS Snapshot**:
   - Run the following AWS CLI command to create a snapshot of the EBS volume attached to your EC2 instance:
     ```
     aws ec2 create-snapshot --volume-id <VOLUME_ID> --description "Snapshot for recovery point"
     ```
     Replace `<VOLUME_ID>` with the ID of the EBS volume attached to your EC2 instance.

2. **Tag the Snapshot** (Optional but recommended):
   - It is a best practice to tag your snapshots for better organization and management. You can add tags to the snapshot using the following command:
     ```
     aws ec2 create-tags --resources <SNAPSHOT_ID> --tags Key=Name,Value=<SNAPSHOT_NAME>
     ```
     Replace `<SNAPSHOT_ID>` with the ID of the snapshot created in the previous step and `<SNAPSHOT_NAME>` with a descriptive name for the snapshot.

3. **Verify the Snapshot**:
   - You can verify that the snapshot has been created successfully by running the following command:
     ```
     aws ec2 describe-snapshots --snapshot-ids <SNAPSHOT_ID>
     ```
     Replace `<SNAPSHOT_ID>` with the ID of the snapshot created in step 1.

4. **Automate Snapshot Creation** (Optional):
   - To ensure regular snapshots are created for your EC2 instances, you can set up automated snapshot creation using AWS Lambda functions or AWS Backup.

By following these steps, you have successfully remediated the misconfiguration by creating a recovery point for your AWS EC2 instance using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of AWS EC2 instances not having a recovery point, you can create a backup or snapshot of the EC2 instance using Python and AWS Boto3 library. Here are the steps to remediate this issue:

1. Install the Boto3 library:
```bash
pip install boto3
```

2. Create a Python script to take a snapshot of the EC2 instance. Here is an example script:

```python
import boto3

# Initialize the EC2 client
ec2 = boto3.client('ec2')

# Get the instance ID of the EC2 instance for which you want to create a snapshot
instance_id = 'YOUR_INSTANCE_ID'

# Create a snapshot of the EC2 instance
response = ec2.create_snapshot(
    Description='Snapshot for recovery point',
    VolumeId='YOUR_VOLUME_ID'
)

print(response)
```

3. Replace `'YOUR_INSTANCE_ID'` and `'YOUR_VOLUME_ID'` with the actual instance ID and volume ID of the EC2 instance for which you want to create a recovery point.

4. Run the Python script to create a snapshot of the EC2 instance. This snapshot can be used as a recovery point in case of any issues with the EC2 instance.

By following these steps, you can remediate the misconfiguration of AWS EC2 instances not having a recovery point by creating a snapshot of the instance using Python and Boto3.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

