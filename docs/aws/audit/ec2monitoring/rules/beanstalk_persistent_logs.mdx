---
slug: beanstalk_persistent_logs
title: Ensure Persistent Logs Are Enabled For Elastic Beanstalk Environments
sidebar_label: Ensure Persistent Logs Are Enabled For Elastic Beanstalk Environments
---

### More Info:

Ensure that AWS Elastic Beanstalk (EB) environment logs are retained and uploaded to Amazon S3 in order to keep the logging data for future audits, historical purposes or to track and analyze the EB application environment behavior for a long period of time.

### Risk Level

Medium

### Address

Operational Maturity, Reliability

### Compliance Standards

HIPAA, PCIDSS, GDPR, SOC2


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To ensure persistent logs are enabled for Elastic Beanstalk environments in EC2 using the AWS Management Console, follow these steps:

1. **Navigate to Elastic Beanstalk Console:**
   - Open the AWS Management Console.
   - In the Services menu, select **Elastic Beanstalk**.

2. **Select Your Environment:**
   - In the Elastic Beanstalk dashboard, choose the application you want to configure.
   - Select the specific environment for which you want to enable persistent logs.

3. **Modify Environment Configuration:**
   - In the environment dashboard, click on the **Configuration** link in the left-hand menu.
   - Under the **Software** category, click the **Modify** button.

4. **Enable Log Options:**
   - In the Software Configuration page, scroll down to the **Log Options** section.
   - Check the box for **Enable log file rotation to Amazon S3**.
   - Specify the S3 bucket where you want the logs to be stored.
   - Click **Apply** to save the changes.

By following these steps, you ensure that persistent logs are enabled for your Elastic Beanstalk environment, which helps in maintaining a history of logs for troubleshooting and auditing purposes.
</Accordion>

<Accordion title='Using CLI'>
To ensure persistent logs are enabled for Elastic Beanstalk environments in EC2 using AWS CLI, follow these steps:

1. **Install and Configure AWS CLI:**
   Ensure you have the AWS CLI installed and configured with the necessary permissions.
   ```sh
   aws configure
   ```

2. **Retrieve Environment Configuration:**
   Get the current configuration settings of your Elastic Beanstalk environment.
   ```sh
   aws elasticbeanstalk describe-configuration-settings --application-name <application-name> --environment-name <environment-name>
   ```

3. **Modify Configuration to Enable Persistent Logs:**
   Create a JSON file (e.g., `options.json`) with the necessary configuration to enable persistent logs. The file should look like this:
   ```json
   [
     {
       "Namespace": "aws:elasticbeanstalk:cloudwatch:logs",
       "OptionName": "StreamLogs",
       "Value": "true"
     },
     {
       "Namespace": "aws:elasticbeanstalk:cloudwatch:logs",
       "OptionName": "DeleteOnTerminate",
       "Value": "false"
     }
   ]
   ```

4. **Apply the Configuration:**
   Use the `update-environment` command to apply the new configuration settings to your Elastic Beanstalk environment.
   ```sh
   aws elasticbeanstalk update-environment --application-name <application-name> --environment-name <environment-name> --option-settings file://options.json
   ```

By following these steps, you ensure that persistent logs are enabled for your Elastic Beanstalk environments, preventing the loss of logs when instances are terminated.
</Accordion>

<Accordion title='Using Python'>
To ensure persistent logs are enabled for Elastic Beanstalk environments in EC2 using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to achieve this:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Create a Python Script to Enable Persistent Logs**:
   Use the following Python script to enable persistent logs for your Elastic Beanstalk environment:

   ```python
   import boto3

   # Initialize a session using Amazon Elastic Beanstalk
   client = boto3.client('elasticbeanstalk')

   # Define the environment name and application name
   environment_name = 'your-environment-name'
   application_name = 'your-application-name'

   # Define the option settings to enable persistent logs
   option_settings = [
       {
           'Namespace': 'aws:elasticbeanstalk:cloudwatch:logs',
           'OptionName': 'StreamLogs',
           'Value': 'true'
       },
       {
           'Namespace': 'aws:elasticbeanstalk:cloudwatch:logs',
           'OptionName': 'DeleteOnTerminate',
           'Value': 'false'
       },
       {
           'Namespace': 'aws:elasticbeanstalk:cloudwatch:logs',
           'OptionName': 'RetentionInDays',
           'Value': '7'  # Set the retention period as needed
       }
   ]

   # Update the environment with the new option settings
   response = client.update_environment(
       ApplicationName=application_name,
       EnvironmentName=environment_name,
       OptionSettings=option_settings
   )

   print("Persistent logs enabled for environment:", environment_name)
   print(response)
   ```

4. **Run the Script**:
   Execute the script to apply the changes to your Elastic Beanstalk environment:
   ```bash
   python enable_persistent_logs.py
   ```

This script will enable persistent logs for your specified Elastic Beanstalk environment by updating the environment's configuration settings to stream logs to CloudWatch and retain them as specified.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the Elastic Beanstalk service.
3. Select the desired Elastic Beanstalk environment for which you want to check the persistent logs.
4. In the environment overview page, click on 'Configuration' on the left side panel.
5. In the 'Software' category, click on the 'Edit' button.
6. Scroll down to the 'Log Options' section. Here, check if the 'Instance log streaming' is enabled. If it is enabled, it means that the persistent logs are enabled for the Elastic Beanstalk environment.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elastic Beanstalk environments.

2. Once the AWS CLI is set up, you can list all the Elastic Beanstalk environments using the following command:

   ```
   aws elasticbeanstalk describe-environments
   ```

   This command will return a JSON output with details of all the Elastic Beanstalk environments.

3. To check if the persistent logs are enabled for a specific environment, you need to describe the environment configuration using the following command:

   ```
   aws elasticbeanstalk describe-configuration-settings --environment-name your_environment_name
   ```

   Replace 'your_environment_name' with the name of your Elastic Beanstalk environment. This command will return a JSON output with the configuration details of the specified environment.

4. In the returned JSON output, look for the 'OptionSettings' field. Under this field, look for the 'Namespace' named 'aws:elasticbeanstalk:hostmanager'. Under this namespace, look for the 'OptionName' named 'LogPublicationControl'. If the 'Value' for this option is 'true', then the persistent logs are enabled for the environment. If the 'Value' is 'false' or if the 'OptionName' 'LogPublicationControl' is not present, then the persistent logs are not enabled for the environment.
</Accordion>

<Accordion title='Using Python'>
To check if persistent logs are enabled for Elastic Beanstalk environments in EC2 using Python scripts, you can use the Boto3 library, which allows you to directly interact with AWS services, including Elastic Beanstalk. Here are the steps:

1. **Import the Boto3 library in Python:**
   Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. To use Boto3, you first need to import it.

   ```python
   import boto3
   ```

2. **Create an AWS session:**
   You need to create a session using your AWS credentials.

   ```python
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ```

3. **Create an Elastic Beanstalk client:**
   Using the session created above, you can create an Elastic Beanstalk client.

   ```python
   client = session.client('elasticbeanstalk')
   ```

4. **Check if persistent logs are enabled:**
   You can now use the client to describe the environment and check if the option "PersistentLogs" is enabled.

   ```python
   response = client.describe_configuration_options(
       ApplicationName='my-app',
       EnvironmentName='my-env'
   )

   options = response['Options']
   for option in options:
       if option['Namespace'] == 'aws:elasticbeanstalk:hostmanager':
           if option['OptionName'] == 'LogPublicationControl':
               if 'Value' in option and option['Value'] == 'true':
                   print("Persistent logs are enabled")
               else:
                   print("Persistent logs are not enabled")
   ```

This script will print whether persistent logs are enabled or not for the specified Elastic Beanstalk environment. Please replace 'YOUR_ACCESS_KEY', 'YOUR_SECRET_KEY', 'my-app', and 'my-env' with your actual AWS access key, secret key, application name, and environment name respectively.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "Ensure Persistent Logs Are Enabled For Elastic Beanstalk Environments" for AWS using AWS console, you can follow the below steps:

1. Login to the AWS Management Console.
2. Navigate to the Elastic Beanstalk service.
3. Select the Elastic Beanstalk environment for which you want to enable persistent logs.
4. Click on the "Configuration" option from the left-hand menu.
5. Scroll down to the "Software" section and click on the "Edit" button.
6. Scroll down to the "Instance log streaming" section and click on the "Edit" button.
7. Select the "Enable log file rotation" checkbox to enable persistent logs for the Elastic Beanstalk environment.
8. Set the "Retention" value to the desired number of days for which you want to retain the logs.
9. Click on the "Apply" button to save the changes.
10. Wait for a few minutes for the changes to take effect.

After following these steps, persistent logs will be enabled for the Elastic Beanstalk environment, and logs will be retained for the specified number of days.

#
</Accordion>

<Accordion title='Using CLI'>
To enable persistent logs for Elastic Beanstalk environments in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to enable Elastic Beanstalk logging:

```
aws elasticbeanstalk update-environment --environment-name <environment-name> --option-settings Namespace=aws:elasticbeanstalk:healthreporting:system,OptionName=SystemType,Value="enhanced"
```
Note: Replace `<environment-name>` with the actual name of the Elastic Beanstalk environment.

2. Next, run the following command to enable log rotation for the environment:

```
aws elasticbeanstalk update-environment --environment-name <environment-name> --option-settings Namespace=aws:elasticbeanstalk:environment:log-rotation,OptionName=LogPublicationControl,Value=true
```

3. Finally, run the following command to configure the log retention period (in days):

```
aws elasticbeanstalk update-environment --environment-name <environment-name> --option-settings Namespace=aws:elasticbeanstalk:environment:log-rotation,OptionName=RetentionInDays,Value=<number-of-days>
```
Note: Replace `<number-of-days>` with the desired number of days for log retention.

After following these steps, persistent logs will be enabled for the Elastic Beanstalk environment in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of ensuring persistent logs are enabled for Elastic Beanstalk environments in AWS using Python, you can follow the below steps:

1. Import the required libraries:

```python
import boto3
```

2. Create an AWS Elastic Beanstalk client object:

```python
eb_client = boto3.client('elasticbeanstalk')
```

3. Get a list of Elastic Beanstalk environments:

```python
env_list = eb_client.describe_environments()['Environments']
```

4. Loop through the list of environments and check if persistent logs are enabled. If not, update the environment to enable persistent logs:

```python
for env in env_list:
    env_name = env['EnvironmentName']
    env_desc = eb_client.describe_configuration_settings(ApplicationName='your_application_name', EnvironmentName=env_name)
    option_settings = env_desc['ConfigurationSettings'][0]['OptionSettings']
    for option in option_settings:
        if option['OptionName'] == 'aws:elasticbeanstalk:environment:log-rotation':
            if option['Value'] != 'true':
                eb_client.update_environment(EnvironmentName=env_name, OptionSettings=[{'Namespace': 'aws:elasticbeanstalk:environment:log-rotation', 'OptionName': 'Enabled', 'Value': 'true'}])
                print(f'Enabled persistent logs for Elastic Beanstalk environment {env_name}.')
```

This script will loop through all the Elastic Beanstalk environments in your AWS account and enable persistent logs for any environment where it is not already enabled.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/incident-response.html](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/incident-response.html) 

