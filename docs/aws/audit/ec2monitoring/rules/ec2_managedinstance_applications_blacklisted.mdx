---
slug: ec2_managedinstance_applications_blacklisted
title: None Specified Applications Should Be Installed On Instance.
sidebar_label: None Specified Applications Should Be Installed On Instance.
---

### More Info:

This rule checks if none of the specified applications are installed on the instance. Optionally, specify the version. Newer versions will not be denylisted. Optionally, specify the platform to apply the rule only to instances running that platform.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, select the 'Instances' option from the left-hand side menu. This will display a list of all the EC2 instances that are currently running.
3. Select the EC2 instance you want to check for misconfigurations. In the 'Description' tab at the bottom of the page, you can see all the details related to the selected instance.
4. To check for any unspecified applications, you need to connect to the instance. You can do this by clicking on the 'Connect' button at the top of the page. Once connected, you can use the command line interface to list all the installed applications and check if there are any applications that should not be installed on the instance.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure to configure it with the necessary access keys and region.

2. Once the AWS CLI is set up, you can list all the EC2 instances using the following command:
   ```
   aws ec2 describe-instances
   ```
   This command will return a JSON output with details about all the EC2 instances.

3. To check the applications installed on an instance, you need to SSH into the instance. You can do this using the following command:
   ```
   ssh -i /path/my-key-pair.pem ec2-user@ec2-198-51-100-1.compute-1.amazonaws.com
   ```
   Replace "/path/my-key-pair.pem" with the path to your private key file and "ec2-198-51-100-1.compute-1.amazonaws.com" with the public DNS of your EC2 instance.

4. Once you are logged into the instance, you can check the installed applications using the following command:
   ```
   dpkg --get-selections
   ```
   This command will list all the installed packages on the instance. You can look through this list to check if any unspecified applications are installed.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): Boto3 is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

```python
pip install boto3
```
After installation, you need to configure it. You can do this by creating a new session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    aws_session_token='SESSION_TOKEN',
)
```

2. List all EC2 instances: Use the `describe_instances()` function to get information about all instances. This function returns a lot of information about each instance, including the instance ID, instance type, and state.

```python
ec2 = session.resource('ec2')
for instance in ec2.instances.all():
    print(instance.id, instance.instance_type, instance.state)
```

3. Check for installed applications: To check for installed applications, you can use the `describe_instance_attribute()` function with the `UserData` attribute. This function returns the user data that you specified when you launched the instance. The user data is often used to pass scripts or other automation to run at launch time.

```python
response = ec2.describe_instance_attribute(
    InstanceId='INSTANCE_ID',
    Attribute='userData'
)
print('User data:', response['UserData'])
```

4. Analyze the user data: The user data returned in the previous step is base64-encoded. After decoding it, you can analyze it to check for any scripts or commands that install applications. If the user data contains commands to install applications, then applications are installed on the instance.

```python
import base64

user_data = response['UserData']
decoded_user_data = base64.b64decode(user_data).decode('utf-8')
print('Decoded user data:', decoded_user_data)

if 'apt-get install' in decoded_user_data or 'yum install' in decoded_user_data:
    print('Applications are installed on the instance.')
else:
    print('No applications are installed on the instance.')
```

Please note that this method only checks for applications installed through the user data at launch time. It does not check for applications installed after the instance has been launched.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of having unspecified applications installed on an AWS EC2 instance, you can follow these steps using the AWS Management Console:

1. **Identify Installed Applications**:
   - Connect to the EC2 instance using SSH or RDP.
   - Use commands like `dpkg -l` for Debian-based systems or `rpm -qa` for Red Hat-based systems to list all installed packages.

2. **Remove Unspecified Applications**:
   - Identify any applications that are not supposed to be installed on the instance.
   - Use the appropriate package manager (`apt` for Debian-based systems, `yum` for Red Hat-based systems) to uninstall the unwanted applications. For example:
     - Debian-based systems: `sudo apt-get remove <package_name>`
     - Red Hat-based systems: `sudo yum remove <package_name>`

3. **Update Security Groups**:
   - Ensure that the security groups associated with the EC2 instance only allow necessary inbound and outbound traffic. Restrict access to only required ports and protocols.

4. **Implement IAM Policies**:
   - Use AWS Identity and Access Management (IAM) to enforce policies that restrict users' ability to install applications on EC2 instances.

5. **Enable AWS Config Rules**:
   - Set up AWS Config Rules to monitor and enforce compliance with your desired configuration standards. This can help prevent unauthorized applications from being installed on EC2 instances.

6. **Regularly Monitor and Audit**:
   - Regularly monitor the instances for any unauthorized changes and audit the installed applications to ensure compliance with organizational policies.

By following these steps, you can remediate the issue of having unspecified applications installed on an AWS EC2 instance and ensure that only approved applications are running on your instances.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of having unspecified applications installed on an AWS EC2 instance using the AWS CLI, follow these steps:

1. **Identify Installed Applications:** First, you need to identify the applications that are installed on the EC2 instance. You can SSH into the instance and manually check the installed applications or use a configuration management tool like Ansible to gather this information.

2. **Remove Unspecified Applications:** Once you have identified the applications that are not supposed to be installed on the instance, you can remove them using the following command:
   
   ```
   sudo yum remove <package_name>
   ```

   Replace `<package_name>` with the name of the package you want to remove. You may need to run this command for each unwanted package.

3. **Update Security Groups:** If the applications were accessed over the network, you should also update the security groups associated with the EC2 instance to restrict access to only necessary ports and protocols.

4. **Create an AMI:** After removing the unwanted applications, you may want to create a new Amazon Machine Image (AMI) from the instance. This will ensure that any new instances launched from this AMI do not have the unwanted applications installed.

5. **Terminate and Replace Instance:** If removing the unwanted applications is not feasible or if the instance is heavily compromised, you may consider terminating the instance and launching a new instance from the updated AMI.

By following these steps, you can remediate the misconfiguration of having unspecified applications installed on an AWS EC2 instance using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of having unspecified applications installed on an AWS EC2 instance using Python, you can use the AWS Systems Manager Run Command to execute a script that will uninstall any unwanted applications.
```python
    # Retrieve EC2 managed instances
    response = ssm_client.describe_instance_information()

    for instance in response['InstanceInformationList']:
        instance_id = instance['InstanceId']
        inventory = ssm_client.get_inventory(
            Filters=[
                {
                    'Key': 'AWS:InstanceInformation.InstanceId',
                    'Values': [instance_id]
                },
            ]
        )

        if 'Applications' in inventory['Entities'][0]['Data']:
            installed_applications = inventory['Entities'][0]['Data']['Applications']

            # Check for blacklisted applications
            for app in installed_applications:
                if app['Name'] in application_names:
                    print(f"Blacklisted application '{app['Name']}' found on instance '{instance_id}'.")
                    # Perform remediation action here (e.g., uninstall or disable the application)
                    # Example:
                    # ssm_client.send_command(
                    #     InstanceIds=[instance_id],
                    #     DocumentName='AWS-RunShellScript',
                    #     Parameters={
                    #         'commands': ['<uninstall-command>']
                    #     }
                    # )
                    break

def main():
    # Specify the list of blacklisted application names
    blacklisted_applications = ['application1', 'application2']

    # Remediate EC2 managed instances with blacklisted applications
    remediate_managed_instance(blacklisted_applications)

if __name__ == "__main__":
    main()
```

Replace `'application1', 'application2'` with the names of the blacklisted applications. This script checks for the presence of blacklisted applications on EC2 managed instances using AWS Systems Manager Inventory and takes remediation actions accordingly. Adjust the remediation action (e.g., uninstall command) as per your requirements.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>