

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. Here, you can see all the inbound rules for this security group. If there is a rule that allows SSH (port 22) access from '0.0.0.0/0' or '::/0', then unrestricted SSH access is allowed.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all security groups: The first step to detect unrestricted SSH access is to list all the security groups in your AWS account. You can do this by running the following command: `aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text`

3. Check security group rules: For each security group, you need to check the inbound rules to see if any of them allow unrestricted SSH access. You can do this by running the following command for each security group: `aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions[*]" --output text`

4. Analyze the output: If the output of the above command includes a rule with `IpProtocol` set to "tcp", `FromPort` set to 22, `ToPort` set to 22, and `IpRanges` set to "0.0.0.0/0", then that means unrestricted SSH access is allowed.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   First, you need to install Boto3. You can do this by running the command `pip install boto3`. After installing Boto3, you need to configure it. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. Import necessary libraries and establish a session:
   In your Python script, you need to import the necessary libraries and establish a session with AWS. Here is an example:

   ```python
   import boto3
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='us-west-2'
   )
   ec2 = session.resource('ec2')
   ```

3. Retrieve and inspect security groups:
   Next, you need to retrieve all the security groups and inspect their ingress rules. If a security group has an ingress rule that allows unrestricted SSH access (i.e., allows access from 0.0.0.0/0), then it is misconfigured. Here is an example:

   ```python
   for security_group in ec2.security_groups.all():
       for permission in security_group.ip_permissions:
           for ip_range in permission['IpRanges']:
               if '0.0.0.0/0' in ip_range['CidrIp'] and permission['FromPort'] == 22:
                   print(f"Security Group {security_group.id} allows unrestricted SSH access.")
   ```

4. Run the script:
   Finally, you can run the script by executing the command `python script_name.py` in your terminal. If there are any security groups that allow unrestricted SSH access, their IDs will be printed to the console.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the unrestricted SSH access misconfiguration in AWS using the AWS console, you can follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 service.
3. Select the EC2 instance(s) that have unrestricted SSH access.
4. Click on the "Actions" button and select "Networking" and then "Change Security Groups".
5. In the "Change Security Groups" window, select the security group associated with the instance(s) and click "Edit".
6. In the "Edit inbound rules" window, locate the SSH rule (port 22) and remove it or restrict it to only allow traffic from specific IP addresses or ranges.
7. Click "Save" to apply the changes.

Once you have completed these steps, the unrestricted SSH access misconfiguration will be remediated and the instance(s) will be more secure.

#### Using CLI

To remediate unrestricted SSH access in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the security groups in your AWS account:

```
aws ec2 describe-security-groups
```

3. Identify the security group that allows unrestricted SSH access. You can look for a security group that has a rule allowing SSH traffic from 0.0.0.0/0 (any IP address) or ::/0 (any IPv6 address).

4. Once you have identified the security group, note down its Group ID.

5. Run the following command to revoke the SSH access rule from the security group:

```
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 22 --cidr 0.0.0.0/0
```

Replace `<security-group-id>` with the Group ID of the security group that allows unrestricted SSH access.

6. Verify that the SSH access rule has been revoked by running the following command:

```
aws ec2 describe-security-groups --group-ids <security-group-id>
```

Replace `<security-group-id>` with the Group ID of the security group that allows unrestricted SSH access.

7. Repeat the above steps for all the security groups in your AWS account to ensure that SSH access is not allowed from any unauthorized IP addresses.

#### Using Python

To remediate the unrestricted SSH access issue in AWS using Python, follow these steps:

1. Import the necessary AWS SDKs and libraries in your Python script. You will need to import the `boto3` library to interact with AWS services.

```
import boto3
```

2. Create a client session for EC2 using `boto3.client()`. 

```
ec2 = boto3.client('ec2')
```

3. Use the `describe_security_groups()` method to retrieve all the security groups in your AWS account.

```
security_groups = ec2.describe_security_groups()
```

4. Loop through each security group and check if it has any inbound rules allowing SSH access from any IP address (`0.0.0.0/0`).

```
for sg in security_groups['SecurityGroups']:
    for rule in sg['IpPermissions']:
        if rule['IpProtocol'] == 'tcp' and rule['FromPort'] <= 22 and rule['ToPort'] >= 22:
            for ip_range in rule['IpRanges']:
                if ip_range['CidrIp'] == '0.0.0.0/0':
                    print(f"Security group {sg['GroupId']} allows unrestricted SSH access.")
```

5. If any security group is found to have unrestricted SSH access, use the `revoke_security_group_ingress()` method to remove the rule allowing SSH access from any IP address.

```
ec2.revoke_security_group_ingress(
    GroupId=sg['GroupId'],
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 22,
            'ToPort': 22,
            'IpRanges': [
                {
                    'CidrIp': '0.0.0.0/0'
                }
            ]
        }
    ]
)
```

6. Run the Python script to remediate the unrestricted SSH access issue in your AWS account.

Note: Make sure to run the script with appropriate AWS credentials and permissions.


</Tab>
</Tabs>