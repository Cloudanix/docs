

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, look for the default security group of your VPC. The default security group is named as "default", and it's associated with your VPC.
4. Click on the "Inbound Rules" tab to view the inbound rules associated with the default security group. If there are rules that allow unrestricted access (0.0.0.0/0) to any port, then the default security group allows unrestricted public traffic.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all security groups: Use the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text
   ```
   This command will return a list of all security group IDs.

3. Check the inbound rules for each security group: For each security group ID returned by the previous command, check the inbound rules using the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions[*]" --output json
   ```
   Replace `<security-group-id>` with the ID of the security group you want to check. This command will return a JSON object containing all the inbound rules for the specified security group.

4. Check for unrestricted public access: In the JSON object returned by the previous command, look for any rules that allow unrestricted public access. These are rules where the `IpProtocol` is set to `-1` (which means all protocols are allowed), and the `IpRanges` array contains an object with `CidrIp` set to `0.0.0.0/0` (which means all IP addresses are allowed). If you find any such rules, it means the security group allows unrestricted public access.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then input your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

3. Write the Python script: The following Python script uses Boto3 to check if the default security group allows unrestricted public traffic:

   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   def check_security_group(sg):
       for permission in sg.ip_permissions:
           for ip_range in permission['IpRanges']:
               if ip_range['CidrIp'] == '0.0.0.0/0':
                   return True
       return False

   for security_group in ec2.security_groups.all():
       if security_group.group_name == 'default' and check_security_group(security_group):
           print(f"Security Group {security_group.id} allows unrestricted public traffic.")
   ```

4. Run the script: You can run the script using any Python interpreter. If the script prints any security group IDs, those are the IDs of the default security groups that allow unrestricted public traffic. If it doesn't print anything, then no default security group allows unrestricted public traffic.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using the AWS console, follow the steps below:

1. Log in to the AWS Management Console.

2. Navigate to the EC2 service.

3. In the left-hand menu, click on "Security Groups".

4. Select the default security group.

5. In the "Inbound Rules" tab, remove any rules that allow unrestricted public traffic (i.e. 0.0.0.0/0).

6. Add specific rules for the required ports and protocols to allow traffic only from authorized sources.

7. Review and save the changes.

By following these steps, you will remediate the misconfiguration and ensure that the default security group does not allow unrestricted public traffic.

#### Using CLI

To remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the ID of the default security group in your AWS account:

   ```
   aws ec2 describe-security-groups --filters Name=group-name,Values=default --query 'SecurityGroups[*].GroupId' --output text
   ```

3. Run the following command to update the inbound rules of the default security group to allow only necessary traffic:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol all --port all --cidr 0.0.0.0/0
   ```

   This command will remove all the inbound rules that allow unrestricted public traffic.

4. Now, add the necessary inbound rules to the default security group using the following command:

   ```
   aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol tcp --port <port-number> --cidr <ip-address>
   ```

   Replace `<port-number>` with the port number you want to allow traffic for and `<ip-address>` with the IP address range you want to allow traffic from.

5. Repeat step 4 for all the necessary inbound rules.

6. Verify the updated inbound rules of the default security group using the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   This command will display the updated inbound rules for the default security group.

By following the above steps, you can remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of default security group allowing unrestricted public traffic in AWS using Python, you can follow these steps:

1. Import the necessary AWS SDK libraries and modules in Python.

```
import boto3
```

2. Create a connection to the AWS EC2 service using the boto3 library.

```
ec2 = boto3.client('ec2')
```

3. Get the default security group ID using the describe_security_groups() method.

```
response = ec2.describe_security_groups(GroupNames=['default'])
sg_id = response['SecurityGroups'][0]['GroupId']
```

4. Revoke the ingress rules that allow unrestricted public traffic using the revoke_security_group_ingress() method.

```
response = ec2.revoke_security_group_ingress(
    GroupId=sg_id,
    IpPermissions=[
        {
            'IpProtocol': '-1',
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)
```

5. Confirm that the ingress rules have been revoked by describing the security group again.

```
response = ec2.describe_security_groups(GroupNames=['default'])
print(response)
```

This should remediate the misconfiguration of default security group allowing unrestricted public traffic in AWS using Python.


</Tab>
</Tabs>