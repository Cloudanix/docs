---
slug: reserved_instance_payment_pending
title: EC2 Reserved Instances Should Not Have Payment Pending
sidebar_label: EC2 Reserved Instances Should Not Have Payment Pending
---

### More Info:

To ensure that none of your AWS EC2 Reserved Instance purchases are pending.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the EC2 dashboard by selecting "Services" from the top menu, then selecting "EC2" under the "Compute" category.
3. In the EC2 dashboard, select "Reserved Instances" from the left-hand menu.
4. In the Reserved Instances page, check the "Status" column for each instance. If any instance has a status of "payment-pending", it indicates that the payment for the reserved instance is pending.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 Reserved Instances: Use the following AWS CLI command to list all your EC2 Reserved Instances:

   ```
   aws ec2 describe-reserved-instances
   ```

   This command will return a JSON output with details about all your EC2 Reserved Instances.

3. Filter EC2 Reserved Instances with payment pending: In the JSON output, look for the "State" field under each Reserved Instance. If the value of this field is "payment-pending", it means that the payment for that Reserved Instance is pending.

   You can use the following command to filter out EC2 Reserved Instances with payment pending:

   ```
   aws ec2 describe-reserved-instances --query 'ReservedInstances[?State==`payment-pending`]'
   ```

4. Review the output: The above command will return a list of EC2 Reserved Instances with payment pending. Review this list to identify any misconfigurations. If there are no such instances, the command will return an empty list.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, AWS DynamoDB, and much more. To install Boto3, you can use pip:

   ```
   pip install boto3
   ```

   You also need to configure your AWS credentials. You can do this in several ways, but the simplest is to use the AWS CLI:

   ```
   aws configure
   ```

   This will prompt you for your AWS Access Key ID, Secret Access Key, AWS Region, and output format.

2. Use Boto3 to interact with AWS EC2: You can use Boto3 to create, configure, and manage AWS services. For example, you can start or stop EC2 instances, create security groups, and much more. Here is a simple script to list all EC2 instances:

   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   for instance in ec2.instances.all():
       print(instance.id, instance.state)
   ```

3. Check the status of Reserved Instances: You can use the `describe_reserved_instances` method to get information about your Reserved Instances. Here is a simple script to list all Reserved Instances and their state:

   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_reserved_instances()

   for ri in response['ReservedInstances']:
       print(ri['ReservedInstancesId'], ri['State'])
   ```

4. Check if payment is pending: You can check the `State` of each Reserved Instance to see if payment is pending. If the `State` is `payment-pending`, then the payment for the Reserved Instance is not yet complete.

   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_reserved_instances()

   for ri in response['ReservedInstances']:
       if ri['State'] == 'payment-pending':
           print(f"Payment is pending for Reserved Instance: {ri['ReservedInstancesId']}")
   ```
   
This script will print the IDs of all Reserved Instances for which payment is pending.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Here are the step-by-step instructions to remediate the misconfiguration "EC2 Reserved Instances Should Not Have Payment Pending" for AWS using the AWS console:

1. Log in to your AWS Management Console.

2. Navigate to the EC2 Dashboard.

3. Click on the "Reserved Instances" option from the left-hand side menu.

4. In the Reserved Instances page, filter the results by selecting "Payment Pending" from the "Payment Status" dropdown.

5. Select the Reserved Instance that has the "Payment Pending" status.

6. Click on the "Actions" button at the top of the page and select "Modify Reserved Instances".

7. In the "Modify Reserved Instances" page, select the correct payment option and click on "Purchase".

8. Once the payment is completed, the Reserved Instance will be available for use.

9. Verify that the Reserved Instance payment status has been updated to "Active" by checking the "Payment Status" column in the Reserved Instances page.

By following these steps, you can remediate the misconfiguration "EC2 Reserved Instances Should Not Have Payment Pending" for AWS using the AWS console.

#### Using CLI

To remediate the misconfiguration of EC2 Reserved Instances having payment pending in AWS using AWS CLI, follow the below steps:

1. Identify the EC2 Reserved Instances that have payment pending by running the following command in AWS CLI:

```
aws ec2 describe-reserved-instances --filters Name=state,Values=payment-pending
```

2. Note down the Reserved Instance ID of the EC2 Reserved Instance that has payment pending.

3. Cancel the payment pending of the EC2 Reserved Instance by running the following command in AWS CLI:

```
aws ec2 cancel-reserved-instances-listings --reserved-instances-id <ReservedInstanceID>
```

Replace `<ReservedInstanceID>` with the Reserved Instance ID noted in Step 2.

4. Verify that the payment pending of the EC2 Reserved Instance has been cancelled by running the following command in AWS CLI:

```
aws ec2 describe-reserved-instances --filters Name=state,Values=payment-pending
```

This should return an empty response indicating that there are no EC2 Reserved Instances with payment pending.

5. Finally, to avoid such misconfigurations in the future, set up billing alerts in AWS to get notified when there are any payment issues with your Reserved Instances.

#### Using Python

To remediate the misconfiguration "EC2 Reserved Instances Should Not Have Payment Pending" in AWS using Python, you can follow these steps:

1. Import the necessary AWS SDK modules in Python. For example, you can use the `boto3` module to interact with AWS services.

```python
import boto3
```

2. Create an EC2 client object using the `boto3.client()` method.

```python
ec2 = boto3.client('ec2')
```

3. Use the `describe_reserved_instances()` method to get a list of all the reserved instances in your account.

```python
reserved_instances = ec2.describe_reserved_instances()
```

4. Iterate through the list of reserved instances and check if any of them have a payment pending status.

```python
for reserved_instance in reserved_instances['ReservedInstances']:
    if reserved_instance['State'] == 'payment-pending':
        # Remediation code goes here
```

5. If you find any reserved instances with a payment pending status, you can use the `modify_reserved_instances()` method to modify the payment option and complete the payment.

```python
ec2.modify_reserved_instances(
    ReservedInstancesIds=[reserved_instance['ReservedInstancesId']],
    ReservedInstancesModification={
        'ModificationType': 'purchase',
        'TargetConfigurations': [
            {
                'InstanceCount': reserved_instance['InstanceCount'],
                'OfferingId': reserved_instance['OfferingId']
            }
        ]
    }
)
```

6. Once the payment is completed, you can verify that the status of the reserved instance has changed to active using the `describe_reserved_instances()` method.

```python
reserved_instances = ec2.describe_reserved_instances(
    ReservedInstancesIds=[reserved_instance['ReservedInstancesId']]
)
if reserved_instances['ReservedInstances'][0]['State'] == 'active':
    print('Reserved instance payment completed successfully.')
else:
    print('Error: Reserved instance payment not completed.')
```

7. Finally, you can wrap the above code in a function and call it periodically to ensure that all reserved instances in your account have a valid payment status.

```python
import boto3

def remediate_reserved_instance_payment_pending():
    ec2 = boto3.client('ec2')
    reserved_instances = ec2.describe_reserved_instances()
    for reserved_instance in reserved_instances['ReservedInstances']:
        if reserved_instance['State'] == 'payment-pending':
            ec2.modify_reserved_instances(
                ReservedInstancesIds=[reserved_instance['ReservedInstancesId']],
                ReservedInstancesModification={
                    'ModificationType': 'purchase',
                    'TargetConfigurations': [
                        {
                            'InstanceCount': reserved_instance['InstanceCount'],
                            'OfferingId': reserved_instance['OfferingId']
                        }
                    ]
                }
            )
            reserved_instances = ec2.describe_reserved_instances(
                ReservedInstancesIds=[reserved_instance['ReservedInstancesId']]
            )
            if reserved_instances['ReservedInstances'][0]['State'] == 'active':
                print('Reserved instance payment completed successfully.')
            else:
                print('Error: Reserved instance payment not completed.')
```

Note: The above code is just an example to remediate the misconfiguration "EC2 Reserved Instances Should Not Have Payment Pending" in AWS using Python. You may need to modify it based on your specific requirements and use case. Also, make sure to test the code in a non-production environment before running it in production.

### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.htmlhttps://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.htmlhttps://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html) 


</Tab>
</Tabs>