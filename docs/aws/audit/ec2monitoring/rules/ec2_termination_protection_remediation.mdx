
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, choose 'Instances'.

3. Select the instance that you want to check.

4. In the 'Description' tab, look for 'Termination protection'. If it is 'Enabled', then termination protection is turned on for the instance. If it is 'Disabled', then termination protection is not turned on.

Please note that you can't enable termination protection for instances that are in a 'Terminating' state.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following command to list all the EC2 instances in your AWS account:

   ```
   aws ec2 describe-instances
   ```

   This command will return a JSON output with details about all your EC2 instances.

3. Check termination protection status: For each instance, you can check the termination protection status by using the following command:

   ```
   aws ec2 describe-instance-attribute --instance-id <instance-id> --attribute disableApiTermination
   ```

   Replace `<instance-id>` with the ID of your EC2 instance. This command will return a JSON output with the termination protection status of the specified instance.

4. Analyze the output: If the `DisableApiTermination` attribute is set to `true`, it means that termination protection is enabled for the instance. If it's set to `false`, it means that termination protection is not enabled. Repeat step 3 for each instance in your AWS account to check the termination protection status of all instances.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways. The simplest way is to install the AWS CLI and then run `aws configure`.

3. Write the Python script: The following Python script uses Boto3 to check if termination protection is enabled for all EC2 instances in a region.

   ```python
   import boto3

   def check_termination_protection():
       ec2 = boto3.client('ec2')
       response = ec2.describe_instances()
       for reservation in response['Reservations']:
           for instance in reservation['Instances']:
               instance_id = instance['InstanceId']
               termination_protection = ec2.describe_instance_attribute(
                   InstanceId=instance_id,
                   Attribute='disableApiTermination'
               )
               if not termination_protection['DisableApiTermination']['Value']:
                   print(f"Instance {instance_id} does not have termination protection enabled.")

   if __name__ == "__main__":
       check_termination_protection()
   ```

4. Run the Python script: You can run the Python script using the Python interpreter. The script will print the IDs of all EC2 instances that do not have termination protection enabled.

   ```bash
   python check_termination_protection.py
   ```

This script only checks for EC2 instances in the default region. If you have EC2 instances in other regions, you need to modify the script to check those regions as well.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the Termination Protection Should Be Enabled misconfiguration in AWS using the AWS console, follow these steps:

1. Login to the AWS Management Console.

2. Navigate to the EC2 Dashboard.

3. Select the instance that you want to enable termination protection for.

4. Click on the "Actions" button and select "Instance Settings".

5. Click on "Change Termination Protection".

6. Select the "Enable" option and click "Save".

7. A confirmation message will appear indicating that the termination protection has been enabled.

8. Repeat steps 3-7 for each instance that needs termination protection enabled.

By following these steps, you will have successfully remediated the Termination Protection Should Be Enabled misconfiguration for your AWS environment.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Termination Protection Should Be Enabled" for an EC2 instance in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to enable termination protection for an EC2 instance:
   
   ```
   aws ec2 modify-instance-attribute --instance-id <instance-id> --no-disable-api-termination
   ```
   Replace `<instance-id>` with the ID of the EC2 instance for which you want to enable termination protection.

3. Verify that the termination protection is enabled for the instance by running the following command:
   
   ```
   aws ec2 describe-instance-attribute --instance-id <instance-id> --attribute disableApiTermination
   ```
   If the output shows `"Value": false`, it means that termination protection is enabled for the instance.

4. Repeat the above steps for all the EC2 instances in your AWS account to ensure that termination protection is enabled for all of them.

Note: Enabling termination protection is a safety measure to prevent accidental termination of instances. However, it should not be used as a substitute for proper backup and disaster recovery planning.
</Accordion>

<Accordion title='Using Python'>
The following steps can be followed to remediate the "Termination Protection Should Be Enabled" misconfiguration in AWS using Python:

1. Import the necessary libraries:

```
import boto3
```

2. Create an EC2 client:

```
ec2 = boto3.client('ec2')
```

3. Get a list of all instances:

```
response = ec2.describe_instances()
instances = []
for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        instances.append(instance['InstanceId'])
```

4. Enable termination protection for each instance:

```
for instance in instances:
    ec2.modify_instance_attribute(InstanceId=instance, DisableApiTermination={'Value': True})
```

This will enable termination protection for all instances in your AWS account.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
