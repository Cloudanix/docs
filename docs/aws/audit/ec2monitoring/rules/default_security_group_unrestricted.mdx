---
slug: default_security_group_unrestricted
title: Default Security Group Should Not Allow Unrestricted Public Traffic
sidebar_label: Default Security Group Should Not Allow Unrestricted Public Traffic
---

### More Info:

Default security groups should restrict all public traffic to follow AWS security best practices.

### Risk Level

Low

### Address

Security

### Compliance Standards

CISAWS, CBP, NIST, SOC2, PCIDSS, GDPR, AWSWAF, NISTCSF, FedRAMP


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the Default Security Group from allowing unrestricted public traffic in EC2 using the AWS Management Console, follow these steps:

1. **Navigate to the EC2 Dashboard:**
   - Open the AWS Management Console.
   - In the Services menu, select "EC2" to go to the EC2 Dashboard.

2. **Access Security Groups:**
   - In the left-hand navigation pane, under "Network & Security," click on "Security Groups."

3. **Select the Default Security Group:**
   - Locate and select the default security group for your VPC. The default security group typically has a name like "default."

4. **Edit Inbound Rules:**
   - With the default security group selected, click on the "Actions" button and choose "Edit inbound rules."
   - Review the existing rules and ensure that no rules allow unrestricted access (i.e., 0.0.0.0/0 for IPv4 or ::/0 for IPv6) for critical ports (e.g., SSH on port 22, RDP on port 3389, HTTP on port 80, HTTPS on port 443).
   - Modify or remove any rules that allow unrestricted public access to ensure that only specific IP addresses or ranges are permitted.

By following these steps, you can prevent the default security group from allowing unrestricted public traffic, thereby enhancing the security of your EC2 instances.
</Accordion>

<Accordion title='Using CLI'>
To prevent the default security group from allowing unrestricted public traffic in EC2 using AWS CLI, follow these steps:

1. **Describe the Default Security Group**:
   First, identify the default security group for your VPC. Use the following command to describe the security groups and find the default one:
   ```sh
   aws ec2 describe-security-groups --filters Name=group-name,Values=default
   ```

2. **Revoke Inbound Rules**:
   Revoke any inbound rules that allow unrestricted access (0.0.0.0/0 for IPv4 or ::/0 for IPv6). For example, to revoke an inbound rule for SSH (port 22) that allows access from any IP:
   ```sh
   aws ec2 revoke-security-group-ingress --group-id <default-security-group-id> --protocol tcp --port 22 --cidr 0.0.0.0/0
   ```

3. **Revoke Outbound Rules**:
   Similarly, revoke any outbound rules that allow unrestricted access. For example, to revoke an outbound rule for HTTP (port 80) that allows access to any IP:
   ```sh
   aws ec2 revoke-security-group-egress --group-id <default-security-group-id> --protocol tcp --port 80 --cidr 0.0.0.0/0
   ```

4. **Create Specific Rules**:
   Add more restrictive rules to the default security group as needed. For example, to allow SSH access only from a specific IP address (e.g., 192.168.1.1):
   ```sh
   aws ec2 authorize-security-group-ingress --group-id <default-security-group-id> --protocol tcp --port 22 --cidr 192.168.1.1/32
   ```

By following these steps, you can ensure that the default security group does not allow unrestricted public traffic.
</Accordion>

<Accordion title='Using Python'>
To prevent the default security group in Amazon EC2 from allowing unrestricted public traffic using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. You can install it using pip if you haven't already:
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 EC2 client to interact with the EC2 service.
   ```python
   import boto3

   ec2 = boto3.client('ec2')
   ```

3. **Describe Default Security Group**:
   Retrieve the default security group for your VPC. You need to identify the default security group by filtering based on the `GroupName` and `VpcId`.
   ```python
   def get_default_security_group(vpc_id):
       response = ec2.describe_security_groups(
           Filters=[
               {'Name': 'group-name', 'Values': ['default']},
               {'Name': 'vpc-id', 'Values': [vpc_id]}
           ]
       )
       return response['SecurityGroups'][0] if response['SecurityGroups'] else None
   ```

4. **Revoke Unrestricted Ingress Rules**:
   Revoke any ingress rules that allow unrestricted access (i.e., `0.0.0.0/0` for IPv4 or `::/0` for IPv6).
   ```python
   def revoke_unrestricted_ingress_rules(security_group_id):
       response = ec2.describe_security_group_rules(
           Filters=[
               {'Name': 'group-id', 'Values': [security_group_id]}
           ]
       )
       for rule in response['SecurityGroupRules']:
           if rule['IsEgress'] is False:
               if 'CidrIpv4' in rule and rule['CidrIpv4'] == '0.0.0.0/0':
                   ec2.revoke_security_group_ingress(
                       GroupId=security_group_id,
                       IpPermissions=[
                           {
                               'IpProtocol': rule['IpProtocol'],
                               'FromPort': rule['FromPort'],
                               'ToPort': rule['ToPort'],
                               'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
                           }
                       ]
                   )
               elif 'CidrIpv6' in rule and rule['CidrIpv6'] == '::/0':
                   ec2.revoke_security_group_ingress(
                       GroupId=security_group_id,
                       IpPermissions=[
                           {
                               'IpProtocol': rule['IpProtocol'],
                               'FromPort': rule['FromPort'],
                               'ToPort': rule['ToPort'],
                               'Ipv6Ranges': [{'CidrIpv6': '::/0'}]
                           }
                       ]
                   )

# Example usage
vpc_id = 'your-vpc-id'  # Replace with your VPC ID
default_sg = get_default_security_group(vpc_id)
if default_sg:
    revoke_unrestricted_ingress_rules(default_sg['GroupId'])
```

This script will ensure that the default security group does not allow unrestricted public traffic by revoking any ingress rules that permit access from `0.0.0.0/0` or `::/0`.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, look for the default security group of your VPC. The name column will have the value 'default' for the default security group.
4. Click on the default security group to view its details. In the "Inbound rules" tab, check if it allows unrestricted public traffic (0.0.0.0/0). If it does, then it is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the security groups: Use the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups --query `SecurityGroups[*].{Name:GroupName,ID:GroupId}`
   ```
   This command will return a list of all security groups along with their names and IDs.

3. Check the inbound rules for each security group: For each security group, you need to check the inbound rules to see if they allow unrestricted public traffic. You can do this by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids `<security-group-id>` --query `SecurityGroups[*].IpPermissions[*]`
   ```
   Replace `<security-group-id>` with the ID of the security group you want to check. This command will return a list of all inbound rules for the specified security group.

4. Check for unrestricted public traffic: In the output of the previous command, look for rules that have `IpRanges` set to `0.0.0.0/0`. This indicates that the rule allows unrestricted public traffic. If you find any such rule, it means that the security group is misconfigured.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways. The easiest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then input your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

3. Write the Python script: The following Python script uses Boto3 to check if the default security group allows unrestricted public traffic:

   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   def check_security_group():
       for security_group in ec2.security_groups.all():
           if security_group.group_name == 'default':
               for permission in security_group.ip_permissions:
                   for ip_range in permission['IpRanges']:
                       if ip_range['CidrIp'] == '0.0.0.0/0':
                           print(f"Security Group {security_group.id} allows unrestricted public traffic.")
                           return
       print("No unrestricted public traffic found in default security group.")

   check_security_group()
   ```

4. Run the Python script: Save the script to a file, for example, check_security_group.py, and then run it using Python:

   ```bash
   python check_security_group.py
   ```

   The script will print a message if it finds that the default security group allows unrestricted public traffic. If it doesn't find any such security group, it will print a message saying "No unrestricted public traffic found in default security group."
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using the AWS console, follow the steps below:

1. Log in to the AWS Management Console.

2. Navigate to the EC2 service.

3. In the left-hand menu, click on "Security Groups".

4. Select the default security group.

5. In the "Inbound Rules" tab, remove any rules that allow unrestricted public traffic (i.e. 0.0.0.0/0).

6. Add specific rules for the required ports and protocols to allow traffic only from authorized sources.

7. Review and save the changes.

By following these steps, you will remediate the misconfiguration and ensure that the default security group does not allow unrestricted public traffic.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the ID of the default security group in your AWS account:

   ```
   aws ec2 describe-security-groups --filters Name=group-name,Values=default --query 'SecurityGroups[*].GroupId' --output text
   ```

3. Run the following command to update the inbound rules of the default security group to allow only necessary traffic:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol all --port all --cidr 0.0.0.0/0
   ```

   This command will remove all the inbound rules that allow unrestricted public traffic.

4. Now, add the necessary inbound rules to the default security group using the following command:

   ```
   aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol tcp --port <port-number> --cidr <ip-address>
   ```

   Replace `<port-number>` with the port number you want to allow traffic for and `<ip-address>` with the IP address range you want to allow traffic from.

5. Repeat step 4 for all the necessary inbound rules.

6. Verify the updated inbound rules of the default security group using the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   This command will display the updated inbound rules for the default security group.

By following the above steps, you can remediate the misconfiguration "Default Security Group Should Not Allow Unrestricted Public Traffic" for AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of default security group allowing unrestricted public traffic in AWS using Python, you can follow these steps:

1. Import the necessary AWS SDK libraries and modules in Python.

```
import boto3
```

2. Create a connection to the AWS EC2 service using the boto3 library.

```
ec2 = boto3.client('ec2')
```

3. Get the default security group ID using the describe_security_groups() method.

```
response = ec2.describe_security_groups(GroupNames=['default'])
sg_id = response['SecurityGroups'][0]['GroupId']
```

4. Revoke the ingress rules that allow unrestricted public traffic using the revoke_security_group_ingress() method.

```
response = ec2.revoke_security_group_ingress(
    GroupId=sg_id,
    IpPermissions=[
        {
            'IpProtocol': '-1',
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)
```

5. Confirm that the ingress rules have been revoked by describing the security group again.

```
response = ec2.describe_security_groups(GroupNames=['default'])
print(response)
```

This should remediate the misconfiguration of default security group allowing unrestricted public traffic in AWS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html) 

