---
slug: unused_ami
title: Unused AMIs Should Be Removed
sidebar_label: Unused AMIs Should Be Removed
---

### More Info:

Unused AMIs should be removed to follow best practices.

### Risk Level

Informational

### Address

Cost Optimisation

### Compliance Standards

AWSWAF




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under IMAGES, click AMIs. This will display a list of all available AMIs.
3. Check the 'Launch Time' column for each AMI. If an AMI hasn't been used for a long time, it may be unused.
4. To confirm if an AMI is unused, try to find any EC2 instances that are using the AMI. You can do this by going to the 'Instances' section in the EC2 dashboard, and checking the 'AMI ID' column for each instance. If the AMI ID doesn't match with any of the instances, it means the AMI is unused.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all AMIs: Once your AWS CLI is set up, you can list all the AMIs associated with your account by running the following command:

   ```
   aws ec2 describe-images --owners self
   ```

   This command will return a JSON object containing details about all your AMIs.

3. Check for unused AMIs: To check for unused AMIs, you need to compare the list of AMIs with the list of instances currently running in your account. You can get the list of instances by running the following command:

   ```
   aws ec2 describe-instances
   ```

   This command will return a JSON object containing details about all your instances. You need to check if the 'ImageId' of each instance matches with the 'ImageId' of any AMI. If an AMI's 'ImageId' does not match with the 'ImageId' of any instance, it means that the AMI is unused.

4. Filter unused AMIs: To make the process easier, you can use a Python script to filter out the unused AMIs. The script will take the list of AMIs and the list of instances as input, compare the 'ImageId' of each AMI with the 'ImageId' of each instance, and return a list of unused AMIs. Here is a simple Python script that does this:

   ```python
   import json

   # Load the list of AMIs and instances
   with open('amis.json') as f:
       amis = json.load(f)
   with open('instances.json') as f:
       instances = json.load(f)

   # Get the list of AMI IDs
   ami_ids = [ami['ImageId'] for ami in amis['Images']]

   # Get the list of instance IDs
   instance_ids = [instance['Instances'][0]['ImageId'] for instance in instances['Reservations']]

   # Find the unused AMIs
   unused_amis = [ami_id for ami_id in ami_ids if ami_id not in instance_ids]

   print('Unused AMIs:', unused_amis)
   ```

   You need to replace 'amis.json' and 'instances.json' with the actual paths to your AMI and instance JSON files.

#### Using Python

1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can set your credentials for use by boto3 in several ways, but the simplest is to use the AWS CLI. Run `aws configure` and then enter your access key, secret access key, and default region when prompted.

3. Write the Python script: The following Python script uses the boto3 library to connect to the EC2 service, retrieve a list of all AMIs, and then check if they are in use. If an AMI is not in use, it will be printed out.

   ```python
   import boto3

   def get_all_amis():
       ec2 = boto3.resource('ec2')
       amis = ec2.images.filter(Owners=['self'])
       return amis

   def check_unused_amis(amis):
       ec2 = boto3.resource('ec2')
       instances = ec2.instances.all()
       used_amis = set(instance.image_id for instance in instances)
       unused_amis = [ami for ami in amis if ami.id not in used_amis]
       return unused_amis

   def main():
       amis = get_all_amis()
       unused_amis = check_unused_amis(amis)
       for ami in unused_amis:
           print(f"Unused AMI: {ami.id}")

   if __name__ == "__main__":
       main()
   ```

4. Run the script: Save the script to a file, for example, `check_unused_amis.py`, and then run it using Python:

   ```bash
   python check_unused_amis.py
   ```

   The script will print out the IDs of all unused AMIs. If no unused AMIs are found, it will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step by step instructions to remediate the unused AMIs issue in AWS using AWS console:

1. Login to your AWS console.
2. Go to the EC2 dashboard.
3. Click on the "AMIs" option from the left-hand menu.
4. Sort the AMIs by the "Creation Date" column to identify the oldest and unused AMIs.
5. Select the unused AMIs that you want to remove.
6. Click on the "Actions" button and select "Deregister" from the dropdown menu.
7. Confirm the deregistration by clicking on the "Deregister" button in the confirmation window.
8. Once the AMI is deregistered, you can delete the associated EBS snapshots by selecting the AMI and clicking on the "Snapshots" tab.
9. Select the associated EBS snapshot(s) and click on the "Actions" button.
10. From the dropdown menu, select "Delete" and confirm the deletion.

By following these steps, you can remediate the unused AMIs issue in AWS and ensure that your cloud resources are optimized for cost and efficiency.

#### Using CLI

To remediate the misconfiguration of unused AMIs in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI in your terminal or command prompt.

2. List all the AMIs that are not in use by running the following command:

```
aws ec2 describe-images --owners self --filters "Name=state,Values=available" "Name=tag-key,Values=Name" --query 'Images[*].{ID:ImageId,Name:Tags[0].Value}'
```
This command will list all the AMIs that are not in use and have a Name tag.

3. Identify the AMIs that are not required anymore and make a note of their IDs.

4. Deregister the unused AMIs by running the following command:

```
aws ec2 deregister-image --image-id <AMI-ID>
```
Replace `<AMI-ID>` with the actual ID of the unused AMI.

5. Verify that the AMI has been deregistered by running the following command:

```
aws ec2 describe-images --image-ids <AMI-ID>
```
Replace `<AMI-ID>` with the actual ID of the unused AMI. If the command returns an error stating that the AMI does not exist, then it has been successfully deregistered.

By following the above steps, you can remediate the misconfiguration of unused AMIs in AWS using AWS CLI.

#### Using Python

To remediate the unused AMIs misconfiguration in AWS using Python, you can follow these steps:

1. Install the Boto3 library for Python using pip: `pip install boto3`

2. Create an AWS session using the `boto3.Session()` method.

3. Use the `ec2` resource in Boto3 to get a list of all the AMIs currently available in your AWS account. You can use the `filter()` method to filter out only the unused AMIs by checking their `state` attribute. For example:

```python
import boto3

session = boto3.Session()

ec2 = session.resource('ec2')
unused_amis = []

for ami in ec2.images.filter(Owners=['self']):
    if ami.state == 'available' and len(ami.block_device_mappings) == 0:
        unused_amis.append(ami.id)
```

4. Once you have the list of unused AMIs, you can use the `deregister_image()` method to remove them from your AWS account. For example:

```python
for ami_id in unused_amis:
    ami = ec2.Image(ami_id)
    ami.deregister()
```

This will deregister all the unused AMIs in your AWS account. Make sure to test this code in a non-production environment before running it in a production environment.


### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/deregister-ami.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/deregister-ami.html) 


</Tab>
</Tabs>