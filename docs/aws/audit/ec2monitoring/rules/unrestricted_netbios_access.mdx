---
slug: unrestricted_netbios_access
title: Unrestricted Netbios Access Should Not Be Allowed
sidebar_label: Unrestricted Netbios Access Should Not Be Allowed
---

### More Info:

No AWS EC2 security group should allow unrestricted inbound access to TCP port 139 and UDP ports 137 and 138 (NetBIOS).

### Risk Level

High

### Address

Security

### Compliance Standards

HIPAA, NIST, SOC2, GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. This will show you all the inbound rules associated with the selected security group.
5. Check if there are any rules that allow unrestricted access (0.0.0.0/0) to the NetBIOS ports (TCP/UDP 137-139, TCP 445). If such rules exist, then NetBIOS access is not properly restricted.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all security groups: Use the following command to list all the security groups in your AWS account. This will return a JSON object with details about each security group.

   ```
   aws ec2 describe-security-groups
   ```

3. Filter for rules allowing unrestricted NetBIOS access: NetBIOS uses TCP/UDP ports 137, 138, and 139. So, you need to check if any security group has rules that allow inbound traffic on these ports from any source (0.0.0.0/0 or ::/0). You can do this by parsing the output of the previous command with a tool like `jq`:

   ```
   aws ec2 describe-security-groups | jq '.SecurityGroups[] | select(.IpPermissions[] | select((.FromPort==137 and .ToPort==139) and (.IpRanges[].CidrIp=="0.0.0.0/0" or .Ipv6Ranges[].CidrIpv6=="::/0")))'
   ```

4. Review the output: If the previous command returns any security groups, those are misconfigured to allow unrestricted NetBIOS access. The output will include the security group ID, name, and other details. If the command doesn't return anything, then there are no security groups allowing unrestricted NetBIOS access.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the Boto3 library in Python which is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python.

```python
pip install boto3
```

2. Configure your AWS credentials: You need to configure your AWS credentials. You can do this by using the AWS CLI and configuring it with your Access Key ID and Secret Access Key.

```bash
aws configure
```

3. Create a Python script to check for unrestricted NetBIOS access: The following Python script uses Boto3 to interact with the AWS EC2 service. It retrieves all security groups and checks if they have unrestricted access (0.0.0.0/0) to NetBIOS (ports 137-139 and 445).

```python
import boto3

def check_unrestricted_netbios_access():
    ec2 = boto3.resource('ec2')
    security_groups = ec2.security_groups.all()

    for group in security_groups:
        for permission in group.ip_permissions:
            for range in permission['IpRanges']:
                if range['CidrIp'] == '0.0.0.0/0' and permission['FromPort'] in [137, 138, 139, 445] and permission['ToPort'] in [137, 138, 139, 445]:
                    print(f"Security Group {group.id} has unrestricted NetBIOS access.")

check_unrestricted_netbios_access()
```

4. Run the Python script: You can run the Python script using any Python environment. If the script prints any security group IDs, those groups have unrestricted NetBIOS access.

```bash
python check_netbios.py
```

This script will print out the IDs of any security groups that have unrestricted NetBIOS access. If no output is produced, then no such security groups were found.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Unrestricted Netbios Access Should Not Be Allowed" misconfiguration in AWS using the AWS console, you can follow these steps:

1. Log in to your AWS Management Console.
2. Go to the Amazon VPC dashboard.
3. Click on "Security Groups" from the left-hand menu.
4. Select the security group that has unrestricted NetBIOS access.
5. Click on the "Inbound Rules" tab.
6. Locate the rule that allows unrestricted NetBIOS access (usually port 137-139).
7. Click on the "Edit" button next to the rule.
8. Change the source IP address to a specific IP address or range of IP addresses that should be allowed to access NetBIOS.
9. Click on the "Save" button to save the changes.

By following these steps, you have successfully remediated the "Unrestricted Netbios Access Should Not Be Allowed" misconfiguration in AWS.

#### Using CLI

To remediate the unrestricted NetBIOS access issue in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI and run the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups
   ```

2. Identify the security group that has unrestricted NetBIOS access.

3. Run the following command to revoke the inbound rule that allows unrestricted NetBIOS access:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 139 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you identified in step 2.

4. Run the following command to revoke the inbound rule that allows unrestricted NetBIOS access:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 445 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you identified in step 2.

5. Verify that the inbound rules have been revoked by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you identified in step 2.

6. Repeat steps 3-5 for all the security groups in your AWS account that have unrestricted NetBIOS access.

7. Once you have revoked the inbound rules for all the security groups, the unrestricted NetBIOS access issue will be remediated.

#### Using Python

To remediate the "Unrestricted Netbios Access Should Not Be Allowed" misconfiguration for AWS using python, you can follow these steps:

1. Import the necessary AWS SDK and modules in your python script.
```
import boto3
from botocore.exceptions import ClientError
```

2. Create an AWS client for EC2 service.
```
ec2 = boto3.client('ec2')
```

3. Get a list of all the security groups in your AWS account.
```
response = ec2.describe_security_groups()
security_groups = response['SecurityGroups']
```

4. Loop through each security group and check if it has unrestricted NetBIOS access. To do this, check if any of the inbound rules of the security group has the protocol set to "UDP" or "TCP", the port range set to "137-139", and the source IP range set to "0.0.0.0/0" or "::/0".
```
for sg in security_groups:
    for rule in sg['IpPermissions']:
        if rule['IpProtocol'] in ['tcp', 'udp'] and rule['FromPort'] <= 139 and rule['ToPort'] >= 137:
            for ip_range in rule['IpRanges']:
                if ip_range['CidrIp'] in ['0.0.0.0/0', '::/0']:
                    print(f"Security group {sg['GroupId']} allows unrestricted NetBIOS access.")
```

5. If you find any security group that has unrestricted NetBIOS access, remove the offending inbound rule from the security group using the revoke_security_group_ingress() method of the AWS EC2 client. You will need to provide the security group ID, the protocol, the port range, and the source IP range of the offending rule as parameters to this method.
```
try:
    ec2.revoke_security_group_ingress(
        GroupId=sg['GroupId'],
        IpPermissions=[
            {
                'IpProtocol': rule['IpProtocol'],
                'FromPort': rule['FromPort'],
                'ToPort': rule['ToPort'],
                'IpRanges': [
                    {
                        'CidrIp': ip_range['CidrIp']
                    }
                ]
            }
        ]
    )
    print(f"Removed unrestricted NetBIOS access from security group {sg['GroupId']}.")
except ClientError as e:
    print(f"Error removing unrestricted NetBIOS access from security group {sg['GroupId']}: {e}")
```

6. After removing the offending rule, you can verify that the security group no longer allows unrestricted NetBIOS access by repeating step 4.

Note: Make sure you have the necessary permissions to modify security groups in your AWS account.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html) 
- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html) 
- [https://docs.aws.amazon.com/cli/latest/reference/ec2/authorize-security-group-ingress.html](https://docs.aws.amazon.com/cli/latest/reference/ec2/authorize-security-group-ingress.html) 


</Tab>
</Tabs>