---
slug: unrestricted_mssql_access
title: Unrestricted MsSQL Access Should Not Be Allowed
sidebar_label: Unrestricted MsSQL Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted inbound access to TCP port 1433 (MSSQL)

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, HITRUST, NISTCSF, PCIDSS, FedRAMP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, select 'Security Groups' under the 'Network & Security' section.
3. In the 'Security Groups' page, select each security group one by one and check the 'Inbound' rules.
4. Look for any rules that allow unrestricted access (0.0.0.0/0) to MsSQL port (default is 1433). If such a rule exists, it indicates that unrestricted MsSQL access is allowed, which is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all EC2 instances: Use the following command to list all EC2 instances in your AWS account:

   ```
   aws ec2 describe-instances
   ```
   This command will return a JSON output with details about all your EC2 instances.

3. Check security groups: For each EC2 instance, check the associated security groups. You can do this by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```
   Replace `<security-group-id>` with the ID of the security group you want to check. This command will return a JSON output with details about the specified security group.

4. Check for unrestricted MsSQL access: In the JSON output from the previous step, look for the `IpPermissions` field. This field contains a list of IP ranges that are allowed to access the EC2 instance. If you find an IP range that is set to `0.0.0.0/0` and the `FromPort` is 1433 (the default port for MsSQL), this means that MsSQL access is unrestricted.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Set up AWS credentials: You can configure your AWS credentials in several ways, but the simplest is to use the AWS CLI:

```bash
aws configure
```

3. Write a Python script to list all EC2 instances and their security groups: 

```python
import boto3

def list_instances():
    ec2 = boto3.resource('ec2')
    instances = ec2.instances.all()
    for instance in instances:
        print("Instance ID: ", instance.id)
        print("Security Groups: ", instance.security_groups)

list_instances()
```

4. Write a Python script to check for unrestricted MsSQL access:

```python
import boto3

def check_unrestricted_access():
    ec2 = boto3.client('ec2')
    response = ec2.describe_security_groups()
    for security_group in response['SecurityGroups']:
        for permission in security_group['IpPermissions']:
            for range in permission['IpRanges']:
                if '0.0.0.0/0' in range['CidrIp']:
                    if permission['FromPort'] == 1433 and permission['ToPort'] == 1433:
                        print("Unrestricted MsSQL access detected in Security Group: ", security_group['GroupId'])

check_unrestricted_access()
```

This script checks all security groups for rules that allow unrestricted access (0.0.0.0/0) to the MsSQL port (1433). If it finds any, it prints out the ID of the security group.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the unrestricted MsSQL access in AWS, you can follow the below steps:

1. Login to the AWS Management Console.

2. Go to the RDS dashboard.

3. Select the RDS instance that has unrestricted MsSQL access.

4. Click on the "Modify" button.

5. Scroll down to the "Network & Security" section.

6. Under the "Security Group Rules" section, click on the "Edit" button.

7. Remove the rule that allows unrestricted MsSQL access.

8. Add a new rule that allows MsSQL access only from specific IP addresses or CIDR ranges.

9. Click on the "Save Changes" button.

10. Wait for the changes to be applied to the RDS instance.

By following the above steps, you have successfully remediated the unrestricted MsSQL access issue in AWS.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the unrestricted MsSQL access issue in AWS using AWS CLI, you can follow these steps:

1. Open the AWS CLI and run the following command to list all the security groups in your AWS account:

   `aws ec2 describe-security-groups`

2. Identify the security group that has unrestricted MsSQL access. You can identify the security group by looking at the inbound rules.

3. Once you have identified the security group, run the following command to revoke the inbound rule that allows unrestricted MsSQL access:

   `aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 1433 --cidr 0.0.0.0/0`

   Replace `<security-group-id>` with the ID of the security group that you identified in step 2.

4. Verify that the inbound rule has been revoked by running the following command:

   `aws ec2 describe-security-groups --group-ids <security-group-id>`

   Replace `<security-group-id>` with the ID of the security group that you identified in step 2.

5. Once you have verified that the inbound rule has been revoked, you have successfully remediated the unrestricted MsSQL access issue in AWS.
</Accordion>

<Accordion title='Using Python'>
To remediate this misconfiguration in AWS using Python, you can follow the below steps:

1. Identify the security group associated with the MS SQL Server instance.

2. Get the IP address of the client machine from where the MS SQL Server connection is initiated.

3. Create a new security group rule that allows incoming traffic from the client machine IP address to the MS SQL Server instance on port 1433.

4. Remove the existing security group rule that allows unrestricted access to the MS SQL Server instance.

Here's the Python code to remediate this misconfiguration:

```python
import boto3

# Specify the region where the MS SQL Server instance is located
region_name = 'us-west-2'

# Specify the name of the security group associated with the MS SQL Server instance
security_group_name = 'ms-sql-sg'

# Specify the IP address of the client machine from where the MS SQL Server connection is initiated
client_ip_address = '10.0.0.1/32'

# Create a new security group rule that allows incoming traffic from the client machine IP address to the MS SQL Server instance on port 1433
ec2 = boto3.client('ec2', region_name=region_name)
response = ec2.authorize_security_group_ingress(
    GroupName=security_group_name,
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 1433,
            'ToPort': 1433,
            'IpRanges': [
                {
                    'CidrIp': client_ip_address,
                    'Description': 'Allow MS SQL Server access from client IP address'
                },
            ],
        },
    ],
)

# Remove the existing security group rule that allows unrestricted access to the MS SQL Server instance
response = ec2.revoke_security_group_ingress(
    GroupName=security_group_name,
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 1433,
            'ToPort': 1433,
            'IpRanges': [
                {
                    'CidrIp': '0.0.0.0/0',
                },
            ],
        },
    ],
)
```

Note: Replace the `region_name`, `security_group_name`, and `client_ip_address` variables with the appropriate values for your environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 

