---
slug: unrestricted_ftp_access
title: Unrestricted FTP Access Should Not Be Allowed
sidebar_label: Unrestricted FTP Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted inbound access to TCP ports 20 and 21 (FTP).

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, GDPR, SOC2, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, select 'Security Groups' under the 'Network & Security' section.
3. In the 'Security Groups' page, you will see a list of all security groups associated with your EC2 instances. Select the security group you want to inspect.
4. In the 'Inbound rules' tab, check for any rules that allow unrestricted FTP access (port 20 or 21) from any source (0.0.0.0/0 or ::/0). If such a rule exists, it indicates that unrestricted FTP access is allowed.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all security groups: The first step to detect unrestricted FTP access is to list all the security groups in your AWS account. You can do this by running the following command: `aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text`

3. Check security group rules: For each security group, you need to check the inbound rules to see if any of them allow unrestricted FTP access. FTP uses port 21, so you need to look for rules that allow traffic on this port. You can do this by running the following command for each security group: `aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions[*].{FromPort:FromPort,ToPort:ToPort,IpRanges:IpRanges[*].CidrIp}" --output text`

4. Analyze the output: If the output of the above command includes a rule that allows traffic from 0.0.0.0/0 (which means all IP addresses) on port 21, then unrestricted FTP access is allowed. If not, then unrestricted FTP access is not allowed.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to list all security groups and their rules:
   You can use the `describe_security_groups` function to get a list of all security groups and their rules. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for group in response['SecurityGroups']:
       for permission in group['IpPermissions']:
           if permission['IpProtocol'] == 'tcp' and 'FromPort' in permission and 'ToPort' in permission:
               if permission['FromPort'] <= 20 and permission['ToPort'] >= 21:
                   for range in permission['IpRanges']:
                       if range['CidrIp'] == '0.0.0.0/0':
                           print(f"Security Group {group['GroupId']} allows unrestricted FTP access")
   ```
   This script will print the ID of any security group that allows unrestricted FTP access.

3. Interpret the results:
   If the script prints any security group IDs, those security groups allow unrestricted FTP access. If the script does not print anything, no security groups allow unrestricted FTP access.

4. Regularly run the script:
   Misconfigurations can happen at any time, so it's important to regularly check for them. You could run this script as a cron job, or use AWS Lambda to run it on a schedule.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the unrestricted FTP access issue in AWS, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 dashboard.
3. Select the EC2 instance(s) that have unrestricted FTP access.
4. Click on the "Security Groups" tab at the bottom of the page.
5. Identify the security group that is associated with the instance(s) and click on it.
6. Click on the "Inbound Rules" tab.
7. Locate the rule that allows unrestricted FTP access (port 21) and select it.
8. Click on the "Delete" button to remove the rule.
9. Click on the "Save" button to apply the changes.

Once you have completed these steps, the unrestricted FTP access issue will be remediated for the selected EC2 instance(s).

#### Using CLI

To remediate the unrestricted FTP access issue in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the security groups in your AWS account:
```
aws ec2 describe-security-groups
```

3. Identify the security group that has unrestricted FTP access.

4. Run the following command to remove the unrestricted FTP access from the identified security group:
```
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 21 --cidr 0.0.0.0/0
```
Note: Replace `<security-group-id>` with the actual ID of the security group that needs to be updated.

5. Verify that the FTP access has been removed by running the following command:
```
aws ec2 describe-security-groups --group-ids <security-group-id>
```
Note: Replace `<security-group-id>` with the actual ID of the security group that was updated.

6. Repeat the above steps for all the security groups in your AWS account to ensure that unrestricted FTP access is not allowed in any of them.

By following the above steps, you can remediate the unrestricted FTP access issue in AWS using AWS CLI.

#### Using Python

To remediate unrestricted FTP access in AWS, you can use the following steps in Python:

Step 1: Identify the Security Group with unrestricted FTP access
```
import boto3
aws_account_id = 'YOUR_AWS_ACCOUNT_ID'
region = 'YOUR_AWS_REGION'
ec2 = boto3.client('ec2', region_name=region)
response = ec2.describe_security_groups()
for sg in response['SecurityGroups']:
    for ip_permission in sg['IpPermissions']:
        if 'FromPort' in ip_permission and ip_permission['FromPort'] == 21 and 'IpRanges' in ip_permission:
            for ip_range in ip_permission['IpRanges']:
                if ip_range['CidrIp'] == '0.0.0.0/0':
                    print('Security Group ID: ', sg['GroupId'])
```
This code will list all the security groups that have unrestricted FTP access.

Step 2: Update the Security Group to restrict FTP access
```
import boto3
aws_account_id = 'YOUR_AWS_ACCOUNT_ID'
region = 'YOUR_AWS_REGION'
ec2 = boto3.client('ec2', region_name=region)
security_group_id = 'YOUR_SECURITY_GROUP_ID'
response = ec2.revoke_security_group_ingress(
    GroupId=security_group_id,
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 21,
            'ToPort': 21,
            'IpRanges': [
                {
                    'CidrIp': '0.0.0.0/0'
                },
            ],
        },
    ],
)
```
This code will restrict FTP access to the specified security group.

Step 3: Verify that FTP access is restricted
```
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.settimeout(5)
try:
    s.connect(('FTP_SERVER_IP', 21))
    print('FTP access is still unrestricted')
except:
    print('FTP access is restricted')
s.close()
```
This code will verify that FTP access is restricted by attempting to connect to the FTP server. If the connection fails, it means that FTP access is restricted.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 


</Tab>
</Tabs>