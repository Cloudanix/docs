---
slug: efs_resources_protected_by_backup_plan
title: Elastic File System Should Have Backup Plan 
sidebar_label: Elastic File System Should Have Backup Plan 
---

### More Info:

This rule checks if Amazon Elastic File System (Amazon EFS) File Systems are protected by a backup plan. The rule is NON_COMPLIANT if the EFS File System is not covered by a backup plan.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP,SEBI


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of an Elastic File System (EFS) not having a backup plan in EC2 using the AWS Management Console, follow these steps:

1. **Enable EFS Backup:**
   - Navigate to the **Amazon EFS** service in the AWS Management Console.
   - Select the EFS file system you want to configure.
   - Go to the **Backup** tab.
   - Click on **Enable automatic backups** to ensure that your EFS file system is automatically backed up using AWS Backup.

2. **Configure AWS Backup Plan:**
   - Navigate to the **AWS Backup** service in the AWS Management Console.
   - Click on **Create backup plan**.
   - Define the backup plan by specifying the backup frequency, retention period, and other settings.
   - Assign the EFS file system to this backup plan by creating a resource assignment.

3. **Set Backup Policies:**
   - In the AWS Backup console, go to **Backup policies**.
   - Create or modify a backup policy to include EFS file systems.
   - Ensure that the policy is applied to the appropriate organizational units or accounts to enforce backup requirements.

4. **Monitor Backup Compliance:**
   - Use the **AWS Backup Dashboard** to monitor the compliance status of your backup plans.
   - Set up **AWS CloudWatch Alarms** to notify you of any backup failures or issues.
   - Regularly review the backup reports to ensure that all EFS file systems are being backed up as per the defined policies.

By following these steps, you can ensure that your Elastic File System in EC2 has a robust backup plan in place, thereby preventing misconfigurations related to backups.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where an Elastic File System (EFS) should have a backup plan in EC2 using AWS CLI, you can follow these steps:

1. **Create a Backup Plan:**
   First, create a backup plan that specifies the backup rules and schedules. You can use the `aws backup create-backup-plan` command to create a backup plan.

   ```sh
   aws backup create-backup-plan --backup-plan '{
       "BackupPlanName": "MyEFSBackupPlan",
       "Rules": [
           {
               "RuleName": "DailyBackup",
               "TargetBackupVaultName": "Default",
               "ScheduleExpression": "cron(0 12 * * ? *)",
               "StartWindowMinutes": 60,
               "CompletionWindowMinutes": 180,
               "Lifecycle": {
                   "MoveToColdStorageAfterDays": 30,
                   "DeleteAfterDays": 365
               }
           }
       ]
   }'
   ```

2. **Assign Resources to the Backup Plan:**
   Assign the EFS file system to the backup plan using the `aws backup create-backup-selection` command. You need the Backup Plan ID and the Resource ARN of the EFS file system.

   ```sh
   aws backup create-backup-selection --backup-plan-id <BackupPlanId> --backup-selection '{
       "SelectionName": "MyEFSBackupSelection",
       "IamRoleArn": "arn:aws:iam::123456789012:role/service-role/AWSBackupDefaultServiceRole",
       "Resources": [
           "arn:aws:elasticfilesystem:us-west-2:123456789012:file-system/fs-12345678"
       ]
   }'
   ```

3. **Verify Backup Plan and Selection:**
   Verify that the backup plan and selection have been created correctly using the `aws backup list-backup-plans` and `aws backup list-backup-selections` commands.

   ```sh
   aws backup list-backup-plans
   aws backup list-backup-selections --backup-plan-id <BackupPlanId>
   ```

4. **Enable EFS Backup:**
   Ensure that the EFS file system has backup enabled by checking its lifecycle policies. You can use the `aws efs describe-file-systems` command to verify the backup status.

   ```sh
   aws efs describe-file-systems --file-system-id fs-12345678
   ```

By following these steps, you can ensure that your Elastic File System (EFS) in EC2 has a backup plan configured using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of an Elastic File System (EFS) not having a backup plan in AWS EC2 using Python scripts, you can follow these steps:

### 1. **Install and Configure AWS SDK (Boto3)**
First, ensure you have the AWS SDK for Python (Boto3) installed and configured. You can install it using pip:

```bash
pip install boto3
```

Then, configure your AWS credentials:

```bash
aws configure
```

### 2. **Create a Python Script to Enable EFS Backup**
Write a Python script to enable automatic backups for your EFS. This script will use the Boto3 library to interact with AWS services.

```python
import boto3

# Initialize the EFS client
efs_client = boto3.client('efs')

# Function to enable backup for a given EFS file system
def enable_efs_backup(file_system_id):
    try:
        response = efs_client.put_backup_policy(
            FileSystemId=file_system_id,
            BackupPolicy={
                'Status': 'ENABLED'
            }
        )
        print(f"Backup policy enabled for EFS: {file_system_id}")
    except Exception as e:
        print(f"Error enabling backup policy for EFS: {file_system_id}, Error: {str(e)}")

# Example usage
file_system_id = 'fs-12345678'  # Replace with your EFS file system ID
enable_efs_backup(file_system_id)
```

### 3. **Automate the Script Execution**
To ensure that all new EFS file systems have backups enabled, you can automate the execution of this script. One way to do this is by using AWS Lambda and CloudWatch Events to trigger the script whenever a new EFS is created.

### 4. **Monitor and Verify Backup Policies**
Create a monitoring script to periodically check that all EFS file systems have backup policies enabled. This script can be scheduled using a cron job or AWS Lambda with CloudWatch Events.

```python
import boto3

# Initialize the EFS client
efs_client = boto3.client('efs')

# Function to check backup policy for all EFS file systems
def check_efs_backup_policies():
    try:
        response = efs_client.describe_file_systems()
        for file_system in response['FileSystems']:
            file_system_id = file_system['FileSystemId']
            backup_policy = efs_client.describe_backup_policy(FileSystemId=file_system_id)
            if backup_policy['BackupPolicy']['Status'] != 'ENABLED':
                print(f"Backup policy not enabled for EFS: {file_system_id}")
            else:
                print(f"Backup policy is enabled for EFS: {file_system_id}")
    except Exception as e:
        print(f"Error checking backup policies: {str(e)}")

# Example usage
check_efs_backup_policies()
```

By following these steps, you can ensure that your EFS file systems in AWS EC2 have backup plans enabled, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under "Elastic Block Store", click on "Snapshots". This will display a list of all snapshots available in your AWS account.
3. For each snapshot, check the "Tags" column. If a snapshot does not have a tag with the key "Backup", then it means that the Elastic File System (EFS) associated with that snapshot does not have a backup plan.
4. To confirm, you can click on the snapshot ID to view its details. In the "Description" field, if it says "This snapshot was created by AWS Backup", then it means that the EFS has a backup plan. If not, then it confirms that the EFS does not have a backup plan.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local system. You can do this by downloading the appropriate installer from the AWS CLI website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all EFS file systems: Use the following command to list all the EFS file systems in your AWS account.

   ```
   aws efs describe-file-systems --query 'FileSystems[*].[FileSystemId]' --output text
   ```

   This command will return a list of all EFS file system IDs.

3. Check backup plans: For each EFS file system ID returned by the previous command, you need to check if there is a backup plan associated with it. You can do this by using the following command:

   ```
   aws backup describe-backup-jobs --by-resource-arn arn:aws:elasticfilesystem:<region>:<account-id>:file-system/<file-system-id> --query 'BackupJobs[*].[BackupJobId]' --output text
   ```

   Replace `<region>`, `<account-id>`, and `<file-system-id>` with your AWS region, account ID, and the EFS file system ID respectively. This command will return a list of backup job IDs if there is a backup plan associated with the EFS file system.

4. Analyze the results: If the previous command returns a list of backup job IDs, it means that the EFS file system has a backup plan. If it returns nothing, it means that the EFS file system does not have a backup plan. Repeat steps 3 and 4 for each EFS file system ID to check all your EFS file systems.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you start, ensure that you have the necessary Python libraries installed. You will need the 'boto3' library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Set up AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can pass these credentials into your Python script directly (not recommended for security reasons), or more securely, you can set up your credentials file at ~/.aws/credentials. 

3. Write a Python script to check for EFS backup plans: You can use the 'describe_backup_policy' method provided by the EFS client in boto3. This method returns the backup policy for the specified EFS file system.

```python
import boto3

def check_efs_backup_policy(file_system_id):
    efs = boto3.client('efs')
    response = efs.describe_backup_policy(
        FileSystemId=file_system_id
    )
    return response['BackupPolicy']

file_system_id = 'your-efs-file-system-id'
backup_policy = check_efs_backup_policy(file_system_id)
print(backup_policy)
```

4. Analyze the output: The script will return the backup policy for the specified EFS file system. If the 'Status' field in the output is 'ENABLED', it means that the EFS file system has a backup plan. If it's 'DISABLED', it means that the EFS file system does not have a backup plan.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not having a backup plan for Elastic File System (EFS) in AWS EC2 using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to the Elastic File System (EFS) Service**: Click on the "Services" dropdown in the top navigation bar and select "Elastic File System" under the "Storage" category.

3. **Select the EFS File System**: From the list of EFS file systems, select the EFS file system that you want to create a backup plan for by clicking on its name.

4. **Create a Backup Plan**:
   - Click on the "Backup" tab on the EFS file system details page.
   - Click on the "Create Backup Plan" button.

5. **Configure Backup Plan**:
   - Enter a name for the backup plan.
   - Choose the backup frequency and retention policy that suits your requirements. For example, you can set up daily backups with a retention period of 30 days.
   - Configure any lifecycle policies if needed.

6. **Review and Create Backup Plan**:
   - Review the backup plan configuration to ensure it meets your requirements.
   - Click on the "Create" or "Save" button to create the backup plan for the EFS file system.

7. **Monitor Backup Plan**:
   - Once the backup plan is created, you can monitor the backups and their status from the "Backup" tab on the EFS file system details page.
   - Ensure that backups are running as per the configured schedule and that you can restore data if needed.

By following these steps, you have successfully remediated the misconfiguration by creating a backup plan for your Elastic File System in AWS EC2 using the AWS Management Console. This will help ensure data protection and availability in case of any unexpected events or data loss situations.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not having a backup plan for Elastic File System (EFS) in AWS EC2 using AWS CLI, you can follow these steps:

1. **Create a Backup Plan**:
   - Use the AWS CLI command `create-backup-plan` to create a backup plan for your EFS file system.
   - Specify the backup plan details such as name, schedule, retention policy, and backup vault.
   - Example command:
     ```
     aws backup create-backup-plan --backup-plan "Name=MyBackupPlan,BackupPlanRule={RuleName=DailyBackup,ScheduleExpression=\"cron(0 0 * * ? *)\",TargetBackupVaultName=MyBackupVault,StartWindowMinutes=60,CompletionWindowMinutes=120,Lifecycle={MoveToColdStorageAfterDays=30,DeleteAfterDays=90}}"
     ```

2. **Assign Backup Plan to EFS File System**:
   - Use the AWS CLI command `put-backup-vault-access-policy` to assign the created backup plan to your EFS file system.
   - Specify the EFS file system ID and the ARN of the backup plan.
   - Example command:
     ```
     aws backup put-backup-vault-access-policy --backup-vault-name MyBackupVault --policy "{\"BackupPlanId\":\"arn:aws:backup:us-west-2:123456789012:backup-plan:MyBackupPlan\"}"
     ```

3. **Enable Backup for EFS File System**:
   - Use the AWS CLI command `start-backup-job` to initiate the backup process for your EFS file system.
   - Specify the EFS file system ID and the backup vault name.
   - Example command:
     ```
     aws backup start-backup-job --backup-vault-name MyBackupVault --resource-arn arn:aws:elasticfilesystem:us-west-2:123456789012:file-system/fs-12345678
     ```

4. **Verify Backup Status**:
   - Use the AWS CLI command `describe-backup-job` to check the status of the backup job for your EFS file system.
   - Monitor the progress and ensure that the backup is successfully completed.
   - Example command:
     ```
     aws backup describe-backup-job --backup-job-id abcdef12-3456-7890-abcd-1234567890ab
     ```

By following these steps, you can remediate the misconfiguration of not having a backup plan for your EFS file system in AWS EC2 using AWS CLI. This will help you ensure data protection and recovery in case of any unexpected data loss or corruption.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having a backup plan for Elastic File System (EFS) in AWS EC2 using Python, you can follow these steps:

1. **Install Boto3**: Boto3 is the AWS SDK for Python. You can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Create a Backup Plan**: You can create a backup plan using AWS Backup service. Here's an example Python script to create a backup plan for your EFS:

   ```python
   import boto3

   # Initialize the AWS Backup client
   backup_client = boto3.client('backup')

   # Define the resource ARN for your EFS file system
   resource_arn = 'arn:aws:elasticfilesystem:us-east-1:123456789012:file-system/fs-12345678'

   # Define the backup plan name and backup rule
   backup_plan_name = 'EFS-Backup-Plan'
   backup_rule = {
       'RuleName': 'EFS-Backup-Rule',
       'TargetBackupVaultName': 'MyBackupVault',
       'ScheduleExpression': 'cron(0 12 * * ? *)',  # Daily backup at 12:00 PM UTC
       'StartWindowMinutes': 60,
       'CompletionWindowMinutes': 60
   }

   # Create a backup plan
   response = backup_client.create_backup_plan(
       BackupPlan = {
           'BackupPlanName': backup_plan_name,
           'BackupPlanRule': backup_rule
       }
   )

   print('Backup plan created successfully!')
   ```

   Make sure to replace the `resource_arn` with the ARN of your EFS file system and customize the backup plan name, rule, and schedule as needed.

3. **Run the Python Script**: Save the above Python script in a file (e.g., `create_backup_plan.py`) and run it using Python:
   ```bash
   python create_backup_plan.py
   ```

4. **Verify Backup Plan**: You can verify the backup plan by checking the AWS Backup console or by listing the backup plans using the AWS CLI:
   ```bash
   aws backup list-backup-plans
   ```

By following these steps, you can create a backup plan for your EFS file system in AWS EC2 using Python and ensure that you have a backup strategy in place for your data.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

