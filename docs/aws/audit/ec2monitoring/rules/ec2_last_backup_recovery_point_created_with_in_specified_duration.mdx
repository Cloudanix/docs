---
slug: ec2_last_backup_recovery_point_created_with_in_specified_duration
title: Elastic Compute Cloud Should Have Recovery Point 
sidebar_label: Elastic Compute Cloud Should Have Recovery Point 
---

### More Info:

This rule checks if a recovery point was created for Amazon Elastic Compute Cloud (Amazon EC2) instances. The rule is NON_COMPLIANT if the Amazon EC2 instance does not have a corresponding recovery point created within the specified time period.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under "INSTANCES", click on "Instances".
3. Select the EC2 instance that you want to check for recovery points.
4. In the bottom pane, click on the "Tags" tab. Look for a tag named "Recovery Point". If it doesn't exist or if it's not properly configured, then there is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following command to list all the EC2 instances in your AWS account.

   ```
   aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId]' --output text
   ```

3. Check for recovery points: For each instance ID obtained from the previous step, check if there are any recovery points. You can do this by using the following command:

   ```
   aws ec2 describe-instance-recovery-alarms --instance-id <instance-id>
   ```

   Replace `<instance-id>` with the actual instance ID. If the command returns an empty list, it means there are no recovery points for that instance.

4. Repeat step 3 for all instance IDs: You need to repeat the previous step for all the instance IDs obtained in step 2. This will help you identify all the EC2 instances that do not have any recovery points.
</Accordion>

<Accordion title='Using Python'>
1. **Setup AWS SDK (Boto3) in Python Environment:**
   First, you need to set up AWS SDK (Boto3) in your Python environment. You can install it using pip:
   ```
   pip install boto3
   ```
   After installing boto3, you need to configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config. In the credentials file, you should put your access key and secret key. In the config file, you should put your region.

2. **Import Necessary Libraries:**
   Import the necessary libraries into your Python script. You will need boto3 for interacting with AWS and json for parsing the data.
   ```python
   import boto3
   import json
   ```

3. **Create a Session and EC2 Resource Object:**
   Create a session using your AWS credentials and create an EC2 resource object using this session.
   ```python
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )
   ec2 = session.resource('ec2')
   ```

4. **Check for Recovery Points:**
   Iterate over all your EC2 instances and check if they have a recovery point. If an instance does not have a recovery point, print its ID.
   ```python
   for instance in ec2.instances.all():
       try:
           recovery_point = instance.create_recovery_point(
               Description='Recovery point for instance {}'.format(instance.id)
           )
           print('Recovery point for instance {}: {}'.format(instance.id, recovery_point['RecoveryPointArn']))
       except Exception as e:
           print('Instance {} does not have a recovery point. Error: {}'.format(instance.id, str(e)))
   ```
   This script will create a recovery point for each instance and print its ARN. If it fails to create a recovery point, it will print the instance ID and the error message.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of not having a recovery point for an AWS EC2 instance, you can set up automated backups using AWS Backup. Here is a step-by-step guide on how to do this using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login to your AWS account.

2. **Navigate to AWS Backup**: In the AWS Management Console, search for "AWS Backup" in the services search bar and click on the AWS Backup service.

3. **Create a Backup Plan**:
   - Click on "Backup plans" in the left-hand navigation pane.
   - Click on the "Create backup plan" button.
   - Enter a name for your backup plan and a description (optional).
   - Under "Backup rule", click on "Add rule".
   - Configure the backup rule settings such as:
     - Backup frequency (e.g., daily)
     - Backup window
     - Lifecycle (how long to retain backups)
     - Backup vault (where to store the backups)
   - Click "Create plan" to save the backup plan.

4. **Assign Backup Plan to EC2 Instance**:
   - Go back to the AWS Backup console home page.
   - Click on "Protected resources" in the left-hand navigation pane.
   - Click on the "Add resource" button.
   - Select "EC2" as the resource type.
   - Select the specific EC2 instance(s) that you want to include in the backup plan.
   - Click "Add resource" to save the configuration.

5. **Monitor Backups**:
   - You can monitor the backups and their status under the "Protected resources" and "Backup plans" sections in the AWS Backup console.
   - You can also set up notifications for backup events by configuring Amazon CloudWatch Events.

By following these steps, you have successfully remediated the misconfiguration of not having a recovery point for your AWS EC2 instance by setting up automated backups using AWS Backup.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not having a recovery point for an AWS EC2 instance using AWS CLI, follow these steps:

1. **Create a Snapshot of the EC2 Instance Volume**:
   - Run the following AWS CLI command to create a snapshot of the EC2 instance volume:
     ```
     aws ec2 create-snapshot --volume-id <VOLUME_ID>
     ```
     Replace `<VOLUME_ID>` with the actual Volume ID of the EC2 instance.

2. **Tag the Snapshot** (Optional but recommended):
   - You can tag the snapshot for better organization. Run the following command to add tags to the snapshot:
     ```
     aws ec2 create-tags --resources <SNAPSHOT_ID> --tags Key=Name,Value=<SNAPSHOT_NAME>
     ```
     Replace `<SNAPSHOT_ID>` with the Snapshot ID generated in the previous step and `<SNAPSHOT_NAME>` with a descriptive name for the snapshot.

3. **Verify the Snapshot**:
   - You can verify the snapshot creation by running the following command:
     ```
     aws ec2 describe-snapshots --snapshot-ids <SNAPSHOT_ID>
     ```
     Replace `<SNAPSHOT_ID>` with the Snapshot ID obtained in step 1.

4. **Automate Snapshot Creation** (Optional):
   - To ensure regular snapshots are taken, you can set up a scheduled snapshot creation using AWS Lambda and CloudWatch Events.

By following these steps, you have successfully remediated the misconfiguration by creating a recovery point (snapshot) for the AWS EC2 instance using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having a Recovery Point for an AWS EC2 instance using Python, you can create a new Amazon Machine Image (AMI) of the EC2 instance. Follow these steps:

1. **Install Boto3**: Boto3 is the AWS SDK for Python. You can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Create a new AMI**: Use the following Python script to create a new AMI of the EC2 instance. Replace `INSTANCE_ID` with the ID of the EC2 instance for which you want to create a Recovery Point.

   ```python
   import boto3

   # Initialize the EC2 client
   ec2 = boto3.client('ec2')

   # Define the instance ID for which you want to create a Recovery Point
   INSTANCE_ID = 'YOUR_INSTANCE_ID'

   # Create a new AMI of the instance
   response = ec2.create_image(
       InstanceId=INSTANCE_ID,
       Name='Recovery-Point-Image',
       NoReboot=True  # Set to True if you want to create the AMI without rebooting the instance
   )

   # Print the response
   print(response)
   ```

3. **Run the Python script**: Save the above script in a Python file (e.g., `create_ami.py`) and run it using the following command:
   ```bash
   python create_ami.py
   ```

4. **Verify the AMI**: Go to the AWS Management Console, navigate to the EC2 service, and check if a new AMI with the name 'Recovery-Point-Image' has been created. This AMI can be used to restore the EC2 instance to a previous state if needed.

By following these steps and running the Python script, you can create a Recovery Point for an AWS EC2 instance by creating a new Amazon Machine Image.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>

