---
slug: unassociated_elastic_ip_addresses
title: Unassociated Elastic IP Addresses Should Be Removed
sidebar_label: Unassociated Elastic IP Addresses Should Be Removed
---

### More Info:

Identify and remove any unassociated Elastic IP (EIP) addresses for cost optimization.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

AWSWAF, HITRUST, SOC2, NISTCSF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent unassociated Elastic IP addresses from being left unused in Amazon EC2 using the AWS Management Console, follow these steps:

1. **Regular Monitoring:**
   - Navigate to the **EC2 Dashboard** in the AWS Management Console.
   - Click on **Elastic IPs** under the **Network & Security** section.
   - Regularly review the list of Elastic IP addresses to ensure that all are associated with running instances or necessary resources.

2. **Set Up Billing Alerts:**
   - Go to the **Billing and Cost Management Dashboard**.
   - Set up billing alerts to notify you when there are unexpected charges, which can help identify unassociated Elastic IPs that are incurring costs.

3. **Implement IAM Policies:**
   - Use AWS Identity and Access Management (IAM) to create policies that restrict the ability to allocate new Elastic IP addresses without proper justification.
   - Ensure that only authorized personnel can allocate and manage Elastic IP addresses.

4. **Automate Notifications:**
   - Use AWS CloudWatch to create a rule that triggers a notification when an Elastic IP address becomes unassociated.
   - Set up an SNS topic to send notifications to the relevant team members for prompt action.

By following these steps, you can proactively manage and prevent unassociated Elastic IP addresses in your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To prevent unassociated Elastic IP addresses in EC2 using AWS CLI, you can follow these steps:

1. **List All Elastic IP Addresses:**
   Use the following command to list all Elastic IP addresses and their associated instances. This helps you identify any unassociated Elastic IP addresses.
   ```sh
   aws ec2 describe-addresses --query 'Addresses[*].{PublicIp:PublicIp,InstanceId:InstanceId}'
   ```

2. **Filter Unassociated Elastic IP Addresses:**
   Use the following command to filter out Elastic IP addresses that are not associated with any instance.
   ```sh
   aws ec2 describe-addresses --query 'Addresses[?InstanceId==null].PublicIp'
   ```

3. **Automate Monitoring:**
   Set up a scheduled AWS Lambda function or a CloudWatch rule to periodically check for unassociated Elastic IP addresses using the above commands. This helps in proactive monitoring and prevention.
   ```sh
   aws events put-rule --schedule-expression "rate(1 day)" --name "CheckUnassociatedEIPs"
   ```

4. **Notify or Take Action:**
   Configure the Lambda function or CloudWatch rule to send notifications (e.g., via SNS) or take automated actions (e.g., release the unassociated Elastic IPs) if any unassociated Elastic IP addresses are found.
   ```sh
   aws sns publish --topic-arn arn:aws:sns:region:account-id:topic-name --message "Unassociated Elastic IPs found"
   ```

By following these steps, you can effectively prevent unassociated Elastic IP addresses in EC2 using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent unassociated Elastic IP addresses in EC2 using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to achieve this:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. You can install it using pip if you haven't already.

   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by creating a `~/.aws/credentials` file.

3. **Python Script to Identify and Release Unassociated Elastic IPs**:
   Write a Python script to identify and release unassociated Elastic IP addresses.

   ```python
   import boto3

   def release_unassociated_eips():
       # Create an EC2 client
       ec2_client = boto3.client('ec2')

       # Describe all Elastic IPs
       addresses_dict = ec2_client.describe_addresses()

       for address in addresses_dict['Addresses']:
           # Check if the Elastic IP is not associated with any instance or network interface
           if 'InstanceId' not in address and 'NetworkInterfaceId' not in address:
               print(f"Releasing unassociated Elastic IP: {address['PublicIp']}")
               ec2_client.release_address(AllocationId=address['AllocationId'])

   if __name__ == "__main__":
       release_unassociated_eips()
   ```

4. **Schedule the Script to Run Periodically**:
   To ensure continuous prevention, schedule the script to run periodically using a cron job (on Linux) or Task Scheduler (on Windows).

   **For Linux (using cron job)**:
   - Open the crontab editor:
     ```bash
     crontab -e
     ```
   - Add a cron job to run the script daily at midnight:
     ```bash
     0 0 * * * /usr/bin/python3 /path/to/your/script.py
     ```

   **For Windows (using Task Scheduler)**:
   - Open Task Scheduler and create a new task.
   - Set the trigger to run daily at a specific time.
   - Set the action to start a program and point it to your Python executable and script path.

By following these steps, you can automate the prevention of unassociated Elastic IP addresses in EC2 using a Python script.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the EC2 dashboard by selecting "Services" from the top menu, then selecting "EC2" under the "Compute" category.
3. In the EC2 dashboard, under the "Resources" section, click on "Elastic IPs".
4. In the "Elastic IPs" page, you can see all the Elastic IPs associated with your account. Check the "Associated Instance" column for each Elastic IP. If this column is blank, it means the Elastic IP is not associated with any instance and is a potential misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. List all Elastic IP addresses: Use the following AWS CLI command to list all the Elastic IP addresses in your AWS account:

   ```
   aws ec2 describe-addresses
   ```
   This command will return a JSON output with details of all the Elastic IP addresses.

3. Filter unassociated Elastic IP addresses: From the JSON output, you can identify the unassociated Elastic IP addresses by looking for the ones where the "InstanceId" field is null. You can use the following command to filter out these addresses:

   ```
   aws ec2 describe-addresses --query 'Addresses[?InstanceId==null]'
   ```
   This command will return a list of all the unassociated Elastic IP addresses.

4. Count unassociated Elastic IP addresses: If you want to count the number of unassociated Elastic IP addresses, you can pipe the output of the previous command to the `wc -l` command as follows:

   ```
   aws ec2 describe-addresses --query 'Addresses[?InstanceId==null]' | wc -l
   ```
   This command will return the number of unassociated Elastic IP addresses.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways. The simplest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   It will prompt you for your AWS Access Key ID, Secret Access Key, Default region name, and Default output format. Enter the details accordingly.

3. Write the Python script: Now, you can write a Python script to detect unassociated Elastic IP addresses. Here is a simple script that does this:

   ```python
   import boto3

   def detect_unassociated_eips():
       ec2 = boto3.client('ec2')
       addresses_dict = ec2.describe_addresses()
       for eip_dict in addresses_dict['Addresses']:
           if "InstanceId" not in eip_dict:
               print(f"Elastic IP {eip_dict['PublicIp']} is not associated with any instances.")

   if __name__ == "__main__":
       detect_unassociated_eips()
   ```

   This script first creates a client connection to EC2. Then it calls the `describe_addresses` method to get a list of all Elastic IP addresses. It iterates over this list, and for each Elastic IP, it checks if the 'InstanceId' key is in the dictionary. If it's not, that means the Elastic IP is not associated with any instances, and it prints a message saying so.

4. Run the Python script: Finally, you can run the Python script using the Python interpreter:

   ```bash
   python detect_unassociated_eips.py
   ```

   This will print out any unassociated Elastic IP addresses.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the "Unassociated Elastic IP Addresses Should Be Removed" misconfiguration for AWS using the AWS console:

1. Login to your AWS console.
2. Go to the EC2 dashboard by clicking on the "Services" dropdown at the top of the page and selecting "EC2" under the "Compute" section.
3. Click on the "Elastic IPs" link in the left-hand navigation menu.
4. Look for any Elastic IP addresses that are not associated with an EC2 instance. These will be labeled as "Not associated" in the "Association ID" column.
5. Select the unassociated Elastic IP address by checking the box next to it.
6. Click on the "Actions" dropdown menu at the top of the page and select "Release addresses".
7. In the confirmation dialog box, click on the "Release" button to confirm the release of the unassociated Elastic IP address.

This will remove the unassociated Elastic IP address and remediate the misconfiguration.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "Unassociated Elastic IP Addresses Should Be Removed" in AWS using AWS CLI, follow these steps:

1. Open your terminal and install AWS CLI if it is not already installed.

2. Run the following command to list all the unassociated Elastic IP addresses in your AWS account:

   `aws ec2 describe-addresses --filters "Name=association-id,Values=null"`

3. Identify the Elastic IP address that needs to be removed.

4. Run the following command to release the Elastic IP address:

   `aws ec2 release-address --public-ip <public-ip-address>`

   Replace `<public-ip-address>` with the actual Elastic IP address that needs to be removed.

5. Verify that the Elastic IP address has been successfully released by running the following command:

   `aws ec2 describe-addresses --public-ips <public-ip-address>`

   Replace `<public-ip-address>` with the actual Elastic IP address that was removed. You should get an error message stating that the Elastic IP address does not exist.

6. Repeat steps 4 and 5 for all the unassociated Elastic IP addresses in your AWS account.

7. Once you have removed all the unassociated Elastic IP addresses, verify that the misconfiguration has been remediated by running a security scan or audit tool.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Unassociated Elastic IP Addresses Should Be Removed" for AWS using python, you can follow the below steps:

1. Import the necessary libraries:

```python
import boto3
```

2. Instantiate a boto3 EC2 client:

```python
ec2 = boto3.client('ec2')
```

3. Get a list of all unassociated Elastic IP addresses:

```python
unassociated_ips = ec2.describe_addresses(
    Filters=[
        {
            'Name': 'association-id',
            'Values': [
                ''
            ]
        }
    ]
)
```

4. Loop through the unassociated Elastic IP addresses and release them:

```python
for ip in unassociated_ips['Addresses']:
    ec2.release_address(AllocationId=ip['AllocationId'])
```

5. Verify that the unassociated Elastic IP addresses have been removed:

```python
verified_ips = ec2.describe_addresses(
    Filters=[
        {
            'Name': 'association-id',
            'Values': [
                ''
            ]
        }
    ]
)

if len(verified_ips['Addresses']) == 0:
    print("All unassociated Elastic IP addresses have been removed.")
else:
    print("There are still unassociated Elastic IP addresses.")
```

Note: Before running this code, make sure that you have AWS credentials set up on your machine.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html) 

