---
slug: no_default_vpc_inuse
title: Default VPC Should Not Be In Use
sidebar_label: Default VPC Should Not Be In Use
---

### More Info:

It is recommended not to using the default VPC.

### Risk Level

Medium

### Address

Security

### Compliance Standards

GDPR, SOC2, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon VPC console at https://console.aws.amazon.com/vpc/.

2. In the navigation pane, choose 'Your VPCs'.

3. In the list of VPCs, check the 'VPC ID' column. The default VPC has a VPC ID that begins with 'vpc-1a2b3c4d'. 

4. If there are any resources (like instances, subnets, security groups, network ACLs, route tables, internet gateways, EIPs, or virtual private gateways) associated with the default VPC, it means the default VPC is in use. You can check this by clicking on the VPC ID and checking the 'Summary' tab for associated resources.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all VPCs: Use the AWS CLI command `aws ec2 describe-vpcs` to list all the VPCs in your AWS account. This command will return a JSON output with details of all the VPCs.

3. Identify the default VPC: In the JSON output, look for the "IsDefault" key. If the value of this key is true, then that VPC is the default VPC. The command to filter out the default VPC is: 
```
aws ec2 describe-vpcs --query 'Vpcs[?IsDefault==`true`]'
```

4. Check if the default VPC is in use: To check if the default VPC is in use, you need to check if there are any instances running in it. You can do this by using the `aws ec2 describe-instances` command and filtering the output for instances that are in the default VPC. The command to do this is: 
```
aws ec2 describe-instances --filters "Name=vpc-id,Values=<default-vpc-id>"
```
Replace `<default-vpc-id>` with the ID of your default VPC. If this command returns any instances, then the default VPC is in use.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways. The simplest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   It will prompt you for your access key, secret access key, AWS region. These details will be stored in `~/.aws/credentials` and `~/.aws/config` files.

3. Write the Python script: Now you can write a Python script to check if the default VPC is in use. Here is a simple script that does this:

   ```python
   import boto3

   def check_default_vpc():
       ec2 = boto3.resource('ec2')
       vpcs = list(ec2.vpcs.all())
       for vpc in vpcs:
           if vpc.is_default:
               print(f"Default VPC {vpc.id} is in use.")
               return True
       print("Default VPC is not in use.")
       return False

   check_default_vpc()
   ```

   This script uses the Boto3 EC2 resource to get all VPCs and checks if the default VPC is in use.

4. Run the Python script: Finally, you can run the Python script using the Python interpreter:

   ```bash
   python check_default_vpc.py
   ```

   If the default VPC is in use, it will print "Default VPC {vpc.id} is in use." Otherwise, it will print "Default VPC is not in use."

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Default VPC Should Not Be In Use" misconfiguration in AWS, you can follow these steps:

1. Log in to the AWS Management Console.

2. Open the Amazon VPC console.

3. In the navigation pane, select "Your VPCs".

4. Identify the default VPC. The default VPC has the "Default VPC" tag.

5. Select the default VPC.

6. Choose "Actions", and then choose "Delete VPC".

7. In the confirmation dialog box, choose "Delete VPC".

8. If you have any resources running in the default VPC, you will need to move them to a new VPC before you can delete the default VPC. To do this, follow these steps:

    a. In the navigation pane, select the resource type (such as EC2 instances or RDS instances).

    b. Select the resource that is running in the default VPC.

    c. Choose "Actions", and then choose "Create Image" (for EC2 instances) or "Create Snapshot" (for RDS instances).

    d. After the image or snapshot is created, launch a new instance or RDS instance in a new VPC.

9. After you have moved all resources out of the default VPC, repeat steps 5-7 to delete the default VPC.

10. Once the default VPC is deleted, you should create a new VPC and configure it according to your requirements.

#### Using CLI

To remediate the misconfiguration of using the Default VPC in AWS, follow these steps:

1. Open the AWS CLI on your local machine or in the AWS Management Console.

2. Run the following command to list all the VPCs in your account: 

   ```
   aws ec2 describe-vpcs
   ```

3. Identify the Default VPC in the output. The Default VPC has the `isDefault` attribute set to `true`.

4. Run the following command to delete the Default VPC:

   ```
   aws ec2 delete-vpc --vpc-id <vpc-id>
   ```

   Replace `<vpc-id>` with the ID of the Default VPC that you want to delete.

5. Confirm the deletion by entering `y` when prompted.

6. Once the Default VPC is deleted, you will need to create a new VPC and configure it according to your requirements.

   ```
   aws ec2 create-vpc --cidr-block <cidr-block>
   ```

   Replace `<cidr-block>` with the CIDR block that you want to assign to the new VPC.

7. Configure the VPC by adding subnets, route tables, security groups, and any other required resources.

8. Once the VPC is configured, launch your instances in the new VPC instead of the Default VPC.

By following these steps, you can remediate the misconfiguration of using the Default VPC in AWS.

#### Using Python

To remediate the "Default VPC Should Not Be In Use" misconfiguration in AWS using Python, follow these steps:

1. Import the necessary AWS SDK libraries for Python:

```python
import boto3
```

2. Create a new EC2 resource object:

```python
ec2 = boto3.resource('ec2')
```

3. Get a list of all VPCs in the AWS account:

```python
vpcs = list(ec2.vpcs.all())
```

4. Loop through the list of VPCs and check if any of them are the default VPC:

```python
for vpc in vpcs:
    if vpc.is_default:
        # Remediate the default VPC
```

5. If a default VPC is found, you can either delete it or modify it to remove the default status. To delete the default VPC, use the following code:

```python
vpc.delete()
```

6. Alternatively, you can modify the default VPC to remove the default status. To do this, you need to modify the "is_default" attribute of the VPC:

```python
vpc.modify_attribute(Default='false')
```

7. Finally, you can confirm that the default VPC has been remediated by checking the list of VPCs again:

```python
vpcs = list(ec2.vpcs.all())
for vpc in vpcs:
    if vpc.is_default:
        print("Default VPC still exists")
```

This should remediate the "Default VPC Should Not Be In Use" misconfiguration in AWS using Python.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/default-vpc.html](https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/default-vpc.html) 


</Tab>
</Tabs>