---
slug: fsx_last_backup_recovery_point_created_with_in_specified_duration
title: FSx Should Have Recovery Point
sidebar_label: FSx Should Have Recovery Point 
---

### More Info:

This rule checks if a recovery point was created for Amazon FSx File Systems. The rule is NON_COMPLIANT if the Amazon FSx File System does not have a corresponding recovery point created within the specified time period.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon FSx console at https://console.aws.amazon.com/fsx/.

2. In the navigation pane, choose "File systems".

3. In the "File systems" list, select the FSx file system that you want to check.

4. In the "Details" section, look for the "Backup" tab. Here, you can see the recovery points for the selected FSx file system. If there are no recovery points, it means the FSx does not have a recovery point.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local system. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all FSx file systems: Use the following command to list all the FSx file systems in your AWS account.

   ```
   aws fsx describe-file-systems
   ```
   This command will return a JSON output with details of all FSx file systems.

3. Check for recovery points: For each FSx file system, check if there are any recovery points. You can do this by using the following command:

   ```
   aws backup list-recovery-points-by-backup-vault --backup-vault-name <name_of_your_backup_vault>
   ```
   Replace `<name_of_your_backup_vault>` with the name of your backup vault. This command will return a list of recovery points in the specified backup vault.

4. Analyze the output: If the output from the previous command does not include the FSx file system, it means that the FSx file system does not have a recovery point. If the FSx file system is included in the output, it means that it has a recovery point.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Now, create a client for 'fsx' which is the service for Amazon FSx:

```python
fsx = session.client('fsx')
```

4. Now, you can list all the FSx file systems and check if they have a recovery point. If the 'AutomaticBackupRetentionDays' is 0, then it means that the FSx file system does not have a recovery point:

```python
def check_fsx_recovery_point():
    response = fsx.describe_file_systems()
    for fs in response['FileSystems']:
        if fs['AutomaticBackupRetentionDays'] == 0:
            print(f"FSx file system {fs['FileSystemId']} does not have a recovery point")

check_fsx_recovery_point()
```

This script will print out the IDs of all FSx file systems that do not have a recovery point.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of FSx not having a recovery point for AWS EC2 using the AWS console, follow these steps:

1. **Navigate to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/).

2. **Open Amazon FSx Console**: Click on the "Services" dropdown menu at the top left corner, search for "FSx", and click on "Amazon FSx".

3. **Select FSx File System**: In the Amazon FSx dashboard, select the FSx file system that you want to create a recovery point for by clicking on it.

4. **Create Recovery Point**: In the FSx file system details page, navigate to the "Data repositories" tab and click on the "Create backup" button.

5. **Configure Backup**: In the "Create backup" wizard, configure the backup settings such as backup type (daily or weekly), retention period, and preferred backup window.

6. **Review and Create**: Review the backup settings to ensure they meet your requirements, then click on the "Create backup" button to initiate the creation of a recovery point for the FSx file system.

7. **Monitor Backup Progress**: Monitor the progress of the backup creation in the Amazon FSx console. Once the backup is successfully created, you will have a recovery point for your FSx file system.

By following these steps, you have successfully remediated the misconfiguration of FSx not having a recovery point for your AWS EC2 instance using the AWS console.

#### Using CLI

To remediate the misconfiguration of FSx not having a recovery point for AWS EC2 using AWS CLI, you can follow these steps:

1. **Create a Backup for FSx File System**:
   - Use the `create-backup` command to create a backup for the FSx file system.
     ```bash
     aws fsx create-backup --file-system-id fs-1234567890abcdef0 --tags Key=Name,Value=Backup1
     ```
   - Replace `fs-1234567890abcdef0` with the actual File System ID of your FSx file system.

2. **Verify Backup Status**:
   - Use the `describe-backups` command to check the status of the backup.
     ```bash
     aws fsx describe-backups --backup-ids backup-0abcdef1234567890
     ```
   - Replace `backup-0abcdef1234567890` with the Backup ID of the backup created in the previous step.

3. **Enable Automatic Backups** (Optional):
   - To ensure that automatic backups are enabled for future backups, you can use the `update-file-system` command.
     ```bash
     aws fsx update-file-system --file-system-id fs-1234567890abcdef0 --lustre-configuration WeeklyMaintenanceStartTime=1:00:00
     ```
   - Replace `fs-1234567890abcdef0` with the actual File System ID of your FSx file system.

By following these steps, you can remediate the misconfiguration of FSx not having a recovery point for your AWS EC2 instance using AWS CLI.

#### Using Python

To remediate the misconfiguration related to Amazon FSx not having a Recovery Point for AWS EC2 using Python, you can follow these steps:

1. **Install Boto3**: Boto3 is the Amazon Web Services (AWS) SDK for Python. You can install it using pip:
   ```bash
   pip install boto3
   ```

2. **Create a Python script**: Create a Python script with the following code to enable automatic backups (recovery points) for the Amazon FSx file system associated with your EC2 instance.

```python
import boto3

# Initialize the Boto3 client for FSx
fsx_client = boto3.client('fsx', region_name='your_aws_region')

# Specify the ID of the FSx file system associated with your EC2 instance
fsx_file_system_id = 'your_fsx_file_system_id'

# Enable automatic backups for the FSx file system
response = fsx_client.update_file_system(
    FileSystemId=fsx_file_system_id,
    LustreConfiguration={
        'WeeklyMaintenanceStartTime': '1:00:00',
        'DataRepositoryConfiguration': {
            'AutoImportPolicy': 'NONE',
            'ExportPath': 'string',
            'ImportPath': 'string'
        }
    },
    WindowsConfiguration={
        'WeeklyMaintenanceStartTime': '1:00:00',
        'AutomaticBackupRetentionDays': 30,
        'DailyAutomaticBackupStartTime': '1:00:00',
        'ThroughputCapacity': 8,
        'SelfManagedActiveDirectoryConfiguration': {
            'UserName': 'string',
            'Password': 'string',
            'DnsIps': [
                'string',
            ]
        }
    }
)

print("Automatic backups enabled for FSx file system with ID:", fsx_file_system_id)
```

3. **Replace placeholders**: Replace `'your_aws_region'` with the AWS region where your FSx file system is located, and `'your_fsx_file_system_id'` with the actual ID of your FSx file system.

4. **Run the script**: Execute the Python script in your local environment or on an EC2 instance with appropriate IAM roles that have permissions to modify FSx configurations.

This script will enable automatic backups for the specified Amazon FSx file system associated with your EC2 instance, ensuring that a recovery point is available in case of data loss or corruption.



</Tab>
</Tabs>