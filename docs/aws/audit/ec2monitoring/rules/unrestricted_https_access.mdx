---
slug: unrestricted_https_access
title: Unrestricted HTTPS Access Should Not Be Allowed
sidebar_label: Unrestricted HTTPS Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted inbound access to TCP port 443 (HTTPS).

### Risk Level

Low

### Address

Security

### Compliance Standards

AWSWAF, SOC2, GDPR



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all security groups associated with your EC2 instances. Click on the security group you want to inspect.
4. In the details pane at the bottom, check the "Inbound rules" tab. If there is a rule that allows inbound traffic on port 443 (HTTPS) from '0.0.0.0/0' or '::/0' (which means from any IP address), then unrestricted HTTPS access is allowed.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all security groups: The next step is to list all the security groups in your AWS account. You can do this by running the following command:

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].{Name:GroupName,ID:GroupId}"
   ```

   This command will return a list of all security groups along with their names and IDs.

3. Check for unrestricted HTTPS access: Now, for each security group, you need to check if it allows unrestricted HTTPS access. You can do this by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id> --query 'SecurityGroups[*].IpPermissions[*].{IP:IpRanges,Protocol:IpProtocol,FromPort:FromPort,ToPort:ToPort}'
   ```

   Replace `<security-group-id>` with the ID of the security group you want to check. This command will return a list of all IP ranges, protocols, and ports that are allowed by the security group.

4. Analyze the output: If the output of the previous command includes an IP range of `0.0.0.0/0` (which means all IP addresses) and a protocol of `HTTPS` (port 443), then the security group allows unrestricted HTTPS access. If not, then the security group does not allow unrestricted HTTPS access.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config. In the credentials file, you should put your access key and secret key. In the config file, you should put your region.
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to get all security groups:
   You can use the EC2 resource object in Boto3 to get all security groups. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   # Get all security groups
   security_groups = ec2.security_groups.all()
   ```

3. Check each security group for unrestricted HTTPS access:
   You can iterate over each security group and check its inbound rules. If a rule allows traffic from 0.0.0.0/0 or ::/0 (for IPv6) on port 443 (HTTPS), then it allows unrestricted HTTPS access. Here is a sample script:
   ```python
   for sg in security_groups:
       for rule in sg.ip_permissions:
           for ip_range in rule['IpRanges']:
               if ip_range['CidrIp'] == '0.0.0.0/0' and rule['FromPort'] <= 443 and rule['ToPort'] >= 443:
                   print(f"Security group {sg.id} allows unrestricted HTTPS access")
           for ipv6_range in rule.get('Ipv6Ranges', []):
               if ipv6_range['CidrIpv6'] == '::/0' and rule['FromPort'] <= 443 and rule['ToPort'] >= 443:
                   print(f"Security group {sg.id} allows unrestricted HTTPS access over IPv6")
   ```

4. Run the script:
   You can run the script using the Python interpreter. It will print the IDs of all security groups that allow unrestricted HTTPS access. If it doesn't print anything, then no security groups allow unrestricted HTTPS access.
   ```
   python check_https_access.py
   ```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Unrestricted HTTPS Access Should Not Be Allowed" misconfiguration in AWS, you can follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the AWS EC2 service.
3. Click on the "Security Groups" option from the left-hand menu.
4. Select the security group that is associated with the instance(s) that have unrestricted HTTPS access.
5. Click on the "Inbound Rules" tab.
6. Locate the HTTPS rule that has unrestricted access (i.e., source is set to "0.0.0.0/0" or "::/0").
7. Click on the "Edit" button for the rule.
8. Change the source to a more restrictive IP range or security group that requires HTTPS access.
9. Click on the "Save Rules" button to apply the changes.

Note: If you are unsure which security group is associated with the instance(s) that have unrestricted HTTPS access, you can view the instance details to find the security group ID and then navigate to the Security Groups section to find the security group.

#### Using CLI

To remediate the misconfiguration of unrestricted HTTPS access in AWS using AWS CLI, follow these steps:

Step 1: Open the AWS CLI in your terminal or command prompt.

Step 2: Run the following command to list all the security groups in your AWS account:

```
aws ec2 describe-security-groups
```

Step 3: Identify the security group(s) that have unrestricted HTTPS access allowed.

Step 4: Run the following command to remove the HTTPS access rule from the identified security group(s):

```
aws ec2 revoke-security-group-ingress --group-id <security_group_id> --protocol tcp --port 443 --cidr 0.0.0.0/0
```

Note: Replace `<security_group_id>` with the actual ID of the security group that needs to be remediated.

Step 5: Verify that the HTTPS access rule has been removed by running the following command:

```
aws ec2 describe-security-groups --group-id <security_group_id>
```

Note: Replace `<security_group_id>` with the actual ID of the security group that was remediated.

Step 6: Repeat the above steps for all the security groups that have unrestricted HTTPS access allowed.

By following the above steps, you can remediate the misconfiguration of unrestricted HTTPS access in AWS using AWS CLI.

#### Using Python

To remediate the unrestricted HTTPS access issue in AWS using Python, you can follow the below steps:

1. Identify the Security Group(s) which are allowing unrestricted HTTPS access.
2. Using the AWS SDK for Python (Boto3), modify the inbound rules of the identified Security Group(s) to allow HTTPS access only from trusted sources.
3. Create a script to automate this process for all the Security Group(s) in your AWS account.

Here is a sample Python code to remediate the issue:

```
import boto3

# Define the AWS region and security group id
region = 'us-east-1'
security_group_id = 'sg-0123456789abcdef'

# Create an EC2 client
ec2 = boto3.client('ec2', region_name=region)

# Get the existing inbound rules of the security group
response = ec2.describe_security_groups(GroupIds=[security_group_id])

# Modify the inbound rules to allow HTTPS access only from trusted sources
ec2.authorize_security_group_ingress(
    GroupId=security_group_id,
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 443,
            'ToPort': 443,
            'IpRanges': [
                {
                    'CidrIp': 'trusted_ip_address/32'
                }
            ]
        }
    ]
)
```

Note: Replace the `region` and `security_group_id` variables with your own values. Also, replace the `trusted_ip_address` with the IP address(es) of the trusted sources that should be allowed HTTPS access.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 


</Tab>
</Tabs>