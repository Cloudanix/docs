---
slug: underutilized_ec2_instance
title: EC2 Instances Should Not Be Underutilized
sidebar_label: EC2 Instances Should Not Be Underutilized
---

### More Info:

Underutilized EC2 instances should be downsized in order to optimize your AWS costs.

### Risk Level

Low

### Address

Cost optimization

### Compliance Standards

AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Login to AWS Management Console: First, you need to log in to your AWS Management Console. Make sure you have the necessary permissions to access the EC2 dashboard.

2. Navigate to EC2 Dashboard: Once you are logged in, navigate to the EC2 dashboard by clicking on the "Services" dropdown at the top of the console and then selecting "EC2" under the "Compute" category.

3. Check EC2 Instance Utilization: In the EC2 dashboard, click on "Instances" in the left-hand side menu. This will display a list of all your EC2 instances. For each instance, you can check the "Monitoring" tab at the bottom of the page. This tab will show various metrics related to the instance, including CPU utilization, disk reads and writes, network packets in and out, etc. If the CPU utilization is consistently low (e.g., below 20%), the instance may be underutilized.

4. Use CloudWatch for Detailed Monitoring: For a more detailed analysis, you can use AWS CloudWatch. In the CloudWatch dashboard, you can create custom dashboards to monitor the metrics of your EC2 instances. You can set alarms to notify you when certain thresholds are breached, such as when CPU utilization is consistently low over a certain period of time. This can help you identify underutilized instances.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List All EC2 Instances**: You can list all your EC2 instances using the `describe-instances` command. The command is as follows:

    ```
    aws ec2 describe-instances
    ```

    This command will return a JSON output with details about all your EC2 instances.

3. **Check CPU Utilization**: To check the CPU utilization of your EC2 instances, you can use the `get-metric-statistics` command. This command retrieves the specified metrics. The command is as follows:

    ```
    aws cloudwatch get-metric-statistics --namespace AWS/EC2 --metric-name CPUUtilization --dimensions Name=InstanceId,Value=instance_id --start-time 2021-01-01T00:00:00Z --end-time 2021-01-02T23:59:59Z --period 3600 --statistics Maximum --unit Percent
    ```

    Replace `instance_id` with the ID of your EC2 instance. This command will return the maximum CPU utilization for the specified instance in the specified time period.

4. **Analyze the Output**: The output of the `get-metric-statistics` command will give you the CPU utilization of your EC2 instance. If the CPU utilization is consistently low, it indicates that the EC2 instance is underutilized. You can then take appropriate action to optimize your resources.

#### Using Python

1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. At the very least, the contents of the file should be:

   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Create a Python script to check EC2 utilization: The script will use the Boto3 library to interact with the AWS EC2 service. It will retrieve all instances and check their CPU utilization. If the CPU utilization is below a certain threshold (e.g., 20%), it will print out the instance ID.

   ```python
   import boto3

   # Create a session using your AWS credentials
   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
   )

   # Create a connection to the EC2 service
   ec2 = session.resource('ec2')

   # Get all instances
   instances = ec2.instances.all()

   # For each instance, check the CPU utilization
   for instance in instances:
       # Get the instance's CloudWatch metrics
       cloudwatch = session.client('cloudwatch')
       metrics = cloudwatch.get_metric_statistics(
           Namespace='AWS/EC2',
           MetricName='CPUUtilization',
           Dimensions=[
               {
                   'Name': 'InstanceId',
                   'Value': instance.id
               },
           ],
           StartTime=datetime.datetime.utcnow() - datetime.timedelta(seconds=600),
           EndTime=datetime.datetime.utcnow(),
           Period=300,
           Statistics=['Average']
       )

       # If the average CPU utilization is below 20%, print the instance ID
       if metrics['Datapoints'] and metrics['Datapoints'][0]['Average'] < 20:
           print(f'Instance {instance.id} is underutilized')
   ```

4. Run the script: You can run the script using the Python interpreter. It will print out the IDs of all underutilized EC2 instances.

   ```
   python check_ec2_utilization.py
   ```

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of underutilized EC2 instances in AWS, you can follow the below steps:

1. Log in to your AWS Management Console.
2. Go to the EC2 Dashboard.
3. Click on the "Instances" option from the left-hand side menu.
4. Select the underutilized EC2 instance(s) that you want to remediate.
5. Click on the "Actions" button and select "Create Image" from the dropdown list.
6. Enter the required details for creating an image of the instance and click on the "Create Image" button.
7. Once the image is created, go to the "AMIs" section from the left-hand side menu.
8. Select the newly created AMI and click on the "Launch" button.
9. Follow the on-screen instructions to launch a new instance from the AMI.
10. Once the new instance is launched, you can terminate the underutilized instance(s) to save costs.

By creating an AMI of the underutilized EC2 instance and launching a new instance from it, you can ensure that the new instance is properly configured and optimized for your workload. This will help you avoid underutilization of your EC2 instances and reduce your AWS costs.

#### Using CLI

To remediate EC2 instances that are underutilized in AWS using AWS CLI, you can follow these steps:

1. Identify the underutilized EC2 instances by checking their CPU utilization metrics. You can use the following AWS CLI command to get the CPU utilization metrics for all running instances in your account:

```
aws cloudwatch get-metric-statistics --namespace "AWS/EC2" --metric-name "CPUUtilization" --dimensions "Name=InstanceId,Value=INSTANCE_ID" --start-time START_TIME --end-time END_TIME --period 300 --statistics "Average"
```

Replace INSTANCE_ID with the ID of the instance you want to check, START_TIME and END_TIME with the time range you want to check.

2. Once you have identified the underutilized instances, you can take the following actions:

- Resize the instance: If the instance is underutilized because it has too few resources, you can resize the instance to a larger size using the `modify-instance-attribute` AWS CLI command.

```
aws ec2 modify-instance-attribute --instance-id INSTANCE_ID --instance-type INSTANCE_TYPE
```

Replace INSTANCE_ID with the ID of the instance you want to resize and INSTANCE_TYPE with the new instance type.

- Terminate the instance: If the instance is underutilized because it is no longer needed, you can terminate the instance using the `terminate-instances` AWS CLI command.

```
aws ec2 terminate-instances --instance-ids INSTANCE_ID
```

Replace INSTANCE_ID with the ID of the instance you want to terminate.

3. Monitor the CPU utilization metrics of your instances regularly to ensure they are not underutilized or overutilized. You can set up CloudWatch alarms to notify you when the CPU utilization exceeds or falls below a certain threshold.

By following these steps, you can remediate the misconfiguration of underutilized EC2 instances in AWS.

#### Using Python

To remediate EC2 instances that are underutilized in AWS using Python, you can follow the below steps:

1. Identify underutilized instances: 
   - Use AWS SDK for Python (Boto3) to get the list of all EC2 instances.
   - For each instance, get its CPU utilization metric using CloudWatch.
   - If the average CPU utilization is below a certain threshold (e.g. 20%) for a certain period (e.g. 7 days), mark the instance as underutilized.

2. Stop underutilized instances:
   - Use Boto3 to stop the identified underutilized instances.
   - Before stopping the instance, make sure that it is not being used for any critical application or service.

3. Schedule start/stop instances:
   - Use AWS Lambda and CloudWatch Events to schedule start/stop instances based on the usage pattern.
   - For example, you can start instances during peak hours and stop them during off-hours to save costs.

4. Resize underutilized instances:
   - Use AWS Auto Scaling to resize instances based on their usage pattern.
   - For example, you can increase the instance size during peak hours and decrease it during off-hours to optimize costs.

5. Monitor and optimize:
   - Monitor the instances regularly to ensure that they are not underutilized or overutilized.
   - Optimize the instances based on the usage pattern and workload requirements to minimize costs and maximize performance.

Note: It is important to ensure that the remediation process does not affect the availability and performance of critical applications or services running on the EC2 instances.

### Additional Reading:

- [https://aws.amazon.com/blogs/aws-cost-management/launch-resource-optimization-recommendations/](https://aws.amazon.com/blogs/aws-cost-management/launch-resource-optimization-recommendations/) 


</Tab>
</Tabs>