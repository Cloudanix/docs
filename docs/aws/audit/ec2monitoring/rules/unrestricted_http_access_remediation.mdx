
### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent unrestricted HTTP access in EC2 using the AWS Management Console, follow these steps:

1. **Navigate to Security Groups:**
   - Open the AWS Management Console.
   - In the navigation pane, choose "Security Groups" under the "Network & Security" section.

2. **Select the Security Group:**
   - Identify and select the security group associated with your EC2 instance that you want to modify.

3. **Edit Inbound Rules:**
   - In the "Inbound rules" tab, click on the "Edit inbound rules" button.
   - Review the existing rules and identify any rule that allows HTTP (port 80) access from 0.0.0.0/0 (which means unrestricted access from any IP address).

4. **Restrict Access:**
   - Modify the source IP range for the HTTP rule to a more restrictive range, such as a specific IP address or a CIDR block that represents your trusted network.
   - Alternatively, you can remove the rule if HTTP access is not required.

By following these steps, you can ensure that HTTP access to your EC2 instances is restricted to trusted sources only, thereby enhancing the security of your instances.
</Accordion>

<Accordion title='Using CLI'>
To prevent unrestricted HTTP access in EC2 using AWS CLI, you need to modify the security group rules associated with your EC2 instances. Here are the steps:

1. **Identify the Security Group:**
   First, identify the security group associated with your EC2 instance. You can list all security groups and find the relevant one using the following command:
   ```sh
   aws ec2 describe-security-groups --query "SecurityGroups[*].{ID:GroupId,Name:GroupName}"
   ```

2. **Check Existing Rules:**
   Check the existing inbound rules for the identified security group to see if there is an unrestricted HTTP access rule (port 80 open to 0.0.0.0/0):
   ```sh
   aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions"
   ```

3. **Revoke Unrestricted HTTP Access:**
   If you find a rule that allows unrestricted HTTP access, revoke it using the following command:
   ```sh
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 80 --cidr 0.0.0.0/0
   ```

4. **Add Restricted HTTP Access (Optional):**
   If you need to allow HTTP access but want to restrict it to specific IP ranges, you can add a more restrictive rule. For example, to allow HTTP access only from a specific IP range (e.g., 192.168.1.0/24), use:
   ```sh
   aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol tcp --port 80 --cidr 192.168.1.0/24
   ```

By following these steps, you can prevent unrestricted HTTP access to your EC2 instances using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent unrestricted HTTP access in EC2 instances using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to achieve this:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. You can install it using pip if you haven't already.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

3. **Create a Python Script**:
   Write a Python script to identify and update security groups to restrict HTTP access (port 80) to specific IP addresses or ranges.

4. **Script to Restrict HTTP Access**:
   Here is a sample Python script to restrict HTTP access in EC2 security groups:

   ```python
   import boto3

   # Initialize a session using Amazon EC2
   ec2 = boto3.client('ec2')

   # Describe all security groups
   response = ec2.describe_security_groups()

   for sg in response['SecurityGroups']:
       sg_id = sg['GroupId']
       sg_name = sg['GroupName']
       for permission in sg['IpPermissions']:
           if permission['IpProtocol'] == 'tcp' and permission['FromPort'] == 80 and permission['ToPort'] == 80:
               for ip_range in permission['IpRanges']:
                   if ip_range['CidrIp'] == '0.0.0.0/0':
                       print(f"Security Group {sg_name} ({sg_id}) has unrestricted HTTP access. Revoking rule.")
                       # Revoke the unrestricted rule
                       ec2.revoke_security_group_ingress(
                           GroupId=sg_id,
                           IpProtocol='tcp',
                           FromPort=80,
                           ToPort=80,
                           CidrIp='0.0.0.0/0'
                       )
                       # Optionally, add a more restrictive rule here
                       # ec2.authorize_security_group_ingress(
                       #     GroupId=sg_id,
                       #     IpProtocol='tcp',
                       #     FromPort=80,
                       #     ToPort=80,
                       #     CidrIp='YOUR_RESTRICTED_IP_RANGE'
                       # )
                       print(f"Unrestricted HTTP access revoked for Security Group {sg_name} ({sg_id}).")

   print("Completed checking and updating security groups.")
   ```

### Explanation:
1. **Install Boto3 Library**: Ensure you have the Boto3 library installed to interact with AWS services.
2. **Set Up AWS Credentials**: Configure your AWS credentials to allow the script to authenticate with AWS.
3. **Create a Python Script**: Write a Python script to identify security groups with unrestricted HTTP access.
4. **Script to Restrict HTTP Access**: The script iterates through all security groups, identifies those with unrestricted HTTP access (0.0.0.0/0 on port 80), and revokes the rule. Optionally, you can add a more restrictive rule if needed.

This script helps in preventing unrestricted HTTP access by ensuring that no security group allows HTTP access from any IP address.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "NETWORK & SECURITY" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. Here, you can see all the inbound rules for this security group. If there is a rule that allows unrestricted HTTP access (i.e., the rule has "HTTP" as its type and "0.0.0.0/0" or "::/0" as its source), then this is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all security groups: Use the following command to list all the security groups in your AWS account.

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].{Name:GroupName,ID:GroupId}"
   ```

3. Check the inbound rules for each security group: For each security group, you need to check the inbound rules to see if they allow unrestricted HTTP access. You can do this using the following command, replacing `SECURITY_GROUP_ID` with the ID of the security group you want to check.

   ```
   aws ec2 describe-security-groups --group-ids SECURITY_GROUP_ID --query 'SecurityGroups[*].IpPermissions[*].{IP:IpRanges,Protocol:IpProtocol,Port:FromPort}'
   ```

4. Analyze the output: The output of the above command will show you the IP ranges, protocols, and ports for the inbound rules of the security group. If you see an IP range of `0.0.0.0/0` (which means all IP addresses) and a protocol of `tcp` with a port of `80` (which means HTTP), then unrestricted HTTP access is allowed.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to list all security groups and their rules:
   You can use the `describe_security_groups` function to get a list of all security groups and their rules. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for security_group in response['SecurityGroups']:
       for permission in security_group['IpPermissions']:
           for range in permission['IpRanges']:
               print(f"Security Group: {security_group['GroupName']}, Protocol: {permission['IpProtocol']}, Port Range: {permission['FromPort']}-{permission['ToPort']}, IP Range: {range['CidrIp']}")
   ```

3. Check for unrestricted HTTP access:
   Unrestricted HTTP access means that the security group allows traffic from any IP address (0.0.0.0/0) on port 80. You can add a check for this in your script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for security_group in response['SecurityGroups']:
       for permission in security_group['IpPermissions']:
           for range in permission['IpRanges']:
               if permission['FromPort'] <= 80 and permission['ToPort'] >= 80 and range['CidrIp'] == '0.0.0.0/0':
                   print(f"Unrestricted HTTP access detected in security group: {security_group['GroupName']}")
   ```

4. Run the script:
   You can run the script using the Python interpreter. The script will print the names of all security groups that allow unrestricted HTTP access. If no such security groups are found, the script will not print anything.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of unrestricted HTTP access in AWS, you can follow the below steps:

1. Login to your AWS console.
2. Go to the EC2 dashboard.
3. Click on the "Security Groups" option on the left-hand side menu.
4. Select the security group that is associated with the instance that has unrestricted HTTP access.
5. Click on the "Inbound Rules" tab.
6. Find the rule that allows unrestricted HTTP access (port 80).
7. Click on the "Edit" button for that rule.
8. Change the source from "0.0.0.0/0" to a specific IP address or range of IP addresses that you want to allow access from.
9. Click on the "Save" button to save the changes.

By following these steps, you have remediated the issue of unrestricted HTTP access in AWS by restricting access to a specific IP address or range of IP addresses.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups
   ```

3. Identify the security group that has unrestricted HTTP access. You can do this by looking for security groups that have port 80 open to the entire internet (0.0.0.0/0).

4. Once you have identified the security group, run the following command to update the inbound rules of the security group to only allow HTTP access from specific IP addresses or CIDR blocks:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 80 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you want to remediate.

5. After running the above command, you can verify that the inbound rule for port 80 has been updated by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you updated.

6. Verify that the inbound rule for port 80 is now restricted to specific IP addresses or CIDR blocks.

By following the above steps, you can remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the unrestricted HTTP access misconfiguration in AWS using Python, you can follow these steps:

1. Identify the security group(s) associated with the EC2 instance(s) that have unrestricted HTTP access.

2. Use the AWS SDK for Python (boto3) to modify the inbound rules of the security group(s) to allow HTTP access only from trusted sources.

Here's a sample Python code snippet to remediate the misconfiguration:

```python
import boto3

# Replace <SECURITY_GROUP_ID> with the ID of the security group that needs to be remediated
security_group_id = '<SECURITY_GROUP_ID>'

# Create an EC2 client
ec2 = boto3.client('ec2')

# Get the current inbound rules of the security group
response = ec2.describe_security_groups(GroupIds=[security_group_id])
current_rules = response['SecurityGroups'][0]['IpPermissions']

# Modify the inbound rules to allow HTTP access only from trusted sources
new_rules = [
    {
        'IpProtocol': 'tcp',
        'FromPort': 80,
        'ToPort': 80,
        'IpRanges': [
            {
                'CidrIp': '<TRUSTED_CIDR>',
                'Description': 'Allow HTTP access from trusted source'
            }
        ]
    }
]

# Revoke the existing rules and authorize the new rules
ec2.revoke_security_group_ingress(GroupId=security_group_id, IpPermissions=current_rules)
ec2.authorize_security_group_ingress(GroupId=security_group_id, IpPermissions=new_rules)
```

In the above code, replace `<SECURITY_GROUP_ID>` with the ID of the security group that needs to be remediated and `<TRUSTED_CIDR>` with the CIDR block of the trusted source that should have HTTP access to the EC2 instance(s). 

Note: Make sure to test this code in a non-production environment before applying it to a production environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
