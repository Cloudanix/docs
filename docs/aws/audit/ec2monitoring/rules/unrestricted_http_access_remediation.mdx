
### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "NETWORK & SECURITY" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. Here, you can see all the inbound rules for this security group. If there is a rule that allows unrestricted HTTP access (i.e., the rule has "HTTP" as its type and "0.0.0.0/0" or "::/0" as its source), then this is a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all security groups: Use the following command to list all the security groups in your AWS account.

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].{Name:GroupName,ID:GroupId}"
   ```

3. Check the inbound rules for each security group: For each security group, you need to check the inbound rules to see if they allow unrestricted HTTP access. You can do this using the following command, replacing `SECURITY_GROUP_ID` with the ID of the security group you want to check.

   ```
   aws ec2 describe-security-groups --group-ids SECURITY_GROUP_ID --query 'SecurityGroups[*].IpPermissions[*].{IP:IpRanges,Protocol:IpProtocol,Port:FromPort}'
   ```

4. Analyze the output: The output of the above command will show you the IP ranges, protocols, and ports for the inbound rules of the security group. If you see an IP range of `0.0.0.0/0` (which means all IP addresses) and a protocol of `tcp` with a port of `80` (which means HTTP), then unrestricted HTTP access is allowed.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to list all security groups and their rules:
   You can use the `describe_security_groups` function to get a list of all security groups and their rules. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for security_group in response['SecurityGroups']:
       for permission in security_group['IpPermissions']:
           for range in permission['IpRanges']:
               print(f"Security Group: {security_group['GroupName']}, Protocol: {permission['IpProtocol']}, Port Range: {permission['FromPort']}-{permission['ToPort']}, IP Range: {range['CidrIp']}")
   ```

3. Check for unrestricted HTTP access:
   Unrestricted HTTP access means that the security group allows traffic from any IP address (0.0.0.0/0) on port 80. You can add a check for this in your script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for security_group in response['SecurityGroups']:
       for permission in security_group['IpPermissions']:
           for range in permission['IpRanges']:
               if permission['FromPort'] <= 80 and permission['ToPort'] >= 80 and range['CidrIp'] == '0.0.0.0/0':
                   print(f"Unrestricted HTTP access detected in security group: {security_group['GroupName']}")
   ```

4. Run the script:
   You can run the script using the Python interpreter. The script will print the names of all security groups that allow unrestricted HTTP access. If no such security groups are found, the script will not print anything.
</Accordion>

</AccordionGroup>
</Tab>
<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of unrestricted HTTP access in AWS, you can follow the below steps:

1. Login to your AWS console.
2. Go to the EC2 dashboard.
3. Click on the "Security Groups" option on the left-hand side menu.
4. Select the security group that is associated with the instance that has unrestricted HTTP access.
5. Click on the "Inbound Rules" tab.
6. Find the rule that allows unrestricted HTTP access (port 80).
7. Click on the "Edit" button for that rule.
8. Change the source from "0.0.0.0/0" to a specific IP address or range of IP addresses that you want to allow access from.
9. Click on the "Save" button to save the changes.

By following these steps, you have remediated the issue of unrestricted HTTP access in AWS by restricting access to a specific IP address or range of IP addresses.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups
   ```

3. Identify the security group that has unrestricted HTTP access. You can do this by looking for security groups that have port 80 open to the entire internet (0.0.0.0/0).

4. Once you have identified the security group, run the following command to update the inbound rules of the security group to only allow HTTP access from specific IP addresses or CIDR blocks:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 80 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you want to remediate.

5. After running the above command, you can verify that the inbound rule for port 80 has been updated by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you updated.

6. Verify that the inbound rule for port 80 is now restricted to specific IP addresses or CIDR blocks.

By following the above steps, you can remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the unrestricted HTTP access misconfiguration in AWS using Python, you can follow these steps:

1. Identify the security group(s) associated with the EC2 instance(s) that have unrestricted HTTP access.

2. Use the AWS SDK for Python (boto3) to modify the inbound rules of the security group(s) to allow HTTP access only from trusted sources.

Here's a sample Python code snippet to remediate the misconfiguration:

```python
import boto3

# Replace <SECURITY_GROUP_ID> with the ID of the security group that needs to be remediated
security_group_id = '<SECURITY_GROUP_ID>'

# Create an EC2 client
ec2 = boto3.client('ec2')

# Get the current inbound rules of the security group
response = ec2.describe_security_groups(GroupIds=[security_group_id])
current_rules = response['SecurityGroups'][0]['IpPermissions']

# Modify the inbound rules to allow HTTP access only from trusted sources
new_rules = [
    {
        'IpProtocol': 'tcp',
        'FromPort': 80,
        'ToPort': 80,
        'IpRanges': [
            {
                'CidrIp': '<TRUSTED_CIDR>',
                'Description': 'Allow HTTP access from trusted source'
            }
        ]
    }
]

# Revoke the existing rules and authorize the new rules
ec2.revoke_security_group_ingress(GroupId=security_group_id, IpPermissions=current_rules)
ec2.authorize_security_group_ingress(GroupId=security_group_id, IpPermissions=new_rules)
```

In the above code, replace `<SECURITY_GROUP_ID>` with the ID of the security group that needs to be remediated and `<TRUSTED_CIDR>` with the CIDR block of the trusted source that should have HTTP access to the EC2 instance(s). 

Note: Make sure to test this code in a non-production environment before applying it to a production environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
