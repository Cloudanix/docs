

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, select "Security Groups" under the "Network & Security" section.
3. In the main pane, you will see a list of all security groups associated with your EC2 instances. Select the security group you want to inspect.
4. In the lower pane, select the "Inbound rules" tab. This will display all the inbound rules associated with the selected security group.
5. Check if there are any rules that allow unrestricted HTTP access (0.0.0.0/0) on port 80. If such rules exist, it indicates that unrestricted HTTP access is allowed, which is a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all security groups: The first step to detect unrestricted HTTP access is to list all the security groups in your AWS account. You can do this by running the following command: `aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text`

3. Check security group rules: For each security group, you need to check the inbound rules to see if they allow unrestricted HTTP access. You can do this by running the following command for each security group: `aws ec2 describe-security-groups --group-ids <security-group-id> --query "SecurityGroups[*].IpPermissions[*]" --output json`

4. Analyze the output: The output of the above command will be a JSON object that contains the details of the inbound rules for the security group. You need to analyze this output to see if there are any rules that allow unrestricted HTTP access. Specifically, you need to look for rules where the `IpProtocol` is `tcp`, the `FromPort` is `80`, and the `IpRanges.CidrIp` is `0.0.0.0/0`. If such a rule exists, then unrestricted HTTP access is allowed.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   First, you need to install Boto3. You can do this by running the command `pip install boto3`. After installing Boto3, you need to configure it. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, AWS Secret Access Key, Default region name, and Default output format when prompted.

2. Import necessary libraries and establish a client connection:
   In your Python script, you need to import the Boto3 library. Then, establish a client connection to AWS. Here is an example of how to do this:

   ```python
   import boto3

   ec2 = boto3.client('ec2')
   ```

3. Retrieve and analyze security group rules:
   Next, you need to retrieve the security group rules for your EC2 instances. You can do this by using the `describe_security_groups` function. Then, you need to analyze these rules to see if any of them allow unrestricted HTTP access. Here is an example of how to do this:

   ```python
   response = ec2.describe_security_groups()

   for group in response['SecurityGroups']:
       for permission in group['IpPermissions']:
           if permission['FromPort'] == 80 and permission['ToPort'] == 80:
               for range in permission['IpRanges']:
                   if range['CidrIp'] == '0.0.0.0/0':
                       print(f"Security Group {group['GroupId']} allows unrestricted HTTP access.")
   ```

4. Run the script:
   Finally, you need to run your Python script. You can do this by navigating to the directory where your script is located in your terminal and then running the command `python script_name.py`, replacing `script_name.py` with the name of your script. If any security groups allow unrestricted HTTP access, they will be printed to the console.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of unrestricted HTTP access in AWS, you can follow the below steps:

1. Login to your AWS console.
2. Go to the EC2 dashboard.
3. Click on the "Security Groups" option on the left-hand side menu.
4. Select the security group that is associated with the instance that has unrestricted HTTP access.
5. Click on the "Inbound Rules" tab.
6. Find the rule that allows unrestricted HTTP access (port 80).
7. Click on the "Edit" button for that rule.
8. Change the source from "0.0.0.0/0" to a specific IP address or range of IP addresses that you want to allow access from.
9. Click on the "Save" button to save the changes.

By following these steps, you have remediated the issue of unrestricted HTTP access in AWS by restricting access to a specific IP address or range of IP addresses.

#### Using CLI

To remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups
   ```

3. Identify the security group that has unrestricted HTTP access. You can do this by looking for security groups that have port 80 open to the entire internet (0.0.0.0/0).

4. Once you have identified the security group, run the following command to update the inbound rules of the security group to only allow HTTP access from specific IP addresses or CIDR blocks:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 80 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you want to remediate.

5. After running the above command, you can verify that the inbound rule for port 80 has been updated by running the following command:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that you updated.

6. Verify that the inbound rule for port 80 is now restricted to specific IP addresses or CIDR blocks.

By following the above steps, you can remediate the "Unrestricted HTTP Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI.

#### Using Python

To remediate the unrestricted HTTP access misconfiguration in AWS using Python, you can follow these steps:

1. Identify the security group(s) associated with the EC2 instance(s) that have unrestricted HTTP access.

2. Use the AWS SDK for Python (boto3) to modify the inbound rules of the security group(s) to allow HTTP access only from trusted sources.

Here's a sample Python code snippet to remediate the misconfiguration:

```python
import boto3

# Replace <SECURITY_GROUP_ID> with the ID of the security group that needs to be remediated
security_group_id = '<SECURITY_GROUP_ID>'

# Create an EC2 client
ec2 = boto3.client('ec2')

# Get the current inbound rules of the security group
response = ec2.describe_security_groups(GroupIds=[security_group_id])
current_rules = response['SecurityGroups'][0]['IpPermissions']

# Modify the inbound rules to allow HTTP access only from trusted sources
new_rules = [
    {
        'IpProtocol': 'tcp',
        'FromPort': 80,
        'ToPort': 80,
        'IpRanges': [
            {
                'CidrIp': '<TRUSTED_CIDR>',
                'Description': 'Allow HTTP access from trusted source'
            }
        ]
    }
]

# Revoke the existing rules and authorize the new rules
ec2.revoke_security_group_ingress(GroupId=security_group_id, IpPermissions=current_rules)
ec2.authorize_security_group_ingress(GroupId=security_group_id, IpPermissions=new_rules)
```

In the above code, replace `<SECURITY_GROUP_ID>` with the ID of the security group that needs to be remediated and `<TRUSTED_CIDR>` with the CIDR block of the trusted source that should have HTTP access to the EC2 instance(s). 

Note: Make sure to test this code in a non-production environment before applying it to a production environment.


</Tab>
</Tabs>