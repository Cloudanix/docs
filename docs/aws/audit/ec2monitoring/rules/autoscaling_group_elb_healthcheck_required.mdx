---
slug: autoscaling_group_elb_healthcheck_required
title: Autoscaling Groups Health Checks Should Be Checked
sidebar_label: Autoscaling Groups Health Checks Should Be Checked
---

### More Info:

This rule checks if your Amazon EC2 Auto Scaling groups that are associated with a Classic Load Balancer use Elastic Load Balancing health checks. The rule is NON_COMPLIANT if the Amazon EC2 Auto Scaling groups are not using Elastic Load Balancing health checks.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP,RBI_MD_ITF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent misconfigurations related to Autoscaling Groups Health Checks in EC2 using the AWS Management Console, follow these steps:

1. **Navigate to the EC2 Dashboard:**
   - Open the AWS Management Console.
   - In the Services menu, select "EC2" to go to the EC2 Dashboard.

2. **Access Auto Scaling Groups:**
   - In the left-hand navigation pane, under "Auto Scaling," click on "Auto Scaling Groups."

3. **Select the Auto Scaling Group:**
   - From the list of Auto Scaling Groups, select the one you want to configure.
   - Click on the group name to open its details.

4. **Configure Health Checks:**
   - In the Auto Scaling Group details, go to the "Details" tab.
   - Click the "Edit" button.
   - Ensure that the "Health Check Type" is set to both "EC2" and "ELB" (if applicable).
   - Set an appropriate "Health Check Grace Period" to allow instances time to start up before health checks begin.
   - Click "Update" to save the changes.

By following these steps, you can ensure that your Auto Scaling Groups are properly configured to perform health checks, thereby preventing potential misconfigurations.
</Accordion>

<Accordion title='Using CLI'>
To prevent misconfigurations related to Autoscaling Groups Health Checks in EC2 using AWS CLI, you can follow these steps:

1. **Create or Update an Auto Scaling Group with Health Check Type:**
   Ensure that the Auto Scaling group is configured to use both EC2 and ELB health checks. This can be done when creating or updating the Auto Scaling group.

   ```sh
   aws autoscaling create-auto-scaling-group \
     --auto-scaling-group-name my-asg \
     --launch-configuration-name my-launch-config \
     --min-size 1 \
     --max-size 5 \
     --desired-capacity 2 \
     --vpc-zone-identifier subnet-12345678 \
     --health-check-type ELB \
     --health-check-grace-period 300
   ```

   Or, if updating an existing Auto Scaling group:

   ```sh
   aws autoscaling update-auto-scaling-group \
     --auto-scaling-group-name my-asg \
     --health-check-type ELB \
     --health-check-grace-period 300
   ```

2. **Verify Health Check Configuration:**
   After creating or updating the Auto Scaling group, verify that the health check type is correctly set.

   ```sh
   aws autoscaling describe-auto-scaling-groups \
     --auto-scaling-group-names my-asg \
     --query 'AutoScalingGroups[*].{HealthCheckType:HealthCheckType,HealthCheckGracePeriod:HealthCheckGracePeriod}'
   ```

3. **Set Up Notifications for Health Check Failures:**
   Configure notifications to alert you when instances fail health checks. This can help in proactive monitoring and quick remediation.

   ```sh
   aws autoscaling put-notification-configuration \
     --auto-scaling-group-name my-asg \
     --topic-arn arn:aws:sns:us-west-2:123456789012:my-sns-topic \
     --notification-types autoscaling:EC2_INSTANCE_TERMINATE,autoscaling:EC2_INSTANCE_LAUNCH
   ```

4. **Regularly Review and Update Health Check Settings:**
   Periodically review the health check settings to ensure they are still appropriate for your application and update them if necessary.

   ```sh
   aws autoscaling describe-auto-scaling-groups \
     --query 'AutoScalingGroups[*].{AutoScalingGroupName:AutoScalingGroupName,HealthCheckType:HealthCheckType,HealthCheckGracePeriod:HealthCheckGracePeriod}'
   ```

By following these steps, you can ensure that your Auto Scaling groups in AWS EC2 are properly configured to use health checks, thereby preventing potential misconfigurations.
</Accordion>

<Accordion title='Using Python'>
To prevent misconfigurations related to Autoscaling Groups Health Checks in EC2 using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that health checks are properly configured for your Auto Scaling groups:

### Step 1: Install Boto3
First, ensure that you have Boto3 installed. You can install it using pip if you haven't already:
```bash
pip install boto3
```

### Step 2: Set Up AWS Credentials
Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by directly configuring the `~/.aws/credentials` file.

### Step 3: Create a Python Script to Check and Configure Health Checks
Here's a Python script that checks and configures health checks for your Auto Scaling groups:

```python
import boto3

def configure_health_checks(asg_name, health_check_type='EC2', health_check_grace_period=300):
    # Create a session using your AWS credentials
    session = boto3.Session()
    
    # Create an Auto Scaling client
    asg_client = session.client('autoscaling')
    
    # Describe the Auto Scaling group to get its current configuration
    response = asg_client.describe_auto_scaling_groups(
        AutoScalingGroupNames=[asg_name]
    )
    
    if not response['AutoScalingGroups']:
        print(f"No Auto Scaling group found with name {asg_name}")
        return
    
    asg = response['AutoScalingGroups'][0]
    
    # Check current health check configuration
    current_health_check_type = asg['HealthCheckType']
    current_health_check_grace_period = asg['HealthCheckGracePeriod']
    
    if current_health_check_type != health_check_type or current_health_check_grace_period != health_check_grace_period:
        # Update the Auto Scaling group with the desired health check configuration
        asg_client.update_auto_scaling_group(
            AutoScalingGroupName=asg_name,
            HealthCheckType=health_check_type,
            HealthCheckGracePeriod=health_check_grace_period
        )
        print(f"Updated health check configuration for Auto Scaling group {asg_name}")
    else:
        print(f"Health check configuration for Auto Scaling group {asg_name} is already correct")

# Example usage
configure_health_checks('my-auto-scaling-group', health_check_type='ELB', health_check_grace_period=300)
```

### Step 4: Run the Script
Run the script to ensure that your Auto Scaling groups have the correct health check configuration. You can schedule this script to run periodically using a cron job or a similar scheduling tool to ensure continuous compliance.

```bash
python configure_health_checks.py
```

### Summary
1. **Install Boto3**: Ensure Boto3 is installed.
2. **Set Up AWS Credentials**: Configure your AWS credentials.
3. **Create a Python Script**: Write a script to check and configure health checks for Auto Scaling groups.
4. **Run the Script**: Execute the script to enforce the desired configuration.

By following these steps, you can prevent misconfigurations related to Autoscaling Groups Health Checks in EC2 using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, choose 'Auto Scaling groups' under the 'AUTO SCALING' section.

3. Select the Auto Scaling group that you want to check. 

4. In the 'Details' tab, check the 'Health checks' section. It should be set to 'ELB' or 'EC2' and the 'Health check grace period' should be configured appropriately. If these are not set, it indicates a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Auto Scaling groups: Use the following command to list all the Auto Scaling groups in your AWS account:

   ```
   aws autoscaling describe-auto-scaling-groups
   ```

   This command will return a JSON object that contains information about all the Auto Scaling groups in your account.

3. Check the Health Check settings: In the returned JSON object, look for the `HealthCheckType` and `HealthCheckGracePeriod` attributes. The `HealthCheckType` attribute indicates the type of health check used for the instances in the group. It should be set to `ELB` if you want Elastic Load Balancing to determine the health status of your instances. The `HealthCheckGracePeriod` attribute indicates the length of time that Auto Scaling waits before checking the health status of an instance.

4. Analyze the output: If the `HealthCheckType` is not set to `ELB` or the `HealthCheckGracePeriod` is not set to a sufficient length of time, then your Auto Scaling group is not properly configured to check the health of its instances.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Now, create an EC2 resource object using the session object. Then, iterate over all your Auto Scaling groups and check the health check type:

```python
autoscaling = session.client('autoscaling')

response = autoscaling.describe_auto_scaling_groups()

for group in response['AutoScalingGroups']:
    if group['HealthCheckType'] != 'ELB':
        print(f"Auto Scaling Group {group['AutoScalingGroupName']} is misconfigured. Health checks are not enabled.")
```

4. This script will print out the names of all Auto Scaling groups where health checks are not enabled. If no such groups are found, the script will not output anything. 

Remember to replace 'YOUR_ACCESS_KEY', 'YOUR_SECRET_KEY', and 'YOUR_REGION' with your actual AWS credentials and the region you're working in.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Autoscaling Groups Health Checks not being checked in AWS EC2 using the AWS console, follow these step-by-step instructions:

1. **Login to AWS Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and login to your account.

2. **Navigate to EC2 Dashboard**: Click on the "Services" dropdown menu at the top left corner and select "EC2" under the Compute section.

3. **Select Autoscaling Groups**: In the EC2 Dashboard, under the "Auto Scaling" section in the left-hand menu, click on "Auto Scaling Groups".

4. **Select the Autoscaling Group**: Click on the Autoscaling Group that you want to remediate the health check misconfiguration for.

5. **Edit Autoscaling Group Settings**: In the Autoscaling Group details page, click on the "Edit" button to modify the group settings.

6. **Update Health Check Configuration**: Scroll down to the "Health check type" section and ensure that the "Health check type" is set to "EC2" or "ELB" based on your requirements.

7. **Configure Health Check Parameters**: Configure the health check parameters such as "Grace period" and "Health check grace period" based on your application's requirements.

8. **Save Changes**: After updating the health check configuration, click on the "Update" or "Save" button to apply the changes to the Autoscaling Group.

9. **Verify Configuration**: Once the changes are saved, verify the health check configuration by checking the status of the Autoscaling Group and monitoring the health of the instances.

By following these steps, you can successfully remediate the misconfiguration of Autoscaling Groups Health Checks not being checked in AWS EC2 using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of Autoscaling Groups Health Checks not being checked for AWS EC2 using AWS CLI, follow these steps:

1. List all the autoscaling groups in your AWS account to identify the group that needs to be updated:
```bash
aws autoscaling describe-auto-scaling-groups
```

2. Identify the Autoscaling Group that needs to have health checks enabled and note down the name of the Autoscaling Group.

3. Update the Autoscaling Group to enable health checks by running the following command, replacing `<autoscaling-group-name>` with the actual name of the Autoscaling Group:
```bash
aws autoscaling update-auto-scaling-group --auto-scaling-group-name <autoscaling-group-name> --health-check-type EC2 --health-check-grace-period 300
```
In this command, we are setting the health check type to EC2 and the health check grace period to 300 seconds. You can adjust the health check type and grace period as needed.

4. Verify that the health checks have been successfully enabled for the Autoscaling Group by describing the Autoscaling Group again:
```bash
aws autoscaling describe-auto-scaling-groups --auto-scaling-group-names <autoscaling-group-name>
```

By following these steps, you can remediate the misconfiguration of Autoscaling Groups Health Checks not being checked for AWS EC2 using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of Autoscaling Groups Health Checks not being checked in AWS EC2 using Python, you can follow these steps:

1. **Import Boto3 Library**: Boto3 is the AWS SDK for Python, which allows Python developers to write software that makes use of services like Amazon S3 and Amazon EC2. You need to have Boto3 installed in your Python environment.

```python
import boto3
```

2. **Initialize Boto3 EC2 Client**: To interact with the EC2 service, you need to create a Boto3 EC2 client.

```python
ec2_client = boto3.client('ec2')
```

3. **Get Autoscaling Groups**: Use the `describe_auto_scaling_groups` method to get a list of all Autoscaling Groups in your AWS account.

```python
response = ec2_client.describe_auto_scaling_groups()
auto_scaling_groups = response['AutoScalingGroups']
```

4. **Enable Health Checks**: For each Autoscaling Group, check if the health check is enabled. If not, update the Autoscaling Group to enable health checks.

```python
for asg in auto_scaling_groups:
    if not asg['HealthCheckType']:
        ec2_client.update_auto_scaling_group(
            AutoScalingGroupName=asg['AutoScalingGroupName'],
            HealthCheckType='EC2',
            HealthCheckGracePeriod=300
        )
```

5. **Complete Python Script**:

```python
import boto3

ec2_client = boto3.client('ec2')

response = ec2_client.describe_auto_scaling_groups()
auto_scaling_groups = response['AutoScalingGroups']

for asg in auto_scaling_groups:
    if not asg['HealthCheckType']:
        ec2_client.update_auto_scaling_group(
            AutoScalingGroupName=asg['AutoScalingGroupName'],
            HealthCheckType='EC2',
            HealthCheckGracePeriod=300
        )
```

6. **Run the Python Script**: Save the script in a file (e.g., `remediate_health_checks.py`) and run it using Python. Make sure your AWS credentials are properly configured on your system.

```bash
python remediate_health_checks.py
```

By following these steps, you can remediate the misconfiguration of Autoscaling Groups Health Checks not being checked in AWS EC2 using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

