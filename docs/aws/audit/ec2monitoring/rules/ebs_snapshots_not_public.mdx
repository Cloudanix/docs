---
slug: ebs_snapshots_not_public
title: EC2 Instance Snapshots Should Not Be Public
sidebar_label: EC2 Instance Snapshots Should Not Be Public
---

### More Info:

Your EC2 instance snapshots should not be publicly accessible. This is to avoid exposing your private data.

### Risk Level

Critical

### Address

Security

### Compliance Standards

HIPAA, NIST, HITRUST, SOC2, GDPR, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under 'Elastic Block Store', click 'Snapshots'.

3. In the 'Snapshots' page, select the snapshot that you want to check.

4. In the 'Description' tab at the bottom of the page, look for the 'Permissions' section. If the 'Public' field is set to 'Yes', then the snapshot is publicly accessible. If it's set to 'No', then the snapshot is not publicly accessible. 

Remember, it's a best practice to restrict access to your EC2 instance snapshots and ensure they are not publicly accessible to prevent unauthorized access to your data.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all snapshots: Use the following AWS CLI command to list all the snapshots in your AWS account:

   ```
   aws ec2 describe-snapshots --owner-ids 'your_aws_account_id'
   ```

   Replace 'your_aws_account_id' with your actual AWS account ID. This command will return a JSON output with details of all the snapshots.

3. Check the permissions of each snapshot: In the JSON output, look for the 'CreateVolumePermissions' field for each snapshot. If this field contains a 'Group' with the value 'all', it means the snapshot is public. Here is an example of a public snapshot:

   ```
   "CreateVolumePermissions": [
       {
           "Group": "all"
       }
   ]
   ```

4. Automate the process with a script: You can write a Python script using the boto3 library to automate this process. The script would use the `describe_snapshots` and `describe_snapshot_attribute` methods to get the details of all snapshots and their permissions, and then check if any of them are public.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, you can use the EC2 resource from this session to get all the snapshots and check their permissions:

```python
ec2_resource = session.resource('ec2')

snapshots = ec2_resource.snapshots.filter(OwnerIds=['self'])

for snapshot in snapshots:
    acl = snapshot.describe_attribute(Attribute='createVolumePermission')
    if acl['CreateVolumePermissions']:
        print(f"Snapshot {snapshot.id} is public")
```

4. This script will print the IDs of all snapshots that are public. If no snapshot is public, it won't print anything. This is because the 'CreateVolumePermissions' attribute is an empty list for private snapshots, and a list containing at least one dictionary for public snapshots. The dictionary contains the 'Group' key with the value 'all' if the snapshot is public.

</Tab>


<Tab title='Remediation'>
### Remediation

To remediate the issue of public EBS snapshots, we can use the following approaches:

#### Using Console

1. **Sign in to the AWS Management Console**.
2. **Navigate to the EC2 service**.
3. **Select Snapshots from the navigation pane**.
4. **Identify public snapshots**:
   - Look for snapshots listed in the console that have permissions set to "all".
5. **Select the public snapshot**.
6. **Modify Snapshot Permissions**:
   - Click on Actions > Modify Snapshot Permissions.
   - Remove the "all" group permission if it exists.
   - Add or modify permissions as necessary.
7. **Repeat for other public snapshots**:
   - Repeat the above steps for all public snapshots identified.

#### Using CLI

1. **List EBS Snapshots**:
```bash
aws ec2 describe-snapshots
```
2. **Identify public snapshots**:
   - Look for snapshots where the volume permissions include the "all" group.
3. **Modify Snapshot Permissions**:
```bash
aws ec2 modify-snapshot-attribute --snapshot-id SNAPSHOT_ID --remove-group all
```
Replace `SNAPSHOT_ID` with the identifier of the public snapshot.
4. **Repeat for other public snapshots**:
   - Repeat the modification command for all public snapshots identified.

#### Using Python

Here's a Python script to identify and remediate public EBS snapshots:

```python
import boto3

class EBSSnapshotChecker:
    def __init__(self):
        self.ec2_client = boto3.client('ec2')

    def get_public_snapshots(self):
        failures = []
        response = self.ec2_client.describe_snapshots(OwnerIds=['self'])
        for snapshot in response['Snapshots']:
            if self.is_snapshot_public(snapshot):
                failures.append(snapshot)
        return failures

    def is_snapshot_public(self, snapshot):
        for permission in snapshot.get("Permissions", []):
            if permission.get("Group", "") == "all":
                return True
        return False

    def remediate_public_snapshot(self, snapshot_id):
        self.ec2_client.modify_snapshot_attribute(
            SnapshotId=snapshot_id,
            Attribute='createVolumePermission',
            OperationType='remove',
            GroupNames=['all']
        )
        print(f"Snapshot {snapshot_id} has been remediated.")

# Instantiate the class
checker = EBSSnapshotChecker()

# Get public snapshots
public_snapshots = checker.get_public_snapshots()

# Remediate public snapshots
for snapshot in public_snapshots:
    checker.remediate_public_snapshot(snapshot['SnapshotId'])
```

This Python script identifies public EBS snapshots by checking if the permissions include the "all" group and then remediates them by removing the permission.

Ensure to have appropriate IAM permissions for modifying EBS snapshots if you're using AWS CLI or Python script.

### Additional Reading:

- [https://aws.amazon.com/premiumsupport/trustedadvisor/best-practices/](https://aws.amazon.com/premiumsupport/trustedadvisor/best-practices/) 


</Tab>
</Tabs>