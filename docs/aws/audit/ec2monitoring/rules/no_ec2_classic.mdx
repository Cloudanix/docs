---
slug: no_ec2_classic
title: EC2 Classic Should Not Be Used
sidebar_label: EC2 Classic Should Not Be Used
---

### More Info:

VPC should be used for EC2 instances instead of using EC2 Classic. VPCs are the latest and more secure method of launching AWS resources.

### Risk Level

Low

### Address

Security, Reliability, Operational Maturity

### Compliance Standards

HIPAA, SOC2, NISTCSF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under "EC2 Dashboard", click on "Running Instances". If you donâ€™t have any instances, this section will be empty.

3. Check the "Platform details" of your instances. If any of your instances are in EC2-Classic, the "Platform details" will show "EC2". Instances in a VPC will show a VPC ID under "Platform details".

4. You can also check the "VPC" column in your instances list. If any instance is not associated with a VPC, it's in EC2-Classic.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following AWS CLI command to list all your EC2 instances:

   ```
   aws ec2 describe-instances
   ```

   This command will return a JSON output with details about all your EC2 instances.

3. Check for EC2 Classic instances: EC2 Classic instances are not associated with any VPC. Therefore, you can identify them by looking for instances where the `VpcId` field is `null` or not present. You can do this by using the `jq` command-line JSON processor:

   ```
   aws ec2 describe-instances | jq '.Reservations[].Instances[] | select(.VpcId == null)'
   ```

4. Analyze the output: If the above command returns any instances, it means that you are using EC2 Classic. If it doesn't return anything, it means that you are not using EC2 Classic.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways. The simplest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   It will prompt you for your access key, secret access key, AWS region. These details will be stored in `~/.aws/credentials` and `~/.aws/config` files.

3. Write the Python script: Now you can write a Python script to check if EC2 Classic is being used. Here is a simple script that lists all EC2 instances and checks if any of them are in EC2-Classic:

   ```python
   import boto3

   def check_ec2_classic():
       ec2 = boto3.resource('ec2')
       instances = ec2.instances.all()
       for instance in instances:
           if instance.placement['Tenancy'] == 'default':
               print(f"Instance {instance.id} is using EC2-Classic")

   if __name__ == "__main__":
       check_ec2_classic()
   ```

   This script uses the Boto3 EC2 resource to get all instances and then checks the 'Tenancy' attribute of each instance's placement. If the 'Tenancy' is 'default', it means the instance is in EC2-Classic.

4. Run the Python script: Finally, you can run the Python script using the Python interpreter:

   ```bash
   python check_ec2_classic.py
   ```

   If any instances are using EC2-Classic, their instance IDs will be printed to the console. If no output is produced, it means no instances are using EC2-Classic.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the EC2 Classic misconfiguration in AWS, follow these steps:

1. Login to the AWS Management Console.
2. Navigate to the EC2 dashboard.
3. In the left-hand navigation menu, select "Classic Wizard".
4. Click on "Launch Instance" to launch a new instance.
5. Choose the appropriate AMI and instance type for your needs.
6. In the "Configure Instance Details" section, select the VPC that you want to launch the instance in.
7. In the "Advanced Details" section, expand the "Network Interfaces" section and select the appropriate subnet.
8. Click "Next" to proceed to the "Add Storage" section and configure your storage needs.
9. Continue through the remaining configuration steps until you reach the "Review Instance Launch" page.
10. Review your instance settings and click "Launch" to launch the instance in your selected VPC.

Note: If you have existing EC2 Classic instances, you should migrate them to a VPC as soon as possible. AWS provides a migration wizard to help with this process.

#### Using CLI

To remediate the EC2 Classic misconfiguration in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Run the following command to describe your VPCs:

```
aws ec2 describe-vpcs
```

3. Identify the VPC that you want to use for your EC2 instances.

4. Run the following command to create a new security group in the VPC:

```
aws ec2 create-security-group --group-name my-security-group --description "My security group" --vpc-id <vpc-id>
```

Replace `<vpc-id>` with the ID of the VPC that you want to use.

5. Run the following command to authorize inbound traffic to the security group:

```
aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol tcp --port 22 --cidr 0.0.0.0/0
```

Replace `<security-group-id>` with the ID of the security group that you created in step 4.

6. Launch your EC2 instance in the VPC that you identified in step 3, and specify the security group that you created in step 4.

7. Verify that your EC2 instance is running in the VPC by running the following command:

```
aws ec2 describe-instances --instance-ids <instance-id>
```

Replace `<instance-id>` with the ID of your EC2 instance.

8. Once you have verified that your EC2 instance is running in the correct VPC, terminate any instances that are running in EC2 Classic.

Note: Before terminating any instances, make sure that you have migrated any data or applications to the new VPC.

#### Using Python

To remediate the "EC2 Classic Should Not Be Used" misconfiguration in AWS using Python, you can follow the below steps:

1. Identify all the EC2 instances in the account that are running in the EC2 Classic environment. You can use the boto3 library to list all the instances and check their VPC ID.

```python
import boto3

ec2_client = boto3.client('ec2')

response = ec2_client.describe_instances(
    Filters=[
        {
            'Name': 'instance-state-name',
            'Values': ['running']
        }
    ]
)

for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        if 'VpcId' not in instance:
            # This instance is running in the EC2 Classic environment
            # Add remediation steps for this instance
```

2. For each EC2 Classic instance, launch a new instance in a VPC. You can use the `run_instances` method of the EC2 client to launch a new instance. Make sure to specify the correct VPC ID and subnet ID in the `NetworkInterfaces` parameter.

```python
response = ec2_client.run_instances(
    ImageId='ami-0c55b159cbfafe1f0',
    InstanceType='t2.micro',
    KeyName='my-key-pair',
    MaxCount=1,
    MinCount=1,
    NetworkInterfaces=[
        {
            'DeviceIndex': 0,
            'AssociatePublicIpAddress': True,
            'SubnetId': 'subnet-12345678',
            'Groups': ['sg-0123456789abcdef0'],
            'DeleteOnTermination': True
        }
    ]
)

new_instance_id = response['Instances'][0]['InstanceId']
```

3. Once the new instance is launched, you can terminate the old instance running in the EC2 Classic environment. You can use the `terminate_instances` method of the EC2 client to terminate an instance.

```python
ec2_client.terminate_instances(
    InstanceIds=['i-0123456789abcdef0']
)
```

4. Repeat steps 2 and 3 for all the EC2 Classic instances in the account.

Note: Before implementing any remediation steps, it is recommended to test them in a non-production environment and ensure that they do not cause any unintended side effects.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html](https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html) 


</Tab>
</Tabs>