---
slug: no_ec2_classic
title: EC2 Classic Should Not Be Used
sidebar_label: EC2 Classic Should Not Be Used
---

### More Info:

VPC should be used for EC2 instances instead of using EC2 Classic. VPCs are the latest and more secure method of launching AWS resources.

### Risk Level

Low

### Address

Security, Reliability, Operational Maturity

### Compliance Standards

HIPAA, SOC2, NISTCSF


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under "EC2 Dashboard", click on "Running Instances". If you donâ€™t have any instances, this section will be empty.

3. Check the "Platform details" of your instances. If any of your instances are in EC2-Classic, the "Platform details" will show "EC2". Instances in a VPC will show a VPC ID under "Platform details".

4. You can also check the "VPC" column in your instances list. If any of your instances are in EC2-Classic, the "VPC" column will be empty.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following AWS CLI command to list all your EC2 instances:

   ```
   aws ec2 describe-instances
   ```

   This command will return a JSON output with details about all your EC2 instances.

3. Check for EC2 Classic instances: EC2 Classic instances do not have a VPC ID associated with them. So, you can check for EC2 Classic instances by looking for instances where the VPC ID is null or not present. You can do this by parsing the JSON output from the previous step using a tool like `jq`. Here is an example command:

   ```
   aws ec2 describe-instances | jq -r '.Reservations[].Instances[] | select(.VpcId == null) | .InstanceId'
   ```

   This command will return the IDs of all EC2 Classic instances.

4. If the above command returns any instance IDs, it means that you are using EC2 Classic instances. If it does not return any instance IDs, it means that you are not using any EC2 Classic instances.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The primary library you need is boto3, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Set up AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can set them in your environment variables:

```python
import os
os.environ["AWS_ACCESS_KEY_ID"] = "your_access_key"
os.environ["AWS_SECRET_ACCESS_KEY"] = "your_secret_key"
```

3. Write a Python script to list all EC2 instances: Now, you can write a Python script that uses boto3 to list all your EC2 instances and check if any of them are using the EC2-Classic platform. Here's a simple script that does this:

```python
import boto3

def check_ec2_classic():
    ec2 = boto3.resource('ec2')
    for instance in ec2.instances.all():
        if instance.platform == 'EC2-Classic':
            print(f"Instance {instance.id} is using EC2-Classic")

check_ec2_classic()
```

4. Run the script: Finally, you can run the script. If any of your instances are using the EC2-Classic platform, their IDs will be printed to the console. If no instances are using EC2-Classic, the script will not output anything.

Please note that the above script is a simple example and might need to be adjusted based on your specific needs and environment. For example, you might need to handle pagination if you have a lot of instances, or you might want to handle exceptions in case of API errors.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the EC2 Classic misconfiguration in AWS, follow these steps:

1. Login to the AWS Management Console.
2. Navigate to the EC2 dashboard.
3. In the left-hand navigation menu, select "Classic Wizard".
4. Click on "Launch Instance" to launch a new instance.
5. Choose the appropriate AMI and instance type for your needs.
6. In the "Configure Instance Details" section, select the VPC that you want to launch the instance in.
7. In the "Advanced Details" section, expand the "Network Interfaces" section and select the appropriate subnet.
8. Click "Next" to proceed to the "Add Storage" section and configure your storage needs.
9. Continue through the remaining configuration steps until you reach the "Review Instance Launch" page.
10. Review your instance settings and click "Launch" to launch the instance in your selected VPC.

Note: If you have existing EC2 Classic instances, you should migrate them to a VPC as soon as possible. AWS provides a migration wizard to help with this process.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the EC2 Classic misconfiguration in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine or EC2 instance.

2. Run the following command to describe your VPCs:

```
aws ec2 describe-vpcs
```

3. Identify the VPC that you want to use for your EC2 instances.

4. Run the following command to create a new security group in the VPC:

```
aws ec2 create-security-group --group-name my-security-group --description "My security group" --vpc-id <vpc-id>
```

Replace `<vpc-id>` with the ID of the VPC that you want to use.

5. Run the following command to authorize inbound traffic to the security group:

```
aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol tcp --port 22 --cidr 0.0.0.0/0
```

Replace `<security-group-id>` with the ID of the security group that you created in step 4.

6. Launch your EC2 instance in the VPC that you identified in step 3, and specify the security group that you created in step 4.

7. Verify that your EC2 instance is running in the VPC by running the following command:

```
aws ec2 describe-instances --instance-ids <instance-id>
```

Replace `<instance-id>` with the ID of your EC2 instance.

8. Once you have verified that your EC2 instance is running in the correct VPC, terminate any instances that are running in EC2 Classic.

Note: Before terminating any instances, make sure that you have migrated any data or applications to the new VPC.
</Accordion>

<Accordion title='Using Python'>
To remediate the "EC2 Classic Should Not Be Used" misconfiguration in AWS using Python, you can follow the below steps:

1. Identify all the EC2 instances in the account that are running in the EC2 Classic environment. You can use the boto3 library to list all the instances and check their VPC ID.

```python
import boto3

ec2_client = boto3.client('ec2')

response = ec2_client.describe_instances(
    Filters=[
        {
            'Name': 'instance-state-name',
            'Values': ['running']
        }
    ]
)

for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        if 'VpcId' not in instance:
            # This instance is running in the EC2 Classic environment
            # Add remediation steps for this instance
```

2. For each EC2 Classic instance, launch a new instance in a VPC. You can use the `run_instances` method of the EC2 client to launch a new instance. Make sure to specify the correct VPC ID and subnet ID in the `NetworkInterfaces` parameter.

```python
response = ec2_client.run_instances(
    ImageId='ami-0c55b159cbfafe1f0',
    InstanceType='t2.micro',
    KeyName='my-key-pair',
    MaxCount=1,
    MinCount=1,
    NetworkInterfaces=[
        {
            'DeviceIndex': 0,
            'AssociatePublicIpAddress': True,
            'SubnetId': 'subnet-12345678',
            'Groups': ['sg-0123456789abcdef0'],
            'DeleteOnTermination': True
        }
    ]
)

new_instance_id = response['Instances'][0]['InstanceId']
```

3. Once the new instance is launched, you can terminate the old instance running in the EC2 Classic environment. You can use the `terminate_instances` method of the EC2 client to terminate an instance.

```python
ec2_client.terminate_instances(
    InstanceIds=['i-0123456789abcdef0']
)
```

4. Repeat steps 2 and 3 for all the EC2 Classic instances in the account.

Note: Before implementing any remediation steps, it is recommended to test them in a non-production environment and ensure that they do not cause any unintended side effects.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html](https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html) 

