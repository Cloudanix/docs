---
slug: unused_key_pairs
title: Unused AWS EC2 Key Pairs Should Be Removed
sidebar_label: Unused AWS EC2 Key Pairs Should Be Removed
---

### More Info:

Unused AWS EC2 key pairs should be decommissioned to follow best practices.

### Risk Level

Medium

### Address

Security

### Compliance Standards

AWSWAF


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the EC2 dashboard by selecting "Services" from the top menu, then choosing "EC2" under the "Compute" category.
3. In the EC2 dashboard, under the "Network & Security" section in the left navigation pane, click on "Key Pairs".
4. Here, you can see all the key pairs associated with your AWS account. To identify unused key pairs, you need to cross-verify these key pairs with the ones associated with your EC2 instances. If a key pair is not associated with any running or stopped EC2 instances, it is considered unused.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all EC2 key pairs: Once your AWS CLI is set up, you can list all the EC2 key pairs associated with your AWS account by running the following command:
   ```
   aws ec2 describe-key-pairs
   ```
   This command will return a list of all EC2 key pairs, including their names and fingerprints.

3. Check for unused key pairs: To check for unused key pairs, you need to list all EC2 instances and their associated key pairs. You can do this by running the following command:
   ```
   aws ec2 describe-instances --query 'Reservations[*].Instances[*].[KeyName]' --output text
   ```
   This command will return a list of all EC2 instances and their associated key pairs.

4. Compare the lists: Finally, you need to compare the list of all key pairs with the list of key pairs associated with EC2 instances. Any key pair that is in the first list but not in the second list is unused and should be removed. You can do this comparison manually or write a script to do it for you.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   After installing Boto3, you need to configure it with your AWS credentials. You can do this by creating a file named `~/.aws/credentials`:
   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```
   And also create a file named `~/.aws/config`:
   ```
   [default]
   region=us-east-1
   ```

2. Use Boto3 to list all EC2 key pairs:
   You can use the `describe_key_pairs` method of the EC2 client in Boto3 to list all the key pairs. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_key_pairs()

   print(response)
   ```
   This script will print all the key pairs in your AWS account.

3. Use Boto3 to list all EC2 instances:
   You can use the `describe_instances` method of the EC2 client in Boto3 to list all the EC2 instances. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_instances()

   print(response)
   ```
   This script will print all the EC2 instances in your AWS account.

4. Compare the key pairs used by EC2 instances with the list of all key pairs:
   You can write a script that compares the key pairs used by the EC2 instances with the list of all key pairs. If a key pair is not used by any EC2 instance, it is unused and should be removed. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response_key_pairs = ec2.describe_key_pairs()
   response_instances = ec2.describe_instances()

   used_key_pairs = set()
   for reservation in response_instances['Reservations']:
       for instance in reservation['Instances']:
           used_key_pairs.add(instance['KeyName'])

   all_key_pairs = set()
   for key_pair in response_key_pairs['KeyPairs']:
       all_key_pairs.add(key_pair['KeyName'])

   unused_key_pairs = all_key_pairs - used_key_pairs

   print(unused_key_pairs)
   ```
   This script will print all the unused key pairs in your AWS account.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the issue of Unused AWS EC2 Key Pairs Should Be Removed in AWS using AWS console:

1. Login to AWS console and navigate to the EC2 dashboard.

2. Click on the "Key Pairs" option from the left-hand side menu.

3. Review the list of key pairs that are available. Identify the key pairs that are not being used by any instances.

4. Select the unused key pairs and click on "Actions" button.

5. From the drop-down menu, select "Delete Key Pair".

6. A confirmation window will appear, click on "Delete" to confirm the deletion of the key pair.

7. Repeat this process for all unused key pairs.

By following the above steps, you will be able to remediate the issue of Unused AWS EC2 Key Pairs Should Be Removed in AWS using AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
Here are the step-by-step instructions to remediate the issue of unused AWS EC2 Key Pairs using AWS CLI:

1. Open the AWS CLI on your local machine or EC2 instance.
2. Use the following command to list all the available key pairs:

```
aws ec2 describe-key-pairs
```

3. Identify the key pairs that are not in use and note down their key pair names.
4. Use the following command to delete the unused key pairs:

```
aws ec2 delete-key-pair --key-name <key-pair-name>
```

5. Replace `<key-pair-name>` with the actual name of the key pair you want to delete.
6. Repeat step 4 for all the unused key pairs.
7. Verify that the unused key pairs have been removed by running the command in step 2 again.

Note: Before deleting any key pair, make sure it is not being used by any running instances. If it is being used, first remove it from the instance and then delete it.
</Accordion>

<Accordion title='Using Python'>
Sure, here are the step-by-step instructions to remediate the misconfiguration of unused AWS EC2 key pairs using Python:

1. Import the necessary libraries:

```python
import boto3
```

2. Create a boto3 EC2 client:

```python
ec2 = boto3.client('ec2')
```

3. Retrieve all the key pairs in the AWS account:

```python
key_pairs = ec2.describe_key_pairs()
```

4. Loop through the key pairs and check if they are associated with any running instances:

```python
for key_pair in key_pairs['KeyPairs']:
    key_name = key_pair['KeyName']
    instances = ec2.describe_instances(Filters=[{'Name': 'key-name', 'Values': [key_name]}])
    if len(instances['Reservations']) == 0:
        print('Deleting key pair:', key_name)
        ec2.delete_key_pair(KeyName=key_name)
```

5. The above code will delete all the unused key pairs in the AWS account.

Note: Please make sure to test the code in a non-production environment before running it in a production environment.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-keypairs.html](https://docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-keypairs.html) 

