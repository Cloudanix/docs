---
slug: network_firewall_logging_enabled
title: Network Firewall Logging Should Be Enabled
sidebar_label: Network Firewall Logging Should Be Enabled
---

### More Info:

Ensure network firewall logging is enabled

### Risk Level

Medium

### Address

Operational Maturity, Reliability, Security

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon VPC console at https://console.aws.amazon.com/vpc/.

2. In the navigation pane, choose 'Security Groups'.

3. Select the security group that you want to verify.

4. In the details pane, choose the 'Inbound Rules' tab to view the inbound rules, and the 'Outbound Rules' tab to view the outbound rules.

5. Check if the logging is enabled for the selected security group. If the 'Logging' column is set to 'No', then the Network Firewall Logging is not enabled for the selected security group.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can install AWS CLI by following the instructions provided in the official AWS documentation. Once installed, you can configure it by running the command `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Network ACLs: Once AWS CLI is set up, you can list all the Network ACLs in your account by running the following command: `aws ec2 describe-network-acls`. This command will return a JSON object containing details about all the Network ACLs in your account.

3. Parse the JSON output: You can parse the JSON output from the previous step to check if logging is enabled for each Network ACL. You can do this by using a tool like `jq`. The command would look something like this: `aws ec2 describe-network-acls | jq '.NetworkAcls[].Associations[].NetworkAclId'`.

4. Check if logging is enabled: For each Network ACL ID obtained from the previous step, you can check if logging is enabled by running the following command: `aws ec2 describe-flow-logs --filter "Name=resource-id,Values=<NetworkAclId>"`. If the `FlowLogs` array in the output is empty, it means that logging is not enabled for that Network ACL.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3):
   You need to install Boto3 in your Python environment. You can do this using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by creating the files ~/.aws/credentials and ~/.aws/config:
   ```
   ~/.aws/credentials:
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY

   ~/.aws/config:
   [default]
   region=us-east-1
   ```

2. Use Boto3 to interact with AWS EC2:
   You can use Boto3 to create, configure, and manage AWS services. For EC2, you can use the `boto3.client('ec2')` function to create a client for EC2.

3. Check Network Firewall Logging:
   You can use the `describe_security_groups()` function to get information about your security groups. Then, you can check the `IpPermissions` and `IpPermissionsEgress` fields to see if logging is enabled. Here is a sample script:
   ```python
   import boto3

   ec2 = boto3.client('ec2')

   response = ec2.describe_security_groups()

   for group in response['SecurityGroups']:
       for permission in group['IpPermissions']:
           if 'LOGGING' not in permission:
               print(f"Logging is not enabled for security group {group['GroupId']}")
   ```

4. Analyze the results:
   The script will print out the IDs of the security groups where logging is not enabled. You can use this information to identify the misconfigurations in your EC2 instances.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of Network Firewall Logging not being enabled for AWS EC2 instances, you can follow these steps using the AWS Management Console:

1. **Sign in to the AWS Management Console**: Go to the AWS Management Console (https://aws.amazon.com/console/) and sign in using your credentials.

2. **Navigate to the VPC Dashboard**: Click on the "Services" dropdown in the top left corner of the console and select "VPC" under the Networking & Content Delivery section.

3. **Select the VPC**: In the VPC Dashboard, select the Virtual Private Cloud (VPC) where your EC2 instances are located.

4. **Select the Network ACLs**: In the VPC Dashboard, locate the "Network ACLs" option in the left-hand menu and click on it.

5. **Identify the Network ACL**: Identify the Network Access Control List (NACL) associated with the subnet where your EC2 instances are located. Note down the NACL ID for future reference.

6. **Edit the Network ACL**: Click on the NACL ID to open the details of the Network ACL.

7. **Add a Logging Configuration**: In the Network ACL details, locate the "Network ACL entries" section and click on the "Edit" button.

8. **Enable Logging**: In the Network ACL entries configuration, find the outbound and inbound rules that you want to enable logging for. Click on each rule and check the box for "Log" to enable logging for that rule.

9. **Save the Changes**: After enabling logging for the necessary rules, click on the "Save" button to apply the changes to the Network ACL.

10. **Verify the Configuration**: Once the changes are saved, verify that the Network Firewall Logging is enabled for the selected rules by checking the "Log" column in the Network ACL entries.

By following these steps, you can successfully enable Network Firewall Logging for the Network ACL associated with your AWS EC2 instances, helping you monitor and analyze the network traffic effectively.

#### Using CLI

To remediate the misconfiguration of network firewall logging not being enabled for AWS EC2 instances using AWS CLI, follow these steps:

1. **Enable VPC Flow Logs**: VPC Flow Logs capture information about the IP traffic going to and from network interfaces in your VPC. Run the following AWS CLI command to enable VPC Flow Logs for your VPC:

```bash
aws ec2 create-flow-logs --resource-type VPC --resource-ids <your-vpc-id> --traffic-type ALL --log-group-name <your-log-group-name> --deliver-logs-permission-arn <your-iam-role-arn>
```

Replace `<your-vpc-id>` with the ID of your VPC, `<your-log-group-name>` with the name of the CloudWatch Logs group where the flow logs will be stored, and `<your-iam-role-arn>` with the ARN of the IAM role that has permission to publish logs to CloudWatch Logs.

2. **Enable Security Group Logging**: Security Group Logs provide detailed information about the traffic allowed or denied by security groups associated with your EC2 instances. Run the following AWS CLI command to enable security group logging:

```bash
aws ec2 create-flow-logs --resource-type NetworkInterface --resource-ids <your-network-interface-id> --traffic-type ALL --log-group-name <your-log-group-name> --deliver-logs-permission-arn <your-iam-role-arn>
```

Replace `<your-network-interface-id>` with the ID of the network interface associated with your EC2 instance.

3. **Verify Configuration**: Once you have enabled VPC Flow Logs and Security Group Logs, verify that the logs are being generated and stored in the specified CloudWatch Logs group. You can do this by checking the CloudWatch Logs console or by using the AWS CLI to query the logs.

By following these steps, you can successfully remediate the misconfiguration of network firewall logging not being enabled for AWS EC2 instances using AWS CLI.

#### Using Python

To remediate the network firewall logging misconfiguration for AWS EC2 using Python, you can follow these steps:

1. Import the necessary libraries:
```python
import boto3
```

2. Initialize the AWS EC2 client:
```python
ec2 = boto3.client('ec2')
```

3. Enable VPC Flow Logs for the desired VPC:
```python
response = ec2.create_flow_logs(
    DeliverLogsPermissionArn='arn:aws:iam::123456789012:role/flow-logs-role',
    ResourceIds=['vpc-12345678'],
    ResourceType='VPC',
    TrafficType='ALL',
    LogDestinationType='cloud-watch-logs',
    LogDestination='arn:aws:logs:us-east-1:123456789012:log-group:flow-logs',
)
```
Replace the `DeliverLogsPermissionArn`, `ResourceIds`, and `LogDestination` with your specific values.

4. Verify that the VPC Flow Logs have been enabled successfully:
```python
response = ec2.describe_flow_logs()
for flow_log in response['FlowLogs']:
    print(flow_log)
```

By following these steps, you can use Python to enable network firewall logging for AWS EC2 instances.



</Tab>
</Tabs>