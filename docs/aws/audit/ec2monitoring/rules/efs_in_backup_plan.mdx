---
slug: efs_in_backup_plan
title: Elastic File System Should Be In Backup Plan  
sidebar_label: Elastic File System Should Be In Backup Plan 
---

### More Info:

This rule checks if Amazon Elastic File System (Amazon EFS) file systems are added in the backup plans of AWS Backup. The rule is NON_COMPLIANT if EFS file systems are not included in the backup plans.

### Risk Level

Medium

### Address

Configuration

### Compliance Standards

CBP,SEBI,RBI_MD_ITF,RBI_UCB



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the AWS Backup dashboard. You can do this by typing 'AWS Backup' in the search bar and selecting it from the dropdown menu.
3. In the AWS Backup dashboard, select 'Backup plans' from the left-hand navigation pane. This will display a list of all your backup plans.
4. For each backup plan, click on its name to view its details. Check if the Elastic File System (EFS) is included in the backup resources. If it's not listed, then it's not included in the backup plan, indicating a misconfiguration.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the resources.

2. Once the AWS CLI is set up, you can use the `describe-file-systems` command to list all the EFS file systems in your account. The command is as follows:

   ```
   aws efs describe-file-systems --region your-region-name
   ```
   Replace 'your-region-name' with the name of your AWS region. This command will return a list of file systems along with their details.

3. To check if a file system is included in a backup plan, you need to use the `list-backup-plans` command from AWS Backup service. The command is as follows:

   ```
   aws backup list-backup-plans --region your-region-name
   ```
   This command will return a list of all backup plans in your account.

4. Finally, you need to check if the file system ID from step 2 is included in any of the backup plans from step 3. You can do this by using the `get-backup-plan` command with the backup plan ID as follows:

   ```
   aws backup get-backup-plan --backup-plan-id your-backup-plan-id --region your-region-name
   ```
   Replace 'your-backup-plan-id' with the ID of your backup plan. This command will return the details of the backup plan, including the resources it covers. If the file system ID from step 2 is included in the resources, then the file system is in a backup plan. If not, then it is not in a backup plan.

#### Using Python

To check if Elastic File System (EFS) is included in a backup plan in EC2 using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Set up AWS SDK for Python (Boto3):**
   First, you need to install and configure Boto3. You can install it using pip:

   ```
   pip install boto3
   ```

   Then, configure your AWS credentials. You can do this by setting the following environment variables:

   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **List all EFS file systems:**
   Use the `describe_file_systems` method to list all EFS file systems. Here is a sample script:

   ```python
   import boto3

   efs = boto3.client('efs')

   response = efs.describe_file_systems()

   for file_system in response['FileSystems']:
       print(file_system['FileSystemId'])
   ```

3. **List all backup plans:**
   Use the `list_backup_plans` method to list all backup plans. Here is a sample script:

   ```python
   import boto3

   backup = boto3.client('backup')

   response = backup.list_backup_plans()

   for plan in response['BackupPlansList']:
       print(plan['BackupPlanId'])
   ```

4. **Check if EFS file systems are included in backup plans:**
   For each backup plan, use the `get_backup_plan` method to get the details of the plan, and check if the EFS file system is included. Here is a sample script:

   ```python
   import boto3

   backup = boto3.client('backup')

   for plan in backup.list_backup_plans()['BackupPlansList']:
       plan_details = backup.get_backup_plan(BackupPlanId=plan['BackupPlanId'])
       for resource in plan_details['BackupPlan']['BackupPlanResourceList']:
           if resource['Type'] == 'EFS':
               print(f"EFS {resource['ResourceArn']} is included in backup plan {plan['BackupPlanId']}")
   ```

This script will print the ARN of each EFS file system that is included in a backup plan. If a file system is not included in any backup plan, it will not be printed.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of Elastic File System (EFS) not being included in the backup plan for AWS EC2 instances, you can follow these steps using the AWS Management Console:

1. **Create an EFS Backup Plan**:
   - Go to the AWS Management Console and navigate to the AWS Backup service.
   - Click on "Create backup plan" and provide a name for your backup plan.
   - Select the resources you want to include in the backup plan, in this case, select the Elastic File System (EFS) that you want to backup.
   - Configure the backup settings such as backup frequency, retention period, and backup window according to your requirements.
   - Review and create the backup plan.

2. **Associate EC2 Instances with the Backup Plan**:
   - Go to the AWS Backup service in the AWS Management Console.
   - Click on "Protected resources" and then "Add resource".
   - Select the EC2 instances that are using the EFS that you want to backup.
   - Associate these EC2 instances with the backup plan you created in the previous step.

3. **Verify Backup Configuration**:
   - Once the backup plan is created and EC2 instances are associated with it, verify that the EFS is now included in the backup plan.
   - Check the backup schedule and retention period to ensure that it meets your backup requirements.

By following these steps, you have successfully remediated the misconfiguration of not including Elastic File System (EFS) in the backup plan for AWS EC2 instances. This will help ensure that your EFS data is backed up regularly and can be restored in case of any data loss or corruption.

#### Using CLI

To remediate the misconfiguration of Elastic File System (EFS) not being included in the backup plan for AWS EC2 instances using AWS CLI, you can follow these steps:

1. **Create an EFS Backup Plan**:
   - Use the following AWS CLI command to create a backup plan for the EFS file system:
     ```bash
     aws backup create-backup-plan --backup-plan '{"BackupPlanName": "EFSBackupPlan", "BackupPlanRule": {"RuleName": "EFSBackupRule", "TargetBackupVaultName": "MyBackupVault", "ScheduleExpression": "cron(0 12 * * ? *)"}}'
     ```
   - In the above command, replace `MyBackupVault` with the name of your existing backup vault.

2. **Assign EFS to Backup Plan**:
   - Associate the EFS file system with the backup plan created in the previous step using the following AWS CLI command:
     ```bash
     aws backup associate-file-systems --backup-plan-id <BackupPlanId> --file-system-arns <EFSFileSystemARN>
     ```
   - Replace `<BackupPlanId>` with the ID of the backup plan created in step 1 and `<EFSFileSystemARN>` with the ARN of the EFS file system that needs to be included in the backup plan.

3. **Verify Backup Plan**:
   - Check the backup plan to ensure that the EFS file system is included in the backup schedule using the following AWS CLI command:
     ```bash
     aws backup get-backup-plan --backup-plan-id <BackupPlanId>
     ```
   - Verify that the EFS file system is listed under the resources included in the backup plan.

By following these steps, you can remediate the misconfiguration of not having the Elastic File System included in the backup plan for AWS EC2 instances using AWS CLI.

#### Using Python

To remediate the misconfiguration of Elastic File System not being included in the backup plan for AWS EC2 using Python, you can follow these steps:

1. **Import necessary libraries**: First, you need to import the required Python libraries to interact with AWS services. You can use the `boto3` library for this purpose.

```python
import boto3
```

2. **Initialize AWS client**: Create an AWS client for the EC2 service using `boto3`.

```python
ec2_client = boto3.client('ec2')
```

3. **Get EFS file system ID**: Retrieve the EFS file system ID that needs to be included in the backup plan. You can either provide this ID as input or fetch it programmatically.

```python
efs_file_system_id = 'fs-12345678'  # Replace with your EFS file system ID
```

4. **Create a backup plan**: Define a backup plan that includes the EFS file system for backup. You can specify the backup schedule, retention policy, etc., as per your requirements.

```python
backup_client = boto3.client('backup')

response = backup_client.create_backup_plan(
    BackupPlan={
        'BackupPlanName': 'EFS-Backup-Plan',
        'Rules': [
            {
                'RuleName': 'EFS-Backup-Rule',
                'TargetBackupVaultName': 'MyBackupVault',
                'ScheduleExpression': 'cron(0 0 * * ? *)',  # Daily backup at midnight
                'StartWindowMinutes': 60,
                'CompletionWindowMinutes': 60,
                'Lifecycle': {
                    'DeleteAfterDays': 30  # Retention period
                }
            }
        ]
    }
)
```

5. **Add EFS file system to the backup plan**: Associate the EFS file system with the backup plan created in the previous step.

```python
response = backup_client.associate_file_system(
    BackupPlanId=response['BackupPlanId'],
    FileSystemId=efs_file_system_id
)
```

6. **Verify the backup plan**: You can verify the backup plan settings and ensure that the EFS file system is included in the plan.

```python
response = backup_client.get_backup_plan(
    BackupPlanId=response['BackupPlanId']
)

print(response)
```

By following these steps, you can remediate the misconfiguration of not including the Elastic File System in the backup plan for AWS EC2 using Python.


</Tab>
</Tabs>