

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the Systems Manager service.

2. In the left navigation pane, select "Documents" under the "Shared Resources" section.

3. In the main pane, you will see a list of all SSM documents. Click on the name of the document you want to check.

4. In the document details page, look for the "Document sharing" section. If the document is public, it will be listed as "Public". If it is not public, it will be listed as "Private".

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all SSM Documents: Use the AWS CLI command `aws ssm list-documents` to list all the SSM documents in your account. This command will return a JSON output with details of all the SSM documents.

3. Check the permissions of each SSM Document: For each SSM document, you need to check the permissions. You can do this by running the command `aws ssm describe-document-permission --name "document-name" --permission-type "Share"`. Replace "document-name" with the name of your SSM document. This command will return a list of account IDs that the document is shared with. If the document is public, it will return "All".

4. Analyze the output: If the output from the previous step includes "All", it means that the SSM document is public. If it doesn't, then the document is not public. Repeat steps 3 and 4 for each SSM document in your account.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) in your environment. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

```python
pip install boto3
```

2. Import the necessary libraries and establish a session with AWS using your access and secret keys.

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create a client for 'ssm' which stands for Simple Systems Manager.

```python
ssm = session.client('ssm')
```

4. Now, you can use the `list_documents` method to retrieve all the SSM documents. For each document, use the `describe_document_permission` method to check if the document is public. If the `PermissionType` is 'Share', then the document is public.

```python
response = ssm.list_documents()

for document in response['DocumentIdentifiers']:
    doc_name = document['Name']
    permissions = ssm.describe_document_permission(
        Name=doc_name,
        PermissionType='Share'
    )
    if 'AccountIds' in permissions and '*' in permissions['AccountIds']:
        print(f"SSM Document {doc_name} is public.")
```

This script will print the names of all SSM documents that are public. You can modify it according to your needs.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of SSM document being public in AWS EC2 using the AWS console, follow these steps:

1. **Login to AWS Console**: Go to the AWS Management Console and login with your credentials.

2. **Navigate to Systems Manager (SSM)**: Go to the AWS Systems Manager service by typing "Systems Manager" in the search bar and selecting it from the dropdown.

3. **Access SSM Documents**: In the Systems Manager console, navigate to the left-hand menu and click on "Documents" under the "Shared Resources" section.

4. **Identify Public SSM Documents**: Look through the list of SSM documents to identify the ones that are marked as public. These will have a permission setting indicating that they are public.

5. **Change Document Permissions**:
   - Select the public SSM document by clicking on it.
   - Click on the "Edit" button to modify the document permissions.
   - In the document permissions settings, change the visibility from public to private.
   - Save the changes.

6. **Verify Changes**: After changing the permissions, verify that the SSM document is no longer public by checking the permissions settings.

7. **Monitor for Compliance**: Regularly monitor the SSM documents to ensure that they are not set to public in the future.

By following these steps, you can remediate the issue of SSM documents being public in AWS EC2 using the AWS console.

#### Using CLI

To remediate the issue of an SSM Document being public in AWS EC2 using AWS CLI, follow these steps:

1. **Identify the public SSM Documents**: Run the following AWS CLI command to list all public SSM Documents:
   ```
   aws ssm list-documents --filters Key=Owner,Values=Public
   ```

2. **Update the SSM Document to be private**: You will need to update the SSM Document to be private. You can do this by running the following AWS CLI command:
   ```
   aws ssm modify-document-permission --name "DOCUMENT_NAME" --permission-type "PRIVATE"
   ```
   Replace `DOCUMENT_NAME` with the name of the public SSM Document that you want to make private.

3. **Verify the SSM Document is now private**: To confirm that the SSM Document is now private, you can run the following AWS CLI command:
   ```
   aws ssm describe-document --name "DOCUMENT_NAME"
   ```
   Replace `DOCUMENT_NAME` with the name of the SSM Document you updated.

By following these steps, you can successfully remediate the issue of an SSM Document being public in AWS EC2 using AWS CLI.

#### Using Python

To remediate the misconfiguration of having an SSM Document public for AWS EC2 instances using Python, you can follow these steps:

1. Identify the SSM Document that is public:
   - Use the AWS SDK for Python (Boto3) to list all the SSM Documents in your AWS account.
   - Check the permissions of each SSM Document to identify if any of them are public.

2. Revoke public access to the SSM Document:
   - Use the `modify_document_permission` API provided by Boto3 to update the permissions of the public SSM Document.
   - Set the permissions to restrict public access by removing the 'Allow' permission for the 'Everyone' group.

3. Implement the remediation steps in Python:
   - Install the Boto3 library if you haven't already:
     ```bash
     pip install boto3
     ```
   - Use the following Python script as a reference to identify and revoke public access to the SSM Document:

     ```python
     import boto3

     # Initialize the Boto3 client for AWS Systems Manager (SSM)
     ssm_client = boto3.client('ssm')

     def revoke_public_access_to_ssm_documents():
         # List all SSM Documents
         response = ssm_client.list_documents()

         for document in response['DocumentIdentifiers']:
             document_name = document['Name']
             document_description = ssm_client.describe_document(Name=document_name)
             document_permission = document_description['Document']['Permissions']

             for permission in document_permission:
                 if permission['Type'] == 'Public':
                     # Revoke public access by removing the 'Allow' permission for 'Everyone'
                     ssm_client.modify_document_permission(
                         Name=document_name,
                         PermissionType='Share',
                         AccountIds=[],
                         SharedDocumentVersion='',
                         PermissionLevel='Private'
                     )
                     print(f"Revoked public access for SSM Document: {document_name}")

     if __name__ == '__main__':
         revoke_public_access_to_ssm_documents()
     ```

4. Run the Python script:
   - Save the above Python script in a file (e.g., `remediate_public_ssm_document.py`).
   - Run the script using Python:
     ```bash
     python remediate_public_ssm_document.py
     ```

By following these steps and running the provided Python script, you can successfully remediate the misconfiguration of having a public SSM Document for AWS EC2 instances.


</Tab>
</Tabs>