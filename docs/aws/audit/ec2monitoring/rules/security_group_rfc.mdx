---
slug: security_group_rfc
title: Security Groups Should Not Allow Inbound Traffic From RFC 1918
sidebar_label: Security Groups Should Not Allow Inbound Traffic From RFC 1918
---

### More Info:

No EC2 security group should allow inbound traffic from RFC-1918 CIDRs in order to follow AWS security best practices.

### Risk Level

Low

### Address

Security

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. Select the security group you want to inspect. In the lower pane, click on the "Inbound rules" tab to view the inbound rules associated with the selected security group.
4. Check the "Source" column for each inbound rule. If any rule has a source IP address that falls within the RFC 1918 address space (10.0.0.0 - 10.255.255.255, 172.16.0.0 - 172.31.255.255, 192.168.0.0 - 192.168.255.255), then the security group allows inbound traffic from RFC 1918, which is a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once installed, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all Security Groups: Use the following command to list all the security groups in your AWS account.

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text
   ```

3. Check Inbound Rules: For each security group, check the inbound rules. You can do this by running the following command for each security group.

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id> --query 'SecurityGroups[*].IpPermissions[*].{IP:IpRanges}' --output text
   ```

4. Detect Misconfiguration: If the output of the above command includes any of the following IP ranges, then the security group allows inbound traffic from RFC 1918, which is a misconfiguration.

   ```
   10.0.0.0/8
   172.16.0.0/12
   192.168.0.0/16
   ```

   You can use a script to automate this process and flag any security groups that allow inbound traffic from these ranges.

#### Using Python

1. First, you need to install the AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:

```python
pip install boto3
```

2. Import the necessary modules and create a session using your AWS credentials:

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Now, create an EC2 resource object using the session:

```python
ec2 = session.resource('ec2')
```

4. Now, iterate over all the security groups and check if any of them allow inbound traffic from RFC 1918 addresses (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16):

```python
for security_group in ec2.security_groups.all():
    for permission in security_group.ip_permissions:
        for ip_range in permission['IpRanges']:
            if ip_range['CidrIp'] in ['10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16']:
                print(f"Security Group {security_group.id} allows inbound traffic from RFC 1918 addresses")
```

This script will print the IDs of all security groups that allow inbound traffic from RFC 1918 addresses.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "Security Groups Should Not Allow Inbound Traffic From RFC 1918" for AWS using the AWS console:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 service.
3. Click on "Security Groups" from the left-hand menu.
4. Select the security group that needs to be remediated.
5. Click on the "Inbound Rules" tab.
6. Identify the inbound rule(s) that allow traffic from RFC 1918 addresses (10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16).
7. Click on the "Edit" button for the rule that needs to be remediated.
8. Change the "Source" field to a specific IP address or range that is allowed to access the resource(s) protected by the security group.
9. Alternatively, you can also change the "Source" field to "Custom" and enter an IP address or range that is not part of RFC 1918.
10. Click on the "Save rules" button to apply the changes.

After following these steps, the security group will no longer allow inbound traffic from RFC 1918 addresses.

#### Using CLI

To remediate the misconfiguration "Security Groups Should Not Allow Inbound Traffic From RFC 1918" for AWS using AWS CLI, you can follow the below steps:

Step 1: Identify the Security Group(s) that allow inbound traffic from RFC 1918 IP addresses. 

```
aws ec2 describe-security-groups --filters Name=ip-permission.cidr,Values=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 --query "SecurityGroups[*].{Name:GroupName,ID:GroupId}"
```

This command will list all the security groups that allow inbound traffic from RFC 1918 IP addresses.

Step 2: Revoke the Inbound Rule from the Security Group(s) identified in Step 1.

```
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port <port-number> --cidr <RFC 1918 IP address range>
```

Replace `<security-group-id>` with the ID of the security group, `<port-number>` with the port number that is open to RFC 1918 IP addresses, and `<RFC 1918 IP address range>` with the appropriate RFC 1918 IP address range.

Repeat this command for each security group identified in Step 1.

Step 3: Verify that the Inbound Rule has been revoked.

```
aws ec2 describe-security-groups --group-id <security-group-id> --query "SecurityGroups[*].IpPermissions[*].{Protocol:IpProtocol,FromPort:FromPort,ToPort:ToPort,IPRange:CidrIp}"
```

Replace `<security-group-id>` with the ID of the security group.

This command will list all the inbound rules for the security group. Verify that the rule allowing inbound traffic from RFC 1918 IP addresses has been revoked.

Repeat this command for each security group identified in Step 1.

By following these steps, you can remediate the misconfiguration "Security Groups Should Not Allow Inbound Traffic From RFC 1918" for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of Security Groups allowing inbound traffic from RFC 1918 in AWS using Python, follow these steps:

1. List all the security groups in your AWS account using the `describe_security_groups` method from the `boto3` library.

```python
import boto3

client = boto3.client('ec2')

response = client.describe_security_groups()
security_groups = response['SecurityGroups']
```

2. Iterate through the security groups and for each security group, check if it allows inbound traffic from RFC 1918. If it does, update the security group to remove the rule.

```python
for sg in security_groups:
    for rule in sg['IpPermissions']:
        if 'IpRanges' in rule:
            for ip_range in rule['IpRanges']:
                if 'Description' in ip_range and 'RFC 1918' in ip_range['Description']:
                    sg_id = sg['GroupId']
                    protocol = rule['IpProtocol']
                    from_port = rule['FromPort']
                    to_port = rule['ToPort']
                    cidr_ip = ip_range['CidrIp']
                    client.revoke_security_group_ingress(
                        GroupId=sg_id,
                        IpPermissions=[
                            {
                                'IpProtocol': protocol,
                                'FromPort': from_port,
                                'ToPort': to_port,
                                'IpRanges': [
                                    {
                                        'CidrIp': cidr_ip,
                                        'Description': 'Removed RFC 1918 rule'
                                    },
                                ],
                            },
                        ],
                    )
```

3. After running the script, all the security groups that allow inbound traffic from RFC 1918 will be updated to remove the rule.

Note: Before running the script, make sure you have the necessary permissions to modify security groups in your AWS account.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html) 


</Tab>
</Tabs>