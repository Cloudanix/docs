---
slug: overutilized_ec2_instance
title: EC2 Instances Should Not Be Overutilized
sidebar_label: EC2 Instances Should Not Be Overutilized
---

### More Info:

Overutilized EC2 instances should be upgraded to optimize application response time.

### Risk Level

Low

### Address

Operational Maturity, Reliability

### Compliance Standards

SOC2


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent EC2 instances from being overutilized in AWS using the AWS Management Console, follow these steps:

1. **Set Up CloudWatch Alarms:**
   - Navigate to the **CloudWatch** service in the AWS Management Console.
   - Create alarms for key metrics such as CPU utilization, memory usage, and disk I/O.
   - Set thresholds that will trigger notifications when these metrics exceed acceptable levels.

2. **Enable Auto Scaling:**
   - Go to the **EC2** dashboard and select **Auto Scaling Groups**.
   - Create an Auto Scaling group for your instances.
   - Define scaling policies that will automatically add or remove instances based on the CloudWatch metrics.

3. **Use Elastic Load Balancing (ELB):**
   - Navigate to the **EC2** dashboard and select **Load Balancers**.
   - Create a new load balancer and add your EC2 instances to it.
   - This will distribute incoming traffic across multiple instances, preventing any single instance from becoming overutilized.

4. **Regularly Review and Optimize Instances:**
   - Periodically review the performance of your EC2 instances using the **AWS Cost Explorer** and **Trusted Advisor**.
   - Identify instances that are consistently overutilized and consider resizing them to a larger instance type or optimizing your application to reduce resource consumption.

By following these steps, you can proactively monitor and manage the utilization of your EC2 instances to prevent overutilization.
</Accordion>

<Accordion title='Using CLI'>
To prevent EC2 instances from being overutilized using AWS CLI, you can follow these steps:

1. **Set Up CloudWatch Alarms:**
   - Create CloudWatch alarms to monitor CPU utilization, memory usage, and other relevant metrics. This will help you get notified when an instance is overutilized.
   ```sh
   aws cloudwatch put-metric-alarm --alarm-name "HighCPUUtilization" --metric-name "CPUUtilization" --namespace "AWS/EC2" --statistic "Average" --period 300 --threshold 80 --comparison-operator "GreaterThanThreshold" --dimensions "Name=InstanceId,Value=i-1234567890abcdef0" --evaluation-periods 2 --alarm-actions "arn:aws:sns:us-west-2:123456789012:MyTopic"
   ```

2. **Auto Scaling Groups:**
   - Use Auto Scaling Groups to automatically adjust the number of instances based on demand. This helps in distributing the load and preventing any single instance from being overutilized.
   ```sh
   aws autoscaling create-auto-scaling-group --auto-scaling-group-name my-asg --instance-id i-1234567890abcdef0 --min-size 1 --max-size 10 --desired-capacity 2 --availability-zones "us-west-2a" "us-west-2b"
   ```

3. **Instance Types and Sizes:**
   - Choose appropriate instance types and sizes based on the workload requirements. Use the AWS CLI to modify instance types if necessary.
   ```sh
   aws ec2 modify-instance-attribute --instance-id i-1234567890abcdef0 --instance-type "{\"Value\": \"t3.large\"}"
   ```

4. **Resource Tags and Monitoring:**
   - Tag your instances and set up detailed monitoring to keep track of resource utilization. This helps in identifying overutilized instances quickly.
   ```sh
   aws ec2 create-tags --resources i-1234567890abcdef0 --tags Key=Environment,Value=Production Key=Owner,Value=Admin
   aws cloudwatch enable-alarm-actions --alarm-names "HighCPUUtilization"
   ```

By following these steps, you can proactively prevent EC2 instances from being overutilized using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent EC2 instances from being overutilized using Python scripts, you can leverage AWS SDK for Python (Boto3) to monitor and manage your EC2 instances. Here are four steps to help you achieve this:

### 1. **Set Up Boto3 and AWS Credentials**

First, ensure you have Boto3 installed and configured with your AWS credentials.

```bash
pip install boto3
```

Configure your AWS credentials:

```bash
aws configure
```

### 2. **Monitor EC2 Instance Metrics**

Use CloudWatch to monitor the CPU utilization of your EC2 instances. You can set up a script to fetch these metrics periodically.

```python
import boto3
from datetime import datetime, timedelta

cloudwatch = boto3.client('cloudwatch')

def get_cpu_utilization(instance_id):
    response = cloudwatch.get_metric_statistics(
        Namespace='AWS/EC2',
        MetricName='CPUUtilization',
        Dimensions=[{'Name': 'InstanceId', 'Value': instance_id}],
        StartTime=datetime.utcnow() - timedelta(minutes=10),
        EndTime=datetime.utcnow(),
        Period=300,
        Statistics=['Average']
    )
    for point in response['Datapoints']:
        return point['Average']
    return 0

instance_id = 'i-0abcd1234efgh5678'
cpu_utilization = get_cpu_utilization(instance_id)
print(f"CPU Utilization for {instance_id}: {cpu_utilization}%")
```

### 3. **Set Up Alarms for High Utilization**

Create CloudWatch alarms to notify you when an instance's CPU utilization exceeds a certain threshold.

```python
def create_cpu_alarm(instance_id, threshold):
    cloudwatch.put_metric_alarm(
        AlarmName=f'HighCPUUtilization_{instance_id}',
        MetricName='CPUUtilization',
        Namespace='AWS/EC2',
        Statistic='Average',
        Period=300,
        EvaluationPeriods=1,
        Threshold=threshold,
        ComparisonOperator='GreaterThanThreshold',
        Dimensions=[{'Name': 'InstanceId', 'Value': instance_id}],
        AlarmActions=['arn:aws:sns:us-west-2:123456789012:MyTopic'],
        AlarmDescription='Alarm when server CPU exceeds threshold',
        ActionsEnabled=True
    )

create_cpu_alarm(instance_id, 80)
```

### 4. **Auto-Scaling Based on Utilization**

Set up Auto Scaling to automatically adjust the number of instances based on CPU utilization.

```python
autoscaling = boto3.client('autoscaling')

def create_auto_scaling_policy(asg_name, policy_name, adjustment_type, scaling_adjustment, cooldown):
    autoscaling.put_scaling_policy(
        AutoScalingGroupName=asg_name,
        PolicyName=policy_name,
        AdjustmentType=adjustment_type,
        ScalingAdjustment=scaling_adjustment,
        Cooldown=cooldown
    )

asg_name = 'my-auto-scaling-group'
create_auto_scaling_policy(asg_name, 'ScaleUp', 'ChangeInCapacity', 1, 300)
create_auto_scaling_policy(asg_name, 'ScaleDown', 'ChangeInCapacity', -1, 300)
```

By following these steps, you can effectively monitor and manage the utilization of your EC2 instances, preventing them from being overutilized.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, select "Instances" to view all the EC2 instances.
3. For each instance, check the "Monitoring" tab. This tab provides metrics and graphs about CPU utilization, Disk reads and writes, Network packets, etc.
4. If the CPU Utilization is consistently high (over 80-90%) for an extended period, it indicates that the EC2 instance is overutilized. Similarly, check for Disk and Network overutilization. If these metrics are also high, it further confirms that the instance is overutilized.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all EC2 instances: Use the following command to list all EC2 instances in your AWS account:

   ```
   aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId]' --output text
   ```

   This command will return a list of all EC2 instance IDs.

3. Check CPU utilization: For each EC2 instance, you can check the CPU utilization using the following command:

   ```
   aws cloudwatch get-metric-statistics --namespace AWS/EC2 --metric-name CPUUtilization --dimensions Name=InstanceId,Value=<instance_id> --start-time <start_time> --end-time <end_time> --period 3600 --statistics Maximum --unit Percent
   ```

   Replace `<instance_id>` with the ID of the EC2 instance you want to check, and `<start_time>` and `<end_time>` with the time period you want to check. This command will return the maximum CPU utilization for the specified EC2 instance during the specified time period.

4. Analyze the results: If the CPU utilization is consistently high (for example, over 80%), it indicates that the EC2 instance is overutilized. You may need to upgrade the instance type or optimize the applications running on the instance to reduce CPU utilization.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, AWS DynamoDB, and much more. To install Boto3, you can use pip:

   ```
   pip install boto3
   ```

   You also need to configure your AWS credentials. You can do this in several ways, but the simplest is to use the AWS CLI:

   ```
   aws configure
   ```

   Then follow the prompts to input your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. Use Boto3 to interact with AWS EC2: You can use Boto3 to create, configure, and manage AWS services. For example, you can start or stop EC2 instances, create security groups, and much more. Here is a simple script to list all EC2 instances:

   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   for instance in ec2.instances.all():
       print(instance.id, instance.state)
   ```

3. Monitor EC2 instance utilization: AWS provides CloudWatch, a monitoring service for AWS resources and the applications you run on AWS. You can use CloudWatch to collect and track metrics, which are variables you can measure for your resources and applications. Here is a simple script to get the CPU utilization of an EC2 instance:

   ```python
   import boto3

   cloudwatch = boto3.client('cloudwatch')

   response = cloudwatch.get_metric_statistics(
       Namespace='AWS/EC2',
       MetricName='CPUUtilization',
       Dimensions=[
           {
               'Name': 'InstanceId',
               'Value': 'INSTANCE_ID'
           },
       ],
       StartTime='2021-01-01T00:00:00Z',
       EndTime='2021-01-02T00:00:00Z',
       Period=3600,
       Statistics=[
           'Average',
       ],
   )

   print(response['Datapoints'])
   ```

   Replace 'INSTANCE_ID' with the ID of the EC2 instance you want to monitor.

4. Analyze the utilization data: If the CPU utilization is consistently high (over 70-80%), it might indicate that the EC2 instance is overutilized. You might need to upgrade the instance type or optimize the applications running on the instance. If the CPU utilization is consistently low (under 20-30%), it might indicate that the EC2 instance is underutilized. You might be able to save costs by downgrading the instance type or stopping the instance when it's not in use.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of EC2 instances being overutilized in AWS, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 Dashboard.
3. Select the EC2 instance that is overutilized.
4. Check the CPU utilization of the instance in the Monitoring tab.
5. Determine the root cause of the overutilization. It could be due to high traffic, a memory leak, or a poorly optimized application.
6. Based on the root cause, take the following actions:
   - If it is due to high traffic, consider scaling out the instance by adding more instances or upgrading the instance type.
   - If it is due to a memory leak, investigate the application code and fix the leak.
   - If it is due to a poorly optimized application, work with the developers to optimize the application.
7. Monitor the CPU utilization of the instance and ensure that it stays within acceptable limits.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "EC2 Instances Should Not Be Overutilized" for AWS, you can follow the below steps using AWS CLI:

1. Identify the overutilized EC2 instances using the CloudWatch metrics. Run the following command to get the CPU utilization of all the EC2 instances in your AWS account:

   ```
   aws cloudwatch get-metric-statistics --namespace AWS/EC2 --metric-name CPUUtilization --dimensions Name=InstanceId,Value=<instance_id> --start-time <start_time> --end-time <end_time> --period 300 --statistics Maximum
   ```

   Replace `<instance_id>` with the ID of the EC2 instance you want to check, `<start_time>` with the start time of the period you want to check, and `<end_time>` with the end time of the period you want to check.

2. Once you have identified the overutilized EC2 instances, you can either upgrade the instance type or add more instances to the auto-scaling group. To upgrade the instance type, stop the instance and then change the instance type from the AWS Management Console or by running the following command:

   ```
   aws ec2 modify-instance-attribute --instance-id <instance_id> --instance-type <instance_type>
   ```

   Replace `<instance_id>` with the ID of the EC2 instance you want to modify and `<instance_type>` with the new instance type you want to use.

3. If you want to add more instances to the auto-scaling group, run the following command:

   ```
   aws autoscaling update-auto-scaling-group --auto-scaling-group-name <auto_scaling_group_name> --min-size <min_size> --desired-capacity <desired_capacity> --max-size <max_size>
   ```

   Replace `<auto_scaling_group_name>` with the name of the auto-scaling group you want to modify, `<min_size>` with the minimum number of instances you want to have in the group, `<desired_capacity>` with the desired number of instances you want to have in the group, and `<max_size>` with the maximum number of instances you want to have in the group.

4. After you have made the necessary changes, monitor the CPU utilization of the EC2 instances using CloudWatch metrics to ensure that they are not overutilized.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of EC2 instances being overutilized in AWS using Python, follow these steps:

1. First, you need to identify the overutilized instances. You can use CloudWatch to monitor the CPU utilization of your instances and set alarms to notify you when the utilization exceeds a certain threshold. You can also use AWS Trusted Advisor to get recommendations on overutilized instances.

2. Once you have identified the overutilized instances, you can use the AWS SDK for Python (Boto3) to stop or terminate the instances. Here's an example code snippet to stop an EC2 instance:

```
import boto3

ec2 = boto3.client('ec2')

response = ec2.stop_instances(
    InstanceIds=[
        'INSTANCE_ID',
    ],
    Force=True
)
```

Replace 'INSTANCE_ID' with the ID of the overutilized instance.

3. You can also use AWS Auto Scaling to automatically adjust the number of instances in your fleet based on demand. Auto Scaling can launch new instances when demand increases and terminate instances when demand decreases, ensuring that your fleet is always right-sized.

4. Finally, you should review your instance types and consider upgrading to a larger instance type if your workload requires more resources. You can use AWS Cost Explorer to analyze your costs and identify opportunities to optimize your instance usage.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://aws.amazon.com/premiumsupport/knowledge-center/ec2-linux-resource-over-utilization/](https://aws.amazon.com/premiumsupport/knowledge-center/ec2-linux-resource-over-utilization/) 

