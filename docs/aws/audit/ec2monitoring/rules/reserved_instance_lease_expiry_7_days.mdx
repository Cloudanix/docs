---
slug: reserved_instance_lease_expiry_7_days
title: Reserved Instance Lease Expiration In The Next 7 Days
sidebar_label: Reserved Instance Lease Expiration In The Next 7 Days
---

### More Info:

Lists all EC2 reserved instances expiring in the next 7 days.

### Risk Level

Low

### Address

Cost Optimisation

### Compliance Standards

CBP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.
   
2. In the navigation pane, choose "Reserved Instances". This will open a list of all your reserved instances.

3. In the list of reserved instances, look for the "End date" column. This column shows the expiration date of each reserved instance.

4. Manually check if any of the instances are due to expire in the next 7 days.

#### Using CLI

1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```

   You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format. 

2. List all EC2 Reserved Instances: Use the following AWS CLI command to list all your EC2 Reserved Instances:

   ```
   aws ec2 describe-reserved-instances
   ```

   This command will return a JSON output with details about all your EC2 Reserved Instances.

3. Parse the output: You can parse the output using a tool like jq to filter out the instances that will expire in the next 7 days. Here is an example command:

   ```
   aws ec2 describe-reserved-instances | jq -r '.ReservedInstances[] | select(.End - (.Start + 604800) < 0) | .ReservedInstancesId'
   ```

   This command will return the IDs of the Reserved Instances that will expire in the next 7 days.

4. Check the expiration date: For each of the Reserved Instance IDs returned by the previous command, you can use the following command to check its expiration date:

   ```
   aws ec2 describe-reserved-instances --reserved-instances-id <ReservedInstancesId> | jq -r '.ReservedInstances[].End'
   ```

   Replace `<ReservedInstancesId>` with the ID of the Reserved Instance you want to check. This command will return the expiration date of the Reserved Instance.

#### Using Python

1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, and more. You can install it using pip:

```python
pip install boto3
```
You also need to configure your AWS credentials. You can do this in several ways, but the simplest is to use the AWS CLI:

```bash
aws configure
```

2. Import the necessary libraries and establish a session with AWS:

```python
import boto3
from datetime import datetime, timedelta

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2' # or your preferred region
)
```

3. Connect to the EC2 service and retrieve all reserved instances:

```python
# Connect to the EC2 service
ec2 = session.client('ec2')

# Retrieve all reserved instances
reserved_instances = ec2.describe_reserved_instances()['ReservedInstances']
```

4. Check the expiration date of each reserved instance:

```python
# Get the current date and time
now = datetime.now()

# Check each reserved instance
for ri in reserved_instances:
    # Get the end date of the reserved instance
    end_date = ri['End']
    
    # Calculate the difference between the current date and the end date
    difference = end_date - now
    
    # If the difference is less than 7 days, print a warning
    if difference < timedelta(days=7):
        print(f"Warning: Reserved instance {ri['ReservedInstancesId']} will expire in less than 7 days.")
```

This script will print a warning for each reserved instance that will expire in the next 7 days. You can modify it to suit your needs, for example by sending an email or a notification instead of printing a warning.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the "Reserved Instance Lease Expiration In The Next 7 Days" misconfiguration for AWS, you can follow the below steps:

1. Log in to your AWS Management Console.
2. Navigate to the EC2 Dashboard.
3. Click on the "Reserved Instances" link in the left-hand menu.
4. In the "Reserved Instances" page, you will see a list of your reserved instances.
5. Look for the instances that have lease expiration in the next 7 days.
6. Select the instance by clicking on the checkbox in front of it.
7. Click on the "Modify Reserved Instances" button.
8. In the "Modify Reserved Instances" page, you can choose to either modify the instance or exchange it for a new one.
9. If you choose to modify the instance, you can change the instance type, availability zone, or platform.
10. If you choose to exchange the instance, you can select a new instance type, availability zone, or platform.
11. Once you have made your changes, click on the "Preview" button to review your changes.
12. If you are satisfied with your changes, click on the "Modify Reserved Instances" button to apply the changes.

By following these steps, you will be able to remediate the "Reserved Instance Lease Expiration In The Next 7 Days" misconfiguration for AWS.

#### Using CLI

The Reserved Instance Lease Expiration In The Next 7 Days issue in AWS can be remediated by modifying the reservation period of the instance. Here are the steps to remediate this issue using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Run the following command to get a list of all the reserved instances that have an expiration date within the next 7 days:

```
aws ec2 describe-reserved-instances --filters "Name=state,Values=active" "Name=product-description,Values=*Linux/UNIX*" "Name=scope,Values=Availability Zone" --query 'ReservedInstances[*].[ReservedInstancesId,InstanceType,AvailabilityZone,InstanceCount,Start,End,Duration,State,Tags[?Key==`Name`].Value|[0]]' --output table --region <region>
```

Note: Replace `<region>` with the region where your instances are located.

3. Identify the instance that requires remediation.

4. Run the following command to modify the reservation period:

```
aws ec2 modify-reserved-instances --reserved-instances-id <reservation_id> --target-configuration "InstanceCount=<count>,End=`date -d '+1 year' +%Y-%m-%d`" --region <region>
```

Note: Replace `<reservation_id>` with the ID of the reserved instance that requires remediation and `<count>` with the number of instances that you want to reserve. Also, ensure that the `End` date is set to at least 1 year from the current date.

5. Verify that the reservation has been modified by running the first command again and checking that the expiration date is now more than 7 days away.

By following these steps, you can remediate the Reserved Instance Lease Expiration In The Next 7 Days issue in AWS using AWS CLI.

#### Using Python

To remediate the issue of Reserved Instance Lease Expiration in the next 7 days in AWS using Python, follow these steps:

1. Import the necessary AWS SDK boto3:

```
import boto3
```

2. Create an EC2 client object:

```
ec2 = boto3.client('ec2')
```

3. Use the describe_reserved_instances() method to get the list of all reserved instances:

```
reserved_instances = ec2.describe_reserved_instances()
```

4. Loop through the list of reserved instances and check if any of them are expiring within the next 7 days:

```
for reserved_instance in reserved_instances['ReservedInstances']:
    expiration_time = reserved_instance['End']
    remaining_days = (expiration_time.date() - datetime.date.today()).days
    if remaining_days <= 7:
        # Do something to remediate the issue
```

5. To remediate the issue, you can either renew the reserved instance or purchase a new one. To renew the reserved instance, use the modify_reserved_instances() method:

```
response = ec2.modify_reserved_instances(
    ReservedInstancesIds=[
        'string',
    ],
    TargetConfigurations=[
        {
            'AvailabilityZone': 'string',
            'InstanceCount': 123,
            'InstanceType': 'string',
            'Platform': 'string',
            'Scope': 'string'
        },
    ]
)
```

6. Alternatively, you can purchase a new reserved instance using the purchase_reserved_instances_offering() method:

```
response = ec2.purchase_reserved_instances_offering(
    InstanceCount=123,
    ReservedInstancesOfferingId='string',
    DryRun=True|False,
    LimitPrice={
        'Amount': 'string',
        'CurrencyCode': 'string'
    }
)
```

7. Finally, you can schedule a Lambda function to run this script periodically and remediate the issue automatically.

### Additional Reading:

- [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html) 


</Tab>
</Tabs>