---
slug: unrestricted_rdp_access
title: Unrestricted RDP Access Should Not Be Allowed
sidebar_label: Unrestricted RDP Access Should Not Be Allowed
---

### More Info:

No AWS EC2 security group should allow unrestricted inbound access to TCP port 3389 (RDP).

### Risk Level

Medium

### Address

Security

### Compliance Standards

CISAWS, CBP, SOC2, PCIDSS, HITRUST, AWSWAF, GDPR, NISTCSF, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. Here, you can see all the inbound rules for the selected security group. Look for any rules where the "Type" is "RDP" (Remote Desktop Protocol) and the "Source" is "0.0.0.0/0" or "::/0" (which means any IP address). If such a rule exists, it means that unrestricted RDP access is allowed.

#### Using CLI

1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all security groups: Use the following AWS CLI command to list all the security groups in your AWS account.

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text
   ```

3. Check RDP access for each security group: For each security group, use the following AWS CLI command to check if it allows unrestricted RDP access. Replace `SECURITY_GROUP_ID` with the ID of the security group you want to check.

   ```
   aws ec2 describe-security-groups --group-ids SECURITY_GROUP_ID --query "SecurityGroups[*].IpPermissions[*].{FromPort:FromPort,ToPort:ToPort,IpRanges:IpRanges[*].CidrIp}" --output text
   ```

4. Analyze the output: If the output includes `0.0.0.0/0` or `::/0` for the port range `3389`, it means that the security group allows unrestricted RDP access. If not, the security group does not allow unrestricted RDP access.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways. The easiest way is to use the AWS CLI and configure it using the command:

   ```bash
   aws configure
   ```

3. Write the Python script: The following Python script uses Boto3 to retrieve all security groups and checks if they have unrestricted RDP access (port 3389 open to 0.0.0.0/0).

   ```python
   import boto3

   ec2 = boto3.resource('ec2')

   # Get all security groups
   security_groups = ec2.security_groups.all()

   # Check each security group for unrestricted RDP access
   for group in security_groups:
       for permission in group.ip_permissions:
           for range in permission['IpRanges']:
               if '0.0.0.0/0' in range['CidrIp'] and permission['FromPort'] == 3389:
                   print(f"Security Group {group.id} has unrestricted RDP access")
   ```

4. Run the script: You can run the script using any Python interpreter. If the script finds any security groups with unrestricted RDP access, it will print their IDs. If it doesn't print anything, then no security groups with unrestricted RDP access were found.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the unrestricted RDP access issue in AWS, you can follow these steps:

1. Login to the AWS Management Console.

2. Navigate to the EC2 service.

3. Select the EC2 instance(s) for which you want to restrict RDP access.

4. Click on the "Security Groups" tab in the bottom pane.

5. Select the security group(s) associated with the instance(s).

6. Click on the "Inbound Rules" tab.

7. Locate the rule that allows RDP access from any IP address (0.0.0.0/0).

8. Click on the "Edit" button next to the rule.

9. Change the source IP address to a specific IP address or range of IP addresses that are allowed to access RDP.

10. Click on the "Save" button to apply the changes.

11. Repeat these steps for all instances that have unrestricted RDP access.

By following these steps, you can remediate the unrestricted RDP access issue in AWS and restrict RDP access to specific IP addresses only.

#### Using CLI

To remediate the unrestricted RDP access in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your local machine.

2. Run the below command to list all the security groups in your AWS account.

```
aws ec2 describe-security-groups
```

3. Identify the security group that allows unrestricted RDP access.

4. Run the below command to revoke the inbound rule that allows unrestricted RDP access.

```
aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 3389 --cidr 0.0.0.0/0
```

Note: Replace `<security-group-id>` with the ID of the security group identified in step 3.

5. Verify that the inbound rule has been revoked by running the below command.

```
aws ec2 describe-security-groups --group-ids <security-group-id>
```

Note: Replace `<security-group-id>` with the ID of the security group identified in step 3.

6. Repeat steps 3 to 5 for all the security groups that allow unrestricted RDP access.

By following the above steps, you can remediate the unrestricted RDP access in AWS.

#### Using Python

To remediate unrestricted RDP access in AWS using Python, you can follow these steps:

1. Import the necessary AWS SDK libraries in your Python script. You can use the Boto3 library to interact with AWS services.

```python
import boto3
```

2. Initialize the EC2 client using the Boto3 library.

```python
ec2 = boto3.client('ec2')
```

3. Use the `describe_security_groups` method to get a list of all security groups in your AWS account.

```python
response = ec2.describe_security_groups()
security_groups = response['SecurityGroups']
```

4. Loop through the security groups and check if any of them have an inbound rule allowing unrestricted RDP access (port 3389).

```python
for sg in security_groups:
    for rule in sg['IpPermissions']:
        if rule['IpProtocol'] == 'tcp' and rule['FromPort'] == 3389 and rule['ToPort'] == 3389 and rule['IpRanges'] == [{'CidrIp': '0.0.0.0/0'}]:
            # Remove the rule that allows unrestricted RDP access
            ec2.revoke_security_group_ingress(
                GroupId=sg['GroupId'],
                IpPermissions=[rule]
            )
```

5. Save the Python script and run it to remove the rule that allows unrestricted RDP access in all security groups in your AWS account.

Note: Make sure you have the necessary permissions to modify security groups in your AWS account before running the script.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 


</Tab>
</Tabs>