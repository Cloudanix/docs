---
slug: unrestricted_mongodb_access
title: Unrestricted MongoDB Access Should Not Be Allowed
sidebar_label: Unrestricted MongoDB Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted ingress access to MongoDB port 27017.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP, HITRUST, AWSWAF, GDPR, SOC2, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the EC2 dashboard, select "Security Groups" under the "Network & Security" section.
3. In the Security Groups page, select the security group associated with your MongoDB instance.
4. In the Inbound rules tab, check for any rules that allow unrestricted access (0.0.0.0/0 or ::/0) to port 27017 (default MongoDB port). If such a rule exists, it indicates that unrestricted MongoDB access is allowed.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Once you have AWS CLI installed and configured, you can proceed to the next steps.

2. List all the security groups in your AWS account using the following command:

   ```
   aws ec2 describe-security-groups --query "SecurityGroups[*].[GroupId]" --output text
   ```
   This command will return a list of all security group IDs.

3. For each security group, check the inbound rules to see if they allow unrestricted access to MongoDB. MongoDB uses port 27017 by default, so you can use the following command to check the inbound rules:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id> --query 'SecurityGroups[*].IpPermissions[*].{FromPort:FromPort,ToPort:ToPort,IpRanges:IpRanges[*].CidrIp}' --output text
   ```
   Replace `<security-group-id>` with the ID of the security group you want to check. This command will return a list of all inbound rules for the specified security group.

4. If the output of the above command includes "0.0.0.0/0" for the IP range and "27017" for the from port or to port, then the security group allows unrestricted access to MongoDB. You should review these security groups and update their inbound rules to restrict access to MongoDB.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. You will need the `boto3` library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: You need to configure your AWS credentials. You can do this by using the AWS CLI, or by manually adding them to your AWS credentials file (located at `~/.aws/credentials`). At a minimum, the credentials file should specify the access key and secret access key. To specify these for the `default` profile, you can use the following format:

   ```bash
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write the Python script: Now you can write a Python script that uses the `boto3` library to check for unrestricted MongoDB access in EC2. Here is a basic example:

   ```python
   import boto3

   def check_mongodb_access():
       ec2 = boto3.resource('ec2')
       instances = ec2.instances.filter()
       for instance in instances:
           security_groups = instance.security_groups
           for sg in security_groups:
               permissions = sg.ip_permissions
               for permission in permissions:
                   if permission['FromPort'] == 27017 and permission['ToPort'] == 27017:
                       for ip_range in permission['IpRanges']:
                           if ip_range['CidrIp'] == '0.0.0.0/0':
                               print(f"Unrestricted MongoDB access detected in instance {instance.id}")

   if __name__ == "__main__":
       check_mongodb_access()
   ```

   This script will check all EC2 instances and their associated security groups for any rules that allow unrestricted access (0.0.0.0/0) to MongoDB (port 27017).

4. Run the Python script: Finally, you can run the Python script using the Python interpreter:

   ```bash
   python check_mongodb_access.py
   ```

   If any instances are found with unrestricted MongoDB access, their instance IDs will be printed to the console.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the unrestricted MongoDB access issue in AWS, you can follow these steps:

1. Open the AWS Management Console and navigate to the EC2 dashboard.
2. Select the Security Groups option from the left-hand menu.
3. Find the security group associated with the MongoDB instance that you want to restrict access to.
4. Click on the security group to open the details page.
5. Select the Inbound Rules tab.
6. Locate the rule that allows unrestricted access to MongoDB (default port 27017).
7. Click on the "Edit" button next to the rule.
8. Change the Source field to restrict access to only the IP addresses or CIDR ranges that require access to the MongoDB instance.
9. Click "Save" to apply the changes.

By following these steps, you have successfully remediated the unrestricted MongoDB access issue in AWS by restricting access to only authorized IP addresses or CIDR ranges.

#### Using CLI

To remediate unrestricted MongoDB access in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine.
2. Run the following command to list all the MongoDB instances running in your AWS account:
```
aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier,Engine]' --filters "Name=engine,Values=mongodb"
```
3. Identify the MongoDB instances that have unrestricted access.
4. Run the following command to modify the security group associated with the MongoDB instance to allow access only from specific IP addresses:
```
aws rds modify-db-instance --db-instance-identifier <db-instance-identifier> --vpc-security-group-ids <security-group-id>
```
Note: Replace `<db-instance-identifier>` with the identifier of the MongoDB instance and `<security-group-id>` with the ID of the security group that allows access only from specific IP addresses.
5. Verify the changes by running the following command:
```
aws rds describe-db-instances --db-instance-identifier <db-instance-identifier> --query 'DBInstances[*].[DBInstanceIdentifier,VpcSecurityGroups[0].VpcSecurityGroupId]'
```
Note: Replace `<db-instance-identifier>` with the identifier of the MongoDB instance.

After these steps, the MongoDB instance will only allow access from specific IP addresses.

#### Using Python

To remediate unrestricted MongoDB access in AWS using Python, you can follow these steps:

1. Identify the MongoDB instances running in your AWS environment.
2. For each instance, check if the security group associated with it allows unrestricted access to the MongoDB port (default port is 27017).
3. If the security group allows unrestricted access, update the security group to restrict access to the MongoDB port to only the necessary IP addresses or CIDR ranges.
4. You can use the boto3 library in Python to interact with the AWS API and perform the above steps.

Here's a sample Python code that can help you remediate the issue:

```python
import boto3

# Initialize the AWS client
client = boto3.client('ec2')

# Get a list of all MongoDB instances
response = client.describe_instances(
    Filters=[
        {
            'Name': 'tag:Name',
            'Values': ['*mongodb*']
        }
    ]
)

# Loop through each instance and update its security group
for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        for sg in instance['SecurityGroups']:
            # Check if the security group allows unrestricted access to MongoDB port
            ip_permissions = sg['IpPermissions']
            unrestricted_access = False
            for permission in ip_permissions:
                if permission['IpProtocol'] == 'tcp' and permission['FromPort'] == 27017 and permission['ToPort'] == 27017:
                    for ip_range in permission['IpRanges']:
                        if ip_range['CidrIp'] == '0.0.0.0/0':
                            unrestricted_access = True
                            break
            
            # If unrestricted access is allowed, update the security group
            if unrestricted_access:
                response = client.authorize_security_group_ingress(
                    GroupId=sg['GroupId'],
                    IpPermissions=[
                        {
                            'IpProtocol': 'tcp',
                            'FromPort': 27017,
                            'ToPort': 27017,
                            'IpRanges': [
                                {
                                    'CidrIp': '10.0.0.0/8' # Replace with the necessary IP addresses or CIDR ranges
                                }
                            ]
                        }
                    ]
                )
                print(response)
```

Note: This is just a sample code and may need to be modified based on your specific AWS environment and requirements. It's recommended to test the code in a non-production environment before applying it to your production environment.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 


</Tab>
</Tabs>