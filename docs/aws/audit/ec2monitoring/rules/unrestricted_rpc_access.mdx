---
slug: unrestricted_rpc_access
title: Unrestricted RPC Access Should Not Be Allowed
sidebar_label: Unrestricted RPC Access Should Not Be Allowed
---

### More Info:

No security group should allow unrestricted inbound access to TCP port 135 (RPC).

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, GDPR, HITRUST, AWSWAF, NISTCSF, PCIDSS, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the left navigation pane, under the "Network & Security" section, click on "Security Groups".
3. In the Security Groups page, you will see a list of all the security groups associated with your EC2 instances. Click on the security group that you want to check.
4. In the details pane at the bottom, click on the "Inbound" tab. Here, you can see all the inbound rules for the selected security group. If there is a rule that allows unrestricted RPC access (i.e., the source is set to "Anywhere" (0.0.0.0/0) for the RPC port range), then this is a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all security groups: The first step to detect unrestricted RPC access is to list all the security groups in your AWS account. You can do this by running the following command: `aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupId]' --output text`

3. Check for unrestricted RPC access: For each security group, you need to check if it allows unrestricted RPC access. You can do this by running the following command for each security group: `aws ec2 describe-security-groups --group-ids <security-group-id> --query 'SecurityGroups[*].IpPermissions[*].{FromPort:FromPort,ToPort:ToPort,IpRanges:IpRanges}' --output text`

4. Analyze the output: The output of the above command will show the from port, to port, and IP ranges for each security group. If the from port is 111 (the port for RPC) and the IP range is 0.0.0.0/0 (which means all IP addresses), then the security group allows unrestricted RPC access.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

```python
pip install boto3
```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways, but the simplest is to use the AWS CLI:

```bash
aws configure
```

3. Write the Python script: The following Python script uses Boto3 to retrieve all security groups in your AWS account and checks if they have unrestricted RPC access:

```python
import boto3

def check_rpc_access():
    ec2 = boto3.resource('ec2')
    for security_group in ec2.security_groups.all():
        for permission in security_group.ip_permissions:
            # Check if protocol is RPC (port 135)
            if permission['FromPort'] == 135 and permission['ToPort'] == 135:
                for ip_range in permission['IpRanges']:
                    # Check if access is unrestricted (0.0.0.0/0)
                    if ip_range['CidrIp'] == '0.0.0.0/0':
                        print(f"Security Group {security_group.group_name} ({security_group.group_id}) allows unrestricted RPC access")

check_rpc_access()
```

4. Run the Python script: Save the script to a file, e.g., check_rpc_access.py, and run it using Python:

```bash
python check_rpc_access.py
```

This script will print out the names and IDs of all security groups that allow unrestricted RPC access.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of unrestricted RPC access in AWS, you can follow these steps:

1. Open the AWS Management Console and go to the EC2 dashboard.
2. Click on the "Security Groups" option in the left-hand menu.
3. Select the security group that is allowing unrestricted RPC access.
4. Click on the "Inbound Rules" tab and locate the rule that allows RPC access.
5. Click on the "Edit" button next to the rule.
6. Change the source IP address to a specific IP address or range of IP addresses that require access to RPC.
7. If necessary, add a new rule to allow access to RPC from specific IP addresses or ranges.
8. Click on the "Save" button to apply the changes.

Once the changes are saved, the security group will no longer allow unrestricted RPC access. It is important to regularly review and update security group rules to ensure that they are properly configured and do not leave any vulnerabilities open to attack.

#### Using CLI

To remediate the "Unrestricted RPC Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list the security groups in your AWS account:

   ```
   aws ec2 describe-security-groups
   ```

3. Identify the security group that has the unrestricted RPC access.

4. Run the following command to modify the security group and remove the unrestricted RPC access:

   ```
   aws ec2 revoke-security-group-ingress --group-id <security-group-id> --protocol tcp --port 111 --cidr 0.0.0.0/0
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that has the unrestricted RPC access.

5. Run the following command to verify that the unrestricted RPC access has been removed:

   ```
   aws ec2 describe-security-groups --group-ids <security-group-id>
   ```

   Note: Replace `<security-group-id>` with the ID of the security group that has the unrestricted RPC access.

6. Verify that the remediation was successful by confirming that the security group no longer has unrestricted RPC access.

By following these steps, you can remediate the "Unrestricted RPC Access Should Not Be Allowed" misconfiguration in AWS using AWS CLI.

#### Using Python

To remediate the "Unrestricted RPC Access Should Not Be Allowed" issue in AWS using Python, follow the below steps:

1. First, we need to identify the security group that allows unrestricted RPC access. You can use the following Python code to list all the security groups in your AWS account:

```python
import boto3

ec2 = boto3.client('ec2')

response = ec2.describe_security_groups()
for sg in response['SecurityGroups']:
    print(sg['GroupId'], sg['GroupName'])
```

2. Once you have identified the security group that allows unrestricted RPC access, you can use the following Python code to revoke the rule:

```python
import boto3

ec2 = boto3.client('ec2')

response = ec2.revoke_security_group_ingress(
    GroupId='SECURITY_GROUP_ID',
    IpPermissions=[
        {
            'IpProtocol': 'tcp',
            'FromPort': 135,
            'ToPort': 139,
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        },
        {
            'IpProtocol': 'tcp',
            'FromPort': 445,
            'ToPort': 445,
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        },
        {
            'IpProtocol': 'udp',
            'FromPort': 137,
            'ToPort': 138,
            'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
        }
    ]
)
```

In the above code, replace 'SECURITY_GROUP_ID' with the ID of the security group that allows unrestricted RPC access.

3. The above code will revoke the rule that allows unrestricted RPC access. You can run the first code again to verify that the rule has been revoked.

Note: The above code assumes that you have the necessary permissions to modify security groups in your AWS account.

### Additional Reading:

- [https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#AddRemoveRules) 


</Tab>
</Tabs>