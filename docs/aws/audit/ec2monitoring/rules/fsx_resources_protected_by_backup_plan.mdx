---
slug: fsx_resources_protected_by_backup_plan
title: FSx Should Have Backup Plan
sidebar_label: FSx Should Have Backup Plan
---

### More Info:

This rule checks if Amazon FSx File Systems are protected by a backup plan. The rule is NON_COMPLIANT if the Amazon FSx File System is not covered by a backup plan.

### Risk Level

High

### Address

Configuration

### Compliance Standards

CBP,SEBI,RBI_MD_ITF



### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon FSx console at https://console.aws.amazon.com/fsx/.

2. In the navigation pane, choose "File systems". This will display a list of all your FSx file systems.

3. Select the FSx file system you want to check for backup plan. 

4. In the details pane, look for the "Backups" section. If there are no backups listed or the backup frequency is not as per your organization's policy, then it indicates that the FSx does not have a proper backup plan.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine. You can download it from the official AWS website. After installation, you need to configure it with your AWS account credentials. You can do this by running the command `aws configure` and then entering your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. List all FSx file systems: Use the following command to list all the FSx file systems in your AWS account.

   ```
   aws fsx describe-file-systems
   ```
   This command will return a JSON output with details of all the FSx file systems.

3. Check backup policy: For each FSx file system, check if it has a backup policy. This can be done by using the following command:

   ```
   aws fsx describe-backup-policy --file-system-id <file-system-id>
   ```
   Replace `<file-system-id>` with the ID of the FSx file system you want to check. This command will return a JSON output with the details of the backup policy.

4. Analyze the output: If the backup policy is not enabled or not configured properly, then the FSx file system is misconfigured. You need to manually analyze the output of the above command to determine this. If the `WindowsConfiguration` field is null or the `AutomaticBackupRetentionDays` is less than the desired value, then the FSx file system is misconfigured.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3): Boto3 makes it easy to integrate your Python application, library, or script with AWS services including AWS S3, AWS EC2, and more. You can install it using pip:

```python
pip install boto3
```
After installation, you need to configure it. You can do this in several ways, but the simplest is to use the AWS CLI:

```bash
aws configure
```
This will prompt you for your AWS Access Key ID, Secret Access Key, AWS Region. These are required for Boto3 to interact with AWS services.

2. Import the necessary libraries and create an AWS FSx client:

```python
import boto3

fsx = boto3.client('fsx')
```
3. Use the `describe_backups` function to retrieve information about the backups of your FSx file systems:

```python
response = fsx.describe_backups()

for backup in response['Backups']:
    print('BackupId: ', backup['BackupId'])
    print('Lifecycle: ', backup['Lifecycle'])
    print('Type: ', backup['Type'])
    print('ProgressPercent: ', backup['ProgressPercent'])
    print('CreationTime: ', backup['CreationTime'])
    print('KmsKeyId: ', backup['KmsKeyId'])
    print('ResourceARN: ', backup['ResourceARN'])
    print('Tags: ', backup['Tags'])
```
4. Analyze the output: The script will print out the details of each backup. If a file system does not have a backup, it means it is misconfigured. You can modify the script to raise an alert or take other actions when it detects a file system without a backup.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of FSx not having a backup plan for AWS EC2 using the AWS Management Console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to the AWS Management Console using your credentials.

2. **Navigate to Amazon FSx service**: Click on the "Services" dropdown menu at the top of the console, then select "FSx" under the "Storage" category.

3. **Select the FSx file system**: In the FSx console, select the FSx file system that you want to create a backup plan for by clicking on its name.

4. **Create a Backup Plan**:
   - In the left-hand navigation pane, click on "Backup" and then click on the "Backup plans" tab.
   - Click on the "Create backup plan" button.
   - Enter a name for the backup plan and configure the backup settings according to your requirements. This includes defining the backup frequency, retention period, and any lifecycle policies.
   - Review the backup plan settings and click on the "Create" button to create the backup plan.

5. **Assign the Backup Plan to the FSx file system**:
   - After creating the backup plan, go back to the FSx file system details page.
   - Click on the "Backup" tab and then click on the "Associate backup plan" button.
   - Select the backup plan that you just created from the dropdown menu and click on the "Associate" button to assign the backup plan to the FSx file system.

6. **Verify Backup Plan**:
   - Once the backup plan is associated with the FSx file system, verify that the backup plan is active and running as expected.
   - Monitor the backup status and ensure that backups are being taken according to the defined schedule.

By following these steps, you will successfully remediate the misconfiguration of FSx not having a backup plan for your AWS EC2 instances using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of not having a backup plan for FSx on AWS EC2 using AWS CLI, you can follow these steps:

1. **Install and Configure AWS CLI:**
   If you haven't already installed and configured the AWS CLI, you can do so by following the instructions provided in the AWS documentation: [Installing the AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html) and [Configuring the AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html).

2. **Enable Backup for FSx File Systems:**
   You can enable backup for your FSx file systems using the AWS CLI by running the following command:
   ```
   aws fsx update-file-system --file-system-id fs-1234567890abcdef0 --backup-id backup-0abcdef1234567890 --windows-configuration AutomaticBackupRetentionDays=30,ThroughputCapacity=8
   ```
   Replace `fs-1234567890abcdef0` with the ID of your FSx file system and `backup-0abcdef1234567890` with the ID of the backup you want to associate with the file system. You can adjust the `AutomaticBackupRetentionDays` and `ThroughputCapacity` values as needed.

3. **Verify Backup Configuration:**
   To ensure that backup has been successfully enabled for your FSx file system, you can run the following command:
   ```
   aws fsx describe-file-systems --file-system-ids fs-1234567890abcdef0
   ```
   This command will provide detailed information about your FSx file system, including its backup configuration.

4. **Automate Backup Scheduling (Optional):**
   If you want to automate the scheduling of backups for your FSx file system, you can create a backup policy using the AWS CLI. Here is an example command to create a backup policy:
   ```
   aws fsx create-backup-policy --file-system-id fs-1234567890abcdef0 --daily-backup-start-time 01:00:00 --automatic-backup-retention-days 30
   ```
   This command will create a backup policy for the specified file system that triggers a daily backup at 01:00:00 UTC and retains the backups for 30 days.

By following these steps, you can remediate the misconfiguration of not having a backup plan for FSx on AWS EC2 using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of not having a backup plan for FSx in AWS, you can create a backup plan using Python Boto3 library. Here are the step-by-step instructions to remediate this issue:

1. Install Boto3 library:
   ```bash
   pip install boto3
   ```

2. Configure AWS credentials:
   Ensure that you have configured your AWS credentials either by setting environment variables or using AWS CLI `aws configure` command.

3. Use the following Python script to create a backup plan for FSx in AWS EC2:

```python
import boto3

def remediate_efs_resources_backup_plan(file_system_arns, backup_vault_name):
    # Initialize AWS Backup client
    backup_client = boto3.client('backup')

    # Create a backup plan for the specified EFS file systems
    response = backup_client.create_backup_plan(
        BackupPlan={
            'BackupPlanName': 'YourBackupPlanName',
            'BackupPlanRule': {
                'RuleName': 'DefaultRule',
                'TargetBackupVaultName': backup_vault_name,
                'ScheduleExpression': 'cron(0 0 * * ? *)',  # Example: Daily backup at midnight
                'StartWindowMinutes': 60,
                'CompletionWindowMinutes': 60,
            },
            'AdvancedBackupSettings': [
                {
                    'BackupOptions': {
                        'WindowsVSS': False,
                        'BackupMode': 'FULL',
                        'FileSystemLifecycle': 'SYSTEM'
                    },
                    'ResourceType': 'EFS'
                }
            ]
        }
    )

    print("Backup plan created successfully.")

def main():
    # Specify the ARNs of the EFS file systems to protect
    file_system_arns = ['your-file-system-arn1', 'your-file-system-arn2']

    # Specify the name of the backup vault
    backup_vault_name = 'your-backup-vault-name'

    # Remediate EFS resources by creating a backup plan
    remediate_efs_resources_backup_plan(file_system_arns, backup_vault_name)

if __name__ == "__main__":
    main()
```

Replace `'your-file-system-arn1', 'your-file-system-arn2'` with the ARNs of the EFS file systems you want to protect, and `'your-backup-vault-name'` with the name of the backup vault where backups will be stored. This script creates a backup plan for the specified EFS file systems, ensuring they are protected by backups according to the specified schedule and retention policy. Adjust the backup plan settings as needed.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>