---
slug: fargate_latest_platform_version
title: Latest ECS Fargate Platform Version Should Be Set
sidebar_label: Latest ECS Fargate Platform Version Should Be Set
---

### More Info:

This rule checks if ECS Fargate services are set to the latest platform version. It is marked as NON_COMPLIANT if the PlatformVersion for the Fargate launch type is not set to LATEST or if neither latestLinuxVersion nor latestWindowsVersion are provided as parameters.

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,SEBI



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the ECS (Elastic Container Service) section.

2. In the ECS section, select the "Clusters" option from the left-hand side menu.

3. In the Clusters page, select the cluster you want to inspect. This will open the cluster details page.

4. In the cluster details page, check the "Platform version" under the "Task Definitions" section. If the platform version is not the latest, it indicates a misconfiguration.

#### Using CLI

1. Install and configure AWS CLI: Before you can run any AWS CLI commands, you need to install and configure the AWS CLI on your local machine. You can do this by following the instructions provided in the AWS CLI User Guide.

2. List all the ECS clusters: Use the following AWS CLI command to list all the ECS clusters in your AWS account.

   ```
   aws ecs list-clusters --region your-region
   ```

   Replace 'your-region' with the AWS region where your ECS clusters are located.

3. Describe the ECS clusters: For each cluster listed in the previous step, use the following AWS CLI command to describe the cluster and get information about the Fargate platform version.

   ```
   aws ecs describe-clusters --clusters your-cluster-name --region your-region
   ```

   Replace 'your-cluster-name' with the name of your ECS cluster and 'your-region' with the AWS region where your ECS cluster is located.

4. Check the Fargate platform version: In the output of the previous command, look for the 'platformVersion' field. This field indicates the Fargate platform version that is set for the ECS cluster. If the 'platformVersion' field is not set to 'LATEST', then the ECS Fargate platform version is not set to the latest version.

#### Using Python

To check the latest ECS Fargate Platform version in Kubernetes using Python scripts, you can follow these steps:

1. **AWS SDK for Python (Boto3):**
   First, you need to install and configure the AWS SDK for Python (Boto3). This will allow you to interact with AWS services, including ECS. You can install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials either by setting the following environment variables: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, and optionally AWS_SESSION_TOKEN, or by using the AWS CLI command `aws configure`.

2. **List ECS Clusters:**
   Use the `list_clusters` method to retrieve all the ECS clusters in your account. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('ecs')

   response = client.list_clusters()

   for cluster in response['clusterArns']:
       print(cluster)
   ```
   This will print the ARN of all the ECS clusters in your account.

3. **Describe ECS Clusters:**
   For each cluster, use the `describe_clusters` method to get more information about the cluster, including the Fargate version. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('ecs')

   response = client.describe_clusters(
       clusters=['clusterArn']  # replace with your cluster ARN
   )

   for cluster in response['clusters']:
       print(cluster['version'])
   ```
   This will print the Fargate version of the specified cluster.

4. **Check Fargate Version:**
   Finally, compare the Fargate version of each cluster with the latest version. If the version is not the latest, then it is a misconfiguration. Here is a sample script:
   ```python
   import boto3

   client = boto3.client('ecs')

   response = client.describe_clusters(
       clusters=['clusterArn']  # replace with your cluster ARN
   )

   for cluster in response['clusters']:
       if cluster['version'] < '1.4.0':  # replace with the latest version
           print(f"Cluster {cluster['clusterArn']} is not using the latest Fargate version")
   ```
   This will print the ARN of all the clusters that are not using the latest Fargate version.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of the latest ECS Fargate platform version not being set in AWS, follow these steps using the AWS Management Console:

1. **Login to AWS Console**: Go to the AWS Management Console (https://console.aws.amazon.com/) and login with your credentials.

2. **Navigate to ECS**: In the AWS Management Console, navigate to the ECS (Elastic Container Service) service by either searching for it in the services search bar or by selecting it from the list of recently visited services.

3. **Select the Cluster**: From the ECS dashboard, select the cluster where your Fargate tasks are running that you want to update the platform version for.

4. **View Services**: In the cluster view, click on the "Services" tab to view the list of services running in the cluster.

5. **Select Service**: Identify the service for which you want to update the ECS Fargate platform version and click on the service name to view its details.

6. **Update Task Definition**: In the service details page, locate the "Task Definition" section and click on the task definition name to view its details.

7. **Create New Revision**: In the task definition details page, click on the "Create new revision" button to create a new revision of the task definition.

8. **Update Platform Version**: In the task definition editor, scroll down to the "Fargate platform version" section and select the latest platform version available from the dropdown list.

9. **Review and Save**: Review the other configurations in the task definition if needed and then click on the "Create" button to save the new revision of the task definition with the updated Fargate platform version.

10. **Update Service**: Once the new task definition revision is created, go back to the service details page, click on the "Update" button, and select the newly created task definition revision with the updated Fargate platform version.

11. **Update Service**: Review the update strategy and click on the "Next step" button, then review the service configuration and click on the "Next step" button again.

12. **Update Service**: Finally, click on the "Update Service" button to apply the changes and update the service with the new task definition revision using the latest ECS Fargate platform version.

By following these steps, you will successfully remediate the misconfiguration of not having the latest ECS Fargate platform version set in AWS ECS for your Kubernetes cluster.

#### Using CLI

To remediate the misconfiguration of the latest ECS Fargate platform version not being set in AWS Kubernetes using AWS CLI, follow these steps:

1. List the available ECS Fargate platform versions using the following AWS CLI command:
   ```
   aws ecs list-account-settings --name serviceLongArnFormat
   ```

2. Identify the latest ECS Fargate platform version from the list of available versions.

3. Set the latest ECS Fargate platform version using the following AWS CLI command:
   ```
   aws ecs put-account-setting-default --name serviceLongArnFormat --value <latest_fargate_platform_version>
   ```
   Replace `<latest_fargate_platform_version>` with the actual latest ECS Fargate platform version identified in step 2.

4. Verify that the latest ECS Fargate platform version has been successfully set by running the following AWS CLI command:
   ```
   aws ecs list-account-settings --name serviceLongArnFormat
   ```

By following these steps, you can successfully remediate the misconfiguration of not having the latest ECS Fargate platform version set in AWS Kubernetes using AWS CLI.

#### Using Python

To remediate the misconfiguration of not having the latest ECS Fargate Platform version set in AWS Kubernetes using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:

```bash
pip install boto3
```

2. Use the following Python script to update the ECS Fargate Platform version in your AWS Kubernetes cluster:

```python
import boto3

# Initialize the ECS client
ecs_client = boto3.client('ecs')

# Get the list of ECS clusters in your account
response = ecs_client.list_clusters()
clusters = response['clusterArns']

# Iterate over each cluster
for cluster in clusters:
    # Describe the cluster to get the settings
    cluster_details = ecs_client.describe_clusters(clusters=[cluster])
    cluster_settings = cluster_details['clusters'][0]['settings']

    # Check if the Fargate platform version is already set to the latest version
    for setting in cluster_settings:
        if setting['name'] == 'containerInsights':
            if setting['value'] != 'enabled':
                # Update the Fargate platform version to the latest version
                response = ecs_client.update_cluster_settings(
                    cluster=cluster,
                    settings=[
                        {
                            'name': 'containerInsights',
                            'value': 'enabled'
                        },
                    ]
                )
                print(f"Updated ECS Fargate Platform version for cluster {cluster}.")

```

3. Run the Python script on your local machine or any environment where you have the necessary permissions to update ECS clusters.

This script will iterate through all the ECS clusters in your AWS account, check if the Fargate platform version is set to the latest version, and update it if necessary.

Make sure to configure your AWS credentials properly to allow the script to access and update the ECS clusters.


</Tab>
</Tabs>