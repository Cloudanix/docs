

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the Amazon EKS service.
2. In the left navigation pane, select "Clusters" to open the list of all your EKS clusters.
3. Click on the name of the cluster you want to check for High Availability. This will open the cluster details page.
4. In the cluster details page, check the "Subnets" section. A cluster is considered to have High Availability if it is spread across multiple Availability Zones. Therefore, if there are multiple subnets listed and they are in different Availability Zones, the cluster has High Availability.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured with the necessary permissions. You can install it using pip (Python package installer). The command is `pip install awscli`. After installation, you can configure it using `aws configure` command.

2. **List EKS Clusters**: Use the AWS CLI `eks` command to list all the EKS clusters in your account. The command is `aws eks list-clusters`. This will return a list of all EKS clusters.

3. **Describe EKS Cluster**: For each cluster, use the `describe-cluster` command to get detailed information about the cluster. The command is `aws eks describe-cluster --name <cluster-name>`. Replace `<cluster-name>` with the name of your cluster. This will return a JSON object with detailed information about the cluster.

4. **Check for High Availability**: In the returned JSON object, look for the `status` field. If the status is `ACTIVE`, the cluster is available. Then, check the `subnets` field in the `resourcesVpcConfig` object. If there are multiple subnets in different availability zones, the cluster has high availability. If there is only one subnet, or if the subnets are in the same availability zone, the cluster does not have high availability.

#### Using Python

1. Install the necessary Python libraries:
   You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials:
   You need to configure your AWS credentials. You can set your credentials for use by boto3 in several ways, but a common way is to use the AWS CLI. Run `aws configure` and then enter your access key, secret access key, and default region when prompted.

3. Write a Python script to check the availability of EKS clusters:
   Here is a simple script that uses boto3 to list all EKS clusters in your account and checks if they have high availability:

   ```python
   import boto3

   def check_eks_high_availability():
       client = boto3.client('eks')
       clusters = client.list_clusters()['clusters']
       for cluster in clusters:
           response = client.describe_cluster(name=cluster)
           subnets = response['cluster']['resourcesVpcConfig']['subnetIds']
           if len(subnets) < 2:
               print(f"Cluster {cluster} does not have high availability")
           else:
               print(f"Cluster {cluster} has high availability")

   check_eks_high_availability()
   ```
   This script lists all EKS clusters, then for each cluster, it checks the number of subnets. If a cluster is associated with less than two subnets, it does not have high availability.

4. Run the script:
   Save the script to a file, for example, `check_eks.py`, and then run it with Python:

   ```bash
   python check_eks.py
   ```
   The script will print out the names of all EKS clusters and whether they have high availability or not.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of EKS Clusters not having high availability in AWS, you can follow the below steps using the AWS console:

1. Go to the Amazon EKS console.

2. Select the EKS cluster that you want to remediate.

3. Click on the "Configuration" tab.

4. Under the "Networking" section, click on "Edit".

5. Ensure that the "Private networking only" option is unchecked.

6. Under the "High availability" section, click on "Edit".

7. Select the "Multiple Availability Zones" option.

8. Choose the number of availability zones you want to use.

9. Click on "Save".

10. Wait for the changes to propagate.

By following these steps, you can remediate the misconfiguration of EKS Clusters not having high availability in AWS.

#### Using CLI

To remediate the misconfiguration of EKS clusters not having high availability in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI and ensure that you have the necessary permissions to make changes to the EKS cluster.

2. Check if the EKS cluster is currently configured for high availability by running the following command:

   ```
   aws eks describe-cluster --name <cluster-name> --query "cluster.resourcesVpcConfig.endpointPublicAccess"
   ```

   This command will return a boolean value, where `true` indicates that the EKS cluster is configured for high availability, and `false` indicates that it is not.

3. If the EKS cluster is not configured for high availability, you can enable it by modifying the cluster's endpoint access configuration using the following command:

   ```
   aws eks update-cluster-config --name <cluster-name> --resources-vpc-config endpointPublicAccess=true
   ```

   This command will modify the EKS cluster's endpoint access configuration to enable high availability.

4. Verify that the EKS cluster is now configured for high availability by running the `describe-cluster` command again and checking the `endpointPublicAccess` value.

   ```
   aws eks describe-cluster --name <cluster-name> --query "cluster.resourcesVpcConfig.endpointPublicAccess"
   ```

   This command should now return `true`, indicating that the EKS cluster is configured for high availability.

5. Repeat these steps for any other EKS clusters that are not configured for high availability.

By following these steps, you can remediate the misconfiguration of EKS clusters not having high availability in AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of EKS Clusters not having high availability in AWS using Python, follow the steps below:

1. Import the necessary AWS SDK modules in Python:

```
import boto3
from botocore.exceptions import ClientError
```

2. Create a boto3 EKS client object:

```
eks_client = boto3.client('eks')
```

3. Get the EKS cluster name for which you want to enable high availability:

```
cluster_name = 'your-cluster-name'
```

4. Check if the EKS cluster is already highly available:

```
try:
    response = eks_client.describe_cluster(name=cluster_name)
    if response['cluster']['resourcesVpcConfig']['subnetIds']:
        print('EKS cluster is already highly available.')
    else:
        print('EKS cluster is not highly available.')
except ClientError as e:
    print('Error:', e)
```

5. If the EKS cluster is not highly available, update the cluster configuration to enable high availability:

```
try:
    eks_client.update_cluster_config(
        name=cluster_name,
        resourcesVpcConfig={
            'subnetIds': ['subnet-xxxxxxxx', 'subnet-yyyyyyyy', 'subnet-zzzzzzzz']
        }
    )
    print('EKS cluster configuration updated to enable high availability.')
except ClientError as e:
    print('Error:', e)
```

Note: Replace 'subnet-xxxxxxxx', 'subnet-yyyyyyyy', 'subnet-zzzzzzzz' with the IDs of the subnets in which you want to launch your EKS worker nodes. These subnets should be in different availability zones to enable high availability.

6. Verify that the EKS cluster is now highly available:

```
try:
    response = eks_client.describe_cluster(name=cluster_name)
    if response['cluster']['resourcesVpcConfig']['subnetIds']:
        print('EKS cluster is now highly available.')
    else:
        print('EKS cluster is still not highly available.')
except ClientError as e:
    print('Error:', e)
```

With these steps, you can remediate the misconfiguration of EKS clusters not having high availability in AWS using Python.


</Tab>
</Tabs>