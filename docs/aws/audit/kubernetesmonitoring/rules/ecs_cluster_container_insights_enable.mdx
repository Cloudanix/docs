---
slug: ecs_cluster_container_insights_enable
title: ECS Container Insights Should Be Enabled
sidebar_label: ECS Container Insights Should Be Enabled
---

### More Info:

Ensure ECS container insights are enabled

### Risk Level

Low

### Address

Security, Reliability

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Amazon ECS console at https://console.aws.amazon.com/ecs/.

2. In the navigation pane, choose Clusters.

3. On the Clusters page, select the name of the cluster you want to check.

4. In the Services tab, select the name of the service you want to inspect.

5. In the service detail page, scroll down to the Monitoring section. If Container Insights is enabled, you will see a section titled "CloudWatch Container Insights". If this section is not present, then Container Insights is not enabled for this service.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure the AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "aws ecs describe-clusters" command to list all the ECS clusters in your account. The command is as follows:

   ```
   aws ecs describe-clusters --clusters <your_cluster_name>
   ```

   Replace `<your_cluster_name>` with the name of your ECS cluster.

3. To check if Container Insights is enabled on your ECS cluster, you need to look for the "settings" attribute in the output of the above command. If Container Insights is enabled, you will see the following in the output:

   ```
   "settings": [
       {
           "name": "containerInsights",
           "value": "enabled"
       }
   ]
   ```

4. If you don't see the above in the output, it means that Container Insights is not enabled on your ECS cluster. You can also use a Python script with the boto3 library to automate this process. The script would use the "describe_clusters" function in the ECS client to get the same information.
</Accordion>

<Accordion title='Using Python'>
To check if ECS Container Insights is enabled in Kubernetes using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Import the necessary libraries and set up AWS credentials:**

    You need to import Boto3 and set up your AWS credentials (access key, secret access key, and region). You can do this in your Python script as follows:

    ```python
    import boto3

    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='YOUR_REGION'
    )
    ```

2. **Create an ECS client:**

    After setting up your credentials, you can create an ECS client using the Boto3 session.

    ```python
    ecs_client = session.client('ecs')
    ```

3. **List all ECS clusters:**

    You can list all your ECS clusters using the `list_clusters` method of the ECS client.

    ```python
    clusters = ecs_client.list_clusters()
    ```

4. **Check if Container Insights is enabled:**

    For each cluster, you can check if Container Insights is enabled using the `describe_clusters` method and checking the `settings` attribute.

    ```python
    for cluster in clusters['clusterArns']:
        response = ecs_client.describe_clusters(clusters=[cluster])
        for setting in response['clusters'][0]['settings']:
            if setting['name'] == 'containerInsights' and setting['value'] == 'enabled':
                print(f"Container Insights is enabled for cluster {cluster}")
            else:
                print(f"Container Insights is not enabled for cluster {cluster}")
    ```

This script will print out whether Container Insights is enabled for each ECS cluster. If Container Insights is not enabled for a cluster, it may indicate a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of ECS Container Insights not being enabled for AWS EKS using the AWS console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to Amazon EKS Console**: Go to the Amazon EKS console by searching for "EKS" in the AWS Management Console search bar and selecting Amazon EKS.

3. **Select your EKS Cluster**: From the list of EKS clusters, select the cluster for which you want to enable ECS Container Insights.

4. **Click on Add-ons**: In the cluster details page, click on the "Add-ons" tab.

5. **Enable Container Insights**: Under the "Add-ons" tab, you will see a list of available add-ons. Look for "Container Insights" and click on the "Enable" button next to it.

6. **Configure Container Insights**: Follow the on-screen instructions to configure ECS Container Insights for your EKS cluster. You may need to specify the log group and other configurations as required.

7. **Verify Configuration**: Once the configuration is complete, verify that ECS Container Insights is enabled for your EKS cluster by checking the status in the console.

By following these steps, you should be able to remediate the misconfiguration of ECS Container Insights not being enabled for your AWS EKS cluster using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To enable ECS Container Insights for AWS EKS clusters using AWS CLI, follow these steps:

1. Install and configure AWS CLI: Make sure you have AWS CLI installed and configured with appropriate credentials that have permissions to modify EKS clusters.

2. Enable Container Insights: Run the following AWS CLI command to enable Container Insights for your EKS cluster:
   
```
aws eks update-cluster-config --name YOUR_CLUSTER_NAME --logging '{"clusterLogging":[{"types":["api","audit","authenticator","controllerManager","scheduler"],"enabled":false},{"types":["*"],"enabled":true}]}'
```
Replace `YOUR_CLUSTER_NAME` with the name of your EKS cluster.

3. Verify Container Insights: To verify that Container Insights is enabled, you can run the following command:
   
```
aws eks describe-cluster --name YOUR_CLUSTER_NAME --query "cluster.logging"
```
Make sure that the output shows Container Insights enabled for the cluster.

4. Monitor Container Insights: Once Container Insights is enabled, you can monitor your EKS cluster using Amazon CloudWatch Container Insights.

By following these steps, you can successfully enable ECS Container Insights for your AWS EKS cluster using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Create a Python script with the following code to enable ECS Container Insights for your AWS EKS cluster:

```python
import boto3

def enable_ecs_container_insights(cluster_name):
    client = boto3.client('eks')

    # Describe the cluster to get the ARN
    response = client.describe_cluster(name=cluster_name)
    cluster_arn = response['cluster']['arn']

    # Enable Container Insights for the cluster
    response = client.update_cluster_config(
        name=cluster_name,
        logging={
            'clusterLogging': [
                {
                    'types': ['api', 'audit', 'authenticator', 'controllerManager', 'scheduler'],
                    'enabled': True
                },
                {
                    'types': ['fluentd', 'kubelet'],
                    'enabled': True
                }
            ]
        }
    )

    print(f"ECS Container Insights enabled for cluster: {cluster_name}")

# Replace 'your_cluster_name' with the name of your AWS EKS cluster
enable_ecs_container_insights('your_cluster_name')
```

3. Replace `'your_cluster_name'` in the script with the name of your AWS EKS cluster.

4. Run the Python script using the command:
   ```
   python enable_ecs_container_insights.py
   ```

5. The script will enable ECS Container Insights for your AWS EKS cluster, and you should see the message "ECS Container Insights enabled for cluster: your_cluster_name" upon successful completion.

By following these steps, you can remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

