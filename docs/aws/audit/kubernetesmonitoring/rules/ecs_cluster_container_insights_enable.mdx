---
slug: ecs_cluster_container_insights_enable
title: ECS Container Insights Should Be Enabled
sidebar_label: ECS Container Insights Should Be Enabled
---

### More Info:

Ensure ECS container insights are enabled

### Risk Level

Low

### Address

Security, Reliability

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the Amazon ECS dashboard at https://console.aws.amazon.com/ecs/.

2. In the navigation pane, choose "Clusters".

3. On the Clusters page, select the name of the cluster that you want to examine.

4. In the Services tab, select the name of the service that you want to check.

5. In the `Service : <service_name>` page, select the "Logs" tab. If the "Logs" tab displays "No logs to display", it means that the ECS Container Insights is not enabled for the selected ECS service.

#### Using CLI

1. First, you need to install and configure the AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "aws ecs describe-clusters" command to list all the ECS clusters in your account. The command is as follows:

   ```
   aws ecs describe-clusters --clusters <your_cluster_name>
   ```

   Replace `<your_cluster_name>` with the name of your ECS cluster.

3. To check if Container Insights is enabled for a specific ECS cluster, you need to look for the "settings" attribute in the output of the "describe-clusters" command. If Container Insights is enabled, you will see the following:

   ```
   "settings": [
       {
           "name": "containerInsights",
           "value": "enabled"
       }
   ]
   ```

4. If you want to check this for all clusters, you can use a script to loop through all the clusters. Here is a simple Python script using the boto3 library:

   ```python
   import boto3

   client = boto3.client('ecs')

   response = client.list_clusters()

   for cluster in response['clusterArns']:
       cluster_info = client.describe_clusters(clusters=[cluster])
       for setting in cluster_info['clusters'][0]['settings']:
           if setting['name'] == 'containerInsights':
               print(f"Cluster: {cluster}, Container Insights: {setting['value']}")
   ```

   This script will print the status of Container Insights for each ECS cluster in your AWS account.

#### Using Python

To check if ECS Container Insights is enabled in Kubernetes using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Import the necessary libraries and set up AWS credentials:**

    You need to import Boto3 and set up your AWS credentials. You can do this by setting up your AWS credentials as environment variables or by using the AWS CLI. Here's an example of how to do it:

    ```python
    import boto3

    # Set up AWS credentials
    aws_access_key_id = 'YOUR_ACCESS_KEY'
    aws_secret_access_key = 'YOUR_SECRET_KEY'
    region_name = 'us-west-2' # or your preferred region

    session = boto3.Session(
        aws_access_key_id=aws_access_key_id,
        aws_secret_access_key=aws_secret_access_key,
        region_name=region_name
    )
    ```

2. **Create a client for ECS:**

    You need to create a client for ECS to interact with the service. You can do this using the `client` method of your session object:

    ```python
    ecs_client = session.client('ecs')
    ```

3. **List all ECS clusters:**

    You can list all ECS clusters using the `list_clusters` method of your ECS client:

    ```python
    clusters = ecs_client.list_clusters()
    ```

4. **Check if Container Insights is enabled:**

    For each cluster, you can check if Container Insights is enabled using the `describe_clusters` method of your ECS client. If the `settings` attribute of a cluster includes an item with the name `containerInsights` and the value `enabled`, then Container Insights is enabled for that cluster:

    ```python
    for cluster in clusters['clusterArns']:
        response = ecs_client.describe_clusters(clusters=[cluster])
        for setting in response['clusters'][0]['settings']:
            if setting['name'] == 'containerInsights' and setting['value'] == 'enabled':
                print(f'Container Insights is enabled for cluster {cluster}')
            else:
                print(f'Container Insights is not enabled for cluster {cluster}')
    ```

This script will print out whether Container Insights is enabled for each ECS cluster. If Container Insights is not enabled for a cluster, that could be a potential misconfiguration.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration of ECS Container Insights not being enabled for AWS EKS using the AWS console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to Amazon EKS Console**: Go to the Amazon EKS console by searching for "EKS" in the AWS Management Console search bar and selecting Amazon EKS.

3. **Select your EKS Cluster**: From the list of EKS clusters, select the cluster for which you want to enable ECS Container Insights.

4. **Click on Add-ons**: In the cluster details page, click on the "Add-ons" tab.

5. **Enable Container Insights**: Under the "Add-ons" tab, you will see a list of available add-ons. Look for "Container Insights" and click on the "Enable" button next to it.

6. **Configure Container Insights**: Follow the on-screen instructions to configure ECS Container Insights for your EKS cluster. You may need to specify the log group and other configurations as required.

7. **Verify Configuration**: Once the configuration is complete, verify that ECS Container Insights is enabled for your EKS cluster by checking the status in the console.

By following these steps, you should be able to remediate the misconfiguration of ECS Container Insights not being enabled for your AWS EKS cluster using the AWS console.

#### Using CLI

To enable ECS Container Insights for AWS EKS clusters using AWS CLI, follow these steps:

1. Install and configure AWS CLI: Make sure you have AWS CLI installed and configured with appropriate credentials that have permissions to modify EKS clusters.

2. Enable Container Insights: Run the following AWS CLI command to enable Container Insights for your EKS cluster:
   
```
aws eks update-cluster-config --name YOUR_CLUSTER_NAME --logging '{"clusterLogging":[{"types":["api","audit","authenticator","controllerManager","scheduler"],"enabled":false},{"types":["*"],"enabled":true}]}'
```
Replace `YOUR_CLUSTER_NAME` with the name of your EKS cluster.

3. Verify Container Insights: To verify that Container Insights is enabled, you can run the following command:
   
```
aws eks describe-cluster --name YOUR_CLUSTER_NAME --query "cluster.logging"
```
Make sure that the output shows Container Insights enabled for the cluster.

4. Monitor Container Insights: Once Container Insights is enabled, you can monitor your EKS cluster using Amazon CloudWatch Container Insights.

By following these steps, you can successfully enable ECS Container Insights for your AWS EKS cluster using AWS CLI.

#### Using Python

To remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Create a Python script with the following code to enable ECS Container Insights for your AWS EKS cluster:

```python
import boto3

def enable_ecs_container_insights(cluster_name):
    client = boto3.client('eks')

    # Describe the cluster to get the ARN
    response = client.describe_cluster(name=cluster_name)
    cluster_arn = response['cluster']['arn']

    # Enable Container Insights for the cluster
    response = client.update_cluster_config(
        name=cluster_name,
        logging={
            'clusterLogging': [
                {
                    'types': ['api', 'audit', 'authenticator', 'controllerManager', 'scheduler'],
                    'enabled': True
                },
                {
                    'types': ['fluentd', 'kubelet'],
                    'enabled': True
                }
            ]
        }
    )

    print(f"ECS Container Insights enabled for cluster: {cluster_name}")

# Replace 'your_cluster_name' with the name of your AWS EKS cluster
enable_ecs_container_insights('your_cluster_name')
```

3. Replace `'your_cluster_name'` in the script with the name of your AWS EKS cluster.

4. Run the Python script using the command:
   ```
   python enable_ecs_container_insights.py
   ```

5. The script will enable ECS Container Insights for your AWS EKS cluster, and you should see the message "ECS Container Insights enabled for cluster: your_cluster_name" upon successful completion.

By following these steps, you can remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python.




</Tab>
</Tabs>