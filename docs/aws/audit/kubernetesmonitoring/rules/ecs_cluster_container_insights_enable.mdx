---
slug: ecs_cluster_container_insights_enable
title: ECS Container Insights Should Be Enabled
sidebar_label: ECS Container Insights Should Be Enabled
---

### More Info:

Ensure ECS container insights are enabled

### Risk Level

Low

### Address

Security, Reliability

### Compliance Standards

CBP,GDPR,HIPAA,ISO27001


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of "ECS Container Insights Should Be Enabled in Kubernetes" using the AWS Management Console, follow these steps:

1. **Navigate to ECS Cluster:**
   - Open the AWS Management Console.
   - In the navigation pane, choose **ECS** (Elastic Container Service).
   - Select the cluster you want to enable Container Insights for.

2. **Enable Container Insights:**
   - In the cluster details page, choose the **Update Cluster** button.
   - In the **Monitoring** section, check the box for **Enable Container Insights**.

3. **Review and Update:**
   - Review the settings to ensure Container Insights is enabled.
   - Choose **Update** to apply the changes.

4. **Verify Configuration:**
   - After updating, go to the **CloudWatch** service in the AWS Management Console.
   - Navigate to **Container Insights** under the **Metrics** section to verify that metrics are being collected for your ECS cluster.

By following these steps, you can ensure that ECS Container Insights are enabled, which helps in monitoring and troubleshooting your Kubernetes workloads on AWS.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of ECS Container Insights not being enabled in Kubernetes using AWS CLI, follow these steps:

1. **Update the AWS CLI to the Latest Version:**
   Ensure you have the latest version of the AWS CLI installed to access the most recent features and commands.
   ```sh
   aws --version
   ```

2. **Enable Container Insights for ECS Clusters:**
   Use the `update-cluster-settings` command to enable Container Insights for your ECS cluster.
   ```sh
   aws ecs update-cluster-settings --cluster <your-cluster-name> --settings name=containerInsights,value=enabled
   ```

3. **Verify the Cluster Settings:**
   Confirm that Container Insights has been enabled by describing the cluster settings.
   ```sh
   aws ecs describe-clusters --clusters <your-cluster-name> --query "clusters[0].settings"
   ```

4. **Configure CloudWatch Agent for Kubernetes:**
   Ensure the CloudWatch agent is configured to collect metrics from your Kubernetes cluster. This involves creating a CloudWatch agent configuration file and applying it to your cluster.
   ```sh
   kubectl apply -f https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/master/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/quick-start/cwagent/cwagent-daemonset.yaml
   ```

By following these steps, you can ensure that ECS Container Insights are enabled for your Kubernetes clusters using the AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of ECS Container Insights not being enabled in Kubernetes using Python scripts, you can follow these steps:

### 1. **Set Up AWS SDK for Python (Boto3)**
First, ensure you have the AWS SDK for Python (Boto3) installed. You can install it using pip if you haven't already:

```bash
pip install boto3
```

### 2. **Create a Boto3 Session**
Create a Boto3 session to interact with AWS services. This will allow you to authenticate and make API calls.

```python
import boto3

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_AWS_ACCESS_KEY',
    aws_secret_access_key='YOUR_AWS_SECRET_KEY',
    region_name='YOUR_AWS_REGION'
)
```

### 3. **Enable Container Insights for ECS Clusters**
Use the Boto3 ECS client to enable Container Insights for your ECS clusters. This involves updating the ECS cluster settings.

```python
# Create an ECS client
ecs_client = session.client('ecs')

# List all ECS clusters
clusters = ecs_client.list_clusters()

# Enable Container Insights for each cluster
for cluster_arn in clusters['clusterArns']:
    ecs_client.update_cluster_settings(
        cluster=cluster_arn,
        settings=[
            {
                'name': 'containerInsights',
                'value': 'enabled'
            }
        ]
    )
    print(f"Enabled Container Insights for cluster: {cluster_arn}")
```

### 4. **Verify Container Insights Status**
After enabling Container Insights, you can verify the status to ensure it has been enabled correctly.

```python
# Verify Container Insights status for each cluster
for cluster_arn in clusters['clusterArns']:
    response = ecs_client.describe_clusters(
        clusters=[cluster_arn],
        include=['SETTINGS']
    )
    settings = response['clusters'][0]['settings']
    for setting in settings:
        if setting['name'] == 'containerInsights':
            print(f"Cluster: {cluster_arn}, Container Insights: {setting['value']}")
```

### Summary
1. **Set Up AWS SDK for Python (Boto3)**: Install and import Boto3.
2. **Create a Boto3 Session**: Authenticate using your AWS credentials.
3. **Enable Container Insights for ECS Clusters**: Use the ECS client to enable Container Insights.
4. **Verify Container Insights Status**: Check the status to ensure Container Insights is enabled.

By following these steps, you can programmatically ensure that ECS Container Insights are enabled for your Kubernetes clusters using Python scripts.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and navigate to the Amazon ECS console at https://console.aws.amazon.com/ecs/.

2. In the navigation pane, choose Clusters.

3. On the Clusters page, select the name of the cluster you want to check.

4. In the Services tab, select the name of the service you want to inspect.

5. In the service detail page, scroll down to the Monitoring section. If Container Insights is enabled, you will see a section titled "CloudWatch Container Insights". If this section is not present, then Container Insights is not enabled for this service.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure the AWS CLI on your local machine. You can download it from the official AWS website and configure it using the "aws configure" command. You will be prompted to enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. Once the AWS CLI is set up, you can use the "aws ecs describe-clusters" command to list all the ECS clusters in your account. The command is as follows:

   ```
   aws ecs describe-clusters --clusters <your_cluster_name>
   ```

   Replace `<your_cluster_name>` with the name of your ECS cluster.

3. To check if Container Insights is enabled on your ECS cluster, you need to look for the "settings" attribute in the output of the above command. If Container Insights is enabled, you will see the following in the output:

   ```
   "settings": [
       {
           "name": "containerInsights",
           "value": "enabled"
       }
   ]
   ```

4. If you don't see the above in the output, it means that Container Insights is not enabled on your ECS cluster. You can also use a Python script with the boto3 library to automate this process. The script would use the "describe_clusters" function in the ECS client to get the same information.
</Accordion>

<Accordion title='Using Python'>
To check if ECS Container Insights is enabled in Kubernetes using Python scripts, you can use the AWS SDK for Python (Boto3). Here are the steps:

1. **Import the necessary libraries and set up AWS credentials:**

    You need to import Boto3 and set up your AWS credentials (access key, secret access key, and region). You can do this in your Python script as follows:

    ```python
    import boto3

    session = boto3.Session(
        aws_access_key_id='YOUR_ACCESS_KEY',
        aws_secret_access_key='YOUR_SECRET_KEY',
        region_name='YOUR_REGION'
    )
    ```

2. **Create an ECS client:**

    After setting up your credentials, you can create an ECS client using the Boto3 session.

    ```python
    ecs_client = session.client('ecs')
    ```

3. **List all ECS clusters:**

    You can list all your ECS clusters using the `list_clusters` method of the ECS client.

    ```python
    clusters = ecs_client.list_clusters()
    ```

4. **Check if Container Insights is enabled:**

    For each cluster, you can check if Container Insights is enabled using the `describe_clusters` method and checking the `settings` attribute.

    ```python
    for cluster in clusters['clusterArns']:
        response = ecs_client.describe_clusters(clusters=[cluster])
        for setting in response['clusters'][0]['settings']:
            if setting['name'] == 'containerInsights' and setting['value'] == 'enabled':
                print(f"Container Insights is enabled for cluster {cluster}")
            else:
                print(f"Container Insights is not enabled for cluster {cluster}")
    ```

This script will print out whether Container Insights is enabled for each ECS cluster. If Container Insights is not enabled for a cluster, it may indicate a misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of ECS Container Insights not being enabled for AWS EKS using the AWS console, follow these steps:

1. **Sign in to the AWS Management Console**: Go to https://aws.amazon.com/ and sign in to your AWS account.

2. **Navigate to Amazon EKS Console**: Go to the Amazon EKS console by searching for "EKS" in the AWS Management Console search bar and selecting Amazon EKS.

3. **Select your EKS Cluster**: From the list of EKS clusters, select the cluster for which you want to enable ECS Container Insights.

4. **Click on Add-ons**: In the cluster details page, click on the "Add-ons" tab.

5. **Enable Container Insights**: Under the "Add-ons" tab, you will see a list of available add-ons. Look for "Container Insights" and click on the "Enable" button next to it.

6. **Configure Container Insights**: Follow the on-screen instructions to configure ECS Container Insights for your EKS cluster. You may need to specify the log group and other configurations as required.

7. **Verify Configuration**: Once the configuration is complete, verify that ECS Container Insights is enabled for your EKS cluster by checking the status in the console.

By following these steps, you should be able to remediate the misconfiguration of ECS Container Insights not being enabled for your AWS EKS cluster using the AWS console.

#
</Accordion>

<Accordion title='Using CLI'>
To enable ECS Container Insights for AWS EKS clusters using AWS CLI, follow these steps:

1. Install and configure AWS CLI: Make sure you have AWS CLI installed and configured with appropriate credentials that have permissions to modify EKS clusters.

2. Enable Container Insights: Run the following AWS CLI command to enable Container Insights for your EKS cluster:
   
```
aws eks update-cluster-config --name YOUR_CLUSTER_NAME --logging '{"clusterLogging":[{"types":["api","audit","authenticator","controllerManager","scheduler"],"enabled":false},{"types":["*"],"enabled":true}]}'
```
Replace `YOUR_CLUSTER_NAME` with the name of your EKS cluster.

3. Verify Container Insights: To verify that Container Insights is enabled, you can run the following command:
   
```
aws eks describe-cluster --name YOUR_CLUSTER_NAME --query "cluster.logging"
```
Make sure that the output shows Container Insights enabled for the cluster.

4. Monitor Container Insights: Once Container Insights is enabled, you can monitor your EKS cluster using Amazon CloudWatch Container Insights.

By following these steps, you can successfully enable ECS Container Insights for your AWS EKS cluster using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python, follow these steps:

1. Install the AWS SDK for Python (Boto3) if you haven't already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Create a Python script with the following code to enable ECS Container Insights for your AWS EKS cluster:

```python
import boto3

def enable_ecs_container_insights(cluster_name):
    client = boto3.client('eks')

    # Describe the cluster to get the ARN
    response = client.describe_cluster(name=cluster_name)
    cluster_arn = response['cluster']['arn']

    # Enable Container Insights for the cluster
    response = client.update_cluster_config(
        name=cluster_name,
        logging={
            'clusterLogging': [
                {
                    'types': ['api', 'audit', 'authenticator', 'controllerManager', 'scheduler'],
                    'enabled': True
                },
                {
                    'types': ['fluentd', 'kubelet'],
                    'enabled': True
                }
            ]
        }
    )

    print(f"ECS Container Insights enabled for cluster: {cluster_name}")

# Replace 'your_cluster_name' with the name of your AWS EKS cluster
enable_ecs_container_insights('your_cluster_name')
```

3. Replace `'your_cluster_name'` in the script with the name of your AWS EKS cluster.

4. Run the Python script using the command:
   ```
   python enable_ecs_container_insights.py
   ```

5. The script will enable ECS Container Insights for your AWS EKS cluster, and you should see the message "ECS Container Insights enabled for cluster: your_cluster_name" upon successful completion.

By following these steps, you can remediate the misconfiguration of ECS Container Insights not being enabled for AWS Kubernetes using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

