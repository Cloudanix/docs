---
slug: elb_alb_security_group
title: ALBs Should Not Have Insecure Configurations
sidebar_label: ALBs Should Not Have Insecure Configurations
---

### More Info:

Your Application Load Balancers (ALBs) listeners should not have insecure configurations.

### Risk Level

Medium

### Address

Security

### Compliance Standards

AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the Application Load Balancer (ALB) that you want to inspect.

4. In the bottom panel, select the "Listeners" tab. Here you can see the protocols and ports configured for your ALB. If the protocol is HTTP (not HTTPS) on port 80, it means the ALB is using an insecure configuration.

5. Next, select the "Attributes" tab. Check the "Deletion Protection" attribute. If it's disabled, it's a misconfiguration as it allows the ALB to be deleted accidentally.

6. Also, in the "Attributes" tab, check the "Access logs" attribute. If it's disabled, it's a misconfiguration as it prevents the logging of requests made to the ALB.

7. Lastly, in the "Security" tab, check the security policies. If the security policy is not set to the latest policy, it's a misconfiguration as it may allow weak ciphers and protocols.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer). The command is `pip install awscli`. After installation, you can configure it using `aws configure` command. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. **List all the Load Balancers**: Use the following AWS CLI command to list all the Application Load Balancers (ALBs) in your account:

    ```
    aws elbv2 describe-load-balancers
    ```

    This command will return a JSON output with details of all the ALBs.

3. **Check the ALB Configurations**: For each ALB, check the attributes related to security like deletion protection, access logs, and idle timeout. Use the following command:

    ```
    aws elbv2 describe-load-balancer-attributes --load-balancer-arn {Load_Balancer_Arn}
    ```

    Replace `{Load_Balancer_Arn}` with the ARN of your ALB. This command will return a JSON output with the attributes of the specified ALB.

4. **Check the Listener Configurations**: For each ALB, also check the listener configurations, especially the protocol and cipher settings. Use the following command:

    ```
    aws elbv2 describe-listeners --load-balancer-arn {Load_Balancer_Arn}
    ```

    Replace `{Load_Balancer_Arn}` with the ARN of your ALB. This command will return a JSON output with the listeners of the specified ALB. Look for listeners that are using insecure protocols or ciphers.

Remember, you need to parse the JSON output of these commands to check for insecure configurations. You can use tools like `jq` or write a script in Python or any other language to automate this process.

#### Using Python

1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS credentials: Boto3 needs your AWS credentials (access key and secret access key) to interact with AWS services. You can configure it in several ways, but the simplest is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then, input your access key, secret access key, and your preferred AWS region.

3. Write a Python script to check ALB configurations: The following script lists all the ALBs and checks if they have insecure configurations such as HTTP listener or deletion protection disabled.

   ```python
   import boto3

   def check_alb_config():
       client = boto3.client('elbv2')
       balancers = client.describe_load_balancers()
       for balancer in balancers['LoadBalancers']:
           attrs = client.describe_load_balancer_attributes(LoadBalancerArn=balancer['LoadBalancerArn'])
           for attr in attrs['Attributes']:
               if attr['Key'] == 'deletion_protection.enabled' and attr['Value'] == 'false':
                   print(f"ALB {balancer['LoadBalancerName']} has deletion protection disabled")
               if attr['Key'] == 'access_logs.s3.enabled' and attr['Value'] == 'false':
                   print(f"ALB {balancer['LoadBalancerName']} has access logs disabled")
           listeners = client.describe_listeners(LoadBalancerArn=balancer['LoadBalancerArn'])
           for listener in listeners['Listeners']:
               if listener['Protocol'] == 'HTTP':
                   print(f"ALB {balancer['LoadBalancerName']} has an HTTP listener")

   if __name__ == "__main__":
       check_alb_config()
   ```

4. Run the script: You can run the script using the Python interpreter. The script will print the names of the ALBs that have insecure configurations.

   ```bash
   python check_alb_config.py
   ```

This script checks for some common misconfigurations, but there might be other insecure settings depending on your specific use case. You can modify the script to check for other attributes as needed.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the "ALBs Should Not Have Insecure Configurations" misconfiguration in AWS:

1. Log in to your AWS console.

2. Navigate to the AWS Application Load Balancer (ALB) that has an insecure configuration.

3. Click on the "Listeners" tab.

4. Review the current listener configuration to ensure that it uses secure protocols such as HTTPS.

5. If the current listener configuration is insecure, click on the "Edit" button.

6. Update the listener configuration to use secure protocols such as HTTPS.

7. Click on the "Save" button to save the updated configuration.

8. Navigate to the "Security" tab.

9. Review the current security configuration to ensure that it meets your security requirements.

10. If the current security configuration is insecure, click on the "Edit" button.

11. Update the security configuration to meet your security requirements.

12. Click on the "Save" button to save the updated configuration.

13. Verify that the ALB now has a secure configuration.

14. If the ALB still has an insecure configuration, review the AWS documentation or seek assistance from AWS support to resolve the issue.

By following these steps, you can remediate the "ALBs Should Not Have Insecure Configurations" misconfiguration in AWS.

#### Using CLI

To remediate the insecure configurations of ALBs in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to list all the ALBs in your AWS account:

   ```
   aws elbv2 describe-load-balancers
   ```

3. Identify the ALB with insecure configurations.

4. Run the following command to modify the security policy of the identified ALB:

   ```
   aws elbv2 modify-load-balancer-attributes --load-balancer-arn <ALB_ARN> --attributes Key=security.groups.enabled,Value=true
   ```

   Replace `<ALB_ARN>` with the ARN of the identified ALB.

5. Run the following command to verify that the security policy has been modified:

   ```
   aws elbv2 describe-load-balancer-attributes --load-balancer-arn <ALB_ARN>
   ```

   Replace `<ALB_ARN>` with the ARN of the identified ALB.

6. Verify that the security policy has been modified successfully.

By following these steps, you can remediate the insecure configurations of ALBs in AWS using AWS CLI.

#### Using Python

To remediate the insecure configuration of Application Load Balancers (ALBs) in AWS using Python, you can follow the below steps:

Step 1: Install the necessary AWS SDK for Python (Boto3) using pip:

```
pip install boto3
```

Step 2: Create a Boto3 client for Elastic Load Balancing (ELB) service:

```python
import boto3

elbv2_client = boto3.client('elbv2')
```

Step 3: Get a list of all the ALBs in your AWS account:

```python
response = elbv2_client.describe_load_balancers()
alb_list = response['LoadBalancers']
```

Step 4: For each ALB in the list, check if it has any insecure configuration and remediate it:

```python
for alb in alb_list:
    # Check if the ALB has any insecure configuration
    if alb['Scheme'] != 'internet-facing':
        # If the ALB is not internet-facing, modify its scheme to internet-facing
        response = elbv2_client.modify_load_balancer_attributes(
            LoadBalancerArn=alb['LoadBalancerArn'],
            Attributes=[
                {
                    'Key': 'scheme',
                    'Value': 'internet-facing'
                }
            ]
        )
```

Step 5: Verify that the insecure configuration has been remediated by checking the scheme of the ALB:

```python
response = elbv2_client.describe_load_balancers(
    LoadBalancerArns=[
        alb['LoadBalancerArn']
    ]
)
alb_scheme = response['LoadBalancers'][0]['Scheme']
print(f"ALB {alb['LoadBalancerArn']} scheme: {alb_scheme}")
```

Note: This is just an example of how to remediate insecure configurations of ALBs in AWS using Python. Depending on the specific misconfiguration, the remediation steps may vary.

### Additional Reading:

- [https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-cfg-alb.html](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-cfg-alb.html) 


</Tab>
</Tabs>