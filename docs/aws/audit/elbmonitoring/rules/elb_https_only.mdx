---
slug: elb_https_only
title: ELB Should Accept HTTPS Connections Only
sidebar_label: ELB Should Accept HTTPS Connections Only
---

### More Info:

ELB should be configured to block HTTP connection and allow only HTTPS connections.

### Risk Level

High

### Address

Security

### Compliance Standards

HIPAA, GDPR, NIST, SOC2, PCIDSS, AWSWAF, HITRUST, NISTCSF, FedRAMP



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.
   
2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the load balancer that you want to check.

4. In the bottom panel, select the "Listeners" tab. This tab displays the protocols and ports used by your load balancer to route traffic to your instances.

5. Check the protocol of the listener. If the protocol is not HTTPS or SSL, then the load balancer is not configured to accept only HTTPS connections.

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the Load Balancers: Use the following command to list all the load balancers in your AWS account:

   ```
   aws elbv2 describe-load-balancers
   ```
   This command will return a JSON output with details of all the load balancers.

3. Check the listeners for each Load Balancer: For each Load Balancer, you need to check the listeners to see if they accept HTTPS connections. You can do this by running the following command:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <LoadBalancerArn>
   ```
   Replace `<LoadBalancerArn>` with the ARN of the Load Balancer you want to check. This command will return a JSON output with details of all the listeners for the specified Load Balancer.

4. Analyze the output: In the output of the previous command, look for the "Protocol" field under each listener. If any listener has the protocol set to "HTTP", it means that the Load Balancer is accepting HTTP connections, which is a misconfiguration.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of AWS services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Configure AWS Credentials: Boto3 needs your AWS credentials (access key and secret access key) to call AWS services on your behalf. You can configure it in several ways. The easiest way is to use the AWS CLI:

   ```bash
   aws configure
   ```

   Then input your Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

3. Write the Python script: The following Python script uses Boto3 to check if the Elastic Load Balancer (ELB) accepts HTTPS connections only:

   ```python
   import boto3

   def check_https_only():
       elb = boto3.client('elbv2')
       load_balancers = elb.describe_load_balancers()
       for lb in load_balancers['LoadBalancers']:
           lb_arn = lb['LoadBalancerArn']
           lb_listeners = elb.describe_listeners(LoadBalancerArn=lb_arn)
           for listener in lb_listeners['Listeners']:
               if listener['Protocol'] != 'HTTPS':
                   print(f"Load Balancer {lb['LoadBalancerName']} has a listener that does not use HTTPS.")

   check_https_only()
   ```

4. Run the Python script: Save the script to a file, for example, check_https_only.py, and then run it using Python:

   ```bash
   python check_https_only.py
   ```

   The script will print the names of the load balancers that have listeners not using HTTPS. If no such load balancers are found, it will not print anything.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "ELB Should Accept HTTPS Connections Only" in AWS using AWS console, follow these steps:

1. Open the AWS Management Console and navigate to the EC2 Dashboard.
2. Click on Load Balancers from the left-hand menu.
3. Select the load balancer that you want to configure to accept HTTPS connections only.
4. Click on the Listeners tab.
5. Click on Edit in the Actions column for the HTTPS listener.
6. In the Edit Listener dialog box, select HTTPS as the Protocol.
7. In the SSL Certificate drop-down menu, select the SSL certificate that you want to use for the HTTPS listener.
8. In the Default Actions section, click on the X icon next to the existing action to remove it.
9. Click on Add Action and select Forward to from the drop-down menu.
10. In the Forward to drop-down menu, select the target group that you want to forward traffic to.
11. Click on Save.

After following these steps, your ELB will be configured to accept HTTPS connections only. Any HTTP traffic will be automatically redirected to HTTPS.

#### Using CLI

To remediate the ELB accepting only HTTPS connections in AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.
2. Run the following command to describe the current configuration of the ELB:

```
aws elb describe-load-balancers --load-balancer-name <ELB_NAME>
```

Replace `<ELB_NAME>` with the name of your ELB.

3. Check if the ELB is currently accepting both HTTP and HTTPS connections. If it is, you need to modify the listener to accept HTTPS connections only.

4. Run the following command to modify the listener to accept HTTPS connections only:

```
aws elb modify-load-balancer-attributes --load-balancer-name <ELB_NAME> --load-balancer-attributes "{\"LoadBalancerAttributes\":{\"ConnectionSettings\":{\"IdleTimeout\":3600},\"AccessLog\":{\"Enabled\":false},\"ConnectionDraining\":{\"Enabled\":false},\"CrossZoneLoadBalancing\":{\"Enabled\":false},\"SecurityGroups\":[\"<SECURITY_GROUP_ID>\"],\"AdditionalAttributes\":[{\"Key\":\"listener.sslPolicy\",\"Value\":\"ELBSecurityPolicy-2016-08\"}],\"Listeners\":[{\"Protocol\":\"HTTPS\",\"LoadBalancerPort\":443,\"InstanceProtocol\":\"HTTP\",\"InstancePort\":80}]}}"
```

Replace `<ELB_NAME>` with the name of your ELB and `<SECURITY_GROUP_ID>` with the ID of the security group that the ELB should use.

5. Verify that the ELB is now accepting HTTPS connections only by running the following command:

```
aws elb describe-load-balancers --load-balancer-name <ELB_NAME>
```

The output should show that the listener is now configured to accept HTTPS connections only.

Note: Make sure to replace `<ELB_NAME>` and `<SECURITY_GROUP_ID>` with the appropriate values for your ELB.

#### Using Python

To remediate the misconfiguration "ELB Should Accept HTTPS Connections Only" for AWS using python, you can follow the below steps:

1. Import the necessary libraries:

```
import boto3
```

2. Create an AWS ELB client:

```
elb_client = boto3.client('elbv2')
```

3. Get the list of all the load balancers:

```
lb_list = elb_client.describe_load_balancers()
```

4. Iterate through the list of load balancers and update the listener protocol to HTTPS:

```
for lb in lb_list['LoadBalancers']:
    lb_arn = lb['LoadBalancerArn']
    listener_list = elb_client.describe_listeners(LoadBalancerArn=lb_arn)
    for listener in listener_list['Listeners']:
        if listener['Protocol'] != 'HTTPS':
            elb_client.modify_listener(
                ListenerArn=listener['ListenerArn'],
                Protocol='HTTPS'
            )
```

5. Verify that the listener protocol has been updated to HTTPS:

```
listener_list = elb_client.describe_listeners(LoadBalancerArn=lb_arn)
for listener in listener_list['Listeners']:
    if listener['Protocol'] != 'HTTPS':
        print('Listener protocol not updated to HTTPS')
    else:
        print('Listener protocol updated to HTTPS')
```

By following the above steps, the misconfiguration "ELB Should Accept HTTPS Connections Only" can be remediated for AWS using python.

### Additional Reading:

- [https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html](https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html) 


</Tab>
</Tabs>