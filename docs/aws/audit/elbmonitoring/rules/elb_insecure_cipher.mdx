---
slug: elb_insecure_cipher
title: ELBs Should Not Have Insecure Ciphers
sidebar_label: ELBs Should Not Have Insecure Ciphers
---

### More Info:

Insecure ciphers on ELBs should be checked. Various security vulnerabilities have rendered several ciphers insecure. Only the recommended ciphers should be used.

### Risk Level

Low

### Address

Security

### Compliance Standards

AWSWAF



### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent Elastic Load Balancers (ELBs) from using insecure ciphers in AWS using the AWS Management Console, follow these steps:

1. **Navigate to the EC2 Dashboard:**
   - Open the AWS Management Console.
   - In the Services menu, select "EC2" to go to the EC2 Dashboard.

2. **Select Load Balancers:**
   - In the left-hand navigation pane, under "Load Balancing," click on "Load Balancers."

3. **Modify SSL/TLS Settings:**
   - Select the load balancer you want to configure.
   - Go to the "Listeners" tab.
   - For each listener that uses HTTPS (SSL/TLS), click on the "View/edit certificates" icon (pencil icon).

4. **Update Security Policy:**
   - In the "Edit SSL/TLS Certificate" dialog, scroll down to the "Security policy" section.
   - Choose a predefined security policy that does not include insecure ciphers (e.g., `ELBSecurityPolicy-2016-08` or later).
   - Save the changes.

By following these steps, you ensure that your ELBs are configured to use secure ciphers, thereby enhancing the security of your load-balanced applications.
</Accordion>

<Accordion title='Using CLI'>
To prevent Elastic Load Balancers (ELBs) from using insecure ciphers in AWS using the AWS CLI, you can follow these steps:

1. **Describe the Load Balancer**:
   First, identify the load balancer for which you want to update the SSL policy.
   ```sh
   aws elb describe-load-balancers --load-balancer-name <your-load-balancer-name>
   ```

2. **Describe the Current SSL Policies**:
   List the available SSL policies to choose a secure one.
   ```sh
   aws elb describe-load-balancer-policies --load-balancer-name <your-load-balancer-name>
   ```

3. **Create a New SSL Policy (if needed)**:
   If none of the existing policies meet your security requirements, you can create a custom policy. However, AWS provides predefined secure policies that are generally sufficient.
   ```sh
   aws elb create-load-balancer-policy --load-balancer-name <your-load-balancer-name> --policy-name <your-policy-name> --policy-type-name SSLNegotiationPolicyType --policy-attributes AttributeName=Reference-Security-Policy,AttributeValue=ELBSecurityPolicy-2016-08
   ```

4. **Apply the Secure SSL Policy to the Load Balancer**:
   Apply the chosen secure SSL policy to the load balancer.
   ```sh
   aws elb set-load-balancer-policies-of-listener --load-balancer-name <your-load-balancer-name> --load-balancer-port <your-load-balancer-port> --policy-names <your-policy-name>
   ```

Replace `<your-load-balancer-name>`, `<your-policy-name>`, and `<your-load-balancer-port>` with the appropriate values for your environment. The `ELBSecurityPolicy-2016-08` is an example of a predefined secure policy; you can choose a different one based on your requirements.
</Accordion>

<Accordion title='Using Python'>
To prevent Elastic Load Balancers (ELBs) from using insecure ciphers in AWS, you can use the Boto3 library in Python. Here are the steps to achieve this:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Set Up AWS Credentials**:
   Make sure your AWS credentials are configured. You can set them up using the AWS CLI or by setting environment variables.

3. **Create a Python Script**:
   Write a Python script to update the ELB's SSL policy to a more secure one. Below is an example script:

   ```python
   import boto3

   # Initialize a session using Amazon ELB
   client = boto3.client('elb')

   # List all load balancers
   response = client.describe_load_balancers()

   # Iterate through each load balancer
   for lb in response['LoadBalancerDescriptions']:
       lb_name = lb['LoadBalancerName']
       print(f"Updating SSL policy for Load Balancer: {lb_name}")

       # Define the secure SSL policy
       secure_ssl_policy = 'ELBSecurityPolicy-2016-08'

       # Get the current listeners
       listeners = client.describe_load_balancer_policies(LoadBalancerName=lb_name)['PolicyDescriptions']

       # Update the SSL policy for each listener
       for listener in listeners:
           if 'SSL' in listener['PolicyName']:
               client.set_load_balancer_policies_of_listener(
                   LoadBalancerName=lb_name,
                   LoadBalancerPort=listener['LoadBalancerPort'],
                   PolicyNames=[secure_ssl_policy]
               )
               print(f"Updated listener on port {listener['LoadBalancerPort']} to use {secure_ssl_policy}")

   print("All ELBs have been updated with secure SSL policies.")
   ```

4. **Run the Script**:
   Execute the script to update the SSL policies of your ELBs.
   ```bash
   python update_elb_ssl_policy.py
   ```

This script will iterate through all your ELBs and update their SSL policies to a more secure one (`ELBSecurityPolicy-2016-08` in this case). You can choose a different secure policy based on your requirements.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Log in to the AWS Management Console and open the Amazon EC2 dashboard at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the load balancer that you want to check.

4. In the bottom panel, select the "Listeners" tab.

5. In the "Cipher" column, click on the "Change" link. This will open a pop-up window with the SSL Negotiation settings.

6. In the pop-up window, check the Predefined Security Policy. If the policy includes insecure ciphers, then the ELB is misconfigured.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. After installation, you can configure it using the command `aws configure`. You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all the Load Balancers: Use the following command to list all the load balancers in your AWS account.

   ```
   aws elbv2 describe-load-balancers
   ```

   This command will return a JSON output with details of all the load balancers.

3. Describe the SSL policies: For each load balancer, describe the SSL policies using the following command. Replace `policy-name` with the name of the SSL policy you want to check.

   ```
   aws elbv2 describe-ssl-policies --names policy-name
   ```

   This command will return a JSON output with details of the SSL policy, including the enabled SSL protocols, ciphers, and the SSL negotiation policy.

4. Check for insecure ciphers: In the JSON output, look for the `Ciphers` field. This field contains a list of all the ciphers enabled for the SSL policy. Check if any of the ciphers in this list are considered insecure. If any insecure ciphers are found, then the ELB is misconfigured.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: To interact with AWS services, you need to install the AWS SDK for Python (Boto3). You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Set up AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. Inside this file, you should include your Access Key ID and Secret Access Key:

   ```bash
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check for insecure ciphers: The following script will list all the ELBs and their associated policies. It will then check each policy to see if it includes any insecure ciphers:

   ```python
   import boto3

   elb = boto3.client('elbv2')

   # Get all load balancers
   load_balancers = elb.describe_load_balancers()
   
   for lb in load_balancers['LoadBalancers']:
       # Get the policies associated with each load balancer
       policies = elb.describe_ssl_policies(
           Names=[
               lb['PolicyNames'],
           ]
       )
       for policy in policies['SslPolicies']:
           # Check if the policy includes any insecure ciphers
           for cipher in policy['Ciphers']:
               if cipher['Name'] in ['RC4', 'DES', 'MD5', 'DH', 'aNULL', 'eNULL', 'LOW', 'EXP']:
                   print(f"Insecure cipher {cipher['Name']} found in policy {policy['Name']} for load balancer {lb['LoadBalancerName']}")
   ```

4. Run the script: You can run the script using the Python command in your terminal:

   ```bash
   python check_insecure_ciphers.py
   ```

This script will print out a message for each insecure cipher it finds, along with the name of the policy and load balancer where it was found.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the issue of ELBs having insecure ciphers in AWS, please follow the below steps:

1. Login to the AWS Management Console.
2. Go to the EC2 Dashboard.
3. Select the Load Balancers option from the left-hand menu.
4. Choose the Load Balancer that you want to remediate.
5. Click on the Listeners tab.
6. Select the listener that you want to remediate.
7. Click on the Edit button.
8. In the Edit Listener dialog box, click on the Add button to add a new protocol.
9. Select HTTPS from the Protocol drop-down menu.
10. Select the SSL certificate from the SSL certificate drop-down menu.
11. Click on the Add button.
12. In the SSL Policy drop-down menu, select a secure SSL policy such as ELBSecurityPolicy-2016-08.
13. Uncheck the insecure ciphers such as RC4 and SSLv3.
14. Click on the Save button to save the changes.

Once the above steps are completed, the ELB will no longer have insecure ciphers and will be more secure.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration "ELBs Should Not Have Insecure Ciphers" for AWS using AWS CLI, follow these steps:

1. Identify the insecure ciphers being used by the ELB. You can use the following command to get a list of ciphers being used by your ELB:

```
aws elb describe-load-balancers --load-balancer-name <ELB_NAME> --query 'LoadBalancerDescriptions[].ListenerDescriptions[].Listener.Ciphers'
```

2. Once you have identified the insecure ciphers, you need to update the security policy of the ELB to disable these ciphers. You can use the following command to update the security policy of the ELB:

```
aws elb set-load-balancer-policies-for-backend-server --load-balancer-name <ELB_NAME> --policy-names <POLICY_NAME>
```

Replace `<ELB_NAME>` with the name of your ELB and `<POLICY_NAME>` with the name of the security policy that you want to apply. You can find a list of available security policies in the AWS documentation.

3. After updating the security policy, you should verify that the insecure ciphers have been disabled. You can use the same command as in step 1 to check the ciphers being used by the ELB.

4. Finally, you should test your ELB to ensure that it is still functioning as expected after disabling the insecure ciphers.

Note: It is recommended to take a backup of the ELB configuration before making any changes.
</Accordion>

<Accordion title='Using Python'>
To remediate the issue of ELBs having insecure ciphers in AWS using python, you can follow these steps:

1. First, you need to identify the ELBs that have insecure ciphers. You can do this by using the AWS CLI command:

   ```
   aws elb describe-load-balancers --query "LoadBalancerDescriptions[?ListenerDescriptions[].PolicyNames != '[]'].{LoadBalancerName:LoadBalancerName,PolicyNames:ListenerDescriptions[].PolicyNames}" --output table
   ```

   This command will list all the ELBs that have policies attached to their listeners.

2. Once you have identified the ELBs with insecure ciphers, you can use the AWS CLI command to list the policies attached to each listener:

   ```
   aws elb describe-load-balancer-policies --load-balancer-name <ELB_Name> --query "PolicyDescriptions[].{PolicyName:PolicyName,PolicyTypeName:PolicyTypeName,Attributes:PolicyAttributeDescriptions[].{AttributeName:AttributeName,AttributeValue:AttributeValue}}" --output table
   ```

   This command will list the policies attached to the specified ELB.

3. You can then use the AWS CLI command to delete the policies that have insecure ciphers:

   ```
   aws elb delete-load-balancer-policy --load-balancer-name <ELB_Name> --policy-name <Policy_Name>
   ```

   This command will delete the specified policy from the ELB.

4. Finally, you can use the AWS CLI command to update the listeners of the ELB to use secure ciphers:

   ```
   aws elb create-load-balancer-policy --load-balancer-name <ELB_Name> --policy-name <Policy_Name> --policy-type-name SSLNegotiationPolicyType --policy-attributes AttributeName=Protocol-TLSv1.2,AttributeValue=true AttributeName=CipherOrder,AttributeValue=server-defined
   ```

   This command will create a new policy for the ELB that uses secure ciphers.

5. Repeat steps 2-4 for all the ELBs with insecure ciphers to remediate the issue.

Note: You can also use AWS SDK for Python (Boto3) to perform these actions programmatically.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html](https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html) 

