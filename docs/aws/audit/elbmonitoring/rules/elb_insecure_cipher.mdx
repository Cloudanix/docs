---
slug: elb_insecure_cipher
title: ELBs Should Not Have Insecure Ciphers
sidebar_label: ELBs Should Not Have Insecure Ciphers
---

### More Info:

Insecure ciphers on ELBs should be checked. Various security vulnerabilities have rendered several ciphers insecure. Only the recommended ciphers should be used.

### Risk Level

Low

### Address

Security

### Compliance Standards

AWSWAF




<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under "Load Balancing", click on "Load Balancers".
3. Select the load balancer you want to inspect.
4. In the bottom panel, click on the "Listeners" tab. Here, you can see the SSL policy associated with the load balancer.
5. Click on the SSL policy name to view the details. This will show you the list of SSL ciphers and protocols that are currently in use. If any insecure ciphers are listed, then the ELB is misconfigured.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package manager) with the command `pip install awscli`. After installation, you can configure it using the command `aws configure` and then enter your AWS Access Key ID, Secret Access Key, Default region name, and Default output format when prompted.

2. **List all Load Balancers**: Use the following AWS CLI command to list all the load balancers in your account:

    ```
    aws elbv2 describe-load-balancers
    ```

    This command will return a JSON output with details of all the load balancers.

3. **Describe Load Balancer Attributes**: For each load balancer, use its ARN (Amazon Resource Name) to describe its attributes using the following command:

    ```
    aws elbv2 describe-load-balancer-attributes --load-balancer-arn <load-balancer-arn>
    ```

    Replace `<load-balancer-arn>` with the ARN of your load balancer. This command will return a JSON output with the attributes of the specified load balancer.

4. **Check for Insecure Ciphers**: In the JSON output from the previous step, look for the `Policies` attribute. Under this attribute, check the `PolicyDescriptions` for any insecure ciphers. Insecure ciphers might include "RC4", "DES", "MD5", or "NULL". If any of these are found, it indicates that the load balancer is using insecure ciphers.

#### Using Python

1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by setting the following environment variables: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, and AWS_SESSION_TOKEN. These credentials are used to authenticate your script with AWS.

3. Write a Python script to list all the ELBs and their SSL policies:

   ```python
   import boto3

   def list_elbs():
       client = boto3.client('elbv2')
       response = client.describe_load_balancers()
       for lb in response['LoadBalancers']:
           response = client.describe_ssl_policies(
               Names=[
                   lb['SslPolicy'],
               ]
           )
           for policy in response['SslPolicies']:
               print('ELB: ', lb['LoadBalancerName'])
               print('Insecure Ciphers: ', [cipher for cipher in policy['Ciphers'] if not cipher['IsDefaultCiphers']])
   
   if __name__ == "__main__":
       list_elbs()
   ```
   
   This script will print the name of each ELB and the list of insecure ciphers it uses.

4. Run the script: You can run the script using the Python interpreter. The script will print the name of each ELB and the list of insecure ciphers it uses. If an ELB is using insecure ciphers, you have detected a misconfiguration.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the issue of ELBs having insecure ciphers in AWS, please follow the below steps:

1. Login to the AWS Management Console.
2. Go to the EC2 Dashboard.
3. Select the Load Balancers option from the left-hand menu.
4. Choose the Load Balancer that you want to remediate.
5. Click on the Listeners tab.
6. Select the listener that you want to remediate.
7. Click on the Edit button.
8. In the Edit Listener dialog box, click on the Add button to add a new protocol.
9. Select HTTPS from the Protocol drop-down menu.
10. Select the SSL certificate from the SSL certificate drop-down menu.
11. Click on the Add button.
12. In the SSL Policy drop-down menu, select a secure SSL policy such as ELBSecurityPolicy-2016-08.
13. Uncheck the insecure ciphers such as RC4 and SSLv3.
14. Click on the Save button to save the changes.

Once the above steps are completed, the ELB will no longer have insecure ciphers and will be more secure.

#### Using CLI

To remediate the misconfiguration "ELBs Should Not Have Insecure Ciphers" for AWS using AWS CLI, follow these steps:

1. Identify the insecure ciphers being used by the ELB. You can use the following command to get a list of ciphers being used by your ELB:

```
aws elb describe-load-balancers --load-balancer-name <ELB_NAME> --query 'LoadBalancerDescriptions[].ListenerDescriptions[].Listener.Ciphers'
```

2. Once you have identified the insecure ciphers, you need to update the security policy of the ELB to disable these ciphers. You can use the following command to update the security policy of the ELB:

```
aws elb set-load-balancer-policies-for-backend-server --load-balancer-name <ELB_NAME> --policy-names <POLICY_NAME>
```

Replace `<ELB_NAME>` with the name of your ELB and `<POLICY_NAME>` with the name of the security policy that you want to apply. You can find a list of available security policies in the AWS documentation.

3. After updating the security policy, you should verify that the insecure ciphers have been disabled. You can use the same command as in step 1 to check the ciphers being used by the ELB.

4. Finally, you should test your ELB to ensure that it is still functioning as expected after disabling the insecure ciphers.

Note: It is recommended to take a backup of the ELB configuration before making any changes.

#### Using Python

To remediate the issue of ELBs having insecure ciphers in AWS using python, you can follow these steps:

1. First, you need to identify the ELBs that have insecure ciphers. You can do this by using the AWS CLI command:

   ```
   aws elb describe-load-balancers --query "LoadBalancerDescriptions[?ListenerDescriptions[].PolicyNames != '[]'].{LoadBalancerName:LoadBalancerName,PolicyNames:ListenerDescriptions[].PolicyNames}" --output table
   ```

   This command will list all the ELBs that have policies attached to their listeners.

2. Once you have identified the ELBs with insecure ciphers, you can use the AWS CLI command to list the policies attached to each listener:

   ```
   aws elb describe-load-balancer-policies --load-balancer-name <ELB_Name> --query "PolicyDescriptions[].{PolicyName:PolicyName,PolicyTypeName:PolicyTypeName,Attributes:PolicyAttributeDescriptions[].{AttributeName:AttributeName,AttributeValue:AttributeValue}}" --output table
   ```

   This command will list the policies attached to the specified ELB.

3. You can then use the AWS CLI command to delete the policies that have insecure ciphers:

   ```
   aws elb delete-load-balancer-policy --load-balancer-name <ELB_Name> --policy-name <Policy_Name>
   ```

   This command will delete the specified policy from the ELB.

4. Finally, you can use the AWS CLI command to update the listeners of the ELB to use secure ciphers:

   ```
   aws elb create-load-balancer-policy --load-balancer-name <ELB_Name> --policy-name <Policy_Name> --policy-type-name SSLNegotiationPolicyType --policy-attributes AttributeName=Protocol-TLSv1.2,AttributeValue=true AttributeName=CipherOrder,AttributeValue=server-defined
   ```

   This command will create a new policy for the ELB that uses secure ciphers.

5. Repeat steps 2-4 for all the ELBs with insecure ciphers to remediate the issue.

Note: You can also use AWS SDK for Python (Boto3) to perform these actions programmatically.


### Additional Reading:

- [https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html](https://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-security-policy-options.html) 


</Tab>
</Tabs>