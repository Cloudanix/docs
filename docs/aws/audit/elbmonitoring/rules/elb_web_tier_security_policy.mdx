---
slug: elb_web_tier_security_policy
title: Latest AWS Security Policy for SSL Negotiations Should Be Used For Web-Tier ELBs
sidebar_label: Latest AWS Security Policy for SSL Negotiations Should Be Used For Web-Tier ELBs
---

### More Info:

Your web-tier Elastic Load Balancers (ELBs) listeners should be using the latest AWS security policy for their SSL negotiation configuration

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, GDPR, NIST, AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 dashboard.
2. In the navigation pane, under LOAD BALANCING, click on Load Balancers.
3. Select the load balancer you want to inspect. In the bottom panel, click on the "Listeners" tab.
4. Check the SSL certificate column. If the SSL certificate is not listed, it means that the load balancer is not configured to use SSL/TLS for its connections.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine. You can do this by downloading the appropriate installer from the AWS website. Once installed, you can configure it by running `aws configure` and providing your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all Load Balancers: Use the following command to list all the load balancers in your account.

   ```
   aws elbv2 describe-load-balancers
   ```

   This command will return a JSON object with details about all your load balancers.

3. Describe Load Balancer Attributes: For each load balancer, you need to describe its attributes to check the SSL policies. Use the following command:

   ```
   aws elbv2 describe-load-balancer-attributes --load-balancer-arn <load-balancer-arn>
   ```

   Replace `<load-balancer-arn>` with the ARN of your load balancer. This command will return a JSON object with the attributes of the specified load balancer.

4. Check SSL Negotiation Policies: In the returned JSON object, look for the `Policies` attribute. Under this attribute, look for `SslNegotiationPolicy` and check its value. If the value is not set to the latest AWS security policy, then the SSL negotiations are not using the latest AWS security policy.

#### Using Python

1. Install the necessary AWS SDK for Python (Boto3) if you haven't done so already. You can install it using pip:
   ```
   pip install boto3
   ```

2. Import the necessary modules and establish a session with AWS using your credentials. You can do this in your Python script as follows:
   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )
   ```

3. Now, create an ELB client using the session. This client will allow you to interact with your Elastic Load Balancers.
   ```python
   elb = session.client('elbv2')
   ```

4. Now, you can use the `describe_load_balancer_attributes` function to get the attributes of your load balancer. You can then check the `SslPolicy` attribute to see if it is set to a secure policy. Here is an example of how you can do this:
   ```python
   def check_ssl_policy(load_balancer_arn):
       response = elb.describe_load_balancer_attributes(LoadBalancerArn=load_balancer_arn)
       for attribute in response['Attributes']:
           if attribute['Key'] == 'SslPolicy':
               if attribute['Value'] != 'ELBSecurityPolicy-TLS-1-2-2017-01':
                   print(f"Load balancer {load_balancer_arn} is using an insecure SSL policy.")
               else:
                   print(f"Load balancer {load_balancer_arn} is using a secure SSL policy.")
   ```
   In this function, replace `'ELBSecurityPolicy-TLS-1-2-2017-01'` with the name of the SSL policy that you want to check for. This function will print a message indicating whether each load balancer is using a secure SSL policy.

5. Finally, you can use the `describe_load_balancers` function to get a list of all your load balancers, and then call `check_ssl_policy` for each one. Here is an example of how you can do this:
   ```python
   def check_all_load_balancers():
       response = elb.describe_load_balancers()
       for load_balancer in response['LoadBalancers']:
           check_ssl_policy(load_balancer['LoadBalancerArn'])
   ```
   This function will check all your load balancers and print a message for each one indicating whether it is using a secure SSL policy.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Latest AWS Security Policy for SSL Negotiations Should Be Used For Web-Tier ELBs" for AWS using the AWS console, follow the below steps:

1. Log in to your AWS console and navigate to the EC2 dashboard.
2. Click on the "Load Balancers" option from the left-hand menu.
3. Select the web-tier ELB that you want to remediate and click on it.
4. Click on the "Listeners" tab and select the listener that is using SSL.
5. In the "SSL Certificate" section, select "Change" and choose the "AWS Managed Certificate" option.
6. Choose the latest AWS security policy for SSL negotiations from the dropdown menu and click on "Save".

After following these steps, your web-tier ELB will be configured to use the latest AWS security policy for SSL negotiations. This will ensure that your SSL connections are secure and protected against potential threats.

#### Using CLI

To remediate this issue for AWS using AWS CLI, follow these steps:

1. Open the AWS CLI on your local machine.

2. Run the following command to get the load balancer security policy names:

```
aws elb describe-load-balancer-policies --load-balancer-name <ELB_NAME>
```

Replace `<ELB_NAME>` with the name of your load balancer.

3. Identify the security policy that is currently in use for the load balancer. The security policy should be named `ELBSecurityPolicy-2016-08` or later.

4. If the load balancer is using an older security policy, run the following command to update it:

```
aws elb set-load-balancer-policies-for-backend-server --load-balancer-name <ELB_NAME> --policy-names <NEW_POLICY_NAME>
```

Replace `<ELB_NAME>` with the name of your load balancer and `<NEW_POLICY_NAME>` with the name of the latest AWS security policy. The latest security policy name can be found in the AWS documentation.

5. Verify that the new security policy is in use by running the following command:

```
aws elb describe-load-balancer-attributes --load-balancer-name <ELB_NAME>
```

Replace `<ELB_NAME>` with the name of your load balancer. The command should return a JSON object that includes the new security policy name.

6. Once you have verified that the new security policy is in use, you have successfully remediated the misconfiguration.

#### Using Python

To remediate the misconfiguration "Latest AWS Security Policy for SSL Negotiations Should Be Used For Web-Tier ELBs" in AWS using Python, you can follow the below steps:

1. Import the required libraries:

```
import boto3
```

2. Create a boto3 client for Elastic Load Balancing:

```
elb_client = boto3.client('elbv2')
```

3. Get a list of all the load balancers:

```
load_balancers = elb_client.describe_load_balancers()
```

4. Loop through each load balancer and check if it is a web-tier ELB:

```
for load_balancer in load_balancers['LoadBalancers']:
    if 'web' in load_balancer['LoadBalancerName']:
```

5. If the load balancer is a web-tier ELB, update its SSL policy:

```
elb_client.modify_load_balancer_attributes(
    LoadBalancerArn=load_balancer['LoadBalancerArn'],
    Attributes=[
        {
            'Key': 'ssl_policy',
            'Value': 'ELBSecurityPolicy-TLS-1-2-Ext-2018-06'
        },
    ]
)
```

6. The SSL policy `ELBSecurityPolicy-TLS-1-2-Ext-2018-06` is the latest AWS security policy for SSL negotiations. You can modify the code to use a different SSL policy if required.

7. Finally, you can add this code to a script and run it periodically to ensure that all web-tier ELBs are using the latest AWS security policy for SSL negotiations.

### Additional Reading:

- [https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-add-or-delete-listeners.html](https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-add-or-delete-listeners.html) 


</Tab>
</Tabs>