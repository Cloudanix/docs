---
slug: elb_nlb_security_policy
title: NLBs Should Have Latest SSL/TLS Configurations
sidebar_label: NLBs Should Have Latest SSL/TLS Configurations
---

### More Info:

Your Amazon Network Load Balancers (NLBs) should be using the latest recommended predefined security policy for TLS negotiation configuration in order to protect their front-end connections against TLS vulnerabilities and meet security requirements

### Risk Level

Medium

### Address

Security

### Compliance Standards

HITRUST, AWSWAF, HIPAA, GDPR, NIST



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the EC2 Dashboard. 

2. In the left navigation pane, under the "Load Balancing" section, click on "Load Balancers". This will display a list of all the load balancers associated with your account.

3. Select the Network Load Balancer (NLB) that you want to check. In the bottom panel, click on the "Listeners" tab. 

4. In the "Listeners" tab, check the "SSL Policy" column. This column displays the SSL/TLS policy that is currently in use by the NLB. If the policy is not the latest one, it indicates that the NLB does not have the latest SSL/TLS configurations.

#### Using CLI

1. Install and configure AWS CLI: Before you can start, you need to install the AWS CLI on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   ```
   pip install awscli
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, default region name, and default output format.

2. List all the load balancers: Use the following command to list all the Network Load Balancers (NLBs) in your account:

   ```
   aws elbv2 describe-load-balancers --query 'LoadBalancers[?Type==`network`].LoadBalancerArn'
   ```
   This command will return the ARNs of all the NLBs in your account.

3. Describe the listener configurations: For each NLB ARN returned by the previous command, use the following command to describe its listener configurations:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn>
   ```
   Replace `<load-balancer-arn>` with the ARN of the NLB. This command will return the details of all the listeners associated with the NLB.

4. Check the SSL/TLS configurations: In the output of the previous command, look for the `SslPolicy` field. This field indicates the SSL/TLS policy that is currently in use. If the policy is not the latest one, then the NLB does not have the latest SSL/TLS configurations.

#### Using Python

1. Install the necessary Python libraries: Before you start, make sure you have the necessary Python libraries installed. You will need the boto3 library, which is the Amazon Web Services (AWS) SDK for Python. It allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the credentials file yourself. By default, its location is at ~/.aws/credentials. At a minimum, the credentials file should look like this:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to list all the NLBs and their SSL/TLS configurations: You can use the boto3 library to interact with AWS services. Here is a simple script that lists all the Network Load Balancers (NLBs) and their SSL/TLS configurations:

   ```python
   import boto3

   # Create a client for the AWS service
   client = boto3.client('elbv2')

   # Get a list of all load balancers
   response = client.describe_load_balancers()

   # Iterate over each load balancer
   for lb in response['LoadBalancers']:
       # Check if it is a Network Load Balancer
       if lb['Type'] == 'network':
           # Get the listeners for this load balancer
           listeners = client.describe_listeners(LoadBalancerArn=lb['LoadBalancerArn'])
           # Iterate over each listener
           for listener in listeners['Listeners']:
               # Get the SSL policy
               if 'SslPolicy' in listener:
                   print(f"Load Balancer: {lb['LoadBalancerName']}, SSL Policy: {listener['SslPolicy']}")
   ```

4. Analyze the output: The script will print the name of each NLB and its SSL/TLS policy. You should review these policies and ensure they are up-to-date. If a policy is outdated, it may indicate a misconfiguration.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, I can help you with that. Here are the step-by-step instructions to remediate the NLB SSL/TLS configuration issue in AWS:

1. Log in to your AWS Management Console.
2. Navigate to the EC2 dashboard.
3. Click on the "Load Balancers" option from the left-hand side menu.
4. Select the NLB that needs to be remediated.
5. Click on the "Listeners" tab.
6. Click on the "Edit" button next to the listener that uses SSL/TLS.
7. Select the appropriate SSL/TLS policy from the "Security policy" drop-down menu.
8. Click on the "Save" button to apply the changes.

By following these steps, you will update the SSL/TLS configuration for the NLB and ensure that it is using the latest and most secure policy.

#### Using CLI

To remediate NLBs having the latest SSL/TLS configurations in AWS using AWS CLI, follow these steps:

1. Check the current SSL/TLS configuration of the NLB by running the following command:

```
aws elbv2 describe-load-balancers --load-balancer-arns <NLB-ARN> --query 'LoadBalancers[].{Name: LoadBalancerName, Scheme: Scheme, Type: Type, Protocol: Scheme, SecurityPolicy: SecurityPolicies}'
```

Replace `<NLB-ARN>` with the ARN of the NLB that you want to check.

2. Identify the latest SSL/TLS version that is supported by AWS by running the following command:

```
aws elbv2 describe-load-balancer-policies --query 'SslPolicies[].Name'
```

This command will return a list of SSL/TLS policies that are supported by AWS. Identify the latest policy that is suitable for your NLB.

3. Update the NLB with the latest SSL/TLS policy by running the following command:

```
aws elbv2 set-security-policies --load-balancer-arn <NLB-ARN> --security-policy-ids <Security-Policy-ID>
```

Replace `<NLB-ARN>` with the ARN of the NLB that you want to update, and `<Security-Policy-ID>` with the ID of the latest SSL/TLS policy that you identified in step 2.

4. Verify that the NLB now has the latest SSL/TLS policy by running the command in step 1 again.

5. Repeat the above steps for all NLBs in your AWS environment that need to be updated with the latest SSL/TLS configurations.

#### Using Python

To remediate the misconfiguration "NLBs Should Have Latest SSL/TLS Configurations" for AWS using Python, you can follow these steps:

1. Install the AWS SDK for Python (Boto3) using pip:

```python
pip install boto3
```

2. Create a Boto3 client for the AWS Network Load Balancer (NLB) service:

```python
import boto3

client = boto3.client('elbv2')
```

3. Get a list of all the NLBs in your AWS account:

```python
response = client.describe_load_balancers()
nlbs = response['LoadBalancers']
```

4. For each NLB, check if it has the latest SSL/TLS configuration:

```python
for nlb in nlbs:
    response = client.describe_listeners(
        LoadBalancerArn=nlb['LoadBalancerArn']
    )
    listeners = response['Listeners']
    for listener in listeners:
        if listener['Protocol'] == 'HTTPS':
            if listener['SslPolicy'] != 'ELBSecurityPolicy-TLS-1-2-2017-01':
                response = client.modify_listener(
                    ListenerArn=listener['ListenerArn'],
                    SslPolicy='ELBSecurityPolicy-TLS-1-2-2017-01'
                )
```

This code will iterate through all the NLBs in your AWS account, check if they have an HTTPS listener, and if so, check if it has the latest SSL/TLS configuration. If it doesn't, it will modify the listener to use the latest configuration.

Note: You will need to have appropriate permissions to modify the NLBs and listeners in your AWS account.

### Additional Reading:

- [https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-tls-listener.html](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-tls-listener.html) 


</Tab>
</Tabs>