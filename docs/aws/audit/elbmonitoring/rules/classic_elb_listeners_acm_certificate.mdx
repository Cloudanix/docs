---
slug: classic_elb_listeners_acm_certificate
title: Classic ELB Listeners Should Have At least One ACM Certificate
sidebar_label: Classic ELB Listeners Should Have At least One ACM Certificate
---

### More Info:

Ensure Classic Load Balancers have at least one ACM certificate configured

### Risk Level

Medium

### Address

Security

### Compliance Standards

CBP,RBI_UCB,RBI_MD_ITF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of Classic ELB Listeners not having at least one ACM certificate in Elastic Load Balancer using the AWS Management Console, follow these steps:

1. **Navigate to the EC2 Dashboard:**
   - Open the AWS Management Console.
   - In the Services menu, select "EC2" to go to the EC2 Dashboard.

2. **Access Load Balancers:**
   - In the left-hand navigation pane, under "Load Balancing," click on "Load Balancers."
   - Select the Classic Load Balancer you want to configure.

3. **Configure Listeners:**
   - In the "Listeners" tab, click on the "Edit" button.
   - Ensure that you have at least one HTTPS listener configured. If not, add an HTTPS listener by clicking "Add listener" and selecting "HTTPS."

4. **Attach ACM Certificate:**
   - For the HTTPS listener, ensure that an ACM (AWS Certificate Manager) certificate is attached.
   - If no certificate is attached, click on the "Change" button next to the SSL Certificate field, select an existing ACM certificate, and save the changes.

By following these steps, you can ensure that your Classic ELB Listeners have at least one ACM certificate, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration where Classic ELB Listeners should have at least one ACM (AWS Certificate Manager) certificate in Elastic Load Balancer using AWS CLI, follow these steps:

1. **Create an ACM Certificate:**
   First, you need to request an ACM certificate for your domain. Replace `example.com` with your actual domain name.
   ```sh
   aws acm request-certificate --domain-name example.com --validation-method DNS
   ```

2. **List ACM Certificates:**
   Retrieve the ARN (Amazon Resource Name) of the ACM certificate you just created.
   ```sh
   aws acm list-certificates
   ```

3. **Get ELB Name:**
   List your existing Classic Load Balancers to get the name of the ELB you want to configure.
   ```sh
   aws elb describe-load-balancers
   ```

4. **Set ACM Certificate to ELB Listener:**
   Attach the ACM certificate to the ELB listener. Replace `my-load-balancer`, `my-listener-port`, and `arn:aws:acm:region:account:certificate/certificate-id` with your ELB name, listener port, and ACM certificate ARN respectively.
   ```sh
   aws elb set-load-balancer-listener-ssl-certificate --load-balancer-name my-load-balancer --load-balancer-port my-listener-port --ssl-certificate-id arn:aws:acm:region:account:certificate/certificate-id
   ```

By following these steps, you ensure that your Classic ELB listeners have at least one ACM certificate, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration where Classic ELB Listeners should have at least one ACM (AWS Certificate Manager) certificate in an Elastic Load Balancer using Python scripts, you can follow these steps:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed, which is the AWS SDK for Python. You can install it using pip if you haven't already.

   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for the Elastic Load Balancing service.

   ```python
   import boto3

   elb_client = boto3.client('elb')
   acm_client = boto3.client('acm')
   ```

3. **Retrieve List of Classic ELBs**:
   Retrieve the list of all Classic ELBs in your account.

   ```python
   def get_classic_elbs():
       response = elb_client.describe_load_balancers()
       return response['LoadBalancerDescriptions']
   ```

4. **Check and Attach ACM Certificate**:
   For each Classic ELB, check if the listeners have an ACM certificate attached. If not, attach an ACM certificate to the listener.

   ```python
   def attach_acm_certificate_to_elb(elb_name, certificate_arn):
       listeners = elb_client.describe_load_balancer_policies(LoadBalancerName=elb_name)['PolicyDescriptions']
       for listener in listeners:
           if 'SSL' in listener['PolicyName']:
               elb_client.set_load_balancer_listener_ssl_certificate(
                   LoadBalancerName=elb_name,
                   LoadBalancerPort=listener['LoadBalancerPort'],
                   SSLCertificateId=certificate_arn
               )

   def ensure_acm_certificate_for_elbs():
       elbs = get_classic_elbs()
       for elb in elbs:
           elb_name = elb['LoadBalancerName']
           listeners = elb['ListenerDescriptions']
           for listener in listeners:
               if listener['Listener']['Protocol'] == 'HTTPS' and 'SSLCertificateId' not in listener['Listener']:
                   # Assuming you have an ACM certificate ARN
                   certificate_arn = 'arn:aws:acm:region:account-id:certificate/certificate-id'
                   attach_acm_certificate_to_elb(elb_name, certificate_arn)

   ensure_acm_certificate_for_elbs()
   ```

This script will ensure that all Classic ELB listeners that use HTTPS have an ACM certificate attached. Make sure to replace `'arn:aws:acm:region:account-id:certificate/certificate-id'` with your actual ACM certificate ARN.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.
   
2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the Classic Load Balancer you want to inspect.

4. In the bottom panel, select the "Listeners" tab. Here you can see the details of the listener configuration for your Classic Load Balancer.

5. Check the SSL Certificate column. If the SSL Certificate is set to "None" or if there is no ACM (AWS Certificate Manager) certificate listed, then the Classic ELB does not have at least one ACM certificate.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elastic Load Balancer (ELB) resources.

2. Once the AWS CLI is set up, you can list all the Classic Load Balancers in your account using the following command:

   ```
   aws elb describe-load-balancers
   ```

   This command will return a JSON output with details about all the Classic Load Balancers in your account.

3. To check the listeners for a specific Classic Load Balancer, you can use the following command:

   ```
   aws elb describe-load-balancer-policies --load-balancer-name <your-load-balancer-name>
   ```

   Replace `<your-load-balancer-name>` with the name of your Classic Load Balancer. This command will return a JSON output with details about the policies attached to the specified Classic Load Balancer.

4. Now, you need to check if there is at least one ACM (AWS Certificate Manager) certificate attached to the listeners of the Classic Load Balancer. You can do this by looking for the "SSLCertificateId" field in the JSON output from the previous step. If the value of this field starts with "arn:aws:acm:", it means that an ACM certificate is attached to the listener. If no such field is found, it means that there is no ACM certificate attached to the listeners of the Classic Load Balancer.
</Accordion>

<Accordion title='Using Python'>
1. Install and configure AWS SDK for Python (Boto3) on your local system. Boto3 allows you to directly create, update, and delete AWS services from your Python scripts.

2. Import the necessary modules and create a session using your AWS credentials. 

```python
import boto3

session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='us-west-2'
)
```

3. Create an ELB client using the session and retrieve all the load balancers.

```python
elb = session.client('elbv2')

response = elb.describe_load_balancers()
```

4. Iterate over the load balancers and check the listeners for each load balancer. If a listener does not have an ACM certificate, print a message.

```python
for lb in response['LoadBalancers']:
    listeners = elb.describe_listeners(LoadBalancerArn=lb['LoadBalancerArn'])
    for listener in listeners['Listeners']:
        if 'Certificates' not in listener or not any(cert['IsDefault'] for cert in listener['Certificates']):
            print(f"Load balancer {lb['LoadBalancerName']} has a listener without an ACM certificate.")
```

This script will print the names of all load balancers that have a listener without an ACM certificate. Please replace 'YOUR_ACCESS_KEY' and 'YOUR_SECRET_KEY' with your actual AWS access key and secret key.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the misconfiguration of Classic ELB Listeners not having at least one ACM certificate in AWS, follow these steps using the AWS Management Console:

1. Navigate to the AWS Management Console and go to the EC2 dashboard.

2. In the navigation pane, under the 'Load Balancing' section, click on 'Load Balancers'.

3. Select the Classic Load Balancer that needs to be remediated.

4. Under the 'Listeners' tab, identify the listener that does not have an ACM certificate attached.

5. Click on the 'Edit' button next to the listener that needs to be remediated.

6. In the 'Edit Listener' configuration, select the protocol (HTTP or HTTPS) for the listener.

7. For HTTPS protocol, select 'HTTPS' from the drop-down menu and choose the appropriate port.

8. In the 'SSL certificate' drop-down menu, select 'Choose a certificate from ACM (recommended)'.

9. Select the ACM certificate that you want to attach to this listener from the list of available certificates.

10. Click on the 'Save' button to apply the changes.

11. Verify that the ACM certificate is now attached to the listener by checking the 'Listeners' tab for the Classic Load Balancer.

By following these steps, you have successfully remediated the misconfiguration of Classic ELB Listeners not having at least one ACM certificate in AWS Elastic Load Balancer using the AWS Management Console.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the misconfiguration of classic ELB listeners not having at least one ACM certificate in AWS using AWS CLI, follow these steps:

1. List all your classic ELBs to identify the affected ones:
```bash
aws elb describe-load-balancers --query 'LoadBalancerDescriptions[?Scheme==`internet-facing`].[LoadBalancerName]' --output text
```

2. For each affected classic ELB, update the listener to attach an ACM certificate:
```bash
aws elb set-load-balancer-listener-ssl-certificate --load-balancer-name YOUR_LOAD_BALANCER_NAME --load-balancer-port LISTENER_PORT --ssl-certificate-id YOUR_ACM_CERTIFICATE_ARN
```
Replace the placeholders:
- `YOUR_LOAD_BALANCER_NAME` with the name of your ELB.
- `LISTENER_PORT` with the port number of the listener you want to update.
- `YOUR_ACM_CERTIFICATE_ARN` with the ARN of the ACM certificate you want to attach.

3. Verify that the ACM certificate has been successfully attached to the listener:
```bash
aws elb describe-load-balancers --load-balancer-name YOUR_LOAD_BALANCER_NAME --query 'LoadBalancerDescriptions[].ListenerDescriptions[?Listener.LoadBalancerPort==`LISTENER_PORT`].Listener.SSLCertificateId' --output text
```

Repeat these steps for each affected classic ELB to ensure that all listeners have at least one ACM certificate attached.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration of having at least one ACM certificate for Classic ELB listeners in AWS using Python, you can follow these steps:

1. Install the necessary Python libraries:
   Make sure you have the AWS SDK for Python (Boto3) installed. You can install it using pip:
   ```
   pip install boto3
   ```

2. Write a Python script to check and update the ACM certificate for the Classic ELB listeners:
   Here is a sample Python script that you can use to check and update the ACM certificate for Classic ELB listeners:

   ```python
   import boto3

   # Initialize the ELB and ACM clients
   elb_client = boto3.client('elb')
   acm_client = boto3.client('acm')

   # Specify the Classic ELB name
   elb_name = 'YOUR_CLASSIC_ELB_NAME'

   # Get the list of listeners for the Classic ELB
   response = elb_client.describe_load_balancers(LoadBalancerNames=[elb_name])
   listeners = response['LoadBalancerDescriptions'][0]['ListenerDescriptions']

   # Check if any listener is missing an ACM certificate
   for listener in listeners:
       if listener['Listener'].get('SSLCertificateId') is None:
           # Get a valid ACM certificate ARN
           response = acm_client.list_certificates()
           acm_certificate_arn = response['CertificateSummaryList'][0]['CertificateArn']

           # Update the listener with the ACM certificate
           elb_client.set_load_balancer_listener_ssl_certificate(
               LoadBalancerName=elb_name,
               LoadBalancerPort=listener['Listener']['LoadBalancerPort'],
               SSLCertificateId=acm_certificate_arn
           )
           print(f"Updated ACM certificate for listener on port {listener['Listener']['LoadBalancerPort']}")

   ```

3. Modify the script with your Classic ELB name:
   Replace `'YOUR_CLASSIC_ELB_NAME'` with the name of your Classic ELB.

4. Run the Python script:
   Save the script to a file (e.g., `remediate_acm_cert.py`) and run it using Python:
   ```
   python remediate_acm_cert.py
   ```

5. Verify the ACM certificate update:
   Once the script has run successfully, verify that each listener on the Classic ELB now has an ACM certificate attached.

By following these steps, you can remediate the misconfiguration of having at least one ACM certificate for Classic ELB listeners in AWS using Python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>

