

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the EC2 Dashboard by selecting "Services" from the top menu and then selecting "EC2" under the "Compute" category.
3. In the EC2 Dashboard, under the "Load Balancing" section in the left-hand navigation pane, click on "Load Balancers".
4. Here, you can see all the Elastic Load Balancers (ELBs) associated with your account. Click on the ELB that you want to check for insecure configurations.
5. In the "Description" tab, check the "Listeners" section. If the Load Balancer Protocol is HTTP or the Instance Protocol is HTTP, it means that the data is unencrypted and it is an insecure configuration.
6. Also, check the "Security" section in the same "Description" tab. If the Security group associated with the ELB has open ports to the world (0.0.0.0/0), it is also considered as an insecure configuration.
7. Lastly, in the "Attributes" tab, check the "Access logs" section. If the Access logs are not enabled, it is also an insecure configuration as it would be difficult to audit and monitor the traffic to your ELB.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer). The command is `pip install awscli`. After installation, you can configure it using `aws configure` command. You will be prompted to provide your Access Key ID, Secret Access Key, Default region name, and Default output format.

2. **List all ELBs**: Use the following AWS CLI command to list all the Elastic Load Balancers (ELBs) in your account:

    ```
    aws elb describe-load-balancers
    ```

    This command will return a JSON output with details of all the ELBs.

3. **Check ELB Policies**: For each ELB, check the associated policies. You can do this using the following command:

    ```
    aws elb describe-load-balancer-policies --load-balancer-name <your-load-balancer-name>
    ```

    Replace `<your-load-balancer-name>` with the name of your ELB. This command will return a JSON output with the details of the policies associated with the specified ELB.

4. **Check for Insecure Configurations**: In the JSON output from the previous step, look for insecure configurations. For example, you might look for SSL/TLS policies that allow insecure protocols or ciphers. If you find any such policies, it means your ELB has insecure configurations. 

    Note: This step requires knowledge of what constitutes an insecure configuration. For example, SSL/TLS policies that allow SSLv3 or lower, or ciphers that are known to be weak, are considered insecure.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing your Python script, you need to install the necessary libraries. The Boto3 library is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python, which allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, and others. You can install it using pip:

   ```python
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials. You can do this by creating the credentials file yourself. By default, its location is at `~/.aws/credentials`. At a minimum, the credentials file should look like this:

   ```python
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check ELB configurations: Now you can write a Python script that uses the Boto3 library to interact with AWS and check the configurations of your Elastic Load Balancers (ELBs). Here's an example script that checks if the ELBs are using HTTPS or SSL:

   ```python
   import boto3

   def check_elb_config():
       elb = boto3.client('elbv2')
       elbs = elb.describe_load_balancers()
       for elb in elbs['LoadBalancers']:
           listeners = elb.describe_listeners(LoadBalancerArn=elb['LoadBalancerArn'])
           for listener in listeners['Listeners']:
               if listener['Protocol'] != 'HTTPS' and listener['Protocol'] != 'SSL':
                   print(f"Insecure configuration detected: ELB {elb['LoadBalancerName']} is using {listener['Protocol']}")

   if __name__ == "__main__":
       check_elb_config()
   ```

4. Run the Python script: Finally, you can run your Python script. If any ELBs are found to be using insecure protocols, they will be printed out. This allows you to easily identify any misconfigurations and take the necessary steps to secure your ELBs.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the insecure configuration of ELBs in AWS, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 dashboard.
3. Click on the Load Balancers option in the left-hand menu.
4. Select the ELB that needs to be remediated.
5. In the bottom panel, click on the Listeners tab.
6. Review the security protocols and ciphers used in the listener configuration.
7. Remove any insecure security protocols and ciphers.
8. Click on the Save button to save the changes.
9. Repeat these steps for all ELBs that need to be remediated.

Alternatively, you can use AWS CLI to remediate this issue by running the following command:

```
aws elb describe-load-balancers --load-balancer-names <ELB_NAME> --query 'LoadBalancerDescriptions[].ListenerDescriptions[].Listener' --output text
```

This command will list all the listeners for the specified ELB, including the security protocols and ciphers used. You can then use the AWS CLI to modify the listeners to remove any insecure configurations.

#### Using CLI

To remediate an insecure configuration of an Elastic Load Balancer (ELB) in AWS using AWS CLI, you can follow the below steps:

1. Verify the insecure configuration: 
   Run the below command to get the details of the ELB and verify if it has any insecure configurations:
   ```
   aws elb describe-load-balancers --load-balancer-name <ELB-Name>
   ```

2. Update the Security Group:
   Run the below command to update the security group of the ELB and remove any insecure inbound rules:
   ```
   aws elb apply-security-groups-to-load-balancer --load-balancer-name <ELB-Name> --security-groups <Security-Group-ID>
   ```

   Note: Replace `<ELB-Name>` and `<Security-Group-ID>` with the actual values.

3. Enable HTTPS:
   If HTTPS is not enabled, then run the below command to enable it:
   ```
   aws elb set-load-balancer-listener-ssl-certificate --load-balancer-name <ELB-Name> --load-balancer-https-port <HTTPS-Port> --ssl-certificate-id <SSL-Certificate-ID>
   ```

   Note: Replace `<ELB-Name>`, `<HTTPS-Port>` and `<SSL-Certificate-ID>` with the actual values.

4. Enable Access Logging:
   Run the below command to enable access logging for the ELB:
   ```
   aws elb create-load-balancer-listeners --load-balancer-name <ELB-Name> --listeners Protocol=HTTP,LoadBalancerPort=<HTTP-Port>,InstanceProtocol=HTTP,InstancePort=<HTTP-Port> --access-log-attributes Enabled=true,S3BucketName=<S3-Bucket-Name>
   ```

   Note: Replace `<ELB-Name>`, `<HTTP-Port>` and `<S3-Bucket-Name>` with the actual values.

5. Verify the remediation:
   Run the below command to get the details of the ELB and verify if the insecure configurations have been remediated:
   ```
   aws elb describe-load-balancers --load-balancer-name <ELB-Name>
   ``` 

By following the above steps, you can remediate the insecure configurations of an Elastic Load Balancer in AWS using AWS CLI.

#### Using Python

To remediate the ELBs having insecure configurations in AWS using Python, follow these steps:

1. Install the Boto3 library using pip.

```
pip install boto3
```

2. Create an AWS session using Boto3.

```python
import boto3
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION'
)
```

3. Get the list of all the ELBs in the AWS account.

```python
elbv2_client = session.client('elbv2')
elbs = elbv2_client.describe_load_balancers()
```

4. For each ELB, check if it has any insecure configurations.

```python
for elb in elbs['LoadBalancers']:
    elb_arn = elb['LoadBalancerArn']
    elb_attributes = elbv2_client.describe_load_balancer_attributes(LoadBalancerArn=elb_arn)
    for attribute in elb_attributes['Attributes']:
        if attribute['Key'] == 'routing.http.drop_invalid_header_fields.enabled' and attribute['Value'] == 'true':
            # Remediate the insecure configuration
            elbv2_client.modify_load_balancer_attributes(
                LoadBalancerArn=elb_arn,
                Attributes=[
                    {
                        'Key': 'routing.http.drop_invalid_header_fields.enabled',
                        'Value': 'false'
                    },
                ]
            )
```

5. Finally, re-check if the ELBs now have secure configurations.

```python
elbs = elbv2_client.describe_load_balancers()
for elb in elbs['LoadBalancers']:
    elb_arn = elb['LoadBalancerArn']
    elb_attributes = elbv2_client.describe_load_balancer_attributes(LoadBalancerArn=elb_arn)
    for attribute in elb_attributes['Attributes']:
        if attribute['Key'] == 'routing.http.drop_invalid_header_fields.enabled' and attribute['Value'] == 'true':
            print(f"Insecure configuration found in ELB {elb_arn}")
        else:
            print(f"ELB {elb_arn} has a secure configuration")
```

This will remediate the insecure configuration in all the ELBs in the AWS account using Python.


</Tab>
</Tabs>