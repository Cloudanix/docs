---
slug: elb_app_tier_listener_security
title: Secure Listeners Should Be In App-tier ELBs
sidebar_label: Secure Listeners Should Be In App-tier ELBs
---

### More Info:

Your app-tier Elastic Load Balancer (ELB) listeners should be using the HTTPS/SSL protocol to encrypt the communication between your application clients and the load balancer.

### Risk Level

Low

### Address

Security

### Compliance Standards

HIPAA, AWSWAF, GDPR



### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To prevent the misconfiguration of not having secure listeners in App-tier Elastic Load Balancers (ELBs) using the AWS Management Console, follow these steps:

1. **Navigate to the Load Balancers Section:**
   - Open the AWS Management Console.
   - In the navigation pane, choose "EC2" to go to the EC2 Dashboard.
   - Under "Load Balancing," choose "Load Balancers."

2. **Select the App-tier Load Balancer:**
   - From the list of load balancers, select the App-tier ELB that you want to configure.

3. **Configure Listeners:**
   - In the selected load balancer's details pane, choose the "Listeners" tab.
   - Ensure that you have a listener configured for HTTPS (port 443). If not, click on "Add listener" and select "HTTPS" as the protocol. Specify the port (typically 443) and configure the necessary SSL certificate.

4. **Verify Security Groups:**
   - Go to the "Description" tab of the load balancer.
   - Ensure that the security groups associated with the load balancer allow inbound traffic on port 443 (HTTPS) and restrict or remove any rules that allow insecure traffic (e.g., HTTP on port 80).

By following these steps, you can ensure that your App-tier ELBs are configured with secure listeners, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
To prevent the misconfiguration of ensuring that secure listeners (HTTPS) are used in App-tier Elastic Load Balancers (ELBs) using AWS CLI, follow these steps:

1. **Create a Security Group for HTTPS:**
   Ensure you have a security group that allows inbound traffic on port 443 (HTTPS).

   ```sh
   aws ec2 create-security-group --group-name my-https-sg --description "Security group for HTTPS traffic"
   aws ec2 authorize-security-group-ingress --group-name my-https-sg --protocol tcp --port 443 --cidr 0.0.0.0/0
   ```

2. **Create an HTTPS Listener for the ELB:**
   When creating the ELB, specify an HTTPS listener. If the ELB already exists, you can modify it to add an HTTPS listener.

   ```sh
   aws elb create-load-balancer-listeners --load-balancer-name my-app-tier-elb --listeners "Protocol=HTTPS,LoadBalancerPort=443,InstanceProtocol=HTTP,InstancePort=80,SSLCertificateId=arn:aws:iam::123456789012:server-certificate/my-server-cert"
   ```

3. **Ensure SSL Certificate is Attached:**
   Make sure you have an SSL certificate in AWS Certificate Manager (ACM) or IAM and attach it to the HTTPS listener.

   ```sh
   aws acm request-certificate --domain-name example.com --validation-method DNS
   ```

4. **Verify Listener Configuration:**
   Verify that the ELB has the correct listener configuration to ensure it is using HTTPS.

   ```sh
   aws elb describe-load-balancers --load-balancer-names my-app-tier-elb
   ```

By following these steps, you can ensure that your App-tier ELBs are configured to use secure listeners, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To prevent the misconfiguration of not having secure listeners in App-tier Elastic Load Balancers (ELBs) in AWS using Python scripts, you can use the Boto3 library, which is the AWS SDK for Python. Here are the steps to ensure that your ELBs have secure listeners:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Initialize Boto3 Client**:
   Initialize the Boto3 client for Elastic Load Balancing (ELB).
   ```python
   import boto3

   elb_client = boto3.client('elbv2')  # For Application Load Balancer (ALB)
   ```

3. **Retrieve List of Load Balancers**:
   Retrieve the list of load balancers and filter for application load balancers.
   ```python
   response = elb_client.describe_load_balancers()
   app_load_balancers = [lb for lb in response['LoadBalancers'] if lb['Type'] == 'application']
   ```

4. **Check and Ensure Secure Listeners**:
   Iterate through the load balancers and check their listeners. Ensure that they have secure (HTTPS) listeners.
   ```python
   for lb in app_load_balancers:
       lb_arn = lb['LoadBalancerArn']
       listeners = elb_client.describe_listeners(LoadBalancerArn=lb_arn)['Listeners']
       
       for listener in listeners:
           if listener['Protocol'] != 'HTTPS':
               # If a non-secure listener is found, you can modify it to HTTPS
               # Note: This is a simplified example. In a real-world scenario, you would need to handle certificates and other configurations.
               elb_client.modify_listener(
                   ListenerArn=listener['ListenerArn'],
                   Protocol='HTTPS',
                   Port=443,
                   SslPolicy='ELBSecurityPolicy-2016-08',  # Example SSL policy
                   Certificates=[
                       {
                           'CertificateArn': 'arn:aws:acm:region:account-id:certificate/certificate-id'
                       }
                   ]
               )
               print(f"Updated listener {listener['ListenerArn']} to HTTPS")
   ```

### Summary of Steps:
1. **Install Boto3 Library**: Ensure Boto3 is installed.
2. **Initialize Boto3 Client**: Set up the Boto3 client for ELB.
3. **Retrieve List of Load Balancers**: Get the list of application load balancers.
4. **Check and Ensure Secure Listeners**: Iterate through the load balancers and update non-secure listeners to HTTPS.

This script ensures that all application-tier ELBs have secure listeners by checking their current configuration and updating any non-secure listeners to use HTTPS.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.
   
2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the load balancer you want to inspect.

4. In the bottom panel, select the "Listeners" tab. Here you can see the protocols and ports configured for your load balancer.

5. Check if the listeners are using HTTP or HTTPS for secure communication. If they are using HTTP, it means they are not secure.
</Accordion>

<Accordion title='Using CLI'>
1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elastic Load Balancer (ELB) resources.

2. Once the AWS CLI is set up, you can list all the load balancers in your account using the following command:

   ```
   aws elbv2 describe-load-balancers
   ```

   This command will return a JSON object with details about all the load balancers in your account.

3. To check if secure listeners are in use, you need to describe the listeners for each load balancer. You can do this using the following command:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn>
   ```

   Replace `<load-balancer-arn>` with the ARN of the load balancer you want to check. This command will return a JSON object with details about the listeners for the specified load balancer.

4. Finally, you need to check the protocol of each listener. If the protocol is not HTTPS or TLS, then the listener is not secure. You can do this by parsing the JSON object returned by the previous command. For example, you can use the `jq` command-line tool to parse the JSON object:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn> | jq -r '.Listeners[] | select(.Protocol!="HTTPS" and .Protocol!="TLS")'
   ```

   This command will return the details of any listeners that are not using HTTPS or TLS. If no listeners are returned, then all listeners are secure.
</Accordion>

<Accordion title='Using Python'>
To check if Secure Listeners are in App-tier ELBs in Elastic Load Balancer using Python scripts, you can use the Boto3 library, which allows you to directly interact with AWS services, including ELB. Here are the steps:

1. **Import the necessary libraries and establish a client connection to AWS:**

```python
import boto3

# Create a low-level service client by the service name
elb = boto3.client('elbv2')
```

2. **Retrieve all the load balancers:**

```python
# This will return a dictionary with all the load balancers
load_balancers = elb.describe_load_balancers()
```

3. **Iterate over each load balancer and check the listeners:**

```python
for lb in load_balancers['LoadBalancers']:
    # Get the listeners for the current load balancer
    listeners = elb.describe_listeners(LoadBalancerArn=lb['LoadBalancerArn'])

    for listener in listeners['Listeners']:
        # Check if the listener is secure
        if listener['Protocol'] != 'HTTPS':
            print(f"Load balancer {lb['LoadBalancerName']} has insecure listener {listener['ListenerArn']}")
```

4. **Run the script:**

You can run the script using any Python environment. Make sure you have the necessary AWS credentials configured. If the script prints any output, that means there are insecure listeners in your ELBs.

Remember, this script only checks for HTTPS protocol. If you have other protocols that you consider secure, you should modify the script accordingly.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
The remediation steps for this misconfiguration in AWS using AWS console are as follows:

1. Open the AWS Management Console and navigate to the EC2 dashboard.
2. Select the Load Balancers option from the left-hand menu.
3. Identify the application load balancer (ALB) or network load balancer (NLB) that is serving traffic to the application tier.
4. Click on the name of the load balancer to open its details page.
5. Click on the Listeners tab.
6. Identify the listener that is not secure and needs to be secured.
7. Click on the Edit button for that listener.
8. Change the protocol to HTTPS or TLS, depending on your application's requirements.
9. Select the SSL/TLS certificate that you want to use for securing the listener.
10. Click on the Save button to save the changes.

After following these steps, the listener for the application tier will be secured with SSL/TLS encryption.

#
</Accordion>

<Accordion title='Using CLI'>
The misconfiguration "Secure Listeners Should Be In App-tier ELBs" means that secure listeners should be configured only in the application tier Elastic Load Balancers (ELBs) and not in any other ELBs. To remediate this misconfiguration in AWS using AWS CLI, you can follow the below steps:

1. Identify the ELBs in your AWS account that are not in the application tier and have secure listeners configured. You can use the following AWS CLI command to list all the ELBs in your account:

```
aws elbv2 describe-load-balancers
```

2. From the list of ELBs, identify the ones that are not in the application tier and have secure listeners configured. 

3. Remove the secure listeners from the non-application tier ELBs using the following AWS CLI command:

```
aws elbv2 delete-listener --listener-arn <listener-arn>
```

Replace `<listener-arn>` with the ARN of the listener that you want to delete.

4. If required, create secure listeners in the application tier ELBs using the following AWS CLI command:

```
aws elbv2 create-listener --load-balancer-arn <load-balancer-arn> --protocol HTTPS --port 443 --ssl-policy ELBSecurityPolicy-2016-08
```

Replace `<load-balancer-arn>` with the ARN of the application tier ELB.

5. Verify that all the secure listeners are configured only in the application tier ELBs by running the following AWS CLI command:

```
aws elbv2 describe-listeners
```

This will list all the listeners in your account. Verify that all the secure listeners are configured only in the application tier ELBs.

By following these steps, you can remediate the misconfiguration "Secure Listeners Should Be In App-tier ELBs" in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the misconfiguration "Secure Listeners Should Be In App-tier ELBs" in AWS using python, you can follow the below steps:

1. Identify the app-tier ELBs: Identify the ELBs that are part of the application tier and store their names in a list.

```
import boto3

elb_client = boto3.client('elbv2')
app_elbs = []

response = elb_client.describe_load_balancers()
for elb in response['LoadBalancers']:
    tags = elb_client.describe_tags(ResourceArns=[elb['LoadBalancerArn']])
    for tag in tags['TagDescriptions'][0]['Tags']:
        if tag['Key'] == 'tier' and tag['Value'] == 'app':
            app_elbs.append(elb['LoadBalancerArn'])
```

2. Identify the secure listeners: Identify the listeners that are using secure protocols like HTTPS, SSL, TLS, etc. and store their names in a list.

```
secure_listeners = []

response = elb_client.describe_listeners()
for listener in response['Listeners']:
    if listener['Protocol'] in ['HTTPS', 'SSL', 'TLS']:
        secure_listeners.append(listener['ListenerArn'])
```

3. Check if secure listeners are attached to app-tier ELBs: Check if the secure listeners identified in step 2 are attached to the ELBs identified in step 1. If any secure listener is not attached to any app-tier ELB, then update its configuration and attach it to an app-tier ELB.

```
for listener in secure_listeners:
    response = elb_client.describe_listener_certificates(ListenerArn=listener)
    if response['Certificates']:
        elb_arn = response['Certificates'][0]['CertificateArn'].split('/')[1]
        if elb_arn not in app_elbs:
            elb_client.modify_listener(
                ListenerArn=listener,
                LoadBalancerArn=app_elbs[0],
                Port=443,
                Protocol='HTTPS'
            )
```

4. Verify the remediation: Verify that all secure listeners are attached to app-tier ELBs by running the code in step 2 again.

By following the above steps, you can remediate the misconfiguration "Secure Listeners Should Be In App-tier ELBs" in AWS using python.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html) 

