---
slug: elb_nlb_listener_security
title: NLBs Should Not Have Insecure Configurations
sidebar_label: NLBs Should Not Have Insecure Configurations
---

### More Info:

Your Amazon Network Load Balancers (NLBs) should be configured to terminate TLS traffic in order to optimize the performance of the backend servers.

### Risk Level

Medium

### Address

Security

### Compliance Standards

AWSWAF, HIPAA, NIST, GDPR


### Triage and Remediation
<Tabs>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console.
2. Navigate to the EC2 Dashboard by selecting "Services" from the top menu and then selecting "EC2" under the "Compute" category.
3. In the EC2 Dashboard, under the "Load Balancing" section in the left navigation pane, click on "Load Balancers".
4. In the "Load Balancers" page, select the Network Load Balancer (NLB) that you want to check. In the "Description" tab at the bottom, check the "Listeners" section. If the protocol is "TCP" and the port is "80", it means the NLB is using an insecure configuration.
</Accordion>

<Accordion title='Using CLI'>
1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer). Use the following command to install AWS CLI:

   ```
   pip install awscli
   ```

   After installation, you need to configure it with your AWS account. Use the following command and provide your AWS credentials:

   ```
   aws configure
   ```

2. **List all the Load Balancers**: Use the following command to list all the Network Load Balancers (NLBs) in your account:

   ```
   aws elbv2 describe-load-balancers --query 'LoadBalancers[?Type==`network`].LoadBalancerArn' --output text
   ```

   This command will list the ARNs of all the NLBs in your account.

3. **Describe Load Balancer Attributes**: For each NLB ARN from the previous step, use the following command to describe its attributes:

   ```
   aws elbv2 describe-load-balancer-attributes --load-balancer-arn <NLB-ARN>
   ```

   Replace `<NLB-ARN>` with the ARN of the NLB. This command will list all the attributes of the NLB.

4. **Check for Insecure Configurations**: In the output of the previous command, look for the `access_logs.s3.enabled` and `delete_protection.enabled` attributes. If `access_logs.s3.enabled` is set to `false`, it means that access logs are not enabled for the NLB which is a security risk. If `delete_protection.enabled` is set to `false`, it means that delete protection is not enabled for the NLB which is also a security risk.
</Accordion>

<Accordion title='Using Python'>
To check if Network Load Balancers (NLBs) have insecure configurations in AWS Elastic Load Balancer using Python scripts, you can use the Boto3 library, which allows you to directly interact with AWS services, including Elastic Load Balancer. Here are the steps:

1. **Setup AWS SDK for Python (Boto3):**
   First, you need to set up Boto3. Install it using pip:
   ```
   pip install boto3
   ```
   Then, configure your AWS credentials. You can do this by setting the following environment variables:
   ```
   AWS_ACCESS_KEY_ID = 'your_access_key'
   AWS_SECRET_ACCESS_KEY = 'your_secret_key'
   ```

2. **List all NLBs:**
   Use the `describe_load_balancers()` function to list all NLBs. Here's a sample script:
   ```python
   import boto3

   client = boto3.client('elbv2')
   response = client.describe_load_balancers()

   for lb in response['LoadBalancers']:
       if lb['Type'] == 'network':
           print(lb['LoadBalancerArn'])
   ```
   This script will print the ARN of all NLBs.

3. **Check NLB configurations:**
   For each NLB, use the `describe_load_balancer_attributes()` function to get its attributes. Here's a sample script:
   ```python
   import boto3

   client = boto3.client('elbv2')
   response = client.describe_load_balancer_attributes(
       LoadBalancerArn='arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/net/my-load-balancer/6d0ecf831eec9f09'
   )

   for attr in response['Attributes']:
       print(attr)
   ```
   This script will print the attributes of the specified NLB.

4. **Detect insecure configurations:**
   Analyze the attributes to detect insecure configurations. For example, if the `access_logs.s3.enabled` attribute is set to `false`, it means that access logs are not enabled, which is an insecure configuration. Here's a sample script:
   ```python
   import boto3

   client = boto3.client('elbv2')
   response = client.describe_load_balancer_attributes(
       LoadBalancerArn='arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/net/my-load-balancer/6d0ecf831eec9f09'
   )

   for attr in response['Attributes']:
       if attr['Key'] == 'access_logs.s3.enabled' and attr['Value'] == 'false':
           print('Insecure configuration detected: Access logs are not enabled.')
   ```
   This script will print a warning message if access logs are not enabled for the specified NLB.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To remediate the insecure configuration of Network Load Balancers (NLBs) in AWS, you can follow the below steps:

1. Log in to your AWS console and navigate to the EC2 Dashboard.

2. Click on the "Load Balancers" option from the left-hand menu.

3. Select the Network Load Balancer that you want to remediate.

4. Click on the "Listeners" tab.

5. In the "Listeners" tab, review the settings for each listener and ensure that they are using secure protocols such as HTTPS or SSL/TLS.

6. If any of the listeners are using insecure protocols such as HTTP, click on the "Edit" button next to the listener.

7. In the "Edit Listener" window, change the protocol to HTTPS or SSL/TLS.

8. If you are using SSL/TLS, select a valid SSL/TLS certificate from the dropdown list.

9. Click on the "Save" button to save the changes.

10. Repeat steps 6-9 for all listeners that are using insecure protocols.

11. Once all listeners are updated, review the security group settings for the NLB.

12. Ensure that the security group only allows traffic from trusted sources and that it is not open to the public.

13. If necessary, update the security group settings to restrict traffic to trusted sources.

14. Click on the "Save" button to save the changes.

15. Finally, review the NLB settings to ensure that they are compliant with your organization's security policies and best practices.

By following these steps, you can remediate the insecure configuration of Network Load Balancers in AWS and ensure that they are secure and compliant with your organization's security policies.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the insecure configuration of Network Load Balancer (NLB) in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your local machine or EC2 instance.
2. Run the following command to describe the listener configuration of your NLB:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
   ```

   Replace `<load_balancer_arn>` with the ARN of your NLB.

3. Check the output for the "Protocol" and "SslPolicy" fields. If the "Protocol" is set to "TLS" or "HTTPS", and the "SslPolicy" is set to "ELBSecurityPolicy-2016-08" or any other outdated policy, then it is considered an insecure configuration.

4. To remediate this misconfiguration, run the following command to update the SSL policy of the listener:

   ```
   aws elbv2 modify-listener --listener-arn <listener_arn> --ssl-policy ELBSecurityPolicy-TLS-1-2-2017-01
   ```

   Replace `<listener_arn>` with the ARN of the listener that needs to be updated.

5. After running the above command, verify that the SSL policy has been updated successfully by running the "describe-listeners" command again.

6. Repeat steps 3 to 5 for all the listeners of your NLB.

7. Once all the listeners have been updated, verify that the NLB no longer has any insecure configurations by running the "describe-listeners" command again.

By following these steps, you can remediate the insecure configuration of your NLB in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate an insecure configuration in AWS NLBs using Python, you can follow the below steps:

1. Identify the insecure configuration: In this case, the insecure configuration is related to the security group of the Network Load Balancer (NLB). Make sure that the security group associated with the NLB is properly configured to allow only necessary traffic.

2. Use Boto3 to update the security group: Boto3 is a Python library for AWS that allows you to interact with AWS services. You can use Boto3 to update the security group associated with the NLB.

3. Define the NLB ARN: To update the security group, you need to define the ARN of the NLB. You can get the ARN of the NLB from the AWS Management Console or by using Boto3.

4. Define the security group ID: Define the security group ID of the security group that you want to associate with the NLB. You can get the security group ID from the AWS Management Console or by using Boto3.

5. Update the security group: Use the `modify_network_interface_attribute` method of the EC2 client to update the security group associated with the NLB. Pass the NLB ARN and the security group ID as parameters to the method.

Here is a sample Python code to update the security group associated with the NLB:

```
import boto3

# Define the NLB ARN
nlb_arn = 'arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/net/my-load-balancer/1234567890123456'

# Define the security group ID
security_group_id = 'sg-0123456789abcdef'

# Update the security group
ec2_client = boto3.client('ec2')
ec2_client.modify_network_interface_attribute(
    NetworkInterfaceId=nlb_arn,
    Groups=[
        security_group_id
    ]
)
```

Note: Make sure that you have the necessary permissions to update the security group associated with the NLB.
</Accordion>

</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html) 

