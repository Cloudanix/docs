

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console and open the Amazon EC2 console at https://console.aws.amazon.com/ec2/.

2. In the navigation pane, under LOAD BALANCING, choose Load Balancers.

3. Select the load balancer you want to inspect.

4. In the bottom panel, select the "Listeners" tab. Here you can see the protocols and ports configured for your load balancer. If the protocol is HTTP or TCP, it means the listener is not secure. Secure listeners should be using HTTPS or SSL protocols.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elastic Load Balancer (ELB) resources.

2. Once the AWS CLI is set up, you can list all the load balancers in your account using the following command:

   ```
   aws elbv2 describe-load-balancers
   ```
   This command will return a JSON output with details of all the load balancers.

3. To check the listeners for a specific load balancer, you need the ARN of the load balancer. You can get this from the output of the previous command. Once you have the ARN, use the following command to describe the listeners:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn>
   ```
   Replace `<load-balancer-arn>` with the ARN of your load balancer. This command will return a JSON output with details of all the listeners associated with the specified load balancer.

4. To check if the listeners are secure, you need to look for the `Protocol` field in the output of the previous command. If the protocol is `HTTPS` or `TLS`, then the listener is secure. If the protocol is `HTTP`, then the listener is not secure. You can use a Python script to parse the JSON output and check the protocol of each listener. Here is a simple script:

   ```python
   import json
   import subprocess

   def check_secure_listeners(load_balancer_arn):
       command = ['aws', 'elbv2', 'describe-listeners', '--load-balancer-arn', load_balancer_arn]
       output = subprocess.check_output(command)
       data = json.loads(output)
       for listener in data['Listeners']:
           if listener['Protocol'] in ['HTTPS', 'TLS']:
               print(f"Listener {listener['ListenerArn']} is secure.")
           else:
               print(f"Listener {listener['ListenerArn']} is not secure.")

   check_secure_listeners('<load-balancer-arn>')
   ```
   Replace `<load-balancer-arn>` with the ARN of your load balancer. This script will print whether each listener is secure or not.

#### Using Python

1. Install the necessary Python libraries: To interact with AWS services, you need to install the Boto3 library. You can install it using pip:

   ```
   pip install boto3
   ```

2. Configure AWS credentials: Before you can interact with AWS services, you need to set up your AWS credentials. You can do this by creating a file at ~/.aws/credentials. At the very least, the contents of the file should be:

   ```
   [default]
   aws_access_key_id = YOUR_ACCESS_KEY
   aws_secret_access_key = YOUR_SECRET_KEY
   ```

3. Write a Python script to check for secure listeners in ELBs:

   ```python
   import boto3

   def check_elb_secure_listeners():
       elb = boto3.client('elbv2')
       elbs = elb.describe_load_balancers()
       for elb in elbs['LoadBalancers']:
           listeners = elb.describe_listeners(LoadBalancerArn=elb['LoadBalancerArn'])
           for listener in listeners['Listeners']:
               if listener['Protocol'] != 'HTTPS':
                   print(f"ELB {elb['LoadBalancerName']} has insecure listener on port {listener['Port']}")

   if __name__ == "__main__":
       check_elb_secure_listeners()
   ```

4. Run the script: You can run the script using the Python interpreter. The script will print out the names of any ELBs that have insecure listeners.

   ```
   python check_elb_secure_listeners.py
   ```

This script checks all the ELBs in the default region. If you want to check ELBs in other regions, you need to specify the region when creating the Boto3 client.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

The misconfiguration "Secure Listeners in Web-tier ELBs" suggests that the Elastic Load Balancer (ELB) in the web-tier of your AWS environment is not configured to use secure listeners. To remediate this issue, you can follow the below steps:

1. Open the AWS Management Console and navigate to the EC2 dashboard.
2. From the left-hand menu, click on "Load Balancers" under the "EC2" section.
3. Select the web-tier ELB that needs to be remediated.
4. Click on the "Listeners" tab at the bottom of the page.
5. Click on the "Edit" button next to the HTTP listener.
6. In the "Edit Listener" dialog box, change the protocol from "HTTP" to "HTTPS".
7. Select the SSL certificate that you want to use for the HTTPS listener.
8. Click on the "Save" button to save the changes.

Once the above steps are completed, the web-tier ELB will be configured to use secure listeners, and all the traffic between the clients and the ELB will be encrypted using SSL.

#### Using CLI

The misconfiguration "Secure Listeners in Web-tier ELBs" indicates that the Elastic Load Balancer (ELB) in the web-tier is not configured to use secure listeners (HTTPS). To remediate this issue, you can follow the below steps using AWS CLI:

1. List all the ELBs in your AWS account using the following command:
```
aws elbv2 describe-load-balancers
```

2. Identify the web-tier ELB that needs to be remediated.

3. Check the current listener configuration for the identified ELB using the following command:
```
aws elbv2 describe-listeners --load-balancer-arn <ELB_ARN>
```

4. If the listener is not configured to use HTTPS, create a new HTTPS listener using the following command:
```
aws elbv2 create-listener --load-balancer-arn <ELB_ARN> --protocol HTTPS --port 443 --default-actions Type=forward,TargetGroupArn=<TARGET_GROUP_ARN> --certificates CertificateArn=<CERTIFICATE_ARN>
```
Note: Replace `<ELB_ARN>`, `<TARGET_GROUP_ARN>`, and `<CERTIFICATE_ARN>` with the appropriate values for your environment.

5. Verify that the new HTTPS listener is added successfully using the following command:
```
aws elbv2 describe-listeners --load-balancer-arn <ELB_ARN>
```

6. Once the HTTPS listener is added, you can enable the redirect from HTTP to HTTPS using the following command:
```
aws elbv2 create-rule --listener-arn <HTTPS_LISTENER_ARN> --priority 1 --conditions Field=host-header,Values=<YOUR_DOMAIN_NAME> --actions Type=redirect,RedirectConfig={Protocol=HTTPS,Port=443,StatusCode=HTTP_301}
```
Note: Replace `<HTTPS_LISTENER_ARN>` and `<YOUR_DOMAIN_NAME>` with the appropriate values for your environment.

7. Verify that the HTTP to HTTPS redirect is added successfully using the following command:
```
aws elbv2 describe-rules --listener-arn <HTTPS_LISTENER_ARN>
```

By following these steps, you can remediate the misconfiguration "Secure Listeners in Web-tier ELBs" in AWS.

#### Using Python

To remediate the misconfiguration "Secure Listeners in Web-tier ELBs" for AWS using Python, you can follow the below steps:

1. Create a boto3 client object for Elastic Load Balancing (ELB) using the AWS SDK for Python (boto3).

```
import boto3
elb_client = boto3.client('elbv2')
```

2. Get a list of all the ELBs in your AWS account using the `describe_load_balancers` method of the ELB client.

```
response = elb_client.describe_load_balancers()
elbs = response['LoadBalancers']
```

3. Loop through the list of ELBs and check if they have any HTTP listeners. If an ELB has HTTP listeners, create a new listener with HTTPS protocol and a valid SSL certificate.

```
for elb in elbs:
    http_listeners = [listener for listener in elb['Listeners'] if listener['Protocol'] == 'HTTP']
    if http_listeners:
        elb_arn = elb['LoadBalancerArn']
        listener_arns = [listener['ListenerArn'] for listener in http_listeners]
        ssl_cert_arn = 'arn:aws:acm:us-east-1:123456789012:certificate/abcd1234-abcd-1234-abcd-1234abcd1234'
        response = elb_client.create_listener(
            LoadBalancerArn=elb_arn,
            Protocol='HTTPS',
            Port=443,
            SslPolicy='ELBSecurityPolicy-2016-08',
            Certificates=[
                {
                    'CertificateArn': ssl_cert_arn
                }
            ]
        )
        https_listener_arn = response['Listeners'][0]['ListenerArn']
        for listener_arn in listener_arns:
            elb_client.delete_listener(
                ListenerArn=listener_arn
            )
```

4. Once the HTTPS listener is created and the HTTP listeners are deleted, the ELB will only accept secure traffic over HTTPS.

Note: You will need to replace the `ssl_cert_arn` value with the ARN of a valid SSL certificate in your AWS account. Also, make sure to update the region and AWS account ID in the ARN.


</Tab>
</Tabs>