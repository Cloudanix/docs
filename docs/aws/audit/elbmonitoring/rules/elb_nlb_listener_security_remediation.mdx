

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the EC2 dashboard by selecting "Services" from the top menu, then choosing "EC2" under the "Compute" category.
3. In the EC2 dashboard, under the "Load Balancing" section in the left-hand navigation pane, click on "Load Balancers".
4. In the "Load Balancers" page, you will see a list of all your load balancers. Click on the load balancer you want to check.
5. In the "Description" tab below, check the "Attributes" section. Here, you can see the configurations of the selected load balancer. Look for any insecure configurations such as deletion protection disabled, access logs disabled, or cross-zone load balancing disabled.

#### Using CLI

1. **Install and Configure AWS CLI**: Before you can start, make sure you have AWS CLI installed and configured on your system. You can install it using pip (Python package installer). Use the following command to install AWS CLI:

   ```
   pip install awscli
   ```

   After installation, configure it using the following command and provide your AWS credentials (Access Key ID and Secret Access Key):

   ```
   aws configure
   ```

2. **List all Network Load Balancers (NLBs)**: Use the following AWS CLI command to list all the NLBs in your account:

   ```
   aws elbv2 describe-load-balancers --query 'LoadBalancers[?Type==`network`].{Name:Name, ARN:LoadBalancerArn}' --output table
   ```

   This command will list all the NLBs along with their names and ARNs.

3. **Describe Load Balancer Attributes**: For each NLB, use the following command to describe its attributes:

   ```
   aws elbv2 describe-load-balancer-attributes --load-balancer-arn <LoadBalancerArn>
   ```

   Replace `<LoadBalancerArn>` with the ARN of the NLB. This command will list all the attributes of the NLB.

4. **Check for Insecure Configurations**: Look for the `access_logs.s3.enabled` and `access_logs.s3.bucket` attributes in the output. If `access_logs.s3.enabled` is set to `false` or `access_logs.s3.bucket` is not set, it means that the NLB has insecure configurations as it is not logging access logs to an S3 bucket.

#### Using Python

1. Install the necessary Python libraries: Before you start, you need to install the AWS SDK for Python (Boto3) to interact with AWS services. You can install it using pip:

   ```
   pip install boto3
   ```

2. Set up AWS credentials: You need to configure your AWS credentials (Access Key ID and Secret Access Key) to allow your script to access AWS services. You can do this by running `aws configure` in your terminal and following the prompts.

3. Write a Python script to list all Network Load Balancers (NLBs) and check their configurations:

   ```python
   import boto3

   def check_nlb_insecure_config():
       elbv2 = boto3.client('elbv2')
       nlbs = elbv2.describe_load_balancers(LoadBalancerType='network')
       for nlb in nlbs['LoadBalancers']:
           if nlb['Scheme'] == 'internet-facing':
               print(f"NLB {nlb['LoadBalancerName']} has insecure configuration: It is internet-facing.")
           if nlb['State']['Code'] != 'active':
               print(f"NLB {nlb['LoadBalancerName']} has insecure configuration: It is not active.")
           if not nlb['IpAddressType'] == 'dualstack':
               print(f"NLB {nlb['LoadBalancerName']} has insecure configuration: It does not support both IPv4 and IPv6.")
           # Add more checks as needed

   if __name__ == "__main__":
       check_nlb_insecure_config()
   ```

   This script lists all NLBs and checks if they are internet-facing, not active, or do not support both IPv4 and IPv6. You can add more checks as needed.

4. Run the script: You can run the script using Python from your terminal:

   ```
   python check_nlb_insecure_config.py
   ```

   The script will print out the names of NLBs that have insecure configurations.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the insecure configuration of Network Load Balancers (NLBs) in AWS, you can follow the below steps:

1. Log in to your AWS console and navigate to the EC2 Dashboard.

2. Click on the "Load Balancers" option from the left-hand menu.

3. Select the Network Load Balancer that you want to remediate.

4. Click on the "Listeners" tab.

5. In the "Listeners" tab, review the settings for each listener and ensure that they are using secure protocols such as HTTPS or SSL/TLS.

6. If any of the listeners are using insecure protocols such as HTTP, click on the "Edit" button next to the listener.

7. In the "Edit Listener" window, change the protocol to HTTPS or SSL/TLS.

8. If you are using SSL/TLS, select a valid SSL/TLS certificate from the dropdown list.

9. Click on the "Save" button to save the changes.

10. Repeat steps 6-9 for all listeners that are using insecure protocols.

11. Once all listeners are updated, review the security group settings for the NLB.

12. Ensure that the security group only allows traffic from trusted sources and that it is not open to the public.

13. If necessary, update the security group settings to restrict traffic to trusted sources.

14. Click on the "Save" button to save the changes.

15. Finally, review the NLB settings to ensure that they are compliant with your organization's security policies and best practices.

By following these steps, you can remediate the insecure configuration of Network Load Balancers in AWS and ensure that they are secure and compliant with your organization's security policies.

#### Using CLI

To remediate the insecure configuration of Network Load Balancer (NLB) in AWS, you can follow the below steps using AWS CLI:

1. Open the AWS CLI on your local machine or EC2 instance.
2. Run the following command to describe the listener configuration of your NLB:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
   ```

   Replace `<load_balancer_arn>` with the ARN of your NLB.

3. Check the output for the "Protocol" and "SslPolicy" fields. If the "Protocol" is set to "TLS" or "HTTPS", and the "SslPolicy" is set to "ELBSecurityPolicy-2016-08" or any other outdated policy, then it is considered an insecure configuration.

4. To remediate this misconfiguration, run the following command to update the SSL policy of the listener:

   ```
   aws elbv2 modify-listener --listener-arn <listener_arn> --ssl-policy ELBSecurityPolicy-TLS-1-2-2017-01
   ```

   Replace `<listener_arn>` with the ARN of the listener that needs to be updated.

5. After running the above command, verify that the SSL policy has been updated successfully by running the "describe-listeners" command again.

6. Repeat steps 3 to 5 for all the listeners of your NLB.

7. Once all the listeners have been updated, verify that the NLB no longer has any insecure configurations by running the "describe-listeners" command again.

By following these steps, you can remediate the insecure configuration of your NLB in AWS using AWS CLI.

#### Using Python

To remediate an insecure configuration in AWS NLBs using Python, you can follow the below steps:

1. Identify the insecure configuration: In this case, the insecure configuration is related to the security group of the Network Load Balancer (NLB). Make sure that the security group associated with the NLB is properly configured to allow only necessary traffic.

2. Use Boto3 to update the security group: Boto3 is a Python library for AWS that allows you to interact with AWS services. You can use Boto3 to update the security group associated with the NLB.

3. Define the NLB ARN: To update the security group, you need to define the ARN of the NLB. You can get the ARN of the NLB from the AWS Management Console or by using Boto3.

4. Define the security group ID: Define the security group ID of the security group that you want to associate with the NLB. You can get the security group ID from the AWS Management Console or by using Boto3.

5. Update the security group: Use the `modify_network_interface_attribute` method of the EC2 client to update the security group associated with the NLB. Pass the NLB ARN and the security group ID as parameters to the method.

Here is a sample Python code to update the security group associated with the NLB:

```
import boto3

# Define the NLB ARN
nlb_arn = 'arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/net/my-load-balancer/1234567890123456'

# Define the security group ID
security_group_id = 'sg-0123456789abcdef'

# Update the security group
ec2_client = boto3.client('ec2')
ec2_client.modify_network_interface_attribute(
    NetworkInterfaceId=nlb_arn,
    Groups=[
        security_group_id
    ]
)
```

Note: Make sure that you have the necessary permissions to update the security group associated with the NLB.


</Tab>
</Tabs>