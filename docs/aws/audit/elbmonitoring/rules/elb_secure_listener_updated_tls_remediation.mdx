

<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Sign in to the AWS Management Console.
2. Navigate to the EC2 Dashboard by selecting "EC2" under the "Services" dropdown menu.
3. In the EC2 Dashboard, under the "Load Balancing" section in the left navigation pane, click on "Load Balancers".
4. In the Load Balancers page, select the load balancer you want to check. In the bottom panel, click on the "Listeners" tab. Here, you can see the protocols used by the load balancer. If it's using HTTP or TCP, it means it's not using secure listeners.

#### Using CLI

1. First, you need to install and configure AWS CLI on your local machine. You can do this by following the instructions provided by AWS. Make sure you have the necessary permissions to access the Elastic Load Balancer (ELB) resources.

2. Once the AWS CLI is set up, you can list all the load balancers in your account using the following command:

   ```
   aws elbv2 describe-load-balancers
   ```

   This command will return a JSON output with details about all the load balancers in your account.

3. To check if the ELBs are using secure listeners, you need to describe the listeners for each load balancer. You can do this using the following command:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn>
   ```

   Replace `<load-balancer-arn>` with the ARN of the load balancer you want to check. This command will return a JSON output with details about the listeners for the specified load balancer.

4. In the JSON output, look for the "Protocol" field under each listener. If the protocol is "HTTPS" or "TLS", then the listener is secure. If the protocol is "HTTP", then the listener is not secure. You can use a tool like `jq` to parse the JSON output and filter for insecure listeners. For example:

   ```
   aws elbv2 describe-listeners --load-balancer-arn <load-balancer-arn> | jq '.Listeners[] | select(.Protocol=="HTTP")'
   ```

   This command will return details about any insecure listeners for the specified load balancer. If the command returns no output, then all the listeners for the load balancer are secure.

#### Using Python

To check if Elastic Load Balancers (ELBs) are using secure listeners only, you can use the Boto3 library in Python, which allows you to write scripts to automate AWS services. Here are the steps:

1. **Import the necessary libraries and establish a session with AWS:**

```python
import boto3

# Create a session using your AWS credentials
session = boto3.Session(
    aws_access_key_id='YOUR_ACCESS_KEY',
    aws_secret_access_key='YOUR_SECRET_KEY',
    region_name='YOUR_REGION_NAME'
)
```

2. **Create an ELB client:**

```python
# Create an ELB client
elb = session.client('elbv2')
```

3. **Retrieve all the load balancers and check their listeners:**

```python
# Get all load balancers
load_balancers = elb.describe_load_balancers()

# Iterate over each load balancer
for lb in load_balancers['LoadBalancers']:
    # Get the listeners for the load balancer
    listeners = elb.describe_listeners(LoadBalancerArn=lb['LoadBalancerArn'])

    # Iterate over each listener
    for listener in listeners['Listeners']:
        # Check if the listener is using HTTP (port 80)
        if listener['Port'] == 80:
            print(f"Load balancer {lb['LoadBalancerName']} is using insecure listener (HTTP).")
```

4. **Interpret the results:**

The script will print out the names of the load balancers that are using insecure listeners (HTTP). If no such message is printed, it means all your ELBs are using secure listeners only.

Please replace `'YOUR_ACCESS_KEY'`, `'YOUR_SECRET_KEY'`, and `'YOUR_REGION_NAME'` with your actual AWS credentials and the region you want to check.

</Tab>

<Tab title='Remediation'>
### Remediation

#### Using Console

Sure, here are the step-by-step instructions to remediate the misconfiguration "ELBs Should Use Secure Listeners Only" for AWS using the AWS console:

1. Login to the AWS Management Console and navigate to the EC2 Dashboard.
2. Click on the "Load Balancers" option from the left-hand menu.
3. Select the ELB for which you want to enable secure listeners.
4. Click on the "Listeners" tab.
5. Remove any HTTP listeners by clicking on the "X" button next to the listener.
6. Click on the "Add listener" button.
7. Select "HTTPS" from the "Load Balancer Protocol" dropdown menu.
8. Enter the appropriate values for "Load Balancer Port" and "Instance Protocol" based on your application requirements.
9. Select the SSL certificate from the "SSL Certificate" dropdown menu.
10. Click on the "Add" button to add the secure listener.
11. Click on the "Save" button to save the changes.

Once these steps are completed, your ELB will only use secure listeners and the misconfiguration "ELBs Should Use Secure Listeners Only" will be remediated.

#### Using CLI

To remediate the ELBs Should Use Secure Listeners Only misconfiguration for AWS using AWS CLI, you can follow the below steps:

Step 1: Open the AWS CLI and run the following command to describe the load balancer:

```
aws elb describe-load-balancers --load-balancer-name <load_balancer_name>
```

Note: Replace `<load_balancer_name>` with the name of your load balancer.

Step 2: Check the listener configuration of the load balancer and ensure that it is using secure listeners only. You can do this by checking if the protocol is set to HTTPS and the SSL certificate is properly configured.

Step 3: If the load balancer is not using secure listeners only, run the following command to update the listener configuration:

```
aws elb create-load-balancer-listeners --load-balancer-name <load_balancer_name> --listeners Protocol=HTTPS,LoadBalancerPort=443,InstanceProtocol=HTTP,InstancePort=80,SSLCertificateId=<ssl_certificate_id>
```

Note: Replace `<load_balancer_name>` with the name of your load balancer and `<ssl_certificate_id>` with the ID of your SSL certificate.

Step 4: After updating the listener configuration, run the following command to verify the updated configuration:

```
aws elb describe-load-balancers --load-balancer-name <load_balancer_name>
```

Note: Replace `<load_balancer_name>` with the name of your load balancer.

Step 5: Repeat the above steps for all the load balancers in your AWS account.

By following the above steps, you can remediate the ELBs Should Use Secure Listeners Only misconfiguration for AWS using AWS CLI.

#### Using Python

To remediate the misconfiguration of ELBs using insecure listeners in AWS, you can use the following Python script:

```python
import boto3

# Create a boto3 client for ELB
elb_client = boto3.client('elbv2')

# Get a list of all the load balancers
load_balancers = elb_client.describe_load_balancers()

# Iterate through each load balancer and update its listeners
for lb in load_balancers['LoadBalancers']:
    # Get the current listeners of the load balancer
    current_listeners = elb_client.describe_listeners(LoadBalancerArn=lb['LoadBalancerArn'])
    
    # Iterate through each listener and check if it is secure
    for listener in current_listeners['Listeners']:
        if listener['Protocol'] == 'HTTP':
            # Remove the insecure listener
            elb_client.delete_listener(ListenerArn=listener['ListenerArn'])
        elif listener['Protocol'] == 'HTTPS':
            # Update the secure listener to use a secure SSL policy
            elb_client.modify_listener(ListenerArn=listener['ListenerArn'], SslPolicy='ELBSecurityPolicy-TLS-1-2-2017-01')
```

This script will iterate through all the load balancers in your AWS account and check if any of them have insecure listeners. If it finds an insecure listener that uses HTTP, it will remove it. If it finds a secure listener that uses HTTPS, it will update the SSL policy to use a secure one.


</Tab>
</Tabs>