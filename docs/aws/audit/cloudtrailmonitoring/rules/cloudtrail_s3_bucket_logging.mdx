---
slug: cloudtrail_s3_bucket_logging
title: Server Access Logging Feature Should Be Enabled
sidebar_label: Server Access Logging Feature Should Be Enabled
---

### More Info:

Any S3 buckets used by AWS CloudTrail should have Server Access Logging feature enabled in order to track requests for accessing the buckets and necessary for security audits.

### Risk Level

Medium

### Address

Security

### Compliance Standards

HIPAA, GDPR, SOC2, CISAWS, CBP, AWSWAF



<Tabs><Tab title='Cause'>
### Check Cause

#### Using Console

1. Log in to the AWS Management Console and navigate to the CloudTrail service. 

2. In the CloudTrail dashboard, click on "Trails" in the left navigation pane. 

3. In the Trails page, you will see a list of all your trails. Click on the name of the trail you want to check.

4. In the trail details page, look for the "S3 bucket" section. If the "Server access logging" is enabled, it will show "Yes". If it is not enabled, it will show "No".

#### Using CLI

1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudTrail trails: Use the following AWS CLI command to list all the CloudTrail trails in your AWS account:

   ```
   aws cloudtrail describe-trails
   ```
   This command will return a JSON output with details of all the trails.

3. Check if Server Access Logging is enabled: For each trail, check the "IsLogging" attribute. If the value of this attribute is "true", then Server Access Logging is enabled for that trail. If the value is "false", then Server Access Logging is not enabled.

   You can use the following command to check the "IsLogging" attribute for a specific trail:

   ```
   aws cloudtrail get-trail-status --name <trail_name>
   ```
   Replace `<trail_name>` with the name of the trail you want to check.

4. Repeat the process for all trails: You need to repeat step 3 for all the trails in your AWS account to ensure that Server Access Logging is enabled for all of them. If you find any trail with Server Access Logging disabled, it indicates a misconfiguration.

#### Using Python

1. Install the necessary Python libraries: Before you can start writing the script, you need to install the necessary Python libraries. The AWS SDK for Python (Boto3) allows Python developers to write software that makes use of services like Amazon S3, Amazon EC2, etc. You can install it using pip:

   ```bash
   pip install boto3
   ```

2. Import the necessary libraries and set up AWS credentials: You need to import the boto3 library and set up your AWS credentials (Access key ID and Secret access key). You can set up your credentials in the AWS credentials file located by default at `~/.aws/credentials`. 

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION_NAME'
   )
   ```

3. Create a CloudTrail client: Using the session object, you can create a CloudTrail client which will allow you to interact with the CloudTrail service.

   ```python
   cloudtrail = session.client('cloudtrail')
   ```

4. Check if Server Access Logging is enabled: You can use the `describe_trails` method of the CloudTrail client to get details about all the trails for your account. Then, for each trail, you can use the `get_trail_status` method to check if the `IsLogging` attribute is set to `True`.

   ```python
   trails = cloudtrail.describe_trails()

   for trail in trails['trailList']:
       status = cloudtrail.get_trail_status(Name=trail['Name'])
       if not status['IsLogging']:
           print(f"Server Access Logging is not enabled for trail {trail['Name']}")
   ```
   
This script will print the names of all trails for which Server Access Logging is not enabled.

</Tab>


<Tab title='Remediation'>
### Remediation

#### Using Console

To remediate the misconfiguration "Server Access Logging Feature Should Be Enabled" for AWS using the AWS console, follow these steps:

1. Login to the AWS Management Console.
2. Navigate to the S3 service.
3. Select the S3 bucket for which you want to enable server access logging.
4. Click on the "Properties" tab.
5. Scroll down to the "Server access logging" section and click on "Edit".
6. Select the checkbox "Enable logging".
7. Choose the target bucket and target prefix for the log files.
8. Click on "Save changes".

Once you have enabled the server access logging feature, all access requests made to the S3 bucket will be logged and stored in the target bucket you have specified. This will help you track and monitor all access to your S3 bucket, which can help you identify any potential security threats or unauthorized access attempts.

#### Using CLI

To remediate the misconfiguration "Server Access Logging Feature Should Be Enabled" for an AWS S3 bucket using AWS CLI, follow these steps:

1. Open the AWS CLI on your computer.

2. Enter the following command to enable server access logging for an S3 bucket:

```
aws s3api put-bucket-acl --bucket <bucket-name> --grant-full-control uri=http://acs.amazonaws.com/groups/s3/LogDelivery --grant-read-acp uri=http://acs.amazonaws.com/groups/s3/LogDelivery
```

Replace `<bucket-name>` with the name of the S3 bucket you want to enable server access logging for.

3. Enter the following command to create a new S3 bucket policy that allows the S3 bucket owner to write server access logs to the bucket:

```
aws s3api put-bucket-policy --bucket <bucket-name> --policy "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"arn:aws:iam::cloudfront:user/log-delivery@AWS-account-ID\"},\"Action\":\"s3:PutObject\",\"Resource\":\"arn:aws:s3:::<bucket-name>/AWSLogs/AWS-account-ID/*\"}]}"
```

Replace `<bucket-name>` with the name of the S3 bucket you want to enable server access logging for and replace `AWS-account-ID` with your AWS account ID.

4. Enter the following command to enable server access logging for the S3 bucket:

```
aws s3api put-bucket-logging --bucket <bucket-name> --logging-configuration "{\"LogFormat\":[{\"Field\":\"requester\"},{\"Field\":\"bucket-owner\"},{\"Field\":\"time\"},{\"Field\":\"remote-ip\"},{\"Field\":\"request-method\"},{\"Field\":\"request-uri\"},{\"Field\":\"http-status\"},{\"Field\":\"error-code\"},{\"Field\":\"bytes-sent\"},{\"Field\":\"object-size\"},{\"Field\":\"total-time\"},{\"Field\":\"turn-around-time\"},{\"Field\":\"referer\"},{\"Field\":\"user-agent\"}],\"LoggingEnabled\":{\"TargetBucket\":\"<bucket-name>\",\"TargetPrefix\":\"AWSLogs/AWS-account-ID/\",\"TargetGrants\":[{\"Grantee\":{\"Type\":\"Group\",\"URI\":\"http://acs.amazonaws.com/groups/s3/LogDelivery\"},\"Permission\":\"WRITE\"}]}}"
```

Replace `<bucket-name>` with the name of the S3 bucket you want to enable server access logging for and replace `AWS-account-ID` with your AWS account ID.

After following these steps, server access logging will be enabled for the specified S3 bucket.

#### Using Python

To remediate the misconfiguration "Server Access Logging Feature Should Be Enabled" in AWS using Python, you can follow the below steps:

1. Import the necessary AWS SDK modules in Python:

```python
import boto3
```

2. Initialize the AWS SDK client for S3:

```python
s3 = boto3.client('s3')
```

3. List all the S3 buckets in your AWS account:

```python
buckets = s3.list_buckets()
```

4. For each bucket, check if server access logging is enabled:

```python
for bucket in buckets['Buckets']:
    bucket_name = bucket['Name']
    logging = s3.get_bucket_logging(Bucket=bucket_name)
    if 'LoggingEnabled' not in logging:
        # Enable server access logging for the bucket
        s3.put_bucket_logging(
            Bucket=bucket_name,
            BucketLoggingStatus={
                'LoggingEnabled': {
                    'TargetBucket': bucket_name,
                    'TargetPrefix': 'logs/'
                }
            }
        )
```

5. Save the Python script and run it to enable server access logging for all S3 buckets in your AWS account.

Note: Make sure you have the necessary AWS credentials configured to run the Python script.

### Additional Reading:

- [https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html) 


</Tab>
</Tabs>