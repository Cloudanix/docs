---
slug: cloudtrail_publicly_accessible
title: CloudTrail Logging Buckets Should Not Be Publicly Accessible
sidebar_label: CloudTrail Logging Buckets Should Not Be Publicly Accessible
---

### More Info:

AWS CloudTrail logging buckets should not be publicly accessible. Using an overly permissive or insecure set of permissions for your CloudTrail logging S3 buckets could provide malicious users access to your AWS account log data which can increase exponentially the risk of unauthorized access.

### Risk Level

Critical

### Address

Security

### Compliance Standards

GDPR, HIPAA, CISAWS, CBP, AWSWAF, HITRUST, SOC2, NISTCSF, PCIDSS

### Remediation

#### Using Console

1. **Sign in to the AWS Management Console**.
2. **Navigate to the CloudTrail service**.
3. **Select Trails from the navigation pane**.
4. **Identify the trails with publicly accessible buckets**:
   - Look for trails listed in the console that have S3 buckets with public access.
5. **Review S3 Bucket Access**:
   - Click on each trail.
   - Check the bucket ACL and bucket policy for any grants to "AllUsers" or "AuthenticatedUsers" with "FULL_CONTROL" permission.
6. **Remove Public Access**:
   - Modify the bucket ACL and bucket policy to remove any grants allowing public access.
7. **Repeat for other trails**:
   - Repeat the above steps for all trails with publicly accessible buckets.

#### Using CLI

1. **List CloudTrail Trails**:
```bash
aws cloudtrail describe-trails
```
2. **Identify Trails with Publicly Accessible Buckets**:
   - Look for trails where the S3 bucket ACL or bucket policy grants permissions to "AllUsers" or "AuthenticatedUsers" with "FULL_CONTROL" permission.
3. **Modify Bucket ACL and Bucket Policy**:
   - Update the bucket ACL and bucket policy to remove any grants allowing public access.
4. **Repeat for other trails**:
   - If there are multiple trails with publicly accessible buckets, repeat the modification steps for each of them.

#### Using Python

Here's a Python script to identify and remediate CloudTrail trails with publicly accessible S3 buckets:

```python
import boto3

class CloudTrailChecker:
    def __init__(self):
        self.cloudtrail_client = boto3.client('cloudtrail')

    def get_publicly_accessible_trails(self):
        failures = []
        response = self.cloudtrail_client.describe_trails()
        for trail in response['trailList']:
            if self.is_trail_public(trail):
                failures.append(trail)
        return failures

    def is_trail_public(self, trail):
        bucket_acl = trail.get("S3BucketName", "")
        bucket_policy = trail.get("S3BucketName", "")
        for grant in bucket_acl.get("Grants", []):
            if grant.get("Grantee", {}).get("URI", "") in [
                "http://acs.amazonaws.com/groups/global/AllUsers",
                "http://acs.amazonaws.com/groups/global/AuthenticatedUsers",
            ] and grant.get("Permission", None) == "FULL_CONTROL":
                return True
        statements = bucket_policy.get("Policy", {}).get("Statement", [])
        for statement in statements:
            if statement.get("Effect", "") == "Allow" and statement.get("Principal", "") == "*":
                return True
        return False

    def remediate_public_trail(self, trail_name):
        # Implement remediation logic here
        print(f"Trail {trail_name} has been remediated.")

# Instantiate the class
checker = CloudTrailChecker()

# Get trails with publicly accessible buckets
public_trails = checker.get_publicly_accessible_trails()

# Remediate public trails
for trail in public_trails:
    checker.remediate_public_trail(trail['Name'])
```

This Python script identifies CloudTrail trails with publicly accessible S3 buckets and provides a placeholder for the remediation logic. You would need to implement the logic to modify the bucket ACL and bucket policy to remove public access.

Make sure to have appropriate IAM permissions for managing CloudTrail trails if you're using AWS CLI or Python script.
### Additional Reading:

- [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html) 

