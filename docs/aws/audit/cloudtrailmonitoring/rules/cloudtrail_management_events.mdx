---
slug: cloudtrail_management_events
title: CloudTrails Must Log Management Events
sidebar_label: CloudTrails Must Log Management Events
---

### More Info:

All your AWS CloudTrail trails should be configured to log Management events in order to record important operations such as EC2 RunInstances, DescribeInstances, TerminateInstances and Console Login.

### Risk Level

Medium

### Address

Security

### Compliance Standards

SOC2, NIST, GDPR, HIPAA, ISO27001, AWSWAF


### Triage and Remediation
<Tabs>


<Tab title='Prevention'>
### How to Prevent
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
To ensure that CloudTrail logs management events in AWS, follow these steps using the AWS Management Console:

1. **Open the CloudTrail Console:**
   - Sign in to the AWS Management Console.
   - Navigate to the CloudTrail console by searching for "CloudTrail" in the services search bar and selecting it.

2. **Create or Modify a Trail:**
   - If you already have a trail, select it from the list. If not, click on "Create trail" to set up a new one.

3. **Configure Management Events:**
   - In the trail settings, locate the "Management events" section.
   - Ensure that the "Read/Write management events" option is enabled. You can choose to log "Read events," "Write events," or both, depending on your requirements.

4. **Save Changes:**
   - After configuring the management events, review your settings.
   - Click on "Create" or "Update trail" to save the changes.

By following these steps, you ensure that CloudTrail is configured to log management events, which is crucial for auditing and monitoring activities in your AWS environment.
</Accordion>

<Accordion title='Using CLI'>
To ensure that CloudTrail logs management events in AWS, you need to configure your CloudTrail settings appropriately. Here are the steps to prevent the misconfiguration using AWS CLI:

1. **Create or Update a CloudTrail Trail:**
   Ensure you have a CloudTrail trail that is configured to log management events. If you don't have one, create it using the following command:
   ```sh
   aws cloudtrail create-trail --name <trail-name> --s3-bucket-name <s3-bucket-name>
   ```

2. **Enable Management Event Logging:**
   When creating or updating the trail, make sure to enable management event logging. Use the following command to update an existing trail to log management events:
   ```sh
   aws cloudtrail update-trail --name <trail-name> --is-logging --include-management-events
   ```

3. **Verify Management Event Logging Configuration:**
   Check the trail configuration to ensure that management events are being logged. Use the following command to describe the trail and verify the settings:
   ```sh
   aws cloudtrail describe-trails --trail-name-list <trail-name>
   ```

4. **Enable Multi-Region Trail (Optional but Recommended):**
   To ensure that management events are logged across all regions, enable the multi-region trail option:
   ```sh
   aws cloudtrail update-trail --name <trail-name> --is-multi-region-trail
   ```

By following these steps, you can ensure that CloudTrail is configured to log management events, thereby preventing the misconfiguration.
</Accordion>

<Accordion title='Using Python'>
To ensure that CloudTrail logs management events in AWS, you can use the Boto3 library in Python. Here are the steps to prevent the misconfiguration where CloudTrail does not log management events:

1. **Install Boto3 Library**:
   Ensure you have the Boto3 library installed. If not, you can install it using pip.
   ```bash
   pip install boto3
   ```

2. **Create a Boto3 Session**:
   Initialize a Boto3 session with the necessary AWS credentials and region.

   ```python
   import boto3

   session = boto3.Session(
       aws_access_key_id='YOUR_ACCESS_KEY',
       aws_secret_access_key='YOUR_SECRET_KEY',
       region_name='YOUR_REGION'
   )
   ```

3. **Check and Enable Management Event Logging**:
   Use the `describe_trails` and `update_trail` methods to ensure that management events are being logged.

   ```python
   cloudtrail_client = session.client('cloudtrail')

   # Describe existing trails
   trails = cloudtrail_client.describe_trails()['trailList']

   for trail in trails:
       trail_name = trail['Name']
       trail_status = cloudtrail_client.get_trail_status(Name=trail_name)
       
       # Check if management events are being logged
       if not trail.get('IncludeManagementEvents', True):
           # Update the trail to include management events
           cloudtrail_client.update_trail(
               Name=trail_name,
               IncludeManagementEvents=True
           )
           print(f"Enabled management event logging for trail: {trail_name}")
       else:
           print(f"Management event logging already enabled for trail: {trail_name}")
   ```

4. **Verify the Configuration**:
   After updating the trails, you can verify the configuration to ensure that management events are being logged.

   ```python
   for trail in trails:
       trail_name = trail['Name']
       trail_details = cloudtrail_client.describe_trails(trailNameList=[trail_name])['trailList'][0]
       
       if trail_details.get('IncludeManagementEvents', True):
           print(f"Management events are being logged for trail: {trail_name}")
       else:
           print(f"Management events are NOT being logged for trail: {trail_name}")
   ```

By following these steps, you can ensure that CloudTrail is configured to log management events, thereby preventing the misconfiguration.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Cause'>
### Check Cause
<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
1. Sign in to the AWS Management Console and open the CloudTrail console at https://console.aws.amazon.com/cloudtrail/.

2. In the navigation pane, click on "Trails". 

3. In the Trails page, select the trail that you want to check.

4. In the details pane, under "CloudWatch Logs", check if "Log events" is enabled. If it is enabled, it means that CloudTrail is logging management events. If it is not enabled, it means that CloudTrail is not logging management events, indicating a misconfiguration.
</Accordion>

<Accordion title='Using CLI'>
1. Install and configure AWS CLI: Before you can start using AWS CLI, you need to install it on your local machine and configure it with your AWS account credentials. You can do this by running the following commands:

   Installation:
   ```
   pip install awscli
   ```
   Configuration:
   ```
   aws configure
   ```
   You will be prompted to provide your AWS Access Key ID, Secret Access Key, Default region name, and Default output format.

2. List all CloudTrail trails: Use the following AWS CLI command to list all the AWS CloudTrail trails in your account:

   ```
   aws cloudtrail describe-trails
   ```
   This command will return a JSON output with the details of all the trails.

3. Check if CloudTrail is logging management events: For each trail, check the "IncludeManagementEvents" field in the JSON output. If the value of this field is "true", then CloudTrail is logging management events. If the value is "false", then it is not logging management events.

   ```
   aws cloudtrail get-event-selectors --trail-name {trailName}
   ```
   Replace {trailName} with the name of your trail. Look for the "IncludeManagementEvents" field in the output.

4. Repeat step 3 for all trails: You need to repeat the above step for all the trails in your AWS account to ensure that all of them are logging management events.
</Accordion>

<Accordion title='Using Python'>
1. Install the necessary Python libraries: Before you can start writing Python scripts to interact with AWS, you need to install the Boto3 library, which is the Amazon Web Services (AWS) Software Development Kit (SDK) for Python.

```python
pip install boto3
```

2. Configure your AWS credentials: You can configure your credentials in several ways, but the simplest is to use the AWS CLI. Run `aws configure` and then enter your access key, secret access key, and default region when prompted.

3. Write a Python script to check CloudTrail configuration: You can use the Boto3 library to interact with AWS services, including CloudTrail. Here's a simple script that lists all trails and checks if management events are logged:

```python
import boto3

def check_cloudtrail_management_events():
    client = boto3.client('cloudtrail')
    response = client.describe_trails()

    for trail in response['trailList']:
        if 'IsLogging' in trail and trail['IsLogging']:
            print(f"Trail {trail['Name']} is logging management events.")
        else:
            print(f"Trail {trail['Name']} is not logging management events.")

check_cloudtrail_management_events()
```

4. Run the script: You can run the script using any Python interpreter. The script will print out the names of all trails and whether they are logging management events. If a trail is not logging management events, this could be a misconfiguration.

Please note that this script only checks if logging is enabled for each trail, not whether specific management events are being logged. You may need to modify the script to suit your specific needs.
</Accordion>

</AccordionGroup>
</Tab>

<Tab title='Remediation'>
### Remediation

<AccordionGroup>
<Accordion title='Using Console' defaultOpen='true'>
Sure, here are the step-by-step instructions to remediate the "CloudTrails Must Log Management Events" misconfiguration for AWS:

1. Open the AWS Management Console and navigate to the CloudTrail service.

2. Click on the Trails option in the left-hand menu.

3. Select the trail that you want to modify and click on the Edit button.

4. Scroll down to the Management events section.

5. Enable the Log management events toggle switch.

6. Choose the S3 bucket where you want to store the logs.

7. Select the SNS topic (optional) to receive notifications.

8. Click on the Save button to save the changes.

Once you complete these steps, CloudTrail will start logging management events to the specified S3 bucket. This will help you to monitor and track all the changes made to your AWS account, including changes made to IAM users, roles, policies, security groups, and more.

#
</Accordion>

<Accordion title='Using CLI'>
To remediate the "CloudTrails Must Log Management Events" misconfiguration in AWS using AWS CLI, follow the below steps:

1. Open the AWS CLI on your local machine or EC2 instance.
2. Run the following command to check if CloudTrail is enabled:

```
aws cloudtrail describe-trails
```

3. If CloudTrail is not enabled, run the following command to create a new trail:

```
aws cloudtrail create-trail --name <trail-name> --s3-bucket-name <bucket-name> --is-multi-region-trail --include-global-service-events
```

Replace `<trail-name>` with the name of the trail you want to create and `<bucket-name>` with the name of the S3 bucket where you want to store your CloudTrail logs.

4. If CloudTrail is already enabled, run the following command to update the trail to log management events:

```
aws cloudtrail update-trail --name <trail-name> --enable-log-file-validation --include-global-service-events --is-multi-region-trail --is-organization-trail
```

Replace `<trail-name>` with the name of the trail you want to update.

5. Verify that management events are being logged by running the following command:

```
aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=CreateTrail
```

This command will return a list of events related to creating a trail, which confirms that management events are being logged.

By following these steps, you will successfully remediate the "CloudTrails Must Log Management Events" misconfiguration in AWS using AWS CLI.
</Accordion>

<Accordion title='Using Python'>
To remediate the "CloudTrails must log management events" misconfiguration in AWS, you can use the following Python code:

1. First, you need to enable CloudTrail in your AWS account if it is not already enabled. You can do this by using the following Python code:

```
import boto3

# Create a CloudTrail client
cloudtrail = boto3.client('cloudtrail')

# Create a trail
response = cloudtrail.create_trail(
    Name='my-trail',
    S3BucketName='my-bucket',
    IsMultiRegionTrail=True,
    IncludeGlobalServiceEvents=True,
)

# Enable the trail
cloudtrail.start_logging(Name='my-trail')
```

Replace `my-trail` with the name of your CloudTrail trail and `my-bucket` with the name of your S3 bucket where you want to store the logs.

2. Once you have enabled CloudTrail, you need to ensure that it is logging management events. You can do this by using the following Python code:

```
import boto3

# Create a CloudTrail client
cloudtrail = boto3.client('cloudtrail')

# Get the current trail configuration
response = cloudtrail.get_trail_status(Name='my-trail')

# Check if management events are being logged
if not response['IsLogging']:
    print('Management events are not being logged')
    # Update the trail to log management events
    response = cloudtrail.update_trail(
        Name='my-trail',
        IncludeGlobalServiceEvents=True,
    )
    # Start logging
    cloudtrail.start_logging(Name='my-trail')
    print('Management events are now being logged')
else:
    print('Management events are being logged')
```

This code will check if management events are being logged in your CloudTrail trail. If they are not being logged, it will update the trail configuration to include management events and start logging them.

Note: Make sure that you have appropriate permissions to create and update CloudTrail trails and to start and stop logging.
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>
### Additional Reading:

- [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-management-events-with-cloudtrail.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-management-events-with-cloudtrail.html) 

