--- 
slug: DeleteStack
eventname: DeleteStack
title: DeleteStack
sidebar_label: DeleteStack
---
                       
### Event Information

- The DeleteStack event in AWS CloudFormation refers to the process of deleting a stack that was previously created using CloudFormation.
- When this event occurs, it indicates that the stack and all its associated resources are being deleted from the AWS environment.
- The DeleteStack event is triggered either manually by a user or programmatically through an API call, and it initiates the cleanup process of all resources provisioned by the stack.


### Examples

1. Unauthorized deletion: If proper access controls and permissions are not in place, an unauthorized user may be able to delete a CloudFormation stack, leading to potential data loss or service disruption. It is important to ensure that only authorized individuals or processes have the necessary permissions to delete stacks.

2. Data exposure: When a CloudFormation stack is deleted, all associated resources, including storage buckets, databases, and virtual machines, may also be deleted. If sensitive data is not properly backed up or migrated before the stack deletion, there is a risk of data exposure or loss.

3. Service interruption: Deleting a CloudFormation stack can result in the termination of running instances or services. If proper planning and coordination are not in place, this can lead to service interruptions or downtime for applications or systems relying on those resources. It is crucial to have a well-defined rollback or recovery plan to minimize the impact on users or customers.

### Remediation

#### Using Console

1. Unauthorized deletion: To remediate unauthorized deletion in AWS CloudFormation using the AWS console, follow these steps:

- Step 1: Implement proper access controls and permissions: Ensure that only authorized users have the necessary permissions to delete CloudFormation stacks. This can be achieved by using AWS Identity and Access Management (IAM) to create IAM policies and roles that restrict the delete stack action to specific users or groups.

- Step 2: Enable stack termination protection: Enable stack termination protection for critical CloudFormation stacks. This feature prevents accidental or unauthorized deletion of stacks by requiring an additional step to disable termination protection before deletion.

- Step 3: Regularly review and audit permissions: Regularly review and audit the permissions assigned to users and groups within your AWS account. Remove any unnecessary or excessive permissions to minimize the risk of unauthorized deletion.

2. Data exposure: To remediate data exposure in AWS CloudFormation using the AWS console, follow these steps:

- Step 1: Implement data protection measures: Ensure that sensitive data within the CloudFormation stack is properly protected and encrypted. This can be achieved by using AWS Key Management Service (KMS) to encrypt sensitive data at rest and in transit.

- Step 2: Implement secure access controls: Restrict access to the CloudFormation stack and associated resources to only authorized users or roles. Utilize IAM policies and roles to enforce fine-grained access controls and limit exposure of sensitive data.

- Step 3: Regularly review and update security configurations: Regularly review and update the security configurations of your CloudFormation stack to ensure that sensitive data is adequately protected. This includes reviewing security groups, network ACLs, and encryption settings.

3. Resource leakage: To remediate resource leakage in AWS CloudFormation using the AWS console, follow these steps:

- Step 1: Configure stack deletion policies: Configure CloudFormation stack deletion policies to ensure that all associated resources are properly cleaned up upon stack deletion. This can be done by specifying deletion policies for each resource in the stack template.

- Step 2: Regularly monitor and clean up unused resources: Regularly monitor your CloudFormation stacks and associated resources to identify any unused or orphaned resources. Use AWS CloudTrail and AWS Config to track resource usage and identify potential resource leakage.

- Step 3: Implement automated resource cleanup: Implement automated resource cleanup mechanisms, such as AWS Lambda functions or AWS CloudFormation StackSets, to automatically clean up unused resources when a stack is deleted. This helps prevent resource leakage and reduces unnecessary costs.

#### Using CLI

1. Unauthorized deletion: To remediate unauthorized deletion in AWS CloudFormation, you can implement the following steps using AWS CLI commands:

- Enable AWS CloudTrail: Enable CloudTrail to capture all API calls made to CloudFormation. This will provide an audit trail of any stack deletions and help identify unauthorized actions. Use the following command to enable CloudTrail:

  ```
  aws cloudtrail create-trail --name <trail-name> --s3-bucket-name <bucket-name> --is-multi-region-trail
  ```

- Implement IAM Policies: Ensure that proper access controls and permissions are in place to restrict unauthorized users from deleting CloudFormation stacks. Create and attach IAM policies to the relevant IAM users, groups, or roles. Use the following command to create an IAM policy:

  ```
  aws iam create-policy --policy-name <policy-name> --policy-document file://<policy-document.json>
  ```

- Enable Stack Termination Protection: Enable stack termination protection to prevent accidental or unauthorized stack deletions. This can be done by adding the `--enable-termination-protection` flag while creating or updating the stack using the `create-stack` or `update-stack` command.

2. Data exposure: To remediate data exposure in AWS CloudFormation, you can take the following steps:

- Implement Encryption: Ensure that sensitive data within the CloudFormation stack is properly protected or encrypted. Utilize AWS Key Management Service (KMS) to encrypt sensitive data at rest or in transit. Use the following command to create a KMS key:

  ```
  aws kms create-key --description <key-description>
  ```

- Use Secure Parameter Storage: Store sensitive parameters, such as passwords or API keys, in AWS Systems Manager Parameter Store. This provides a secure and centralized location for managing and retrieving sensitive data. Use the following command to store a parameter:

  ```
  aws ssm put-parameter --name <parameter-name> --value <parameter-value> --type SecureString
  ```

- Implement Network Security: Ensure that proper network security measures, such as security groups and network ACLs, are in place to restrict access to sensitive data within the CloudFormation stack. Use the appropriate AWS CLI commands to configure and manage network security.

3. Resource leakage: To remediate resource leakage in AWS CloudFormation, you can follow these steps:

- Implement Stack Policies: Use stack policies to control the deletion of resources within a CloudFormation stack. By defining a stack policy, you can prevent certain resources from being deleted accidentally or intentionally. Use the following command to create a stack policy:

  ```
  aws cloudformation set-stack-policy --stack-name <stack-name> --stack-policy-body file://<stack-policy.json>
  ```

- Enable Stack Termination Protection: As mentioned earlier, enabling stack termination protection prevents accidental or unauthorized stack deletions. Ensure that stack termination protection is enabled for all CloudFormation stacks using the `--enable-termination-protection` flag.

- Regularly Review and Clean Up: Regularly review and clean up unused or unnecessary resources associated with CloudFormation stacks. Use AWS CLI commands to identify and delete unused resources, ensuring that all resources are properly cleaned up upon stack deletion.

#### Using Python

1. Unauthorized deletion: To remediate unauthorized deletion in AWS CloudFormation using Python scripts, you can implement the following steps:
   - Use AWS Identity and Access Management (IAM) to enforce proper access controls and permissions. Create IAM policies that only allow authorized users to delete CloudFormation stacks.
   - Use the AWS SDK for Python (Boto3) to programmatically manage CloudFormation stacks. You can write a Python script that checks the user's credentials and permissions before allowing them to delete a stack. This script can validate the user's identity and ensure they have the necessary permissions before executing the deletion operation.

2. Data exposure: To remediate data exposure in AWS CloudFormation using Python scripts, you can take the following actions:
   - Ensure that sensitive data within the CloudFormation stack is properly protected and encrypted. You can use AWS Key Management Service (KMS) to encrypt sensitive data and manage encryption keys.
   - Write a Python script that validates the stack's configuration and checks for any unencrypted sensitive data. The script can scan the stack's resources and identify any potential data exposure risks. It can also enforce encryption requirements and automatically encrypt any sensitive data found within the stack.

3. Resource leakage: To remediate resource leakage in AWS CloudFormation using Python scripts, consider the following steps:
   - Configure your CloudFormation stack to clean up all associated resources upon deletion. Use the "DeletionPolicy" attribute in your CloudFormation template to specify the desired behavior for each resource when the stack is deleted.
   - Write a Python script that analyzes the CloudFormation stack's resources and identifies any resources that do not have proper deletion policies set. The script can then update the stack's template to include the necessary deletion policies or automatically delete the resources that are not properly cleaned up.


 