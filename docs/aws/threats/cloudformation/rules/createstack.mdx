--- 
slug: CreateStack
eventname: CreateStack
title: CreateStack
sidebar_label: CreateStack
---
                       
### Event Information

- The CreateStack event in AWS CloudFormation refers to the process of creating a new stack, which is a collection of AWS resources defined in a CloudFormation template.
- This event signifies the start of the stack creation process, where CloudFormation provisions and configures the specified resources according to the template.
- The CreateStack event provides information about the stack name, template URL or S3 location, parameters, and other details required for the stack creation.


### Examples

1. Insecure parameter values: When creating a CloudFormation stack in AWS, it is important to ensure that sensitive information such as passwords, access keys, or database connection strings are not exposed in plain text. If these values are not properly encrypted or protected, it can lead to a security breach.

2. Insufficient IAM permissions: When creating a CloudFormation stack, it is crucial to define the appropriate IAM (Identity and Access Management) permissions for the stack resources. If the permissions are not properly configured, it can result in unauthorized access to resources or potential privilege escalation.

3. Lack of network security controls: CloudFormation allows you to define networking resources such as VPCs, subnets, and security groups. If these network security controls are not properly configured, it can leave your stack vulnerable to network-based attacks, unauthorized access, or data exfiltration. It is important to implement proper security groups, network ACLs, and network segmentation to mitigate these risks.

### Remediation

#### Using Console

To remediate insecure parameter values in AWS CloudFormation using the AWS console, follow these steps:

1. Encrypt sensitive information: Ensure that sensitive information such as passwords or access keys are properly encrypted. You can use AWS Key Management Service (KMS) to encrypt the parameter values. 

2. Store sensitive information securely: Instead of passing sensitive information as plain text in the CloudFormation template or as parameters, store them securely in AWS Secrets Manager or AWS Systems Manager Parameter Store. These services provide secure storage and management of sensitive data.

3. Update CloudFormation template: Modify your CloudFormation template to reference the encrypted parameter values or the stored secrets from AWS Secrets Manager or AWS Systems Manager Parameter Store. Replace the plain text values with the appropriate references to the encrypted values or stored secrets.

By following these steps, you can ensure that sensitive information is properly encrypted and stored securely, reducing the risk of security breaches in your CloudFormation stacks.

#### Using CLI

To remediate insecure parameter values in AWS CloudFormation using AWS CLI commands, you can follow these steps:

1. Encrypt sensitive information: Ensure that sensitive information such as passwords or access keys are properly encrypted before passing them as parameters in the CloudFormation template. You can use AWS Key Management Service (KMS) to encrypt the values. Here's an example command to encrypt a value using AWS CLI:

   ```
   aws kms encrypt --key-id <kms-key-id> --plaintext <sensitive-value> --output text --query CiphertextBlob
   ```

   Replace `<kms-key-id>` with the ID of the KMS key you want to use and `<sensitive-value>` with the actual sensitive value.

2. Store sensitive information securely: Instead of passing sensitive information directly in the CloudFormation template or as parameters, it is recommended to store them securely in AWS Secrets Manager or AWS Systems Manager Parameter Store. You can use the following AWS CLI commands to store and retrieve values from these services:

   - AWS Secrets Manager:
     - Store a secret value:
       ```
       aws secretsmanager create-secret --name <secret-name> --secret-string <sensitive-value>
       ```
     - Retrieve a secret value:
       ```
       aws secretsmanager get-secret-value --secret-id <secret-name> --query SecretString --output text
       ```

   - AWS Systems Manager Parameter Store:
     - Store a parameter value:
       ```
       aws ssm put-parameter --name <parameter-name> --value <sensitive-value> --type SecureString
       ```
     - Retrieve a parameter value:
       ```
       aws ssm get-parameter --name <parameter-name> --query Parameter.Value --output text
       ```

   Replace `<secret-name>` or `<parameter-name>` with the desired name for the secret or parameter, and `<sensitive-value>` with the actual sensitive value.

3. Update CloudFormation template: Modify your CloudFormation template to reference the encrypted values stored in AWS Secrets Manager or AWS Systems Manager Parameter Store instead of passing them directly. You can use the `Fn::ImportValue` or `Fn::Sub` functions in the template to retrieve the values. Here's an example:

   ```
   Parameters:
     MySecretParameter:
       Type: String
       Default: !ImportValue MySecretParameterExportName

   Resources:
     MyResource:
       Type: AWS::SomeResourceType
       Properties:
         SecretValue: !Sub '{{resolve:ssm-secure:${MySecretParameter}}}'
   ```

   Replace `MySecretParameterExportName` with the name of the exported value from AWS Secrets Manager or AWS Systems Manager Parameter Store.

#### Using Python

To remediate insecure parameter values in AWS CloudFormation using Python scripts, you can follow these steps:

1. Encrypt sensitive information: Instead of passing sensitive information as plain text in the CloudFormation template or as parameters, you can encrypt them using AWS Key Management Service (KMS). You can use the `boto3` library in Python to interact with KMS and encrypt the sensitive values before passing them to CloudFormation.

```python
import boto3

def encrypt_value(value):
    kms_client = boto3.client('kms')
    response = kms_client.encrypt(
        KeyId='your_kms_key_id',
        Plaintext=value
    )
    return response['CiphertextBlob']
```

2. Store sensitive information in AWS Secrets Manager or AWS Systems Manager Parameter Store: Instead of passing sensitive information directly in the CloudFormation template, you can store them securely in AWS Secrets Manager or AWS Systems Manager Parameter Store. You can use the `boto3` library in Python to interact with these services and retrieve the values during stack creation.

```python
import boto3

def get_secret_value(secret_name):
    secrets_manager_client = boto3.client('secretsmanager')
    response = secrets_manager_client.get_secret_value(
        SecretId=secret_name
    )
    return response['SecretString']
```

3. Update CloudFormation template and parameter files: Modify your CloudFormation template and parameter files to reference the encrypted values or retrieve sensitive information from AWS Secrets Manager or AWS Systems Manager Parameter Store. Make sure to update the template and parameter files in your deployment pipeline or version control system.

Note: The provided Python code snippets are simplified examples and may require additional error handling and customization based on your specific use case.


 