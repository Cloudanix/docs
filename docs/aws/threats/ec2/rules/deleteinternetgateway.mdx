--- 
slug: DeleteInternetGateway
eventname: DeleteInternetGateway
title: DeleteInternetGateway
sidebar_label: DeleteInternetGateway
---
                       
### Event Information

- The DeleteInternetGateway event in AWS for EC2 refers to the action of removing an internet gateway from a virtual private cloud (VPC) in the AWS environment.
- This event signifies that the internet gateway, which acts as a connection point between the VPC and the internet, has been deleted and is no longer available for routing traffic.
- Deleting an internet gateway effectively cuts off the VPC from the internet, and any resources within the VPC will no longer have outbound internet connectivity unless an alternative internet gateway is attached.


### Examples

- Unauthorized deletion of an internet gateway can lead to a loss of connectivity for EC2 instances, as they will no longer have access to the internet.
- Deleting an internet gateway without proper authorization can result in a potential security breach, as it may allow unauthorized access to the VPC from external networks.
- In a multi-account environment, accidental deletion of an internet gateway can impact the security of other accounts that rely on the connectivity provided by the gateway. This can disrupt inter-account communication and compromise the overall security posture.

### Remediation

#### Using Console

1. Identify the unauthorized deletion: 
   - Monitor the CloudTrail logs to identify any unauthorized API calls related to the deletion of the internet gateway.
   - Look for any unusual or unexpected activities in the VPC flow logs that indicate the loss of connectivity.

2. Restore the internet gateway:
   - Access the AWS Management Console and navigate to the VPC service.
   - Select the VPC where the internet gateway was deleted.
   - Click on "Actions" and choose "Create Internet Gateway".
   - Attach the newly created internet gateway to the VPC by selecting the VPC and clicking on "Actions" and then "Attach to VPC".
   - Update the route tables associated with the VPC to ensure proper routing to the internet gateway.

3. Investigate and mitigate the root cause:
   - Review the IAM policies and user permissions to identify any misconfigurations or unauthorized access.
   - Implement least privilege access control by granting only necessary permissions to users or roles.
   - Enable MFA (Multi-Factor Authentication) for critical actions like deleting internet gateways to prevent unauthorized deletions.
   - Regularly review and rotate access keys to minimize the risk of compromised credentials.

Note: It is recommended to automate the monitoring and alerting of critical actions like internet gateway deletion using AWS CloudWatch Events and AWS Lambda functions to proactively detect and respond to such incidents.

#### Using CLI

To remediate the unauthorized deletion of an internet gateway in AWS EC2, you can follow these steps using AWS CLI commands:

1. Enable AWS CloudTrail: Enable CloudTrail to capture API activity and log events related to the internet gateway. This will help in identifying the unauthorized deletion and provide necessary audit trails for investigation.

2. Implement IAM Policies: Ensure that proper IAM policies are in place to restrict access to the internet gateway. Only authorized users or roles should have the necessary permissions to modify or delete the internet gateway.

3. Enable MFA Delete: Enable Multi-Factor Authentication (MFA) Delete on the internet gateway. This adds an extra layer of security by requiring an additional authentication factor (such as a physical token or virtual MFA device) to delete the internet gateway.

CLI Commands:
- To enable CloudTrail: `aws cloudtrail create-trail --name <trail-name> --s3-bucket-name <bucket-name> --is-multi-region-trail`
- To create an IAM policy: `aws iam create-policy --policy-name <policy-name> --policy-document file://policy.json`
- To attach the IAM policy to a user or role: `aws iam attach-user-policy --user-name <user-name> --policy-arn <policy-arn>`
- To enable MFA Delete: `aws ec2 modify-internet-gateway-attribute --internet-gateway-id <gateway-id> --enable-mfa-delete`

#### Using Python

To remediate the unauthorized deletion of an internet gateway in AWS EC2, you can follow these steps:

1. Implement IAM Policies: Ensure that proper IAM policies are in place to control access to the internet gateway. Only authorized users or roles should have the permission to delete or modify the internet gateway.

2. Enable CloudTrail: Enable AWS CloudTrail to capture all API calls related to the internet gateway. This will help in identifying any unauthorized deletion attempts and provide an audit trail for investigation.

3. Implement Automation with Python: You can use the AWS SDK for Python (Boto3) to automate the remediation process. Here's an example Python script that can be used to detect and restore a deleted internet gateway:

```python
import boto3

def restore_internet_gateway(vpc_id):
    ec2_client = boto3.client('ec2')
    
    # Describe VPCs to check if internet gateway is missing
    response = ec2_client.describe_vpcs(VpcIds=[vpc_id])
    vpc = response['Vpcs'][0]
    
    # Check if internet gateway is missing
    if 'InternetGatewayId' not in vpc:
        # Create a new internet gateway
        response = ec2_client.create_internet_gateway()
        internet_gateway_id = response['InternetGateway']['InternetGatewayId']
        
        # Attach the internet gateway to the VPC
        ec2_client.attach_internet_gateway(VpcId=vpc_id, InternetGatewayId=internet_gateway_id)
        
        print(f"Restored internet gateway {internet_gateway_id} for VPC {vpc_id}")
    else:
        print(f"Internet gateway already exists for VPC {vpc_id}")

# Usage example
vpc_id = 'your-vpc-id'
restore_internet_gateway(vpc_id)
```

This script checks if the internet gateway is missing for a given VPC. If it is missing, it creates a new internet gateway and attaches it to the VPC. Otherwise, it prints a message indicating that the internet gateway already exists.

Note: Make sure you have the necessary permissions and configure the AWS credentials for the Python script to work correctly.


 