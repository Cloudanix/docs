--- 
slug: DeleteInternetGateway
eventname: DeleteInternetGateway
title: DeleteInternetGateway
sidebar_label: DeleteInternetGateway
---
                       
### Event Information

#### Meaning

- The DeleteInternetGateway event in AWS for EC2 refers to the action of removing an internet gateway from a virtual private cloud (VPC) in the AWS environment.
- This event signifies that the internet gateway, which acts as a connection point between the VPC and the internet, has been deleted and is no longer available for routing traffic.
- Deleting an internet gateway effectively cuts off the VPC from the internet, and any resources within the VPC will no longer have outbound internet connectivity unless an alternative gateway is attached.

### Remediation

#### Using Console

- Example: If security is impacted with DeleteInternetGateway in AWS for EC2, it could potentially result in the loss of internet connectivity for the affected EC2 instances. This can lead to disruption of services and potential security vulnerabilities.

- Remediation Steps using AWS Console:
  1. Login to the AWS Management Console.
  2. Navigate to the EC2 service.
  3. Select the VPC (Virtual Private Cloud) where the impacted EC2 instances are located.
  4. In the left navigation pane, click on "Internet Gateways".
  5. Identify the Internet Gateway that was mistakenly deleted.
  6. Click on the "Actions" button and select "Create Internet Gateway".
  7. Give the new Internet Gateway a meaningful name and click on "Create".
  8. Once the Internet Gateway is created, select it and click on "Attach to VPC".
  9. Choose the VPC where the impacted EC2 instances are located and click on "Attach".
  10. Finally, select the affected EC2 instances and associate them with the newly created Internet Gateway by modifying their route tables.

Note: It is important to regularly backup and document the configuration of your VPC and EC2 instances to ensure quick recovery in case of accidental deletions or security incidents.

#### Using CLI

- Example of security impact: If an attacker gains unauthorized access to an EC2 instance and executes the `DeleteInternetGateway` command, it can result in the deletion of the internet gateway associated with the VPC. This can disrupt the network connectivity of the EC2 instance and potentially impact the availability of services running on it.

- Remediation steps using AWS CLI:
  1. Enable VPC Flow Logs: Enable VPC Flow Logs to capture network traffic information, including the source and destination IP addresses, ports, and protocols. This helps in monitoring and detecting any unauthorized access attempts or unusual network activity.
    ```
    aws ec2 create-flow-logs --resource-type VPC --resource-ids <vpc-id> --traffic-type ALL --log-group-name <log-group-name> --deliver-logs-permission-arn <permission-arn>
    ```

  2. Implement Security Groups: Configure appropriate security groups for EC2 instances to control inbound and outbound traffic. Restrict access to only necessary ports and protocols, and regularly review and update security group rules to align with the least privilege principle.
    ```
    aws ec2 create-security-group --group-name <security-group-name> --description <description> --vpc-id <vpc-id>
    aws ec2 authorize-security-group-ingress --group-id <security-group-id> --protocol <protocol> --port <port> --source <source-ip>
    ```

  3. Implement IAM Roles and Policies: Assign IAM roles to EC2 instances with the principle of least privilege. Create and attach IAM policies that define the necessary permissions for EC2 instances to interact with other AWS services.
    ```
    aws iam create-role --role-name <role-name> --assume-role-policy-document <trust-policy-document>
    aws iam attach-role-policy --role-name <role-name> --policy-arn <policy-arn>
    aws ec2 associate-iam-instance-profile --instance-id <instance-id> --iam-instance-profile Name=<instance-profile-name>
    ```

Note: The provided commands are placeholders and should be replaced with actual values specific to your environment.

#### Using Python

- Example: If security is impacted with DeleteInternetGateway in AWS for EC2, an example scenario could be an unauthorized user gaining access to the AWS EC2 instance and deleting the internet gateway. This action would result in the EC2 instance losing its connectivity to the internet, potentially disrupting critical services or applications running on the instance.

- Remediation: To remediate this issue for AWS EC2 using Python, you can implement the following steps:

1. Implement IAM Policies: Ensure that proper IAM policies are in place to restrict access to the DeleteInternetGateway action. Only authorized users or roles should have the necessary permissions to perform this action.

2. Enable CloudTrail: Enable AWS CloudTrail to capture all API calls made within your AWS account. This will help in auditing and monitoring any unauthorized or suspicious activities, including the deletion of internet gateways.

3. Implement Automation with Python: You can use the AWS SDK for Python (Boto3) to automate the remediation process. Below is an example Python script that can be used to restore the internet gateway if it is deleted:

```python
import boto3

def restore_internet_gateway(vpc_id):
    ec2_client = boto3.client('ec2')
    
    # Describe the deleted internet gateways
    response = ec2_client.describe_internet_gateways(
        Filters=[
            {
                'Name': 'attachment.vpc-id',
                'Values': [vpc_id]
            },
            {
                'Name': 'state',
                'Values': ['detached']
            }
        ]
    )
    
    # Restore the internet gateway if any deleted gateways are found
    for igw in response['InternetGateways']:
        igw_id = igw['InternetGatewayId']
        
        # Create a new internet gateway
        new_igw = ec2_client.create_internet_gateway()
        new_igw_id = new_igw['InternetGateway']['InternetGatewayId']
        
        # Attach the new internet gateway to the VPC
        ec2_client.attach_internet_gateway(
            InternetGatewayId=new_igw_id,
            VpcId=vpc_id
        )
        
        # Delete the old internet gateway
        ec2_client.delete_internet_gateway(
            InternetGatewayId=igw_id
        )
        
        print(f"Restored internet gateway {new_igw_id} and deleted {igw_id}")

# Usage example
vpc_id = 'your-vpc-id'
restore_internet_gateway(vpc_id)
```

This script uses Boto3 to describe the deleted internet gateways in the specified VPC, creates a new internet gateway, attaches it to the VPC, and then deletes the old internet gateway. The script also provides feedback on the actions performed.


 