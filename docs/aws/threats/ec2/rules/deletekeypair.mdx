--- 
slug: DeleteKeyPair
eventname: DeleteKeyPair
title: DeleteKeyPair
sidebar_label: DeleteKeyPair
---
                       
### Event Information

- The DeleteKeyPair event in AWS for EC2 refers to the action of deleting a key pair that is used for secure login to EC2 instances.
- When this event occurs, it means that the specified key pair is no longer available for use and cannot be used to authenticate and access EC2 instances.
- It is important to note that deleting a key pair does not affect the running instances that were launched using that key pair. However, it will prevent any new instances from being launched with that key pair.


### Examples

1. Unauthorized access: If an attacker gains access to the AWS account and deletes a key pair associated with an EC2 instance, they can effectively lock out legitimate users from accessing the instance. This can lead to a potential security breach and unauthorized access to sensitive data or resources.

2. Data loss: Deleting a key pair associated with an EC2 instance can result in the loss of encrypted data stored on the instance. If the instance relies on the key pair for encryption or decryption of data, deleting the key pair can render the data inaccessible and potentially lead to data loss.

3. Service disruption: Deleting a key pair can disrupt the normal operation of an EC2 instance. If the instance relies on the key pair for authentication or authorization, deleting it can prevent legitimate users from accessing the instance or performing necessary tasks. This can result in service disruption and impact the availability of the application or service running on the instance.

### Remediation

#### Using Console

To remediate unauthorized deletion of a key pair associated with an EC2 instance in AWS, you can follow these steps using the AWS Management Console:

1. Identify the affected EC2 instance: Determine the instance for which the key pair has been deleted. This can be done by checking the EC2 instances in your AWS account.

2. Create a new key pair: Generate a new key pair using the AWS Management Console. Go to the EC2 service, select "Key Pairs" from the left-hand menu, and click on "Create Key Pair". Provide a name for the key pair and download the private key file (.pem).

3. Associate the new key pair with the instance: Once the new key pair is created, select the affected EC2 instance in the AWS Management Console. Right-click on the instance and choose "Instance Settings" > "Get System Log". This will open a new window with the system log.

In the system log, you will find the instance ID and the public IP address. Connect to the instance using an existing key pair or any other method you have available. Once connected, update the SSH authorized keys file with the new public key from the newly created key pair. Save the changes and exit the instance.

By following these steps, you will be able to remediate the unauthorized deletion of a key pair associated with an EC2 instance in AWS and regain access to the instance.

#### Using CLI

To remediate unauthorized deletion of a key pair in AWS EC2, you can follow these steps:

- Regularly backup key pairs: Create and maintain backups of key pairs associated with your EC2 instances. This ensures that even if a key pair is deleted, you can still access your instances using a backup key pair.

- Enable multi-factor authentication (MFA): Enable MFA for your AWS account to add an extra layer of security. This will require users to provide an additional authentication factor, such as a physical token or a virtual MFA app, in addition to their username and password. This helps prevent unauthorized access to the account and reduces the risk of key pair deletion.

- Implement least privilege access: Follow the principle of least privilege by granting only the necessary permissions to users and roles. Restrict access to key pair management and ensure that only authorized individuals can modify or delete key pairs.

To perform these actions using AWS CLI, you can use the following commands:

- To create a backup of a key pair:
```
aws ec2 create-key-pair --key-name <backup-key-name> --query 'KeyMaterial' --output text > <backup-key-file>.pem
```

- To enable MFA for an IAM user:
```
aws iam enable-mfa-device --user-name <user-name> --serial-number <mfa-serial-number> --authentication-code1 <code1> --authentication-code2 <code2>
```

- To restrict key pair management permissions:
```
aws iam attach-user-policy --user-name <user-name> --policy-arn <policy-arn>
```

Note: Replace the placeholders (<backup-key-name>, <backup-key-file>, <user-name>, <mfa-serial-number>, <code1>, <code2>, <policy-arn>) with the appropriate values specific to your environment.

#### Using Python

To remediate unauthorized deletion of key pairs in AWS EC2, you can follow these steps:

1. Regularly backup key pairs: Create a backup of your key pairs and securely store them in a separate location. This ensures that even if a key pair is deleted, you can still access your instances by using the backup key pair.

2. Enable multi-factor authentication (MFA): Enable MFA for your AWS account to add an extra layer of security. This will require users to provide an additional authentication factor, such as a physical token or a virtual MFA app, in addition to their username and password. This helps prevent unauthorized access to the account and reduces the risk of key pair deletion.

3. Implement least privilege access: Follow the principle of least privilege by granting only the necessary permissions to users and roles. Restrict access to key pair management and ensure that only authorized individuals can delete key pairs. Regularly review and audit the permissions assigned to users to minimize the risk of accidental or malicious key pair deletion.

Here's an example of a Python script that can be used to automate the backup of key pairs in AWS EC2:

```python
import boto3

def backup_key_pairs():
    ec2_client = boto3.client('ec2')

    response = ec2_client.describe_key_pairs()
    key_pairs = response['KeyPairs']

    for key_pair in key_pairs:
        key_name = key_pair['KeyName']
        key_material = key_pair['KeyMaterial']

        # Save the key material to a file
        with open(f'{key_name}.pem', 'w') as key_file:
            key_file.write(key_material)

        print(f"Key pair '{key_name}' backed up successfully.")

backup_key_pairs()
```

This script uses the Boto3 library to interact with the AWS EC2 service. It retrieves a list of all key pairs and saves the key material (private key) to a file with the same name as the key pair. You can schedule this script to run periodically to ensure regular backups of your key pairs.


 