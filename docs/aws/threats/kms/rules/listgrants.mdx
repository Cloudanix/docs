--- 
slug: ListGrants
eventname: ListGrants
title: ListGrants
sidebar_label: ListGrants
---
                       
### Event Information

#### Meaning

- The ListGrants event in AWS Key Management Service (KMS) refers to an action that lists the grants for a specified customer master key (CMK).
- This event is triggered when a user or application requests to view the grants associated with a particular CMK in AWS KMS.
- The ListGrants event provides visibility into the permissions and access control settings for the CMK, allowing administrators to monitor and audit the grants assigned to the key.

### Remediation

#### Using Console

- Example of security impact: If the ListGrants permission is misconfigured in AWS Key Management Service (KMS), it can allow unauthorized users to view and list all the grants associated with a KMS key. This can potentially expose sensitive information, such as the identities of users and roles that have access to the key.

- Remediation steps using AWS console:
  1. Sign in to the AWS Management Console and open the AWS KMS console.
  2. In the navigation pane, choose "Customer managed keys" or "AWS managed keys" depending on the type of key you want to remediate.
  3. Select the KMS key for which you want to remediate the ListGrants permission.
  4. In the "Key policy" section, click on the "Edit" button to modify the key policy.
  5. Locate the "Statement" that grants the ListGrants permission and remove or modify it as needed.
  6. Review the changes and click on the "Save changes" button to apply the updated key policy.
  7. Test the remediation by verifying that unauthorized users no longer have the ability to list grants for the KMS key.

Note: It is important to carefully review and test any changes made to the key policy to ensure that the desired security posture is achieved without impacting legitimate access to the KMS key.

#### Using CLI

- Example of security impact: If the ListGrants permission is misconfigured in AWS Key Management Service (KMS), it can allow unauthorized users to view and list all the grants associated with a KMS key. This can potentially expose sensitive information, such as the identities of users and roles that have access to the key.

- Remediation steps using AWS CLI:
  1. Identify the KMS key for which the ListGrants permission needs to be remediated.
  2. Revoke the ListGrants permission from the unauthorized users or roles by removing their respective IAM policies.
  3. Grant the ListGrants permission only to the authorized users or roles by adding the necessary IAM policies.

CLI commands:
- To revoke ListGrants permission from a user or role:
```
aws kms revoke-grant --key-id <KMS_KEY_ID> --grant-id <GRANT_ID>
```

- To grant ListGrants permission to a user or role:
```
aws kms create-grant --key-id <KMS_KEY_ID> --grantee-principal <GRANTEE_PRINCIPAL> --operations ListGrants
```

Note: Replace `<KMS_KEY_ID>` with the actual KMS key ID, `<GRANT_ID>` with the grant ID to be revoked, and `<GRANTEE_PRINCIPAL>` with the IAM user or role ARN to be granted the ListGrants permission.

#### Using Python

- Example of security impact: If the ListGrants operation in AWS Key Management Service (KMS) is misconfigured or misused, it can potentially expose sensitive information about the grants associated with a KMS key. This can lead to unauthorized access to encrypted data or compromise the confidentiality of the key management process.

- Remediation for AWS KMS using Python:
  1. Restrict IAM permissions: Ensure that only authorized users or roles have the necessary IAM permissions to perform the ListGrants operation. Limit the access to only those who require it for their specific tasks.
  
  ```python
  import boto3

  def restrict_list_grants_permissions(key_id, principal):
      kms_client = boto3.client('kms')
      response = kms_client.list_grants(KeyId=key_id)
      
      for grant in response['Grants']:
          if grant['GranteePrincipal'] == principal:
              kms_client.revoke_grant(KeyId=key_id, GrantId=grant['GrantId'])
  ```
  
  2. Enable CloudTrail logging: Enable AWS CloudTrail to capture all API calls made to KMS, including ListGrants. This will provide an audit trail and help in identifying any unauthorized or suspicious activities related to KMS key grants.
  
  ```python
  import boto3

  def enable_cloudtrail_logging():
      cloudtrail_client = boto3.client('cloudtrail')
      response = cloudtrail_client.update_trail(
          Name='your-trail-name',
          CloudWatchLogsLogGroupArn='your-log-group-arn',
          CloudWatchLogsRoleArn='your-log-role-arn',
          EnableLogFileValidation=True
      )
  ```
  
  3. Regularly review and monitor grants: Implement a process to regularly review and monitor the grants associated with KMS keys. This can be done using a combination of AWS CloudWatch Events, AWS Lambda, and Python scripts to detect any unexpected or unauthorized grants and take appropriate actions.
  
  ```python
  import boto3

  def monitor_grants(key_id):
      kms_client = boto3.client('kms')
      response = kms_client.list_grants(KeyId=key_id)
      
      for grant in response['Grants']:
          # Perform necessary checks and actions based on your requirements
          if grant['SomeCondition']:
              # Take appropriate actions
              pass
  ```


 