--- 
slug: UpdateSSHPublicKey
eventname: UpdateSSHPublicKey
title: UpdateSSHPublicKey
sidebar_label: UpdateSSHPublicKey
---
                       
### Event Information

- The UpdateSSHPublicKey event in AWS for IAM refers to an event that occurs when a user updates their SSH public key in their IAM user profile.
- This event is triggered when a user adds, modifies, or removes their SSH public key, which is used for SSH authentication to access EC2 instances.
- The event provides visibility into changes made to SSH public keys, allowing administrators to track and monitor user access to EC2 instances.


### Examples

1. Unauthorized access: If an attacker gains access to an IAM user's credentials and uses the UpdateSSHPublicKey API to add their own SSH public key, they can gain unauthorized access to the user's instances or resources.

2. Privilege escalation: If an IAM user with limited permissions is able to update their SSH public key, they may be able to escalate their privileges and gain access to resources or perform actions that they are not authorized to do.

3. Key rotation issues: If an IAM user updates their SSH public key without properly managing their old keys, it can lead to key rotation issues. For example, if an old key is not properly removed or deactivated, it can still be used for authentication, potentially allowing unauthorized access.

### Remediation

#### Using Console

1. Unauthorized access:
   - Immediately disable the compromised IAM user's access key or IAM user account.
   - Review the affected user's permissions and remove any unnecessary or excessive privileges.
   - Monitor the affected user's activity logs for any suspicious or unauthorized actions.

2. Privilege escalation:
   - Regularly review and audit IAM user permissions to ensure they are appropriate and aligned with the principle of least privilege.
   - Implement multi-factor authentication (MFA) for IAM users to add an extra layer of security.
   - Enable AWS CloudTrail to capture and analyze API activity, including SSH public key updates, for detecting any unauthorized changes.

3. Key rotation issues:
   - Implement a key rotation policy that enforces regular SSH key updates for IAM users.
   - Ensure that IAM users properly manage their old SSH keys by removing or deactivating them after updating to a new key.
   - Monitor SSH key activity logs to identify any instances where old keys are still being used and take appropriate action to revoke access.

#### Using CLI

1. Unauthorized access:
- Identify the compromised IAM user's credentials and disable or delete the user account immediately.
- Use the AWS CLI command `aws iam delete-ssh-public-key` to remove the unauthorized SSH public key associated with the compromised user.

2. Privilege escalation:
- Regularly review and monitor IAM user permissions to ensure they have the least privilege necessary.
- Use the AWS CLI command `aws iam update-ssh-public-key` to restrict the ability of IAM users to update their SSH public keys.

3. Key rotation issues:
- Implement a key rotation policy for IAM users to regularly update their SSH public keys.
- Use the AWS CLI command `aws iam delete-ssh-public-key` to remove old or unused SSH public keys from IAM user accounts.

#### Using Python

1. Unauthorized access:
- Regularly monitor IAM user activity and enable AWS CloudTrail to capture API calls made to the UpdateSSHPublicKey API.
- Implement multi-factor authentication (MFA) for IAM users to add an extra layer of security.
- Use AWS Identity and Access Management (IAM) policies to restrict access to the UpdateSSHPublicKey API to only authorized users or roles.

2. Privilege escalation:
- Implement least privilege principles by assigning IAM users the minimum permissions required to perform their tasks.
- Regularly review and audit IAM user permissions to identify any unauthorized changes.
- Enable AWS CloudTrail to capture API calls made to the UpdateSSHPublicKey API and monitor for any suspicious activity.

3. Key rotation issues:
- Implement a key rotation policy that enforces regular key updates and deactivates old keys.
- Use AWS Secrets Manager or AWS Key Management Service (KMS) to securely store and manage SSH keys.
- Automate the key rotation process using Python scripts that generate new SSH keys, update IAM user configurations, and deactivate old keys.


 