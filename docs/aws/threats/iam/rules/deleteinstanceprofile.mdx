--- 
slug: DeleteInstanceProfile
eventname: DeleteInstanceProfile
title: DeleteInstanceProfile
sidebar_label: DeleteInstanceProfile
---
                       
### Event Information

- The DeleteInstanceProfile event in AWS for IAM refers to the deletion of an instance profile. 
- An instance profile is a container for an IAM role that you can use to pass role information to an EC2 instance when the instance starts. 
- When the DeleteInstanceProfile event occurs, it means that the instance profile and its associated IAM role have been deleted, and any EC2 instances using that instance profile will no longer have access to the permissions granted by the role.


### Examples

- Unauthorized deletion of an instance profile can lead to potential security breaches as it may grant unintended access to resources. For example, if an attacker deletes an instance profile associated with an EC2 instance, they may be able to gain unauthorized access to sensitive data or perform malicious actions on the instance.

- Deleting an instance profile without proper authorization can disrupt the functioning of applications or services that rely on it. For instance, if an instance profile is deleted that is used by an application running on an EC2 instance to access other AWS services, the application may fail to authenticate and lose access to those services.

- Deleting an instance profile without proper documentation or communication can lead to confusion and potential security gaps. If the instance profile is being used by multiple resources or teams, deleting it without notifying the relevant stakeholders can result in unexpected access issues or misconfigurations, potentially compromising the security of the affected resources.

### Remediation

#### Using Console

1. Unauthorized deletion of an instance profile:
   - Identify the unauthorized deletion by reviewing AWS CloudTrail logs or monitoring alerts.
   - Immediately revoke any compromised credentials or access keys associated with the unauthorized user.
   - Restore the deleted instance profile from a backup or recreate it with the necessary permissions.
   - Update the affected EC2 instances to use the restored or newly created instance profile.

2. Removal of critical permissions:
   - Identify the impact by reviewing AWS CloudTrail logs or monitoring alerts.
   - Restore the deleted instance profile from a backup or recreate it with the critical permissions.
   - Update the affected resources and services to use the restored or newly created instance profile.
   - Conduct a thorough review of the affected AWS account's security settings and permissions to prevent similar incidents in the future.

3. Disruption of automated processes:
   - Identify the disruption by monitoring service health checks or reviewing application logs.
   - Restore the deleted instance profile from a backup or recreate it with the necessary permissions.
   - Update the affected automated processes, such as AWS Lambda functions or EC2 instances, to use the restored or newly created instance profile.
   - Implement safeguards, such as regular backups and restricted access controls, to prevent unauthorized deletion of instance profiles in the future.

#### Using CLI

1. To remediate unauthorized deletion of an instance profile in AWS IAM, you can follow these steps using AWS CLI commands:

- Identify the deleted instance profile by checking the CloudTrail logs or AWS Config history.
- Restore the deleted instance profile using the `create-instance-profile` command, providing the necessary details such as profile name.
- Attach the required IAM policies to the restored instance profile using the `add-role-to-instance-profile` command, ensuring the appropriate permissions are granted.
- Update the affected EC2 instances to use the restored instance profile by using the `modify-instance-attribute` command, specifying the instance ID and the restored profile ARN.

2. To remediate the removal of critical permissions from an instance profile in AWS IAM, you can take the following steps using AWS CLI commands:

- Identify the instance profile that had critical permissions removed by reviewing CloudTrail logs or AWS Config history.
- Restore the necessary permissions by attaching the missing IAM policies to the instance profile using the `put-role-policy` command, providing the policy document and the profile's role name.
- Verify the permissions have been restored by checking the IAM role's policies using the `list-role-policies` command.

3. To remediate the disruption of automated processes caused by the deletion of an instance profile in AWS IAM, you can perform the following steps using AWS CLI commands:

- Identify the automated processes affected by reviewing CloudTrail logs or AWS Config history.
- Restore the deleted instance profile using the `create-instance-profile` command, providing the necessary details such as profile name.
- Attach the required IAM policies to the restored instance profile using the `add-role-to-instance-profile` command, ensuring the appropriate permissions are granted.
- Update the affected AWS Lambda functions or EC2 instances to use the restored instance profile by using the `update-function-configuration` command for Lambda functions or the `modify-instance-attribute` command for EC2 instances, specifying the function/instance ID and the restored profile ARN.

#### Using Python

1. Unauthorized deletion of an instance profile can be remediated by implementing the following steps using Python scripts:

- Regularly monitor and audit IAM events using AWS CloudTrail to detect any unauthorized deletion of instance profiles.
- Create a Lambda function that triggers on CloudTrail events related to the DeleteInstanceProfile action.
- Configure the Lambda function to send a notification or alert to the appropriate stakeholders when an unauthorized deletion is detected.
- Implement IAM policies that restrict the DeleteInstanceProfile action to only authorized users or roles.
- Use AWS Config to continuously evaluate the compliance of IAM policies and detect any non-compliant configurations.
- Implement versioning for instance profiles to ensure that deleted profiles can be restored if necessary.

2. To remediate the removal of critical permissions from an instance profile, you can use the following Python scripts:

- Regularly backup the IAM policies associated with critical instance profiles using the AWS SDK for Python (Boto3).
- Implement versioning for IAM policies to track changes and easily restore previous versions if critical permissions are accidentally removed.
- Use AWS Config to continuously monitor and evaluate the compliance of IAM policies and detect any non-compliant configurations.
- Implement least privilege principles when assigning permissions to instance profiles, ensuring that only the necessary permissions are granted.
- Regularly review and audit the permissions assigned to instance profiles to identify any unauthorized changes.

3. To remediate the disruption of automated processes caused by the deletion of an instance profile, you can use the following Python scripts:

- Implement automated backups of instance profiles using the AWS SDK for Python (Boto3) to ensure that deleted profiles can be restored quickly.
- Regularly monitor and audit IAM events using AWS CloudTrail to detect any unauthorized deletion of instance profiles.
- Implement versioning for instance profiles to track changes and easily restore previous versions if necessary.
- Configure CloudWatch alarms to trigger notifications or alerts when critical automated processes are disrupted due to the deletion of an instance profile.
- Implement IAM policies that restrict the DeleteInstanceProfile action to only authorized users or roles, reducing the risk of accidental or unauthorized deletions.


 