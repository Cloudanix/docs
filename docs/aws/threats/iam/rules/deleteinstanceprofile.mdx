--- 
slug: DeleteInstanceProfile
eventname: DeleteInstanceProfile
title: DeleteInstanceProfile
sidebar_label: DeleteInstanceProfile
---
                       
### Event Information

- The DeleteInstanceProfile event in AWS for IAM refers to the deletion of an instance profile. 
- An instance profile is a container for an IAM role that you can use to pass role information to an EC2 instance when the instance starts. 
- When the DeleteInstanceProfile event occurs, it means that the instance profile and its associated IAM role have been deleted, and any EC2 instances using that instance profile will no longer have access to the permissions granted by the role.


### Examples

1. Unauthorized deletion of an instance profile: If security is impacted with the DeleteInstanceProfile action in AWS IAM, one example could be an unauthorized user or attacker gaining access to the AWS account and deleting an instance profile. This could result in the loss of necessary permissions and access controls for instances, potentially leading to unauthorized access or compromised security.

2. Disruption of service: Another example could be accidental or malicious deletion of an instance profile that is being used by running instances. This could disrupt the services or applications running on those instances, causing downtime or loss of availability until the instance profile is restored or replaced.

3. Misconfiguration leading to unintended consequences: A misconfiguration in the IAM policies or roles associated with an instance profile could result in unintended consequences when the DeleteInstanceProfile action is performed. For example, if the instance profile is mistakenly associated with critical resources or services, deleting it could inadvertently revoke necessary permissions and disrupt the functioning of those resources or services.

### Remediation

#### Using Console

To remediate the unauthorized deletion of an instance profile in AWS IAM, you can follow these steps:

1. Identify the deleted instance profile: 
   - Check the CloudTrail logs or AWS Config history to determine which instance profile was deleted and by whom.
   - Review any available audit logs or monitoring systems to gather additional information about the incident.

2. Restore the deleted instance profile:
   - If you have a backup or a previous version of the instance profile, you can restore it by creating a new instance profile with the same name and attaching the necessary IAM roles to it.
   - If you don't have a backup, you will need to recreate the instance profile from scratch. Ensure that you configure the necessary permissions and attach it to the appropriate resources.

3. Review and enhance security measures:
   - Conduct a thorough investigation to understand how the unauthorized deletion occurred and take steps to prevent similar incidents in the future.
   - Implement least privilege principles by regularly reviewing and auditing IAM policies and permissions to ensure they are appropriate and necessary.
   - Enable MFA (Multi-Factor Authentication) for IAM users to add an extra layer of security and prevent unauthorized access to IAM resources.
   - Consider implementing IAM access control policies that restrict the ability to delete instance profiles to only authorized personnel.
   - Regularly monitor and review CloudTrail logs and other relevant logs to detect and respond to any suspicious activities or unauthorized changes to IAM resources.

#### Using CLI

To remediate the unauthorized deletion of an instance profile in AWS IAM, you can follow these steps:

1. Identify the deleted instance profile: 
   - Use the AWS Management Console or AWS CLI to check the list of instance profiles and identify the deleted one. 
   - For example, using AWS CLI: `aws iam list-instance-profiles`

2. Restore the deleted instance profile:
   - If you have a backup or a previous version of the instance profile, you can restore it.
   - If not, create a new instance profile with the same permissions and configurations as the deleted one.
   - For example, using AWS CLI: `aws iam create-instance-profile --instance-profile-name <profile-name>`

3. Update affected resources:
   - Identify the resources (e.g., EC2 instances, Lambda functions) that were using the deleted instance profile.
   - Update the configuration of those resources to use the newly created/restored instance profile.
   - For example, using AWS CLI: 
     - For EC2 instances: `aws ec2 associate-iam-instance-profile --instance-id <instance-id> --iam-instance-profile Name=<profile-name>`
     - For Lambda functions: `aws lambda update-function-configuration --function-name <function-name> --role <role-arn>`

It is important to regularly monitor and audit IAM activities to detect and prevent unauthorized actions. Additionally, implementing least privilege principles and enforcing strong access controls can help mitigate the risk of unauthorized deletion of instance profiles.

#### Using Python

To remediate the unauthorized deletion of an instance profile in AWS IAM, you can follow these steps:

1. Monitor and detect unauthorized changes: Implement AWS CloudTrail to capture API events related to IAM, including instance profile deletions. Set up CloudWatch Events to trigger an alert or notification whenever an unauthorized deletion is detected.

2. Restore the deleted instance profile: If an instance profile is mistakenly deleted, you can restore it using the AWS Management Console, AWS CLI, or SDKs. The restoration process involves recreating the instance profile with the same name and associating it with the affected resources.

3. Implement preventive measures: To prevent unauthorized deletions, follow these best practices:
   - Apply the principle of least privilege by granting only necessary permissions to users and roles.
   - Enable MFA (Multi-Factor Authentication) for IAM users to add an extra layer of security.
   - Regularly review and audit IAM policies and roles to identify any misconfigurations or excessive permissions.
   - Implement IAM permission boundaries to limit the actions that can be performed on IAM resources.

Here's an example of a Python script using the AWS SDK (Boto3) to restore a deleted instance profile:

```python
import boto3

def restore_instance_profile(profile_name):
    iam_client = boto3.client('iam')
    
    try:
        response = iam_client.create_instance_profile(
            InstanceProfileName=profile_name
        )
        print("Instance profile restored successfully.")
    except iam_client.exceptions.EntityAlreadyExistsException:
        print("Instance profile with the same name already exists.")
    except Exception as e:
        print("Error restoring instance profile:", str(e))

# Usage: restore_instance_profile('example-instance-profile')
```

Please note that this script assumes you have the necessary IAM permissions to create instance profiles. Adjust the script as per your requirements and ensure you have the appropriate credentials configured for the AWS SDK.


 