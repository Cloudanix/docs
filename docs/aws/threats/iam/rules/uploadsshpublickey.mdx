--- 
slug: UploadSSHPublicKey
eventname: UploadSSHPublicKey
title: UploadSSHPublicKey
sidebar_label: UploadSSHPublicKey
---
                       
### Event Information

- The UploadSSHPublicKey event in AWS for IAM refers to the action of uploading an SSH public key to an IAM user's account.
- This event is typically used to enable SSH key-based authentication for the IAM user, allowing them to securely access AWS resources using SSH.
- By uploading an SSH public key, the IAM user can authenticate themselves without relying on traditional username/password credentials, enhancing security and convenience.


### Examples

1. Unauthorized access: If the UploadSSHPublicKey operation is misconfigured or misused, it can potentially allow unauthorized individuals to upload their own SSH public keys to an IAM user or role. This can lead to unauthorized access to the resources associated with that user or role, compromising the security of the AWS environment.

2. Privilege escalation: If an attacker gains access to an IAM user or role and is able to upload their own SSH public key, they can potentially escalate their privileges within the AWS environment. By associating their SSH key with a higher privileged user or role, they can gain access to sensitive resources and perform actions that they are not authorized to do.

3. Key tampering: If an attacker is able to intercept the SSH public key during the upload process, they can potentially tamper with the key and replace it with a malicious one. This can lead to unauthorized access or even allow the attacker to perform malicious actions within the AWS environment, compromising the overall security of the system.

### Remediation

#### Using Console

1. To remediate unauthorized access in AWS IAM using the AWS console, follow these steps:
   - Go to the AWS Management Console and navigate to the IAM service.
   - Select the user or role that needs to be secured against unauthorized access.
   - In the Permissions tab, review the existing policies and ensure that only necessary permissions are granted.
   - Enable multi-factor authentication (MFA) for the user or role to add an extra layer of security.
   - Regularly review and rotate SSH public keys associated with the user or role to remove any unauthorized keys.

2. To remediate privilege escalation in AWS IAM using the AWS console, follow these steps:
   - Go to the AWS Management Console and navigate to the IAM service.
   - Review the existing IAM policies and ensure that the principle of least privilege is followed.
   - Regularly review and rotate SSH public keys associated with high privileged users or roles to remove any unauthorized keys.
   - Enable CloudTrail to monitor and log all API calls made within the AWS environment, including changes to IAM policies and SSH key associations.
   - Implement strong password policies and enforce regular password rotations for IAM users.

3. To remediate key tampering in AWS IAM using the AWS console, follow these steps:
   - Go to the AWS Management Console and navigate to the IAM service.
   - Enable AWS Key Management Service (KMS) to encrypt SSH public keys during transit and at rest.
   - Implement secure file transfer protocols, such as SFTP or HTTPS, to upload SSH public keys to IAM.
   - Regularly monitor and review CloudTrail logs for any suspicious activities related to SSH key uploads.
   - Implement network security measures, such as network access control lists (ACLs) and security groups, to restrict access to IAM services and prevent unauthorized interception of SSH public keys.

#### Using CLI

1. To remediate unauthorized access in AWS IAM using AWS CLI, you can follow these steps:
   - Review and update the IAM policies associated with the user or role to ensure that only authorized individuals have the necessary permissions.
   - Regularly monitor and audit the IAM user and role configurations to identify any misconfigurations or unauthorized SSH public key uploads.
   - Implement multi-factor authentication (MFA) for IAM users to add an extra layer of security and prevent unauthorized access.

2. To remediate privilege escalation in AWS IAM using AWS CLI, you can take the following actions:
   - Regularly review and update the IAM policies to ensure that users and roles have the least privilege necessary to perform their tasks.
   - Implement strong password policies and enforce regular password rotations to reduce the risk of compromised credentials.
   - Enable AWS CloudTrail to monitor and log all API calls related to IAM, allowing you to detect and investigate any suspicious activities.

3. To remediate key tampering in AWS IAM using AWS CLI, consider the following steps:
   - Implement secure transmission protocols, such as HTTPS, to protect the SSH public key during the upload process.
   - Regularly monitor and review the IAM user and role configurations to identify any unauthorized changes to the SSH public keys.
   - Enable AWS CloudTrail to capture and log all API calls related to IAM, including SSH public key uploads, for auditing and investigation purposes.

#### Using Python

1. Unauthorized access:
- Regularly review and audit IAM user and role permissions to ensure they have the least privilege necessary.
- Implement multi-factor authentication (MFA) for IAM users to add an extra layer of security.

2. Privilege escalation:
- Implement strong password policies and enforce regular password rotation for IAM users.
- Monitor and analyze IAM user activity logs to detect any suspicious behavior or privilege escalation attempts.

3. Key tampering:
- Implement encryption and secure transmission protocols (e.g., HTTPS) when uploading SSH public keys.
- Use cryptographic hash functions to verify the integrity of the SSH public keys during the upload process.

Here is an example of a Python script that can help with auditing IAM user permissions:

```python
import boto3

def get_iam_users():
    iam = boto3.client('iam')
    response = iam.list_users()
    return response['Users']

def get_iam_user_permissions(user_name):
    iam = boto3.client('iam')
    response = iam.list_attached_user_policies(UserName=user_name)
    attached_policies = response['AttachedPolicies']
    permissions = []
    for policy in attached_policies:
        permissions.append(policy['PolicyName'])
    return permissions

def main():
    users = get_iam_users()
    for user in users:
        user_name = user['UserName']
        permissions = get_iam_user_permissions(user_name)
        print(f"IAM User: {user_name}")
        print(f"Permissions: {permissions}")
        print()

if __name__ == '__main__':
    main()
```

This script uses the Boto3 library to interact with the AWS IAM service. It retrieves a list of IAM users and their attached policies, providing visibility into the permissions assigned to each user.


 