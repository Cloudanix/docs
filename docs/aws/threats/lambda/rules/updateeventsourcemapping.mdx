--- 
slug: UpdateEventSourceMapping
eventname: UpdateEventSourceMapping
title: UpdateEventSourceMapping
sidebar_label: UpdateEventSourceMapping
---
                       
### Event Information

- The UpdateEventSourceMapping event in AWS for Lambda refers to a specific event that occurs when an event source mapping configuration for a Lambda function is updated.
- This event is triggered when there is a change in the configuration of the event source mapping, such as updating the batch size, enabling or disabling the event source, or modifying the starting position of the event stream.
- It is important to monitor and analyze the UpdateEventSourceMapping event to track any changes made to the event source mapping configuration and ensure that the Lambda function is properly integrated with the event source.


### Examples

1. Unauthorized access: If the UpdateEventSourceMapping operation allows unauthorized users or roles to modify the event source mapping configuration for a Lambda function, it can lead to potential security breaches. This could result in unauthorized execution of the Lambda function or exposure of sensitive data.

2. Insecure permissions: If the UpdateEventSourceMapping operation does not enforce proper permissions and access controls, it can lead to security vulnerabilities. For example, if the operation allows any user or role to update the event source mapping configuration, it can be exploited by malicious actors to modify the function's behavior or gain unauthorized access to resources.

3. Lack of encryption: If the UpdateEventSourceMapping operation does not enforce encryption for event source mappings, it can expose sensitive data transmitted between the event source and the Lambda function. This can result in data leakage or interception by unauthorized parties. It is important to ensure that event source mappings are encrypted using appropriate encryption mechanisms, such as AWS Key Management Service (KMS) encryption.

### Remediation

#### Using Console

1. Identify the specific issue or vulnerability in the AWS Lambda function by reviewing the event logs or security findings in the AWS console.

2. Determine the appropriate remediation steps based on the examples provided in the previous response:

   a. Example 1: Excessive permissions for Lambda function
      - Access the AWS Lambda console.
      - Select the specific Lambda function that has excessive permissions.
      - Click on the "Permissions" tab.
      - Review the existing permissions and identify any unnecessary or excessive permissions.
      - Remove the unnecessary permissions by clicking on the "X" icon next to each permission.
      - Click on "Save" to apply the changes.

   b. Example 2: Insecure environment variables in Lambda function
      - Access the AWS Lambda console.
      - Select the specific Lambda function that has insecure environment variables.
      - Click on the "Configuration" tab.
      - Scroll down to the "Environment variables" section.
      - Review the existing environment variables and identify any sensitive information.
      - Remove or encrypt any sensitive environment variables.
      - Click on "Save" to apply the changes.

   c. Example 3: Unencrypted data storage in Lambda function
      - Access the AWS Lambda console.
      - Select the specific Lambda function that has unencrypted data storage.
      - Click on the "Configuration" tab.
      - Scroll down to the "Environment variables" section.
      - Review the existing environment variables and identify any sensitive data storage configurations.
      - Modify the data storage configuration to use encryption, such as enabling server-side encryption for S3 buckets or using encrypted database storage.
      - Click on "Save" to apply the changes.

3. Validate the remediation by retesting the Lambda function and ensuring that the identified issues have been resolved. Monitor the function for any further security events or vulnerabilities.

#### Using CLI

1. Enable VPC configuration for AWS Lambda:
   - Use the `update-function-configuration` command to update the Lambda function's configuration.
   - Specify the `--vpc-config` parameter with the appropriate values for `SubnetIds` and `SecurityGroupIds`.
   - Example command: `aws lambda update-function-configuration --function-name <function-name> --vpc-config SubnetIds=<subnet-ids>,SecurityGroupIds=<security-group-ids>`

2. Enable encryption at rest for AWS Lambda function code:
   - Use the `update-function-configuration` command to update the Lambda function's configuration.
   - Specify the `--kms-key-arn` parameter with the ARN of the KMS key to be used for encryption.
   - Example command: `aws lambda update-function-configuration --function-name <function-name> --kms-key-arn <kms-key-arn>`

3. Enable AWS CloudTrail logging for AWS Lambda:
   - Use the `update-function-configuration` command to update the Lambda function's configuration.
   - Specify the `--tracing-config` parameter with the value `Mode=Active`.
   - Example command: `aws lambda update-function-configuration --function-name <function-name> --tracing-config Mode=Active`

#### Using Python

1. Enable VPC configuration for AWS Lambda:
   - Use the `update-function-configuration` API to add the VPC configuration to the Lambda function.
   - Specify the VPC ID, subnet IDs, and security group IDs in the API call.
   - Here's an example Python script to enable VPC configuration for a Lambda function:

   ```python
   import boto3

   lambda_client = boto3.client('lambda')

   def enable_lambda_vpc_config(function_name, vpc_id, subnet_ids, security_group_ids):
       response = lambda_client.update_function_configuration(
           FunctionName=function_name,
           VpcConfig={
               'SubnetIds': subnet_ids,
               'SecurityGroupIds': security_group_ids
           }
       )
       print(f"VPC configuration enabled for Lambda function {function_name}")

   enable_lambda_vpc_config('my-lambda-function', 'vpc-12345', ['subnet-12345', 'subnet-67890'], ['sg-12345'])
   ```

2. Enable AWS CloudTrail logging for AWS Lambda:
   - Use the `update-function-configuration` API to enable CloudTrail logging for the Lambda function.
   - Set the `TracingConfig` parameter to `'Active'` to enable CloudTrail logging.
   - Here's an example Python script to enable CloudTrail logging for a Lambda function:

   ```python
   import boto3

   lambda_client = boto3.client('lambda')

   def enable_lambda_cloudtrail_logging(function_name):
       response = lambda_client.update_function_configuration(
           FunctionName=function_name,
           TracingConfig={
               'Mode': 'Active'
           }
       )
       print(f"CloudTrail logging enabled for Lambda function {function_name}")

   enable_lambda_cloudtrail_logging('my-lambda-function')
   ```

3. Enable AWS X-Ray tracing for AWS Lambda:
   - Use the `update-function-configuration` API to enable X-Ray tracing for the Lambda function.
   - Set the `TracingConfig` parameter to `'Active'` to enable X-Ray tracing.
   - Here's an example Python script to enable X-Ray tracing for a Lambda function:

   ```python
   import boto3

   lambda_client = boto3.client('lambda')

   def enable_lambda_xray_tracing(function_name):
       response = lambda_client.update_function_configuration(
           FunctionName=function_name,
           TracingConfig={
               'Mode': 'Active'
           }
       )
       print(f"X-Ray tracing enabled for Lambda function {function_name}")

   enable_lambda_xray_tracing('my-lambda-function')
   ```


 