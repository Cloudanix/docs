--- 
slug: AddPermission
eventname: AddPermission
title: AddPermission
sidebar_label: AddPermission
---
                       
### Event Information

#### Meaning

- The AddPermission event in AWS Lambda refers to an action taken to grant permission to another AWS service or entity to invoke a Lambda function.
- This event is typically used when you want to allow external services or resources to trigger your Lambda function.
- By using the AddPermission event, you can specify the necessary permissions and conditions for the invoker to successfully invoke your Lambda function.

### Remediation

#### Using Console

- Example of security impact with AddPermission in AWS Lambda: Let's say you have a Lambda function that allows public access and you mistakenly use the AddPermission API to grant permission to an unauthorized entity. This can lead to potential security breaches as the unauthorized entity can now invoke your Lambda function and potentially access sensitive data or perform malicious actions.

- Remediation steps for AWS Lambda using AWS console:
  1. Open the AWS Management Console and navigate to the Lambda service.
  2. Select the Lambda function for which you want to remediate the security impact.
  3. In the function's configuration page, scroll down to the "Permissions" section and click on the "Add permission" button.
  4. Review the existing permissions and identify the unauthorized entity that was granted access using the AddPermission API.
  5. Click on the "X" button next to the unauthorized entity's permission to remove it.
  6. Review the remaining permissions to ensure that only authorized entities have access to invoke the Lambda function.
  7. Click on the "Save" button to apply the changes and remediate the security impact.
  8. Regularly monitor and review the permissions of your Lambda functions to prevent unauthorized access in the future.

#### Using CLI

- Example of security impact with AddPermission in AWS Lambda:
  - If the AddPermission action is misconfigured or misused, it can potentially grant excessive permissions to external entities, leading to a security vulnerability. For example, if an incorrect or overly permissive IAM role or AWS account ID is specified in the AddPermission command, it could allow unauthorized access to the Lambda function.

- Remediation for AWS Lambda using AWS CLI:
  - To remediate the security impact of AddPermission in AWS Lambda, you can follow these steps using AWS CLI:
    1. Identify the Lambda function for which the permission was added incorrectly.
    2. Use the `aws lambda remove-permission` command to remove the incorrect permission. For example:
       ```
       aws lambda remove-permission --function-name <function-name> --statement-id <statement-id>
       ```
       Replace `<function-name>` with the name of the Lambda function and `<statement-id>` with the ID of the statement that needs to be removed.
    3. Validate the permissions by using the `aws lambda get-policy` command to ensure that only the intended permissions are present. For example:
       ```
       aws lambda get-policy --function-name <function-name>
       ```
       Replace `<function-name>` with the name of the Lambda function.

Note: It is important to review and validate the permissions before removing them to ensure that the correct permissions are retained and no unintended access is granted.

#### Using Python

- Example of security impact with AddPermission in AWS Lambda: Let's say you have a Lambda function that allows public access by using the `AddPermission` API call with a wide range of IP addresses (0.0.0.0/0) or by allowing access from any AWS account. This can potentially expose your Lambda function to unauthorized access and increase the risk of security breaches.

- Remediation for AWS Lambda using Python: To remediate this security issue, you can update the Lambda function's permissions to restrict access only to trusted sources. Here's an example Python script that uses the `boto3` library to update the function's permissions:

```python
import boto3

lambda_client = boto3.client('lambda')

def update_lambda_permissions(function_name):
    response = lambda_client.remove_permission(
        FunctionName=function_name,
        StatementId='AllowPublicAccess'
    )
    print('Removed public access permission:', response)

    response = lambda_client.add_permission(
        FunctionName=function_name,
        StatementId='RestrictAccess',
        Action='lambda:InvokeFunction',
        Principal='AWS',
        SourceArn='arn:aws:iam::123456789012:root',  # Replace with trusted source ARN
        SourceAccount='123456789012'  # Replace with trusted source account ID
    )
    print('Added restricted access permission:', response)

# Usage
update_lambda_permissions('my-lambda-function')
```

This script removes the existing public access permission (`AllowPublicAccess`) and adds a new permission (`RestrictAccess`) that allows access only from a specific AWS account (`123456789012`) and ARN (`arn:aws:iam::123456789012:root`). Make sure to replace the placeholders with the appropriate values for your use case.


 