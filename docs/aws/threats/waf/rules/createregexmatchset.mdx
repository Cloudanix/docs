--- 
slug: CreateRegexMatchSet
eventname: CreateRegexMatchSet
title: CreateRegexMatchSet
sidebar_label: CreateRegexMatchSet
---
                       
### Event Information

- The CreateRegexMatchSet event in AWS WAF refers to the creation of a regular expression (regex) match set. 
- A regex match set is a collection of regex patterns that are used to match against web request data in order to identify and block malicious or unwanted traffic. 
- This event indicates that a new regex match set has been created, which can then be associated with a web access control list (ACL) or a rule to protect against specific types of attacks or vulnerabilities.


### Examples

1. Insufficient validation of user input: When creating a regex match set in AWS WAF, it is important to ensure that the regular expressions used for matching patterns are properly validated. Failing to do so can lead to security vulnerabilities such as allowing malicious input to bypass the regex match set and potentially exploit the application.

2. Inadequate rule prioritization: The order in which rules are evaluated within a regex match set can impact security. If the rules are not properly prioritized, it is possible for a less restrictive rule to match before a more specific or restrictive rule, allowing potentially malicious traffic to bypass the intended security measures.

3. Lack of monitoring and alerting: It is crucial to have proper monitoring and alerting mechanisms in place when using regex match sets in AWS WAF. Without adequate monitoring, it may be difficult to detect and respond to security incidents or patterns of suspicious activity. Regularly reviewing and analyzing the logs and alerts generated by the WAF can help identify potential security issues and take appropriate actions to mitigate them.

### Remediation

#### Using Console

1. Insufficient validation of user input:
   - Step 1: Access the AWS Management Console and navigate to the AWS WAF service.
   - Step 2: Select the desired web ACL (Access Control List) that contains the regex match set you want to remediate.
   - Step 3: Under the "Rules" tab, locate the regex match set that needs validation.
   - Step 4: Click on the regex match set to open its configuration.
   - Step 5: Review the regular expressions used for matching patterns and ensure they are properly validated.
   - Step 6: If any regular expressions are found to be insufficiently validated, update them to include proper validation logic.
   - Step 7: Save the changes to the regex match set.

2. Inadequate rule prioritization:
   - Step 1: Access the AWS Management Console and navigate to the AWS WAF service.
   - Step 2: Select the desired web ACL that contains the regex match set with inadequate rule prioritization.
   - Step 3: Under the "Rules" tab, locate the regex match set that needs prioritization.
   - Step 4: Click on the regex match set to open its configuration.
   - Step 5: Review the order in which the rules are evaluated within the regex match set.
   - Step 6: Rearrange the rules to ensure that more specific or restrictive rules are evaluated before less restrictive ones.
   - Step 7: Save the changes to the regex match set.

3. Lack of monitoring and alerting:
   - Step 1: Access the AWS Management Console and navigate to the AWS WAF service.
   - Step 2: Select the desired web ACL that lacks proper monitoring and alerting.
   - Step 3: Under the "Logging and Monitoring" tab, enable logging for the web ACL.
   - Step 4: Configure the desired logging destination, such as Amazon S3 or Amazon CloudWatch.
   - Step 5: Set up appropriate alerting mechanisms, such as CloudWatch Alarms, to notify you of any suspicious activity or security incidents.
   - Step 6: Regularly review the logs and alerts generated by the WAF to identify potential security issues.
   - Step 7: Take appropriate actions to mitigate any identified security issues.

#### Using CLI

1. To remediate insufficient validation of user input in AWS WAF using AWS CLI, you can follow these steps:
   - Use the `get-regex-pattern-set` command to retrieve the existing regex pattern set: `aws wafv2 get-regex-pattern-set --name <pattern-set-name> --scope <scope>`
   - Validate the regular expressions used in the pattern set against known security vulnerabilities.
   - If any insecure regular expressions are found, use the `update-regex-pattern-set` command to update the pattern set with properly validated regular expressions: `aws wafv2 update-regex-pattern-set --name <pattern-set-name> --scope <scope> --regular-expression-list <validated-regex-list>`

2. To remediate inadequate rule prioritization in AWS WAF using AWS CLI, you can follow these steps:
   - Use the `get-regex-match-set` command to retrieve the existing regex match set: `aws wafv2 get-regex-match-set --name <match-set-name> --scope <scope>`
   - Review the order in which the rules are evaluated within the match set.
   - If necessary, use the `update-regex-match-set` command to reorder the rules based on their desired priority: `aws wafv2 update-regex-match-set --name <match-set-name> --scope <scope> --regex-match-tuple-list <reordered-rule-list>`

3. To remediate the lack of monitoring and alerting in AWS WAF using AWS CLI, you can follow these steps:
   - Enable logging for the AWS WAF web ACL associated with the regex match set using the `put-logging-configuration` command: `aws wafv2 put-logging-configuration --resource-arn <web-acl-arn> --logging-configuration <logging-configuration>`
   - Configure CloudWatch Alarms to monitor the logs generated by the WAF and trigger alerts for suspicious activity or security incidents.
   - Regularly review the CloudWatch Logs and respond to any alerts or patterns of suspicious activity identified.

#### Using Python

1. Insufficient validation of user input:
- Implement input validation mechanisms to ensure that user input is properly validated before being used in regex match sets.
- Use regular expression libraries or functions that have built-in validation features to prevent the use of potentially malicious input.

2. Inadequate rule prioritization:
- Prioritize rules within the regex match set based on their specificity and restrictiveness.
- Use the AWS WAF API or SDKs to programmatically set the order of rules within the regex match set, ensuring that more specific rules are evaluated before less restrictive ones.

3. Lack of monitoring and alerting:
- Utilize AWS CloudWatch to monitor and collect logs from AWS WAF.
- Set up CloudWatch Alarms to trigger alerts based on predefined thresholds or patterns of suspicious activity.
- Use the AWS SDK for Python (Boto3) to automate the retrieval and analysis of logs and alerts generated by AWS WAF.


 