--- 
slug: CreateRegexMatchSet
eventname: CreateRegexMatchSet
title: CreateRegexMatchSet
sidebar_label: CreateRegexMatchSet
---
                       
### Event Information

#### Meaning

- The CreateRegexMatchSet event in AWS WAF refers to the creation of a regular expression (regex) match set. 
- A regex match set is a collection of regex patterns that are used to match against web request data in order to identify and block malicious or unwanted traffic. 
- This event indicates that a new regex match set has been created, which can then be associated with a web access control list (ACL) or a rule to protect against specific types of attacks or vulnerabilities.

### Remediation

#### Using Console

- Security impact: The use of CreateRegexMatchSet in AWS WAF can potentially impact security if not properly configured. For example, if an incorrect regular expression pattern is used, it may result in false positives or false negatives, allowing malicious traffic to bypass the WAF protection or blocking legitimate traffic.

- Remediation steps using AWS console:
  1. Log in to the AWS Management Console and navigate to the AWS WAF service.
  2. Select the appropriate WAF web ACL that contains the CreateRegexMatchSet rule you want to remediate.
  3. In the web ACL settings, click on the "Rules" tab and locate the rule that uses the CreateRegexMatchSet.
  4. Click on the rule to edit it and review the regular expression pattern used in the CreateRegexMatchSet.
  5. If the pattern is incorrect or needs modification, click on the "Edit" button next to the CreateRegexMatchSet rule.
  6. Update the regular expression pattern with the correct one, ensuring it accurately matches the intended traffic.
  7. Save the changes and verify that the updated CreateRegexMatchSet rule is now correctly configured and providing the desired security protection.

Note: It is important to thoroughly test and validate the regular expression pattern before applying it to the CreateRegexMatchSet rule to avoid any unintended security impacts. Regular expression patterns can be complex, so it is recommended to consult the AWS WAF documentation or seek assistance from a security expert if needed.

#### Using CLI

- Security can be impacted with CreateRegexMatchSet in AWS WAF if the regular expression used in the rule allows for potential security vulnerabilities, such as allowing malicious input or bypassing security controls.
- For example, if a regular expression pattern is not properly validated and allows for arbitrary input, an attacker could potentially exploit this to inject malicious code or bypass security filters.
- To remediate this issue for AWS WAF using AWS CLI, you can follow these steps:
  1. Identify the regular expression pattern that is causing the security impact.
  2. Update the regular expression pattern to ensure it follows best practices for security and input validation.
  3. Use the AWS CLI command `update-regex-match-set` to update the existing regex match set with the new regular expression pattern. For example:
     ```
     aws waf update-regex-match-set --regex-match-set-id <regex-match-set-id> --updates '[{"Action": "INSERT", "RegexMatchTuple": {"FieldToMatch": {"Type": "URI"}, "TextTransformation": "NONE", "RegexPatternSetId": "<regex-pattern-set-id>", "RegexPatternString": "<new-regex-pattern>"}}]'
     ```
     Replace `<regex-match-set-id>` with the ID of the regex match set you want to update, `<regex-pattern-set-id>` with the ID of the regex pattern set associated with the match set, and `<new-regex-pattern>` with the updated regular expression pattern.

#### Using Python

- Security can be impacted with CreateRegexMatchSet in AWS WAF if the regular expression used in the rule allows for bypassing the intended security controls. For example, if a regular expression is not properly crafted, it may allow malicious input to pass through the WAF and reach the application.

To remediate this issue for AWS WAF using Python, you can follow these steps:

1. Validate the regular expression: Before creating the regex match set, thoroughly test and validate the regular expression to ensure it accurately matches the intended patterns and does not allow any bypasses. You can use Python's `re` module to test the regular expression against various inputs.

2. Implement input sanitization: Apply input sanitization techniques to the application code to further mitigate any potential security risks. This can include input validation, encoding, and filtering to prevent malicious input from reaching the application.

3. Automate WAF rule creation: Use the AWS SDK for Python (Boto3) to automate the creation of the regex match set and associated rules. Here's an example Python script that demonstrates how to create a regex match set with a rule:

```python
import boto3

waf_client = boto3.client('waf')

def create_regex_match_set():
    response = waf_client.create_regex_match_set(
        Name='MyRegexMatchSet',
        ChangeToken='CHANGE_TOKEN'
    )
    return response['RegexMatchSet']['RegexMatchSetId']

def create_regex_rule(regex_match_set_id, regex_pattern):
    response = waf_client.create_regex_pattern_set(
        RegexMatchSetId=regex_match_set_id,
        Updates=[
            {
                'Action': 'INSERT',
                'RegexPatternString': regex_pattern
            }
        ],
        ChangeToken='CHANGE_TOKEN'
    )
    return response['RegexPatternSet']['RegexPatternSetId']

# Usage example
regex_match_set_id = create_regex_match_set()
regex_pattern = r'^[a-zA-Z0-9]+$'
regex_rule_id = create_regex_rule(regex_match_set_id, regex_pattern)
```

Note: Replace `'CHANGE_TOKEN'` with the actual change token obtained from AWS WAF. Also, make sure you have the necessary permissions to create and modify WAF resources.


 